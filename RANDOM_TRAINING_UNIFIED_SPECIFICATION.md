# ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒšãƒ¼ã‚¸çµ±åˆä»•æ§˜æ›¸

**ä½œæˆæ—¥**: 2025-07-26  
**å¯¾è±¡**: `/training/random` ãƒšãƒ¼ã‚¸  
**ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ **: shadcn/uiæº–æ‹   
**ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**: `/Users/isao/Documents/pitch-training`

---

## ğŸ¯ åŸºæœ¬è¨­è¨ˆæ–¹é‡

### **1ãƒšãƒ¼ã‚¸å®Œçµå‹è¨­è¨ˆ**
- **å¾“æ¥**: ãƒ›ãƒ¼ãƒ  â†’ ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆ â†’ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆ3ãƒšãƒ¼ã‚¸é·ç§»ï¼‰
- **æ–°è¨­è¨ˆ**: ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒšãƒ¼ã‚¸å†…ã§å…¨æ©Ÿèƒ½å®Œçµï¼ˆ1ãƒšãƒ¼ã‚¸ï¼‰
- **ç†ç”±**: UXå‘ä¸Šã€çŠ¶æ…‹ç®¡ç†ç°¡ç´ åŒ–ã€ä¿å®ˆæ€§å‘ä¸Š

### **ãƒã‚¤ã‚¯è¨±å¯å‰æ**
- **v3.0.0ãƒ•ãƒ­ãƒ¼**: ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸çµŒç”±ã‚’å‰æ
- **ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚¢ã‚¯ã‚»ã‚¹å¯¾ç­–**: ãƒã‚¤ã‚¯æœªè¨±å¯æ™‚ã®é©åˆ‡ãªèª˜å°
- **è¨±å¯ç¢ºèª**: åˆæœŸåŒ–æ™‚ã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯

### **3ãƒ¢ãƒ¼ãƒ‰å…±é€šè¨­è¨ˆ**
- **å¯¾è±¡**: Random / Continuous / Chromatic
- **å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: åŸºéŸ³å†ç”Ÿã€éŸ³ç¨‹æ¤œå‡ºã€çµæœè¡¨ç¤ºã€SNSå…±æœ‰
- **å€‹åˆ¥è¦ç´ **: ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã€UIè¡¨ç¤ºå†…å®¹

---

## ğŸ“± UIè¨­è¨ˆä»•æ§˜

### **ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ **: shadcn/uiæº–æ‹ 

#### **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹é€ **
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header (å›ºå®š)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Status Bar (ãƒã‚¤ã‚¯çŠ¶æ…‹ãƒ»é€²è¡Œ)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Base Tone Section (åŸºéŸ³å†ç”Ÿ)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Scale Guide (ãƒ‰ãƒ¬ãƒŸã‚¬ã‚¤ãƒ‰)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Detection Section (éŸ³ç¨‹æ¤œå‡º)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Results Section (çµæœãƒ»SNS)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **ãƒœã‚¿ãƒ³è¨­è¨ˆ**
- **ã‚µã‚¤ã‚º**: å›ºå®šå¹…ï¼ˆã‚³ãƒ³ãƒ†ãƒŠå¹…ã«åˆã‚ã›ãªã„ï¼‰
- **Primary**: åŸºéŸ³å†ç”Ÿã€ãƒªã‚¹ã‚¿ãƒ¼ãƒˆã€SNSå…±æœ‰
- **Secondary**: è¨­å®šã€è©³ç´°è¡¨ç¤º
- **Destructive**: ãƒªã‚»ãƒƒãƒˆã€çµ‚äº†

#### **ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ** (shadcn/uiæº–æ‹ )
- **Primary**: `hsl(222.2 84% 4.9%)` (æ¿ƒç´º)
- **Secondary**: `hsl(210 40% 96%)` (ãƒ©ã‚¤ãƒˆã‚°ãƒ¬ãƒ¼)
- **Success**: `hsl(142.1 76.2% 36.3%)` (ã‚°ãƒªãƒ¼ãƒ³)
- **Warning**: `hsl(47.9 95.8% 53.1%)` (ã‚¤ã‚¨ãƒ­ãƒ¼)
- **Destructive**: `hsl(0 84.2% 60.2%)` (ãƒ¬ãƒƒãƒ‰)

---

## ğŸµ æ©Ÿèƒ½ä»•æ§˜

### **Phase 1: åŸºéŸ³å†ç”Ÿã‚·ã‚¹ãƒ†ãƒ **

#### **åŸºéŸ³é¸æŠãƒ­ã‚¸ãƒƒã‚¯**
```typescript
type BaseNote = 'C4' | 'D4' | 'E4' | 'F4' | 'G4' | 'A4' | 'B4' | 'C5' | 'D5' | 'E5';

const baseNotes: BaseNote[] = ['C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4', 'C5', 'D5', 'E5'];
const baseNoteNames = {
  'C4': 'ãƒ‰ï¼ˆä½ï¼‰', 'D4': 'ãƒ¬ï¼ˆä½ï¼‰', 'E4': 'ãƒŸï¼ˆä½ï¼‰', 'F4': 'ãƒ•ã‚¡ï¼ˆä½ï¼‰', 'G4': 'ã‚½ï¼ˆä½ï¼‰',
  'A4': 'ãƒ©ï¼ˆä¸­ï¼‰', 'B4': 'ã‚·ï¼ˆä¸­ï¼‰', 'C5': 'ãƒ‰ï¼ˆé«˜ï¼‰', 'D5': 'ãƒ¬ï¼ˆé«˜ï¼‰', 'E5': 'ãƒŸï¼ˆé«˜ï¼‰'
};

// ãƒ©ãƒ³ãƒ€ãƒ é¸æŠ
const getRandomBaseNote = (): BaseNote => {
  return baseNotes[Math.floor(Math.random() * baseNotes.length)];
};
```

#### **éŸ³æºã‚·ã‚¹ãƒ†ãƒ **
- **æŠ€è¡“**: Tone.js + Salamander Grand Piano
- **éŸ³æºå ´æ‰€**: `/public/audio/piano/` (ãƒ­ãƒ¼ã‚«ãƒ«)
- **å¿…è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `C4.mp3`, `D4.mp3`, `E4.mp3`, `F4.mp3`, `G4.mp3`, `A4.mp3`, `B4.mp3`, `C5.mp3`, `D5.mp3`, `E5.mp3`

```typescript
const sampler = new Tone.Sampler({
  urls: {
    "C4": "C4.mp3", "D4": "D4.mp3", "E4": "E4.mp3", "F4": "F4.mp3", "G4": "G4.mp3",
    "A4": "A4.mp3", "B4": "B4.mp3", "C5": "C5.mp3", "D5": "D5.mp3", "E5": "E5.mp3"
  },
  baseUrl: "/audio/piano/",
  release: 1.5
}).toDestination();
```

### **Phase 2: ãƒ‰ãƒ¬ãƒŸã‚¬ã‚¤ãƒ‰ã‚·ã‚¹ãƒ†ãƒ **

#### **è¦–è¦šçš„ã‚¬ã‚¤ãƒ‰**
- **è¡¨ç¤º**: ãƒ‰â†’ãƒ¬â†’ãƒŸâ†’ãƒ•ã‚¡â†’ã‚½â†’ãƒ©â†’ã‚·â†’ãƒ‰ï¼ˆ8éŸ³éšï¼‰
- **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: é †æ¬¡ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º
- **çŠ¶æ…‹**: æœªç™ºå£°ï¼ˆã‚°ãƒ¬ãƒ¼ï¼‰ã€æ¤œå‡ºä¸­ï¼ˆãƒ–ãƒ«ãƒ¼ï¼‰ã€æ­£è§£ï¼ˆã‚°ãƒªãƒ¼ãƒ³ï¼‰ã€ä¸æ­£è§£ï¼ˆãƒ¬ãƒƒãƒ‰ï¼‰

```typescript
type ScaleStep = 'ãƒ‰' | 'ãƒ¬' | 'ãƒŸ' | 'ãƒ•ã‚¡' | 'ã‚½' | 'ãƒ©' | 'ã‚·' | 'ãƒ‰ï¼ˆé«˜ï¼‰';
type ScaleState = 'inactive' | 'active' | 'correct' | 'incorrect';

interface ScaleGuide {
  step: ScaleStep;
  state: ScaleState;
  targetFrequency: number;
}
```

### **Phase 3: éŸ³ç¨‹æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ **

#### **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**
- **Pitchy**: McLeod Pitch Method
- **å‹•çš„ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–è£œæ­£**: `/test/separated-audio/` å®Ÿè£…ã®ç§»æ¤
- **3æ®µéšãƒã‚¤ã‚ºãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³**: ãƒã‚¤ãƒ‘ã‚¹ãƒ»ãƒ­ãƒ¼ãƒ‘ã‚¹ãƒ»ãƒãƒƒãƒãƒ•ã‚£ãƒ«ã‚¿ãƒ¼

#### **æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯**
```typescript
interface PitchResult {
  frequency: number;
  clarity: number;
  detectedNote: string;
  relativeStep: ScaleStep | null;
  isCorrect: boolean;
}
```

### **Phase 4: çµæœãƒ»æ¡ç‚¹ã‚·ã‚¹ãƒ†ãƒ **

#### **ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°**
- **åŸºæº–**: éŸ³ç¨‹ç²¾åº¦ã€åå¿œé€Ÿåº¦ã€é€£ç¶šæ­£è§£æ•°
- **è¡¨ç¤º**: 8éŸ³éšå€‹åˆ¥ã‚¹ã‚³ã‚¢ + ç·åˆã‚¹ã‚³ã‚¢
- **å±¥æ­´**: ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…é€²æ—è¡¨ç¤º

```typescript
interface TrainingResult {
  scaleStep: ScaleStep;
  targetFrequency: number;
  detectedFrequency: number;
  accuracy: number; // 0-100%
  responseTime: number; // ms
  isCorrect: boolean;
}

interface SessionScore {
  totalScore: number;
  correctCount: number;
  totalCount: number;
  averageAccuracy: number;
  averageResponseTime: number;
  scaleResults: TrainingResult[];
}
```

---

## ğŸ“¤ SNSå…±æœ‰æ©Ÿèƒ½ä»•æ§˜

### **å…±æœ‰å†…å®¹**
```typescript
interface ShareData {
  score: number;
  accuracy: number;
  responseTime: number;
  completedScales: number;
  trainingMode: 'random' | 'continuous' | 'chromatic';
  imageUrl: string; // çµæœç”»åƒã®URL
}
```

### **å…±æœ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**
```
ğŸµ ç›¸å¯¾éŸ³æ„Ÿãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°çµæœ ğŸµ

ãƒ¢ãƒ¼ãƒ‰: ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³
ã‚¹ã‚³ã‚¢: 85/100
ç²¾åº¦: 92%
å¹³å‡åå¿œæ™‚é–“: 1.2ç§’
å®Œäº†éŸ³éš: 8/8

#ç›¸å¯¾éŸ³æ„Ÿ #éŸ³æ¥½è¨“ç·´ #PitchTraining
https://kiyopi.github.io/pitch-training/training/random
```

### **å¯¾å¿œãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **
- **Twitter/X**: Web Share API + Twitter Intent
- **Facebook**: Facebook Share Dialog
- **LINE**: LINE Share API
- **ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰**: ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼æ©Ÿèƒ½

---

## ğŸ›¡ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### **ãƒã‚¤ã‚¯è¨±å¯ãƒã‚§ãƒƒã‚¯**
```typescript
type MicrophoneState = 'checking' | 'granted' | 'denied' | 'unavailable';

const checkMicrophonePermission = async (): Promise<MicrophoneState> => {
  try {
    if (!navigator.mediaDevices?.getUserMedia) return 'unavailable';
    
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    stream.getTracks().forEach(track => track.stop());
    return 'granted';
  } catch (error) {
    if (error.name === 'NotAllowedError') return 'denied';
    return 'unavailable';
  }
};
```

### **ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚¢ã‚¯ã‚»ã‚¹å¯¾ç­–**
- **ãƒã‚¤ã‚¯æœªè¨±å¯**: ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã¸ã®èª˜å°
- **éŸ³æºèª­ã¿è¾¼ã¿å¤±æ•—**: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ + ãƒªãƒ­ãƒ¼ãƒ‰æ¡ˆå†…
- **éŸ³ç¨‹æ¤œå‡ºå¤±æ•—**: ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ãƒã‚§ãƒƒã‚¯

---

## ğŸ”§ æŠ€è¡“å®Ÿè£…è©³ç´°

### **çŠ¶æ…‹ç®¡ç†**
```typescript
interface TrainingState {
  // ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹
  isActive: boolean;
  currentPhase: 'setup' | 'listening' | 'guiding' | 'detecting' | 'results';
  
  // åŸºéŸ³æƒ…å ±
  currentBaseNote: BaseNote;
  currentBaseFrequency: number;
  
  // ã‚¬ã‚¤ãƒ‰çŠ¶æ…‹
  currentScaleIndex: number;
  scaleGuide: ScaleGuide[];
  
  // æ¤œå‡ºçŠ¶æ…‹
  detectedFrequency: number | null;
  detectedNote: string | null;
  
  // çµæœ
  sessionScore: SessionScore;
  isCompleted: boolean;
}
```

### **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ**
```
TrainingRandomPage/
â”œâ”€â”€ BasetonPlayer/          # åŸºéŸ³å†ç”Ÿ
â”œâ”€â”€ ScaleGuide/            # ãƒ‰ãƒ¬ãƒŸã‚¬ã‚¤ãƒ‰
â”œâ”€â”€ PitchDetector/         # éŸ³ç¨‹æ¤œå‡º
â”œâ”€â”€ ResultsDisplay/        # çµæœè¡¨ç¤º
â”œâ”€â”€ ShareButton/           # SNSå…±æœ‰
â””â”€â”€ StatusIndicator/       # çŠ¶æ…‹è¡¨ç¤º
```

### **ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ**
```
/src/app/training/random/
â”œâ”€â”€ page.tsx              # ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ BasetonPlayer.tsx
â”‚   â”œâ”€â”€ ScaleGuide.tsx
â”‚   â”œâ”€â”€ PitchDetector.tsx
â”‚   â”œâ”€â”€ ResultsDisplay.tsx
â”‚   â””â”€â”€ ShareButton.tsx
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useTrainingState.ts
â”‚   â”œâ”€â”€ usePitchDetection.ts
â”‚   â””â”€â”€ useAudioEngine.ts
â””â”€â”€ utils/
    â”œâ”€â”€ audioProcessing.ts
    â”œâ”€â”€ scoreCalculation.ts
    â””â”€â”€ shareUtils.ts
```

---

## ğŸ¯ å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### **Phase 1: åŸºæœ¬æ§‹é€ **
1. ãƒšãƒ¼ã‚¸ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹ç¯‰
2. shadcn/uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçµ±åˆ
3. åŸºæœ¬çŠ¶æ…‹ç®¡ç†

### **Phase 2: éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ **
1. Tone.jsåŸºéŸ³å†ç”Ÿã‚·ã‚¹ãƒ†ãƒ 
2. PitchyéŸ³ç¨‹æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ 
3. `/test/separated-audio/`ã‹ã‚‰ã®æŠ€è¡“ç§»æ¤

### **Phase 3: UIçµ±åˆ**
1. ãƒ‰ãƒ¬ãƒŸã‚¬ã‚¤ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
2. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œå‡ºè¡¨ç¤º
3. çµæœç”»é¢å®Ÿè£…

### **Phase 4: æ©Ÿèƒ½å¼·åŒ–**
1. SNSå…±æœ‰æ©Ÿèƒ½
2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

---

## âœ… å®ŒæˆåŸºæº–

### **æ©Ÿèƒ½è¦ä»¶**
- [ ] ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³å†ç”Ÿï¼ˆ10ç¨®é¡ï¼‰
- [ ] ãƒ‰ãƒ¬ãƒŸ8éŸ³éšã‚¬ã‚¤ãƒ‰è¡¨ç¤º
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³ç¨‹æ¤œå‡º
- [ ] æ¡ç‚¹ãƒ»çµæœè¡¨ç¤º
- [ ] SNSå…±æœ‰æ©Ÿèƒ½
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### **å“è³ªè¦ä»¶**
- [ ] iPhone Safariå¯¾å¿œ
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
- [ ] ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œ
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆ3Gå›ç·šå¯¾å¿œï¼‰

### **ä¿å®ˆæ€§è¦ä»¶**
- [ ] TypeScriptå‹å®‰å…¨æ€§
- [ ] ESLintã‚¨ãƒ©ãƒ¼ã‚¼ãƒ­
- [ ] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†é›¢
- [ ] 3ãƒ¢ãƒ¼ãƒ‰å…±é€šåŒ–æº–å‚™

---

**ã“ã®ä»•æ§˜æ›¸ã«åŸºã¥ãã€æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã®å®Ÿè£…ã‚’é–‹å§‹ã—ã¾ã™ã€‚**