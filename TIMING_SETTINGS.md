# 基音再生タイミング設定詳細

## 📊 現在の設定値 (v3 - 最適化版)

### コード内設定
```javascript
this.baseToneDuration = 2500; // 基音再生時間2.5秒
```

### Tone.js タイマー設定
```javascript
// 2秒後にリリース開始（フェイドアウト）
setTimeout(() => {
    this.pianoSampler.triggerRelease("C4");
}, 2000);

// 2.7秒後に完全停止
setTimeout(() => {
    this.pianoSampler.releaseAll();
}, 2700);
```

### アニメーション連携
```javascript
// 基音終了と同時にアニメーション開始
setTimeout(() => {
    this.startGuideAnimation();
}, this.baseToneDuration); // 2500ms
```

## ⏰ タイムライン詳細

| 時間 | イベント | 説明 | 状態 |
|------|----------|------|------|
| 0.0秒 | `triggerAttack("C4")` | ピアノ音開始 | 🎹 アタック |
| 0.0-2.0秒 | サスティン期間 | 「トーーーン」 | 📊 持続 |
| 2.0秒 | `triggerRelease("C4")` | フェイドアウト開始 | 🔽 リリース |
| 2.0-2.5秒 | フェイドアウト | 0.5秒間の減衰 | 📉 減音 |
| 2.5秒 | `startGuideAnimation()` | ガイド開始 | 🎼 アニメ |
| 2.7秒 | `releaseAll()` | 完全停止 | 🔇 無音 |

## 🔄 設定変更履歴

### v1 (初期設定)
- **総時間**: 1.5秒
- **問題**: 音程確認時間が不足
- **フィードバック**: 短すぎる

### v2 (3秒版)
- **総時間**: 3秒
- **サスティン**: 2.5秒
- **問題**: 待ち時間が長い
- **フィードバック**: 長すぎる

### v3 (最適化版) ← 現在
- **総時間**: 2.5秒
- **サスティン**: 2秒
- **フェイドアウト**: 0.5秒
- **評価**: ✅ 最適なバランス

## 🎯 設計思想

### ユーザー体験の考慮
1. **音程確認時間**: 2秒は十分な認識時間
2. **待ち時間**: 2.5秒は飽きない長さ
3. **フェイドアウト**: 0.5秒で自然な終了感
4. **UI応答性**: 即座にガイドアニメーションに移行

### 技術的配慮
1. **メモリ効率**: 2.7秒後の確実な停止
2. **重複防止**: 前の音が完全停止してから次へ
3. **エラー回避**: タイマーの余裕時間確保

## 🔧 調整可能パラメータ

### 基本設定
```javascript
// 全体時間を変更する場合
this.baseToneDuration = 2500; // ms (現在値)

// フェイドアウト開始タイミング
const fadeStartTime = 2000; // ms (現在値)

// 完全停止タイミング  
const fullStopTime = 2700; // ms (現在値)
```

### 計算式
```javascript
// サスティン時間 = フェイドアウト開始時間
sustain_duration = fadeStartTime;

// フェイドアウト時間 = 完全停止 - フェイドアウト開始
fadeout_duration = fullStopTime - fadeStartTime; // 0.7秒

// ガイド開始 = 基音総時間
guide_start = baseToneDuration; // 2.5秒
```

## 🎵 推奨値の範囲

| パラメータ | 最小値 | 推奨値 | 最大値 | 理由 |
|------------|--------|--------|--------|------|
| 総時間 | 1.5秒 | 2.5秒 | 4秒 | 音程認識 vs 待ち時間 |
| サスティン | 1秒 | 2秒 | 3秒 | 十分な聴取時間 |
| フェイドアウト | 0.3秒 | 0.5秒 | 1秒 | 自然な減衰感 |

## 📱 デバイス別考慮事項

### モバイル
- **短縮推奨**: 2秒総時間も検討可能
- **タップ応答性**: より短い待ち時間が好まれる

### デスクトップ
- **現在設定**: 2.5秒が最適
- **集中環境**: じっくり聞ける

## 🚀 将来の改善案

1. **ユーザー設定**: 再生時間をカスタマイズ可能に
2. **適応調整**: ユーザーの反応速度に応じて自動調整
3. **デバイス検出**: モバイル/デスクトップで自動切り替え
4. **A/Bテスト**: 複数設定での効果測定