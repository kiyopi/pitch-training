import{S as De,i as Te,d as j,s as ze,v as Ee,c as Se,a as Be,D as ie,b as f,q as W,r as X,u as Y,f as E,w as $,E as xe,m as I,x as ee,p as N,y as te,U as Ve,g as b,z as d,h as g,L as Ie,j as C,k as z,B as J,A as q,o as k,C as Z,n as ne,J as ae,N as de}from"../chunks/D-MQVlDL.js";import{g as Ne}from"../chunks/D0QH3NT1.js";import"../chunks/DEDhZaYq.js";import{p as se}from"../chunks/DIRTXL8N.js";import{b as fe,g as he}from"../chunks/Ce4bX9ZB.js";import{P as me,B as qe,C as pe}from"../chunks/BZyPgggR.js";import{a as K,V as je,P as ve,b as ge}from"../chunks/BUbiQ_O5.js";const Re=!1,Ke=Object.freeze(Object.defineProperty({__proto__:null,ssr:Re},Symbol.toStringTag,{value:"Module"})),{console:Ae}=Ne,_="src/routes/microphone-test/+page.svelte";function _e(r){let e,t="マイクのテストを開始します",a,o,c="マイクテスト開始ボタンを押してマイクの使用を許可してください",i,n;function s(v,h){if(v[0]==="pending")return ke;if(v[0]==="denied")return Ce;if(v[0]==="initial")return be}let u=s(r),m=u&&u(r);const y={c:function(){e=k("h3"),e.textContent=t,a=N(),o=k("p"),o.textContent=c,i=N(),m&&m.c(),n=de(),this.h()},l:function(h){e=C(h,"H3",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-gfi16f"&&(e.textContent=t),a=I(h),o=C(h,"P",{class:!0,"data-svelte-h":!0}),q(o)!=="svelte-1w19y1h"&&(o.textContent=c),i=I(h),m&&m.l(h),n=de(),this.h()},h:function(){d(e,"class","instructions-title svelte-1ny0zhn"),g(e,_,219,12,6547),d(o,"class","instructions-description svelte-1ny0zhn"),g(o,_,220,12,6609)},m:function(h,p){E(h,e,p),E(h,a,p),E(h,o,p),E(h,i,p),m&&m.m(h,p),E(h,n,p)},p:function(h,p){u===(u=s(h))&&m?m.p(h,p):(m&&m.d(1),m=u&&u(h),m&&(m.c(),m.m(n.parentNode,n)))},d:function(h){h&&(f(e),f(a),f(o),f(i),f(n)),m&&m.d(h)}};return j("SvelteRegisterBlock",{block:y,id:_e.name,type:"else",source:"(218:10) {:else}",ctx:r}),y}function ye(r){let e,t="マイク準備完了",a,o,c="トレーニングを開始してください",i,n,s,u="トレーニング開始",m,y;const v={c:function(){e=k("h3"),e.textContent=t,a=N(),o=k("p"),o.textContent=c,i=N(),n=k("div"),s=k("button"),s.textContent=u,this.h()},l:function(p){e=C(p,"H3",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-11dam81"&&(e.textContent=t),a=I(p),o=C(p,"P",{class:!0,"data-svelte-h":!0}),q(o)!=="svelte-fsj0o8"&&(o.textContent=c),i=I(p),n=C(p,"DIV",{class:!0});var M=z(n);s=C(M,"BUTTON",{class:!0,"data-svelte-h":!0}),q(s)!=="svelte-kae9rs"&&(s.textContent=u),M.forEach(f),this.h()},h:function(){d(e,"class","ready-title svelte-1ny0zhn"),g(e,_,209,12,6169),d(o,"class","ready-description svelte-1ny0zhn"),g(o,_,210,12,6218),d(s,"class","training-start-button enabled svelte-1ny0zhn"),g(s,_,213,14,6347),d(n,"class","training-start-button-area svelte-1ny0zhn"),g(n,_,212,12,6292)},m:function(p,M){E(p,e,M),E(p,a,M),E(p,o,M),E(p,i,M),E(p,n,M),b(n,s),m||(y=ae(s,"click",r[6],!1,!1,!1),m=!0)},p:ne,d:function(p){p&&(f(e),f(a),f(o),f(i),f(n)),m=!1,y()}};return j("SvelteRegisterBlock",{block:v,id:ye.name,type:"if",source:"(208:10) {#if micPermission === 'granted'}",ctx:r}),v}function be(r){let e,t,a="マイクテストを開始",o,c;const i={c:function(){e=k("div"),t=k("button"),t.textContent=a,this.h()},l:function(s){e=C(s,"DIV",{class:!0});var u=z(e);t=C(u,"BUTTON",{class:!0,"data-svelte-h":!0}),q(t)!=="svelte-caex95"&&(t.textContent=a),u.forEach(f),this.h()},h:function(){d(t,"class","mic-test-button start svelte-1ny0zhn"),g(t,_,232,16,7164),d(e,"class","mic-test-button-area svelte-1ny0zhn"),g(e,_,231,14,7113)},m:function(s,u){E(s,e,u),b(e,t),o||(c=ae(t,"click",r[5],!1,!1,!1),o=!0)},p:ne,d:function(s){s&&f(e),o=!1,c()}};return j("SvelteRegisterBlock",{block:i,id:be.name,type:"if",source:"(231:50) ",ctx:r}),i}function Ce(r){let e,t,a="マイク許可を再試行",o,c;const i={c:function(){e=k("div"),t=k("button"),t.textContent=a,this.h()},l:function(s){e=C(s,"DIV",{class:!0});var u=z(e);t=C(u,"BUTTON",{class:!0,"data-svelte-h":!0}),q(t)!=="svelte-1p3n8nt"&&(t.textContent=a),u.forEach(f),this.h()},h:function(){d(t,"class","mic-test-button retry svelte-1ny0zhn"),g(t,_,226,16,6905),d(e,"class","mic-test-button-area svelte-1ny0zhn"),g(e,_,225,14,6854)},m:function(s,u){E(s,e,u),b(e,t),o||(c=ae(t,"click",r[5],!1,!1,!1),o=!0)},p:ne,d:function(s){s&&f(e),o=!1,c()}};return j("SvelteRegisterBlock",{block:i,id:Ce.name,type:"if",source:"(225:49) ",ctx:r}),i}function ke(r){let e,t="マイク準備中...";const a={c:function(){e=k("p"),e.textContent=t,this.h()},l:function(c){e=C(c,"P",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-1vb5g92"&&(e.textContent=t),this.h()},h:function(){d(e,"class","status-text svelte-1ny0zhn"),g(e,_,223,14,6753)},m:function(c,i){E(c,e,i)},p:ne,d:function(c){c&&f(e)}};return j("SvelteRegisterBlock",{block:a,id:ke.name,type:"if",source:"(223:12) {#if micPermission === 'pending'}",ctx:r}),a}function Me(r){let e;function t(i,n){return i[0]==="granted"?ye:_e}let a=t(r),o=a(r);const c={c:function(){e=k("div"),o.c(),this.h()},l:function(n){e=C(n,"DIV",{class:!0});var s=z(e);o.l(s),s.forEach(f),this.h()},h:function(){d(e,"class","training-mode-content svelte-1ny0zhn"),g(e,_,206,8,6048)},m:function(n,s){E(n,e,s),o.m(e,null)},p:function(n,s){a===(a=t(n))&&o?o.p(n,s):(o.d(1),o=a(n),o&&(o.c(),o.m(e,null)))},d:function(n){n&&f(e),o.d()}};return j("SvelteRegisterBlock",{block:c,id:Me.name,type:"slot",source:'(206:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:r}),c}function Pe(r){let e,t,a,o,c,i,n,s,u,m,y,v,h="マイクテスト",p,M,O="音感トレーニングを始める前に、マイクの動作を確認します",U,B,S,F,x,l,w,T,R;S=new pe({props:{variant:"default",padding:"lg",$$slots:{default:[Me]},$$scope:{ctx:r}},$$inline:!0}),x=new ve({props:{frequency:r[2],note:r[3],volume:r[1],isMuted:r[0]!=="granted",muteMessage:"マイク許可後に開始"},$$inline:!0});let re={isActive:r[0]==="granted",className:"pitch-detector-content",debugMode:!1};T=new ge({props:re,$$inline:!0}),r[9](T),T.$on("pitchUpdate",r[7]),T.$on("stateChange",we),T.$on("error",r[8]);const oe={c:function(){e=k("div"),t=k("div"),a=k("div"),o=k("div"),c=Z("svg"),i=Z("path"),n=Z("path"),s=Z("line"),u=Z("line"),m=N(),y=k("div"),v=k("h1"),v.textContent=h,p=N(),M=k("p"),M.textContent=O,U=N(),B=k("div"),te(S.$$.fragment),F=N(),te(x.$$.fragment),l=N(),w=k("div"),te(T.$$.fragment),this.h()},l:function(P){e=C(P,"DIV",{class:!0});var D=z(e);t=C(D,"DIV",{class:!0});var H=z(t);a=C(H,"DIV",{class:!0});var V=z(a);o=C(V,"DIV",{class:!0});var L=z(o);c=J(L,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var G=z(c);i=J(G,"path",{d:!0}),z(i).forEach(f),n=J(G,"path",{d:!0}),z(n).forEach(f),s=J(G,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),z(s).forEach(f),u=J(G,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),z(u).forEach(f),G.forEach(f),L.forEach(f),m=I(V),y=C(V,"DIV",{});var Q=z(y);v=C(Q,"H1",{class:!0,"data-svelte-h":!0}),q(v)!=="svelte-z7m4lk"&&(v.textContent=h),p=I(Q),M=C(Q,"P",{class:!0,"data-svelte-h":!0}),q(M)!=="svelte-1vtv92f"&&(M.textContent=O),Q.forEach(f),V.forEach(f),H.forEach(f),U=I(D),B=C(D,"DIV",{class:!0});var le=z(B);ee(S.$$.fragment,le),le.forEach(f),F=I(D),ee(x.$$.fragment,D),l=I(D),w=C(D,"DIV",{style:!0});var ue=z(w);ee(T.$$.fragment,ue),ue.forEach(f),D.forEach(f),this.h()},h:function(){d(i,"d","M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"),g(i,_,190,12,5506),d(n,"d","M19 10v2a7 7 0 0 1-14 0v-2"),g(n,_,191,12,5583),d(s,"x1","12"),d(s,"x2","12"),d(s,"y1","19"),d(s,"y2","22"),g(s,_,192,12,5634),d(u,"x1","8"),d(u,"x2","16"),d(u,"y1","22"),d(u,"y2","22"),g(u,_,193,12,5686),d(c,"width","48"),d(c,"height","48"),d(c,"viewBox","0 0 24 24"),d(c,"fill","none"),d(c,"stroke","currentColor"),d(c,"stroke-width","2"),g(c,_,189,10,5394),d(o,"class","mic-icon svelte-1ny0zhn"),g(o,_,188,8,5361),d(v,"class","mic-test-title svelte-1ny0zhn"),g(v,_,197,10,5781),d(M,"class","mic-test-description svelte-1ny0zhn"),g(M,_,198,10,5830),g(y,_,196,8,5765),d(a,"class","mic-test-header svelte-1ny0zhn"),g(a,_,187,6,5323),d(t,"class","header svelte-1ny0zhn"),g(t,_,186,4,5296),d(B,"class","training-mode-info svelte-1ny0zhn"),g(B,_,204,4,5963),Ie(w,"display","none"),g(w,_,252,4,7668),d(e,"class","microphone-test svelte-1ny0zhn"),g(e,_,184,2,5244)},m:function(P,D){E(P,e,D),b(e,t),b(t,a),b(a,o),b(o,c),b(c,i),b(c,n),b(c,s),b(c,u),b(a,m),b(a,y),b(y,v),b(y,p),b(y,M),b(e,U),b(e,B),$(S,B,null),b(e,F),$(x,e,null),b(e,l),b(e,w),$(T,w,null),R=!0},p:function(P,D){const H={};D&65537&&(H.$$scope={dirty:D,ctx:P}),S.$set(H);const V={};D&4&&(V.frequency=P[2]),D&8&&(V.note=P[3]),D&2&&(V.volume=P[1]),D&1&&(V.isMuted=P[0]!=="granted"),x.$set(V);const L={};D&1&&(L.isActive=P[0]==="granted"),T.$set(L)},i:function(P){R||(Y(S.$$.fragment,P),Y(x.$$.fragment,P),Y(T.$$.fragment,P),R=!0)},o:function(P){X(S.$$.fragment,P),X(x.$$.fragment,P),X(T.$$.fragment,P),R=!1},d:function(P){P&&f(e),W(S),W(x),r[9](null),W(T)}};return j("SvelteRegisterBlock",{block:oe,id:Pe.name,type:"slot",source:"(184:0) <PageLayout showBackButton={true}>",ctx:r}),oe}function ce(r){let e,t,a;t=new me({props:{showBackButton:!0,$$slots:{default:[Pe]},$$scope:{ctx:r}},$$inline:!0});const o={c:function(){e=N(),te(t.$$.fragment),this.h()},l:function(i){xe("svelte-8st1fo",document.head).forEach(f),e=I(i),ee(t.$$.fragment,i),this.h()},h:function(){document.title="マイクテスト - 相対音感トレーニング"},m:function(i,n){E(i,e,n),$(t,i,n),a=!0},p:function(i,[n]){const s={};n&65567&&(s.$$scope={dirty:n,ctx:i}),t.$set(s)},i:function(i){a||(Y(t.$$.fragment,i),a=!0)},o:function(i){X(t.$$.fragment,i),a=!1},d:function(i){i&&f(e),W(t,i)}};return j("SvelteRegisterBlock",{block:o,id:ce.name,type:"component",source:"",ctx:r}),o}function we(r){}function Ue(r,e,t){let a;Ee(se,"page"),Se(r,se,l=>t(12,a=l));let{$$slots:o={},$$scope:c}=e;Be("Page",o,[]);let i="random";ie(()=>{a.url.searchParams.has("mode")&&(i=a.url.searchParams.get("mode")||"random")});let n="initial",s=0,u=0,m="ーー",y=null,v=null;ie(()=>{v=K.getPlatformSpecs()});const h={random:{name:"ランダム基音モード",description:"10種類の基音からランダムに選択してトレーニング",color:"green",path:"/training/random"},continuous:{name:"連続チャレンジモード",description:"選択した回数だけ連続で実行し、総合評価を確認",color:"orange",path:"/training/continuous"},chromatic:{name:"12音階モード",description:"クロマチックスケールの上行・下行で完全制覇",color:"purple",path:"/training/chromatic"}},p=h[i]||h.random;async function M(){var l;t(0,n="pending");try{if(console.log("🎤 [MicTest] マイク許可リクエスト開始"),!((l=navigator.mediaDevices)!=null&&l.getUserMedia)){t(0,n="denied"),console.error("❌ [MicTest] getUserMediaがサポートされていません");return}const w=await K.initialize();if(console.log("✅ [MicTest] AudioManager リソース取得完了"),w.mediaStream&&w.audioContext)t(0,n="granted"),console.log("✅ [MicTest] マイク許可完了"),await S(),setTimeout(async()=>{y&&(console.log("🎙️ [MicTest] PitchDetector初期化開始"),await y.initialize(),console.log("✅ [MicTest] PitchDetector初期化完了"),console.log("🎯 [MicTest] PitchDetector isActiveリアクティブで自動検出開始"))},1e3);else throw new Error("リソース取得失敗")}catch(w){console.error("❌ [MicTest] マイク許可エラー:",w),t(0,n=((w==null?void 0:w.name)==="NotAllowedError","denied"))}}function O(){console.log("🚀 [MicTest] トレーニング開始 - ランダム基音モードへ遷移"),localStorage.setItem("mic-test-completed","true"),console.log("✅ [MicTest] マイクテスト完了フラグを保存"),he(`${fe}${p.path}?from=microphone-test`)}function U(l){const{frequency:w,note:T,volume:R,rawVolume:re,clarity:oe}=l.detail;t(2,u=w),t(3,m=T),t(1,s=R)}function B(l){console.error("❌ [MicTest] PitchDetectorエラー:",l.detail);const{error:w,reason:T,recovery:R}=l.detail;T==="mediastream_ended"&&R==="restart_required"&&(console.log("🔄 [MicTest] MediaStream終了検出 - 自動復旧開始"),t(0,n="initial"),t(1,s=0),t(2,u=0),t(3,m="ーー"),console.log("⚠️ [MicTest] マイク再許可が必要です"))}async function S(){if(v&&v.deviceType==="iPad"){console.log("🔧 [MicTest] iPad検出 - マイク感度7.0x自動設定開始"),K.setSensitivity(7),console.log("✅ [MicTest] iPad マイク感度7.0x自動設定完了");try{await K.initialize(),console.log("🔄 [MicTest] iPad用AudioManager再初期化完了")}catch(l){console.warn("⚠️ [MicTest] AudioManager再初期化エラー:",l)}}}const F=[];Object.keys(e).forEach(l=>{!~F.indexOf(l)&&l.slice(0,2)!=="$$"&&l!=="slot"&&Ae.warn(`<Page> was created with unknown prop '${l}'`)});function x(l){Ve[l?"unshift":"push"](()=>{y=l,t(4,y)})}return r.$capture_state=()=>({onMount:ie,page:se,goto:he,base:fe,Card:pe,Button:qe,PageLayout:me,PitchDetector:ge,PitchDetectionDisplay:ve,VolumeBar:je,audioManager:K,mode:i,micPermission:n,currentVolume:s,currentFrequency:u,detectedNote:m,pitchDetectorComponent:y,platformSpecs:v,trainingModes:h,selectedMode:p,requestMicrophone:M,startTraining:O,handlePitchUpdate:U,handlePitchDetectorStateChange:we,handlePitchDetectorError:B,onMicrophoneGranted:S,$page:a}),r.$inject_state=l=>{"mode"in l&&(i=l.mode),"micPermission"in l&&t(0,n=l.micPermission),"currentVolume"in l&&t(1,s=l.currentVolume),"currentFrequency"in l&&t(2,u=l.currentFrequency),"detectedNote"in l&&t(3,m=l.detectedNote),"pitchDetectorComponent"in l&&t(4,y=l.pitchDetectorComponent),"platformSpecs"in l&&(v=l.platformSpecs)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),[n,s,u,m,y,M,O,U,B,x]}class Qe extends De{constructor(e){super(e),Te(this,e,Ue,ce,ze,{}),j("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:ce.name})}}export{Qe as component,Ke as universal};
