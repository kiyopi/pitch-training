import{S as Ne,i as ze,d as G,s as Le,v as He,c as je,a as Ue,D as _e,E as ye,b as d,q as ie,r as le,u as oe,f as z,w as ae,F as Ge,m as L,x as re,p as H,y as ce,g as c,z as f,h as v,j as p,k as A,B as ne,A as Q,o as g,C as se,G as pe,e as te,l as J,t as Z,n as fe,H as ge,I as ve}from"../chunks/D8aoWfRe.js";import"../chunks/BXq3pflB.js";import{p as de}from"../chunks/DAFYZ5vk.js";import{P as be,B as Oe,C as ue}from"../chunks/Cs3yrXb8.js";const _="src/routes/microphone-test/+page.svelte";function De(r){let e,t="マイク準備完了",i,n,o="トレーニング開始ボタンを押してランダム基音モードへ進んでください",a,s,l,m="トレーニング開始",C,h;const b={c:function(){e=g("h3"),e.textContent=t,i=H(),n=g("p"),n.textContent=o,a=H(),s=g("div"),l=g("button"),l.textContent=m,this.h()},l:function(E){e=p(E,"H3",{class:!0,"data-svelte-h":!0}),Q(e)!=="svelte-11dam81"&&(e.textContent=t),i=L(E),n=p(E,"P",{class:!0,"data-svelte-h":!0}),Q(n)!=="svelte-5idwhi"&&(n.textContent=o),a=L(E),s=p(E,"DIV",{class:!0});var k=A(s);l=p(k,"BUTTON",{class:!0,"data-svelte-h":!0}),Q(l)!=="svelte-1oiqs6i"&&(l.textContent=m),k.forEach(d),this.h()},h:function(){f(e,"class","ready-title svelte-19mrh3"),v(e,_,333,12,10531),f(n,"class","ready-description svelte-19mrh3"),v(n,_,334,12,10580),f(l,"class","training-start-button enabled svelte-19mrh3"),v(l,_,337,14,10726),f(s,"class","training-start-button-area svelte-19mrh3"),v(s,_,336,12,10671)},m:function(E,k){z(E,e,k),z(E,i,k),z(E,n,k),z(E,a,k),z(E,s,k),c(s,l),C||(h=ve(l,"click",r[13],!1),C=!0)},p:fe,d:function(E){E&&(d(e),d(i),d(n),d(a),d(s)),C=!1,h()}};return G("SvelteRegisterBlock",{block:b,id:De.name,type:"else",source:"(332:10) {:else}",ctx:r}),b}function we(r){let e,t;function i(C,h){return C[3]==="granted"&&C[4]&&(!C[0]||!C[1])?Ve:Ee}let n=i(r),o=n(r);function a(C,h){if(C[3]==="pending")return Se;if(C[3]==="denied")return Be;if(C[3]==="initial")return Ae}let s=a(r),l=s&&s(r);const m={c:function(){o.c(),e=H(),l&&l.c(),t=ge()},l:function(h){o.l(h),e=L(h),l&&l.l(h),t=ge()},m:function(h,b){o.m(h,b),z(h,e,b),l&&l.m(h,b),z(h,t,b)},p:function(h,b){n!==(n=i(h))&&(o.d(1),o=n(h),o&&(o.c(),o.m(e.parentNode,e))),s===(s=a(h))&&l?l.p(h,b):(l&&l.d(1),l=s&&s(h),l&&(l.c(),l.m(t.parentNode,t)))},d:function(h){h&&(d(e),d(t)),o.d(h),l&&l.d(h)}};return G("SvelteRegisterBlock",{block:m,id:we.name,type:"if",source:"(306:10) {#if !audioConfirmationComplete}",ctx:r}),m}function Ee(r){let e,t="マイクのテストを開始します",i,n,o="マイクテスト開始ボタンを押してマイクの使用を許可してください";const a={c:function(){e=g("h3"),e.textContent=t,i=H(),n=g("p"),n.textContent=o,this.h()},l:function(l){e=p(l,"H3",{class:!0,"data-svelte-h":!0}),Q(e)!=="svelte-gfi16f"&&(e.textContent=t),i=L(l),n=p(l,"P",{class:!0,"data-svelte-h":!0}),Q(n)!=="svelte-1w19y1h"&&(n.textContent=o),this.h()},h:function(){f(e,"class","instructions-title svelte-19mrh3"),v(e,_,312,14,9668),f(n,"class","instructions-description svelte-19mrh3"),v(n,_,313,14,9732)},m:function(l,m){z(l,e,m),z(l,i,m),z(l,n,m)},d:function(l){l&&(d(e),d(i),d(n))}};return G("SvelteRegisterBlock",{block:a,id:Ee.name,type:"else",source:"(311:12) {:else}",ctx:r}),a}function Ve(r){let e,t="「ドー」と発声してください";const i={c:function(){e=g("p"),e.textContent=t,this.h()},l:function(o){e=p(o,"P",{class:!0,"data-svelte-h":!0}),Q(e)!=="svelte-15d2sx7"&&(e.textContent=t),this.h()},h:function(){f(e,"class","status-text voice-instruction svelte-19mrh3"),v(e,_,309,14,9540)},m:function(o,a){z(o,e,a)},d:function(o){o&&d(e)}};return G("SvelteRegisterBlock",{block:i,id:Ve.name,type:"if",source:"(308:12) {#if micPermission === 'granted' && isListening && (!volumeDetected || !frequencyDetected)}",ctx:r}),i}function Ae(r){let e,t,i="マイクテストを開始",n,o;const a={c:function(){e=g("div"),t=g("button"),t.textContent=i,this.h()},l:function(l){e=p(l,"DIV",{class:!0});var m=A(e);t=p(m,"BUTTON",{class:!0,"data-svelte-h":!0}),Q(t)!=="svelte-caex95"&&(t.textContent=i),m.forEach(d),this.h()},h:function(){f(t,"class","mic-test-button start svelte-19mrh3"),v(t,_,326,16,10305),f(e,"class","mic-test-button-area svelte-19mrh3"),v(e,_,325,14,10254)},m:function(l,m){z(l,e,m),c(e,t),n||(o=ve(t,"click",r[12],!1),n=!0)},p:fe,d:function(l){l&&d(e),n=!1,o()}};return G("SvelteRegisterBlock",{block:a,id:Ae.name,type:"if",source:"(325:50) ",ctx:r}),a}function Be(r){let e,t,i="マイク許可を再試行",n,o;const a={c:function(){e=g("div"),t=g("button"),t.textContent=i,this.h()},l:function(l){e=p(l,"DIV",{class:!0});var m=A(e);t=p(m,"BUTTON",{class:!0,"data-svelte-h":!0}),Q(t)!=="svelte-1p3n8nt"&&(t.textContent=i),m.forEach(d),this.h()},h:function(){f(t,"class","mic-test-button retry svelte-19mrh3"),v(t,_,320,16,10046),f(e,"class","mic-test-button-area svelte-19mrh3"),v(e,_,319,14,9995)},m:function(l,m){z(l,e,m),c(e,t),n||(o=ve(t,"click",r[12],!1),n=!0)},p:fe,d:function(l){l&&d(e),n=!1,o()}};return G("SvelteRegisterBlock",{block:a,id:Be.name,type:"if",source:"(319:49) ",ctx:r}),a}function Se(r){let e,t="マイク準備中...";const i={c:function(){e=g("p"),e.textContent=t,this.h()},l:function(o){e=p(o,"P",{class:!0,"data-svelte-h":!0}),Q(e)!=="svelte-1vb5g92"&&(e.textContent=t),this.h()},h:function(){f(e,"class","status-text svelte-19mrh3"),v(e,_,317,14,9894)},m:function(o,a){z(o,e,a)},p:fe,d:function(o){o&&d(e)}};return G("SvelteRegisterBlock",{block:i,id:Se.name,type:"if",source:"(317:12) {#if micPermission === 'pending'}",ctx:r}),i}function qe(r){let e;function t(a,s){return a[2]?De:we}let i=t(r),n=i(r);const o={c:function(){e=g("div"),n.c(),this.h()},l:function(s){e=p(s,"DIV",{class:!0});var l=A(e);n.l(l),l.forEach(d),this.h()},h:function(){f(e,"class","training-mode-content svelte-19mrh3"),v(e,_,304,8,9275)},m:function(s,l){z(s,e,l),n.m(e,null)},p:function(s,l){i===(i=t(s))&&n?n.p(s,l):(n.d(1),n=i(s),n&&(n.c(),n.m(e,null)))},d:function(s){s&&d(e),n.d()}};return G("SvelteRegisterBlock",{block:o,id:qe.name,type:"slot",source:'(304:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:r}),o}function me(r){let e,t,i,n,o="フィルター前:",a,s,l=r[8].toFixed(1)+"",m,C,h,b,F,E="フィルター後:",k,x,B=r[9].toFixed(1)+"",V,D,S,y,w,q="ノイズ削減:",P,I,O,j;const T={c:function(){e=g("div"),t=g("div"),i=g("div"),n=g("span"),n.textContent=o,a=H(),s=g("span"),m=Z(l),C=Z("%"),h=H(),b=g("div"),F=g("span"),F.textContent=E,k=H(),x=g("span"),V=Z(B),D=Z("%"),S=H(),y=g("div"),w=g("span"),w.textContent=q,P=H(),I=g("span"),O=Z(r[10]),j=Z("%"),this.h()},l:function(u){e=p(u,"DIV",{class:!0});var R=A(e);t=p(R,"DIV",{class:!0});var N=A(t);i=p(N,"DIV",{class:!0});var U=A(i);n=p(U,"SPAN",{class:!0,"data-svelte-h":!0}),Q(n)!=="svelte-1nh45c7"&&(n.textContent=o),a=L(U),s=p(U,"SPAN",{class:!0});var K=A(s);m=J(K,l),C=J(K,"%"),K.forEach(d),U.forEach(d),h=L(N),b=p(N,"DIV",{class:!0});var W=A(b);F=p(W,"SPAN",{class:!0,"data-svelte-h":!0}),Q(F)!=="svelte-fz1u1y"&&(F.textContent=E),k=L(W),x=p(W,"SPAN",{class:!0});var X=A(x);V=J(X,B),D=J(X,"%"),X.forEach(d),W.forEach(d),S=L(N),y=p(N,"DIV",{class:!0});var ee=A(y);w=p(ee,"SPAN",{class:!0,"data-svelte-h":!0}),Q(w)!=="svelte-3jbm0v"&&(w.textContent=q),P=L(ee),I=p(ee,"SPAN",{class:!0});var $=A(I);O=J($,r[10]),j=J($,"%"),$.forEach(d),ee.forEach(d),N.forEach(d),R.forEach(d),this.h()},h:function(){f(n,"class","stat-label svelte-19mrh3"),v(n,_,363,20,11646),f(s,"class","stat-value raw svelte-19mrh3"),v(s,_,364,20,11706),f(i,"class","stat-item svelte-19mrh3"),v(i,_,362,18,11602),f(F,"class","stat-label svelte-19mrh3"),v(F,_,367,20,11853),f(x,"class","stat-value filtered svelte-19mrh3"),v(x,_,368,20,11913),f(b,"class","stat-item svelte-19mrh3"),v(b,_,366,18,11809),f(w,"class","stat-label svelte-19mrh3"),v(w,_,371,20,12070),f(I,"class","stat-value reduction svelte-19mrh3"),v(I,_,372,20,12129),f(y,"class","stat-item svelte-19mrh3"),v(y,_,370,18,12026),f(t,"class","noise-stats svelte-19mrh3"),v(t,_,361,16,11558),f(e,"class","noise-reduction-info svelte-19mrh3"),v(e,_,360,14,11507)},m:function(u,R){z(u,e,R),c(e,t),c(t,i),c(i,n),c(i,a),c(i,s),c(s,m),c(s,C),c(t,h),c(t,b),c(b,F),c(b,k),c(b,x),c(x,V),c(x,D),c(t,S),c(t,y),c(y,w),c(y,P),c(y,I),c(I,O),c(I,j)},p:function(u,R){R&256&&l!==(l=u[8].toFixed(1)+"")&&te(m,l),R&512&&B!==(B=u[9].toFixed(1)+"")&&te(V,B),R&1024&&te(O,u[10])},d:function(u){u&&d(e)}};return G("SvelteRegisterBlock",{block:T,id:me.name,type:"if",source:"(360:12) {#if isListening}",ctx:r}),T}function Fe(r){let e;const t={c:function(){e=Z(" ")},l:function(n){e=J(n," ")},m:function(n,o){z(n,e,o)},d:function(n){n&&d(e)}};return G("SvelteRegisterBlock",{block:t,id:Fe.name,type:"else",source:"(383:16) {:else}",ctx:r}),t}function xe(r){let e;const t={c:function(){e=Z("⏳ 声を出して音量を確認してください")},l:function(n){e=J(n,"⏳ 声を出して音量を確認してください")},m:function(n,o){z(n,e,o)},d:function(n){n&&d(e)}};return G("SvelteRegisterBlock",{block:t,id:xe.name,type:"if",source:"(381:16) {#if !volumeDetected && isListening}",ctx:r}),t}function Pe(r){let e,t,i,n="音量レベル",o,a,s,l,m,C=r[5].toFixed(1)+"",h,b,F,E,k,x,B=r[4]&&me(r);function V(w,q){return!w[0]&&w[4]?xe:Fe}let D=V(r),S=D(r);const y={c:function(){e=g("div"),t=g("div"),i=g("h3"),i.textContent=n,o=H(),a=g("div"),s=g("div"),l=H(),m=g("div"),h=Z(C),b=Z("%"),F=H(),B&&B.c(),E=H(),k=g("div"),x=g("span"),S.c(),this.h()},l:function(q){e=p(q,"DIV",{class:!0});var P=A(e);t=p(P,"DIV",{class:!0});var I=A(t);i=p(I,"H3",{class:!0,"data-svelte-h":!0}),Q(i)!=="svelte-1nc8gri"&&(i.textContent=n),o=L(I),a=p(I,"DIV",{class:!0});var O=A(a);s=p(O,"DIV",{class:!0,style:!0}),A(s).forEach(d),O.forEach(d),l=L(I),m=p(I,"DIV",{class:!0});var j=A(m);h=J(j,C),b=J(j,"%"),j.forEach(d),F=L(I),B&&B.l(I),E=L(I),k=p(I,"DIV",{class:!0});var T=A(k);x=p(T,"SPAN",{class:!0});var M=A(x);S.l(M),M.forEach(d),T.forEach(d),I.forEach(d),P.forEach(d),this.h()},h:function(){f(i,"class","display-title svelte-19mrh3"),v(i,_,352,12,11164),f(s,"class","volume-bar svelte-19mrh3"),pe(s,"width",r[5]+"%"),v(s,_,354,14,11262),f(a,"class","volume-bar-container svelte-19mrh3"),v(a,_,353,12,11213),f(m,"class","volume-text svelte-19mrh3"),v(m,_,356,12,11356),f(x,"class","status-pending svelte-19mrh3"),v(x,_,379,14,12343),f(k,"class","volume-status svelte-19mrh3"),v(k,_,378,12,12301),f(t,"class","volume-section svelte-19mrh3"),v(t,_,351,10,11123),f(e,"class","card-inner svelte-19mrh3"),v(e,_,350,8,11088)},m:function(q,P){z(q,e,P),c(e,t),c(t,i),c(t,o),c(t,a),c(a,s),c(t,l),c(t,m),c(m,h),c(m,b),c(t,F),B&&B.m(t,null),c(t,E),c(t,k),c(k,x),S.m(x,null)},p:function(q,P){P&32&&pe(s,"width",q[5]+"%"),P&32&&C!==(C=q[5].toFixed(1)+"")&&te(h,C),q[4]?B?B.p(q,P):(B=me(q),B.c(),B.m(t,E)):B&&(B.d(1),B=null),D!==(D=V(q))&&(S.d(1),S=D(q),S&&(S.c(),S.m(x,null)))},d:function(q){q&&d(e),B&&B.d(),S.d()}};return G("SvelteRegisterBlock",{block:y,id:Pe.name,type:"slot",source:'(350:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:r}),y}function Ie(r){let e;const t={c:function(){e=Z(" ")},l:function(n){e=J(n," ")},m:function(n,o){z(n,e,o)},d:function(n){n&&d(e)}};return G("SvelteRegisterBlock",{block:t,id:Ie.name,type:"else",source:"(405:16) {:else}",ctx:r}),t}function Te(r){let e;const t={c:function(){e=Z("⏳ 「ド」を発声して音程を確認してください")},l:function(n){e=J(n,"⏳ 「ド」を発声して音程を確認してください")},m:function(n,o){z(n,e,o)},d:function(n){n&&d(e)}};return G("SvelteRegisterBlock",{block:t,id:Te.name,type:"if",source:"(403:16) {#if !frequencyDetected && isListening}",ctx:r}),t}function Re(r){let e,t,i,n="音程検出",o,a,s,l=r[6]>0?r[6].toFixed(1)+" Hz":"ーー",m,C,h,b,F,E,k;function x(S,y){return!S[1]&&S[4]?Te:Ie}let B=x(r),V=B(r);const D={c:function(){e=g("div"),t=g("div"),i=g("h3"),i.textContent=n,o=H(),a=g("div"),s=g("div"),m=Z(l),C=H(),h=g("div"),b=Z(r[7]),F=H(),E=g("div"),k=g("span"),V.c(),this.h()},l:function(y){e=p(y,"DIV",{class:!0});var w=A(e);t=p(w,"DIV",{class:!0});var q=A(t);i=p(q,"H3",{class:!0,"data-svelte-h":!0}),Q(i)!=="svelte-1ofzoy2"&&(i.textContent=n),o=L(q),a=p(q,"DIV",{class:!0});var P=A(a);s=p(P,"DIV",{class:!0});var I=A(s);m=J(I,l),I.forEach(d),C=L(P),h=p(P,"DIV",{class:!0});var O=A(h);b=J(O,r[7]),O.forEach(d),P.forEach(d),F=L(q),E=p(q,"DIV",{class:!0});var j=A(E);k=p(j,"SPAN",{class:!0});var T=A(k);V.l(T),T.forEach(d),j.forEach(d),q.forEach(d),w.forEach(d),this.h()},h:function(){f(i,"class","display-title svelte-19mrh3"),v(i,_,395,12,12776),f(s,"class","frequency-value svelte-19mrh3"),v(s,_,397,14,12870),f(h,"class","note-value svelte-19mrh3"),v(h,_,398,14,12987),f(a,"class","frequency-display svelte-19mrh3"),v(a,_,396,12,12824),f(k,"class","status-pending svelte-19mrh3"),v(k,_,401,14,13107),f(E,"class","frequency-status svelte-19mrh3"),v(E,_,400,12,13062),f(t,"class","frequency-section svelte-19mrh3"),v(t,_,394,10,12732),f(e,"class","card-inner svelte-19mrh3"),v(e,_,393,8,12697)},m:function(y,w){z(y,e,w),c(e,t),c(t,i),c(t,o),c(t,a),c(a,s),c(s,m),c(a,C),c(a,h),c(h,b),c(t,F),c(t,E),c(E,k),V.m(k,null)},p:function(y,w){w&64&&l!==(l=y[6]>0?y[6].toFixed(1)+" Hz":"ーー")&&te(m,l),w&128&&te(b,y[7]),B!==(B=x(y))&&(V.d(1),V=B(y),V&&(V.c(),V.m(k,null)))},d:function(y){y&&d(e),V.d()}};return G("SvelteRegisterBlock",{block:D,id:Re.name,type:"slot",source:'(393:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:r}),D}function Me(r){let e,t,i,n,o,a,s,l,m,C,h,b,F="マイクテスト",E,k,x="音感トレーニングを始める前に、マイクの動作を確認します",B,V,D,S,y,w,q,P,I;D=new ue({props:{variant:"default",padding:"lg",$$slots:{default:[qe]},$$scope:{ctx:r}},$$inline:!0}),w=new ue({props:{variant:"default",padding:"lg",$$slots:{default:[Pe]},$$scope:{ctx:r}},$$inline:!0}),P=new ue({props:{variant:"default",padding:"lg",$$slots:{default:[Re]},$$scope:{ctx:r}},$$inline:!0});const O={c:function(){e=g("div"),t=g("div"),i=g("div"),n=g("div"),o=se("svg"),a=se("path"),s=se("path"),l=se("line"),m=se("line"),C=H(),h=g("div"),b=g("h1"),b.textContent=F,E=H(),k=g("p"),k.textContent=x,B=H(),V=g("div"),ce(D.$$.fragment),S=H(),y=g("div"),ce(w.$$.fragment),q=H(),ce(P.$$.fragment),this.h()},l:function(T){e=p(T,"DIV",{class:!0});var M=A(e);t=p(M,"DIV",{class:!0});var u=A(t);i=p(u,"DIV",{class:!0});var R=A(i);n=p(R,"DIV",{class:!0});var N=A(n);o=ne(N,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var U=A(o);a=ne(U,"path",{d:!0}),A(a).forEach(d),s=ne(U,"path",{d:!0}),A(s).forEach(d),l=ne(U,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),A(l).forEach(d),m=ne(U,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),A(m).forEach(d),U.forEach(d),N.forEach(d),C=L(R),h=p(R,"DIV",{});var K=A(h);b=p(K,"H1",{class:!0,"data-svelte-h":!0}),Q(b)!=="svelte-z7m4lk"&&(b.textContent=F),E=L(K),k=p(K,"P",{class:!0,"data-svelte-h":!0}),Q(k)!=="svelte-1vtv92f"&&(k.textContent=x),K.forEach(d),R.forEach(d),u.forEach(d),B=L(M),V=p(M,"DIV",{class:!0});var W=A(V);re(D.$$.fragment,W),W.forEach(d),S=L(M),y=p(M,"DIV",{class:!0});var X=A(y);re(w.$$.fragment,X),q=L(X),re(P.$$.fragment,X),X.forEach(d),M.forEach(d),this.h()},h:function(){f(a,"d","M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"),v(a,_,288,12,8733),f(s,"d","M19 10v2a7 7 0 0 1-14 0v-2"),v(s,_,289,12,8810),f(l,"x1","12"),f(l,"x2","12"),f(l,"y1","19"),f(l,"y2","22"),v(l,_,290,12,8861),f(m,"x1","8"),f(m,"x2","16"),f(m,"y1","22"),f(m,"y2","22"),v(m,_,291,12,8913),f(o,"width","48"),f(o,"height","48"),f(o,"viewBox","0 0 24 24"),f(o,"fill","none"),f(o,"stroke","currentColor"),f(o,"stroke-width","2"),v(o,_,287,10,8621),f(n,"class","mic-icon svelte-19mrh3"),v(n,_,286,8,8588),f(b,"class","mic-test-title svelte-19mrh3"),v(b,_,295,10,9008),f(k,"class","mic-test-description svelte-19mrh3"),v(k,_,296,10,9057),v(h,_,294,8,8992),f(i,"class","mic-test-header svelte-19mrh3"),v(i,_,285,6,8550),f(t,"class","header svelte-19mrh3"),v(t,_,284,4,8523),f(V,"class","training-mode-info svelte-19mrh3"),v(V,_,302,4,9190),f(y,"class","test-section svelte-19mrh3"),v(y,_,347,4,10985),f(e,"class","microphone-test svelte-19mrh3"),v(e,_,282,2,8471)},m:function(T,M){z(T,e,M),c(e,t),c(t,i),c(i,n),c(n,o),c(o,a),c(o,s),c(o,l),c(o,m),c(i,C),c(i,h),c(h,b),c(h,E),c(h,k),c(e,B),c(e,V),ae(D,V,null),c(e,S),c(e,y),ae(w,y,null),c(y,q),ae(P,y,null),I=!0},p:function(T,M){const u={};M&16777247&&(u.$$scope={dirty:M,ctx:T}),D.$set(u);const R={};M&16779057&&(R.$$scope={dirty:M,ctx:T}),w.$set(R);const N={};M&16777426&&(N.$$scope={dirty:M,ctx:T}),P.$set(N)},i:function(T){I||(oe(D.$$.fragment,T),oe(w.$$.fragment,T),oe(P.$$.fragment,T),I=!0)},o:function(T){le(D.$$.fragment,T),le(w.$$.fragment,T),le(P.$$.fragment,T),I=!1},d:function(T){T&&d(e),ie(D),ie(w),ie(P)}};return G("SvelteRegisterBlock",{block:O,id:Me.name,type:"slot",source:"(282:0) <PageLayout showBackButton={true}>",ctx:r}),O}function he(r){let e,t,i;t=new be({props:{showBackButton:!0,$$slots:{default:[Me]},$$scope:{ctx:r}},$$inline:!0});const n={c:function(){e=H(),ce(t.$$.fragment),this.h()},l:function(a){Ge("svelte-8st1fo",document.head).forEach(d),e=L(a),re(t.$$.fragment,a),this.h()},h:function(){document.title="マイクテスト - 相対音感トレーニング"},m:function(a,s){z(a,e,s),ae(t,a,s),i=!0},p:function(a,[s]){const l={};s&16779263&&(l.$$scope={dirty:s,ctx:a}),t.$set(l)},i:function(a){i||(oe(t.$$.fragment,a),i=!0)},o:function(a){le(t.$$.fragment,a),i=!1},d:function(a){a&&d(e),ie(t,a)}};return G("SvelteRegisterBlock",{block:n,id:he.name,type:"component",source:"",ctx:r}),n}function Ce(r,e){let t=0;for(let s=0;s<r.length;s++)t+=r[s]*r[s];if(t=Math.sqrt(t/r.length),t<.005)return 0;const i=Math.floor(e/800),n=Math.floor(e/80);let o=0,a=0;for(let s=i;s<=n;s++){let l=0,m=0;for(let C=0;C<r.length-s;C++)l+=r[C]*r[C+s],m+=r[C]*r[C];m>0&&(l=l/Math.sqrt(m),l>o&&(o=l,a=s))}return o>.25?e/a:0}function ke(r){const t=Math.round(12*Math.log2(r/440)),i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=((t+9)%12+12)%12,o=Math.floor((t+9)/12)+4,a=i[n];return`${a}${o}（${{C:"ド","C#":"ド#",D:"レ","D#":"レ#",E:"ミ",F:"ファ","F#":"ファ#",G:"ソ","G#":"ソ#",A:"ラ","A#":"ラ#",B:"シ"}[a]}${o}）`}function Qe(r,e,t){let i;He(de,"page"),je(r,de,u=>t(20,i=u));let{$$slots:n={},$$scope:o}=e;Ue("Page",n,[]);let a="random";_e(()=>{i.url.searchParams.has("mode")&&(a=i.url.searchParams.get("mode")||"random")});let s="initial",l=!1,m=!1,C=!1,h=!1,b=0,F=0,E="ーー",k=0,x=0,B=0,V=null,D=null,S=null,y=null,w=null;const q={random:{name:"ランダム基音モード",description:"10種類の基音からランダムに選択してトレーニング",color:"green",path:"./training/random"},continuous:{name:"連続チャレンジモード",description:"選択した回数だけ連続で実行し、総合評価を確認",color:"orange",path:"./training/continuous"},chromatic:{name:"12音階モード",description:"クロマチックスケールの上行・下行で完全制覇",color:"purple",path:"./training/chromatic"}},P=q[a]||q.random;async function I(){t(3,s="pending");try{S=await navigator.mediaDevices.getUserMedia({audio:!0}),t(3,s="granted"),D=new(window.AudioContext||window.webkitAudioContext),D.state==="suspended"&&await D.resume();const u=D.createMediaStreamSource(S);V=D.createAnalyser(),V.fftSize=2048,V.smoothingTimeConstant=.8,V.minDecibels=-90,V.maxDecibels=-10,u.connect(V);const R=D.createBiquadFilter();R.type="highpass",R.frequency.setValueAtTime(80,D.currentTime),R.Q.setValueAtTime(.7,D.currentTime);const N=D.createBiquadFilter();N.type="lowpass",N.frequency.setValueAtTime(800,D.currentTime),N.Q.setValueAtTime(.7,D.currentTime);const U=D.createBiquadFilter();U.type="notch",U.frequency.setValueAtTime(60,D.currentTime),U.Q.setValueAtTime(10,D.currentTime),y=D.createAnalyser(),y.fftSize=2048,y.smoothingTimeConstant=.8,y.minDecibels=-90,y.maxDecibels=-10,u.connect(R),R.connect(N),N.connect(U),U.connect(y),t(4,l=!0),O()}catch{t(3,s="denied")}}function O(){if(!l||!y||!V)return;const u=y.frequencyBinCount,R=new Uint8Array(u),N=new Uint8Array(V.frequencyBinCount);y.getByteFrequencyData(R),V.getByteFrequencyData(N);let U=0;for(let Y=0;Y<N.length;Y++)U+=N[Y]*N[Y];const K=Math.sqrt(U/N.length);t(8,k=Math.min(100,K/30*100));let W=0;for(let Y=0;Y<R.length;Y++)W+=R[Y]*R[Y];const X=Math.sqrt(W/R.length);t(9,x=Math.min(100,X/30*100)),t(5,b=x),k>0?t(10,B=Math.max(0,Math.round((k-x)/k*100))):t(10,B=0),b>15&&t(0,m=!0);const ee=new Float32Array(y.fftSize);y.getFloatTimeDomainData(ee);const $=Ce(ee,D.sampleRate);$>80&&$<800?(t(6,F=$),t(7,E=ke($)),t(1,C=!0)):(t(6,F=0),t(7,E="ーー")),w=requestAnimationFrame(O)}function j(){t(4,l=!1),w&&(cancelAnimationFrame(w),w=null),S&&(S.getTracks().forEach(u=>u.stop()),S=null),D&&D.state!=="closed"&&(D.close(),D=null),y=null,V=null}ye(()=>{j()});const T=[];Object.keys(e).forEach(u=>{!~T.indexOf(u)&&u.slice(0,2)!=="$$"&&u!=="slot"&&console.warn(`<Page> was created with unknown prop '${u}'`)});const M=()=>window.location.href=P.path;return r.$capture_state=()=>({onMount:_e,onDestroy:ye,page:de,Card:ue,Button:Oe,PageLayout:be,mode:a,micPermission:s,isListening:l,volumeDetected:m,frequencyDetected:C,audioConfirmationComplete:h,currentVolume:b,currentFrequency:F,currentNote:E,rawVolume:k,filteredVolume:x,noiseReduction:B,rawAnalyser:V,audioContext:D,mediaStream:S,analyser:y,animationFrame:w,trainingModes:q,selectedMode:P,requestMicrophone:I,analyzeAudio:O,detectPitch:Ce,frequencyToNote:ke,stopListening:j,$page:i}),r.$inject_state=u=>{"mode"in u&&(a=u.mode),"micPermission"in u&&t(3,s=u.micPermission),"isListening"in u&&t(4,l=u.isListening),"volumeDetected"in u&&t(0,m=u.volumeDetected),"frequencyDetected"in u&&t(1,C=u.frequencyDetected),"audioConfirmationComplete"in u&&t(2,h=u.audioConfirmationComplete),"currentVolume"in u&&t(5,b=u.currentVolume),"currentFrequency"in u&&t(6,F=u.currentFrequency),"currentNote"in u&&t(7,E=u.currentNote),"rawVolume"in u&&t(8,k=u.rawVolume),"filteredVolume"in u&&t(9,x=u.filteredVolume),"noiseReduction"in u&&t(10,B=u.noiseReduction),"rawAnalyser"in u&&(V=u.rawAnalyser),"audioContext"in u&&(D=u.audioContext),"mediaStream"in u&&(S=u.mediaStream),"analyser"in u&&(y=u.analyser),"animationFrame"in u&&(w=u.animationFrame)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),r.$$.update=()=>{r.$$.dirty&7&&m&&C&&!h&&t(2,h=!0)},[m,C,h,s,l,b,F,E,k,x,B,P,I,M]}class Xe extends Ne{constructor(e){super(e),ze(this,e,Qe,he,Le,{}),G("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:he.name})}}export{Xe as component};
