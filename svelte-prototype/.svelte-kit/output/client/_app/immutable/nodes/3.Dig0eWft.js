import{S as xe,i as Fe,d as j,s as Me,v as Re,c as Ne,a as $e,D as ae,E as ye,b as m,q as Y,r as J,u as U,f as T,w as ee,F as He,m as $,x as te,p as H,y as ne,g as r,z as c,h as _,j as k,k as I,B as oe,A as Z,o as C,C as le,G as Ce,H as De,l as K,t as Q,e as we,I as be}from"../chunks/CpsCVeNF.js";import{g as Le}from"../chunks/D0QH3NT1.js";import"../chunks/BtN2v-Ab.js";import{p as re}from"../chunks/B4mdF66Y.js";import{P as ze,B as he,C as ce}from"../chunks/DUnYCdMX.js";import{P as je,V as Ee}from"../chunks/Cq23VVQf.js";const{console:Ge}=Le,g="src/routes/microphone-test/+page.svelte";function ue(a){let e,t,o,s="音量レベル",n,l,u,v,D,d,f,w="音程検出",N,z,A,L=a[4].toFixed(1)+"",q,h,p,b,E,x,M,W,F,P;l=new Ee({props:{volume:a[3],height:"16px",className:"volume-bar-wrapper"},$$inline:!0});let i=!a[1]&&fe(a),B=!a[2]&&de(a),V=a[1]&&!a[2]&&me(a);const O={c:function(){e=C("div"),t=C("div"),o=C("h3"),o.textContent=s,n=H(),ne(l.$$.fragment),u=H(),v=C("div"),i&&i.c(),D=H(),d=C("div"),f=C("h3"),f.textContent=w,N=H(),z=C("div"),A=C("div"),q=Q(L),h=Q(" Hz"),p=H(),b=C("div"),E=Q(a[5]),x=H(),M=C("div"),B&&B.c(),W=H(),V&&V.c(),F=be(),this.h()},l:function(y){e=k(y,"DIV",{class:!0});var R=I(e);t=k(R,"DIV",{class:!0});var G=I(t);o=k(G,"H3",{class:!0,"data-svelte-h":!0}),Z(o)!=="svelte-1nc8gri"&&(o.textContent=s),n=$(G),te(l.$$.fragment,G),u=$(G),v=k(G,"DIV",{class:!0});var _e=I(v);i&&i.l(_e),_e.forEach(m),G.forEach(m),D=$(R),d=k(R,"DIV",{class:!0});var X=I(d);f=k(X,"H3",{class:!0,"data-svelte-h":!0}),Z(f)!=="svelte-1ofzoy2"&&(f.textContent=w),N=$(X),z=k(X,"DIV",{class:!0});var ie=I(z);A=k(ie,"DIV",{class:!0});var se=I(A);q=K(se,L),h=K(se," Hz"),se.forEach(m),p=$(ie),b=k(ie,"DIV",{class:!0});var ge=I(b);E=K(ge,a[5]),ge.forEach(m),ie.forEach(m),x=$(X),M=k(X,"DIV",{class:!0});var pe=I(M);B&&B.l(pe),pe.forEach(m),X.forEach(m),R.forEach(m),W=$(y),V&&V.l(y),F=be(),this.h()},h:function(){c(o,"class","display-title svelte-1ltz1dw"),_(o,g,256,16,6918),c(v,"class","volume-status svelte-1ltz1dw"),_(v,g,258,16,7069),c(t,"class","volume-section svelte-1ltz1dw"),_(t,g,255,14,6873),c(f,"class","display-title svelte-1ltz1dw"),_(f,g,267,16,7375),c(A,"class","frequency-value svelte-1ltz1dw"),_(A,g,269,18,7477),c(b,"class","note-value svelte-1ltz1dw"),_(b,g,270,18,7563),c(z,"class","frequency-display svelte-1ltz1dw"),_(z,g,268,16,7427),c(M,"class","frequency-status svelte-1ltz1dw"),_(M,g,272,16,7646),c(d,"class","frequency-section"),_(d,g,266,14,7327),c(e,"class","realtime-display svelte-1ltz1dw"),_(e,g,253,12,6799)},m:function(y,R){T(y,e,R),r(e,t),r(t,o),r(t,n),ee(l,t,null),r(t,u),r(t,v),i&&i.m(v,null),r(e,D),r(e,d),r(d,f),r(d,N),r(d,z),r(z,A),r(A,q),r(A,h),r(z,p),r(z,b),r(b,E),r(d,x),r(d,M),B&&B.m(M,null),T(y,W,R),V&&V.m(y,R),T(y,F,R),P=!0},p:function(y,R){const G={};R&8&&(G.volume=y[3]),l.$set(G),y[1]?i&&(i.d(1),i=null):i||(i=fe(y),i.c(),i.m(v,null)),(!P||R&16)&&L!==(L=y[4].toFixed(1)+"")&&we(q,L),(!P||R&32)&&we(E,y[5]),y[2]?B&&(B.d(1),B=null):B||(B=de(y),B.c(),B.m(M,null)),y[1]&&!y[2]?V||(V=me(y),V.c(),V.m(F.parentNode,F)):V&&(V.d(1),V=null)},i:function(y){P||(U(l.$$.fragment,y),P=!0)},o:function(y){J(l.$$.fragment,y),P=!1},d:function(y){y&&(m(e),m(W),m(F)),Y(l),i&&i.d(),B&&B.d(),V&&V.d(y)}};return j("SvelteRegisterBlock",{block:O,id:ue.name,type:"if",source:"(253:10) {#if micPermission === 'granted'}",ctx:a}),O}function fe(a){let e,t="⏳ 声を出して音量を確認してください";const o={c:function(){e=C("span"),e.textContent=t,this.h()},l:function(n){e=k(n,"SPAN",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-7eexnn"&&(e.textContent=t),this.h()},h:function(){c(e,"class","status-pending svelte-1ltz1dw"),_(e,g,260,20,7157)},m:function(n,l){T(n,e,l)},d:function(n){n&&m(e)}};return j("SvelteRegisterBlock",{block:o,id:fe.name,type:"if",source:"(260:18) {#if !volumeDetected}",ctx:a}),o}function de(a){let e,t="⏳ 「ド」を発声して音程を確認してください";const o={c:function(){e=C("span"),e.textContent=t,this.h()},l:function(n){e=k(n,"SPAN",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-lvftl7"&&(e.textContent=t),this.h()},h:function(){c(e,"class","status-pending svelte-1ltz1dw"),_(e,g,274,20,7740)},m:function(n,l){T(n,e,l)},d:function(n){n&&m(e)}};return j("SvelteRegisterBlock",{block:o,id:de.name,type:"if",source:"(274:18) {#if !frequencyDetected}",ctx:a}),o}function me(a){let e,t,o,s="「ド」を発声してください",n,l,u="任意の高さで「ドー」と歌うように発声してください";const v={c:function(){e=C("div"),t=C("div"),o=C("h3"),o.textContent=s,n=H(),l=C("p"),l.textContent=u,this.h()},l:function(d){e=k(d,"DIV",{class:!0});var f=I(e);t=k(f,"DIV",{class:!0});var w=I(t);o=k(w,"H3",{class:!0,"data-svelte-h":!0}),Z(o)!=="svelte-xe90gt"&&(o.textContent=s),n=$(w),l=k(w,"P",{class:!0,"data-svelte-h":!0}),Z(l)!=="svelte-1rtajtc"&&(l.textContent=u),w.forEach(m),f.forEach(m),this.h()},h:function(){c(o,"class","svelte-1ltz1dw"),_(o,g,284,18,8070),c(l,"class","svelte-1ltz1dw"),_(l,g,285,18,8110),c(t,"class","guidance-content svelte-1ltz1dw"),_(t,g,283,16,8021),c(e,"class","guidance svelte-1ltz1dw"),_(e,g,282,14,7982)},m:function(d,f){T(d,e,f),r(e,t),r(t,o),r(t,n),r(t,l)},d:function(d){d&&m(e)}};return j("SvelteRegisterBlock",{block:v,id:me.name,type:"if",source:"(282:12) {#if volumeDetected && !frequencyDetected}",ctx:a}),v}function Be(a){let e,t,o=a[0]==="granted"&&ue(a);const s={c:function(){e=C("div"),o&&o.c(),this.h()},l:function(l){e=k(l,"DIV",{class:!0});var u=I(e);o&&o.l(u),u.forEach(m),this.h()},h:function(){c(e,"class","mic-test-content svelte-1ltz1dw"),_(e,g,249,8,6683)},m:function(l,u){T(l,e,u),o&&o.m(e,null),t=!0},p:function(l,u){l[0]==="granted"?o?(o.p(l,u),u&1&&U(o,1)):(o=ue(l),o.c(),U(o,1),o.m(e,null)):o&&(Ce(),J(o,1,1,()=>{o=null}),De())},i:function(l){t||(U(o),t=!0)},o:function(l){J(o),t=!1},d:function(l){l&&m(e),o&&o.d()}};return j("SvelteRegisterBlock",{block:s,id:Be.name,type:"slot",source:'(249:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:a}),s}function Ve(a){let e,t;e=new he({props:{variant:"disabled",size:"lg",fullWidth:!0,disabled:!0,$$slots:{default:[Ie]},$$scope:{ctx:a}},$$inline:!0});const o={c:function(){ne(e.$$.fragment)},l:function(n){te(e.$$.fragment,n)},m:function(n,l){ee(e,n,l),t=!0},p:function(n,l){const u={};l&2097152&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i:function(n){t||(U(e.$$.fragment,n),t=!0)},o:function(n){J(e.$$.fragment,n),t=!1},d:function(n){Y(e,n)}};return j("SvelteRegisterBlock",{block:o,id:Ve.name,type:"else",source:"(313:10) {:else}",ctx:a}),o}function Se(a){let e,t;e=new he({props:{href:a[7].path,variant:"primary",size:"lg",fullWidth:!0,$$slots:{default:[Ae]},$$scope:{ctx:a}},$$inline:!0});const o={c:function(){ne(e.$$.fragment)},l:function(n){te(e.$$.fragment,n)},m:function(n,l){ee(e,n,l),t=!0},p:function(n,l){const u={};l&2097152&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i:function(n){t||(U(e.$$.fragment,n),t=!0)},o:function(n){J(e.$$.fragment,n),t=!1},d:function(n){Y(e,n)}};return j("SvelteRegisterBlock",{block:o,id:Se.name,type:"if",source:"(304:10) {#if startButtonEnabled}",ctx:a}),o}function Ie(a){let e;const t={c:function(){e=Q("マイクテスト完了後に開始")},l:function(s){e=K(s,"マイクテスト完了後に開始")},m:function(s,n){T(s,e,n)},d:function(s){s&&m(e)}};return j("SvelteRegisterBlock",{block:t,id:Ie.name,type:"slot",source:'(314:12) <Button                variant=\\"disabled\\"                size=\\"lg\\"                fullWidth                disabled             >',ctx:a}),t}function Ae(a){let e;const t={c:function(){e=Q("トレーニング開始")},l:function(s){e=K(s,"トレーニング開始")},m:function(s,n){T(s,e,n)},d:function(s){s&&m(e)}};return j("SvelteRegisterBlock",{block:t,id:Ae.name,type:"slot",source:'(305:12) <Button                href={selectedMode.path}                variant=\\"primary\\"                size=\\"lg\\"                fullWidth             >',ctx:a}),t}function Pe(a){let e,t,o=a[7].name+"",s,n,l,u=a[7].description+"",v,D,d,f,w;const N=[Se,Ve],z=[];function A(q,h){return q[6]?0:1}d=A(a),f=z[d]=N[d](a);const L={c:function(){e=C("div"),t=C("h3"),s=Q(o),n=H(),l=C("p"),v=Q(u),D=H(),f.c(),this.h()},l:function(h){e=k(h,"DIV",{class:!0});var p=I(e);t=k(p,"H3",{class:!0});var b=I(t);s=K(b,o),b.forEach(m),n=$(p),l=k(p,"P",{class:!0});var E=I(l);v=K(E,u),E.forEach(m),D=$(p),f.l(p),p.forEach(m),this.h()},h:function(){c(t,"class","start-title svelte-1ltz1dw"),_(t,g,298,10,8404),c(l,"class","start-description svelte-1ltz1dw"),_(l,g,299,10,8463),c(e,"class","start-content svelte-1ltz1dw"),_(e,g,297,8,8366)},m:function(h,p){T(h,e,p),r(e,t),r(t,s),r(e,n),r(e,l),r(l,v),r(e,D),z[d].m(e,null),w=!0},p:function(h,p){let b=d;d=A(h),d===b?z[d].p(h,p):(Ce(),J(z[b],1,1,()=>{z[b]=null}),De(),f=z[d],f?f.p(h,p):(f=z[d]=N[d](h),f.c()),U(f,1),f.m(e,null))},i:function(h){w||(U(f),w=!0)},o:function(h){J(f),w=!1},d:function(h){h&&m(e),z[d].d()}};return j("SvelteRegisterBlock",{block:L,id:Pe.name,type:"slot",source:'(297:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:a}),L}function qe(a){let e,t,o,s,n,l,u,v,D,d,f,w,N="マイクテスト",z,A,L="音感トレーニングを始める前に、マイクの動作を確認します",q,h,p,b,E,x,M;p=new ce({props:{variant:"default",padding:"lg",$$slots:{default:[Be]},$$scope:{ctx:a}},$$inline:!0}),x=new ce({props:{variant:"default",padding:"lg",$$slots:{default:[Pe]},$$scope:{ctx:a}},$$inline:!0});const W={c:function(){e=C("div"),t=C("div"),o=C("div"),s=C("div"),n=le("svg"),l=le("path"),u=le("path"),v=le("line"),D=le("line"),d=H(),f=C("div"),w=C("h1"),w.textContent=N,z=H(),A=C("p"),A.textContent=L,q=H(),h=C("div"),ne(p.$$.fragment),b=H(),E=C("div"),ne(x.$$.fragment),this.h()},l:function(P){e=k(P,"DIV",{class:!0});var i=I(e);t=k(i,"DIV",{class:!0});var B=I(t);o=k(B,"DIV",{class:!0});var V=I(o);s=k(V,"DIV",{class:!0});var O=I(s);n=oe(O,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var S=I(n);l=oe(S,"path",{d:!0}),I(l).forEach(m),u=oe(S,"path",{d:!0}),I(u).forEach(m),v=oe(S,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),I(v).forEach(m),D=oe(S,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),I(D).forEach(m),S.forEach(m),O.forEach(m),d=$(V),f=k(V,"DIV",{});var y=I(f);w=k(y,"H1",{class:!0,"data-svelte-h":!0}),Z(w)!=="svelte-z7m4lk"&&(w.textContent=N),z=$(y),A=k(y,"P",{class:!0,"data-svelte-h":!0}),Z(A)!=="svelte-1vtv92f"&&(A.textContent=L),y.forEach(m),V.forEach(m),B.forEach(m),q=$(i),h=k(i,"DIV",{class:!0});var R=I(h);te(p.$$.fragment,R),R.forEach(m),b=$(i),E=k(i,"DIV",{class:!0});var G=I(E);te(x.$$.fragment,G),G.forEach(m),i.forEach(m),this.h()},h:function(){c(l,"d","M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"),_(l,g,233,12,6147),c(u,"d","M19 10v2a7 7 0 0 1-14 0v-2"),_(u,g,234,12,6224),c(v,"x1","12"),c(v,"x2","12"),c(v,"y1","19"),c(v,"y2","22"),_(v,g,235,12,6275),c(D,"x1","8"),c(D,"x2","16"),c(D,"y1","22"),c(D,"y2","22"),_(D,g,236,12,6327),c(n,"width","48"),c(n,"height","48"),c(n,"viewBox","0 0 24 24"),c(n,"fill","none"),c(n,"stroke","currentColor"),c(n,"stroke-width","2"),_(n,g,232,10,6035),c(s,"class","mic-icon svelte-1ltz1dw"),_(s,g,231,8,6002),c(w,"class","mic-test-title svelte-1ltz1dw"),_(w,g,240,10,6422),c(A,"class","mic-test-description svelte-1ltz1dw"),_(A,g,241,10,6471),_(f,g,239,8,6406),c(o,"class","mic-test-header svelte-1ltz1dw"),_(o,g,230,6,5964),c(t,"class","header svelte-1ltz1dw"),_(t,g,229,4,5937),c(h,"class","test-section"),_(h,g,247,4,6604),c(E,"class","start-section"),_(E,g,295,4,8286),c(e,"class","microphone-test svelte-1ltz1dw"),_(e,g,227,2,5885)},m:function(P,i){T(P,e,i),r(e,t),r(t,o),r(o,s),r(s,n),r(n,l),r(n,u),r(n,v),r(n,D),r(o,d),r(o,f),r(f,w),r(f,z),r(f,A),r(e,q),r(e,h),ee(p,h,null),r(e,b),r(e,E),ee(x,E,null),M=!0},p:function(P,i){const B={};i&2097215&&(B.$$scope={dirty:i,ctx:P}),p.$set(B);const V={};i&2097216&&(V.$$scope={dirty:i,ctx:P}),x.$set(V)},i:function(P){M||(U(p.$$.fragment,P),U(x.$$.fragment,P),M=!0)},o:function(P){J(p.$$.fragment,P),J(x.$$.fragment,P),M=!1},d:function(P){P&&m(e),Y(p),Y(x)}};return j("SvelteRegisterBlock",{block:W,id:qe.name,type:"slot",source:"(227:0) <PageLayout showBackButton={true}>",ctx:a}),W}function ve(a){let e,t,o;t=new ze({props:{showBackButton:!0,$$slots:{default:[qe]},$$scope:{ctx:a}},$$inline:!0});const s={c:function(){e=H(),ne(t.$$.fragment),this.h()},l:function(l){He("svelte-8st1fo",document.head).forEach(m),e=$(l),te(t.$$.fragment,l),this.h()},h:function(){document.title="マイクテスト - 相対音感トレーニング"},m:function(l,u){T(l,e,u),ee(t,l,u),o=!0},p:function(l,[u]){const v={};u&2097279&&(v.$$scope={dirty:u,ctx:l}),t.$set(v)},i:function(l){o||(U(t.$$.fragment,l),o=!0)},o:function(l){J(t.$$.fragment,l),o=!1},d:function(l){l&&m(e),Y(t,l)}};return j("SvelteRegisterBlock",{block:s,id:ve.name,type:"component",source:"",ctx:a}),s}function ke(a){if(a<=0)return"C4（ド4）";const t=Math.round(12*Math.log2(a/440)),o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],s=((t+9)%12+12)%12,n=Math.floor((t+9)/12)+4,l=o[s];return`${l}${n}（${{C:"ド","C#":"ド#",D:"レ","D#":"レ#",E:"ミ",F:"ファ","F#":"ファ#",G:"ソ","G#":"ソ#",A:"ラ","A#":"ラ#",B:"シ"}[l]}${n}）`}function Te(a,e,t){let o,s;Re(re,"page"),Ne(a,re,i=>t(15,s=i));let{$$slots:n={},$$scope:l}=e;$e("Page",n,[]);let u="random";ae(()=>{s.url.searchParams.has("mode")&&(u=s.url.searchParams.get("mode")||"random")});let v="pending",D=!1,d=!1,f=0,w=0,N="",z=!1;const A={random:{name:"ランダム基音モード",description:"10種類の基音からランダムに選択してトレーニング",color:"green",path:"./training/random"},continuous:{name:"連続チャレンジモード",description:"選択した回数だけ連続で実行し、総合評価を確認",color:"orange",path:"./training/continuous"},chromatic:{name:"12音階モード",description:"クロマチックスケールの上行・下行で完全制覇",color:"purple",path:"./training/chromatic"}},L=A[u]||A.random;async function q(){t(0,v="pending");try{const i=await navigator.mediaDevices.getUserMedia({audio:!0});t(0,v="granted"),i.getTracks().forEach(B=>B.stop()),setTimeout(()=>{M()},500)}catch(i){console.error("マイク許可エラー:",i),t(0,v="denied")}}let h=null,p=null,b=null,E=null,x=null;async function M(){if(v==="granted")try{h=new(window.AudioContext||window.webkitAudioContext),p=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}}),b=h.createAnalyser(),b.fftSize=2048,b.smoothingTimeConstant=.8,h.createMediaStreamSource(p).connect(b);const B=b.frequencyBinCount;E=new Uint8Array(B),z=!0,W()}catch(i){console.error("マイクアクセスエラー:",i),t(0,v="denied")}}function W(){if(!z||!b)return;b.getByteFrequencyData(E);let i=0;for(let S=0;S<E.length;S++)i+=E[S]*E[S];const B=Math.sqrt(i/E.length);t(3,f=Math.min(100,B/128*100)),f>20&&t(1,D=!0);let V=0,O=0;for(let S=1;S<E.length/4;S++)E[S]>O&&(O=E[S],V=S);if(O>50){const S=h.sampleRate;t(4,w=V*S/b.fftSize),t(5,N=ke(w)),w>80&&w<800&&t(2,d=!0)}else t(4,w=0),t(5,N="");x=requestAnimationFrame(W)}function F(){z=!1,x&&(cancelAnimationFrame(x),x=null),p&&(p.getTracks().forEach(i=>i.stop()),p=null),h&&h.state!=="closed"&&(h.close(),h=null),b=null,E=null}ye(()=>{F()}),ae(()=>{setTimeout(()=>{q()},500)});const P=[];return Object.keys(e).forEach(i=>{!~P.indexOf(i)&&i.slice(0,2)!=="$$"&&i!=="slot"&&Ge.warn(`<Page> was created with unknown prop '${i}'`)}),a.$capture_state=()=>({onMount:ae,onDestroy:ye,page:re,Card:ce,Button:he,PageLayout:ze,VolumeBar:Ee,PitchDisplay:je,mode:u,micPermission:v,volumeDetected:D,frequencyDetected:d,currentVolume:f,currentFrequency:w,currentNote:N,isListening:z,trainingModes:A,selectedMode:L,frequencyToNote:ke,requestMicrophone:q,audioContext:h,mediaStream:p,analyser:b,dataArray:E,animationFrame:x,startListening:M,analyzeAudio:W,stopListening:F,startButtonEnabled:o,$page:s}),a.$inject_state=i=>{"mode"in i&&(u=i.mode),"micPermission"in i&&t(0,v=i.micPermission),"volumeDetected"in i&&t(1,D=i.volumeDetected),"frequencyDetected"in i&&t(2,d=i.frequencyDetected),"currentVolume"in i&&t(3,f=i.currentVolume),"currentFrequency"in i&&t(4,w=i.currentFrequency),"currentNote"in i&&t(5,N=i.currentNote),"isListening"in i&&(z=i.isListening),"audioContext"in i&&(h=i.audioContext),"mediaStream"in i&&(p=i.mediaStream),"analyser"in i&&(b=i.analyser),"dataArray"in i&&(E=i.dataArray),"animationFrame"in i&&(x=i.animationFrame),"startButtonEnabled"in i&&t(6,o=i.startButtonEnabled)},e&&"$$inject"in e&&a.$inject_state(e.$$inject),a.$$.update=()=>{a.$$.dirty&7&&t(6,o=v==="granted"&&D&&d)},[v,D,d,f,w,N,o,L]}class Qe extends xe{constructor(e){super(e),Fe(this,e,Te,ve,Me,{}),j("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:ve.name})}}export{Qe as component};
