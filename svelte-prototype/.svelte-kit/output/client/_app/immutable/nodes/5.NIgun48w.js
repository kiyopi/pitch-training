const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/CW4Srgmt.js","../chunks/DXfV3yLF.js","../chunks/BnpKoSs-.js","../chunks/D0QH3NT1.js","../chunks/Dl4Afa0Y.js","../assets/sessionStorage.C1aMkHwk.css"])))=>i.map(i=>d[i]);
import{_ as bn}from"../chunks/C1FmrZbK.js";import{S as _o,i as So,d as te,s as bo,v as Ie,c as Ne,a as Do,H as Dn,V as qn,b as h,q as fe,r as oe,u as Q,f as G,w as de,I as qo,m as X,x as me,p as Y,y as ge,J as wo,K as He,L as ze,g as m,z as T,h as F,M as Xe,j as R,k as j,A as pe,l as W,N as je,o as M,t as J,e as ke,Q as ut,n as Je,R as An}from"../chunks/DXfV3yLF.js";import{g as Co}from"../chunks/D0QH3NT1.js";import"../chunks/BnpKoSs-.js";import{b as lt,g as _t}from"../chunks/Dl4Afa0Y.js";import{p as St}from"../chunks/BamhfYDu.js";import{P as Tn,B as ft,C as Ke}from"../chunks/CrwomGmF.js";import{l as ie,a as We,h as bt,P as En,b as Pn,V as ko}from"../chunks/BRZWrjh2.js";import{l as Dt,s as nt,c as Fo,r as Ro,a as wn,u as qt,b as Mo,d as wt,p as Io,o as No,e as Ao,f as Ct,i as kt,g as To,h as Ft,n as Rt,j as Mt,k as It,t as Nt,E as Cn,m as ot,A as Gt,U as Ut,S as Eo,F as Po,C as xo,I as Bo,q as Vo,T as Ho,P as zo,M as xn,v as jo,w as Lo,x as At}from"../chunks/CW4Srgmt.js";const Oo=!1,Go=!1,rr=Object.freeze(Object.defineProperty({__proto__:null,prerender:Go,ssr:Oo},Symbol.toStringTag,{value:"Module"})),{Object:Uo,console:Wo,document:kn}=Co,I="src/routes/training/continuous/+page.svelte";function Fn(a,t,e){const i=a.slice();return i[99]=t[e],i[101]=e,i}function Rn(a,t,e){const i=a.slice();return i[102]=t[e],i}function Pt(a){var V,L;let t,e,i,r,n,s,c,u,f,A,D=(((V=a[24])==null?void 0:V.length)||0)+"",v,U,x,y,g,C,p,d,k=Math.round((((L=a[24])==null?void 0:L.length)||0)/8*100)+"",N,H,P,_,Z,b=a[0]==="results"&&a[5]&&xt(a);const q={c:function(){t=M("div"),e=M("div"),i=M("div"),r=M("span"),n=J("セッション "),s=J(a[23]),c=J("/8"),u=Y(),f=M("span"),A=J("完了済み "),v=J(D),U=J("セッション"),x=Y(),y=M("div"),g=M("div"),C=M("div"),p=Y(),d=M("span"),N=J(k),H=J("%"),P=Y(),b&&b.c(),_=je(),this.h()},l:function(B){t=R(B,"DIV",{class:!0});var E=j(t);e=R(E,"DIV",{class:!0});var $=j(e);i=R($,"DIV",{class:!0});var K=j(i);r=R(K,"SPAN",{class:!0});var ye=j(r);n=W(ye,"セッション "),s=W(ye,a[23]),c=W(ye,"/8"),ye.forEach(h),u=X(K),f=R(K,"SPAN",{class:!0});var Se=j(f);A=W(Se,"完了済み "),v=W(Se,D),U=W(Se,"セッション"),Se.forEach(h),K.forEach(h),x=X($),y=R($,"DIV",{class:!0});var Ae=j(y);g=R(Ae,"DIV",{class:!0});var Le=j(g);C=R(Le,"DIV",{class:!0,style:!0}),j(C).forEach(h),Le.forEach(h),p=X(Ae),d=R(Ae,"SPAN",{class:!0});var xe=j(d);N=W(xe,k),H=W(xe,"%"),xe.forEach(h),Ae.forEach(h),$.forEach(h),E.forEach(h),P=X(B),b&&b.l(B),_=je(),this.h()},h:function(){var B;T(r,"class","completed-count svelte-rt5px1"),F(r,I,2659,12,90382),T(f,"class","remaining-text svelte-rt5px1"),F(f,I,2660,12,90459),T(i,"class","session-info svelte-rt5px1"),F(i,I,2658,10,90343),T(C,"class","progress-fill svelte-rt5px1"),Xe(C,"width",(((B=a[24])==null?void 0:B.length)||0)/8*100+"%"),F(C,I,2664,14,90647),T(g,"class","progress-bar svelte-rt5px1"),F(g,I,2663,12,90606),T(d,"class","progress-text svelte-rt5px1"),F(d,I,2666,12,90773),T(y,"class","progress-section svelte-rt5px1"),F(y,I,2662,10,90563),T(e,"class","session-status svelte-rt5px1"),F(e,I,2657,8,90304),T(t,"class","session-progress svelte-rt5px1"),F(t,I,2656,6,90265)},m:function(B,E){G(B,t,E),m(t,e),m(e,i),m(i,r),m(r,n),m(r,s),m(r,c),m(i,u),m(i,f),m(f,A),m(f,v),m(f,U),m(e,x),m(e,y),m(y,g),m(g,C),m(y,p),m(y,d),m(d,N),m(d,H),G(B,P,E),b&&b.m(B,E),G(B,_,E),Z=!0},p:function(B,E){var $,K,ye;(!Z||E[0]&8388608)&&ke(s,B[23]),(!Z||E[0]&16777216)&&D!==(D=((($=B[24])==null?void 0:$.length)||0)+"")&&ke(v,D),(!Z||E[0]&16777216)&&Xe(C,"width",(((K=B[24])==null?void 0:K.length)||0)/8*100+"%"),(!Z||E[0]&16777216)&&k!==(k=Math.round((((ye=B[24])==null?void 0:ye.length)||0)/8*100)+"")&&ke(N,k),B[0]==="results"&&B[5]?b?(b.p(B,E),E[0]&33&&Q(b,1)):(b=xt(B),b.c(),Q(b,1),b.m(_.parentNode,_)):b&&(He(),oe(b,1,1,()=>{b=null}),ze())},i:function(B){Z||(Q(b),Z=!0)},o:function(B){oe(b),Z=!1},d:function(B){B&&(h(t),h(P),h(_)),b&&b.d(B)}};return te("SvelteRegisterBlock",{block:q,id:Pt.name,type:"if",source:"(2656:4) {#if microphoneState === 'granted' && !$isLoading}",ctx:a}),q}function xt(a){let t,e,i;e=new Gt({props:{isCompleted:a[5],position:"top"},$$inline:!0}),e.$on("action",a[29]);const r={c:function(){t=M("div"),ge(e.$$.fragment),this.h()},l:function(s){t=R(s,"DIV",{class:!0});var c=j(t);me(e.$$.fragment,c),c.forEach(h),this.h()},h:function(){T(t,"class","top-action-buttons svelte-rt5px1"),F(t,I,2674,8,91030)},m:function(s,c){G(s,t,c),de(e,t,null),i=!0},p:function(s,c){const u={};c[0]&32&&(u.isCompleted=s[5]),e.$set(u)},i:function(s){i||(Q(e.$$.fragment,s),i=!0)},o:function(s){oe(e.$$.fragment,s),i=!1},d:function(s){s&&h(t),fe(e)}};return te("SvelteRegisterBlock",{block:r,id:xt.name,type:"if",source:"(2674:6) {#if trainingPhase === 'results' && $isCompleted}",ctx:a}),r}function Bn(a){let t,e;t=new Ke({props:{class:"error-card",$$slots:{default:[jn]},$$scope:{ctx:a}},$$inline:!0});const i={c:function(){ge(t.$$.fragment)},l:function(n){me(t.$$.fragment,n)},m:function(n,s){de(t,n,s),e=!0},p:function(n,s){const c={};s[3]&4096&&(c.$$scope={dirty:s,ctx:n}),t.$set(c)},i:function(n){e||(Q(t.$$.fragment,n),e=!0)},o:function(n){oe(t.$$.fragment,n),e=!1},d:function(n){fe(t,n)}};return te("SvelteRegisterBlock",{block:i,id:Bn.name,type:"else",source:"(2896:2) {:else}",ctx:a}),i}function Vn(a){let t,e,i,r,n,s,c,u,f,A,D,v,U,x={isActive:a[1]==="granted",trainingPhase:a[0],className:"pitch-detector-content",debugMode:!0,disableHarmonicCorrection:!1};e=new Pn({props:x,$$inline:!0}),a[35](e),e.$on("pitchUpdate",a[28]),e.$on("stateChange",uo),e.$on("error",a[31]),e.$on("microphoneHealthChange",a[32]);let y=!a[2]&&a[6].length>0&&Bt(a);s=new Ke({props:{class:"main-card half-width",$$slots:{default:[Xn]},$$scope:{ctx:a}},$$inline:!0}),u=new En({props:{frequency:a[14],note:a[15],volume:a[13],isMuted:a[0]!=="guiding",muteMessage:"基音再生後に開始",className:"half-width",showGuidance:!1},$$inline:!0}),A=new Ke({props:{class:"main-card",$$slots:{default:[$n]},$$scope:{ctx:a}},$$inline:!0});let g=a[0]==="results"&&jt(a);const C={c:function(){t=M("div"),ge(e.$$.fragment),i=Y(),y&&y.c(),r=Y(),n=M("div"),ge(s.$$.fragment),c=Y(),ge(u.$$.fragment),f=Y(),ge(A.$$.fragment),D=Y(),g&&g.c(),v=je(),this.h()},l:function(d){t=R(d,"DIV",{style:!0});var k=j(t);me(e.$$.fragment,k),k.forEach(h),i=X(d),y&&y.l(d),r=X(d),n=R(d,"DIV",{class:!0});var N=j(n);me(s.$$.fragment,N),c=X(N),me(u.$$.fragment,N),N.forEach(h),f=X(d),me(A.$$.fragment,d),D=X(d),g&&g.l(d),v=je(),this.h()},h:function(){Xe(t,"display","none"),F(t,I,2693,4,91528),T(n,"class","side-by-side-container svelte-rt5px1"),F(n,I,2731,6,92832)},m:function(d,k){G(d,t,k),de(e,t,null),G(d,i,k),y&&y.m(d,k),G(d,r,k),G(d,n,k),de(s,n,null),m(n,c),de(u,n,null),G(d,f,k),de(A,d,k),G(d,D,k),g&&g.m(d,k),G(d,v,k),U=!0},p:function(d,k){const N={};k[0]&2&&(N.isActive=d[1]==="granted"),k[0]&1&&(N.trainingPhase=d[0]),e.$set(N),!d[2]&&d[6].length>0?y?(y.p(d,k),k[0]&68&&Q(y,1)):(y=Bt(d),y.c(),Q(y,1),y.m(r.parentNode,r)):y&&(He(),oe(y,1,1,()=>{y=null}),ze());const H={};k[0]&8395649|k[3]&4096&&(H.$$scope={dirty:k,ctx:d}),s.$set(H);const P={};k[0]&16384&&(P.frequency=d[14]),k[0]&32768&&(P.note=d[15]),k[0]&8192&&(P.volume=d[13]),k[0]&1&&(P.isMuted=d[0]!=="guiding"),u.$set(P);const _={};k[0]&1025|k[3]&4096&&(_.$$scope={dirty:k,ctx:d}),A.$set(_),d[0]==="results"?g?(g.p(d,k),k[0]&1&&Q(g,1)):(g=jt(d),g.c(),Q(g,1),g.m(v.parentNode,v)):g&&(He(),oe(g,1,1,()=>{g=null}),ze())},i:function(d){U||(Q(e.$$.fragment,d),Q(y),Q(s.$$.fragment,d),Q(u.$$.fragment,d),Q(A.$$.fragment,d),Q(g),U=!0)},o:function(d){oe(e.$$.fragment,d),oe(y),oe(s.$$.fragment,d),oe(u.$$.fragment,d),oe(A.$$.fragment,d),oe(g),U=!1},d:function(d){d&&(h(t),h(i),h(r),h(n),h(f),h(D),h(v)),a[35](null),fe(e),y&&y.d(d),fe(s),fe(u),fe(A,d),g&&g.d(d)}};return te("SvelteRegisterBlock",{block:C,id:Vn.name,type:"if",source:"(2692:2) {#if microphoneState === 'granted'}",ctx:a}),C}function Hn(a){let t;const e={c:function(){t=J("🎤 マイクテストページへ移動")},l:function(r){t=W(r,"🎤 マイクテストページへ移動")},m:function(r,n){G(r,t,n)},d:function(r){r&&h(t)}};return te("SvelteRegisterBlock",{block:e,id:Hn.name,type:"slot",source:'(2910:10) <Button variant=\\"primary\\" on:click={goToMicrophoneTest}>',ctx:a}),e}function zn(a){let t;const e={c:function(){t=J("🏠 ホームに戻る")},l:function(r){t=W(r,"🏠 ホームに戻る")},m:function(r,n){G(r,t,n)},d:function(r){r&&h(t)}};return te("SvelteRegisterBlock",{block:e,id:zn.name,type:"slot",source:'(2913:10) <Button variant=\\"secondary\\" on:click={goHome}>',ctx:a}),e}function jn(a){let t,e,i="🎤",r,n,s="マイクテストが必要です",c,u,f="連続チャレンジモードを開始する前に、マイクテストページで音声入力の確認をお願いします。",A,D,v,U,x,y="マイクテスト完了後",g,C,p,d="まずはマイクテストページで音声確認を行ってください。",k,N,H,P,_,Z;H=new ft({props:{variant:"primary",$$slots:{default:[Hn]},$$scope:{ctx:a}},$$inline:!0}),H.$on("click",a[26]),_=new ft({props:{variant:"secondary",$$slots:{default:[zn]},$$scope:{ctx:a}},$$inline:!0}),_.$on("click",a[27]);const b={c:function(){t=M("div"),e=M("div"),e.textContent=i,r=Y(),n=M("h3"),n.textContent=s,c=Y(),u=M("p"),u.textContent=f,A=Y(),D=M("div"),v=M("p"),U=J("このページは"),x=M("strong"),x.textContent=y,g=J("にご利用いただけます。"),C=Y(),p=M("p"),p.textContent=d,k=Y(),N=M("div"),ge(H.$$.fragment),P=Y(),ge(_.$$.fragment),this.h()},l:function(V){t=R(V,"DIV",{class:!0});var L=j(t);e=R(L,"DIV",{class:!0,"data-svelte-h":!0}),pe(e)!=="svelte-15rbx8n"&&(e.textContent=i),r=X(L),n=R(L,"H3",{class:!0,"data-svelte-h":!0}),pe(n)!=="svelte-17kvze2"&&(n.textContent=s),c=X(L),u=R(L,"P",{class:!0,"data-svelte-h":!0}),pe(u)!=="svelte-1t09god"&&(u.textContent=f),A=X(L),D=R(L,"DIV",{class:!0});var ne=j(D);v=R(ne,"P",{class:!0});var B=j(v);U=W(B,"このページは"),x=R(B,"STRONG",{"data-svelte-h":!0}),pe(x)!=="svelte-1n3qsr6"&&(x.textContent=y),g=W(B,"にご利用いただけます。"),B.forEach(h),C=X(ne),p=R(ne,"P",{class:!0,"data-svelte-h":!0}),pe(p)!=="svelte-v8nd09"&&(p.textContent=d),ne.forEach(h),k=X(L),N=R(L,"DIV",{class:!0});var E=j(N);me(H.$$.fragment,E),P=X(E),me(_.$$.fragment,E),E.forEach(h),L.forEach(h),this.h()},h:function(){T(e,"class","error-icon svelte-rt5px1"),F(e,I,2899,8,98533),T(n,"class","svelte-rt5px1"),F(n,I,2900,8,98574),T(u,"class","svelte-rt5px1"),F(u,I,2901,8,98603),F(x,I,2904,19,98719),T(v,"class","svelte-rt5px1"),F(v,I,2904,10,98710),T(p,"class","svelte-rt5px1"),F(p,I,2905,10,98771),T(D,"class","recommendation svelte-rt5px1"),F(D,I,2903,8,98671),T(N,"class","action-buttons"),F(N,I,2908,8,98837),T(t,"class","error-content svelte-rt5px1"),F(t,I,2898,6,98497)},m:function(V,L){G(V,t,L),m(t,e),m(t,r),m(t,n),m(t,c),m(t,u),m(t,A),m(t,D),m(D,v),m(v,U),m(v,x),m(v,g),m(D,C),m(D,p),m(t,k),m(t,N),de(H,N,null),m(N,P),de(_,N,null),Z=!0},p:function(V,L){const ne={};L[3]&4096&&(ne.$$scope={dirty:L,ctx:V}),H.$set(ne);const B={};L[3]&4096&&(B.$$scope={dirty:L,ctx:V}),_.$set(B)},i:function(V){Z||(Q(H.$$.fragment,V),Q(_.$$.fragment,V),Z=!0)},o:function(V){oe(H.$$.fragment,V),oe(_.$$.fragment,V),Z=!1},d:function(V){V&&h(t),fe(H),fe(_)}};return te("SvelteRegisterBlock",{block:b,id:jn.name,type:"slot",source:'(2898:4) <Card class=\\"error-card\\">',ctx:a}),b}function Bt(a){let t,e;t=new Ke({props:{class:"warning-card",$$slots:{default:[Ln]},$$scope:{ctx:a}},$$inline:!0});const i={c:function(){ge(t.$$.fragment)},l:function(n){me(t.$$.fragment,n)},m:function(n,s){de(t,n,s),e=!0},p:function(n,s){const c={};s[0]&64|s[3]&4096&&(c.$$scope={dirty:s,ctx:n}),t.$set(c)},i:function(n){e||(Q(t.$$.fragment,n),e=!0)},o:function(n){oe(t.$$.fragment,n),e=!1},d:function(n){fe(t,n)}};return te("SvelteRegisterBlock",{block:i,id:Bt.name,type:"if",source:"(2713:6) {#if !microphoneHealthy && microphoneErrors.length > 0}",ctx:a}),i}function Vt(a){let t,e=a[102]+"",i;const r={c:function(){t=M("li"),i=J(e),this.h()},l:function(s){t=R(s,"LI",{class:!0});var c=j(t);i=W(c,e),c.forEach(h),this.h()},h:function(){T(t,"class","svelte-rt5px1"),F(t,I,2721,16,92600)},m:function(s,c){G(s,t,c),m(t,i)},p:function(s,c){c[0]&64&&e!==(e=s[102]+"")&&ke(i,e)},d:function(s){s&&h(t)}};return te("SvelteRegisterBlock",{block:r,id:Vt.name,type:"each",source:"(2721:14) {#each microphoneErrors as error}",ctx:a}),r}function Ln(a){let t,e,i="⚠️ マイク接続に問題があります",r,n,s,c="マイクが正常に動作していません。以下の問題が検出されました：",u,f,A,D,v,U="解決方法:",x,y=ut(a[6]),g=[];for(let p=0;p<y.length;p+=1)g[p]=Vt(Rn(a,y,p));const C={c:function(){t=M("div"),e=M("h3"),e.textContent=i,r=Y(),n=M("div"),s=M("p"),s.textContent=c,u=Y(),f=M("ul");for(let d=0;d<g.length;d+=1)g[d].c();A=Y(),D=M("p"),v=M("strong"),v.textContent=U,x=J(" ページを再読み込みしてマイク許可を再度取得してください。"),this.h()},l:function(d){t=R(d,"DIV",{class:!0});var k=j(t);e=R(k,"H3",{class:!0,"data-svelte-h":!0}),pe(e)!=="svelte-15qec5x"&&(e.textContent=i),k.forEach(h),r=X(d),n=R(d,"DIV",{class:!0});var N=j(n);s=R(N,"P",{class:!0,"data-svelte-h":!0}),pe(s)!=="svelte-171o2p0"&&(s.textContent=c),u=X(N),f=R(N,"UL",{class:!0});var H=j(f);for(let _=0;_<g.length;_+=1)g[_].l(H);H.forEach(h),A=X(N),D=R(N,"P",{class:!0});var P=j(D);v=R(P,"STRONG",{"data-svelte-h":!0}),pe(v)!=="svelte-79o66n"&&(v.textContent=U),x=W(P," ページを再読み込みしてマイク許可を再度取得してください。"),P.forEach(h),N.forEach(h),this.h()},h:function(){T(e,"class","section-title svelte-rt5px1"),F(e,I,2715,12,92324),T(t,"class","card-header svelte-rt5px1"),F(t,I,2714,10,92286),T(s,"class","warning-message svelte-rt5px1"),F(s,I,2718,12,92438),T(f,"class","error-list svelte-rt5px1"),F(f,I,2719,12,92512),F(v,I,2725,14,92711),T(D,"class","fix-instruction svelte-rt5px1"),F(D,I,2724,12,92669),T(n,"class","card-content svelte-rt5px1"),F(n,I,2717,10,92399)},m:function(d,k){G(d,t,k),m(t,e),G(d,r,k),G(d,n,k),m(n,s),m(n,u),m(n,f);for(let N=0;N<g.length;N+=1)g[N]&&g[N].m(f,null);m(n,A),m(n,D),m(D,v),m(D,x)},p:function(d,k){if(k[0]&64){y=ut(d[6]);let N;for(N=0;N<y.length;N+=1){const H=Rn(d,y,N);g[N]?g[N].p(H,k):(g[N]=Vt(H),g[N].c(),g[N].m(f,null))}for(;N<g.length;N+=1)g[N].d(1);g.length=y.length}},d:function(d){d&&(h(t),h(r),h(n)),An(g,d)}};return te("SvelteRegisterBlock",{block:C,id:Ln.name,type:"slot",source:'(2714:8) <Card class=\\"warning-card\\">',ctx:a}),C}function On(a){let t;function e(s,c){return s[9]?Kn:s[0]==="guiding"?Jn:s[0]==="results"?Wn:Un}let i=e(a),r=i(a);const n={c:function(){t=M("div"),r.c(),this.h()},l:function(c){t=R(c,"DIV",{class:!0});var u=j(t);r.l(u),u.forEach(h),this.h()},h:function(){T(t,"class","continuous-status svelte-rt5px1"),F(t,I,2748,14,93481)},m:function(c,u){G(c,t,u),r.m(t,null)},p:function(c,u){i===(i=e(c))&&r?r.p(c,u):(r.d(1),r=i(c),r&&(r.c(),r.m(t,null)))},i:Je,o:Je,d:function(c){c&&h(t),r.d()}};return te("SvelteRegisterBlock",{block:n,id:On.name,type:"else",source:"(2747:12) {:else}",ctx:a}),n}function Gn(a){let t,e;t=new ft({props:{variant:"primary",$$slots:{default:[Qn]},$$scope:{ctx:a}},$$inline:!0}),t.$on("click",a[30]);const i={c:function(){ge(t.$$.fragment)},l:function(n){me(t.$$.fragment,n)},m:function(n,s){de(t,n,s),e=!0},p:function(n,s){const c={};s[3]&4096&&(c.$$scope={dirty:s,ctx:n}),t.$set(c)},i:function(n){e||(Q(t.$$.fragment,n),e=!0)},o:function(n){oe(t.$$.fragment,n),e=!1},d:function(n){fe(t,n)}};return te("SvelteRegisterBlock",{block:i,id:Gn.name,type:"if",source:"(2740:12) {#if trainingPhase === 'setup' && !isPlaying && !($currentSessionId > 1)}",ctx:a}),i}function Un(a){let t,e,i,r;const n={c:function(){t=M("div"),e=J("⚡ 連続モード進行中 ("),i=J(a[23]),r=J("/8)"),this.h()},l:function(c){t=R(c,"DIV",{class:!0});var u=j(t);e=W(u,"⚡ 連続モード進行中 ("),i=W(u,a[23]),r=W(u,"/8)"),u.forEach(h),this.h()},h:function(){T(t,"class","status-text svelte-rt5px1"),F(t,I,2762,18,94071)},m:function(c,u){G(c,t,u),m(t,e),m(t,i),m(t,r)},p:function(c,u){u[0]&8388608&&ke(i,c[23])},d:function(c){c&&h(t)}};return te("SvelteRegisterBlock",{block:n,id:Un.name,type:"else",source:"(2762:16) {:else}",ctx:a}),n}function Wn(a){let t,e,i,r;const n={c:function(){t=M("div"),e=J("✅ セッション "),i=J(a[23]),r=J("/8 完了"),this.h()},l:function(c){t=R(c,"DIV",{class:!0});var u=j(t);e=W(u,"✅ セッション "),i=W(u,a[23]),r=W(u,"/8 完了"),u.forEach(h),this.h()},h:function(){T(t,"class","status-text svelte-rt5px1"),F(t,I,2758,18,93925)},m:function(c,u){G(c,t,u),m(t,e),m(t,i),m(t,r)},p:function(c,u){u[0]&8388608&&ke(i,c[23])},d:function(c){c&&h(t)}};return te("SvelteRegisterBlock",{block:n,id:Wn.name,type:"if",source:"(2758:54) ",ctx:a}),n}function Jn(a){let t,e,i,r;const n={c:function(){t=M("div"),e=J("🎤 セッション "),i=J(a[23]),r=J("/8: ドレミ発声中"),this.h()},l:function(c){t=R(c,"DIV",{class:!0});var u=j(t);e=W(u,"🎤 セッション "),i=W(u,a[23]),r=W(u,"/8: ドレミ発声中"),u.forEach(h),this.h()},h:function(){T(t,"class","status-text svelte-rt5px1"),F(t,I,2754,18,93742)},m:function(c,u){G(c,t,u),m(t,e),m(t,i),m(t,r)},p:function(c,u){u[0]&8388608&&ke(i,c[23])},d:function(c){c&&h(t)}};return te("SvelteRegisterBlock",{block:n,id:Jn.name,type:"if",source:"(2754:54) ",ctx:a}),n}function Kn(a){let t,e,i,r;const n={c:function(){t=M("div"),e=J("🎵 基音 "),i=J(a[23]),r=J("/8 再生中..."),this.h()},l:function(c){t=R(c,"DIV",{class:!0});var u=j(t);e=W(u,"🎵 基音 "),i=W(u,a[23]),r=W(u,"/8 再生中..."),u.forEach(h),this.h()},h:function(){T(t,"class","status-text svelte-rt5px1"),F(t,I,2750,18,93563)},m:function(c,u){G(c,t,u),m(t,e),m(t,i),m(t,r)},p:function(c,u){u[0]&8388608&&ke(i,c[23])},d:function(c){c&&h(t)}};return te("SvelteRegisterBlock",{block:n,id:Kn.name,type:"if",source:"(2750:16) {#if isPlaying}",ctx:a}),n}function Qn(a){let t;const e={c:function(){t=J("⚡ 連続チャレンジ開始（8セッション）")},l:function(r){t=W(r,"⚡ 連続チャレンジ開始（8セッション）")},m:function(r,n){G(r,t,n)},d:function(r){r&&h(t)}};return te("SvelteRegisterBlock",{block:e,id:Qn.name,type:"slot",source:'(2741:14) <Button                  variant=\\"primary\\"                 on:click={startContinuousMode}               >',ctx:a}),e}function Ht(a){let t,e,i,r,n,s=(a[8]||0).toFixed(1)+"",c,u;const f={c:function(){t=M("div"),e=J("現在の基音: "),i=M("strong"),r=J(a[7]),n=J(" ("),c=J(s),u=J("Hz)"),this.h()},l:function(D){t=R(D,"DIV",{class:!0});var v=j(t);e=W(v,"現在の基音: "),i=R(v,"STRONG",{});var U=j(i);r=W(U,a[7]),U.forEach(h),n=W(v," ("),c=W(v,s),u=W(v,"Hz)"),v.forEach(h),this.h()},h:function(){F(i,I,2771,23,94351),T(t,"class","base-note-info svelte-rt5px1"),F(t,I,2770,14,94299)},m:function(D,v){G(D,t,v),m(t,e),m(t,i),m(i,r),m(t,n),m(t,c),m(t,u)},p:function(D,v){v[0]&128&&ke(r,D[7]),v[0]&256&&s!==(s=(D[8]||0).toFixed(1)+"")&&ke(c,s)},d:function(D){D&&h(t)}};return te("SvelteRegisterBlock",{block:f,id:Ht.name,type:"if",source:"(2770:12) {#if currentBaseNote}",ctx:a}),f}function Xn(a){let t,e,i="🎹 基音再生",r,n,s,c,u,f,A,D,v="ガイド開始まで",U,x,y,g,C,p,d,k;const N=[Gn,On],H=[];function P(b,q){return b[0]==="setup"&&!b[9]&&!(b[23]>1)?0:1}s=P(a),c=H[s]=N[s](a);let _=a[7]&&Ht(a);p=new xn({props:{size:"20"},$$inline:!0});const Z={c:function(){t=M("div"),e=M("h3"),e.textContent=i,r=Y(),n=M("div"),c.c(),u=Y(),_&&_.c(),f=Y(),A=M("div"),D=M("div"),D.textContent=v,U=Y(),x=M("div"),y=M("div"),g=Y(),C=M("div"),ge(p.$$.fragment),this.h()},l:function(q){t=R(q,"DIV",{class:!0});var V=j(t);e=R(V,"H3",{class:!0,"data-svelte-h":!0}),pe(e)!=="svelte-syc53b"&&(e.textContent=i),V.forEach(h),r=X(q),n=R(q,"DIV",{class:!0});var L=j(n);c.l(L),u=X(L),_&&_.l(L),f=X(L),A=R(L,"DIV",{class:!0});var ne=j(A);D=R(ne,"DIV",{class:!0,"data-svelte-h":!0}),pe(D)!=="svelte-1dufnpv"&&(D.textContent=v),U=X(ne),x=R(ne,"DIV",{class:!0});var B=j(x);y=R(B,"DIV",{class:!0,style:!0}),j(y).forEach(h),g=X(B),C=R(B,"DIV",{class:!0});var E=j(C);me(p.$$.fragment,E),E.forEach(h),B.forEach(h),ne.forEach(h),L.forEach(h),this.h()},h:function(){T(e,"class","section-title svelte-rt5px1"),F(e,I,2735,12,92996),T(t,"class","card-header svelte-rt5px1"),F(t,I,2734,10,92958),T(D,"class","guide-start-label svelte-rt5px1"),F(D,I,2777,14,94583),T(y,"class","guide-progress-fill svelte-rt5px1"),Xe(y,"width",a[11]+"%"),F(y,I,2779,16,94688),T(C,"class",d="guide-music-icon "+(a[12]?"glowing":"")+" svelte-rt5px1"),F(C,I,2783,16,94836),T(x,"class","guide-start-bar svelte-rt5px1"),F(x,I,2778,14,94642),T(A,"class","guide-start-bar-container svelte-rt5px1"),F(A,I,2776,12,94529),T(n,"class","card-content svelte-rt5px1"),F(n,I,2737,10,93062)},m:function(q,V){G(q,t,V),m(t,e),G(q,r,V),G(q,n,V),H[s].m(n,null),m(n,u),_&&_.m(n,null),m(n,f),m(n,A),m(A,D),m(A,U),m(A,x),m(x,y),m(x,g),m(x,C),de(p,C,null),k=!0},p:function(q,V){let L=s;s=P(q),s===L?H[s].p(q,V):(He(),oe(H[L],1,1,()=>{H[L]=null}),ze(),c=H[s],c?c.p(q,V):(c=H[s]=N[s](q),c.c()),Q(c,1),c.m(n,u)),q[7]?_?_.p(q,V):(_=Ht(q),_.c(),_.m(n,f)):_&&(_.d(1),_=null),(!k||V[0]&2048)&&Xe(y,"width",q[11]+"%"),(!k||V[0]&4096&&d!==(d="guide-music-icon "+(q[12]?"glowing":"")+" svelte-rt5px1"))&&T(C,"class",d)},i:function(q){k||(Q(c),Q(p.$$.fragment,q),k=!0)},o:function(q){oe(c),oe(p.$$.fragment,q),k=!1},d:function(q){q&&(h(t),h(r),h(n)),H[s].d(),_&&_.d(),fe(p)}};return te("SvelteRegisterBlock",{block:Z,id:Xn.name,type:"slot",source:'(2734:8) <Card class=\\"main-card half-width\\">',ctx:a}),Z}function zt(a){let t,e=(a[99].name||`音階${a[101]+1}`)+"",i,r,n;const s={c:function(){t=M("div"),i=J(e),r=Y(),this.h()},l:function(u){t=R(u,"DIV",{class:!0});var f=j(t);i=W(f,e),r=X(f),f.forEach(h),this.h()},h:function(){T(t,"class",n="scale-item "+(a[99].state||"inactive")+" svelte-rt5px1"),F(t,I,2811,12,95679)},m:function(u,f){G(u,t,f),m(t,i),m(t,r)},p:function(u,f){f[0]&1024&&e!==(e=(u[99].name||`音階${u[101]+1}`)+"")&&ke(i,e),f[0]&1024&&n!==(n="scale-item "+(u[99].state||"inactive")+" svelte-rt5px1")&&T(t,"class",n)},d:function(u){u&&h(t)}};return te("SvelteRegisterBlock",{block:s,id:zt.name,type:"each",source:"(2811:10) {#each scaleSteps as step, index}",ctx:a}),s}function Yn(a){let t,e="基音やリアルタイム周波数表示は総合評価中でも利用できます";const i={c:function(){t=M("div"),t.textContent=e,this.h()},l:function(n){t=R(n,"DIV",{class:!0,"data-svelte-h":!0}),pe(t)!=="svelte-1e5qmlp"&&(t.textContent=e),this.h()},h:function(){T(t,"class","guide-instruction svelte-rt5px1"),F(t,I,2823,10,96072)},m:function(n,s){G(n,t,s)},d:function(n){n&&h(t)}};return te("SvelteRegisterBlock",{block:i,id:Yn.name,type:"if",source:"(2823:46) ",ctx:a}),i}function Zn(a){let t,e,i,r="ドレミファソラシド",n;const s={c:function(){t=M("div"),e=J("ガイドに合わせて "),i=M("strong"),i.textContent=r,n=J(" を歌ってください"),this.h()},l:function(u){t=R(u,"DIV",{class:!0});var f=j(t);e=W(f,"ガイドに合わせて "),i=R(f,"STRONG",{"data-svelte-h":!0}),pe(i)!=="svelte-1dipf74"&&(i.textContent=r),n=W(f," を歌ってください"),f.forEach(h),this.h()},h:function(){F(i,I,2820,21,95962),T(t,"class","guide-instruction svelte-rt5px1"),F(t,I,2819,10,95909)},m:function(u,f){G(u,t,f),m(t,e),m(t,i),m(t,n)},d:function(u){u&&h(t)}};return te("SvelteRegisterBlock",{block:s,id:Zn.name,type:"if",source:"(2819:8) {#if trainingPhase === 'guiding'}",ctx:a}),s}function $n(a){let t,e,i="🎵 ドレミ音階ガイド",r,n,s,c,u=ut(a[10]),f=[];for(let x=0;x<u.length;x+=1)f[x]=zt(Fn(a,u,x));function A(x,y){if(x[0]==="guiding")return Zn;if(x[0]==="results")return Yn}let D=A(a),v=D&&D(a);const U={c:function(){t=M("div"),e=M("h3"),e.textContent=i,r=Y(),n=M("div"),s=M("div");for(let y=0;y<f.length;y+=1)f[y].c();c=Y(),v&&v.c(),this.h()},l:function(y){t=R(y,"DIV",{class:!0});var g=j(t);e=R(g,"H3",{class:!0,"data-svelte-h":!0}),pe(e)!=="svelte-1mor0as"&&(e.textContent=i),g.forEach(h),r=X(y),n=R(y,"DIV",{class:!0});var C=j(n);s=R(C,"DIV",{class:!0});var p=j(s);for(let d=0;d<f.length;d+=1)f[d].l(p);p.forEach(h),c=X(C),v&&v.l(C),C.forEach(h),this.h()},h:function(){T(e,"class","section-title svelte-rt5px1"),F(e,I,2806,8,95500),T(t,"class","card-header svelte-rt5px1"),F(t,I,2805,6,95466),T(s,"class","scale-guide svelte-rt5px1"),F(s,I,2809,8,95597),T(n,"class","card-content svelte-rt5px1"),F(n,I,2808,6,95562)},m:function(y,g){G(y,t,g),m(t,e),G(y,r,g),G(y,n,g),m(n,s);for(let C=0;C<f.length;C+=1)f[C]&&f[C].m(s,null);m(n,c),v&&v.m(n,null)},p:function(y,g){if(g[0]&1024){u=ut(y[10]);let C;for(C=0;C<u.length;C+=1){const p=Fn(y,u,C);f[C]?f[C].p(p,g):(f[C]=zt(p),f[C].c(),f[C].m(s,null))}for(;C<f.length;C+=1)f[C].d(1);f.length=u.length}D!==(D=A(y))&&(v&&v.d(1),v=D&&D(y),v&&(v.c(),v.m(n,null)))},d:function(y){y&&(h(t),h(r),h(n)),An(f,y),v&&v.d()}};return te("SvelteRegisterBlock",{block:U,id:$n.name,type:"slot",source:'(2805:4) <Card class=\\"main-card\\">',ctx:a}),U}function jt(a){let t,e,i,r,n,s,c;const u=[to,eo],f=[];function A(y,g){return y[4]&&y[5]?0:y[21]?1:-1}~(t=A(a))&&(e=f[t]=u[t](a));const D=[oo,no],v=[];function U(y,g){return y[0]==="results"&&y[5]?0:y[0]==="results"&&!y[5]?1:-1}~(r=U(a))&&(n=v[r]=D[r](a));const x={c:function(){e&&e.c(),i=Y(),n&&n.c(),s=je()},l:function(g){e&&e.l(g),i=X(g),n&&n.l(g),s=je()},m:function(g,C){~t&&f[t].m(g,C),G(g,i,C),~r&&v[r].m(g,C),G(g,s,C),c=!0},p:function(g,C){let p=t;t=A(g),t===p?~t&&f[t].p(g,C):(e&&(He(),oe(f[p],1,1,()=>{f[p]=null}),ze()),~t?(e=f[t],e?e.p(g,C):(e=f[t]=u[t](g),e.c()),Q(e,1),e.m(i.parentNode,i)):e=null);let d=r;r=U(g),r===d?~r&&v[r].p(g,C):(n&&(He(),oe(v[d],1,1,()=>{v[d]=null}),ze()),~r?(n=v[r],n?n.p(g,C):(n=v[r]=D[r](g),n.c()),Q(n,1),n.m(s.parentNode,s)):n=null)},i:function(g){c||(Q(e),Q(n),c=!0)},o:function(g){oe(e),oe(n),c=!1},d:function(g){g&&(h(i),h(s)),~t&&f[t].d(g),~r&&v[r].d(g)}};return te("SvelteRegisterBlock",{block:x,id:jt.name,type:"if",source:"(2833:4) {#if trainingPhase === 'results'}",ctx:a}),x}function eo(a){let t,e;t=new Ut({props:{scoreData:a[21],showDetails:!1,className:"mb-6 iphone-no-margin",currentScoreData:a[16],intervalData:a[3],consistencyData:a[17],feedbackData:a[18],technicalFeedbackData:a[19],sessionStatistics:a[20]},$$inline:!0});const i={c:function(){ge(t.$$.fragment)},l:function(n){me(t.$$.fragment,n)},m:function(n,s){de(t,n,s),e=!0},p:function(n,s){const c={};s[0]&2097152&&(c.scoreData=n[21]),s[0]&65536&&(c.currentScoreData=n[16]),s[0]&8&&(c.intervalData=n[3]),s[0]&131072&&(c.consistencyData=n[17]),s[0]&262144&&(c.feedbackData=n[18]),s[0]&524288&&(c.technicalFeedbackData=n[19]),s[0]&1048576&&(c.sessionStatistics=n[20]),t.$set(c)},i:function(n){e||(Q(t.$$.fragment,n),e=!0)},o:function(n){oe(t.$$.fragment,n),e=!1},d:function(n){fe(t,n)}};return te("SvelteRegisterBlock",{block:i,id:eo.name,type:"if",source:"(2850:40) ",ctx:a}),i}function to(a){let t,e,i,r=a[4]&&Lt(a);e=new Ut({props:{scoreData:a[4],showDetails:!1,className:"mb-6 iphone-no-margin",currentScoreData:a[16],intervalData:a[3],consistencyData:a[17],feedbackData:a[18],technicalFeedbackData:a[19],sessionStatistics:a[20]},$$inline:!0});const n={c:function(){r&&r.c(),t=Y(),ge(e.$$.fragment)},l:function(c){r&&r.l(c),t=X(c),me(e.$$.fragment,c)},m:function(c,u){r&&r.m(c,u),G(c,t,u),de(e,c,u),i=!0},p:function(c,u){c[4]?r||(r=Lt(c),r.c(),r.m(t.parentNode,t)):r&&(r.d(1),r=null);const f={};u[0]&16&&(f.scoreData=c[4]),u[0]&65536&&(f.currentScoreData=c[16]),u[0]&8&&(f.intervalData=c[3]),u[0]&131072&&(f.consistencyData=c[17]),u[0]&262144&&(f.feedbackData=c[18]),u[0]&524288&&(f.technicalFeedbackData=c[19]),u[0]&1048576&&(f.sessionStatistics=c[20]),e.$set(f)},i:function(c){i||(Q(e.$$.fragment,c),i=!0)},o:function(c){oe(e.$$.fragment,c),i=!1},d:function(c){c&&h(t),r&&r.d(c),fe(e,c)}};return te("SvelteRegisterBlock",{block:n,id:to.name,type:"if",source:"(2835:6) {#if $unifiedScoreData && $isCompleted}",ctx:a}),n}function Lt(a){const t={c:Je,l:Je,m:Je,d:Je};return te("SvelteRegisterBlock",{block:t,id:Lt.name,type:"if",source:"(2837:8) {#if $unifiedScoreData}",ctx:a}),t}function no(a){let t,e;t=new Ke({props:{class:"main-card bottom-action-card",$$slots:{default:[ro]},$$scope:{ctx:a}},$$inline:!0});const i={c:function(){ge(t.$$.fragment)},l:function(n){me(t.$$.fragment,n)},m:function(n,s){de(t,n,s),e=!0},p:function(n,s){const c={};s[3]&4096&&(c.$$scope={dirty:s,ctx:n}),t.$set(c)},i:function(n){e||(Q(t.$$.fragment,n),e=!0)},o:function(n){oe(t.$$.fragment,n),e=!1},d:function(n){fe(t,n)}};return te("SvelteRegisterBlock",{block:i,id:no.name,type:"if",source:"(2879:61) ",ctx:a}),i}function oo(a){let t,e;t=new Ke({props:{class:"main-card bottom-action-card",$$slots:{default:[so]},$$scope:{ctx:a}},$$inline:!0});const i={c:function(){ge(t.$$.fragment)},l:function(n){me(t.$$.fragment,n)},m:function(n,s){de(t,n,s),e=!0},p:function(n,s){const c={};s[0]&32|s[3]&4096&&(c.$$scope={dirty:s,ctx:n}),t.$set(c)},i:function(n){e||(Q(t.$$.fragment,n),e=!0)},o:function(n){oe(t.$$.fragment,n),e=!1},d:function(n){fe(t,n)}};return te("SvelteRegisterBlock",{block:i,id:oo.name,type:"if",source:"(2868:6) {#if trainingPhase === 'results' && $isCompleted}",ctx:a}),i}function ro(a){let t,e,i,r,n,s,c="次のセッションを準備中...";const u={c:function(){t=M("div"),e=M("div"),i=M("div"),r=M("div"),n=Y(),s=M("span"),s.textContent=c,this.h()},l:function(A){t=R(A,"DIV",{class:!0});var D=j(t);e=R(D,"DIV",{class:!0});var v=j(e);i=R(v,"DIV",{class:!0});var U=j(i);r=R(U,"DIV",{class:!0}),j(r).forEach(h),n=X(U),s=R(U,"SPAN",{"data-svelte-h":!0}),pe(s)!=="svelte-11jhwau"&&(s.textContent=c),U.forEach(h),v.forEach(h),D.forEach(h),this.h()},h:function(){T(r,"class","spinner"),F(r,I,2884,16,98196),F(s,I,2885,16,98240),T(i,"class","auto-progress-indicator"),F(i,I,2883,14,98142),T(e,"class","continuous-mode-message"),F(e,I,2882,12,98090),T(t,"class","card-content svelte-rt5px1"),F(t,I,2881,10,98051)},m:function(A,D){G(A,t,D),m(t,e),m(e,i),m(i,r),m(i,n),m(i,s)},p:Je,d:function(A){A&&h(t)}};return te("SvelteRegisterBlock",{block:u,id:ro.name,type:"slot",source:'(2881:8) <Card class=\\"main-card bottom-action-card\\">',ctx:a}),u}function so(a){let t,e,i;e=new Gt({props:{isCompleted:a[5],position:"bottom"},$$inline:!0}),e.$on("action",a[29]);const r={c:function(){t=M("div"),ge(e.$$.fragment),this.h()},l:function(s){t=R(s,"DIV",{class:!0});var c=j(t);me(e.$$.fragment,c),c.forEach(h),this.h()},h:function(){T(t,"class","card-content svelte-rt5px1"),F(t,I,2869,10,97609)},m:function(s,c){G(s,t,c),de(e,t,null),i=!0},p:function(s,c){const u={};c[0]&32&&(u.isCompleted=s[5]),e.$set(u)},i:function(s){i||(Q(e.$$.fragment,s),i=!0)},o:function(s){oe(e.$$.fragment,s),i=!1},d:function(s){s&&h(t),fe(e)}};return te("SvelteRegisterBlock",{block:r,id:so.name,type:"slot",source:'(2869:8) <Card class=\\"main-card bottom-action-card\\">',ctx:a}),r}function ao(a){let t,e,i="⚡ 連続チャレンジモード",r,n,s="中級者向け：8セッション連続で基音が自動再生される集中トレーニング",c,u,f,A,D=co+"",v,U,x=io+"",y,g,C,p,d=lo+"",k,N,H,P,_,Z,b=a[1]==="granted"&&!a[25]&&Pt(a);const q=[Vn,Bn],V=[];function L(B,E){return B[1]==="granted"?0:1}H=L(a),P=V[H]=q[H](a);const ne={c:function(){t=M("div"),e=M("h1"),e.textContent=i,r=Y(),n=M("p"),n.textContent=s,c=Y(),b&&b.c(),u=Y(),f=M("div"),A=J("📱 "),v=J(D),U=J(" | "),y=J(x),g=M("br"),C=Y(),p=M("small"),k=J(d),N=Y(),P.c(),_=je(),this.h()},l:function(E){t=R(E,"DIV",{class:!0});var $=j(t);e=R($,"H1",{class:!0,"data-svelte-h":!0}),pe(e)!=="svelte-1nub9gt"&&(e.textContent=i),r=X($),n=R($,"P",{class:!0,"data-svelte-h":!0}),pe(n)!=="svelte-gneggn"&&(n.textContent=s),c=X($),b&&b.l($),u=X($),f=R($,"DIV",{class:!0});var K=j(f);A=W(K,"📱 "),v=W(K,D),U=W(K," | "),y=W(K,x),g=R(K,"BR",{}),C=X(K),p=R(K,"SMALL",{style:!0});var ye=j(p);k=W(ye,d),ye.forEach(h),K.forEach(h),$.forEach(h),N=X(E),P.l(E),_=je(),this.h()},h:function(){T(e,"class","page-title svelte-rt5px1"),F(e,I,2650,4,90060),T(n,"class","page-description svelte-rt5px1"),F(n,I,2651,4,90105),F(g,I,2685,54,91341),Xe(p,"font-size","0.6rem"),F(p,I,2686,6,91353),T(f,"class","debug-info svelte-rt5px1"),F(f,I,2684,4,91262),T(t,"class","header-section svelte-rt5px1"),F(t,I,2649,2,90027)},m:function(E,$){G(E,t,$),m(t,e),m(t,r),m(t,n),m(t,c),b&&b.m(t,null),m(t,u),m(t,f),m(f,A),m(f,v),m(f,U),m(f,y),m(f,g),m(f,C),m(f,p),m(p,k),G(E,N,$),V[H].m(E,$),G(E,_,$),Z=!0},p:function(E,$){E[1]==="granted"&&!E[25]?b?(b.p(E,$),$[0]&33554434&&Q(b,1)):(b=Pt(E),b.c(),Q(b,1),b.m(t,u)):b&&(He(),oe(b,1,1,()=>{b=null}),ze());let K=H;H=L(E),H===K?V[H].p(E,$):(He(),oe(V[K],1,1,()=>{V[K]=null}),ze(),P=V[H],P?P.p(E,$):(P=V[H]=q[H](E),P.c()),Q(P,1),P.m(_.parentNode,_))},i:function(E){Z||(Q(b),Q(P),Z=!0)},o:function(E){oe(b),oe(P),Z=!1},d:function(E){E&&(h(t),h(N),h(_)),b&&b.d(),V[H].d(E)}};return te("SvelteRegisterBlock",{block:ne,id:ao.name,type:"slot",source:"(2648:0) <PageLayout>",ctx:a}),ne}function Ot(a){let t,e,i;e=new Tn({props:{$$slots:{default:[ao]},$$scope:{ctx:a}},$$inline:!0});const r={c:function(){t=Y(),ge(e.$$.fragment),this.h()},l:function(s){qo("svelte-13kpo59",kn.head).forEach(h),t=X(s),me(e.$$.fragment,s),this.h()},h:function(){kn.title="連続チャレンジモード - 相対音感トレーニング"},m:function(s,c){G(s,t,c),de(e,s,c),i=!0},p:function(s,c){const u={};c[0]&67108863|c[3]&4096&&(u.$$scope={dirty:c,ctx:s}),e.$set(u)},i:function(s){i||(Q(e.$$.fragment,s),i=!0)},o:function(s){oe(e.$$.fragment,s),i=!1},d:function(s){s&&h(t),fe(e,s)}};return te("SvelteRegisterBlock",{block:r,id:Ot.name,type:"component",source:"",ctx:a}),r}const co="v2.3.1-ANIMATED",io="07/29 04:15",lo="🎬 評価分布アニメーション実装・UX向上";function Mn(){const a=/iPhone/.test(navigator.userAgent),t=/iPad/.test(navigator.userAgent),e=/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document;return a||t||e?(console.log("🔊 [RandomTraining] iOS/iPadOS検出 - 音量35dB設定"),35):(console.log("🔊 [RandomTraining] PC検出 - 音量-6dB設定"),-6)}function Jo(){return{mode:"continuous",timestamp:new Date,duration:480,totalNotes:64,measuredNotes:59,averageAccuracy:79,baseNote:"C5",baseFrequency:523.25,sessionHistory:[{grade:"excellent",accuracy:92,baseNote:"C4",baseFrequency:261.63,timestamp:new Date(Date.now()-7*6e4),measuredNotes:8,noteResults:[{name:"ド",note:"ド",frequency:262,detectedFrequency:264,cents:13,grade:"excellent"},{name:"レ",note:"レ",frequency:294,detectedFrequency:291,cents:-18,grade:"good"},{name:"ミ",note:"ミ",frequency:330,detectedFrequency:335,cents:26,grade:"pass"},{name:"ファ",note:"ファ",frequency:349,detectedFrequency:346,cents:-15,grade:"excellent"},{name:"ソ",note:"ソ",frequency:392,detectedFrequency:388,cents:-18,grade:"good"},{name:"ラ",note:"ラ",frequency:440,detectedFrequency:444,cents:16,grade:"good"},{name:"シ",note:"シ",frequency:494,detectedFrequency:499,cents:17,grade:"good"},{name:"ド（高）",note:"ド（高）",frequency:523,detectedFrequency:520,cents:-10,grade:"excellent"}]},{grade:"good",accuracy:78,baseNote:"D4",baseFrequency:293.66,timestamp:new Date(Date.now()-6*6e4),measuredNotes:7,noteResults:[{name:"ド",note:"ド",frequency:294,detectedFrequency:290,cents:-23,grade:"good"},{name:"レ",note:"レ",frequency:330,detectedFrequency:340,cents:53,grade:"needWork"},{name:"ミ",note:"ミ",frequency:370,detectedFrequency:375,cents:23,grade:"good"},{name:"ファ",note:"ファ",frequency:392,detectedFrequency:385,cents:-31,grade:"pass"},{name:"ソ",note:"ソ",frequency:440,detectedFrequency:432,cents:-31,grade:"pass"},{name:"ラ",note:"ラ",frequency:494,detectedFrequency:510,cents:56,grade:"needWork"},{name:"シ",note:"シ",frequency:554,detectedFrequency:null,cents:null,grade:"notMeasured"},{name:"ド（高）",note:"ド（高）",frequency:587,detectedFrequency:580,cents:-21,grade:"good"}]},{grade:"excellent",accuracy:95,baseNote:"E4",baseFrequency:329.63,timestamp:new Date(Date.now()-5*6e4),measuredNotes:8,noteResults:[{name:"ド",note:"ド",frequency:330,detectedFrequency:332,cents:10,grade:"excellent"},{name:"レ",note:"レ",frequency:370,detectedFrequency:368,cents:-9,grade:"excellent"},{name:"ミ",note:"ミ",frequency:415,detectedFrequency:418,cents:12,grade:"excellent"},{name:"ファ",note:"ファ",frequency:440,detectedFrequency:436,cents:-16,grade:"good"},{name:"ソ",note:"ソ",frequency:494,detectedFrequency:497,cents:11,grade:"excellent"},{name:"ラ",note:"ラ",frequency:554,detectedFrequency:551,cents:-9,grade:"excellent"},{name:"シ",note:"シ",frequency:622,detectedFrequency:625,cents:8,grade:"excellent"},{name:"ド（高）",note:"ド（高）",frequency:659,detectedFrequency:655,cents:-10,grade:"excellent"}]},{grade:"needWork",accuracy:45,baseNote:"F4",baseFrequency:349.23,timestamp:new Date(Date.now()-4*6e4),measuredNotes:6,noteResults:[{name:"ド",note:"ド",frequency:349,detectedFrequency:345,cents:-20,grade:"good"},{name:"レ",note:"レ",frequency:392,detectedFrequency:420,cents:124,grade:"needWork"},{name:"ミ",note:"ミ",frequency:440,detectedFrequency:435,cents:-20,grade:"good"},{name:"ファ",note:"ファ",frequency:466,detectedFrequency:520,cents:195,grade:"needWork"},{name:"ソ",note:"ソ",frequency:523,detectedFrequency:410,cents:-455,grade:"needWork"},{name:"ラ",note:"ラ",frequency:587,detectedFrequency:null,cents:null,grade:"notMeasured"},{name:"シ",note:"シ",frequency:659,detectedFrequency:650,cents:-24,grade:"good"},{name:"ド（高）",note:"ド（高）",frequency:698,detectedFrequency:null,cents:null,grade:"notMeasured"}]},{grade:"good",accuracy:85,baseNote:"G4",baseFrequency:392,timestamp:new Date(Date.now()-3*6e4),measuredNotes:8,noteResults:[{name:"ド",note:"ド",frequency:392,detectedFrequency:395,cents:13,grade:"excellent"},{name:"レ",note:"レ",frequency:440,detectedFrequency:438,cents:-8,grade:"excellent"},{name:"ミ",note:"ミ",frequency:494,detectedFrequency:500,cents:21,grade:"good"},{name:"ファ",note:"ファ",frequency:523,detectedFrequency:520,cents:-10,grade:"excellent"},{name:"ソ",note:"ソ",frequency:587,detectedFrequency:595,cents:24,grade:"good"},{name:"ラ",note:"ラ",frequency:659,detectedFrequency:665,cents:16,grade:"good"},{name:"シ",note:"シ",frequency:740,detectedFrequency:755,cents:35,grade:"pass"},{name:"ド（高）",note:"ド（高）",frequency:784,detectedFrequency:780,cents:-9,grade:"excellent"}]},{grade:"excellent",accuracy:94,baseNote:"A4",baseFrequency:440,timestamp:new Date(Date.now()-2*6e4),measuredNotes:8,noteResults:[{name:"ド",note:"ド",frequency:440,detectedFrequency:442,cents:8,grade:"excellent"},{name:"レ",note:"レ",frequency:494,detectedFrequency:492,cents:-7,grade:"excellent"},{name:"ミ",note:"ミ",frequency:554,detectedFrequency:558,cents:12,grade:"excellent"},{name:"ファ",note:"ファ",frequency:587,detectedFrequency:585,cents:-6,grade:"excellent"},{name:"ソ",note:"ソ",frequency:659,detectedFrequency:665,cents:16,grade:"good"},{name:"ラ",note:"ラ",frequency:740,detectedFrequency:738,cents:-5,grade:"excellent"},{name:"シ",note:"シ",frequency:831,detectedFrequency:840,cents:19,grade:"good"},{name:"ド（高）",note:"ド（高）",frequency:880,detectedFrequency:882,cents:4,grade:"excellent"}]},{grade:"pass",accuracy:68,baseNote:"Bb4",baseFrequency:466.16,timestamp:new Date(Date.now()-1*6e4),measuredNotes:7,noteResults:[{name:"ド",note:"ド",frequency:466,detectedFrequency:470,cents:15,grade:"excellent"},{name:"レ",note:"レ",frequency:523,detectedFrequency:535,cents:39,grade:"pass"},{name:"ミ",note:"ミ",frequency:587,detectedFrequency:600,cents:38,grade:"pass"},{name:"ファ",note:"ファ",frequency:622,detectedFrequency:615,cents:-19,grade:"good"},{name:"ソ",note:"ソ",frequency:698,detectedFrequency:720,cents:54,grade:"needWork"},{name:"ラ",note:"ラ",frequency:784,detectedFrequency:null,cents:null,grade:"notMeasured"},{name:"シ",note:"シ",frequency:880,detectedFrequency:895,cents:29,grade:"pass"},{name:"ド（高）",note:"ド（高）",frequency:932,detectedFrequency:925,cents:-13,grade:"excellent"}]},{grade:"good",accuracy:82,baseNote:"C5",baseFrequency:523.25,timestamp:new Date,measuredNotes:8,noteResults:[{name:"ド",note:"ド",frequency:523,detectedFrequency:526,cents:10,grade:"excellent"},{name:"レ",note:"レ",frequency:587,detectedFrequency:584,cents:-9,grade:"excellent"},{name:"ミ",note:"ミ",frequency:659,detectedFrequency:665,cents:16,grade:"good"},{name:"ファ",note:"ファ",frequency:698,detectedFrequency:692,cents:-15,grade:"excellent"},{name:"ソ",note:"ソ",frequency:784,detectedFrequency:795,cents:24,grade:"good"},{name:"ラ",note:"ラ",frequency:880,detectedFrequency:890,cents:19,grade:"good"},{name:"シ",note:"シ",frequency:988,detectedFrequency:1010,cents:38,grade:"pass"},{name:"ド（高）",note:"ド（高）",frequency:1047,detectedFrequency:1042,cents:-8,grade:"excellent"}]}]}}function Tt(a){return[{scale:"ド",interval:"unison",intervalName:"ユニゾン"},{scale:"レ",interval:"major_second",intervalName:"長2度"},{scale:"ミ",interval:"major_third",intervalName:"長3度"},{scale:"ファ",interval:"perfect_fourth",intervalName:"完全4度"},{scale:"ソ",interval:"perfect_fifth",intervalName:"完全5度"},{scale:"ラ",interval:"major_sixth",intervalName:"長6度"},{scale:"シ",interval:"major_seventh",intervalName:"長7度"},{scale:"ド（高）",interval:"octave",intervalName:"オクターブ"}].map((e,i)=>{const r=a.find(n=>n.targetNote&&n.targetNote.includes(e.scale))||a[i];if(r&&r.accuracy!=="notMeasured"){const n=parseFloat(r.accuracy)||0,s=Math.round((100-n)*.5);return{type:e.interval,scale:e.scale,intervalName:e.intervalName,attempts:1,averageError:s,accuracy:n}}else return{type:e.interval,scale:e.scale,intervalName:e.intervalName,attempts:0,averageError:null,accuracy:0}})}function In(a){if(!a||!Array.isArray(a))return console.warn("⚠️ [RandomTraining] sessionHistory が無効です"),[];const t=[{type:"unison",scale:"ド",intervalName:"ユニゾン",noteIndex:0},{type:"major_second",scale:"レ",intervalName:"長2度",noteIndex:1},{type:"major_third",scale:"ミ",intervalName:"長3度",noteIndex:2},{type:"perfect_fourth",scale:"ファ",intervalName:"完全4度",noteIndex:3},{type:"perfect_fifth",scale:"ソ",intervalName:"完全5度",noteIndex:4},{type:"major_sixth",scale:"ラ",intervalName:"長6度",noteIndex:5},{type:"major_seventh",scale:"シ",intervalName:"長7度",noteIndex:6},{type:"octave",scale:"ド（高）",intervalName:"オクターブ",noteIndex:7}],e={};return t.forEach(i=>{e[i.type]={type:i.type,scale:i.scale,intervalName:i.intervalName,attempts:0,successCount:0,accuracySum:0,accuracyValues:[],errorValues:[]}}),a.forEach(i=>{!i.noteResults||!Array.isArray(i.noteResults)||i.noteResults.forEach((r,n)=>{if(n>=t.length)return;const s=t[n].type,c=e[s];if(c.attempts++,r.accuracy!=="notMeasured"&&typeof r.accuracy=="number"){c.accuracyValues.push(r.accuracy),c.accuracySum+=r.accuracy;const u=Math.round((100-r.accuracy)*.5);c.errorValues.push(u),r.accuracy>=70&&c.successCount++}})}),t.map(i=>{const r=e[i.type];if(r.attempts===0)return{type:i.type,scale:i.scale,intervalName:i.intervalName,attempts:0,averageError:null,accuracy:0};const n=r.accuracyValues.length>0?Math.round(r.accuracySum/r.accuracyValues.length):0,s=r.errorValues.length>0?Math.round(r.errorValues.reduce((u,f)=>u+f,0)/r.errorValues.length):null,c=r.accuracyValues.length>0?Math.round(r.successCount/r.accuracyValues.length*100):0;return{type:i.type,scale:i.scale,intervalName:i.intervalName,mastery:c,attempts:r.attempts,averageError:s,accuracy:n}})}function Nn(a){const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];if(a<=0)return"ーー";const i=Math.round(12*Math.log2(a/440)),r=(i+9+120)%12,n=Math.floor((i+9)/12)+4;return t[r]+n}function Et(a,t){const e=[{factor:4,freq:a*4,description:"2オクターブ上"},{factor:3,freq:a*3,description:"1.5オクターブ上"},{factor:2.5,freq:a*2.5,description:"1.3オクターブ上"},{factor:2,freq:a*2,description:"1オクターブ上"},{factor:1.5,freq:a*1.5,description:"0.5オクターブ上"},{factor:1,freq:a,description:"補正なし"},{factor:.75,freq:a*.75,description:"0.33オクターブ下"},{factor:.67,freq:a*.67,description:"0.5オクターブ下"},{factor:.5,freq:a*.5,description:"1オクターブ下"},{factor:.4,freq:a*.4,description:"1.3オクターブ下"},{factor:.33,freq:a*.33,description:"1.5オクターブ下"},{factor:.25,freq:a*.25,description:"2オクターブ下"}];let i=null,r=1/0;const n=t*.5,s=t*1.5,c=e.filter(u=>u.freq>=n&&u.freq<=s);for(const u of c){const f=Math.abs(u.freq-t);f<r&&(r=f,i=u)}if(!i)for(const u of e){const f=Math.abs(u.freq-t);f<r&&(r=f,i=u)}return i?{correctedFrequency:i.freq,factor:i.factor,description:i.description,error:r}:{correctedFrequency:a,factor:1,description:"補正なし（フォールバック）",error:Math.abs(a-t)}}function rt(){try{"scrollTo"in window&&"behavior"in document.documentElement.style?window.scrollTo({top:0,behavior:"smooth"}):window.scrollTo(0,0),document.body&&(document.body.scrollTop=0),document.documentElement&&(document.documentElement.scrollTop=0),document.querySelectorAll("[data-scroll-container], .scroll-container, main").forEach(t=>{t.scrollTo?t.scrollTo(0,0):t.scrollTop=0})}catch(a){console.warn("スクロールエラー:",a);try{window.scroll(0,0)}catch(t){console.error("スクロール完全失敗:",t)}}}function uo(a){}function Ko(a,t,e){let i,r,n,s,c,u,f,A,D,v,U,x;Ie(It,"currentSessionId"),Ne(a,It,o=>e(23,n=o)),Ie(qt,"unifiedScoreData"),Ne(a,qt,o=>e(4,s=o)),Ie(kt,"isCompleted"),Ne(a,kt,o=>e(5,c=o)),Ie(St,"page"),Ne(a,St,o=>e(54,u=o)),Ie(wt,"remainingSessions"),Ne(a,wt,o=>e(55,f=o)),Ie(Rt,"nextBaseName"),Ne(a,Rt,o=>e(56,A=o)),Ie(Mt,"nextBaseNote"),Ne(a,Mt,o=>e(57,D=o)),Ie(Ct,"sessionHistory"),Ne(a,Ct,o=>e(24,v=o)),Ie(Nt,"trainingProgress"),Ne(a,Nt,o=>e(58,U=o)),Ie(Ft,"isLoading"),Ne(a,Ft,o=>e(25,x=o));let{$$slots:y={},$$scope:g}=t;Do("Page",y,[]);function C(o){return ot.evaluateOverall(o)}let p="setup",d=typeof window<"u"?new URLSearchParams(window.location.search).get("from")==="microphone-test"?(ie.info("[RandomTraining] マイクテストページからの遷移を検出"),"granted"):(ie.info("[RandomTraining] ダイレクトアクセスを検出"),"checking"):"checking",k=!0,N=[];const H=["ド","レ","ミ","ファ","ソ","ラ","シ","ド（高）"];let P="",_=0,Z=!1,b=0,q=H.map(o=>({name:o,state:"inactive",completed:!1})),V=null,L=!1,ne=0,B=!1,E=null,$=!1,K=[],ye=[],Se=0,Ae=0,Le="ーー",xe=0,Be={correctCount:0,totalCount:8,averageAccuracy:0,averageTime:0,isCompleted:!1},we=null,Ve={totalScore:0,grade:"C",componentScores:{pitchAccuracy:0,recognitionSpeed:0,intervalMastery:0,directionAccuracy:0,consistency:0}},Ce=[],Te=[],Oe={},Ye={},Fe={totalAttempts:0,successRate:0,averageScore:0,bestScore:0,sessionDuration:0,streakCount:0,fatigueLevel:"fresh",mostDifficultInterval:"-",mostSuccessfulInterval:"-",averageResponseTime:0,sessionStart:Date.now()},dt="intervals",ae=[],ue=null,he=null,Re=!0,ee=null,Ee=null,st=null,at=null,Qe=null;const Ge=[{note:"C4",name:"ド（中）",frequency:261.63,semitonesFromC:0},{note:"Db4",name:"ド#（中）",frequency:277.18,semitonesFromC:1},{note:"D4",name:"レ（中）",frequency:293.66,semitonesFromC:2},{note:"Eb4",name:"レ#（中）",frequency:311.13,semitonesFromC:3},{note:"E4",name:"ミ（中）",frequency:329.63,semitonesFromC:4},{note:"F4",name:"ファ（中）",frequency:349.23,semitonesFromC:5},{note:"Gb4",name:"ファ#（中）",frequency:369.99,semitonesFromC:6},{note:"Ab4",name:"ラb（中）",frequency:415.3,semitonesFromC:8},{note:"Bb3",name:"シb（低）",frequency:233.08,semitonesFromC:-2},{note:"B3",name:"シ（低）",frequency:246.94,semitonesFromC:-1}];async function Ue(){var o;e(1,d="checking");try{if(console.log("🎤 [RandomTraining] AudioManager経由でマイク許可確認開始"),!((o=navigator.mediaDevices)!=null&&o.getUserMedia)){e(1,d="error");return}const l=await We.initialize();st=l.audioContext,Ee=l.mediaStream,at=l.sourceNode,console.log("✅ [RandomTraining] AudioManager リソース取得完了"),e(1,d="granted"),e(0,p="setup"),setTimeout(async()=>{if(ee){ie.audio("[RandomTraining] PitchDetector初期化開始");const S=/iPhone/.test(navigator.userAgent),w=/iPad/.test(navigator.userAgent),z=/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document;(w||z)&&(console.log("🔧 [RandomTraining] iPad検出 - マイク感度7.0x自動設定開始"),We.setSensitivity(7),console.log("✅ [RandomTraining] iPad マイク感度7.0x自動設定完了"));try{console.log("🎤 [RandomTraining] AudioManager再初期化開始（iPad対応）"),await We.initialize(),console.log("✅ [RandomTraining] AudioManager再初期化完了")}catch(O){console.warn("⚠️ AudioManager再初期化エラー:",O)}await ee.initialize(),ie.audio("[RandomTraining] PitchDetector初期化完了")}},200)}catch(l){ie.error("[RandomTraining] マイク許可エラー:",l),e(1,d=(l==null?void 0:l.name)==="NotAllowedError"?"denied":"error")}}function mt(){const o=D,l=A,S=Ge.find(w=>w.note===o)||Ge.find(w=>w.name===l)||Ge[0];if(e(7,P=S.name),e(8,_=S.frequency),ie.info(`[BaseNote] 基音設定（localStorage連携）: ${P} = ${_}Hz`),ie.info(`[BaseNote] localStorage基音情報: note=${o}, name=${l}`),!_||_<=0)throw ie.error("[BaseNote] 基音周波数設定エラー:",S),new Error(`Invalid base frequency: ${_}`)}async function Wt(){if(Z||!he||Re)return;if(d!=="granted"){console.log("🎤 [RandomTraining] マイク許可が必要です。許可取得を開始...");try{await Ue(),console.log("🎤 [RandomTraining] マイク許可取得完了")}catch(l){console.error("❌ マイク許可エラー:",l);return}}if(!Ee&&d==="granted"){console.log("🎤 [RandomTraining] AudioManagerリソース未初期化のため取得します");try{await Ue()}catch(l){console.error("❌ AudioManagerリソース初期化エラー:",l);return}}else Ee&&console.log("🎤 [RandomTraining] AudioManagerリソース既存のため再利用");e(9,Z=!0),e(0,p="listening"),Qe=Date.now(),mt();const o=Ge.find(l=>l.name===P).note;he.triggerAttackRelease(o,2,At(),.7),setTimeout(()=>{e(9,Z=!1),e(0,p="waiting"),setTimeout(()=>yt(),500)},2e3)}async function Jt(){if(Z||!he||x||!P)return;if(d!=="granted"){console.log("🎤 [RandomTraining] マイク許可が必要です。許可取得を開始...");try{await Ue(),console.log("🎤 [RandomTraining] マイク許可取得完了")}catch(l){console.error("❌ マイク許可エラー:",l);return}}if(!Ee&&d==="granted"){console.log("🎤 [RandomTraining] AudioManagerリソース未初期化のため取得します");try{await Ue()}catch(l){console.error("❌ AudioManagerリソース初期化エラー:",l);return}}else Ee&&console.log("🎤 [RandomTraining] AudioManagerリソース既存のため再利用");if(e(9,Z=!0),e(0,p="listening"),Qe=Date.now(),typeof window<"u"&&window.Tone){const l=window.Tone.context||window.Tone.getContext();l&&l.state==="suspended"&&(console.log("🔄 [RandomTraining] AudioContext suspended検出 - 再開中..."),await l.resume(),console.log("✅ [RandomTraining] AudioContext再開完了"))}const o=Ge.find(l=>l.name===P).note;he.triggerAttackRelease(o,2,At(),.7),setTimeout(()=>{e(9,Z=!1),e(0,p="waiting"),setTimeout(()=>yt(),500)},2e3)}async function fo(){if(Z||!he||x||!P){console.log("🔄 [BaseNoteOnly] 再生条件未満: isPlaying:",Z,"sampler:",!!he,"isLoading:",x,"currentBaseNote:",P);return}if(console.log("🎵 [BaseNoteOnly] 基音のみ再生開始:",P),typeof window<"u"&&window.Tone){const l=window.Tone.context||window.Tone.getContext();l&&l.state==="suspended"&&(console.log("🔄 [BaseNoteOnly] AudioContext suspended検出 - 再開中..."),await l.resume(),console.log("✅ [BaseNoteOnly] AudioContext再開完了"))}const o=Ge.find(l=>l.name===P).note;he.triggerAttackRelease(o,1.5,At(),.7),console.log("🎵 [BaseNoteOnly] 基音再生完了:",o)}function gt(){P&&_>0?Jt():Wt(),Kt()}function Kt(){E&&clearInterval(E),e(11,ne=0),B=!0,e(12,$=!1),console.log("🎵 [GuideStartBar] ガイドスタートバー開始"),E=setInterval(()=>{e(11,ne+=2.5),ne>=100&&(e(11,ne=100),e(12,$=!0),console.log("🎵 [GuideStartBar] ガイド開始タイミング！"),setTimeout(()=>{B=!1,e(12,$=!1),e(11,ne=0)},800),clearInterval(E),E=null)},50)}function mo(){E&&(clearInterval(E),E=null),B=!1,e(12,$=!1),e(11,ne=0)}function Ze(o,l){const w=[0,2,4,5,7,9,11,12][l],z=o*Math.pow(2,w/12);return ie.debug(`[calculateExpectedFrequency] ${q[l].name}: 基音${o.toFixed(1)}Hz + ${w}半音 = ${z.toFixed(1)}Hz`),z}function Qt(o,l){return Ze(o,l)}function yt(){e(0,p="guiding"),b=0,L=!0,K=[],console.log(`🎬 ガイド開始: ${P} (${_.toFixed(1)}Hz)`);function o(){if(b<q.length){b>0&&e(10,q[b-1].state="inactive",q),e(10,q[b].state="active",q);const l=Qt(_,b);bt.setScaleContext({baseFrequency:_,currentScale:q[b].name,targetFrequency:l}),console.log(`🎵 [Scale] 基音:${P}(${_.toFixed(0)}Hz) 現在:${q[b].name} 目標:${l.toFixed(0)}Hz`),b>=4&&console.log(`🔍 [デバッグ] Step ${b}: currentBaseFrequency=${_}, currentBaseNote='${P}'`),b++,V=setTimeout(()=>{o()},600)}else Xt()}o()}function Xt(){L=!1,console.log(`🏁 ガイド完了: ${K.length}/${q.length}ステップ評価`),q.length>0&&e(10,q[q.length-1].state="inactive",q),ee&&ee.stopDetection(),bt.clearContext(),Yt(),nn(),dn(),ae=H.map(o=>{const l=K.find(S=>S.stepName===o);return l?{name:l.stepName,cents:l.adjustedFrequency?Math.round(l.centDifference):null,targetFreq:l.expectedFrequency,detectedFreq:l.adjustedFrequency||null,diff:l.adjustedFrequency?l.adjustedFrequency-l.expectedFrequency:null,accuracy:l.accuracy}:{name:o,cents:null,targetFreq:null,detectedFreq:null,diff:null,accuracy:"notMeasured"}}),rn(),an(),e(0,p="results")}function Yt(){let o=0,l=0;K.forEach((z,O)=>{z.isCorrect&&o++,l+=z.accuracy});const S=K.length>0?Math.round(l/K.length):0,w=Math.round(o/q.length*100);Be={correctCount:o,totalCount:q.length,averageAccuracy:S,averageTime:0,isCompleted:!0},console.log(`🎯 結果: ${o}/${q.length}正解 (${w}%) 平均精度${S}%`),K.length>0&&(ye=[...K])}function go(){switch(p){case"setup":return Re||!he?"🎵 音源読み込み中...":"🎤 マイク準備完了 - トレーニング開始可能";case"listening":return"🎵 基音再生中...";case"waiting":return"⏳ 間もなく開始...";case"guiding":return"🎙️ ガイドに合わせてドレミファソラシドを歌ってください";case"results":return"🎉 採点結果";default:return"🔄 準備中..."}}function yo(){return K.length>0?K:ye.length>0?ye:[]}function Zt(){_t(`${lt}/microphone-test`)}function $e(){_t(`${lt}/`)}async function $t(){try{e(34,Re=!0),e(33,he=new Lo({urls:{C4:"C4.mp3"},baseUrl:`${lt}/audio/piano/`,release:1.5,volume:Mn(),onload:()=>{e(34,Re=!1)},onerror:z=>{console.error("❌ Salamander Piano音源読み込みエラー:",z),e(34,Re=!1)}}).toDestination());const o=/iPhone/.test(navigator.userAgent),l=/iPad/.test(navigator.userAgent),S=/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document,w=o||l||S;console.log(l?"🔍 [RandomTraining] iPad検出:":S?"🔍 [RandomTraining] iPadOS検出:":o?"🔍 [RandomTraining] iPhone検出:":"🔍 [RandomTraining] その他デバイス検出:",navigator.userAgent),console.log("🔊 [RandomTraining] 音量設定維持: 35dB")}catch(o){console.error("サンプラー初期化エラー:",o),e(34,Re=!1)}}async function ct(){try{(await navigator.permissions.query({name:"microphone"})).state==="granted"?await Ue():e(1,d="denied")}catch{e(1,d="denied")}}function en(){try{we=new Cn,ie.info("[RandomTraining] 採点エンジン初期化完了")}catch(o){ie.error("[RandomTraining] 採点エンジン初期化エラー:",o)}}function tn(o,l){if(!we||!L)return;const S=b-1;if(S<0||S>=q.length)return;const w=Ze(_,S),z={baseFrequency:_,targetFrequency:w,detectedFrequency:o,detectedNote:l,volume:Se,timestamp:Date.now(),scaleIndex:S,scaleName:q[S].name};try{we.processAttempt(z)}catch(O){ie.error("[RandomTraining] 採点エンジンエラー:",O)}}function nn(){if(!we){ie.error("[RandomTraining] 採点エンジンが初期化されていません"),on();return}try{const o=we.generateDetailedReport();e(16,Ve={totalScore:o.totalScore,grade:o.grade,componentScores:o.componentScores}),o.intervalAnalysis&&o.intervalAnalysis.masteryLevels?e(3,Ce=Object.entries(o.intervalAnalysis.masteryLevels).map(([l,S])=>{var w,z;return{type:l,mastery:Math.round(S),attempts:((w=o.intervalAnalysis.attemptCounts)==null?void 0:w[l])||0,accuracy:((z=o.intervalAnalysis.accuracyRates)==null?void 0:z[l])||0}})):(console.warn("⚠️ [RandomTraining] intervalAnalysis.masteryLevels が未定義です"),e(3,Ce=[])),o.consistencyHistory&&Array.isArray(o.consistencyHistory)?e(17,Te=o.consistencyHistory.map((l,S)=>({score:Math.round(l),timestamp:Date.now()-(o.consistencyHistory.length-S)*1e3}))):(console.warn("⚠️ [RandomTraining] consistencyHistory が未定義または配列ではありません"),e(17,Te=[])),e(18,Oe=o.feedback||{primary:"採点結果を生成中です...",detailed:[],suggestions:[]}),e(20,Fe={totalAttempts:o.totalAttempts||0,successRate:o.successRate||0,averageScore:o.totalScore||0,bestScore:Math.max(o.totalScore||0,Fe.bestScore||0),sessionDuration:Math.round((Date.now()-Fe.sessionStart)/6e4)||0,streakCount:o.streak||0,fatigueLevel:o.fatigueLevel||"normal",mostDifficultInterval:o.mostDifficultInterval||"-",mostSuccessfulInterval:o.mostSuccessfulInterval||"-",averageResponseTime:o.averageResponseTime||0}),ie.info("[RandomTraining] 採点結果生成完了:",Ve)}catch(o){ie.error("[RandomTraining] 採点結果生成エラー:",o)}}function on(){ie.info("[RandomTraining] テストデータで採点結果を生成"),e(16,Ve={totalScore:78,grade:"B+",componentScores:{pitchAccuracy:82,recognitionSpeed:75,intervalMastery:80,directionAccuracy:85,consistency:70}}),e(3,Ce=[{type:"unison",mastery:95,attempts:8,accuracy:98},{type:"major_second",mastery:82,attempts:8,accuracy:85},{type:"major_third",mastery:78,attempts:8,accuracy:80},{type:"perfect_fourth",mastery:65,attempts:8,accuracy:68},{type:"perfect_fifth",mastery:88,attempts:8,accuracy:90},{type:"major_sixth",mastery:72,attempts:8,accuracy:75},{type:"major_seventh",mastery:58,attempts:8,accuracy:62},{type:"octave",mastery:92,attempts:8,accuracy:94}]),e(17,Te=[{score:65,timestamp:Date.now()-42e4},{score:72,timestamp:Date.now()-36e4},{score:68,timestamp:Date.now()-3e5},{score:75,timestamp:Date.now()-24e4},{score:78,timestamp:Date.now()-18e4},{score:82,timestamp:Date.now()-12e4},{score:80,timestamp:Date.now()-6e4},{score:85,timestamp:Date.now()}]),e(18,Oe={type:"improvement",primary:"良い進歩が見られます！",summary:"音程の認識精度が向上しています。特に完全5度とオクターブの習得度が高く、基本的な音感が身についてきています。",details:[{category:"strengths",text:"ユニゾンとオクターブの認識がほぼ完璧です"},{category:"strengths",text:"完全5度の安定性が優秀です"},{category:"improvements",text:"完全4度の練習をもう少し増やしましょう"},{category:"improvements",text:"長7度の認識精度を向上させましょう"},{category:"tips",text:"4度は「ソーファー」の音程です"},{category:"practice",text:"毎日15分の継続練習を心がけましょう"}],nextSteps:["完全4度の集中練習を行いましょう","連続チャレンジモードで実践練習を","1日15分の継続練習を心がけましょう"],motivation:"継続は力なり！あなたの相対音感は確実に向上しています！"}),e(20,Fe={totalAttempts:32,successRate:68.8,averageScore:78,bestScore:85,sessionDuration:8,streakCount:4,fatigueLevel:"normal",mostDifficultInterval:"完全4度",mostSuccessfulInterval:"ユニゾン",averageResponseTime:2.1,sessionStart:Date.now()-48e4}),ie.info("[RandomTraining] テスト採点結果生成完了")}function ho(o){dt=o}function rn(){if(!ae||ae.length===0){console.warn("[UnifiedScore] noteResultsForDisplay が空です");return}const o=ae.filter(re=>re.accuracy!=="notMeasured").length,l=ae.length,S=ae.filter(re=>re.accuracy!=="notMeasured"&&typeof re.accuracy=="number").map(re=>re.accuracy),w=S.length>0?Math.round(S.reduce((re,Me)=>re+Me,0)/S.length):0,z=P||"Unknown",O=_||0,ce=ae.map(re=>({name:re.name,note:re.note||re.name,frequency:re.targetFreq||re.expectedFrequency,detectedFrequency:re.detectedFreq,cents:re.cents,grade:ot.evaluateNote(re.cents),targetFreq:re.targetFreq,diff:re.diff})),le=U,se=(le==null?void 0:le.sessionHistory)||[],De={timestamp:new Date,baseNote:z,baseFrequency:O,noteResults:ce,measuredNotes:o,accuracy:w,grade:ot.evaluateSession(ae)},Pe=[...se,De];e(21,ue={mode:"continuous",timestamp:new Date,duration:60,totalNotes:l,measuredNotes:o,averageAccuracy:w,baseNote:z,baseFrequency:O,noteResults:ce,distribution:ot.calculateDistribution(ae),sessionHistory:Pe,unifiedGrade:C(Pe)}),console.log("[UnifiedScore] 統合採点データ生成完了（完全版）:",ue),sn()}async function sn(){if(!ae||ae.length===0){console.warn("📊 [SessionStorage] 保存データなし");return}try{console.log("📊 [SessionStorage] セッション結果保存開始");const o=ae.map(O=>({name:O.name,cents:O.cents,targetFreq:O.targetFreq||O.expectedFrequency,detectedFreq:O.detectedFreq,diff:O.diff,accuracy:typeof O.accuracy=="number"?O.accuracy:0})),l=Qe?Math.round((Date.now()-Qe)/1e3):60;await wn(o,l,D,A)?(console.log("📊 [SessionStorage] セッション結果保存完了"),console.log("📊 [SessionStorage] 保存後の状況:",{currentSession:n,totalSessions:v.length,isCompleted:c,nextBaseNote:D,nextBaseName:A})):console.error("📊 [SessionStorage] セッション結果保存失敗")}catch(o){console.error("📊 [SessionStorage] セッション保存エラー:",o)}}async function an(){try{if(we){const o=v||[];for(const[S,w]of o.entries())if(w.noteResults&&w.noteResults.length>0){const z=w.baseFrequency||262;for(const O of w.noteResults)O.detectedFreq&&O.targetFreq&&await we.analyzePerformance({baseFreq:z,targetFreq:O.targetFreq,detectedFreq:O.detectedFreq,responseTime:2e3,volume:50,harmonicCorrection:null})}const l=we.generateDetailedReport();e(16,Ve={totalScore:l.totalScore||0,grade:l.grade||"C",componentScores:l.componentScores||{accuracy:0,speed:0,consistency:0}}),l.intervalAnalysis&&l.intervalAnalysis.masteryLevels?e(3,Ce=Object.entries(l.intervalAnalysis.masteryLevels).map(([S,w])=>{var z;return{type:S,mastery:Math.round(w),attempts:((z=l.intervalAnalysis.attemptCounts)==null?void 0:z[S])||0,accuracy:Math.round(w*.9)}})):e(3,Ce=Tt(ae)),l.consistencyHistory&&Array.isArray(l.consistencyHistory)?e(17,Te=l.consistencyHistory.map((S,w)=>({score:Math.round(S),timestamp:Date.now()-(l.consistencyHistory.length-w)*1e3}))):e(17,Te=pt(ae)),e(18,Oe=vt(ae)||l.feedback),console.log("🎯 [generateEnhancedScoringData] 技術分析結果生成を開始"),console.log("🎯 [generateEnhancedScoringData] results:",l),e(19,Ye=cn(l)),console.log("🎯 [generateEnhancedScoringData] technicalFeedbackData結果:",Ye),e(20,Fe={totalAttempts:l.totalAttempts||ae.length,successRate:l.successRate||ae.filter(S=>S.accuracy!=="notMeasured").length/ae.length*100,averageScore:l.totalScore||(ue==null?void 0:ue.averageAccuracy)||0,bestScore:Math.max(l.totalScore||0,Fe.bestScore||0),sessionDuration:Math.round(60),streakCount:l.streak||0,fatigueLevel:l.fatigueLevel||"normal",mostDifficultInterval:l.mostDifficultInterval||"未特定",mostSuccessfulInterval:l.mostSuccessfulInterval||"未特定",averageResponseTime:l.averageResponseTime||2.5,sessionStart:Date.now()-6e4})}else ht();console.log("[EnhancedScoring] 追加採点データ生成完了")}catch(o){console.error("[EnhancedScoring] データ生成エラー:",o),ht()}}function ht(){const o=ae.filter(S=>S.accuracy!=="notMeasured"),l=(ue==null?void 0:ue.averageAccuracy)||0;e(16,Ve={totalScore:Math.round(l*.8),grade:l>=90?"A":l>=80?"B":l>=70?"C":"D",componentScores:{accuracy:l,speed:85,consistency:Math.max(60,l-10)}}),e(3,Ce=Tt(ae)),e(17,Te=pt()),e(18,Oe=vt(ae)),e(20,Fe={totalAttempts:ae.length,successRate:o.length/ae.length*100,averageScore:l,bestScore:l,sessionDuration:60,streakCount:0,fatigueLevel:"normal",mostDifficultInterval:"未分析",mostSuccessfulInterval:"未分析",averageResponseTime:2.5,sessionStart:Date.now()-6e4})}function pt(o){const l=(ue==null?void 0:ue.averageAccuracy)||70;return Array.from({length:8},(S,w)=>({score:Math.max(30,Math.min(100,l+(Math.random()-.5)*20)),timestamp:Date.now()-(8-w)*7500}))}function vt(o){const l=o.filter(tt=>tt.accuracy!=="notMeasured").length,S=(ue==null?void 0:ue.averageAccuracy)||0,w=8,z=v||[],O=z.length,ce={type:"info",categories:[{name:"音程精度",icon:"Target",score:S,message:`${S}%の精度で音程を捉えています`},{name:"測定成功率",icon:"Mic",score:Math.round(l/o.length*100),message:`${o.length}音中${l}音を正常に測定`}]};if(O<w)return ce;let le,se,De;const Pe=(ue==null?void 0:ue.unifiedGrade)||"E",re=z.length;let Me=0,ve=0,_e=0;z.forEach(tt=>{tt.grade==="excellent"?Me++:tt.grade==="good"?ve++:tt.grade==="pass"&&_e++});const be=re>0?Math.round(Me/re*100):0,et=re>0?Math.round((Me+ve+_e)/re*100):0,qe=re>0?Math.round((Me+ve+_e)/re*100):0;switch(Pe){case"S":le="excellent",se="音楽家レベルの相対音感を達成！",De=`優秀率${be}%超えの実力を証明されました。`;break;case"A":le="excellent",se="エキスパートレベル到達！",De=`優秀率${be}%の安定した音感能力です。`;break;case"B":le="improvement",se="プロフィシエント級達成！",De=`良好率${et}%の確実な進歩を示しています。`;break;case"C":le="improvement",se="アドバンス級到達！",De=`合格率${qe}%で着実に成長中です。`;break;case"D":le="practice",se="継続練習で必ず上達！",De=`現在の合格率${qe}%から目標70%へ向けて練習を続けましょう。`;break;case"E":default:le="encouragement",se="E級ビギナー",De="練習開始段階です。継続的な練習で必ず上達します。";break}return{...ce,type:le,primary:se,summary:De}}function cn(o){var Pe,re,Me;if((v||[]).length<8||!o)return null;const z=o.improvements||[];(Pe=o.detailed)!=null&&Pe.statistics;const O=[];let ce=0,le=0;if((re=o.detailed)!=null&&re.intervals){const ve=o.detailed.intervals;if(ve.totalAnalyses>0){let _e=0,be=0;for(const[et,qe]of Object.entries(ve.masteryLevels))qe.attempts>0&&(_e+=qe.averageAccuracy*qe.attempts,be+=qe.attempts);ce=be>0?_e/be:0}}if((Me=o.detailed)!=null&&Me.directions){const ve=o.detailed.directions;if(ve.totalAnalyses>0){let _e=0,be=0;for(const[et,qe]of Object.entries(ve.masteryData))qe.attempts>0&&(_e+=qe.averageAccuracy*qe.attempts,be+=qe.attempts);le=be>0?_e/be:0}}O.push({category:"improvements",text:`音程精度: ${Math.round(ce)}%　（音の高さを捉える正確性　目標基準：70〜85%）`}),O.push({category:"improvements",text:`方向性: ${Math.round(le)}%　（音程の上下判断の精度　目標基準：80〜90%）`});const se=z.map(ve=>({category:"tips",text:ve.message})),De=z.flatMap(ve=>(ve.actions||[]).map(_e=>({category:"practice",text:_e})));return[...O,...se,...De],{type:"info",primary:"詳細分析結果",summary:"音程精度・一貫性・方向性の総合分析",details:O}}Dn(async()=>{if(!(typeof localStorage<"u"?localStorage.getItem("mic-test-completed"):null)){console.log("🚫 [RandomTraining] マイクテスト未完了 - 準備画面表示"),ct();return}console.log("📊 [SessionStorage] セッション管理初期化開始");try{if(await Dt()){if(console.log("📊 [SessionStorage] セッション進行状況の読み込み完了"),console.log("📊 [SessionStorage] 現在のセッション:",n,"/ 8"),console.log("📊 [SessionStorage] 次の基音:",D,"(",A,")"),console.log("📊 [SessionStorage] 完了状況:",c?"8セッション完了":`残り${f}セッション`),c&&(console.log("🔄 [SessionStorage] 8セッション完了検出 - 新サイクル開始処理"),await nt()?console.log("✅ [SessionStorage] 新サイクル開始完了 - セッション1/8から再開"):console.warn("⚠️ [SessionStorage] 新サイクル開始処理が失敗")),n>1&&!c){console.warn("🔄 [SessionStorage] セッション途中でのリロード検出 - セッション1から再開"),console.warn("🔄 [SessionStorage] 現在:",n,"セッション目 → ダイレクトアクセス誘導");const{SessionStorageManager:S}=await bn(async()=>{const{SessionStorageManager:O}=await import("../chunks/CW4Srgmt.js").then(ce=>ce.y);return{SessionStorageManager:O}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url),w=S.getInstance();typeof localStorage<"u"&&(localStorage.removeItem("random-training-progress"),localStorage.removeItem("random-training-progress-backup"));const{resetProgress:z}=await bn(async()=>{const{resetProgress:O}=await import("../chunks/CW4Srgmt.js").then(ce=>ce.z);return{resetProgress:O}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url);await z(),console.log("🔄 [SessionStorage] localStorage + ストア状態完全リセット完了"),ct();return}}else console.log("📊 [SessionStorage] 新規セッション開始")}catch(l){console.error("📊 [SessionStorage] 初期化エラー:",l)}if($t(),en(),u.url.searchParams.get("from")==="microphone-test"){console.log("🎤 [RandomTraining] マイクテストページからの遷移を検出");const l=new URL(window.location);if(l.searchParams.delete("from"),window.history.replaceState({},"",l),e(1,d="granted"),e(0,p="setup"),console.log('🎤 [RandomTraining] microphoneState="granted", trainingPhase="setup" に設定'),!Ee){console.log("🎤 [RandomTraining] AudioManagerリソース取得開始");try{const S=await We.initialize();st=S.audioContext,Ee=S.mediaStream,at=S.sourceNode,console.log("🎤 [RandomTraining] AudioManagerリソース取得完了")}catch(S){console.warn("⚠️ AudioManagerリソース取得失敗（後で再試行）:",S)}}if(await new Promise(S=>setTimeout(S,500)),ee)try{if(console.log("🎙️ [ContinuousMode] PitchDetector初期化開始"),typeof ee.getIsInitialized=="function"){const S=ee.getIsInitialized();if(console.log("🔍 [ContinuousMode] PitchDetector初期化状態:",S),S)console.log("✅ [ContinuousMode] PitchDetectorは既に初期化済み");else{const w=We.getStatus();console.log("🔍 [ContinuousMode] AudioManager状態:",w),(!w.isInitialized||!w.mediaStreamActive)&&(console.log("🔄 [ContinuousMode] AudioManager再初期化実行"),await We.initialize()),await ee.initialize(),console.log("✅ [ContinuousMode] PitchDetector初期化完了")}}else console.error("❌ [ContinuousMode] getIsInitializedメソッドが利用できません"),await ee.initialize()}catch(S){console.error("❌ [ContinuousMode] PitchDetector初期化エラー:",S),await new Promise(w=>setTimeout(w,1e3));try{await ee.initialize(),console.log("✅ [ContinuousMode] PitchDetector初期化再試行成功")}catch(w){console.error("❌ [ContinuousMode] PitchDetector初期化再試行も失敗:",w)}}else console.warn("⚠️ [ContinuousMode] PitchDetectorコンポーネントが存在しません")}else await new Promise(l=>setTimeout(l,100)),ct()});function ln(o){try{if(!o||!o.detail){console.warn("⚠️ [ContinuousMode] handlePitchUpdate: event.detail が undefined");return}const{frequency:l,note:S,volume:w,rawVolume:z,clarity:O}=o.detail;let ce=l,le=S;if(p==="guiding"&&L&&_>0&&l>0){const se=un(l);se&&(ce=se.frequency,le=se.note)}e(14,Ae=ce),e(15,Le=le),e(13,Se=w),_>0&&ce>0?xe=Math.round(1200*Math.log2(ce/_)):xe=0;try{fn(l,S)}catch(se){console.error("❌ [ContinuousMode] evaluateScaleStep エラー:",se)}try{we&&l>0&&_>0&&tn(l,S)}catch(se){console.error("❌ [ContinuousMode] updateScoringEngine エラー:",se)}}catch(l){console.error("❌ [ContinuousMode] handlePitchUpdate エラー:",{error:l.message,stack:l.stack,eventDetail:o==null?void 0:o.detail,trainingPhase:p,currentSessionId:n})}}function un(o){if(!o||o<=0||!L||!_||Se<25)return null;const S=b-1;if(S<0||S>=q.length)return null;const w=Ze(_,S);if(!w||w<=0)return null;const O=Et(o,w).correctedFrequency,ce=Nn(O);return{frequency:Math.round(O),note:ce}}function fn(o,l){if(!o||o<=0||!L)return;if(!_||_<=0){console.error(`❌ [採点エラー] 基音周波数が無効: ${_}Hz`),console.error(`❌ [採点エラー] 基音名: ${P}`),console.error(`❌ [採点エラー] activeStepIndex: ${b-1}`),console.error(`❌ [採点エラー] trainingPhase: ${p}`),console.error(`❌ [採点エラー] isGuideAnimationActive: ${L}`);return}if(Se<25)return;const w=b-1;if(w<0||w>=q.length)return;w>=4&&ie.debug(`[採点デバッグ] activeStepIndex=${w} (${q[w].name}), currentBaseFrequency=${_}Hz`);const z=Ze(_,w);if(w>=0&&ie.debug(`[音程計算修正版] ${q[w].name}: 期待周波数 ${z.toFixed(1)}Hz`),!z||z<=0||!isFinite(z)){console.error("❌ [採点エラー] 期待周波数計算エラー:"),console.error(`   基音周波数: ${_}Hz`),console.error(`   音階インデックス: ${w}`),console.error(`   期待周波数: ${z}Hz`);return}const O=Et(o,z),ce=O.correctedFrequency,le=O.factor,se=Math.round(1200*Math.log2(ce/z));if((Math.abs(se)>200||le!==1)&&(ie.debug(`[プロトタイプ式補正] ${q[w].name}:`),console.warn(`   検出周波数: ${o.toFixed(1)}Hz`),console.warn(`   補正後周波数: ${ce.toFixed(1)}Hz`),console.warn(`   期待周波数: ${z.toFixed(1)}Hz`),console.warn(`   セント差: ${se}¢`),console.warn(`   補正係数: ${le} (${O.description})`),console.warn(`   基音: ${P} (${_.toFixed(1)}Hz)`)),!isFinite(se)){console.error("❌ [採点エラー] セント計算エラー:"),console.error(`   検出周波数: ${o}Hz`),console.error(`   期待周波数: ${z}Hz`),console.error(`   セント差: ${se}`);return}const Pe=Math.abs(se)<=50;if(Se>=15){const ve=Math.max(0,Math.round(100-Math.abs(se))),_e=K.findIndex(et=>et.stepIndex===w),be={stepIndex:w,stepName:q[w].name,expectedFrequency:Math.round(z),detectedFrequency:Math.round(o),adjustedFrequency:Math.round(ce),centDifference:se,accuracy:ve,isCorrect:Pe,correctionFactor:le,correctionDescription:O.description,timestamp:Date.now()};_e>=0?K[_e]=be:K.push(be),K.length%4===0&&ie.realtime(`採点進捗: ${K.length}/${q.length}ステップ完了`)}}function dn(){e(0,p="results"),Be.isCompleted=!0,Be.averageAccuracy=Math.round(Be.correctCount/Be.totalCount*100),ee&&ee.stopDetection(),vn()}async function mn(){if(c){console.warn("🚫 [RestartSame] 8セッション完了状態では再挑戦不可 - 新サイクル開始が必要"),await nt()?(console.log("✅ [RestartSame] 新サイクル開始完了 - セッション1/8から再開"),window.location.reload()):console.error("❌ [RestartSame] 新サイクル開始失敗");return}rt(),e(0,p="setup"),V&&(clearTimeout(V),V=null),ee&&ee.resetDisplayState&&ee.resetDisplayState(),it(),console.log("🔄 [RestartSame] 同じ基音で再挑戦:",P,_+"Hz"),console.log("🔄 [RestartSame] 基音情報保持完了 - ユーザー操作待機")}async function gn(){if(c){console.warn("🚫 [RestartDifferent] 8セッション完了状態では再挑戦不可 - 新サイクル開始が必要"),await nt()?(console.log("✅ [RestartDifferent] 新サイクル開始完了 - セッション1/8から再開"),window.location.reload()):console.error("❌ [RestartDifferent] 新サイクル開始失敗");return}rt(),e(0,p="setup"),V&&(clearTimeout(V),V=null),e(7,P=""),e(8,_=0),console.log("🔄 [restartDifferentBaseNote] 基音情報をリセットしました"),ee&&ee.resetDisplayState&&ee.resetDisplayState(),it()}function it(){b=0,L=!1,K=[],e(10,q=q.map(o=>({...o,state:"inactive",completed:!1})))}async function yn(){console.log("🚀 [StartNewCycle] 8セッション完了後の最初から挑戦開始");try{await nt()?(console.log("✅ [StartNewCycle] 新サイクル開始完了"),localStorage.getItem("mic-test-completed")?(console.log("✅ [StartNewCycle] マイクテスト完了フラグ確認 - リロードなしで状態リセット"),rt(),await Dt(),e(0,p="setup"),it(),mt(),console.log("✅ [StartNewCycle] 状態リセット完了 - セッション1/8から再開")):window.location.reload()):(console.error("❌ [StartNewCycle] 新サイクル開始失敗"),$e())}catch(o){console.error("❌ [StartNewCycle] 新サイクル開始エラー:",o),$e()}}function hn(o){const{type:l}=o.detail;switch(l){case"same":mn();break;case"different":gn();break;case"restart":yn();break;case"home":$e();break;default:console.warn("🚫 [ActionButtons] 未知のアクションタイプ:",l)}}function pn(){console.log("⚡ [ContinuousMode] 8セッション連続開始"),gt()}function vn(){console.log("✅ [ContinuousMode] セッション完了:",n),n<8?setTimeout(()=>{if(console.log("🔄 [ContinuousMode] 次セッション自動開始準備:",n+1),e(0,p="setup"),Be={isCompleted:!1,correctCount:0,totalCount:0,averageAccuracy:0},e(9,Z=!1),ee)try{if(ee.getState){const o=ee.getState();console.log("🔍 [ContinuousMode] PitchDetector状態:",o),o.isInitialized&&o.componentState==="ready"?(console.log("🎤 [ContinuousMode] 音程検出再開"),ee.startDetection()):o.componentState==="detecting"?console.log("🔄 [ContinuousMode] 音程検出は既にアクティブ状態 - スキップ"):console.log("⚠️ [ContinuousMode] PitchDetector状態不正 - 音程検出再開をスキップ:",o.componentState)}else console.log("⚠️ [ContinuousMode] getState()メソッド未対応 - フォールバック処理"),ee.getIsInitialized&&ee.getIsInitialized()&&ee.startDetection()}catch(o){console.warn("⚠️ [ContinuousMode] 音程検出再開失敗:",o.message)}console.log("🎵 [ContinuousMode] 次の基音自動再生開始"),gt()},2e3):(console.log("🎉 [ContinuousMode] 8セッション完了！"),setTimeout(()=>{console.log("🏆 [ContinuousMode] 総合評価画面表示完了")},1e3))}function _n(o){var O;const{error:l,context:S,reason:w,recovery:z}=o.detail;if(S==="initialization"||l!=null&&l.message&&l.message.includes("getIsInitialized")){console.error("❌ [ContinuousMode] PitchDetector初期化エラー詳細:",{error:(l==null?void 0:l.message)||l,stack:l==null?void 0:l.stack,context:S,componentExists:!!ee,hasGetIsInitialized:typeof(ee==null?void 0:ee.getIsInitialized)=="function",trainingPhase:p,currentSessionId:n});return}if(console.error("❌ [ContinuousMode] PitchDetectorエラー詳細:",{error:(l==null?void 0:l.message)||l,stack:l==null?void 0:l.stack,context:S,reason:w,recovery:z,trainingPhase:p,currentSessionId:n}),w==="mediastream_ended"&&z==="restart_required"&&(console.log("⚡ [ContinuousMode] MediaStream終了検出 - 自動復旧を試行"),setTimeout(async()=>{try{await Ue()}catch(ce){console.error("❌ [ContinuousMode] 自動復旧失敗:",ce)}},1e3)),S==="start-detection"&&((O=l==null?void 0:l.message)!=null&&O.includes("component state is detecting"))){console.log("🔄 [ContinuousMode] 音程検出は既にアクティブ状態です（正常）");return}}function Sn(o){const{healthy:l,errors:S,details:w}=o.detail;e(2,k=l),e(6,N=S),l||(console.warn("⚠️ マイクの健康状態が悪化:",S),p==="guiding"&&(e(0,p="setup"),console.warn("🛑 マイク問題によりトレーニングを停止")))}qn(()=>{console.log("🔄 [RandomTraining] onDestroy - AudioManagerリソースは保持"),he&&(he.dispose(),e(33,he=null))});const po=[];Uo.keys(t).forEach(o=>{!~po.indexOf(o)&&o.slice(0,2)!=="$$"&&o!=="slot"&&Wo.warn(`<Page> was created with unknown prop '${o}'`)});function vo(o){wo[o?"unshift":"push"](()=>{ee=o,e(22,ee)})}return a.$capture_state=()=>({onMount:Dn,onDestroy:qn,goto:_t,base:lt,page:St,ChevronRight:jo,Music:xn,Card:Ke,Button:ft,VolumeBar:ko,PitchDisplay:zo,PitchDetector:Pn,PitchDetectionDisplay:En,PageLayout:Tn,Tone:Ho,audioManager:We,harmonicCorrection:bt,logger:ie,ScoreResultPanel:Vo,IntervalProgressTracker:Bo,ConsistencyGraph:xo,FeedbackDisplay:Po,SessionStatistics:Eo,UnifiedScoreResultFixed:Ut,ActionButtons:Gt,EvaluationEngine:ot,EnhancedScoringEngine:Cn,trainingProgress:Nt,currentSessionId:It,nextBaseNote:Mt,nextBaseName:Rt,isLoading:Ft,storageError:To,isCompleted:kt,sessionHistory:Ct,overallGrade:Ao,overallAccuracy:No,progressPercentage:Io,remainingSessions:wt,latestSessionResult:Mo,unifiedScoreData:qt,loadProgress:Dt,saveSessionResult:wn,resetProgress:Ro,createNewProgress:Fo,startNewCycleIfCompleted:nt,getVolumeForDevice:Mn,calculateUnifiedGrade:C,generateTestUnifiedScoreData:Jo,trainingPhase:p,microphoneState:d,microphoneHealthy:k,microphoneErrors:N,buildVersion:co,buildTimestamp:io,updateStatus:lo,SCALE_NAMES:H,currentBaseNote:P,currentBaseFrequency:_,isPlaying:Z,currentScaleIndex:b,scaleSteps:q,guideAnimationTimer:V,isGuideAnimationActive:L,guideStartProgress:ne,isGuideStartBarActive:B,guideStartTimer:E,musicIconGlowing:$,scaleEvaluations:K,previousEvaluations:ye,currentVolume:Se,currentFrequency:Ae,detectedNote:Le,pitchDifference:xe,sessionResults:Be,scoringEngine:we,currentScoreData:Ve,intervalData:Ce,consistencyData:Te,feedbackData:Oe,technicalFeedbackData:Ye,sessionStatistics:Fe,activeTab:dt,noteResultsForDisplay:ae,currentUnifiedScoreData:ue,sampler:he,isSamplerLoading:Re,pitchDetectorComponent:ee,mediaStream:Ee,audioContext:st,sourceNode:at,sessionStartTime:Qe,baseNotes:Ge,checkMicrophonePermission:Ue,selectRandomBaseNote:mt,playRandomBaseNote:Wt,playCurrentBaseNote:Jt,playBaseNoteOnly:fo,playBaseNote:gt,startGuideStartBar:Kt,cleanupGuideStartBar:mo,calculateExpectedFrequency:Ze,calculateTargetFrequency:Qt,startGuideAnimation:yt,finishGuideAnimation:Xt,calculateFinalResults:Yt,getStatusMessage:go,getDisplayEvaluations:yo,goToMicrophoneTest:Zt,goHome:$e,initializeSampler:$t,checkExistingMicrophonePermission:ct,initializeScoringEngine:en,updateScoringEngine:tn,generateFinalScoring:nn,generateTestScoreData:on,switchTab:ho,generateUnifiedScoreData:rn,saveSessionToStorage:sn,generateEnhancedScoringData:an,generateFallbackEnhancedData:ht,generateIntervalDataFromResults:Tt,generateIntervalDataFromSessionHistory:In,generateConsistencyDataFromResults:pt,generateFeedbackFromResults:vt,generateTechnicalFeedbackFromEnhancedEngine:cn,handlePitchUpdate:ln,getEvaluationCorrectedFrequency:un,frequencyToNote:Nn,multiStageOctaveCorrection:Et,evaluateScaleStep:fn,completeSession:dn,restartSameBaseNote:mn,restartDifferentBaseNote:gn,scrollToTop:rt,resetSessionState:it,startNewCycle:yn,handleActionButtonClick:hn,startContinuousMode:pn,handleSessionComplete:vn,handlePitchDetectorStateChange:uo,handlePitchDetectorError:_n,handleMicrophoneHealthChange:Sn,canRestartSession:r,canStartTraining:i,$currentSessionId:n,$unifiedScoreData:s,$isCompleted:c,$page:u,$remainingSessions:f,$nextBaseName:A,$nextBaseNote:D,$sessionHistory:v,$trainingProgress:U,$isLoading:x}),a.$inject_state=o=>{"trainingPhase"in o&&e(0,p=o.trainingPhase),"microphoneState"in o&&e(1,d=o.microphoneState),"microphoneHealthy"in o&&e(2,k=o.microphoneHealthy),"microphoneErrors"in o&&e(6,N=o.microphoneErrors),"currentBaseNote"in o&&e(7,P=o.currentBaseNote),"currentBaseFrequency"in o&&e(8,_=o.currentBaseFrequency),"isPlaying"in o&&e(9,Z=o.isPlaying),"currentScaleIndex"in o&&(b=o.currentScaleIndex),"scaleSteps"in o&&e(10,q=o.scaleSteps),"guideAnimationTimer"in o&&(V=o.guideAnimationTimer),"isGuideAnimationActive"in o&&(L=o.isGuideAnimationActive),"guideStartProgress"in o&&e(11,ne=o.guideStartProgress),"isGuideStartBarActive"in o&&(B=o.isGuideStartBarActive),"guideStartTimer"in o&&(E=o.guideStartTimer),"musicIconGlowing"in o&&e(12,$=o.musicIconGlowing),"scaleEvaluations"in o&&(K=o.scaleEvaluations),"previousEvaluations"in o&&(ye=o.previousEvaluations),"currentVolume"in o&&e(13,Se=o.currentVolume),"currentFrequency"in o&&e(14,Ae=o.currentFrequency),"detectedNote"in o&&e(15,Le=o.detectedNote),"pitchDifference"in o&&(xe=o.pitchDifference),"sessionResults"in o&&(Be=o.sessionResults),"scoringEngine"in o&&(we=o.scoringEngine),"currentScoreData"in o&&e(16,Ve=o.currentScoreData),"intervalData"in o&&e(3,Ce=o.intervalData),"consistencyData"in o&&e(17,Te=o.consistencyData),"feedbackData"in o&&e(18,Oe=o.feedbackData),"technicalFeedbackData"in o&&e(19,Ye=o.technicalFeedbackData),"sessionStatistics"in o&&e(20,Fe=o.sessionStatistics),"activeTab"in o&&(dt=o.activeTab),"noteResultsForDisplay"in o&&(ae=o.noteResultsForDisplay),"currentUnifiedScoreData"in o&&e(21,ue=o.currentUnifiedScoreData),"sampler"in o&&e(33,he=o.sampler),"isSamplerLoading"in o&&e(34,Re=o.isSamplerLoading),"pitchDetectorComponent"in o&&e(22,ee=o.pitchDetectorComponent),"mediaStream"in o&&(Ee=o.mediaStream),"audioContext"in o&&(st=o.audioContext),"sourceNode"in o&&(at=o.sourceNode),"sessionStartTime"in o&&(Qe=o.sessionStartTime),"canRestartSession"in o&&(r=o.canRestartSession),"canStartTraining"in o&&(i=o.canStartTraining)},t&&"$$inject"in t&&a.$inject_state(t.$$inject),a.$$.update=()=>{a.$$.dirty[0]&6|a.$$.dirty[1]&12&&(i=d==="granted"&&!Re&&he&&k),a.$$.dirty[0]&1&&(r=p==="results"),a.$$.dirty[0]&56&&s&&c&&s.sessionHistory&&(e(3,Ce=In(s.sessionHistory)),console.log("🎵 [RandomTraining] intervalData生成完了:",Ce.length,"件")),a.$$.dirty[0]&3&&p==="setup"&&d==="granted"&&rt()},[p,d,k,Ce,s,c,N,P,_,Z,q,ne,$,Se,Ae,Le,Ve,Te,Oe,Ye,Fe,ue,ee,n,v,x,Zt,$e,ln,hn,pn,_n,Sn,he,Re,vo]}class sr extends _o{constructor(t){super(t),So(this,t,Ko,Ot,bo,{},null,[-1,-1,-1,-1]),te("SvelteRegisterComponent",{component:this,tagName:"Page",options:t,id:Ot.name})}}export{sr as component,rr as universal};
