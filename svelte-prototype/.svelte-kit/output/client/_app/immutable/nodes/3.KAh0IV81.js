import{S as F,i as G,s as K,d as h,C as S,m as V,o as I,b as v,D as q,H as Z,h as z,E as A,k,F as N,l as J,L as j,c as T,y,K as Q,e as g,f as w,G as P,j as _,M as R,n as U,A as O,r as L}from"../chunks/CJUHymq1.js";import"../chunks/IHki7fMi.js";import{p as W}from"../chunks/mVW3KKZj.js";import{g as X,b as Y}from"../chunks/DxVs5PO_.js";import{P as ee,C as te}from"../chunks/DqnuPPYK.js";import{a as E,P as ne,b as se}from"../chunks/0TDGV0x0.js";const oe=!1,$e=Object.freeze(Object.defineProperty({__proto__:null,ssr:oe},Symbol.toStringTag,{value:"Module"}));function ie(d){let e,n="マイクのテストを開始します",a,t,o="マイクテスト開始ボタンを押してマイクの使用を許可してください",s,r;function u(i,c){if(i[0]==="pending")return ce;if(i[0]==="denied")return le;if(i[0]==="initial")return re}let m=u(d),l=m&&m(d);return{c(){e=_("h3"),e.textContent=n,a=k(),t=_("p"),t.textContent=o,s=k(),l&&l.c(),r=L(),this.h()},l(i){e=g(i,"H3",{class:!0,"data-svelte-h":!0}),P(e)!=="svelte-gfi16f"&&(e.textContent=n),a=z(i),t=g(i,"P",{class:!0,"data-svelte-h":!0}),P(t)!=="svelte-1w19y1h"&&(t.textContent=o),s=z(i),l&&l.l(i),r=L(),this.h()},h(){y(e,"class","instructions-title svelte-1ny0zhn"),y(t,"class","instructions-description svelte-1ny0zhn")},m(i,c){v(i,e,c),v(i,a,c),v(i,t,c),v(i,s,c),l&&l.m(i,c),v(i,r,c)},p(i,c){m===(m=u(i))&&l?l.p(i,c):(l&&l.d(1),l=m&&m(i),l&&(l.c(),l.m(r.parentNode,r)))},d(i){i&&(h(e),h(a),h(t),h(s),h(r)),l&&l.d(i)}}}function ae(d){let e,n="マイク準備完了",a,t,o="トレーニングを開始してください",s,r,u,m="トレーニング開始",l,i;return{c(){e=_("h3"),e.textContent=n,a=k(),t=_("p"),t.textContent=o,s=k(),r=_("div"),u=_("button"),u.textContent=m,this.h()},l(c){e=g(c,"H3",{class:!0,"data-svelte-h":!0}),P(e)!=="svelte-11dam81"&&(e.textContent=n),a=z(c),t=g(c,"P",{class:!0,"data-svelte-h":!0}),P(t)!=="svelte-fsj0o8"&&(t.textContent=o),s=z(c),r=g(c,"DIV",{class:!0});var M=w(r);u=g(M,"BUTTON",{class:!0,"data-svelte-h":!0}),P(u)!=="svelte-kae9rs"&&(u.textContent=m),M.forEach(h),this.h()},h(){y(e,"class","ready-title svelte-1ny0zhn"),y(t,"class","ready-description svelte-1ny0zhn"),y(u,"class","training-start-button enabled svelte-1ny0zhn"),y(r,"class","training-start-button-area svelte-1ny0zhn")},m(c,M){v(c,e,M),v(c,a,M),v(c,t,M),v(c,s,M),v(c,r,M),T(r,u),l||(i=O(u,"click",d[6]),l=!0)},p:U,d(c){c&&(h(e),h(a),h(t),h(s),h(r)),l=!1,i()}}}function re(d){let e,n,a="マイクテストを開始",t,o;return{c(){e=_("div"),n=_("button"),n.textContent=a,this.h()},l(s){e=g(s,"DIV",{class:!0});var r=w(e);n=g(r,"BUTTON",{class:!0,"data-svelte-h":!0}),P(n)!=="svelte-caex95"&&(n.textContent=a),r.forEach(h),this.h()},h(){y(n,"class","mic-test-button start svelte-1ny0zhn"),y(e,"class","mic-test-button-area svelte-1ny0zhn")},m(s,r){v(s,e,r),T(e,n),t||(o=O(n,"click",d[5]),t=!0)},p:U,d(s){s&&h(e),t=!1,o()}}}function le(d){let e,n,a="マイク許可を再試行",t,o;return{c(){e=_("div"),n=_("button"),n.textContent=a,this.h()},l(s){e=g(s,"DIV",{class:!0});var r=w(e);n=g(r,"BUTTON",{class:!0,"data-svelte-h":!0}),P(n)!=="svelte-1p3n8nt"&&(n.textContent=a),r.forEach(h),this.h()},h(){y(n,"class","mic-test-button retry svelte-1ny0zhn"),y(e,"class","mic-test-button-area svelte-1ny0zhn")},m(s,r){v(s,e,r),T(e,n),t||(o=O(n,"click",d[5]),t=!0)},p:U,d(s){s&&h(e),t=!1,o()}}}function ce(d){let e,n="マイク準備中...";return{c(){e=_("p"),e.textContent=n,this.h()},l(a){e=g(a,"P",{class:!0,"data-svelte-h":!0}),P(e)!=="svelte-1vb5g92"&&(e.textContent=n),this.h()},h(){y(e,"class","status-text svelte-1ny0zhn")},m(a,t){v(a,e,t)},p:U,d(a){a&&h(e)}}}function de(d){let e;function n(o,s){return o[0]==="granted"?ae:ie}let a=n(d),t=a(d);return{c(){e=_("div"),t.c(),this.h()},l(o){e=g(o,"DIV",{class:!0});var s=w(e);t.l(s),s.forEach(h),this.h()},h(){y(e,"class","training-mode-content svelte-1ny0zhn")},m(o,s){v(o,e,s),t.m(e,null)},p(o,s){a===(a=n(o))&&t?t.p(o,s):(t.d(1),t=a(o),t&&(t.c(),t.m(e,null)))},d(o){o&&h(e),t.d()}}}function ue(d){let e,n,a='<div class="mic-test-header svelte-1ny0zhn"><div class="mic-icon svelte-1ny0zhn"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" x2="12" y1="19" y2="22"></line><line x1="8" x2="16" y1="22" y2="22"></line></svg></div> <div><h1 class="mic-test-title svelte-1ny0zhn">マイクテスト</h1> <p class="mic-test-description svelte-1ny0zhn">音感トレーニングを始める前に、マイクの動作を確認します</p></div></div>',t,o,s,r,u,m,l,i,c;s=new te({props:{variant:"default",padding:"lg",$$slots:{default:[de]},$$scope:{ctx:d}}}),u=new ne({props:{frequency:d[2],note:d[3],volume:d[1],isMuted:d[0]!=="granted",muteMessage:"マイク許可後に開始"}});let M={isActive:d[0]==="granted",className:"pitch-detector-content",debugMode:!1};return i=new se({props:M}),d[9](i),i.$on("pitchUpdate",d[7]),i.$on("stateChange",fe),i.$on("error",d[8]),{c(){e=_("div"),n=_("div"),n.innerHTML=a,t=k(),o=_("div"),N(s.$$.fragment),r=k(),N(u.$$.fragment),m=k(),l=_("div"),N(i.$$.fragment),this.h()},l(f){e=g(f,"DIV",{class:!0});var p=w(e);n=g(p,"DIV",{class:!0,"data-svelte-h":!0}),P(n)!=="svelte-4qcd63"&&(n.innerHTML=a),t=z(p),o=g(p,"DIV",{class:!0});var D=w(o);A(s.$$.fragment,D),D.forEach(h),r=z(p),A(u.$$.fragment,p),m=z(p),l=g(p,"DIV",{style:!0});var C=w(l);A(i.$$.fragment,C),C.forEach(h),p.forEach(h),this.h()},h(){y(n,"class","header svelte-1ny0zhn"),y(o,"class","training-mode-info svelte-1ny0zhn"),Q(l,"display","none"),y(e,"class","microphone-test svelte-1ny0zhn")},m(f,p){v(f,e,p),T(e,n),T(e,t),T(e,o),q(s,o,null),T(e,r),q(u,e,null),T(e,m),T(e,l),q(i,l,null),c=!0},p(f,p){const D={};p&65537&&(D.$$scope={dirty:p,ctx:f}),s.$set(D);const C={};p&4&&(C.frequency=f[2]),p&8&&(C.note=f[3]),p&2&&(C.volume=f[1]),p&1&&(C.isMuted=f[0]!=="granted"),u.$set(C);const x={};p&1&&(x.isActive=f[0]==="granted"),i.$set(x)},i(f){c||(I(s.$$.fragment,f),I(u.$$.fragment,f),I(i.$$.fragment,f),c=!0)},o(f){V(s.$$.fragment,f),V(u.$$.fragment,f),V(i.$$.fragment,f),c=!1},d(f){f&&h(e),S(s),S(u),d[9](null),S(i)}}}function he(d){let e,n,a;return n=new ee({props:{showBackButton:!0,$$slots:{default:[ue]},$$scope:{ctx:d}}}),{c(){e=k(),N(n.$$.fragment),this.h()},l(t){Z("svelte-8st1fo",document.head).forEach(h),e=z(t),A(n.$$.fragment,t),this.h()},h(){document.title="マイクテスト - 相対音感トレーニング"},m(t,o){v(t,e,o),q(n,t,o),a=!0},p(t,[o]){const s={};o&65567&&(s.$$scope={dirty:o,ctx:t}),n.$set(s)},i(t){a||(I(n.$$.fragment,t),a=!0)},o(t){V(n.$$.fragment,t),a=!1},d(t){t&&h(e),S(n,t)}}}function fe(d){}function pe(d,e,n){let a;J(d,W,b=>n(12,a=b));let t="random";j(()=>{a.url.searchParams.has("mode")&&(t=a.url.searchParams.get("mode")||"random")});let o="initial",s=0,r=0,u="ーー",m=null,l=null;j(()=>{l=E.getPlatformSpecs()});const i={random:{name:"ランダム基音モード",description:"10種類の基音からランダムに選択してトレーニング",color:"green",path:"/training/random"},continuous:{name:"連続チャレンジモード",description:"選択した回数だけ連続で実行し、総合評価を確認",color:"orange",path:"/training/continuous"},chromatic:{name:"12音階モード",description:"クロマチックスケールの上行・下行で完全制覇",color:"purple",path:"/training/chromatic"}},c=i[t]||i.random;async function M(){var b;n(0,o="pending");try{if(console.log("🎤 [MicTest] マイク許可リクエスト開始"),!((b=navigator.mediaDevices)!=null&&b.getUserMedia)){n(0,o="denied"),console.error("❌ [MicTest] getUserMediaがサポートされていません");return}const $=await E.initialize();if(console.log("✅ [MicTest] AudioManager リソース取得完了"),$.mediaStream&&$.audioContext)n(0,o="granted"),console.log("✅ [MicTest] マイク許可完了"),await C(),setTimeout(async()=>{m&&(console.log("🎙️ [MicTest] PitchDetector初期化開始"),await m.initialize(),console.log("✅ [MicTest] PitchDetector初期化完了"),console.log("🎯 [MicTest] PitchDetector isActiveリアクティブで自動検出開始"))},1e3);else throw new Error("リソース取得失敗")}catch($){console.error("❌ [MicTest] マイク許可エラー:",$),n(0,o=(($==null?void 0:$.name)==="NotAllowedError","denied"))}}function f(){console.log("🚀 [MicTest] トレーニング開始 - ランダム基音モードへ遷移"),localStorage.setItem("mic-test-completed","true"),console.log("✅ [MicTest] マイクテスト完了フラグを保存"),X(`${Y}${c.path}?from=microphone-test`)}function p(b){const{frequency:$,note:B,volume:H,rawVolume:me,clarity:ve}=b.detail;n(2,r=$),n(3,u=B),n(1,s=H)}function D(b){console.error("❌ [MicTest] PitchDetectorエラー:",b.detail);const{error:$,reason:B,recovery:H}=b.detail;B==="mediastream_ended"&&H==="restart_required"&&(console.log("🔄 [MicTest] MediaStream終了検出 - 自動復旧開始"),n(0,o="initial"),n(1,s=0),n(2,r=0),n(3,u="ーー"),console.log("⚠️ [MicTest] マイク再許可が必要です"))}async function C(){if(l&&l.deviceType==="iPad"){console.log("🔧 [MicTest] iPad検出 - マイク感度7.0x自動設定開始"),E.setSensitivity(7),console.log("✅ [MicTest] iPad マイク感度7.0x自動設定完了");try{await E.initialize(),console.log("🔄 [MicTest] iPad用AudioManager再初期化完了")}catch(b){console.warn("⚠️ [MicTest] AudioManager再初期化エラー:",b)}}}function x(b){R[b?"unshift":"push"](()=>{m=b,n(4,m)})}return[o,s,r,u,m,M,f,p,D,x]}class Te extends F{constructor(e){super(),G(this,e,pe,he,K,{})}}export{Te as component,$e as universal};
