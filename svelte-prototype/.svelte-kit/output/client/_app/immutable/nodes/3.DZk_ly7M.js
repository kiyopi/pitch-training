import{S as _e,i as me,s as be,d as f,C as ee,m as X,o as Z,b as H,D as te,N as ze,h as E,E as le,k as w,F as se,l as Ce,I as re,p as ke,q as Te,c,y as v,L as De,e as h,f as P,G as N,r as K,j as g,M as ye,A as Q,n as W,a as G,g as U,t as $}from"../chunks/BbQtw8CC.js";import"../chunks/IHki7fMi.js";import{p as Me}from"../chunks/DS3SOZh2.js";import{g as Ve,b as Ie}from"../chunks/CminbFgl.js";import{P as Ee,C as he}from"../chunks/DNmPTphr.js";import{a as ie,P as we,b as Pe}from"../chunks/DjSLRzt-.js";const He=!1,ut=Object.freeze(Object.defineProperty({__proto__:null,ssr:He},Symbol.toStringTag,{value:"Module"}));function Ne(a){let e,t="マイクのテストを開始します",s,l,n="マイクテスト開始ボタンを押してマイクの使用を許可してください",i,d;function p(u,T){if(u[0]==="pending")return qe;if(u[0]==="denied")return Le;if(u[0]==="initial")return xe}let r=p(a),o=r&&r(a);return{c(){e=g("h3"),e.textContent=t,s=w(),l=g("p"),l.textContent=n,i=w(),o&&o.c(),d=K(),this.h()},l(u){e=h(u,"H3",{class:!0,"data-svelte-h":!0}),N(e)!=="svelte-gfi16f"&&(e.textContent=t),s=E(u),l=h(u,"P",{class:!0,"data-svelte-h":!0}),N(l)!=="svelte-1w19y1h"&&(l.textContent=n),i=E(u),o&&o.l(u),d=K(),this.h()},h(){v(e,"class","instructions-title svelte-29ezg5"),v(l,"class","instructions-description svelte-29ezg5")},m(u,T){H(u,e,T),H(u,s,T),H(u,l,T),H(u,i,T),o&&o.m(u,T),H(u,d,T)},p(u,T){r===(r=p(u))&&o?o.p(u,T):(o&&o.d(1),o=r&&r(u),o&&(o.c(),o.m(d.parentNode,d)))},d(u){u&&(f(e),f(s),f(l),f(i),f(d)),o&&o.d(u)}}}function Se(a){let e,t="マイク準備完了",s,l,n="トレーニングを開始してください",i,d,p=!a[5]&&ce(a);return{c(){e=g("h3"),e.textContent=t,s=w(),l=g("p"),l.textContent=n,i=w(),p&&p.c(),d=K(),this.h()},l(r){e=h(r,"H3",{class:!0,"data-svelte-h":!0}),N(e)!=="svelte-11dam81"&&(e.textContent=t),s=E(r),l=h(r,"P",{class:!0,"data-svelte-h":!0}),N(l)!=="svelte-fsj0o8"&&(l.textContent=n),i=E(r),p&&p.l(r),d=K(),this.h()},h(){v(e,"class","ready-title svelte-29ezg5"),v(l,"class","ready-description svelte-29ezg5")},m(r,o){H(r,e,o),H(r,s,o),H(r,l,o),H(r,i,o),p&&p.m(r,o),H(r,d,o)},p(r,o){r[5]?p&&(p.d(1),p=null):p?p.p(r,o):(p=ce(r),p.c(),p.m(d.parentNode,d))},d(r){r&&(f(e),f(s),f(l),f(i),f(d)),p&&p.d(r)}}}function xe(a){let e,t,s="マイクテストを開始",l,n;return{c(){e=g("div"),t=g("button"),t.textContent=s,this.h()},l(i){e=h(i,"DIV",{class:!0});var d=P(e);t=h(d,"BUTTON",{class:!0,"data-svelte-h":!0}),N(t)!=="svelte-caex95"&&(t.textContent=s),d.forEach(f),this.h()},h(){v(t,"class","mic-test-button start svelte-29ezg5"),v(e,"class","mic-test-button-area svelte-29ezg5")},m(i,d){H(i,e,d),c(e,t),l||(n=Q(t,"click",a[12]),l=!0)},p:W,d(i){i&&f(e),l=!1,n()}}}function Le(a){let e,t,s="マイク許可を再試行",l,n;return{c(){e=g("div"),t=g("button"),t.textContent=s,this.h()},l(i){e=h(i,"DIV",{class:!0});var d=P(e);t=h(d,"BUTTON",{class:!0,"data-svelte-h":!0}),N(t)!=="svelte-1p3n8nt"&&(t.textContent=s),d.forEach(f),this.h()},h(){v(t,"class","mic-test-button retry svelte-29ezg5"),v(e,"class","mic-test-button-area svelte-29ezg5")},m(i,d){H(i,e,d),c(e,t),l||(n=Q(t,"click",a[12]),l=!0)},p:W,d(i){i&&f(e),l=!1,n()}}}function qe(a){let e,t="マイク準備中...";return{c(){e=g("p"),e.textContent=t,this.h()},l(s){e=h(s,"P",{class:!0,"data-svelte-h":!0}),N(e)!=="svelte-1vb5g92"&&(e.textContent=t),this.h()},h(){v(e,"class","status-text svelte-29ezg5")},m(s,l){H(s,e,l)},p:W,d(s){s&&f(e)}}}function ce(a){let e,t,s,l="トレーニング開始",n,i;function d(o,u){return o[11]?Re:Oe}let p=d(a),r=p(a);return{c(){r.c(),e=w(),t=g("div"),s=g("button"),s.textContent=l,this.h()},l(o){r.l(o),e=E(o),t=h(o,"DIV",{class:!0});var u=P(t);s=h(u,"BUTTON",{class:!0,"data-svelte-h":!0}),N(s)!=="svelte-1bbv8mw"&&(s.textContent=l),u.forEach(f),this.h()},h(){v(s,"class","training-start-button enabled svelte-29ezg5"),v(t,"class","training-start-button-area svelte-29ezg5")},m(o,u){r.m(o,u),H(o,e,u),H(o,t,u),c(t,s),n||(i=Q(s,"click",a[13]),n=!0)},p(o,u){p===(p=d(o))&&r?r.p(o,u):(r.d(1),r=p(o),r&&(r.c(),r.m(e.parentNode,e)))},d(o){o&&(f(e),f(t)),r.d(o),n=!1,i()}}}function Oe(a){let e,t,s="音域を測定しますか？（推奨・約1分）",l,n,i,d="音域を測定する",p,r;return{c(){e=g("div"),t=g("p"),t.textContent=s,l=w(),n=g("div"),i=g("button"),i.textContent=d,this.h()},l(o){e=h(o,"DIV",{class:!0});var u=P(e);t=h(u,"P",{class:!0,"data-svelte-h":!0}),N(t)!=="svelte-3iohjw"&&(t.textContent=s),l=E(u),n=h(u,"DIV",{class:!0});var T=P(n);i=h(T,"BUTTON",{class:!0,"data-svelte-h":!0}),N(i)!=="svelte-1ym7j28"&&(i.textContent=d),T.forEach(f),u.forEach(f),this.h()},h(){v(t,"class","vocal-range-prompt svelte-29ezg5"),v(i,"class","button-secondary svelte-29ezg5"),v(n,"class","button-group svelte-29ezg5"),v(e,"class","vocal-range-option svelte-29ezg5")},m(o,u){H(o,e,u),c(e,t),c(e,l),c(e,n),c(n,i),p||(r=Q(i,"click",a[14]),p=!0)},p:W,d(o){o&&f(e),p=!1,r()}}}function Re(a){let e,t,s,l="🎵",n,i,d,p="音域データ保存済み",r,o,u=a[11].range+"",T,y,D,M,_=new Date(a[11].measuredAt).toLocaleDateString("ja-JP")+"",m,C,L,S,q="再測定",j,B;return{c(){e=g("div"),t=g("div"),s=g("div"),s.textContent=l,n=w(),i=g("div"),d=g("h4"),d.textContent=p,r=w(),o=g("p"),T=$(u),y=w(),D=g("p"),M=$("測定日: "),m=$(_),C=w(),L=g("div"),S=g("button"),S.textContent=q,this.h()},l(O){e=h(O,"DIV",{class:!0});var b=P(e);t=h(b,"DIV",{class:!0});var z=P(t);s=h(z,"DIV",{class:!0,"data-svelte-h":!0}),N(s)!=="svelte-qna2it"&&(s.textContent=l),n=E(z),i=h(z,"DIV",{class:!0});var x=P(i);d=h(x,"H4",{class:!0,"data-svelte-h":!0}),N(d)!=="svelte-r4joip"&&(d.textContent=p),r=E(x),o=h(x,"P",{class:!0});var V=P(o);T=U(V,u),V.forEach(f),y=E(x),D=h(x,"P",{class:!0});var k=P(D);M=U(k,"測定日: "),m=U(k,_),k.forEach(f),x.forEach(f),z.forEach(f),C=E(b),L=h(b,"DIV",{class:!0});var I=P(L);S=h(I,"BUTTON",{class:!0,"data-svelte-h":!0}),N(S)!=="svelte-1kbjow2"&&(S.textContent=q),I.forEach(f),b.forEach(f),this.h()},h(){v(s,"class","range-icon svelte-29ezg5"),v(d,"class","range-title svelte-29ezg5"),v(o,"class","range-value svelte-29ezg5"),v(D,"class","range-date svelte-29ezg5"),v(i,"class","range-info svelte-29ezg5"),v(t,"class","existing-range-header svelte-29ezg5"),v(S,"class","button-ghost small svelte-29ezg5"),v(L,"class","range-actions svelte-29ezg5"),v(e,"class","existing-vocal-range svelte-29ezg5")},m(O,b){H(O,e,b),c(e,t),c(t,s),c(t,n),c(t,i),c(i,d),c(i,r),c(i,o),c(o,T),c(i,y),c(i,D),c(D,M),c(D,m),c(e,C),c(e,L),c(L,S),j||(B=Q(S,"click",a[18]),j=!0)},p(O,b){b[0]&2048&&u!==(u=O[11].range+"")&&G(T,u),b[0]&2048&&_!==(_=new Date(O[11].measuredAt).toLocaleDateString("ja-JP")+"")&&G(m,_)},d(O){O&&f(e),j=!1,B()}}}function Ae(a){let e;function t(n,i){return n[0]==="granted"?Se:Ne}let s=t(a),l=s(a);return{c(){e=g("div"),l.c(),this.h()},l(n){e=h(n,"DIV",{class:!0});var i=P(e);l.l(i),i.forEach(f),this.h()},h(){v(e,"class","training-mode-content svelte-29ezg5")},m(n,i){H(n,e,i),l.m(e,null)},p(n,i){s===(s=t(n))&&l?l.p(n,i):(l.d(1),l=s(n),l&&(l.c(),l.m(e,null)))},d(n){n&&f(e),l.d()}}}function ue(a){let e,t,s,l;return s=new he({props:{variant:"default",padding:"xl",$$slots:{default:[We]},$$scope:{ctx:a}}}),{c(){e=g("div"),t=g("div"),se(s.$$.fragment),this.h()},l(n){e=h(n,"DIV",{class:!0});var i=P(e);t=h(i,"DIV",{class:!0});var d=P(t);le(s.$$.fragment,d),d.forEach(f),i.forEach(f),this.h()},h(){v(t,"class","vocal-range-modal svelte-29ezg5"),v(e,"class","vocal-range-modal-overlay svelte-29ezg5")},m(n,i){H(n,e,i),c(e,t),te(s,t,null),l=!0},p(n,i){const d={};i[0]&1996|i[1]&8&&(d.$$scope={dirty:i,ctx:n}),s.$set(d)},i(n){l||(Z(s.$$.fragment,n),l=!0)},o(n){X(s.$$.fragment,n),l=!1},d(n){n&&f(e),ee(s)}}}function Ue(a){let e,t,s="測定完了",l,n,i,d,p="あなたの音域",r,o,u,T,y,D,M,_=`音域データを保存しました。<br/>
                各トレーニングモードで最適な基音が選択されます。`,m,C,L='<p class="info-title svelte-29ezg5">📁 データ保存について</p> <ul class="svelte-29ezg5"><li class="svelte-29ezg5">ブラウザのlocalStorageに保存されます</li> <li class="svelte-29ezg5">ブラウザのデータをクリアするまで保持されます</li> <li class="svelte-29ezg5">マイクテストページから再測定可能です</li></ul>',S,q,j="完了",B,O;return{c(){e=g("div"),t=g("h2"),t.textContent=s,l=w(),n=g("div"),i=g("div"),d=g("span"),d.textContent=p,r=w(),o=g("span"),u=$(a[7]),T=$(" - "),y=$(a[8]),D=w(),M=g("p"),M.innerHTML=_,m=w(),C=g("div"),C.innerHTML=L,S=w(),q=g("button"),q.textContent=j,this.h()},l(b){e=h(b,"DIV",{class:!0});var z=P(e);t=h(z,"H2",{class:!0,"data-svelte-h":!0}),N(t)!=="svelte-slmkyj"&&(t.textContent=s),l=E(z),n=h(z,"DIV",{class:!0});var x=P(n);i=h(x,"DIV",{class:!0});var V=P(i);d=h(V,"SPAN",{class:!0,"data-svelte-h":!0}),N(d)!=="svelte-1cnpkt2"&&(d.textContent=p),r=E(V),o=h(V,"SPAN",{class:!0});var k=P(o);u=U(k,a[7]),T=U(k," - "),y=U(k,a[8]),k.forEach(f),V.forEach(f),x.forEach(f),D=E(z),M=h(z,"P",{class:!0,"data-svelte-h":!0}),N(M)!=="svelte-16ahxe0"&&(M.innerHTML=_),m=E(z),C=h(z,"DIV",{class:!0,"data-svelte-h":!0}),N(C)!=="svelte-1m18ypu"&&(C.innerHTML=L),S=E(z),q=h(z,"BUTTON",{class:!0,"data-svelte-h":!0}),N(q)!=="svelte-1ardqp7"&&(q.textContent=j),z.forEach(f),this.h()},h(){v(t,"class","vocal-range-title svelte-29ezg5"),v(d,"class","result-label svelte-29ezg5"),v(o,"class","result-value svelte-29ezg5"),v(i,"class","result-item svelte-29ezg5"),v(n,"class","vocal-range-result svelte-29ezg5"),v(M,"class","vocal-range-complete-message svelte-29ezg5"),v(C,"class","data-persistence-info svelte-29ezg5"),v(q,"class","button-primary svelte-29ezg5"),v(e,"class","vocal-range-content svelte-29ezg5")},m(b,z){H(b,e,z),c(e,t),c(e,l),c(e,n),c(n,i),c(i,d),c(i,r),c(i,o),c(o,u),c(o,T),c(o,y),c(e,D),c(e,M),c(e,m),c(e,C),c(e,S),c(e,q),B||(O=Q(q,"click",a[17]),B=!0)},p(b,z){z[0]&128&&G(u,b[7]),z[0]&256&&G(y,b[8])},d(b){b&&f(e),B=!1,O()}}}function $e(a){let e,t,s="最高音の測定",l,n,i="できるだけ高い声で「アー」と3秒間歌ってください",d,p,r,o,u="検出音程",T,y,D,M,_,m=a[2].toFixed(1)+"",C,L,S,q,j;function B(V,k){if(V[10]>0)return Je;if(V[9])return Fe}let O=B(a),b=O&&O(a),z=a[9]&&a[3]!=="ーー"&&de(),x=a[8]&&!a[9]&&fe(a);return{c(){e=g("div"),t=g("h2"),t.textContent=s,l=w(),n=g("p"),n.textContent=i,d=w(),b&&b.c(),p=w(),r=g("div"),o=g("div"),o.textContent=u,T=w(),y=g("div"),D=$(a[3]),M=w(),_=g("div"),C=$(m),L=$(" Hz"),S=w(),z&&z.c(),j=w(),x&&x.c(),this.h()},l(V){e=h(V,"DIV",{class:!0});var k=P(e);t=h(k,"H2",{class:!0,"data-svelte-h":!0}),N(t)!=="svelte-1tbq04k"&&(t.textContent=s),l=E(k),n=h(k,"P",{class:!0,"data-svelte-h":!0}),N(n)!=="svelte-11stbze"&&(n.textContent=i),d=E(k),b&&b.l(k),p=E(k),r=h(k,"DIV",{class:!0});var I=P(r);o=h(I,"DIV",{class:!0,"data-svelte-h":!0}),N(o)!=="svelte-10dr3tk"&&(o.textContent=u),T=E(I),y=h(I,"DIV",{class:!0});var R=P(y);D=U(R,a[3]),R.forEach(f),M=E(I),_=h(I,"DIV",{class:!0});var F=P(_);C=U(F,m),L=U(F," Hz"),F.forEach(f),S=E(I),z&&z.l(I),I.forEach(f),j=E(k),x&&x.l(k),k.forEach(f),this.h()},h(){v(t,"class","vocal-range-title svelte-29ezg5"),v(n,"class","vocal-range-instruction svelte-29ezg5"),v(o,"class","note-label svelte-29ezg5"),v(y,"class","note-value svelte-29ezg5"),v(_,"class","frequency-value svelte-29ezg5"),v(r,"class",q="current-note-display "+(a[3]!=="ーー"&&a[9]?"detecting":"")+" svelte-29ezg5"),v(e,"class","vocal-range-content svelte-29ezg5")},m(V,k){H(V,e,k),c(e,t),c(e,l),c(e,n),c(e,d),b&&b.m(e,null),c(e,p),c(e,r),c(r,o),c(r,T),c(r,y),c(y,D),c(r,M),c(r,_),c(_,C),c(_,L),c(r,S),z&&z.m(r,null),c(e,j),x&&x.m(e,null)},p(V,k){O===(O=B(V))&&b?b.p(V,k):(b&&b.d(1),b=O&&O(V),b&&(b.c(),b.m(e,p))),k[0]&8&&G(D,V[3]),k[0]&4&&m!==(m=V[2].toFixed(1)+"")&&G(C,m),V[9]&&V[3]!=="ーー"?z||(z=de(),z.c(),z.m(r,null)):z&&(z.d(1),z=null),k[0]&520&&q!==(q="current-note-display "+(V[3]!=="ーー"&&V[9]?"detecting":"")+" svelte-29ezg5")&&v(r,"class",q),V[8]&&!V[9]?x?x.p(V,k):(x=fe(V),x.c(),x.m(e,null)):x&&(x.d(1),x=null)},d(V){V&&f(e),b&&b.d(),z&&z.d(),x&&x.d()}}}function je(a){let e,t,s="最低音の測定",l,n,i="できるだけ低い声で「アー」と3秒間歌ってください",d,p,r,o,u="検出音程",T,y,D,M,_,m=a[2].toFixed(1)+"",C,L,S,q,j;function B(I,R){if(I[10]>0)return Ze;if(I[9])return Ge}let O=B(a),b=O&&O(a),z=a[9]&&a[3]!=="ーー"&&ve();function x(I,R){if(I[7]&&!I[9])return Qe;if(!I[9]&&!I[10])return Ke}let V=x(a),k=V&&V(a);return{c(){e=g("div"),t=g("h2"),t.textContent=s,l=w(),n=g("p"),n.textContent=i,d=w(),b&&b.c(),p=w(),r=g("div"),o=g("div"),o.textContent=u,T=w(),y=g("div"),D=$(a[3]),M=w(),_=g("div"),C=$(m),L=$(" Hz"),S=w(),z&&z.c(),j=w(),k&&k.c(),this.h()},l(I){e=h(I,"DIV",{class:!0});var R=P(e);t=h(R,"H2",{class:!0,"data-svelte-h":!0}),N(t)!=="svelte-1wmk9ri"&&(t.textContent=s),l=E(R),n=h(R,"P",{class:!0,"data-svelte-h":!0}),N(n)!=="svelte-mh8lz8"&&(n.textContent=i),d=E(R),b&&b.l(R),p=E(R),r=h(R,"DIV",{class:!0});var F=P(r);o=h(F,"DIV",{class:!0,"data-svelte-h":!0}),N(o)!=="svelte-10dr3tk"&&(o.textContent=u),T=E(F),y=h(F,"DIV",{class:!0});var ne=P(y);D=U(ne,a[3]),ne.forEach(f),M=E(F),_=h(F,"DIV",{class:!0});var Y=P(_);C=U(Y,m),L=U(Y," Hz"),Y.forEach(f),S=E(F),z&&z.l(F),F.forEach(f),j=E(R),k&&k.l(R),R.forEach(f),this.h()},h(){v(t,"class","vocal-range-title svelte-29ezg5"),v(n,"class","vocal-range-instruction svelte-29ezg5"),v(o,"class","note-label svelte-29ezg5"),v(y,"class","note-value svelte-29ezg5"),v(_,"class","frequency-value svelte-29ezg5"),v(r,"class",q="current-note-display "+(a[3]!=="ーー"&&a[9]?"detecting":"")+" svelte-29ezg5"),v(e,"class","vocal-range-content svelte-29ezg5")},m(I,R){H(I,e,R),c(e,t),c(e,l),c(e,n),c(e,d),b&&b.m(e,null),c(e,p),c(e,r),c(r,o),c(r,T),c(r,y),c(y,D),c(r,M),c(r,_),c(_,C),c(_,L),c(r,S),z&&z.m(r,null),c(e,j),k&&k.m(e,null)},p(I,R){O===(O=B(I))&&b?b.p(I,R):(b&&b.d(1),b=O&&O(I),b&&(b.c(),b.m(e,p))),R[0]&8&&G(D,I[3]),R[0]&4&&m!==(m=I[2].toFixed(1)+"")&&G(C,m),I[9]&&I[3]!=="ーー"?z||(z=ve(),z.c(),z.m(r,null)):z&&(z.d(1),z=null),R[0]&520&&q!==(q="current-note-display "+(I[3]!=="ーー"&&I[9]?"detecting":"")+" svelte-29ezg5")&&v(r,"class",q),V===(V=x(I))&&k?k.p(I,R):(k&&k.d(1),k=V&&V(I),k&&(k.c(),k.m(e,null)))},d(I){I&&f(e),b&&b.d(),z&&z.d(),k&&k.d()}}}function Be(a){let e,t,s="音域測定",l,n,i=`あなたの音域を測定します。<br/>
                最低音と最高音を記録することで、<br/>
                最適なトレーニングを提供します。`,d,p,r='<div class="step svelte-29ezg5"><div class="step-number svelte-29ezg5">1</div> <div class="step-text svelte-29ezg5">できるだけ低い声で「アー」と歌う</div></div> <div class="step svelte-29ezg5"><div class="step-number svelte-29ezg5">2</div> <div class="step-text svelte-29ezg5">できるだけ高い声で「アー」と歌う</div></div>',o,u,T="測定を開始",y,D;return{c(){e=g("div"),t=g("h2"),t.textContent=s,l=w(),n=g("p"),n.innerHTML=i,d=w(),p=g("div"),p.innerHTML=r,o=w(),u=g("button"),u.textContent=T,this.h()},l(M){e=h(M,"DIV",{class:!0});var _=P(e);t=h(_,"H2",{class:!0,"data-svelte-h":!0}),N(t)!=="svelte-1w5t9lb"&&(t.textContent=s),l=E(_),n=h(_,"P",{class:!0,"data-svelte-h":!0}),N(n)!=="svelte-1ln5189"&&(n.innerHTML=i),d=E(_),p=h(_,"DIV",{class:!0,"data-svelte-h":!0}),N(p)!=="svelte-d4gwep"&&(p.innerHTML=r),o=E(_),u=h(_,"BUTTON",{class:!0,"data-svelte-h":!0}),N(u)!=="svelte-1o5m466"&&(u.textContent=T),_.forEach(f),this.h()},h(){v(t,"class","vocal-range-title svelte-29ezg5"),v(n,"class","vocal-range-description svelte-29ezg5"),v(p,"class","vocal-range-steps svelte-29ezg5"),v(u,"class","button-primary svelte-29ezg5"),v(e,"class","vocal-range-content svelte-29ezg5")},m(M,_){H(M,e,_),c(e,t),c(e,l),c(e,n),c(e,d),c(e,p),c(e,o),c(e,u),y||(D=Q(u,"click",a[15]),y=!0)},p:W,d(M){M&&f(e),y=!1,D()}}}function Fe(a){let e,t='<div class="recording-dot svelte-29ezg5"></div> <span>録音中...</span>';return{c(){e=g("div"),e.innerHTML=t,this.h()},l(s){e=h(s,"DIV",{class:!0,"data-svelte-h":!0}),N(e)!=="svelte-3i6u5s"&&(e.innerHTML=t),this.h()},h(){v(e,"class","recording-indicator svelte-29ezg5")},m(s,l){H(s,e,l)},p:W,d(s){s&&f(e)}}}function Je(a){let e,t;return{c(){e=g("div"),t=$(a[10]),this.h()},l(s){e=h(s,"DIV",{class:!0});var l=P(e);t=U(l,a[10]),l.forEach(f),this.h()},h(){v(e,"class","countdown svelte-29ezg5")},m(s,l){H(s,e,l),c(e,t)},p(s,l){l[0]&1024&&G(t,s[10])},d(s){s&&f(e)}}}function de(a){let e,t="音程を検出中...";return{c(){e=g("div"),e.textContent=t,this.h()},l(s){e=h(s,"DIV",{class:!0,"data-svelte-h":!0}),N(e)!=="svelte-cwkm3d"&&(e.textContent=t),this.h()},h(){v(e,"class","detecting-indicator svelte-29ezg5")},m(s,l){H(s,e,l)},d(s){s&&f(e)}}}function fe(a){let e,t,s,l;return{c(){e=g("div"),t=g("p"),s=$("最高音: "),l=$(a[8]),this.h()},l(n){e=h(n,"DIV",{class:!0});var i=P(e);t=h(i,"P",{class:!0});var d=P(t);s=U(d,"最高音: "),l=U(d,a[8]),d.forEach(f),i.forEach(f),this.h()},h(){v(t,"class","svelte-29ezg5"),v(e,"class","result-display svelte-29ezg5")},m(n,i){H(n,e,i),c(e,t),c(t,s),c(t,l)},p(n,i){i[0]&256&&G(l,n[8])},d(n){n&&f(e)}}}function Ge(a){let e,t='<div class="recording-dot svelte-29ezg5"></div> <span>録音中...</span>';return{c(){e=g("div"),e.innerHTML=t,this.h()},l(s){e=h(s,"DIV",{class:!0,"data-svelte-h":!0}),N(e)!=="svelte-3i6u5s"&&(e.innerHTML=t),this.h()},h(){v(e,"class","recording-indicator svelte-29ezg5")},m(s,l){H(s,e,l)},p:W,d(s){s&&f(e)}}}function Ze(a){let e,t;return{c(){e=g("div"),t=$(a[10]),this.h()},l(s){e=h(s,"DIV",{class:!0});var l=P(e);t=U(l,a[10]),l.forEach(f),this.h()},h(){v(e,"class","countdown svelte-29ezg5")},m(s,l){H(s,e,l),c(e,t)},p(s,l){l[0]&1024&&G(t,s[10])},d(s){s&&f(e)}}}function ve(a){let e,t="音程を検出中...";return{c(){e=g("div"),e.textContent=t,this.h()},l(s){e=h(s,"DIV",{class:!0,"data-svelte-h":!0}),N(e)!=="svelte-cwkm3d"&&(e.textContent=t),this.h()},h(){v(e,"class","detecting-indicator svelte-29ezg5")},m(s,l){H(s,e,l)},d(s){s&&f(e)}}}function Ke(a){let e,t='<p class="svelte-29ezg5">音程が検出されませんでした。再度録音します...</p>';return{c(){e=g("div"),e.innerHTML=t,this.h()},l(s){e=h(s,"DIV",{class:!0,"data-svelte-h":!0}),N(e)!=="svelte-h6cy6"&&(e.innerHTML=t),this.h()},h(){v(e,"class","retry-message svelte-29ezg5")},m(s,l){H(s,e,l)},p:W,d(s){s&&f(e)}}}function Qe(a){let e,t,s="✓",l,n,i,d,p,r,o,u="次へ（最高音測定）",T,y;return{c(){e=g("div"),t=g("div"),t.textContent=s,l=w(),n=g("p"),i=$("最低音を記録しました: "),d=g("strong"),p=$(a[7]),r=w(),o=g("button"),o.textContent=u,this.h()},l(D){e=h(D,"DIV",{class:!0});var M=P(e);t=h(M,"DIV",{class:!0,"data-svelte-h":!0}),N(t)!=="svelte-u2687x"&&(t.textContent=s),l=E(M),n=h(M,"P",{class:!0});var _=P(n);i=U(_,"最低音を記録しました: "),d=h(_,"STRONG",{class:!0});var m=P(d);p=U(m,a[7]),m.forEach(f),_.forEach(f),r=E(M),o=h(M,"BUTTON",{class:!0,"data-svelte-h":!0}),N(o)!=="svelte-1xyzui5"&&(o.textContent=u),M.forEach(f),this.h()},h(){v(t,"class","success-icon svelte-29ezg5"),v(d,"class","svelte-29ezg5"),v(n,"class","success-message svelte-29ezg5"),v(o,"class","button-primary svelte-29ezg5"),v(e,"class","result-display success svelte-29ezg5")},m(D,M){H(D,e,M),c(e,t),c(e,l),c(e,n),c(n,i),c(n,d),c(d,p),c(e,r),c(e,o),T||(y=Q(o,"click",a[16]),T=!0)},p(D,M){M[0]&128&&G(p,D[7])},d(D){D&&f(e),T=!1,y()}}}function We(a){let e;function t(n,i){if(n[6]==="intro")return Be;if(n[6]==="low")return je;if(n[6]==="high")return $e;if(n[6]==="complete")return Ue}let s=t(a),l=s&&s(a);return{c(){l&&l.c(),e=K()},l(n){l&&l.l(n),e=K()},m(n,i){l&&l.m(n,i),H(n,e,i)},p(n,i){s===(s=t(n))&&l?l.p(n,i):(l&&l.d(1),l=s&&s(n),l&&(l.c(),l.m(e.parentNode,e)))},d(n){n&&f(e),l&&l.d(n)}}}function Xe(a){let e,t,s='<div class="mic-test-header svelte-29ezg5"><div class="mic-icon svelte-29ezg5"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" x2="12" y1="19" y2="22"></line><line x1="8" x2="16" y1="22" y2="22"></line></svg></div> <div><h1 class="mic-test-title svelte-29ezg5">マイクテスト</h1> <p class="mic-test-description svelte-29ezg5">音感トレーニングを始める前に、マイクの動作を確認します</p></div></div>',l,n,i,d,p,r,o,u,T,y,D;i=new he({props:{variant:"default",padding:"lg",$$slots:{default:[Ae]},$$scope:{ctx:a}}}),p=new we({props:{frequency:a[2],note:a[3],volume:a[1],isMuted:a[0]!=="granted",muteMessage:"マイク許可後に開始"}});let M={isActive:a[0]==="granted",className:"pitch-detector-content",debugMode:!1};u=new Pe({props:M}),a[22](u),u.$on("pitchUpdate",a[19]),u.$on("stateChange",et),u.$on("error",a[20]);let _=a[5]&&ue(a);return{c(){e=g("div"),t=g("div"),t.innerHTML=s,l=w(),n=g("div"),se(i.$$.fragment),d=w(),se(p.$$.fragment),r=w(),o=g("div"),se(u.$$.fragment),T=w(),_&&_.c(),y=K(),this.h()},l(m){e=h(m,"DIV",{class:!0});var C=P(e);t=h(C,"DIV",{class:!0,"data-svelte-h":!0}),N(t)!=="svelte-4qcd63"&&(t.innerHTML=s),l=E(C),n=h(C,"DIV",{class:!0});var L=P(n);le(i.$$.fragment,L),L.forEach(f),d=E(C),le(p.$$.fragment,C),r=E(C),o=h(C,"DIV",{style:!0});var S=P(o);le(u.$$.fragment,S),S.forEach(f),C.forEach(f),T=E(m),_&&_.l(m),y=K(),this.h()},h(){v(t,"class","header svelte-29ezg5"),v(n,"class","training-mode-info svelte-29ezg5"),De(o,"display","none"),v(e,"class","microphone-test svelte-29ezg5")},m(m,C){H(m,e,C),c(e,t),c(e,l),c(e,n),te(i,n,null),c(e,d),te(p,e,null),c(e,r),c(e,o),te(u,o,null),H(m,T,C),_&&_.m(m,C),H(m,y,C),D=!0},p(m,C){const L={};C[0]&2081|C[1]&8&&(L.$$scope={dirty:C,ctx:m}),i.$set(L);const S={};C[0]&4&&(S.frequency=m[2]),C[0]&8&&(S.note=m[3]),C[0]&2&&(S.volume=m[1]),C[0]&1&&(S.isMuted=m[0]!=="granted"),p.$set(S);const q={};C[0]&1&&(q.isActive=m[0]==="granted"),u.$set(q),m[5]?_?(_.p(m,C),C[0]&32&&Z(_,1)):(_=ue(m),_.c(),Z(_,1),_.m(y.parentNode,y)):_&&(ke(),X(_,1,1,()=>{_=null}),Te())},i(m){D||(Z(i.$$.fragment,m),Z(p.$$.fragment,m),Z(u.$$.fragment,m),Z(_),D=!0)},o(m){X(i.$$.fragment,m),X(p.$$.fragment,m),X(u.$$.fragment,m),X(_),D=!1},d(m){m&&(f(e),f(T),f(y)),ee(i),ee(p),a[22](null),ee(u),_&&_.d(m)}}}function Ye(a){let e,t,s;return t=new Ee({props:{showBackButton:!0,$$slots:{default:[Xe]},$$scope:{ctx:a}}}),{c(){e=w(),se(t.$$.fragment),this.h()},l(l){ze("svelte-8st1fo",document.head).forEach(f),e=E(l),le(t.$$.fragment,l),this.h()},h(){document.title="マイクテスト - 相対音感トレーニング"},m(l,n){H(l,e,n),te(t,l,n),s=!0},p(l,n){const i={};n[0]&4095|n[1]&8&&(i.$$scope={dirty:n,ctx:l}),t.$set(i)},i(l){s||(Z(t.$$.fragment,l),s=!0)},o(l){X(t.$$.fragment,l),s=!1},d(l){l&&f(e),ee(t,l)}}}function et(a){}function tt(a,e,t){let s,l;Ce(a,Me,A=>t(27,l=A));let n="random";re(()=>{l.url.searchParams.has("mode")&&t(21,n=l.url.searchParams.get("mode")||"random"),i()});function i(){if(typeof localStorage<"u"){const A=localStorage.getItem("vocal-range");if(A)try{t(11,S=JSON.parse(A)),console.log("既存音域データ発見:",S)}catch(J){console.error("音域データ解析エラー:",J),t(11,S=null)}}}let d="initial",p=0,r=0,o="ーー",u=null,T=!1,y="intro",D=null,M=null,_=null,m=null,C=!1,L=0,S=null,q=null;re(()=>{q=ie.getPlatformSpecs()});const j={random:{name:"ランダム基音モード",description:"10種類の基音からランダムに選択してトレーニング",color:"green",path:"/training/random"},continuous:{name:"連続チャレンジモード",description:"選択した回数だけ連続で実行し、総合評価を確認",color:"orange",path:"/training/continuous"},chromatic:{name:"12音階モード",description:"クロマチックスケールの上行・下行で完全制覇",color:"purple",path:"/training/chromatic"}};async function B(){var A;t(0,d="pending");try{if(console.log("🎤 [MicTest] マイク許可リクエスト開始"),!((A=navigator.mediaDevices)!=null&&A.getUserMedia)){t(0,d="denied"),console.error("❌ [MicTest] getUserMediaがサポートされていません");return}const J=await ie.initialize();if(console.log("✅ [MicTest] AudioManager リソース取得完了"),J.mediaStream&&J.audioContext)t(0,d="granted"),console.log("✅ [MicTest] マイク許可完了"),await ge(),setTimeout(async()=>{u&&(console.log("🎙️ [MicTest] PitchDetector初期化開始"),await u.initialize(),console.log("✅ [MicTest] PitchDetector初期化完了"),console.log("🎯 [MicTest] PitchDetector isActiveリアクティブで自動検出開始"))},1e3);else throw new Error("リソース取得失敗")}catch(J){console.error("❌ [MicTest] マイク許可エラー:",J),t(0,d=((J==null?void 0:J.name)==="NotAllowedError","denied"))}}function O(){console.log(`🚀 [MicTest] トレーニング開始 - ${s.name}へ遷移`),localStorage.setItem("mic-test-completed","true"),console.log("✅ [MicTest] マイクテスト完了フラグを保存"),Ve(`${Ie}${s.path}?from=microphone-test`)}function b(){t(5,T=!0),t(6,y="intro")}function z(){t(6,y="low"),V()}function x(){t(6,y="high"),V()}function V(){t(9,C=!0),t(10,L=3);const A=setInterval(()=>{t(10,L--,L),L<=0&&(clearInterval(A),setTimeout(()=>{k()},3e3))},1e3)}function k(){t(9,C=!1),y==="low"?o!=="ーー"&&r>50?(t(7,D=o),M=r,console.log("最低音記録:",D,M)):(console.log("最低音が検出されませんでした。もう一度お試しください。"),setTimeout(()=>{V()},1e3)):y==="high"&&(o!=="ーー"&&r>50?(t(8,_=o),m=r,console.log("最高音記録:",_,m),D&&_&&(t(6,y="complete"),I())):(console.log("最高音が検出されませんでした。もう一度お試しください。"),setTimeout(()=>{V()},1e3)))}function I(){const A={measured:!0,measuredAt:new Date().toISOString(),lowestNote:D,lowestFrequency:M,highestNote:_,highestFrequency:m,range:`${D}-${_}`};localStorage.setItem("vocal-range",JSON.stringify(A)),console.log("音域データ保存:",A)}function R(){t(5,T=!1),i()}function F(){t(11,S=null),t(7,D=null),M=null,t(8,_=null),m=null,b()}function ne(A){const{frequency:J,note:oe,volume:ae,rawVolume:lt,clarity:st}=A.detail;t(2,r=J),t(3,o=oe),t(1,p=ae)}function Y(A){console.error("❌ [MicTest] PitchDetectorエラー:",A.detail);const{error:J,reason:oe,recovery:ae}=A.detail;oe==="mediastream_ended"&&ae==="restart_required"&&(console.log("🔄 [MicTest] MediaStream終了検出 - 自動復旧開始"),t(0,d="initial"),t(1,p=0),t(2,r=0),t(3,o="ーー"),console.log("⚠️ [MicTest] マイク再許可が必要です"))}async function ge(){if(q&&q.deviceType==="iPad"){console.log("🔧 [MicTest] iPad検出 - マイク感度7.0x自動設定開始"),ie.setSensitivity(7),console.log("✅ [MicTest] iPad マイク感度7.0x自動設定完了");try{await ie.initialize(),console.log("🔄 [MicTest] iPad用AudioManager再初期化完了")}catch(A){console.warn("⚠️ [MicTest] AudioManager再初期化エラー:",A)}}}function pe(A){ye[A?"unshift":"push"](()=>{u=A,t(4,u)})}return a.$$.update=()=>{a.$$.dirty[0]&2097152&&(s=j[n]||j.random)},[d,p,r,o,u,T,y,D,_,C,L,S,B,O,b,z,x,R,F,ne,Y,n,pe]}class dt extends _e{constructor(e){super(),me(this,e,tt,Ye,be,{},null,[-1,-1])}}export{dt as component,ut as universal};
