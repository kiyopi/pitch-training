import{S as Ge,i as Oe,d as O,s as Ue,v as Je,c as Ze,a as Ke,D as pe,E as Ce,b as d,q as oe,r as ae,u as re,f as R,w as ce,F as Qe,m as T,x as ue,p as z,y as fe,g as c,z as f,h as v,j as g,k as w,B as ne,A as J,o as y,C as se,G as ke,e as ee,l as K,t as Q,n as me,H as be,I as ge}from"../chunks/D8aoWfRe.js";import{g as We}from"../chunks/D0QH3NT1.js";import"../chunks/BXq3pflB.js";import{p as he}from"../chunks/KFehi8Zk.js";import{b as De,g as Ee}from"../chunks/BsozOZMG.js";import{P as Ae,B as Xe,C as de}from"../chunks/Cs3yrXb8.js";import{a as le}from"../chunks/C0W1r00p.js";const{console:Ye}=We,_="src/routes/microphone-test/+page.svelte";function Se(r){let e,t="マイク準備完了",l,n,o="トレーニング開始ボタンを押してランダム基音モードへ進んでください",a,s,i,m="トレーニング開始",p,h;const b={c:function(){e=y("h3"),e.textContent=t,l=z(),n=y("p"),n.textContent=o,a=z(),s=y("div"),i=y("button"),i.textContent=m,this.h()},l:function(E){e=g(E,"H3",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-11dam81"&&(e.textContent=t),l=T(E),n=g(E,"P",{class:!0,"data-svelte-h":!0}),J(n)!=="svelte-5idwhi"&&(n.textContent=o),a=T(E),s=g(E,"DIV",{class:!0});var C=w(s);i=g(C,"BUTTON",{class:!0,"data-svelte-h":!0}),J(i)!=="svelte-kae9rs"&&(i.textContent=m),C.forEach(d),this.h()},h:function(){f(e,"class","ready-title svelte-19mrh3"),v(e,_,333,12,10314),f(n,"class","ready-description svelte-19mrh3"),v(n,_,334,12,10363),f(i,"class","training-start-button enabled svelte-19mrh3"),v(i,_,337,14,10509),f(s,"class","training-start-button-area svelte-19mrh3"),v(s,_,336,12,10454)},m:function(E,C){R(E,e,C),R(E,l,C),R(E,n,C),R(E,a,C),R(E,s,C),c(s,i),p||(h=ge(i,"click",r[12],!1),p=!0)},p:me,d:function(E){E&&(d(e),d(l),d(n),d(a),d(s)),p=!1,h()}};return O("SvelteRegisterBlock",{block:b,id:Se.name,type:"else",source:"(332:10) {:else}",ctx:r}),b}function Be(r){let e,t;function l(p,h){return p[3]==="granted"&&p[4]&&(!p[0]||!p[1])?Me:Ie}let n=l(r),o=n(r);function a(p,h){if(p[3]==="pending")return Fe;if(p[3]==="denied")return xe;if(p[3]==="initial")return Pe}let s=a(r),i=s&&s(r);const m={c:function(){o.c(),e=z(),i&&i.c(),t=be()},l:function(h){o.l(h),e=T(h),i&&i.l(h),t=be()},m:function(h,b){o.m(h,b),R(h,e,b),i&&i.m(h,b),R(h,t,b)},p:function(h,b){n!==(n=l(h))&&(o.d(1),o=n(h),o&&(o.c(),o.m(e.parentNode,e))),s===(s=a(h))&&i?i.p(h,b):(i&&i.d(1),i=s&&s(h),i&&(i.c(),i.m(t.parentNode,t)))},d:function(h){h&&(d(e),d(t)),o.d(h),i&&i.d(h)}};return O("SvelteRegisterBlock",{block:m,id:Be.name,type:"if",source:"(306:10) {#if !audioConfirmationComplete}",ctx:r}),m}function Ie(r){let e,t="マイクのテストを開始します",l,n,o="マイクテスト開始ボタンを押してマイクの使用を許可してください";const a={c:function(){e=y("h3"),e.textContent=t,l=z(),n=y("p"),n.textContent=o,this.h()},l:function(i){e=g(i,"H3",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-gfi16f"&&(e.textContent=t),l=T(i),n=g(i,"P",{class:!0,"data-svelte-h":!0}),J(n)!=="svelte-1w19y1h"&&(n.textContent=o),this.h()},h:function(){f(e,"class","instructions-title svelte-19mrh3"),v(e,_,312,14,9451),f(n,"class","instructions-description svelte-19mrh3"),v(n,_,313,14,9515)},m:function(i,m){R(i,e,m),R(i,l,m),R(i,n,m)},d:function(i){i&&(d(e),d(l),d(n))}};return O("SvelteRegisterBlock",{block:a,id:Ie.name,type:"else",source:"(311:12) {:else}",ctx:r}),a}function Me(r){let e,t="「ドー」と発声してください";const l={c:function(){e=y("p"),e.textContent=t,this.h()},l:function(o){e=g(o,"P",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-15d2sx7"&&(e.textContent=t),this.h()},h:function(){f(e,"class","status-text voice-instruction svelte-19mrh3"),v(e,_,309,14,9323)},m:function(o,a){R(o,e,a)},d:function(o){o&&d(e)}};return O("SvelteRegisterBlock",{block:l,id:Me.name,type:"if",source:"(308:12) {#if micPermission === 'granted' && isListening && (!volumeDetected || !frequencyDetected)}",ctx:r}),l}function Pe(r){let e,t,l="マイクテストを開始",n,o;const a={c:function(){e=y("div"),t=y("button"),t.textContent=l,this.h()},l:function(i){e=g(i,"DIV",{class:!0});var m=w(e);t=g(m,"BUTTON",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-caex95"&&(t.textContent=l),m.forEach(d),this.h()},h:function(){f(t,"class","mic-test-button start svelte-19mrh3"),v(t,_,326,16,10088),f(e,"class","mic-test-button-area svelte-19mrh3"),v(e,_,325,14,10037)},m:function(i,m){R(i,e,m),c(e,t),n||(o=ge(t,"click",r[11],!1),n=!0)},p:me,d:function(i){i&&d(e),n=!1,o()}};return O("SvelteRegisterBlock",{block:a,id:Pe.name,type:"if",source:"(325:50) ",ctx:r}),a}function xe(r){let e,t,l="マイク許可を再試行",n,o;const a={c:function(){e=y("div"),t=y("button"),t.textContent=l,this.h()},l:function(i){e=g(i,"DIV",{class:!0});var m=w(e);t=g(m,"BUTTON",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-1p3n8nt"&&(t.textContent=l),m.forEach(d),this.h()},h:function(){f(t,"class","mic-test-button retry svelte-19mrh3"),v(t,_,320,16,9829),f(e,"class","mic-test-button-area svelte-19mrh3"),v(e,_,319,14,9778)},m:function(i,m){R(i,e,m),c(e,t),n||(o=ge(t,"click",r[11],!1),n=!0)},p:me,d:function(i){i&&d(e),n=!1,o()}};return O("SvelteRegisterBlock",{block:a,id:xe.name,type:"if",source:"(319:49) ",ctx:r}),a}function Fe(r){let e,t="マイク準備中...";const l={c:function(){e=y("p"),e.textContent=t,this.h()},l:function(o){e=g(o,"P",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-1vb5g92"&&(e.textContent=t),this.h()},h:function(){f(e,"class","status-text svelte-19mrh3"),v(e,_,317,14,9677)},m:function(o,a){R(o,e,a)},p:me,d:function(o){o&&d(e)}};return O("SvelteRegisterBlock",{block:l,id:Fe.name,type:"if",source:"(317:12) {#if micPermission === 'pending'}",ctx:r}),l}function qe(r){let e;function t(a,s){return a[2]?Se:Be}let l=t(r),n=l(r);const o={c:function(){e=y("div"),n.c(),this.h()},l:function(s){e=g(s,"DIV",{class:!0});var i=w(e);n.l(i),i.forEach(d),this.h()},h:function(){f(e,"class","training-mode-content svelte-19mrh3"),v(e,_,304,8,9058)},m:function(s,i){R(s,e,i),n.m(e,null)},p:function(s,i){l===(l=t(s))&&n?n.p(s,i):(n.d(1),n=l(s),n&&(n.c(),n.m(e,null)))},d:function(s){s&&d(e),n.d()}};return O("SvelteRegisterBlock",{block:o,id:qe.name,type:"slot",source:'(304:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:r}),o}function ve(r){let e,t,l,n,o="フィルター前:",a,s,i=r[8].toFixed(1)+"",m,p,h,b,P,E="フィルター後:",C,x,V=r[9].toFixed(1)+"",B,N,I,k,D,S="ノイズ削減:",A,M,Z,L;const F={c:function(){e=y("div"),t=y("div"),l=y("div"),n=y("span"),n.textContent=o,a=z(),s=y("span"),m=Q(i),p=Q("%"),h=z(),b=y("div"),P=y("span"),P.textContent=E,C=z(),x=y("span"),B=Q(V),N=Q("%"),I=z(),k=y("div"),D=y("span"),D.textContent=S,A=z(),M=y("span"),Z=Q(r[10]),L=Q("%"),this.h()},l:function(j){e=g(j,"DIV",{class:!0});var G=w(e);t=g(G,"DIV",{class:!0});var u=w(t);l=g(u,"DIV",{class:!0});var H=w(l);n=g(H,"SPAN",{class:!0,"data-svelte-h":!0}),J(n)!=="svelte-1nh45c7"&&(n.textContent=o),a=T(H),s=g(H,"SPAN",{class:!0});var U=w(s);m=K(U,i),p=K(U,"%"),U.forEach(d),H.forEach(d),h=T(u),b=g(u,"DIV",{class:!0});var W=w(b);P=g(W,"SPAN",{class:!0,"data-svelte-h":!0}),J(P)!=="svelte-fz1u1y"&&(P.textContent=E),C=T(W),x=g(W,"SPAN",{class:!0});var X=w(x);B=K(X,V),N=K(X,"%"),X.forEach(d),W.forEach(d),I=T(u),k=g(u,"DIV",{class:!0});var $=w(k);D=g($,"SPAN",{class:!0,"data-svelte-h":!0}),J(D)!=="svelte-3jbm0v"&&(D.textContent=S),A=T($),M=g($,"SPAN",{class:!0});var te=w(M);Z=K(te,r[10]),L=K(te,"%"),te.forEach(d),$.forEach(d),u.forEach(d),G.forEach(d),this.h()},h:function(){f(n,"class","stat-label svelte-19mrh3"),v(n,_,363,20,11396),f(s,"class","stat-value raw svelte-19mrh3"),v(s,_,364,20,11456),f(l,"class","stat-item svelte-19mrh3"),v(l,_,362,18,11352),f(P,"class","stat-label svelte-19mrh3"),v(P,_,367,20,11603),f(x,"class","stat-value filtered svelte-19mrh3"),v(x,_,368,20,11663),f(b,"class","stat-item svelte-19mrh3"),v(b,_,366,18,11559),f(D,"class","stat-label svelte-19mrh3"),v(D,_,371,20,11820),f(M,"class","stat-value reduction svelte-19mrh3"),v(M,_,372,20,11879),f(k,"class","stat-item svelte-19mrh3"),v(k,_,370,18,11776),f(t,"class","noise-stats svelte-19mrh3"),v(t,_,361,16,11308),f(e,"class","noise-reduction-info svelte-19mrh3"),v(e,_,360,14,11257)},m:function(j,G){R(j,e,G),c(e,t),c(t,l),c(l,n),c(l,a),c(l,s),c(s,m),c(s,p),c(t,h),c(t,b),c(b,P),c(b,C),c(b,x),c(x,B),c(x,N),c(t,I),c(t,k),c(k,D),c(k,A),c(k,M),c(M,Z),c(M,L)},p:function(j,G){G&256&&i!==(i=j[8].toFixed(1)+"")&&ee(m,i),G&512&&V!==(V=j[9].toFixed(1)+"")&&ee(B,V),G&1024&&ee(Z,j[10])},d:function(j){j&&d(e)}};return O("SvelteRegisterBlock",{block:F,id:ve.name,type:"if",source:"(360:12) {#if isListening}",ctx:r}),F}function Ne(r){let e;const t={c:function(){e=Q(" ")},l:function(n){e=K(n," ")},m:function(n,o){R(n,e,o)},d:function(n){n&&d(e)}};return O("SvelteRegisterBlock",{block:t,id:Ne.name,type:"else",source:"(383:16) {:else}",ctx:r}),t}function Re(r){let e;const t={c:function(){e=Q("⏳ 声を出して音量を確認してください")},l:function(n){e=K(n,"⏳ 声を出して音量を確認してください")},m:function(n,o){R(n,e,o)},d:function(n){n&&d(e)}};return O("SvelteRegisterBlock",{block:t,id:Re.name,type:"if",source:"(381:16) {#if !volumeDetected && isListening}",ctx:r}),t}function Te(r){let e,t,l,n="音量レベル",o,a,s,i,m,p=r[5].toFixed(1)+"",h,b,P,E,C,x,V=r[4]&&ve(r);function B(D,S){return!D[0]&&D[4]?Re:Ne}let N=B(r),I=N(r);const k={c:function(){e=y("div"),t=y("div"),l=y("h3"),l.textContent=n,o=z(),a=y("div"),s=y("div"),i=z(),m=y("div"),h=Q(p),b=Q("%"),P=z(),V&&V.c(),E=z(),C=y("div"),x=y("span"),I.c(),this.h()},l:function(S){e=g(S,"DIV",{class:!0});var A=w(e);t=g(A,"DIV",{class:!0});var M=w(t);l=g(M,"H3",{class:!0,"data-svelte-h":!0}),J(l)!=="svelte-1nc8gri"&&(l.textContent=n),o=T(M),a=g(M,"DIV",{class:!0});var Z=w(a);s=g(Z,"DIV",{class:!0,style:!0}),w(s).forEach(d),Z.forEach(d),i=T(M),m=g(M,"DIV",{class:!0});var L=w(m);h=K(L,p),b=K(L,"%"),L.forEach(d),P=T(M),V&&V.l(M),E=T(M),C=g(M,"DIV",{class:!0});var F=w(C);x=g(F,"SPAN",{class:!0});var q=w(x);I.l(q),q.forEach(d),F.forEach(d),M.forEach(d),A.forEach(d),this.h()},h:function(){f(l,"class","display-title svelte-19mrh3"),v(l,_,352,12,10914),f(s,"class","volume-bar svelte-19mrh3"),ke(s,"width",r[5]+"%"),v(s,_,354,14,11012),f(a,"class","volume-bar-container svelte-19mrh3"),v(a,_,353,12,10963),f(m,"class","volume-text svelte-19mrh3"),v(m,_,356,12,11106),f(x,"class","status-pending svelte-19mrh3"),v(x,_,379,14,12093),f(C,"class","volume-status svelte-19mrh3"),v(C,_,378,12,12051),f(t,"class","volume-section svelte-19mrh3"),v(t,_,351,10,10873),f(e,"class","card-inner svelte-19mrh3"),v(e,_,350,8,10838)},m:function(S,A){R(S,e,A),c(e,t),c(t,l),c(t,o),c(t,a),c(a,s),c(t,i),c(t,m),c(m,h),c(m,b),c(t,P),V&&V.m(t,null),c(t,E),c(t,C),c(C,x),I.m(x,null)},p:function(S,A){A&32&&ke(s,"width",S[5]+"%"),A&32&&p!==(p=S[5].toFixed(1)+"")&&ee(h,p),S[4]?V?V.p(S,A):(V=ve(S),V.c(),V.m(t,E)):V&&(V.d(1),V=null),N!==(N=B(S))&&(I.d(1),I=N(S),I&&(I.c(),I.m(x,null)))},d:function(S){S&&d(e),V&&V.d(),I.d()}};return O("SvelteRegisterBlock",{block:k,id:Te.name,type:"slot",source:'(350:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:r}),k}function ze(r){let e;const t={c:function(){e=Q(" ")},l:function(n){e=K(n," ")},m:function(n,o){R(n,e,o)},d:function(n){n&&d(e)}};return O("SvelteRegisterBlock",{block:t,id:ze.name,type:"else",source:"(405:16) {:else}",ctx:r}),t}function Le(r){let e;const t={c:function(){e=Q("⏳ 「ド」を発声して音程を確認してください")},l:function(n){e=K(n,"⏳ 「ド」を発声して音程を確認してください")},m:function(n,o){R(n,e,o)},d:function(n){n&&d(e)}};return O("SvelteRegisterBlock",{block:t,id:Le.name,type:"if",source:"(403:16) {#if !frequencyDetected && isListening}",ctx:r}),t}function He(r){let e,t,l,n="音程検出",o,a,s,i=r[6]>0?r[6].toFixed(1)+" Hz":"ーー",m,p,h,b,P,E,C;function x(I,k){return!I[1]&&I[4]?Le:ze}let V=x(r),B=V(r);const N={c:function(){e=y("div"),t=y("div"),l=y("h3"),l.textContent=n,o=z(),a=y("div"),s=y("div"),m=Q(i),p=z(),h=y("div"),b=Q(r[7]),P=z(),E=y("div"),C=y("span"),B.c(),this.h()},l:function(k){e=g(k,"DIV",{class:!0});var D=w(e);t=g(D,"DIV",{class:!0});var S=w(t);l=g(S,"H3",{class:!0,"data-svelte-h":!0}),J(l)!=="svelte-1ofzoy2"&&(l.textContent=n),o=T(S),a=g(S,"DIV",{class:!0});var A=w(a);s=g(A,"DIV",{class:!0});var M=w(s);m=K(M,i),M.forEach(d),p=T(A),h=g(A,"DIV",{class:!0});var Z=w(h);b=K(Z,r[7]),Z.forEach(d),A.forEach(d),P=T(S),E=g(S,"DIV",{class:!0});var L=w(E);C=g(L,"SPAN",{class:!0});var F=w(C);B.l(F),F.forEach(d),L.forEach(d),S.forEach(d),D.forEach(d),this.h()},h:function(){f(l,"class","display-title svelte-19mrh3"),v(l,_,395,12,12526),f(s,"class","frequency-value svelte-19mrh3"),v(s,_,397,14,12620),f(h,"class","note-value svelte-19mrh3"),v(h,_,398,14,12737),f(a,"class","frequency-display svelte-19mrh3"),v(a,_,396,12,12574),f(C,"class","status-pending svelte-19mrh3"),v(C,_,401,14,12857),f(E,"class","frequency-status svelte-19mrh3"),v(E,_,400,12,12812),f(t,"class","frequency-section svelte-19mrh3"),v(t,_,394,10,12482),f(e,"class","card-inner svelte-19mrh3"),v(e,_,393,8,12447)},m:function(k,D){R(k,e,D),c(e,t),c(t,l),c(t,o),c(t,a),c(a,s),c(s,m),c(a,p),c(a,h),c(h,b),c(t,P),c(t,E),c(E,C),B.m(C,null)},p:function(k,D){D&64&&i!==(i=k[6]>0?k[6].toFixed(1)+" Hz":"ーー")&&ee(m,i),D&128&&ee(b,k[7]),V!==(V=x(k))&&(B.d(1),B=V(k),B&&(B.c(),B.m(C,null)))},d:function(k){k&&d(e),B.d()}};return O("SvelteRegisterBlock",{block:N,id:He.name,type:"slot",source:'(393:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:r}),N}function je(r){let e,t,l,n,o,a,s,i,m,p,h,b,P="マイクテスト",E,C,x="音感トレーニングを始める前に、マイクの動作を確認します",V,B,N,I,k,D,S,A,M;N=new de({props:{variant:"default",padding:"lg",$$slots:{default:[qe]},$$scope:{ctx:r}},$$inline:!0}),D=new de({props:{variant:"default",padding:"lg",$$slots:{default:[Te]},$$scope:{ctx:r}},$$inline:!0}),A=new de({props:{variant:"default",padding:"lg",$$slots:{default:[He]},$$scope:{ctx:r}},$$inline:!0});const Z={c:function(){e=y("div"),t=y("div"),l=y("div"),n=y("div"),o=se("svg"),a=se("path"),s=se("path"),i=se("line"),m=se("line"),p=z(),h=y("div"),b=y("h1"),b.textContent=P,E=z(),C=y("p"),C.textContent=x,V=z(),B=y("div"),fe(N.$$.fragment),I=z(),k=y("div"),fe(D.$$.fragment),S=z(),fe(A.$$.fragment),this.h()},l:function(F){e=g(F,"DIV",{class:!0});var q=w(e);t=g(q,"DIV",{class:!0});var j=w(t);l=g(j,"DIV",{class:!0});var G=w(l);n=g(G,"DIV",{class:!0});var u=w(n);o=ne(u,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var H=w(o);a=ne(H,"path",{d:!0}),w(a).forEach(d),s=ne(H,"path",{d:!0}),w(s).forEach(d),i=ne(H,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),w(i).forEach(d),m=ne(H,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),w(m).forEach(d),H.forEach(d),u.forEach(d),p=T(G),h=g(G,"DIV",{});var U=w(h);b=g(U,"H1",{class:!0,"data-svelte-h":!0}),J(b)!=="svelte-z7m4lk"&&(b.textContent=P),E=T(U),C=g(U,"P",{class:!0,"data-svelte-h":!0}),J(C)!=="svelte-1vtv92f"&&(C.textContent=x),U.forEach(d),G.forEach(d),j.forEach(d),V=T(q),B=g(q,"DIV",{class:!0});var W=w(B);ue(N.$$.fragment,W),W.forEach(d),I=T(q),k=g(q,"DIV",{class:!0});var X=w(k);ue(D.$$.fragment,X),S=T(X),ue(A.$$.fragment,X),X.forEach(d),q.forEach(d),this.h()},h:function(){f(a,"d","M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"),v(a,_,288,12,8516),f(s,"d","M19 10v2a7 7 0 0 1-14 0v-2"),v(s,_,289,12,8593),f(i,"x1","12"),f(i,"x2","12"),f(i,"y1","19"),f(i,"y2","22"),v(i,_,290,12,8644),f(m,"x1","8"),f(m,"x2","16"),f(m,"y1","22"),f(m,"y2","22"),v(m,_,291,12,8696),f(o,"width","48"),f(o,"height","48"),f(o,"viewBox","0 0 24 24"),f(o,"fill","none"),f(o,"stroke","currentColor"),f(o,"stroke-width","2"),v(o,_,287,10,8404),f(n,"class","mic-icon svelte-19mrh3"),v(n,_,286,8,8371),f(b,"class","mic-test-title svelte-19mrh3"),v(b,_,295,10,8791),f(C,"class","mic-test-description svelte-19mrh3"),v(C,_,296,10,8840),v(h,_,294,8,8775),f(l,"class","mic-test-header svelte-19mrh3"),v(l,_,285,6,8333),f(t,"class","header svelte-19mrh3"),v(t,_,284,4,8306),f(B,"class","training-mode-info svelte-19mrh3"),v(B,_,302,4,8973),f(k,"class","test-section svelte-19mrh3"),v(k,_,347,4,10735),f(e,"class","microphone-test svelte-19mrh3"),v(e,_,282,2,8254)},m:function(F,q){R(F,e,q),c(e,t),c(t,l),c(l,n),c(n,o),c(o,a),c(o,s),c(o,i),c(o,m),c(l,p),c(l,h),c(h,b),c(h,E),c(h,C),c(e,V),c(e,B),ce(N,B,null),c(e,I),c(e,k),ce(D,k,null),c(k,S),ce(A,k,null),M=!0},p:function(F,q){const j={};q&67108895&&(j.$$scope={dirty:q,ctx:F}),N.$set(j);const G={};q&67110705&&(G.$$scope={dirty:q,ctx:F}),D.$set(G);const u={};q&67109074&&(u.$$scope={dirty:q,ctx:F}),A.$set(u)},i:function(F){M||(re(N.$$.fragment,F),re(D.$$.fragment,F),re(A.$$.fragment,F),M=!0)},o:function(F){ae(N.$$.fragment,F),ae(D.$$.fragment,F),ae(A.$$.fragment,F),M=!1},d:function(F){F&&d(e),oe(N),oe(D),oe(A)}};return O("SvelteRegisterBlock",{block:Z,id:je.name,type:"slot",source:"(282:0) <PageLayout showBackButton={true}>",ctx:r}),Z}function _e(r){let e,t,l;t=new Ae({props:{showBackButton:!0,$$slots:{default:[je]},$$scope:{ctx:r}},$$inline:!0});const n={c:function(){e=z(),fe(t.$$.fragment),this.h()},l:function(a){Qe("svelte-8st1fo",document.head).forEach(d),e=T(a),ue(t.$$.fragment,a),this.h()},h:function(){document.title="マイクテスト - 相対音感トレーニング"},m:function(a,s){R(a,e,s),ce(t,a,s),l=!0},p:function(a,[s]){const i={};s&67110911&&(i.$$scope={dirty:s,ctx:a}),t.$set(i)},i:function(a){l||(re(t.$$.fragment,a),l=!0)},o:function(a){ae(t.$$.fragment,a),l=!1},d:function(a){a&&d(e),oe(t,a)}};return O("SvelteRegisterBlock",{block:n,id:_e.name,type:"component",source:"",ctx:r}),n}function we(r,e){let t=0;for(let s=0;s<r.length;s++)t+=r[s]*r[s];if(t=Math.sqrt(t/r.length),t<.005)return 0;const l=Math.floor(e/800),n=Math.floor(e/80);let o=0,a=0;for(let s=l;s<=n;s++){let i=0,m=0;for(let p=0;p<r.length-s;p++)i+=r[p]*r[p+s],m+=r[p]*r[p];m>0&&(i=i/Math.sqrt(m),i>o&&(o=i,a=s))}return o>.25?e/a:0}function Ve(r){const t=Math.round(12*Math.log2(r/440)),l=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=((t+9)%12+12)%12,o=Math.floor((t+9)/12)+4,a=l[n];return`${a}${o}（${{C:"ド","C#":"ド#",D:"レ","D#":"レ#",E:"ミ",F:"ファ","F#":"ファ#",G:"ソ","G#":"ソ#",A:"ラ","A#":"ラ#",B:"シ"}[a]}${o}）`}function $e(r,e,t){let l;Je(he,"page"),Ze(r,he,u=>t(21,l=u));let{$$slots:n={},$$scope:o}=e;Ke("Page",n,[]);let a="random";pe(()=>{l.url.searchParams.has("mode")&&(a=l.url.searchParams.get("mode")||"random")});let s="initial",i=!1,m=!1,p=!1,h=!1,b=0,P=0,E="ーー",C=0,x=0,V=0,B=null,N=null,I=null,k=null,D=null,S=null,A=[];const M={random:{name:"ランダム基音モード",description:"10種類の基音からランダムに選択してトレーニング",color:"green",path:"/training/random"},continuous:{name:"連続チャレンジモード",description:"選択した回数だけ連続で実行し、総合評価を確認",color:"orange",path:"/training/continuous"},chromatic:{name:"12音階モード",description:"クロマチックスケールの上行・下行で完全制覇",color:"purple",path:"/training/chromatic"}},Z=M[a]||M.random;async function L(){t(3,s="pending");try{console.log("🎤 [MicTest] AudioManager経由でマイク許可リクエスト開始");const u=await le.initialize();B=u.audioContext,N=u.mediaStream,I=u.sourceNode,console.log("✅ [MicTest] AudioManager リソース取得完了");const H=`mic-test-filtered-${Date.now()}`;k=le.createAnalyser(H,{fftSize:2048,smoothingTimeConstant:.8,minDecibels:-90,maxDecibels:-10,useFilters:!0}),A.push(H);const U=`mic-test-raw-${Date.now()}`;D=le.createAnalyser(U,{fftSize:2048,smoothingTimeConstant:.8,minDecibels:-90,maxDecibels:-10,useFilters:!1}),A.push(U),console.log("✅ [MicTest] Analyser作成完了:",A),t(3,s="granted"),t(4,i=!0),F(),console.log("✅ [MicTest] マイク許可とリスニング開始完了")}catch(u){console.error("❌ [MicTest] マイク許可エラー:",u),t(3,s="denied")}}function F(){if(!i||!k||!D)return;const u=k.frequencyBinCount,H=new Uint8Array(u),U=new Uint8Array(D.frequencyBinCount);k.getByteFrequencyData(H),D.getByteFrequencyData(U);let W=0;for(let Y=0;Y<U.length;Y++)W+=U[Y]*U[Y];const X=Math.sqrt(W/U.length);t(8,C=Math.min(100,X/30*100));let $=0;for(let Y=0;Y<H.length;Y++)$+=H[Y]*H[Y];const te=Math.sqrt($/H.length);t(9,x=Math.min(100,te/30*100)),t(5,b=x),C>0?t(10,V=Math.max(0,Math.round((C-x)/C*100))):t(10,V=0),b>15&&t(0,m=!0);const ye=new Float32Array(k.fftSize);k.getFloatTimeDomainData(ye);const ie=we(ye,B.sampleRate);ie>80&&ie<800?(t(6,P=ie),t(7,E=Ve(ie)),t(1,p=!0)):(t(6,P=0),t(7,E="ーー")),S=requestAnimationFrame(F)}function q(){console.log("🛑 [MicTest] リスニング停止開始"),t(4,i=!1),S&&(cancelAnimationFrame(S),S=null),A.length>0&&(le.release(A),console.log("📤 [MicTest] AudioManagerにAnalyser解放通知:",A),A=[]),B=null,N=null,I=null,k=null,D=null,console.log("✅ [MicTest] リスニング停止完了")}function j(){console.log("🚀 [MicTest] トレーニング開始 - ランダム基音モードへ遷移"),Ee(`${De}/training/random?from=microphone-test`)}Ce(()=>{q()});const G=[];return Object.keys(e).forEach(u=>{!~G.indexOf(u)&&u.slice(0,2)!=="$$"&&u!=="slot"&&Ye.warn(`<Page> was created with unknown prop '${u}'`)}),r.$capture_state=()=>({onMount:pe,onDestroy:Ce,page:he,goto:Ee,base:De,Card:de,Button:Xe,PageLayout:Ae,audioManager:le,mode:a,micPermission:s,isListening:i,volumeDetected:m,frequencyDetected:p,audioConfirmationComplete:h,currentVolume:b,currentFrequency:P,currentNote:E,rawVolume:C,filteredVolume:x,noiseReduction:V,audioContext:B,mediaStream:N,sourceNode:I,analyser:k,rawAnalyser:D,animationFrame:S,analyserIds:A,trainingModes:M,selectedMode:Z,requestMicrophone:L,analyzeAudio:F,detectPitch:we,frequencyToNote:Ve,stopListening:q,startTraining:j,$page:l}),r.$inject_state=u=>{"mode"in u&&(a=u.mode),"micPermission"in u&&t(3,s=u.micPermission),"isListening"in u&&t(4,i=u.isListening),"volumeDetected"in u&&t(0,m=u.volumeDetected),"frequencyDetected"in u&&t(1,p=u.frequencyDetected),"audioConfirmationComplete"in u&&t(2,h=u.audioConfirmationComplete),"currentVolume"in u&&t(5,b=u.currentVolume),"currentFrequency"in u&&t(6,P=u.currentFrequency),"currentNote"in u&&t(7,E=u.currentNote),"rawVolume"in u&&t(8,C=u.rawVolume),"filteredVolume"in u&&t(9,x=u.filteredVolume),"noiseReduction"in u&&t(10,V=u.noiseReduction),"audioContext"in u&&(B=u.audioContext),"mediaStream"in u&&(N=u.mediaStream),"sourceNode"in u&&(I=u.sourceNode),"analyser"in u&&(k=u.analyser),"rawAnalyser"in u&&(D=u.rawAnalyser),"animationFrame"in u&&(S=u.animationFrame),"analyserIds"in u&&(A=u.analyserIds)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),r.$$.update=()=>{r.$$.dirty&7&&m&&p&&!h&&t(2,h=!0)},[m,p,h,s,i,b,P,E,C,x,V,L,j]}class at extends Ge{constructor(e){super(e),Oe(this,e,$e,_e,Ue,{}),O("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:_e.name})}}export{at as component};
