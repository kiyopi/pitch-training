import{S as oe,i as ce,s as ue,d,C as Z,m as W,o as X,b as w,D as Y,H as de,h as I,E as ee,k as T,F as te,l as fe,I as he,J as me,c as u,y as m,e as v,f as A,G as B,j as p,K as ae,a as K,g as z,t as H,r as re,n as se,A as ne}from"../chunks/Dh4MrDnZ.js";import"../chunks/IHki7fMi.js";import{p as ve}from"../chunks/BGdVzoxK.js";import{P as pe,C as le}from"../chunks/BIrZeKHn.js";function _e(o){let t,e="マイク準備完了",l,s,r="トレーニング開始ボタンを押してランダム基音モードへ進んでください",n,a,c,i="トレーニング開始",_,k;return{c(){t=p("h3"),t.textContent=e,l=T(),s=p("p"),s.textContent=r,n=T(),a=p("div"),c=p("button"),c.textContent=i,this.h()},l(g){t=v(g,"H3",{class:!0,"data-svelte-h":!0}),B(t)!=="svelte-11dam81"&&(t.textContent=e),l=I(g),s=v(g,"P",{class:!0,"data-svelte-h":!0}),B(s)!=="svelte-5idwhi"&&(s.textContent=r),n=I(g),a=v(g,"DIV",{class:!0});var h=A(a);c=v(h,"BUTTON",{class:!0,"data-svelte-h":!0}),B(c)!=="svelte-1oiqs6i"&&(c.textContent=i),h.forEach(d),this.h()},h(){m(t,"class","ready-title svelte-19mrh3"),m(s,"class","ready-description svelte-19mrh3"),m(c,"class","training-start-button enabled svelte-19mrh3"),m(a,"class","training-start-button-area svelte-19mrh3")},m(g,h){w(g,t,h),w(g,l,h),w(g,s,h),w(g,n,h),w(g,a,h),u(a,c),_||(k=ne(c,"click",o[13]),_=!0)},p:se,d(g){g&&(d(t),d(l),d(s),d(n),d(a)),_=!1,k()}}}function ge(o){let t,e;function l(i,_){return i[3]==="granted"&&i[4]&&(!i[0]||!i[1])?Ce:ye}let s=l(o),r=s(o);function n(i,_){if(i[3]==="pending")return ke;if(i[3]==="denied")return De;if(i[3]==="initial")return be}let a=n(o),c=a&&a(o);return{c(){r.c(),t=T(),c&&c.c(),e=re()},l(i){r.l(i),t=I(i),c&&c.l(i),e=re()},m(i,_){r.m(i,_),w(i,t,_),c&&c.m(i,_),w(i,e,_)},p(i,_){s!==(s=l(i))&&(r.d(1),r=s(i),r&&(r.c(),r.m(t.parentNode,t))),a===(a=n(i))&&c?c.p(i,_):(c&&c.d(1),c=a&&a(i),c&&(c.c(),c.m(e.parentNode,e)))},d(i){i&&(d(t),d(e)),r.d(i),c&&c.d(i)}}}function ye(o){let t,e="マイクのテストを開始します",l,s,r="マイクテスト開始ボタンを押してマイクの使用を許可してください";return{c(){t=p("h3"),t.textContent=e,l=T(),s=p("p"),s.textContent=r,this.h()},l(n){t=v(n,"H3",{class:!0,"data-svelte-h":!0}),B(t)!=="svelte-gfi16f"&&(t.textContent=e),l=I(n),s=v(n,"P",{class:!0,"data-svelte-h":!0}),B(s)!=="svelte-1w19y1h"&&(s.textContent=r),this.h()},h(){m(t,"class","instructions-title svelte-19mrh3"),m(s,"class","instructions-description svelte-19mrh3")},m(n,a){w(n,t,a),w(n,l,a),w(n,s,a)},d(n){n&&(d(t),d(l),d(s))}}}function Ce(o){let t,e="「ドー」と発声してください";return{c(){t=p("p"),t.textContent=e,this.h()},l(l){t=v(l,"P",{class:!0,"data-svelte-h":!0}),B(t)!=="svelte-15d2sx7"&&(t.textContent=e),this.h()},h(){m(t,"class","status-text voice-instruction svelte-19mrh3")},m(l,s){w(l,t,s)},d(l){l&&d(t)}}}function be(o){let t,e,l="マイクテストを開始",s,r;return{c(){t=p("div"),e=p("button"),e.textContent=l,this.h()},l(n){t=v(n,"DIV",{class:!0});var a=A(t);e=v(a,"BUTTON",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-caex95"&&(e.textContent=l),a.forEach(d),this.h()},h(){m(e,"class","mic-test-button start svelte-19mrh3"),m(t,"class","mic-test-button-area svelte-19mrh3")},m(n,a){w(n,t,a),u(t,e),s||(r=ne(e,"click",o[12]),s=!0)},p:se,d(n){n&&d(t),s=!1,r()}}}function De(o){let t,e,l="マイク許可を再試行",s,r;return{c(){t=p("div"),e=p("button"),e.textContent=l,this.h()},l(n){t=v(n,"DIV",{class:!0});var a=A(t);e=v(a,"BUTTON",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-1p3n8nt"&&(e.textContent=l),a.forEach(d),this.h()},h(){m(e,"class","mic-test-button retry svelte-19mrh3"),m(t,"class","mic-test-button-area svelte-19mrh3")},m(n,a){w(n,t,a),u(t,e),s||(r=ne(e,"click",o[12]),s=!0)},p:se,d(n){n&&d(t),s=!1,r()}}}function ke(o){let t,e="マイク準備中...";return{c(){t=p("p"),t.textContent=e,this.h()},l(l){t=v(l,"P",{class:!0,"data-svelte-h":!0}),B(t)!=="svelte-1vb5g92"&&(t.textContent=e),this.h()},h(){m(t,"class","status-text svelte-19mrh3")},m(l,s){w(l,t,s)},p:se,d(l){l&&d(t)}}}function Ae(o){let t;function e(r,n){return r[2]?_e:ge}let l=e(o),s=l(o);return{c(){t=p("div"),s.c(),this.h()},l(r){t=v(r,"DIV",{class:!0});var n=A(t);s.l(n),n.forEach(d),this.h()},h(){m(t,"class","training-mode-content svelte-19mrh3")},m(r,n){w(r,t,n),s.m(t,null)},p(r,n){l===(l=e(r))&&s?s.p(r,n):(s.d(1),s=l(r),s&&(s.c(),s.m(t,null)))},d(r){r&&d(t),s.d()}}}function ie(o){let t,e,l,s,r="フィルター前:",n,a,c=o[8].toFixed(1)+"",i,_,k,g,h,b="フィルター後:",V,y,f=o[9].toFixed(1)+"",$,C,x,D,E,M="ノイズ削減:",U,P,G,N;return{c(){t=p("div"),e=p("div"),l=p("div"),s=p("span"),s.textContent=r,n=T(),a=p("span"),i=H(c),_=H("%"),k=T(),g=p("div"),h=p("span"),h.textContent=b,V=T(),y=p("span"),$=H(f),C=H("%"),x=T(),D=p("div"),E=p("span"),E.textContent=M,U=T(),P=p("span"),G=H(o[10]),N=H("%"),this.h()},l(F){t=v(F,"DIV",{class:!0});var q=A(t);e=v(q,"DIV",{class:!0});var S=A(e);l=v(S,"DIV",{class:!0});var O=A(l);s=v(O,"SPAN",{class:!0,"data-svelte-h":!0}),B(s)!=="svelte-1nh45c7"&&(s.textContent=r),n=I(O),a=v(O,"SPAN",{class:!0});var Q=A(a);i=z(Q,c),_=z(Q,"%"),Q.forEach(d),O.forEach(d),k=I(S),g=v(S,"DIV",{class:!0});var j=A(g);h=v(j,"SPAN",{class:!0,"data-svelte-h":!0}),B(h)!=="svelte-fz1u1y"&&(h.textContent=b),V=I(j),y=v(j,"SPAN",{class:!0});var R=A(y);$=z(R,f),C=z(R,"%"),R.forEach(d),j.forEach(d),x=I(S),D=v(S,"DIV",{class:!0});var J=A(D);E=v(J,"SPAN",{class:!0,"data-svelte-h":!0}),B(E)!=="svelte-3jbm0v"&&(E.textContent=M),U=I(J),P=v(J,"SPAN",{class:!0});var L=A(P);G=z(L,o[10]),N=z(L,"%"),L.forEach(d),J.forEach(d),S.forEach(d),q.forEach(d),this.h()},h(){m(s,"class","stat-label svelte-19mrh3"),m(a,"class","stat-value raw svelte-19mrh3"),m(l,"class","stat-item svelte-19mrh3"),m(h,"class","stat-label svelte-19mrh3"),m(y,"class","stat-value filtered svelte-19mrh3"),m(g,"class","stat-item svelte-19mrh3"),m(E,"class","stat-label svelte-19mrh3"),m(P,"class","stat-value reduction svelte-19mrh3"),m(D,"class","stat-item svelte-19mrh3"),m(e,"class","noise-stats svelte-19mrh3"),m(t,"class","noise-reduction-info svelte-19mrh3")},m(F,q){w(F,t,q),u(t,e),u(e,l),u(l,s),u(l,n),u(l,a),u(a,i),u(a,_),u(e,k),u(e,g),u(g,h),u(g,V),u(g,y),u(y,$),u(y,C),u(e,x),u(e,D),u(D,E),u(D,U),u(D,P),u(P,G),u(P,N)},p(F,q){q&256&&c!==(c=F[8].toFixed(1)+"")&&K(i,c),q&512&&f!==(f=F[9].toFixed(1)+"")&&K($,f),q&1024&&K(G,F[10])},d(F){F&&d(t)}}}function Ve(o){let t;return{c(){t=H(" ")},l(e){t=z(e," ")},m(e,l){w(e,t,l)},d(e){e&&d(t)}}}function xe(o){let t;return{c(){t=H("⏳ 声を出して音量を確認してください")},l(e){t=z(e,"⏳ 声を出して音量を確認してください")},m(e,l){w(e,t,l)},d(e){e&&d(t)}}}function Ee(o){let t,e,l,s="音量レベル",r,n,a,c,i,_=o[5].toFixed(1)+"",k,g,h,b,V,y,f=o[4]&&ie(o);function $(D,E){return!D[0]&&D[4]?xe:Ve}let C=$(o),x=C(o);return{c(){t=p("div"),e=p("div"),l=p("h3"),l.textContent=s,r=T(),n=p("div"),a=p("div"),c=T(),i=p("div"),k=H(_),g=H("%"),h=T(),f&&f.c(),b=T(),V=p("div"),y=p("span"),x.c(),this.h()},l(D){t=v(D,"DIV",{class:!0});var E=A(t);e=v(E,"DIV",{class:!0});var M=A(e);l=v(M,"H3",{class:!0,"data-svelte-h":!0}),B(l)!=="svelte-1nc8gri"&&(l.textContent=s),r=I(M),n=v(M,"DIV",{class:!0});var U=A(n);a=v(U,"DIV",{class:!0,style:!0}),A(a).forEach(d),U.forEach(d),c=I(M),i=v(M,"DIV",{class:!0});var P=A(i);k=z(P,_),g=z(P,"%"),P.forEach(d),h=I(M),f&&f.l(M),b=I(M),V=v(M,"DIV",{class:!0});var G=A(V);y=v(G,"SPAN",{class:!0});var N=A(y);x.l(N),N.forEach(d),G.forEach(d),M.forEach(d),E.forEach(d),this.h()},h(){m(l,"class","display-title svelte-19mrh3"),m(a,"class","volume-bar svelte-19mrh3"),ae(a,"width",o[5]+"%"),m(n,"class","volume-bar-container svelte-19mrh3"),m(i,"class","volume-text svelte-19mrh3"),m(y,"class","status-pending svelte-19mrh3"),m(V,"class","volume-status svelte-19mrh3"),m(e,"class","volume-section svelte-19mrh3"),m(t,"class","card-inner svelte-19mrh3")},m(D,E){w(D,t,E),u(t,e),u(e,l),u(e,r),u(e,n),u(n,a),u(e,c),u(e,i),u(i,k),u(i,g),u(e,h),f&&f.m(e,null),u(e,b),u(e,V),u(V,y),x.m(y,null)},p(D,E){E&32&&ae(a,"width",D[5]+"%"),E&32&&_!==(_=D[5].toFixed(1)+"")&&K(k,_),D[4]?f?f.p(D,E):(f=ie(D),f.c(),f.m(e,b)):f&&(f.d(1),f=null),C!==(C=$(D))&&(x.d(1),x=C(D),x&&(x.c(),x.m(y,null)))},d(D){D&&d(t),f&&f.d(),x.d()}}}function we(o){let t;return{c(){t=H(" ")},l(e){t=z(e," ")},m(e,l){w(e,t,l)},d(e){e&&d(t)}}}function $e(o){let t;return{c(){t=H("⏳ 「ド」を発声して音程を確認してください")},l(e){t=z(e,"⏳ 「ド」を発声して音程を確認してください")},m(e,l){w(e,t,l)},d(e){e&&d(t)}}}function Fe(o){let t,e,l,s="音程検出",r,n,a,c=o[6]>0?o[6].toFixed(1)+" Hz":"ーー",i,_,k,g,h,b,V;function y(C,x){return!C[1]&&C[4]?$e:we}let f=y(o),$=f(o);return{c(){t=p("div"),e=p("div"),l=p("h3"),l.textContent=s,r=T(),n=p("div"),a=p("div"),i=H(c),_=T(),k=p("div"),g=H(o[7]),h=T(),b=p("div"),V=p("span"),$.c(),this.h()},l(C){t=v(C,"DIV",{class:!0});var x=A(t);e=v(x,"DIV",{class:!0});var D=A(e);l=v(D,"H3",{class:!0,"data-svelte-h":!0}),B(l)!=="svelte-1ofzoy2"&&(l.textContent=s),r=I(D),n=v(D,"DIV",{class:!0});var E=A(n);a=v(E,"DIV",{class:!0});var M=A(a);i=z(M,c),M.forEach(d),_=I(E),k=v(E,"DIV",{class:!0});var U=A(k);g=z(U,o[7]),U.forEach(d),E.forEach(d),h=I(D),b=v(D,"DIV",{class:!0});var P=A(b);V=v(P,"SPAN",{class:!0});var G=A(V);$.l(G),G.forEach(d),P.forEach(d),D.forEach(d),x.forEach(d),this.h()},h(){m(l,"class","display-title svelte-19mrh3"),m(a,"class","frequency-value svelte-19mrh3"),m(k,"class","note-value svelte-19mrh3"),m(n,"class","frequency-display svelte-19mrh3"),m(V,"class","status-pending svelte-19mrh3"),m(b,"class","frequency-status svelte-19mrh3"),m(e,"class","frequency-section svelte-19mrh3"),m(t,"class","card-inner svelte-19mrh3")},m(C,x){w(C,t,x),u(t,e),u(e,l),u(e,r),u(e,n),u(n,a),u(a,i),u(n,_),u(n,k),u(k,g),u(e,h),u(e,b),u(b,V),$.m(V,null)},p(C,x){x&64&&c!==(c=C[6]>0?C[6].toFixed(1)+" Hz":"ーー")&&K(i,c),x&128&&K(g,C[7]),f!==(f=y(C))&&($.d(1),$=f(C),$&&($.c(),$.m(V,null)))},d(C){C&&d(t),$.d()}}}function qe(o){let t,e,l='<div class="mic-test-header svelte-19mrh3"><div class="mic-icon svelte-19mrh3"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" x2="12" y1="19" y2="22"></line><line x1="8" x2="16" y1="22" y2="22"></line></svg></div> <div><h1 class="mic-test-title svelte-19mrh3">マイクテスト</h1> <p class="mic-test-description svelte-19mrh3">音感トレーニングを始める前に、マイクの動作を確認します</p></div></div>',s,r,n,a,c,i,_,k,g;return n=new le({props:{variant:"default",padding:"lg",$$slots:{default:[Ae]},$$scope:{ctx:o}}}),i=new le({props:{variant:"default",padding:"lg",$$slots:{default:[Ee]},$$scope:{ctx:o}}}),k=new le({props:{variant:"default",padding:"lg",$$slots:{default:[Fe]},$$scope:{ctx:o}}}),{c(){t=p("div"),e=p("div"),e.innerHTML=l,s=T(),r=p("div"),te(n.$$.fragment),a=T(),c=p("div"),te(i.$$.fragment),_=T(),te(k.$$.fragment),this.h()},l(h){t=v(h,"DIV",{class:!0});var b=A(t);e=v(b,"DIV",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-4qcd63"&&(e.innerHTML=l),s=I(b),r=v(b,"DIV",{class:!0});var V=A(r);ee(n.$$.fragment,V),V.forEach(d),a=I(b),c=v(b,"DIV",{class:!0});var y=A(c);ee(i.$$.fragment,y),_=I(y),ee(k.$$.fragment,y),y.forEach(d),b.forEach(d),this.h()},h(){m(e,"class","header svelte-19mrh3"),m(r,"class","training-mode-info svelte-19mrh3"),m(c,"class","test-section svelte-19mrh3"),m(t,"class","microphone-test svelte-19mrh3")},m(h,b){w(h,t,b),u(t,e),u(t,s),u(t,r),Y(n,r,null),u(t,a),u(t,c),Y(i,c,null),u(c,_),Y(k,c,null),g=!0},p(h,b){const V={};b&16777247&&(V.$$scope={dirty:b,ctx:h}),n.$set(V);const y={};b&16779057&&(y.$$scope={dirty:b,ctx:h}),i.$set(y);const f={};b&16777426&&(f.$$scope={dirty:b,ctx:h}),k.$set(f)},i(h){g||(X(n.$$.fragment,h),X(i.$$.fragment,h),X(k.$$.fragment,h),g=!0)},o(h){W(n.$$.fragment,h),W(i.$$.fragment,h),W(k.$$.fragment,h),g=!1},d(h){h&&d(t),Z(n),Z(i),Z(k)}}}function Ie(o){let t,e,l;return e=new pe({props:{showBackButton:!0,$$slots:{default:[qe]},$$scope:{ctx:o}}}),{c(){t=T(),te(e.$$.fragment),this.h()},l(s){de("svelte-8st1fo",document.head).forEach(d),t=I(s),ee(e.$$.fragment,s),this.h()},h(){document.title="マイクテスト - 相対音感トレーニング"},m(s,r){w(s,t,r),Y(e,s,r),l=!0},p(s,[r]){const n={};r&16779263&&(n.$$scope={dirty:r,ctx:s}),e.$set(n)},i(s){l||(X(e.$$.fragment,s),l=!0)},o(s){W(e.$$.fragment,s),l=!1},d(s){s&&d(t),Z(e,s)}}}function Te(o,t){let e=0;for(let a=0;a<o.length;a++)e+=o[a]*o[a];if(e=Math.sqrt(e/o.length),e<.005)return 0;const l=Math.floor(t/800),s=Math.floor(t/80);let r=0,n=0;for(let a=l;a<=s;a++){let c=0,i=0;for(let _=0;_<o.length-a;_++)c+=o[_]*o[_+a],i+=o[_]*o[_];i>0&&(c=c/Math.sqrt(i),c>r&&(r=c,n=a))}return r>.25?t/n:0}function Me(o){const e=Math.round(12*Math.log2(o/440)),l=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],s=((e+9)%12+12)%12,r=Math.floor((e+9)/12)+4,n=l[s];return`${n}${r}（${{C:"ド","C#":"ド#",D:"レ","D#":"レ#",E:"ミ",F:"ファ","F#":"ファ#",G:"ソ","G#":"ソ#",A:"ラ","A#":"ラ#",B:"シ"}[n]}${r}）`}function Pe(o,t,e){let l;fe(o,ve,N=>e(20,l=N));let s="random";he(()=>{l.url.searchParams.has("mode")&&(s=l.url.searchParams.get("mode")||"random")});let r="initial",n=!1,a=!1,c=!1,i=!1,_=0,k=0,g="ーー",h=0,b=0,V=0,y=null,f=null,$=null,C=null,x=null;const D={random:{name:"ランダム基音モード",description:"10種類の基音からランダムに選択してトレーニング",color:"green",path:"./training/random"},continuous:{name:"連続チャレンジモード",description:"選択した回数だけ連続で実行し、総合評価を確認",color:"orange",path:"./training/continuous"},chromatic:{name:"12音階モード",description:"クロマチックスケールの上行・下行で完全制覇",color:"purple",path:"./training/chromatic"}},E=D[s]||D.random;async function M(){e(3,r="pending");try{$=await navigator.mediaDevices.getUserMedia({audio:!0}),e(3,r="granted"),f=new(window.AudioContext||window.webkitAudioContext),f.state==="suspended"&&await f.resume();const N=f.createMediaStreamSource($);y=f.createAnalyser(),y.fftSize=2048,y.smoothingTimeConstant=.8,y.minDecibels=-90,y.maxDecibels=-10,N.connect(y);const F=f.createBiquadFilter();F.type="highpass",F.frequency.setValueAtTime(80,f.currentTime),F.Q.setValueAtTime(.7,f.currentTime);const q=f.createBiquadFilter();q.type="lowpass",q.frequency.setValueAtTime(800,f.currentTime),q.Q.setValueAtTime(.7,f.currentTime);const S=f.createBiquadFilter();S.type="notch",S.frequency.setValueAtTime(60,f.currentTime),S.Q.setValueAtTime(10,f.currentTime),C=f.createAnalyser(),C.fftSize=2048,C.smoothingTimeConstant=.8,C.minDecibels=-90,C.maxDecibels=-10,N.connect(F),F.connect(q),q.connect(S),S.connect(C),e(4,n=!0),U()}catch{e(3,r="denied")}}function U(){if(!n||!C||!y)return;const N=C.frequencyBinCount,F=new Uint8Array(N),q=new Uint8Array(y.frequencyBinCount);C.getByteFrequencyData(F),y.getByteFrequencyData(q);let S=0;for(let L=0;L<q.length;L++)S+=q[L]*q[L];const O=Math.sqrt(S/q.length);e(8,h=Math.min(100,O/30*100));let Q=0;for(let L=0;L<F.length;L++)Q+=F[L]*F[L];const j=Math.sqrt(Q/F.length);e(9,b=Math.min(100,j/30*100)),e(5,_=b),h>0?e(10,V=Math.max(0,Math.round((h-b)/h*100))):e(10,V=0),_>15&&e(0,a=!0);const R=new Float32Array(C.fftSize);C.getFloatTimeDomainData(R);const J=Te(R,f.sampleRate);J>80&&J<800?(e(6,k=J),e(7,g=Me(J)),e(1,c=!0)):(e(6,k=0),e(7,g="ーー")),x=requestAnimationFrame(U)}function P(){e(4,n=!1),x&&(cancelAnimationFrame(x),x=null),$&&($.getTracks().forEach(N=>N.stop()),$=null),f&&f.state!=="closed"&&(f.close(),f=null),C=null,y=null}me(()=>{P()});const G=()=>window.location.href=E.path;return o.$$.update=()=>{o.$$.dirty&7&&a&&c&&!i&&e(2,i=!0)},[a,c,i,r,n,_,k,g,h,b,V,E,M,G]}class He extends oe{constructor(t){super(),ce(this,t,Pe,Ie,ue,{})}}export{He as component};
