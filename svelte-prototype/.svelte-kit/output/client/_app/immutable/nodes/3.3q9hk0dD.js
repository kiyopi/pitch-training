import{S as z,i as F,s as j,d as f,C as E,m as x,o as V,b as g,D as I,H as G,h as T,E as q,k,F as N,l as J,I as K,c as M,y,J as Z,e as b,f as D,G as P,j as C,K as Q,n as U,A as L,g as H,t as S,r as O}from"../chunks/DAO8qnDa.js";import"../chunks/IHki7fMi.js";import{p as R}from"../chunks/lJb-rb1z.js";import{g as W,b as X}from"../chunks/Dyxdqslh.js";import{P as Y,C as tt}from"../chunks/5kS94gIJ.js";import{P as et,a as st,b as nt}from"../chunks/dA9HdXZY.js";function it(c){let t,s="マイクのテストを開始します",r,e,i="マイクテスト開始ボタンを押してマイクの使用を許可してください",o,d;function p(n,v){if(n[0]==="pending")return lt;if(n[0]==="denied")return at;if(n[0]==="initial")return rt}let m=p(c),a=m&&m(c);return{c(){t=C("h3"),t.textContent=s,r=k(),e=C("p"),e.textContent=i,o=k(),a&&a.c(),d=O(),this.h()},l(n){t=b(n,"H3",{class:!0,"data-svelte-h":!0}),P(t)!=="svelte-gfi16f"&&(t.textContent=s),r=T(n),e=b(n,"P",{class:!0,"data-svelte-h":!0}),P(e)!=="svelte-1w19y1h"&&(e.textContent=i),o=T(n),a&&a.l(n),d=O(),this.h()},h(){y(t,"class","instructions-title svelte-s1thfd"),y(e,"class","instructions-description svelte-s1thfd")},m(n,v){g(n,t,v),g(n,r,v),g(n,e,v),g(n,o,v),a&&a.m(n,v),g(n,d,v)},p(n,v){m===(m=p(n))&&a?a.p(n,v):(a&&a.d(1),a=m&&m(n),a&&(a.c(),a.m(d.parentNode,d)))},d(n){n&&(f(t),f(r),f(e),f(o),f(d)),a&&a.d(n)}}}function ot(c){let t,s="マイク準備完了",r,e,i,o=c[5].name+"",d,p,m,a,n,v="トレーニング開始",w,u;return{c(){t=C("h3"),t.textContent=s,r=k(),e=C("p"),i=S("トレーニング開始ボタンを押して"),d=S(o),p=S("へ進んでください"),m=k(),a=C("div"),n=C("button"),n.textContent=v,this.h()},l(l){t=b(l,"H3",{class:!0,"data-svelte-h":!0}),P(t)!=="svelte-11dam81"&&(t.textContent=s),r=T(l),e=b(l,"P",{class:!0});var _=D(e);i=H(_,"トレーニング開始ボタンを押して"),d=H(_,o),p=H(_,"へ進んでください"),_.forEach(f),m=T(l),a=b(l,"DIV",{class:!0});var h=D(a);n=b(h,"BUTTON",{class:!0,"data-svelte-h":!0}),P(n)!=="svelte-kae9rs"&&(n.textContent=v),h.forEach(f),this.h()},h(){y(t,"class","ready-title svelte-s1thfd"),y(e,"class","ready-description svelte-s1thfd"),y(n,"class","training-start-button enabled svelte-s1thfd"),y(a,"class","training-start-button-area svelte-s1thfd")},m(l,_){g(l,t,_),g(l,r,_),g(l,e,_),M(e,i),M(e,d),M(e,p),g(l,m,_),g(l,a,_),M(a,n),w||(u=L(n,"click",c[7]),w=!0)},p:U,d(l){l&&(f(t),f(r),f(e),f(m),f(a)),w=!1,u()}}}function rt(c){let t,s,r="マイクテストを開始",e,i;return{c(){t=C("div"),s=C("button"),s.textContent=r,this.h()},l(o){t=b(o,"DIV",{class:!0});var d=D(t);s=b(d,"BUTTON",{class:!0,"data-svelte-h":!0}),P(s)!=="svelte-caex95"&&(s.textContent=r),d.forEach(f),this.h()},h(){y(s,"class","mic-test-button start svelte-s1thfd"),y(t,"class","mic-test-button-area svelte-s1thfd")},m(o,d){g(o,t,d),M(t,s),e||(i=L(s,"click",c[6]),e=!0)},p:U,d(o){o&&f(t),e=!1,i()}}}function at(c){let t,s,r="マイク許可を再試行",e,i;return{c(){t=C("div"),s=C("button"),s.textContent=r,this.h()},l(o){t=b(o,"DIV",{class:!0});var d=D(t);s=b(d,"BUTTON",{class:!0,"data-svelte-h":!0}),P(s)!=="svelte-1p3n8nt"&&(s.textContent=r),d.forEach(f),this.h()},h(){y(s,"class","mic-test-button retry svelte-s1thfd"),y(t,"class","mic-test-button-area svelte-s1thfd")},m(o,d){g(o,t,d),M(t,s),e||(i=L(s,"click",c[6]),e=!0)},p:U,d(o){o&&f(t),e=!1,i()}}}function lt(c){let t,s="マイク準備中...";return{c(){t=C("p"),t.textContent=s,this.h()},l(r){t=b(r,"P",{class:!0,"data-svelte-h":!0}),P(t)!=="svelte-1vb5g92"&&(t.textContent=s),this.h()},h(){y(t,"class","status-text svelte-s1thfd")},m(r,e){g(r,t,e)},p:U,d(r){r&&f(t)}}}function ct(c){let t;function s(i,o){return i[0]==="granted"?ot:it}let r=s(c),e=r(c);return{c(){t=C("div"),e.c(),this.h()},l(i){t=b(i,"DIV",{class:!0});var o=D(t);e.l(o),o.forEach(f),this.h()},h(){y(t,"class","training-mode-content svelte-s1thfd")},m(i,o){g(i,t,o),e.m(t,null)},p(i,o){r===(r=s(i))&&e?e.p(i,o):(e.d(1),e=r(i),e&&(e.c(),e.m(t,null)))},d(i){i&&f(t),e.d()}}}function dt(c){let t,s,r='<div class="mic-test-header svelte-s1thfd"><div class="mic-icon svelte-s1thfd"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" x2="12" y1="19" y2="22"></line><line x1="8" x2="16" y1="22" y2="22"></line></svg></div> <div><h1 class="mic-test-title svelte-s1thfd">マイクテスト</h1> <p class="mic-test-description svelte-s1thfd">音感トレーニングを始める前に、マイクの動作を確認します</p></div></div>',e,i,o,d,p,m,a,n,v;o=new tt({props:{variant:"default",padding:"lg",$$slots:{default:[ct]},$$scope:{ctx:c}}}),p=new et({props:{frequency:c[2],note:c[3],volume:c[1],isMuted:c[0]!=="granted",muteMessage:"マイク許可後に開始"}});let w={isActive:c[0]==="granted",className:"pitch-detector-content",debugMode:!1};return n=new st({props:w}),c[10](n),n.$on("pitchUpdate",c[8]),n.$on("stateChange",ft),n.$on("error",c[9]),{c(){t=C("div"),s=C("div"),s.innerHTML=r,e=k(),i=C("div"),N(o.$$.fragment),d=k(),N(p.$$.fragment),m=k(),a=C("div"),N(n.$$.fragment),this.h()},l(u){t=b(u,"DIV",{class:!0});var l=D(t);s=b(l,"DIV",{class:!0,"data-svelte-h":!0}),P(s)!=="svelte-4qcd63"&&(s.innerHTML=r),e=T(l),i=b(l,"DIV",{class:!0});var _=D(i);q(o.$$.fragment,_),_.forEach(f),d=T(l),q(p.$$.fragment,l),m=T(l),a=b(l,"DIV",{style:!0});var h=D(a);q(n.$$.fragment,h),h.forEach(f),l.forEach(f),this.h()},h(){y(s,"class","header svelte-s1thfd"),y(i,"class","training-mode-info svelte-s1thfd"),Z(a,"display","none"),y(t,"class","microphone-test svelte-s1thfd")},m(u,l){g(u,t,l),M(t,s),M(t,e),M(t,i),I(o,i,null),M(t,d),I(p,t,null),M(t,m),M(t,a),I(n,a,null),v=!0},p(u,l){const _={};l&16385&&(_.$$scope={dirty:l,ctx:u}),o.$set(_);const h={};l&4&&(h.frequency=u[2]),l&8&&(h.note=u[3]),l&2&&(h.volume=u[1]),l&1&&(h.isMuted=u[0]!=="granted"),p.$set(h);const $={};l&1&&($.isActive=u[0]==="granted"),n.$set($)},i(u){v||(V(o.$$.fragment,u),V(p.$$.fragment,u),V(n.$$.fragment,u),v=!0)},o(u){x(o.$$.fragment,u),x(p.$$.fragment,u),x(n.$$.fragment,u),v=!1},d(u){u&&f(t),E(o),E(p),c[10](null),E(n)}}}function ut(c){let t,s,r;return s=new Y({props:{showBackButton:!0,$$slots:{default:[dt]},$$scope:{ctx:c}}}),{c(){t=k(),N(s.$$.fragment),this.h()},l(e){G("svelte-8st1fo",document.head).forEach(f),t=T(e),q(s.$$.fragment,e),this.h()},h(){document.title="マイクテスト - 相対音感トレーニング"},m(e,i){g(e,t,i),I(s,e,i),r=!0},p(e,[i]){const o={};i&16415&&(o.$$scope={dirty:i,ctx:e}),s.$set(o)},i(e){r||(V(s.$$.fragment,e),r=!0)},o(e){x(s.$$.fragment,e),r=!1},d(e){e&&f(t),E(s,e)}}}function ft(c){}function ht(c,t,s){let r;J(c,R,h=>s(12,r=h));let e="random";K(()=>{r.url.searchParams.has("mode")&&(e=r.url.searchParams.get("mode")||"random")});let i="initial",o=0,d=0,p="ーー",m=null;const a={random:{name:"ランダム基音モード",description:"10種類の基音からランダムに選択してトレーニング",color:"green",path:"/training/random"},continuous:{name:"連続チャレンジモード",description:"選択した回数だけ連続で実行し、総合評価を確認",color:"orange",path:"/training/continuous"},chromatic:{name:"12音階モード",description:"クロマチックスケールの上行・下行で完全制覇",color:"purple",path:"/training/chromatic"}},n=a[e]||a.random;async function v(){var h;s(0,i="pending");try{if(console.log("🎤 [MicTest] マイク許可リクエスト開始"),!((h=navigator.mediaDevices)!=null&&h.getUserMedia)){s(0,i="denied"),console.error("❌ [MicTest] getUserMediaがサポートされていません");return}const $=await nt.initialize();if(console.log("✅ [MicTest] AudioManager リソース取得完了"),$.mediaStream&&$.audioContext)s(0,i="granted"),console.log("✅ [MicTest] マイク許可完了"),setTimeout(async()=>{m&&(console.log("🎙️ [MicTest] PitchDetector初期化開始"),await m.initialize(),console.log("✅ [MicTest] PitchDetector初期化完了"),console.log("🎯 [MicTest] PitchDetector isActiveリアクティブで自動検出開始"))},1e3);else throw new Error("リソース取得失敗")}catch($){console.error("❌ [MicTest] マイク許可エラー:",$),s(0,i=(($==null?void 0:$.name)==="NotAllowedError","denied"))}}function w(){console.log("🚀 [MicTest] トレーニング開始 - ランダム基音モードへ遷移"),W(`${X}${n.path}?from=microphone-test`)}function u(h){const{frequency:$,note:A,volume:B,rawVolume:mt,clarity:pt}=h.detail;s(2,d=$),s(3,p=A),s(1,o=B)}function l(h){console.error("❌ [MicTest] PitchDetectorエラー:",h.detail);const{error:$,reason:A,recovery:B}=h.detail;A==="mediastream_ended"&&B==="restart_required"&&(console.log("🔄 [MicTest] MediaStream終了検出 - 自動復旧開始"),s(0,i="initial"),s(1,o=0),s(2,d=0),s(3,p="ーー"),console.log("⚠️ [MicTest] マイク再許可が必要です"))}function _(h){Q[h?"unshift":"push"](()=>{m=h,s(4,m)})}return[i,o,d,p,m,n,v,w,u,l,_]}class $t extends z{constructor(t){super(),F(this,t,ht,ut,j,{})}}export{$t as component};
