import{S as te,i as se,s as le,n as G,d as w,H as ne,b as T,c as _,y as C,I as ie,h as F,e as q,f as I,G as S,k as M,j as g,J as ae,K as Q,a as U,g as B,t as P,A as j,r as W}from"../chunks/BJp-dNlk.js";import{e as X}from"../chunks/D6YF6ztN.js";import"../chunks/IHki7fMi.js";function Y(a,e,t){const s=a.slice();return s[14]=e[t],s}function oe(a){let e,t="❌ マイクアクセスが拒否されました",s,i,l="再試行",n,r;return{c(){e=g("div"),e.textContent=t,s=M(),i=g("button"),i.textContent=l,this.h()},l(c){e=q(c,"DIV",{class:!0,"data-svelte-h":!0}),S(e)!=="svelte-s607mk"&&(e.textContent=t),s=F(c),i=q(c,"BUTTON",{class:!0,"data-svelte-h":!0}),S(i)!=="svelte-1y0f8ey"&&(i.textContent=l),this.h()},h(){C(e,"class","status error svelte-63wsq3"),C(i,"class","test-button svelte-63wsq3")},m(c,f){T(c,e,f),T(c,s,f),T(c,i,f),n||(r=j(i,"click",a[6]),n=!0)},p:G,d(c){c&&(w(e),w(s),w(i)),n=!1,r()}}}function re(a){let e,t="✅ マイクアクセス許可済み",s,i,l=a[1]&&Z(a);return{c(){e=g("div"),e.textContent=t,s=M(),l&&l.c(),i=W(),this.h()},l(n){e=q(n,"DIV",{class:!0,"data-svelte-h":!0}),S(e)!=="svelte-62ayz1"&&(e.textContent=t),s=F(n),l&&l.l(n),i=W(),this.h()},h(){C(e,"class","status svelte-63wsq3")},m(n,r){T(n,e,r),T(n,s,r),l&&l.m(n,r),T(n,i,r)},p(n,r){n[1]?l?l.p(n,r):(l=Z(n),l.c(),l.m(i.parentNode,i)):l&&(l.d(1),l=null)},d(n){n&&(w(e),w(s),w(i)),l&&l.d(n)}}}function ce(a){let e,t="⏳ マイク許可を確認中...";return{c(){e=g("div"),e.textContent=t,this.h()},l(s){e=q(s,"DIV",{class:!0,"data-svelte-h":!0}),S(e)!=="svelte-1bxnxy3"&&(e.textContent=t),this.h()},h(){C(e,"class","status svelte-63wsq3")},m(s,i){T(s,e,i)},p:G,d(s){s&&w(e)}}}function ue(a){let e,t="🎤 マイクテスト開始",s,i;return{c(){e=g("button"),e.textContent=t,this.h()},l(l){e=q(l,"BUTTON",{class:!0,"data-svelte-h":!0}),S(e)!=="svelte-1f5wvo1"&&(e.textContent=t),this.h()},h(){C(e,"class","test-button svelte-63wsq3")},m(l,n){T(l,e,n),s||(i=j(e,"click",a[6]),s=!0)},p:G,d(l){l&&w(e),s=!1,i()}}}function Z(a){let e,t="⏹️ テスト停止",s,i;return{c(){e=g("button"),e.textContent=t,this.h()},l(l){e=q(l,"BUTTON",{class:!0,"data-svelte-h":!0}),S(e)!=="svelte-11zhjx8"&&(e.textContent=t),this.h()},h(){C(e,"class","test-button svelte-63wsq3")},m(l,n){T(l,e,n),s||(i=j(e,"click",a[7]),s=!0)},p:G,d(l){l&&w(e),s=!1,i()}}}function R(a){let e,t,s,i="音量レベル",l,n,r,c,f,d=a[2].toFixed(1)+"",V,L,p,k,D,y="周波数検出",v,m,h=a[3].toFixed(1)+"",o,b,u,x,N;return{c(){e=g("div"),t=g("div"),s=g("h3"),s.textContent=i,l=M(),n=g("div"),r=g("div"),c=M(),f=g("div"),V=P(d),L=P("%"),p=M(),k=g("div"),D=g("h3"),D.textContent=y,v=M(),m=g("div"),o=P(h),b=P(" Hz"),u=M(),x=g("div"),N=P(a[4]),this.h()},l(E){e=q(E,"DIV",{class:!0});var A=I(e);t=q(A,"DIV",{class:!0});var z=I(t);s=q(z,"H3",{class:!0,"data-svelte-h":!0}),S(s)!=="svelte-etucpw"&&(s.textContent=i),l=F(z),n=q(z,"DIV",{class:!0});var K=I(n);r=q(K,"DIV",{class:!0,style:!0}),I(r).forEach(w),K.forEach(w),c=F(z),f=q(z,"DIV",{class:!0});var J=I(f);V=B(J,d),L=B(J,"%"),J.forEach(w),z.forEach(w),p=F(A),k=q(A,"DIV",{class:!0});var H=I(k);D=q(H,"H3",{class:!0,"data-svelte-h":!0}),S(D)!=="svelte-1yfwvfq"&&(D.textContent=y),v=F(H),m=q(H,"DIV",{class:!0});var O=I(m);o=B(O,h),b=B(O," Hz"),O.forEach(w),u=F(H),x=q(H,"DIV",{class:!0});var $=I(x);N=B($,a[4]),$.forEach(w),H.forEach(w),A.forEach(w),this.h()},h(){C(s,"class","svelte-63wsq3"),C(r,"class","volume-bar svelte-63wsq3"),Q(r,"width",a[2]+"%"),C(n,"class","volume-bar-container svelte-63wsq3"),C(f,"class","volume-text svelte-63wsq3"),C(t,"class","volume-display svelte-63wsq3"),C(D,"class","svelte-63wsq3"),C(m,"class","frequency-text svelte-63wsq3"),C(x,"class","note-text svelte-63wsq3"),C(k,"class","frequency-display svelte-63wsq3"),C(e,"class","results svelte-63wsq3")},m(E,A){T(E,e,A),_(e,t),_(t,s),_(t,l),_(t,n),_(n,r),_(t,c),_(t,f),_(f,V),_(f,L),_(e,p),_(e,k),_(k,D),_(k,v),_(k,m),_(m,o),_(m,b),_(k,u),_(k,x),_(x,N)},p(E,A){A&4&&Q(r,"width",E[2]+"%"),A&4&&d!==(d=E[2].toFixed(1)+"")&&U(V,d),A&8&&h!==(h=E[3].toFixed(1)+"")&&U(o,h),A&16&&U(N,E[4])},d(E){E&&w(e)}}}function ee(a){let e,t=a[14]+"",s;return{c(){e=g("div"),s=P(t),this.h()},l(i){e=q(i,"DIV",{class:!0});var l=I(e);s=B(l,t),l.forEach(w),this.h()},h(){C(e,"class","log-entry svelte-63wsq3")},m(i,l){T(i,e,l),_(e,s)},p(i,l){l&32&&t!==(t=i[14]+"")&&U(s,t)},d(i){i&&w(e)}}}function de(a){let e,t,s,i='<h1 class="svelte-63wsq3">シンプルマイクテスト</h1> <p class="svelte-63wsq3">自作コンポーネント不使用・最小限実装のテストページ</p>',l,n,r,c,f,d,V="ログ（最新20件）",L,p;function k(o,b){if(o[0]==="initial")return ue;if(o[0]==="pending")return ce;if(o[0]==="granted")return re;if(o[0]==="denied")return oe}let D=k(a),y=D&&D(a),v=a[1]&&R(a),m=X(a[5]),h=[];for(let o=0;o<m.length;o+=1)h[o]=ee(Y(a,m,o));return{c(){e=M(),t=g("div"),s=g("div"),s.innerHTML=i,l=M(),n=g("div"),y&&y.c(),r=M(),v&&v.c(),c=M(),f=g("div"),d=g("h3"),d.textContent=V,L=M(),p=g("div");for(let o=0;o<h.length;o+=1)h[o].c();this.h()},l(o){ie("svelte-tme954",document.head).forEach(w),e=F(o),t=q(o,"DIV",{class:!0});var u=I(t);s=q(u,"DIV",{class:!0,"data-svelte-h":!0}),S(s)!=="svelte-txk54u"&&(s.innerHTML=i),l=F(u),n=q(u,"DIV",{class:!0});var x=I(n);y&&y.l(x),x.forEach(w),r=F(u),v&&v.l(u),c=F(u),f=q(u,"DIV",{class:!0});var N=I(f);d=q(N,"H3",{class:!0,"data-svelte-h":!0}),S(d)!=="svelte-1w4c8w2"&&(d.textContent=V),L=F(N),p=q(N,"DIV",{class:!0});var E=I(p);for(let A=0;A<h.length;A+=1)h[A].l(E);E.forEach(w),N.forEach(w),u.forEach(w),this.h()},h(){document.title="シンプルマイクテスト - 相対音感トレーニング",C(s,"class","header svelte-63wsq3"),C(n,"class","test-controls svelte-63wsq3"),C(d,"class","svelte-63wsq3"),C(p,"class","log-container svelte-63wsq3"),C(f,"class","logs svelte-63wsq3"),C(t,"class","simple-test svelte-63wsq3")},m(o,b){T(o,e,b),T(o,t,b),_(t,s),_(t,l),_(t,n),y&&y.m(n,null),_(t,r),v&&v.m(t,null),_(t,c),_(t,f),_(f,d),_(f,L),_(f,p);for(let u=0;u<h.length;u+=1)h[u]&&h[u].m(p,null)},p(o,[b]){if(D===(D=k(o))&&y?y.p(o,b):(y&&y.d(1),y=D&&D(o),y&&(y.c(),y.m(n,null))),o[1]?v?v.p(o,b):(v=R(o),v.c(),v.m(t,c)):v&&(v.d(1),v=null),b&32){m=X(o[5]);let u;for(u=0;u<m.length;u+=1){const x=Y(o,m,u);h[u]?h[u].p(x,b):(h[u]=ee(x),h[u].c(),h[u].m(p,null))}for(;u<h.length;u+=1)h[u].d(1);h.length=m.length}},i:G,o:G,d(o){o&&(w(e),w(t)),y&&y.d(),v&&v.d(),ne(h,o)}}}function fe(a,e){let t=0;for(let r=0;r<a.length;r++)t+=a[r]*a[r];if(t=Math.sqrt(t/a.length),t<.005)return 0;const s=Math.floor(e/800),i=Math.floor(e/80);let l=0,n=0;for(let r=s;r<=i;r++){let c=0,f=0;for(let d=0;d<a.length-r;d++)c+=a[d]*a[d+r],f+=a[d]*a[d];f>0&&(c=c/Math.sqrt(f),c>l&&(l=c,n=r))}return l>.25?e/n:0}function he(a){const t=Math.round(12*Math.log2(a/440)),s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],i=((t+9)%12+12)%12,l=Math.floor((t+9)/12)+4,n=s[i];return`${n}${l}（${{C:"ド","C#":"ド#",D:"レ","D#":"レ#",E:"ミ",F:"ファ","F#":"ファ#",G:"ソ","G#":"ソ#",A:"ラ","A#":"ラ#",B:"シ"}[n]}${l}）`}function ve(a,e,t){let s="initial",i=!1,l=0,n=0,r="",c=null,f=null,d=null,V=null,L=[];function p(v){const m=new Date().toLocaleTimeString();t(5,L=[`[${m}] ${v}`,...L.slice(0,19)])}async function k(){p("マイク許可リクエスト開始"),t(0,s="pending");try{f=await navigator.mediaDevices.getUserMedia({audio:!0}),p("マイク許可取得成功"),t(0,s="granted"),c=new(window.AudioContext||window.webkitAudioContext),p(`AudioContext作成完了, state: ${c.state}`),c.state==="suspended"&&(await c.resume(),p(`AudioContext再開完了, state: ${c.state}`)),d=c.createAnalyser(),d.fftSize=2048,d.smoothingTimeConstant=.8,d.minDecibels=-90,d.maxDecibels=-10,c.createMediaStreamSource(f).connect(d),p("アナライザー接続完了"),f.getTracks().forEach((m,h)=>{p(`Track ${h}: ${m.kind}, ${m.label}, state: ${m.readyState}`),m.addEventListener("ended",()=>{p(`Track ${h} ended`)}),m.addEventListener("mute",()=>{p(`Track ${h} muted`)}),m.addEventListener("unmute",()=>{p(`Track ${h} unmuted`)})}),t(1,i=!0),p("リアルタイム解析開始"),D()}catch(v){p(`マイクアクセスエラー: ${v.name} - ${v.message}`),t(0,s="denied")}}function D(){if(!i||!d){p("解析停止");return}const v=d.frequencyBinCount,m=new Uint8Array(v);d.getByteFrequencyData(m);let h=0;for(let x=0;x<m.length;x++)h+=m[x]*m[x];const o=Math.sqrt(h/m.length);t(2,l=Math.min(100,o/64*100));const b=new Float32Array(d.fftSize);d.getFloatTimeDomainData(b);const u=fe(b,c.sampleRate);u>80&&u<800?(t(3,n=u),t(4,r=he(u))):(t(3,n=0),t(4,r="")),V=requestAnimationFrame(D)}function y(){t(1,i=!1),p("リスニング停止開始"),V&&(cancelAnimationFrame(V),V=null),f&&(f.getTracks().forEach(v=>v.stop()),f=null,p("MediaStream停止完了")),c&&c.state!=="closed"&&(c.close(),c=null,p("AudioContext終了完了")),d=null}return ae(()=>{y()}),[s,i,l,n,r,L,k,y]}class we extends te{constructor(e){super(),se(this,e,ve,de,le,{})}}export{we as component};
