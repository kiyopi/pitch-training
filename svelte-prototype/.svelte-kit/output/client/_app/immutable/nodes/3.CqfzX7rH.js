import{S as ze,i as Ue,d as U,s as Oe,v as Ge,c as Je,a as We,D as ye,E as be,b as u,q as se,r as ie,u as oe,f as q,w as le,F as Ze,m as F,x as ce,p as A,y as re,G as Ke,g as a,H as he,h,z as f,j as p,k as D,B as te,A as G,o as g,C as ne,e as ee,l as Z,t as K,n as de,I as ke,J as pe}from"../chunks/Ci2ptbdh.js";import{g as Qe}from"../chunks/D0QH3NT1.js";import"../chunks/CDirIs2-.js";import{p as me}from"../chunks/BV3vFbPg.js";import{b as Ce,g as De}from"../chunks/KnKSiKBQ.js";import{P as we,B as Xe,C as fe}from"../chunks/D0uqYblX.js";import{a as Ye,P as Ee}from"../chunks/DuVpJzwl.js";const{console:$e}=Qe,v="src/routes/microphone-test/+page.svelte";function Ve(c){let t,e="マイク準備完了",o,n,r="トレーニング開始ボタンを押してランダム基音モードへ進んでください",l,i,s,_="トレーニング開始",y,d;const b={c:function(){t=g("h3"),t.textContent=e,o=A(),n=g("p"),n.textContent=r,l=A(),i=g("div"),s=g("button"),s.textContent=_,this.h()},l:function(k){t=p(k,"H3",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-11dam81"&&(t.textContent=e),o=F(k),n=p(k,"P",{class:!0,"data-svelte-h":!0}),G(n)!=="svelte-5idwhi"&&(n.textContent=r),l=F(k),i=p(k,"DIV",{class:!0});var C=D(i);s=p(C,"BUTTON",{class:!0,"data-svelte-h":!0}),G(s)!=="svelte-kae9rs"&&(s.textContent=_),C.forEach(u),this.h()},h:function(){f(t,"class","ready-title svelte-19mrh3"),h(t,v,260,12,7809),f(n,"class","ready-description svelte-19mrh3"),h(n,v,261,12,7858),f(s,"class","training-start-button enabled svelte-19mrh3"),h(s,v,264,14,8004),f(i,"class","training-start-button-area svelte-19mrh3"),h(i,v,263,12,7949)},m:function(k,C){q(k,t,C),q(k,o,C),q(k,n,C),q(k,l,C),q(k,i,C),a(i,s),y||(d=pe(s,"click",c[15],!1),y=!0)},p:de,d:function(k){k&&(u(t),u(o),u(n),u(l),u(i)),y=!1,d()}};return U("SvelteRegisterBlock",{block:b,id:Ve.name,type:"else",source:"(259:10) {:else}",ctx:c}),b}function Pe(c){let t,e;function o(y,d){return y[3]==="granted"&&y[4]&&(!y[0]||!y[1])?Be:Ie}let n=o(c),r=n(c);function l(y,d){if(y[3]==="pending")return Me;if(y[3]==="denied")return Te;if(y[3]==="initial")return Se}let i=l(c),s=i&&i(c);const _={c:function(){r.c(),t=A(),s&&s.c(),e=ke()},l:function(d){r.l(d),t=F(d),s&&s.l(d),e=ke()},m:function(d,b){r.m(d,b),q(d,t,b),s&&s.m(d,b),q(d,e,b)},p:function(d,b){n!==(n=o(d))&&(r.d(1),r=n(d),r&&(r.c(),r.m(t.parentNode,t))),i===(i=l(d))&&s?s.p(d,b):(s&&s.d(1),s=i&&i(d),s&&(s.c(),s.m(e.parentNode,e)))},d:function(d){d&&(u(t),u(e)),r.d(d),s&&s.d(d)}};return U("SvelteRegisterBlock",{block:_,id:Pe.name,type:"if",source:"(233:10) {#if !audioConfirmationComplete}",ctx:c}),_}function Ie(c){let t,e="マイクのテストを開始します",o,n,r="マイクテスト開始ボタンを押してマイクの使用を許可してください";const l={c:function(){t=g("h3"),t.textContent=e,o=A(),n=g("p"),n.textContent=r,this.h()},l:function(s){t=p(s,"H3",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-gfi16f"&&(t.textContent=e),o=F(s),n=p(s,"P",{class:!0,"data-svelte-h":!0}),G(n)!=="svelte-1w19y1h"&&(n.textContent=r),this.h()},h:function(){f(t,"class","instructions-title svelte-19mrh3"),h(t,v,239,14,6946),f(n,"class","instructions-description svelte-19mrh3"),h(n,v,240,14,7010)},m:function(s,_){q(s,t,_),q(s,o,_),q(s,n,_)},d:function(s){s&&(u(t),u(o),u(n))}};return U("SvelteRegisterBlock",{block:l,id:Ie.name,type:"else",source:"(238:12) {:else}",ctx:c}),l}function Be(c){let t,e="「ドー」と発声してください";const o={c:function(){t=g("p"),t.textContent=e,this.h()},l:function(r){t=p(r,"P",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-15d2sx7"&&(t.textContent=e),this.h()},h:function(){f(t,"class","status-text voice-instruction svelte-19mrh3"),h(t,v,236,14,6818)},m:function(r,l){q(r,t,l)},d:function(r){r&&u(t)}};return U("SvelteRegisterBlock",{block:o,id:Be.name,type:"if",source:"(235:12) {#if micPermission === 'granted' && isListening && (!volumeDetected || !frequencyDetected)}",ctx:c}),o}function Se(c){let t,e,o="マイクテストを開始",n,r;const l={c:function(){t=g("div"),e=g("button"),e.textContent=o,this.h()},l:function(s){t=p(s,"DIV",{class:!0});var _=D(t);e=p(_,"BUTTON",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-caex95"&&(e.textContent=o),_.forEach(u),this.h()},h:function(){f(e,"class","mic-test-button start svelte-19mrh3"),h(e,v,253,16,7583),f(t,"class","mic-test-button-area svelte-19mrh3"),h(t,v,252,14,7532)},m:function(s,_){q(s,t,_),a(t,e),n||(r=pe(e,"click",c[12],!1),n=!0)},p:de,d:function(s){s&&u(t),n=!1,r()}};return U("SvelteRegisterBlock",{block:l,id:Se.name,type:"if",source:"(252:50) ",ctx:c}),l}function Te(c){let t,e,o="マイク許可を再試行",n,r;const l={c:function(){t=g("div"),e=g("button"),e.textContent=o,this.h()},l:function(s){t=p(s,"DIV",{class:!0});var _=D(t);e=p(_,"BUTTON",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-1p3n8nt"&&(e.textContent=o),_.forEach(u),this.h()},h:function(){f(e,"class","mic-test-button retry svelte-19mrh3"),h(e,v,247,16,7324),f(t,"class","mic-test-button-area svelte-19mrh3"),h(t,v,246,14,7273)},m:function(s,_){q(s,t,_),a(t,e),n||(r=pe(e,"click",c[12],!1),n=!0)},p:de,d:function(s){s&&u(t),n=!1,r()}};return U("SvelteRegisterBlock",{block:l,id:Te.name,type:"if",source:"(246:49) ",ctx:c}),l}function Me(c){let t,e="マイク準備中...";const o={c:function(){t=g("p"),t.textContent=e,this.h()},l:function(r){t=p(r,"P",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-1vb5g92"&&(t.textContent=e),this.h()},h:function(){f(t,"class","status-text svelte-19mrh3"),h(t,v,244,14,7172)},m:function(r,l){q(r,t,l)},p:de,d:function(r){r&&u(t)}};return U("SvelteRegisterBlock",{block:o,id:Me.name,type:"if",source:"(244:12) {#if micPermission === 'pending'}",ctx:c}),o}function Re(c){let t;function e(l,i){return l[2]?Ve:Pe}let o=e(c),n=o(c);const r={c:function(){t=g("div"),n.c(),this.h()},l:function(i){t=p(i,"DIV",{class:!0});var s=D(t);n.l(s),s.forEach(u),this.h()},h:function(){f(t,"class","training-mode-content svelte-19mrh3"),h(t,v,231,8,6553)},m:function(i,s){q(i,t,s),n.m(t,null)},p:function(i,s){o===(o=e(i))&&n?n.p(i,s):(n.d(1),n=o(i),n&&(n.c(),n.m(t,null)))},d:function(i){i&&u(t),n.d()}};return U("SvelteRegisterBlock",{block:r,id:Re.name,type:"slot",source:'(231:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:c}),r}function ve(c){let t,e,o,n,r="フィルター前:",l,i,s=c[8].toFixed(1)+"",_,y,d,b,M,k="フィルター後:",C,S,w=c[9].toFixed(1)+"",B,N,R,P,E,T="ノイズ削減:",x,I,O,j;const J={c:function(){t=g("div"),e=g("div"),o=g("div"),n=g("span"),n.textContent=r,l=A(),i=g("span"),_=K(s),y=K("%"),d=A(),b=g("div"),M=g("span"),M.textContent=k,C=A(),S=g("span"),B=K(w),N=K("%"),R=A(),P=g("div"),E=g("span"),E.textContent=T,x=A(),I=g("span"),O=K(c[10]),j=K("%"),this.h()},l:function(z){t=p(z,"DIV",{class:!0});var L=D(t);e=p(L,"DIV",{class:!0});var V=D(e);o=p(V,"DIV",{class:!0});var H=D(o);n=p(H,"SPAN",{class:!0,"data-svelte-h":!0}),G(n)!=="svelte-1nh45c7"&&(n.textContent=r),l=F(H),i=p(H,"SPAN",{class:!0});var W=D(i);_=Z(W,s),y=Z(W,"%"),W.forEach(u),H.forEach(u),d=F(V),b=p(V,"DIV",{class:!0});var X=D(b);M=p(X,"SPAN",{class:!0,"data-svelte-h":!0}),G(M)!=="svelte-fz1u1y"&&(M.textContent=k),C=F(X),S=p(X,"SPAN",{class:!0});var Q=D(S);B=Z(Q,w),N=Z(Q,"%"),Q.forEach(u),X.forEach(u),R=F(V),P=p(V,"DIV",{class:!0});var Y=D(P);E=p(Y,"SPAN",{class:!0,"data-svelte-h":!0}),G(E)!=="svelte-3jbm0v"&&(E.textContent=T),x=F(Y),I=p(Y,"SPAN",{class:!0});var $=D(I);O=Z($,c[10]),j=Z($,"%"),$.forEach(u),Y.forEach(u),V.forEach(u),L.forEach(u),this.h()},h:function(){f(n,"class","stat-label svelte-19mrh3"),h(n,v,290,20,8891),f(i,"class","stat-value raw svelte-19mrh3"),h(i,v,291,20,8951),f(o,"class","stat-item svelte-19mrh3"),h(o,v,289,18,8847),f(M,"class","stat-label svelte-19mrh3"),h(M,v,294,20,9098),f(S,"class","stat-value filtered svelte-19mrh3"),h(S,v,295,20,9158),f(b,"class","stat-item svelte-19mrh3"),h(b,v,293,18,9054),f(E,"class","stat-label svelte-19mrh3"),h(E,v,298,20,9315),f(I,"class","stat-value reduction svelte-19mrh3"),h(I,v,299,20,9374),f(P,"class","stat-item svelte-19mrh3"),h(P,v,297,18,9271),f(e,"class","noise-stats svelte-19mrh3"),h(e,v,288,16,8803),f(t,"class","noise-reduction-info svelte-19mrh3"),h(t,v,287,14,8752)},m:function(z,L){q(z,t,L),a(t,e),a(e,o),a(o,n),a(o,l),a(o,i),a(i,_),a(i,y),a(e,d),a(e,b),a(b,M),a(b,C),a(b,S),a(S,B),a(S,N),a(e,R),a(e,P),a(P,E),a(P,x),a(P,I),a(I,O),a(I,j)},p:function(z,L){L&256&&s!==(s=z[8].toFixed(1)+"")&&ee(_,s),L&512&&w!==(w=z[9].toFixed(1)+"")&&ee(B,w),L&1024&&ee(O,z[10])},d:function(z){z&&u(t)}};return U("SvelteRegisterBlock",{block:J,id:ve.name,type:"if",source:"(287:12) {#if isListening}",ctx:c}),J}function xe(c){let t;const e={c:function(){t=K(" ")},l:function(n){t=Z(n," ")},m:function(n,r){q(n,t,r)},d:function(n){n&&u(t)}};return U("SvelteRegisterBlock",{block:e,id:xe.name,type:"else",source:"(310:16) {:else}",ctx:c}),e}function qe(c){let t;const e={c:function(){t=K("⏳ 声を出して音量を確認してください")},l:function(n){t=Z(n,"⏳ 声を出して音量を確認してください")},m:function(n,r){q(n,t,r)},d:function(n){n&&u(t)}};return U("SvelteRegisterBlock",{block:e,id:qe.name,type:"if",source:"(308:16) {#if !volumeDetected && isListening}",ctx:c}),e}function Ne(c){let t,e,o,n="音量レベル",r,l,i,s,_,y=c[5].toFixed(1)+"",d,b,M,k,C,S,w=c[4]&&ve(c);function B(E,T){return!E[0]&&E[4]?qe:xe}let N=B(c),R=N(c);const P={c:function(){t=g("div"),e=g("div"),o=g("h3"),o.textContent=n,r=A(),l=g("div"),i=g("div"),s=A(),_=g("div"),d=K(y),b=K("%"),M=A(),w&&w.c(),k=A(),C=g("div"),S=g("span"),R.c(),this.h()},l:function(T){t=p(T,"DIV",{class:!0});var x=D(t);e=p(x,"DIV",{class:!0});var I=D(e);o=p(I,"H3",{class:!0,"data-svelte-h":!0}),G(o)!=="svelte-1nc8gri"&&(o.textContent=n),r=F(I),l=p(I,"DIV",{class:!0});var O=D(l);i=p(O,"DIV",{class:!0,style:!0}),D(i).forEach(u),O.forEach(u),s=F(I),_=p(I,"DIV",{class:!0});var j=D(_);d=Z(j,y),b=Z(j,"%"),j.forEach(u),M=F(I),w&&w.l(I),k=F(I),C=p(I,"DIV",{class:!0});var J=D(C);S=p(J,"SPAN",{class:!0});var m=D(S);R.l(m),m.forEach(u),J.forEach(u),I.forEach(u),x.forEach(u),this.h()},h:function(){f(o,"class","display-title svelte-19mrh3"),h(o,v,279,12,8409),f(i,"class","volume-bar svelte-19mrh3"),he(i,"width",c[5]+"%"),h(i,v,281,14,8507),f(l,"class","volume-bar-container svelte-19mrh3"),h(l,v,280,12,8458),f(_,"class","volume-text svelte-19mrh3"),h(_,v,283,12,8601),f(S,"class","status-pending svelte-19mrh3"),h(S,v,306,14,9588),f(C,"class","volume-status svelte-19mrh3"),h(C,v,305,12,9546),f(e,"class","volume-section svelte-19mrh3"),h(e,v,278,10,8368),f(t,"class","card-inner svelte-19mrh3"),h(t,v,277,8,8333)},m:function(T,x){q(T,t,x),a(t,e),a(e,o),a(e,r),a(e,l),a(l,i),a(e,s),a(e,_),a(_,d),a(_,b),a(e,M),w&&w.m(e,null),a(e,k),a(e,C),a(C,S),R.m(S,null)},p:function(T,x){x&32&&he(i,"width",T[5]+"%"),x&32&&y!==(y=T[5].toFixed(1)+"")&&ee(d,y),T[4]?w?w.p(T,x):(w=ve(T),w.c(),w.m(e,k)):w&&(w.d(1),w=null),N!==(N=B(T))&&(R.d(1),R=N(T),R&&(R.c(),R.m(S,null)))},d:function(T){T&&u(t),w&&w.d(),R.d()}};return U("SvelteRegisterBlock",{block:P,id:Ne.name,type:"slot",source:'(277:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:c}),P}function Fe(c){let t;const e={c:function(){t=K(" ")},l:function(n){t=Z(n," ")},m:function(n,r){q(n,t,r)},d:function(n){n&&u(t)}};return U("SvelteRegisterBlock",{block:e,id:Fe.name,type:"else",source:"(332:16) {:else}",ctx:c}),e}function Ae(c){let t;const e={c:function(){t=K("⏳ 「ド」を発声して音程を確認してください")},l:function(n){t=Z(n,"⏳ 「ド」を発声して音程を確認してください")},m:function(n,r){q(n,t,r)},d:function(n){n&&u(t)}};return U("SvelteRegisterBlock",{block:e,id:Ae.name,type:"if",source:"(330:16) {#if !frequencyDetected && isListening}",ctx:c}),e}function Le(c){let t,e,o,n="音程検出",r,l,i,s=c[6]>0?c[6].toFixed(1)+" Hz":"ーー",_,y,d,b,M,k,C;function S(R,P){return!R[1]&&R[4]?Ae:Fe}let w=S(c),B=w(c);const N={c:function(){t=g("div"),e=g("div"),o=g("h3"),o.textContent=n,r=A(),l=g("div"),i=g("div"),_=K(s),y=A(),d=g("div"),b=K(c[7]),M=A(),k=g("div"),C=g("span"),B.c(),this.h()},l:function(P){t=p(P,"DIV",{class:!0});var E=D(t);e=p(E,"DIV",{class:!0});var T=D(e);o=p(T,"H3",{class:!0,"data-svelte-h":!0}),G(o)!=="svelte-1ofzoy2"&&(o.textContent=n),r=F(T),l=p(T,"DIV",{class:!0});var x=D(l);i=p(x,"DIV",{class:!0});var I=D(i);_=Z(I,s),I.forEach(u),y=F(x),d=p(x,"DIV",{class:!0});var O=D(d);b=Z(O,c[7]),O.forEach(u),x.forEach(u),M=F(T),k=p(T,"DIV",{class:!0});var j=D(k);C=p(j,"SPAN",{class:!0});var J=D(C);B.l(J),J.forEach(u),j.forEach(u),T.forEach(u),E.forEach(u),this.h()},h:function(){f(o,"class","display-title svelte-19mrh3"),h(o,v,322,12,10021),f(i,"class","frequency-value svelte-19mrh3"),h(i,v,324,14,10115),f(d,"class","note-value svelte-19mrh3"),h(d,v,325,14,10232),f(l,"class","frequency-display svelte-19mrh3"),h(l,v,323,12,10069),f(C,"class","status-pending svelte-19mrh3"),h(C,v,328,14,10352),f(k,"class","frequency-status svelte-19mrh3"),h(k,v,327,12,10307),f(e,"class","frequency-section svelte-19mrh3"),h(e,v,321,10,9977),f(t,"class","card-inner svelte-19mrh3"),h(t,v,320,8,9942)},m:function(P,E){q(P,t,E),a(t,e),a(e,o),a(e,r),a(e,l),a(l,i),a(i,_),a(l,y),a(l,d),a(d,b),a(e,M),a(e,k),a(k,C),B.m(C,null)},p:function(P,E){E&64&&s!==(s=P[6]>0?P[6].toFixed(1)+" Hz":"ーー")&&ee(_,s),E&128&&ee(b,P[7]),w!==(w=S(P))&&(B.d(1),B=w(P),B&&(B.c(),B.m(C,null)))},d:function(P){P&&u(t),B.d()}};return U("SvelteRegisterBlock",{block:N,id:Le.name,type:"slot",source:'(320:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:c}),N}function He(c){let t,e,o,n,r,l,i,s,_,y,d,b,M,k,C,S="マイクテスト",w,B,N="音感トレーニングを始める前に、マイクの動作を確認します",R,P,E,T,x,I,O,j,J,m={isActive:c[3]==="granted",debugMode:!0};e=new Ee({props:m,$$inline:!0}),c[16](e),e.$on("pitchUpdate",c[13]),e.$on("error",c[14]),e.$on("warning",je),E=new fe({props:{variant:"default",padding:"lg",$$slots:{default:[Re]},$$scope:{ctx:c}},$$inline:!0}),I=new fe({props:{variant:"default",padding:"lg",$$slots:{default:[Ne]},$$scope:{ctx:c}},$$inline:!0}),j=new fe({props:{variant:"default",padding:"lg",$$slots:{default:[Le]},$$scope:{ctx:c}},$$inline:!0});const z={c:function(){t=g("div"),re(e.$$.fragment),o=A(),n=g("div"),r=g("div"),l=g("div"),i=g("div"),s=ne("svg"),_=ne("path"),y=ne("path"),d=ne("line"),b=ne("line"),M=A(),k=g("div"),C=g("h1"),C.textContent=S,w=A(),B=g("p"),B.textContent=N,R=A(),P=g("div"),re(E.$$.fragment),T=A(),x=g("div"),re(I.$$.fragment),O=A(),re(j.$$.fragment),this.h()},l:function(V){t=p(V,"DIV",{style:!0});var H=D(t);ce(e.$$.fragment,H),H.forEach(u),o=F(V),n=p(V,"DIV",{class:!0});var W=D(n);r=p(W,"DIV",{class:!0});var X=D(r);l=p(X,"DIV",{class:!0});var Q=D(l);i=p(Q,"DIV",{class:!0});var Y=D(i);s=te(Y,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var $=D(s);_=te($,"path",{d:!0}),D(_).forEach(u),y=te($,"path",{d:!0}),D(y).forEach(u),d=te($,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),D(d).forEach(u),b=te($,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),D(b).forEach(u),$.forEach(u),Y.forEach(u),M=F(Q),k=p(Q,"DIV",{});var ae=D(k);C=p(ae,"H1",{class:!0,"data-svelte-h":!0}),G(C)!=="svelte-z7m4lk"&&(C.textContent=S),w=F(ae),B=p(ae,"P",{class:!0,"data-svelte-h":!0}),G(B)!=="svelte-1vtv92f"&&(B.textContent=N),ae.forEach(u),Q.forEach(u),X.forEach(u),R=F(W),P=p(W,"DIV",{class:!0});var ge=D(P);ce(E.$$.fragment,ge),ge.forEach(u),T=F(W),x=p(W,"DIV",{class:!0});var ue=D(x);ce(I.$$.fragment,ue),O=F(ue),ce(j.$$.fragment,ue),ue.forEach(u),W.forEach(u),this.h()},h:function(){he(t,"display","none"),h(t,v,198,2,5444),f(_,"d","M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"),h(_,v,215,12,6011),f(y,"d","M19 10v2a7 7 0 0 1-14 0v-2"),h(y,v,216,12,6088),f(d,"x1","12"),f(d,"x2","12"),f(d,"y1","19"),f(d,"y2","22"),h(d,v,217,12,6139),f(b,"x1","8"),f(b,"x2","16"),f(b,"y1","22"),f(b,"y2","22"),h(b,v,218,12,6191),f(s,"width","48"),f(s,"height","48"),f(s,"viewBox","0 0 24 24"),f(s,"fill","none"),f(s,"stroke","currentColor"),f(s,"stroke-width","2"),h(s,v,214,10,5899),f(i,"class","mic-icon svelte-19mrh3"),h(i,v,213,8,5866),f(C,"class","mic-test-title svelte-19mrh3"),h(C,v,222,10,6286),f(B,"class","mic-test-description svelte-19mrh3"),h(B,v,223,10,6335),h(k,v,221,8,6270),f(l,"class","mic-test-header svelte-19mrh3"),h(l,v,212,6,5828),f(r,"class","header svelte-19mrh3"),h(r,v,211,4,5801),f(P,"class","training-mode-info svelte-19mrh3"),h(P,v,229,4,6468),f(x,"class","test-section svelte-19mrh3"),h(x,v,274,4,8230),f(n,"class","microphone-test svelte-19mrh3"),h(n,v,209,2,5749)},m:function(V,H){q(V,t,H),le(e,t,null),q(V,o,H),q(V,n,H),a(n,r),a(r,l),a(l,i),a(i,s),a(s,_),a(s,y),a(s,d),a(s,b),a(l,M),a(l,k),a(k,C),a(k,w),a(k,B),a(n,R),a(n,P),le(E,P,null),a(n,T),a(n,x),le(I,x,null),a(x,O),le(j,x,null),J=!0},p:function(V,H){const W={};H&8&&(W.isActive=V[3]==="granted"),e.$set(W);const X={};H&8388639&&(X.$$scope={dirty:H,ctx:V}),E.$set(X);const Q={};H&8390449&&(Q.$$scope={dirty:H,ctx:V}),I.$set(Q);const Y={};H&8388818&&(Y.$$scope={dirty:H,ctx:V}),j.$set(Y)},i:function(V){J||(oe(e.$$.fragment,V),oe(E.$$.fragment,V),oe(I.$$.fragment,V),oe(j.$$.fragment,V),J=!0)},o:function(V){ie(e.$$.fragment,V),ie(E.$$.fragment,V),ie(I.$$.fragment,V),ie(j.$$.fragment,V),J=!1},d:function(V){V&&(u(t),u(o),u(n)),c[16](null),se(e),se(E),se(I),se(j)}};return U("SvelteRegisterBlock",{block:z,id:He.name,type:"slot",source:"(197:0) <PageLayout showBackButton={true}>",ctx:c}),z}function _e(c){let t,e,o;e=new we({props:{showBackButton:!0,$$slots:{default:[He]},$$scope:{ctx:c}},$$inline:!0});const n={c:function(){t=A(),re(e.$$.fragment),this.h()},l:function(l){Ze("svelte-8st1fo",document.head).forEach(u),t=F(l),ce(e.$$.fragment,l),this.h()},h:function(){document.title="マイクテスト - 相対音感トレーニング"},m:function(l,i){q(l,t,i),le(e,l,i),o=!0},p:function(l,[i]){const s={};i&8392703&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i:function(l){o||(oe(e.$$.fragment,l),o=!0)},o:function(l){ie(e.$$.fragment,l),o=!1},d:function(l){l&&u(t),se(e,l)}};return U("SvelteRegisterBlock",{block:n,id:_e.name,type:"component",source:"",ctx:c}),n}function je(c){const{reason:t,track:e}=c.detail;console.warn("⚠️ [MicTest] PitchDetector警告:",{reason:t,track:e}),t==="track_muted"&&console.warn("⚠️ [MicTest] マイクがミュート状態です")}function et(c,t,e){let o;Ge(me,"page"),Je(c,me,m=>e(19,o=m));let{$$slots:n={},$$scope:r}=t;We("Page",n,[]);let l="random";ye(()=>{o.url.searchParams.has("mode")&&(l=o.url.searchParams.get("mode")||"random")});let i="initial",s=!1,_=!1,y=!1,d=!1,b=0,M=0,k="ーー",C=0,S=0,w=0,B=0,N=null;const R={random:{name:"ランダム基音モード",description:"10種類の基音からランダムに選択してトレーニング",color:"green",path:"/training/random"},continuous:{name:"連続チャレンジモード",description:"選択した回数だけ連続で実行し、総合評価を確認",color:"orange",path:"/training/continuous"},chromatic:{name:"12音階モード",description:"クロマチックスケールの上行・下行で完全制覇",color:"purple",path:"/training/chromatic"}},P=R[l]||R.random;async function E(){e(3,i="pending");try{console.log("🎤 [MicTest] PitchDetector経由でマイク許可リクエスト開始"),N&&(await N.initialize(),console.log("✅ [MicTest] PitchDetector初期化完了")),e(3,i="granted"),e(4,s=!0),console.log("✅ [MicTest] マイク許可完了")}catch(m){console.error("❌ [MicTest] マイク許可エラー:",m),e(3,i="denied")}}function T(m){const{frequency:z,note:L,volume:V,rawVolume:H,clarity:W}=m.detail;e(6,M=z),e(7,k=L),e(5,b=V),C=W,e(8,S=H),e(9,w=V),S>0?e(10,B=Math.max(0,Math.round((S-w)/S*100))):e(10,B=0),b>5&&e(0,_=!0),z>80&&z<800&&e(1,y=!0),window.micTestDebugCount||(window.micTestDebugCount=0),window.micTestDebugCount<5&&(window.micTestDebugCount++,console.log(`🎙️ [MicTest] PitchUpdate ${window.micTestDebugCount}:`,{frequency:z.toFixed(1),volume:V.toFixed(1),rawVolume:H.toFixed(1),note:L}))}function x(m){const{error:z,reason:L,recovery:V}=m.detail;console.error("🚨 [MicTest] PitchDetectorエラー:",{error:z,reason:L,recovery:V}),L==="mediastream_ended"&&(console.error("🚨 [MicTest] MediaStream終了 - マイク許可をリセット"),e(3,i="denied"),e(4,s=!1),e(0,_=!1),e(1,y=!1),e(2,d=!1),alert("マイクアクセスが中断されました。マイクテストを再開してください。"))}function I(){console.log("🛑 [MicTest] リスニング停止開始"),N&&(N.stopDetection(),console.log("✅ [MicTest] PitchDetector検出停止")),console.log("✅ [MicTest] リスニング停止完了")}function O(){console.log("🚀 [MicTest] トレーニング開始 - ランダム基音モードへ遷移"),De(`${Ce}/training/random?from=microphone-test`)}be(()=>{I()});const j=[];Object.keys(t).forEach(m=>{!~j.indexOf(m)&&m.slice(0,2)!=="$$"&&m!=="slot"&&$e.warn(`<Page> was created with unknown prop '${m}'`)});function J(m){Ke[m?"unshift":"push"](()=>{N=m,e(11,N)})}return c.$capture_state=()=>({onMount:ye,onDestroy:be,page:me,goto:De,base:Ce,Card:fe,Button:Xe,PageLayout:we,PitchDetector:Ee,audioManager:Ye,mode:l,micPermission:i,isListening:s,volumeDetected:_,frequencyDetected:y,audioConfirmationComplete:d,currentVolume:b,currentFrequency:M,currentNote:k,pitchClarity:C,rawVolume:S,filteredVolume:w,noiseReduction:B,pitchDetectorComponent:N,trainingModes:R,selectedMode:P,requestMicrophone:E,handlePitchUpdate:T,handlePitchDetectorError:x,handlePitchDetectorWarning:je,stopListening:I,startTraining:O,$page:o}),c.$inject_state=m=>{"mode"in m&&(l=m.mode),"micPermission"in m&&e(3,i=m.micPermission),"isListening"in m&&e(4,s=m.isListening),"volumeDetected"in m&&e(0,_=m.volumeDetected),"frequencyDetected"in m&&e(1,y=m.frequencyDetected),"audioConfirmationComplete"in m&&e(2,d=m.audioConfirmationComplete),"currentVolume"in m&&e(5,b=m.currentVolume),"currentFrequency"in m&&e(6,M=m.currentFrequency),"currentNote"in m&&e(7,k=m.currentNote),"pitchClarity"in m&&(C=m.pitchClarity),"rawVolume"in m&&e(8,S=m.rawVolume),"filteredVolume"in m&&e(9,w=m.filteredVolume),"noiseReduction"in m&&e(10,B=m.noiseReduction),"pitchDetectorComponent"in m&&e(11,N=m.pitchDetectorComponent)},t&&"$$inject"in t&&c.$inject_state(t.$$inject),c.$$.update=()=>{c.$$.dirty&7&&_&&y&&!d&&e(2,d=!0)},[_,y,d,i,s,b,M,k,S,w,B,N,E,T,x,O,J]}class rt extends ze{constructor(t){super(t),Ue(this,t,et,_e,Oe,{}),U("SvelteRegisterComponent",{component:this,tagName:"Page",options:t,id:_e.name})}}export{rt as component};
