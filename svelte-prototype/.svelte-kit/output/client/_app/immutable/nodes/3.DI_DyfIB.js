import{S as rt,i as at,d as F,s as ut,v as dt,c as ft,a as vt,D as Le,E as He,b as f,q as ue,r as ie,u as se,f as R,w as de,F as mt,m as A,x as fe,p as M,y as ve,g as c,z as d,h,j as p,k as C,B as re,A as $,o as k,C as ae,G as Te,e as be,l as O,t as U,H as ht,I as _t,n as Be,J as Oe}from"../chunks/DI7EJjfr.js";import"../chunks/DVnmPNbO.js";import{p as we}from"../chunks/CTk6OLGj.js";import{P as Ue,B as Se,C as Ce}from"../chunks/DqEWnoOu.js";const _="src/routes/microphone-test/+page.svelte";function We(s){let e,t="🎤 マイクテスト開始",i,n;const o={c:function(){e=k("button"),e.textContent=t,this.h()},l:function(a){e=p(a,"BUTTON",{class:!0,"data-svelte-h":!0}),$(e)!=="svelte-1vkqvr3"&&(e.textContent=t),this.h()},h:function(){d(e,"class","retry-button svelte-167wv5d"),h(e,_,251,14,7267)},m:function(a,v){R(a,e,v),i||(n=Oe(e,"click",s[9],!1),i=!0)},p:Be,d:function(a){a&&f(e),i=!1,n()}};return F("SvelteRegisterBlock",{block:o,id:We.name,type:"if",source:"(251:50) ",ctx:s}),o}function Je(s){let e,t="❌ マイクアクセスが拒否されました",i,n,o="マイク許可を再試行",l,a;const v={c:function(){e=k("div"),e.textContent=t,i=M(),n=k("button"),n.textContent=o,this.h()},l:function(u){e=p(u,"DIV",{class:!0,"data-svelte-h":!0}),$(e)!=="svelte-4rewx4"&&(e.textContent=t),i=A(u),n=p(u,"BUTTON",{class:!0,"data-svelte-h":!0}),$(n)!=="svelte-1co4n23"&&(n.textContent=o),this.h()},h:function(){d(e,"class","status-indicator error svelte-167wv5d"),h(e,_,246,14,7019),d(n,"class","retry-button svelte-167wv5d"),h(n,_,247,14,7093)},m:function(u,g){R(u,e,g),R(u,i,g),R(u,n,g),l||(a=Oe(n,"click",s[9],!1),l=!0)},p:Be,d:function(u){u&&(f(e),f(i),f(n)),l=!1,a()}};return F("SvelteRegisterBlock",{block:v,id:Je.name,type:"if",source:"(246:49) ",ctx:s}),v}function Ze(s){let e,t="⏳ マイク許可を確認中...";const i={c:function(){e=k("div"),e.textContent=t,this.h()},l:function(o){e=p(o,"DIV",{class:!0,"data-svelte-h":!0}),$(e)!=="svelte-qiomfc"&&(e.textContent=t),this.h()},h:function(){d(e,"class","status-indicator pending svelte-167wv5d"),h(e,_,244,14,6896)},m:function(o,l){R(o,e,l)},p:Be,d:function(o){o&&f(e)}};return F("SvelteRegisterBlock",{block:i,id:Ze.name,type:"if",source:"(244:12) {#if micPermission === 'pending'}",ctx:s}),i}function Ke(s){let e;const t={c:function(){e=U(" ")},l:function(n){e=O(n," ")},m:function(n,o){R(n,e,o)},d:function(n){n&&f(e)}};return F("SvelteRegisterBlock",{block:t,id:Ke.name,type:"else",source:"(273:18) {:else}",ctx:s}),t}function Qe(s){let e;const t={c:function(){e=U("マイクテスト開始後に表示されます")},l:function(n){e=O(n,"マイクテスト開始後に表示されます")},m:function(n,o){R(n,e,o)},d:function(n){n&&f(e)}};return F("SvelteRegisterBlock",{block:t,id:Qe.name,type:"if",source:"(271:41) ",ctx:s}),t}function Xe(s){let e;const t={c:function(){e=U("⏳ 声を出して音量を確認してください")},l:function(n){e=O(n,"⏳ 声を出して音量を確認してください")},m:function(n,o){R(n,e,o)},d:function(n){n&&f(e)}};return F("SvelteRegisterBlock",{block:t,id:Xe.name,type:"if",source:"(269:18) {#if !volumeDetected && isListening}",ctx:s}),t}function Ye(s){let e;const t={c:function(){e=U(" ")},l:function(n){e=O(n," ")},m:function(n,o){R(n,e,o)},d:function(n){n&&f(e)}};return F("SvelteRegisterBlock",{block:t,id:Ye.name,type:"else",source:"(293:18) {:else}",ctx:s}),t}function $e(s){let e;const t={c:function(){e=U("マイクテスト開始後に表示されます")},l:function(n){e=O(n,"マイクテスト開始後に表示されます")},m:function(n,o){R(n,e,o)},d:function(n){n&&f(e)}};return F("SvelteRegisterBlock",{block:t,id:$e.name,type:"if",source:"(291:41) ",ctx:s}),t}function et(s){let e;const t={c:function(){e=U("⏳ 「ド」を発声して音程を確認してください")},l:function(n){e=O(n,"⏳ 「ド」を発声して音程を確認してください")},m:function(n,o){R(n,e,o)},d:function(n){n&&f(e)}};return F("SvelteRegisterBlock",{block:t,id:et.name,type:"if",source:"(289:18) {#if !frequencyDetected && isListening}",ctx:s}),t}function De(s){let e,t,i,n="「ド」を発声してください",o,l,a="任意の高さで「ドー」と歌うように発声してください";const v={c:function(){e=k("div"),t=k("div"),i=k("h3"),i.textContent=n,o=M(),l=k("p"),l.textContent=a,this.h()},l:function(u){e=p(u,"DIV",{class:!0});var g=C(e);t=p(g,"DIV",{class:!0});var w=C(t);i=p(w,"H3",{class:!0,"data-svelte-h":!0}),$(i)!=="svelte-xe90gt"&&(i.textContent=n),o=A(w),l=p(w,"P",{class:!0,"data-svelte-h":!0}),$(l)!=="svelte-1rtajtc"&&(l.textContent=a),w.forEach(f),g.forEach(f),this.h()},h:function(){d(i,"class","svelte-167wv5d"),h(i,_,304,16,9186),d(l,"class","svelte-167wv5d"),h(l,_,305,16,9224),d(t,"class","guidance-content svelte-167wv5d"),h(t,_,303,14,9139),d(e,"class","guidance svelte-167wv5d"),h(e,_,302,12,9102)},m:function(u,g){R(u,e,g),c(e,t),c(t,i),c(t,o),c(t,l)},d:function(u){u&&f(e)}};return F("SvelteRegisterBlock",{block:v,id:De.name,type:"if",source:"(302:10) {#if volumeDetected && !frequencyDetected && isListening}",ctx:s}),v}function tt(s){let e,t,i,n,o,l,a="音量レベル",v,m,u,g,w,z=s[4].toFixed(1)+"",I,D,x,b,y,E,S,q,H="音程検出",K,W,r,B=s[5].toFixed(1)+"",P,Q,J,T,j,ne,Y,X,ye;function Ve(N,V){if(N[0]==="pending")return Ze;if(N[0]==="denied")return Je;if(N[0]==="initial")return We}let le=Ve(s),L=le&&le(s);function Ie(N,V){return!N[1]&&N[3]?Xe:N[3]?Ke:Qe}let me=Ie(s),ee=me(s);function qe(N,V){return!N[2]&&N[3]?et:N[3]?Ye:$e}let he=qe(s),te=he(s),G=s[1]&&!s[2]&&s[3]&&De(s);const Pe={c:function(){e=k("div"),t=k("div"),L&&L.c(),i=M(),n=k("div"),o=k("div"),l=k("h3"),l.textContent=a,v=M(),m=k("div"),u=k("div"),g=M(),w=k("div"),I=U(z),D=U("%"),x=M(),b=k("div"),y=k("span"),ee.c(),E=M(),S=k("div"),q=k("h3"),q.textContent=H,K=M(),W=k("div"),r=k("div"),P=U(B),Q=U(" Hz"),J=M(),T=k("div"),j=U(s[6]),ne=M(),Y=k("div"),X=k("span"),te.c(),ye=M(),G&&G.c(),this.h()},l:function(V){e=p(V,"DIV",{class:!0});var Z=C(e);t=p(Z,"DIV",{class:!0});var Fe=C(t);L&&L.l(Fe),Fe.forEach(f),i=A(Z),n=p(Z,"DIV",{class:!0});var _e=C(n);o=p(_e,"DIV",{class:!0});var oe=C(o);l=p(oe,"H3",{class:!0,"data-svelte-h":!0}),$(l)!=="svelte-1nc8gri"&&(l.textContent=a),v=A(oe),m=p(oe,"DIV",{class:!0});var Ae=C(m);u=p(Ae,"DIV",{class:!0,style:!0}),C(u).forEach(f),Ae.forEach(f),g=A(oe),w=p(oe,"DIV",{class:!0});var pe=C(w);I=O(pe,z),D=O(pe,"%"),pe.forEach(f),x=A(oe),b=p(oe,"DIV",{class:!0});var Me=C(b);y=p(Me,"SPAN",{class:!0});var Re=C(y);ee.l(Re),Re.forEach(f),Me.forEach(f),oe.forEach(f),E=A(_e),S=p(_e,"DIV",{class:!0});var ce=C(S);q=p(ce,"H3",{class:!0,"data-svelte-h":!0}),$(q)!=="svelte-1ofzoy2"&&(q.textContent=H),K=A(ce),W=p(ce,"DIV",{class:!0});var ge=C(W);r=p(ge,"DIV",{class:!0});var ke=C(r);P=O(ke,B),Q=O(ke," Hz"),ke.forEach(f),J=A(ge),T=p(ge,"DIV",{class:!0});var ze=C(T);j=O(ze,s[6]),ze.forEach(f),ge.forEach(f),ne=A(ce),Y=p(ce,"DIV",{class:!0});var xe=C(Y);X=p(xe,"SPAN",{class:!0});var Ne=C(X);te.l(Ne),Ne.forEach(f),xe.forEach(f),ce.forEach(f),_e.forEach(f),ye=A(Z),G&&G.l(Z),Z.forEach(f),this.h()},h:function(){d(t,"class","mic-status svelte-167wv5d"),h(t,_,242,10,6811),d(l,"class","display-title svelte-167wv5d"),h(l,_,261,14,7571),d(u,"class","volume-bar svelte-167wv5d"),Te(u,"width",s[4]+"%"),h(u,_,263,16,7673),d(m,"class","volume-bar-container svelte-167wv5d"),h(m,_,262,14,7622),d(w,"class","volume-text svelte-167wv5d"),h(w,_,265,14,7771),d(y,"class","status-pending svelte-167wv5d"),h(y,_,267,16,7888),d(b,"class","volume-status svelte-167wv5d"),h(b,_,266,14,7844),d(o,"class","volume-section svelte-167wv5d"),h(o,_,260,12,7528),d(q,"class","display-title svelte-167wv5d"),h(q,_,281,14,8321),d(r,"class","frequency-value svelte-167wv5d"),h(r,_,283,16,8419),d(T,"class","note-value svelte-167wv5d"),h(T,_,284,16,8503),d(W,"class","frequency-display svelte-167wv5d"),h(W,_,282,14,8371),d(X,"class","status-pending svelte-167wv5d"),h(X,_,287,16,8629),d(Y,"class","frequency-status svelte-167wv5d"),h(Y,_,286,14,8582),d(S,"class","frequency-section"),h(S,_,280,12,8275),d(n,"class","realtime-display svelte-167wv5d"),h(n,_,258,10,7458),d(e,"class","mic-test-content svelte-167wv5d"),h(e,_,239,8,6732)},m:function(V,Z){R(V,e,Z),c(e,t),L&&L.m(t,null),c(e,i),c(e,n),c(n,o),c(o,l),c(o,v),c(o,m),c(m,u),c(o,g),c(o,w),c(w,I),c(w,D),c(o,x),c(o,b),c(b,y),ee.m(y,null),c(n,E),c(n,S),c(S,q),c(S,K),c(S,W),c(W,r),c(r,P),c(r,Q),c(W,J),c(W,T),c(T,j),c(S,ne),c(S,Y),c(Y,X),te.m(X,null),c(e,ye),G&&G.m(e,null)},p:function(V,Z){le===(le=Ve(V))&&L?L.p(V,Z):(L&&L.d(1),L=le&&le(V),L&&(L.c(),L.m(t,null))),Z&16&&Te(u,"width",V[4]+"%"),Z&16&&z!==(z=V[4].toFixed(1)+"")&&be(I,z),me!==(me=Ie(V))&&(ee.d(1),ee=me(V),ee&&(ee.c(),ee.m(y,null))),Z&32&&B!==(B=V[5].toFixed(1)+"")&&be(P,B),Z&64&&be(j,V[6]),he!==(he=qe(V))&&(te.d(1),te=he(V),te&&(te.c(),te.m(X,null))),V[1]&&!V[2]&&V[3]?G||(G=De(V),G.c(),G.m(e,null)):G&&(G.d(1),G=null)},d:function(V){V&&f(e),L&&L.d(),ee.d(),te.d(),G&&G.d()}};return F("SvelteRegisterBlock",{block:Pe,id:tt.name,type:"slot",source:'(239:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:s}),Pe}function nt(s){let e,t;e=new Se({props:{variant:"disabled",size:"lg",fullWidth:!0,disabled:!0,$$slots:{default:[it]},$$scope:{ctx:s}},$$inline:!0});const i={c:function(){ve(e.$$.fragment)},l:function(o){fe(e.$$.fragment,o)},m:function(o,l){de(e,o,l),t=!0},p:function(o,l){const a={};l&524288&&(a.$$scope={dirty:l,ctx:o}),e.$set(a)},i:function(o){t||(se(e.$$.fragment,o),t=!0)},o:function(o){ie(e.$$.fragment,o),t=!1},d:function(o){ue(e,o)}};return F("SvelteRegisterBlock",{block:i,id:nt.name,type:"else",source:"(332:10) {:else}",ctx:s}),i}function ot(s){let e,t;e=new Se({props:{href:s[8].path,variant:"primary",size:"lg",fullWidth:!0,$$slots:{default:[st]},$$scope:{ctx:s}},$$inline:!0});const i={c:function(){ve(e.$$.fragment)},l:function(o){fe(e.$$.fragment,o)},m:function(o,l){de(e,o,l),t=!0},p:function(o,l){const a={};l&524288&&(a.$$scope={dirty:l,ctx:o}),e.$set(a)},i:function(o){t||(se(e.$$.fragment,o),t=!0)},o:function(o){ie(e.$$.fragment,o),t=!1},d:function(o){ue(e,o)}};return F("SvelteRegisterBlock",{block:i,id:ot.name,type:"if",source:"(323:10) {#if startButtonEnabled}",ctx:s}),i}function it(s){let e;const t={c:function(){e=U("マイクテスト完了後に開始")},l:function(n){e=O(n,"マイクテスト完了後に開始")},m:function(n,o){R(n,e,o)},d:function(n){n&&f(e)}};return F("SvelteRegisterBlock",{block:t,id:it.name,type:"slot",source:'(333:12) <Button                variant=\\"disabled\\"                size=\\"lg\\"                fullWidth                disabled             >',ctx:s}),t}function st(s){let e;const t={c:function(){e=U("トレーニング開始")},l:function(n){e=O(n,"トレーニング開始")},m:function(n,o){R(n,e,o)},d:function(n){n&&f(e)}};return F("SvelteRegisterBlock",{block:t,id:st.name,type:"slot",source:'(324:12) <Button                href={selectedMode.path}                variant=\\"primary\\"                size=\\"lg\\"                fullWidth             >',ctx:s}),t}function lt(s){let e,t,i=s[8].name+"",n,o,l,a=s[8].description+"",v,m,u,g,w;const z=[ot,nt],I=[];function D(b,y){return b[7]?0:1}u=D(s),g=I[u]=z[u](s);const x={c:function(){e=k("div"),t=k("h3"),n=U(i),o=M(),l=k("p"),v=U(a),m=M(),g.c(),this.h()},l:function(y){e=p(y,"DIV",{class:!0});var E=C(e);t=p(E,"H3",{class:!0});var S=C(t);n=O(S,i),S.forEach(f),o=A(E),l=p(E,"P",{class:!0});var q=C(l);v=O(q,a),q.forEach(f),m=A(E),g.l(E),E.forEach(f),this.h()},h:function(){d(t,"class","start-title svelte-167wv5d"),h(t,_,317,10,9496),d(l,"class","start-description svelte-167wv5d"),h(l,_,318,10,9555),d(e,"class","start-content svelte-167wv5d"),h(e,_,316,8,9458)},m:function(y,E){R(y,e,E),c(e,t),c(t,n),c(e,o),c(e,l),c(l,v),c(e,m),I[u].m(e,null),w=!0},p:function(y,E){let S=u;u=D(y),u===S?I[u].p(y,E):(ht(),ie(I[S],1,1,()=>{I[S]=null}),_t(),g=I[u],g?g.p(y,E):(g=I[u]=z[u](y),g.c()),se(g,1),g.m(e,null))},i:function(y){w||(se(g),w=!0)},o:function(y){ie(g),w=!1},d:function(y){y&&f(e),I[u].d()}};return F("SvelteRegisterBlock",{block:x,id:lt.name,type:"slot",source:'(316:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:s}),x}function ct(s){let e,t,i,n,o,l,a,v,m,u,g,w,z="マイクテスト",I,D,x="音感トレーニングを始める前に、マイクの動作を確認します",b,y,E,S,q,H,K;E=new Ce({props:{variant:"default",padding:"lg",$$slots:{default:[tt]},$$scope:{ctx:s}},$$inline:!0}),H=new Ce({props:{variant:"default",padding:"lg",$$slots:{default:[lt]},$$scope:{ctx:s}},$$inline:!0});const W={c:function(){e=k("div"),t=k("div"),i=k("div"),n=k("div"),o=ae("svg"),l=ae("path"),a=ae("path"),v=ae("line"),m=ae("line"),u=M(),g=k("div"),w=k("h1"),w.textContent=z,I=M(),D=k("p"),D.textContent=x,b=M(),y=k("div"),ve(E.$$.fragment),S=M(),q=k("div"),ve(H.$$.fragment),this.h()},l:function(B){e=p(B,"DIV",{class:!0});var P=C(e);t=p(P,"DIV",{class:!0});var Q=C(t);i=p(Q,"DIV",{class:!0});var J=C(i);n=p(J,"DIV",{class:!0});var T=C(n);o=re(T,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var j=C(o);l=re(j,"path",{d:!0}),C(l).forEach(f),a=re(j,"path",{d:!0}),C(a).forEach(f),v=re(j,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),C(v).forEach(f),m=re(j,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),C(m).forEach(f),j.forEach(f),T.forEach(f),u=A(J),g=p(J,"DIV",{});var ne=C(g);w=p(ne,"H1",{class:!0,"data-svelte-h":!0}),$(w)!=="svelte-z7m4lk"&&(w.textContent=z),I=A(ne),D=p(ne,"P",{class:!0,"data-svelte-h":!0}),$(D)!=="svelte-1vtv92f"&&(D.textContent=x),ne.forEach(f),J.forEach(f),Q.forEach(f),b=A(P),y=p(P,"DIV",{class:!0});var Y=C(y);fe(E.$$.fragment,Y),Y.forEach(f),S=A(P),q=p(P,"DIV",{class:!0});var X=C(q);fe(H.$$.fragment,X),X.forEach(f),P.forEach(f),this.h()},h:function(){d(l,"d","M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"),h(l,_,223,12,6196),d(a,"d","M19 10v2a7 7 0 0 1-14 0v-2"),h(a,_,224,12,6273),d(v,"x1","12"),d(v,"x2","12"),d(v,"y1","19"),d(v,"y2","22"),h(v,_,225,12,6324),d(m,"x1","8"),d(m,"x2","16"),d(m,"y1","22"),d(m,"y2","22"),h(m,_,226,12,6376),d(o,"width","48"),d(o,"height","48"),d(o,"viewBox","0 0 24 24"),d(o,"fill","none"),d(o,"stroke","currentColor"),d(o,"stroke-width","2"),h(o,_,222,10,6084),d(n,"class","mic-icon svelte-167wv5d"),h(n,_,221,8,6051),d(w,"class","mic-test-title svelte-167wv5d"),h(w,_,230,10,6471),d(D,"class","mic-test-description svelte-167wv5d"),h(D,_,231,10,6520),h(g,_,229,8,6455),d(i,"class","mic-test-header svelte-167wv5d"),h(i,_,220,6,6013),d(t,"class","header svelte-167wv5d"),h(t,_,219,4,5986),d(y,"class","test-section"),h(y,_,237,4,6653),d(q,"class","start-section"),h(q,_,314,4,9378),d(e,"class","microphone-test svelte-167wv5d"),h(e,_,217,2,5934)},m:function(B,P){R(B,e,P),c(e,t),c(t,i),c(i,n),c(n,o),c(o,l),c(o,a),c(o,v),c(o,m),c(i,u),c(i,g),c(g,w),c(g,I),c(g,D),c(e,b),c(e,y),de(E,y,null),c(e,S),c(e,q),de(H,q,null),K=!0},p:function(B,P){const Q={};P&524415&&(Q.$$scope={dirty:P,ctx:B}),E.$set(Q);const J={};P&524416&&(J.$$scope={dirty:P,ctx:B}),H.$set(J)},i:function(B){K||(se(E.$$.fragment,B),se(H.$$.fragment,B),K=!0)},o:function(B){ie(E.$$.fragment,B),ie(H.$$.fragment,B),K=!1},d:function(B){B&&f(e),ue(E),ue(H)}};return F("SvelteRegisterBlock",{block:W,id:ct.name,type:"slot",source:"(217:0) <PageLayout showBackButton={true}>",ctx:s}),W}function Ee(s){let e,t,i;t=new Ue({props:{showBackButton:!0,$$slots:{default:[ct]},$$scope:{ctx:s}},$$inline:!0});const n={c:function(){e=M(),ve(t.$$.fragment),this.h()},l:function(l){mt("svelte-8st1fo",document.head).forEach(f),e=A(l),fe(t.$$.fragment,l),this.h()},h:function(){document.title="マイクテスト - 相対音感トレーニング"},m:function(l,a){R(l,e,a),de(t,l,a),i=!0},p:function(l,[a]){const v={};a&524543&&(v.$$scope={dirty:a,ctx:l}),t.$set(v)},i:function(l){i||(se(t.$$.fragment,l),i=!0)},o:function(l){ie(t.$$.fragment,l),i=!1},d:function(l){l&&f(e),ue(t,l)}};return F("SvelteRegisterBlock",{block:n,id:Ee.name,type:"component",source:"",ctx:s}),n}function je(s,e){let t=0;for(let a=0;a<s.length;a++)t+=s[a]*s[a];if(t=Math.sqrt(t/s.length),t<.005)return 0;const i=Math.floor(e/800),n=Math.floor(e/80);let o=0,l=0;for(let a=i;a<=n;a++){let v=0,m=0;for(let u=0;u<s.length-a;u++)v+=s[u]*s[u+a],m+=s[u]*s[u];m>0&&(v=v/Math.sqrt(m),v>o&&(o=v,l=a))}return o>.25?e/l:0}function Ge(s){const t=Math.round(12*Math.log2(s/440)),i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=((t+9)%12+12)%12,o=Math.floor((t+9)/12)+4,l=i[n];return`${l}${o}（${{C:"ド","C#":"ド#",D:"レ","D#":"レ#",E:"ミ",F:"ファ","F#":"ファ#",G:"ソ","G#":"ソ#",A:"ラ","A#":"ラ#",B:"シ"}[l]}${o}）`}function gt(s,e,t){let i,n;dt(we,"page"),ft(s,we,r=>t(15,n=r));let{$$slots:o={},$$scope:l}=e;vt("Page",o,[]);let a="random";Le(()=>{n.url.searchParams.has("mode")&&(a=n.url.searchParams.get("mode")||"random")});let v="initial",m=!1,u=!1,g=!1,w=0,z=0,I="",D=null,x=null,b=null,y=null;const E={random:{name:"ランダム基音モード",description:"10種類の基音からランダムに選択してトレーニング",color:"green",path:"./training/random"},continuous:{name:"連続チャレンジモード",description:"選択した回数だけ連続で実行し、総合評価を確認",color:"orange",path:"./training/continuous"},chromatic:{name:"12音階モード",description:"クロマチックスケールの上行・下行で完全制覇",color:"purple",path:"./training/chromatic"}},S=E[a]||E.random;async function q(){t(0,v="pending");try{x=await navigator.mediaDevices.getUserMedia({audio:!0}),t(0,v="granted"),D=new(window.AudioContext||window.webkitAudioContext),D.state==="suspended"&&await D.resume(),b=D.createAnalyser(),b.fftSize=2048,b.smoothingTimeConstant=.8,b.minDecibels=-90,b.maxDecibels=-10,D.createMediaStreamSource(x).connect(b),t(3,m=!0),H()}catch{t(0,v="denied")}}function H(){if(!m||!b)return;const r=b.frequencyBinCount,B=new Uint8Array(r);b.getByteFrequencyData(B);let P=0;for(let j=0;j<B.length;j++)P+=B[j]*B[j];const Q=Math.sqrt(P/B.length);t(4,w=Math.min(100,Q/64*100)),w>15&&t(1,u=!0);const J=new Float32Array(b.fftSize);b.getFloatTimeDomainData(J);const T=je(J,D.sampleRate);T>80&&T<800?(t(5,z=T),t(6,I=Ge(T)),t(2,g=!0)):(t(5,z=0),t(6,I="")),y=requestAnimationFrame(H)}function K(){t(3,m=!1),y&&(cancelAnimationFrame(y),y=null),x&&(x.getTracks().forEach(r=>r.stop()),x=null),D&&D.state!=="closed"&&(D.close(),D=null),b=null}He(()=>{K()});const W=[];return Object.keys(e).forEach(r=>{!~W.indexOf(r)&&r.slice(0,2)!=="$$"&&r!=="slot"&&console.warn(`<Page> was created with unknown prop '${r}'`)}),s.$capture_state=()=>({onMount:Le,onDestroy:He,page:we,Card:Ce,Button:Se,PageLayout:Ue,mode:a,micPermission:v,isListening:m,volumeDetected:u,frequencyDetected:g,currentVolume:w,currentFrequency:z,currentNote:I,audioContext:D,mediaStream:x,analyser:b,animationFrame:y,trainingModes:E,selectedMode:S,requestMicrophone:q,analyzeAudio:H,detectPitch:je,frequencyToNote:Ge,stopListening:K,startButtonEnabled:i,$page:n}),s.$inject_state=r=>{"mode"in r&&(a=r.mode),"micPermission"in r&&t(0,v=r.micPermission),"isListening"in r&&t(3,m=r.isListening),"volumeDetected"in r&&t(1,u=r.volumeDetected),"frequencyDetected"in r&&t(2,g=r.frequencyDetected),"currentVolume"in r&&t(4,w=r.currentVolume),"currentFrequency"in r&&t(5,z=r.currentFrequency),"currentNote"in r&&t(6,I=r.currentNote),"audioContext"in r&&(D=r.audioContext),"mediaStream"in r&&(x=r.mediaStream),"analyser"in r&&(b=r.analyser),"animationFrame"in r&&(y=r.animationFrame),"startButtonEnabled"in r&&t(7,i=r.startButtonEnabled)},e&&"$$inject"in e&&s.$inject_state(e.$$inject),s.$$.update=()=>{s.$$.dirty&7&&t(7,i=v==="granted"&&u&&g)},[v,u,g,m,w,z,I,i,S,q]}class wt extends rt{constructor(e){super(e),at(this,e,gt,Ee,ut,{}),F("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:Ee.name})}}export{wt as component};
