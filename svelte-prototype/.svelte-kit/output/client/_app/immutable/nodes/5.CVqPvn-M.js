const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/C9IaLGyK.js","../chunks/DXfV3yLF.js","../chunks/BnpKoSs-.js","../chunks/D0QH3NT1.js","../chunks/BC1mTojB.js","../assets/sessionStorage.2zs4CtXT.css"])))=>i.map(i=>d[i]);
import{_ as Dn}from"../chunks/C1FmrZbK.js";import{S as po,i as vo,d as ee,s as _o,v as Ae,c as Te,a as So,H as kn,V as Fn,b as p,q as fe,r as X,u as j,f as W,w as de,I as bo,m as Z,x as me,p as $,y as ge,J as qo,K as Ie,L as Me,g,z as P,h as C,M as Ke,j as R,k as L,A as ve,l as G,N as ze,o as N,t as U,e as Fe,Q as lt,n as Cn,R as xn}from"../chunks/DXfV3yLF.js";import{g as wo}from"../chunks/D0QH3NT1.js";import"../chunks/BnpKoSs-.js";import{b as it,g as vt}from"../chunks/BC1mTojB.js";import{p as _t}from"../chunks/B1TmIwH2.js";import{P as Bn,B as ut,C as Qe}from"../chunks/CrwomGmF.js";import{l as se,a as Ue,h as St,P as Vn,b as Hn,V as Do}from"../chunks/BRZWrjh2.js";import{l as bt,s as tt,c as ko,r as Fo,a as Rn,u as qt,b as Co,d as wt,p as Ro,o as No,e as Ao,f as Dt,i as kt,g as To,h as Ft,n as Ct,j as Rt,k as Nt,t as At,E as Nn,m as nt,A as Qt,U as Xt,S as Io,F as Mo,C as Eo,I as Po,q as xo,T as Bo,P as Vo,M as zn,v as Ho,w as zo,x as Tt}from"../chunks/C9IaLGyK.js";const jo=!1,Lo=!1,nr=Object.freeze(Object.defineProperty({__proto__:null,prerender:Lo,ssr:jo},Symbol.toStringTag,{value:"Module"})),{Object:Oo,console:Go,document:An}=wo,A="src/routes/training/continuous/+page.svelte";function Tn(r,t,e){const i=r.slice();return i[98]=t[e],i[100]=e,i}function In(r,t,e){const i=r.slice();return i[101]=t[e],i}function Et(r){var B,w;let t,e,i,c,n,a,s,f,l,m,d=(((B=r[24])==null?void 0:B.length)||0)+"",y,b,h,v,x,Y,k,D,H=Math.round((((w=r[24])==null?void 0:w.length)||0)/8*100)+"",E,J,F,_,K,T=r[0]==="results"&&Pt(r);const q={c:function(){t=N("div"),e=N("div"),i=N("div"),c=N("span"),n=U("セッション "),a=U(r[23]),s=U("/8"),f=$(),l=N("span"),m=U("完了済み "),y=U(d),b=U("セッション"),h=$(),v=N("div"),x=N("div"),Y=N("div"),k=$(),D=N("span"),E=U(H),J=U("%"),F=$(),T&&T.c(),_=ze(),this.h()},l:function(M){t=R(M,"DIV",{class:!0});var Q=L(t);e=R(Q,"DIV",{class:!0});var ye=L(e);i=R(ye,"DIV",{class:!0});var ne=L(i);c=R(ne,"SPAN",{class:!0});var _e=L(c);n=G(_e,"セッション "),a=G(_e,r[23]),s=G(_e,"/8"),_e.forEach(p),f=Z(ne),l=R(ne,"SPAN",{class:!0});var Se=L(l);m=G(Se,"完了済み "),y=G(Se,d),b=G(Se,"セッション"),Se.forEach(p),ne.forEach(p),h=Z(ye),v=R(ye,"DIV",{class:!0});var Ee=L(v);x=R(Ee,"DIV",{class:!0});var je=L(x);Y=R(je,"DIV",{class:!0,style:!0}),L(Y).forEach(p),je.forEach(p),k=Z(Ee),D=R(Ee,"SPAN",{class:!0});var Ve=L(D);E=G(Ve,H),J=G(Ve,"%"),Ve.forEach(p),Ee.forEach(p),ye.forEach(p),Q.forEach(p),F=Z(M),T&&T.l(M),_=ze(),this.h()},h:function(){var M;P(c,"class","completed-count svelte-rt5px1"),C(c,A,2523,12,85430),P(l,"class","remaining-text svelte-rt5px1"),C(l,A,2524,12,85507),P(i,"class","session-info svelte-rt5px1"),C(i,A,2522,10,85391),P(Y,"class","progress-fill svelte-rt5px1"),Ke(Y,"width",(((M=r[24])==null?void 0:M.length)||0)/8*100+"%"),C(Y,A,2528,14,85695),P(x,"class","progress-bar svelte-rt5px1"),C(x,A,2527,12,85654),P(D,"class","progress-text svelte-rt5px1"),C(D,A,2530,12,85821),P(v,"class","progress-section svelte-rt5px1"),C(v,A,2526,10,85611),P(e,"class","session-status svelte-rt5px1"),C(e,A,2521,8,85352),P(t,"class","session-progress svelte-rt5px1"),C(t,A,2520,6,85313)},m:function(M,Q){W(M,t,Q),g(t,e),g(e,i),g(i,c),g(c,n),g(c,a),g(c,s),g(i,f),g(i,l),g(l,m),g(l,y),g(l,b),g(e,h),g(e,v),g(v,x),g(x,Y),g(v,k),g(v,D),g(D,E),g(D,J),W(M,F,Q),T&&T.m(M,Q),W(M,_,Q),K=!0},p:function(M,Q){var ye,ne,_e;(!K||Q[0]&8388608)&&Fe(a,M[23]),(!K||Q[0]&16777216)&&d!==(d=(((ye=M[24])==null?void 0:ye.length)||0)+"")&&Fe(y,d),(!K||Q[0]&16777216)&&Ke(Y,"width",(((ne=M[24])==null?void 0:ne.length)||0)/8*100+"%"),(!K||Q[0]&16777216)&&H!==(H=Math.round((((_e=M[24])==null?void 0:_e.length)||0)/8*100)+"")&&Fe(E,H),M[0]==="results"?T?(T.p(M,Q),Q[0]&1&&j(T,1)):(T=Pt(M),T.c(),j(T,1),T.m(_.parentNode,_)):T&&(Ie(),X(T,1,1,()=>{T=null}),Me())},i:function(M){K||(j(T),K=!0)},o:function(M){X(T),K=!1},d:function(M){M&&(p(t),p(F),p(_)),T&&T.d(M)}};return ee("SvelteRegisterBlock",{block:q,id:Et.name,type:"if",source:"(2520:4) {#if microphoneState === 'granted' && !$isLoading}",ctx:r}),q}function Pt(r){let t,e,i;e=new Qt({props:{isCompleted:r[5],position:"top"},$$inline:!0}),e.$on("action",r[29]);const c={c:function(){t=N("div"),ge(e.$$.fragment),this.h()},l:function(a){t=R(a,"DIV",{class:!0});var s=L(t);me(e.$$.fragment,s),s.forEach(p),this.h()},h:function(){P(t,"class","top-action-buttons svelte-rt5px1"),C(t,A,2538,8,86060)},m:function(a,s){W(a,t,s),de(e,t,null),i=!0},p:function(a,s){const f={};s[0]&32&&(f.isCompleted=a[5]),e.$set(f)},i:function(a){i||(j(e.$$.fragment,a),i=!0)},o:function(a){X(e.$$.fragment,a),i=!1},d:function(a){a&&p(t),fe(e)}};return ee("SvelteRegisterBlock",{block:c,id:Pt.name,type:"if",source:"(2538:6) {#if trainingPhase === 'results'}",ctx:r}),c}function jn(r){let t,e;t=new Qe({props:{class:"error-card",$$slots:{default:[Un]},$$scope:{ctx:r}},$$inline:!0});const i={c:function(){ge(t.$$.fragment)},l:function(n){me(t.$$.fragment,n)},m:function(n,a){de(t,n,a),e=!0},p:function(n,a){const s={};a[3]&2048&&(s.$$scope={dirty:a,ctx:n}),t.$set(s)},i:function(n){e||(j(t.$$.fragment,n),e=!0)},o:function(n){X(t.$$.fragment,n),e=!1},d:function(n){fe(t,n)}};return ee("SvelteRegisterBlock",{block:i,id:jn.name,type:"else",source:"(2746:2) {:else}",ctx:r}),i}function Ln(r){let t,e,i,c,n,a,s,f={isActive:r[1]==="granted",trainingPhase:r[0],className:"pitch-detector-content",debugMode:!0,disableHarmonicCorrection:!1};e=new Hn({props:f,$$inline:!0}),r[34](e),e.$on("pitchUpdate",r[28]),e.$on("stateChange",so),e.$on("error",co),e.$on("microphoneHealthChange",r[31]);let l=r[0]!=="results"&&xt(r),m=r[0]!=="results"&&zt(r),d=r[0]==="results"&&Ot(r);const y={c:function(){t=N("div"),ge(e.$$.fragment),i=$(),l&&l.c(),c=$(),m&&m.c(),n=$(),d&&d.c(),a=ze(),this.h()},l:function(h){t=R(h,"DIV",{style:!0});var v=L(t);me(e.$$.fragment,v),v.forEach(p),i=Z(h),l&&l.l(h),c=Z(h),m&&m.l(h),n=Z(h),d&&d.l(h),a=ze(),this.h()},h:function(){Ke(t,"display","none"),C(t,A,2557,4,86540)},m:function(h,v){W(h,t,v),de(e,t,null),W(h,i,v),l&&l.m(h,v),W(h,c,v),m&&m.m(h,v),W(h,n,v),d&&d.m(h,v),W(h,a,v),s=!0},p:function(h,v){const x={};v[0]&2&&(x.isActive=h[1]==="granted"),v[0]&1&&(x.trainingPhase=h[0]),e.$set(x),h[0]!=="results"?l?(l.p(h,v),v[0]&1&&j(l,1)):(l=xt(h),l.c(),j(l,1),l.m(c.parentNode,c)):l&&(Ie(),X(l,1,1,()=>{l=null}),Me()),h[0]!=="results"?m?(m.p(h,v),v[0]&1&&j(m,1)):(m=zt(h),m.c(),j(m,1),m.m(n.parentNode,n)):m&&(Ie(),X(m,1,1,()=>{m=null}),Me()),h[0]==="results"?d?(d.p(h,v),v[0]&1&&j(d,1)):(d=Ot(h),d.c(),j(d,1),d.m(a.parentNode,a)):d&&(Ie(),X(d,1,1,()=>{d=null}),Me())},i:function(h){s||(j(e.$$.fragment,h),j(l),j(m),j(d),s=!0)},o:function(h){X(e.$$.fragment,h),X(l),X(m),X(d),s=!1},d:function(h){h&&(p(t),p(i),p(c),p(n),p(a)),r[34](null),fe(e),l&&l.d(h),m&&m.d(h),d&&d.d(h)}};return ee("SvelteRegisterBlock",{block:y,id:Ln.name,type:"if",source:"(2556:2) {#if microphoneState === 'granted'}",ctx:r}),y}function On(r){let t;const e={c:function(){t=U("🎤 マイクテストページへ移動")},l:function(c){t=G(c,"🎤 マイクテストページへ移動")},m:function(c,n){W(c,t,n)},d:function(c){c&&p(t)}};return ee("SvelteRegisterBlock",{block:e,id:On.name,type:"slot",source:'(2760:10) <Button variant=\\"primary\\" on:click={goToMicrophoneTest}>',ctx:r}),e}function Gn(r){let t;const e={c:function(){t=U("🏠 ホームに戻る")},l:function(c){t=G(c,"🏠 ホームに戻る")},m:function(c,n){W(c,t,n)},d:function(c){c&&p(t)}};return ee("SvelteRegisterBlock",{block:e,id:Gn.name,type:"slot",source:'(2763:10) <Button variant=\\"secondary\\" on:click={goHome}>',ctx:r}),e}function Un(r){let t,e,i="🎤",c,n,a="マイクテストが必要です",s,f,l="連続チャレンジモードを開始する前に、マイクテストページで音声入力の確認をお願いします。",m,d,y,b,h,v="マイクテスト完了後",x,Y,k,D="まずはマイクテストページで音声確認を行ってください。",H,E,J,F,_,K;J=new ut({props:{variant:"primary",$$slots:{default:[On]},$$scope:{ctx:r}},$$inline:!0}),J.$on("click",r[26]),_=new ut({props:{variant:"secondary",$$slots:{default:[Gn]},$$scope:{ctx:r}},$$inline:!0}),_.$on("click",r[27]);const T={c:function(){t=N("div"),e=N("div"),e.textContent=i,c=$(),n=N("h3"),n.textContent=a,s=$(),f=N("p"),f.textContent=l,m=$(),d=N("div"),y=N("p"),b=U("このページは"),h=N("strong"),h.textContent=v,x=U("にご利用いただけます。"),Y=$(),k=N("p"),k.textContent=D,H=$(),E=N("div"),ge(J.$$.fragment),F=$(),ge(_.$$.fragment),this.h()},l:function(B){t=R(B,"DIV",{class:!0});var w=L(t);e=R(w,"DIV",{class:!0,"data-svelte-h":!0}),ve(e)!=="svelte-15rbx8n"&&(e.textContent=i),c=Z(w),n=R(w,"H3",{class:!0,"data-svelte-h":!0}),ve(n)!=="svelte-17kvze2"&&(n.textContent=a),s=Z(w),f=R(w,"P",{class:!0,"data-svelte-h":!0}),ve(f)!=="svelte-1t09god"&&(f.textContent=l),m=Z(w),d=R(w,"DIV",{class:!0});var V=L(d);y=R(V,"P",{class:!0});var M=L(y);b=G(M,"このページは"),h=R(M,"STRONG",{"data-svelte-h":!0}),ve(h)!=="svelte-1n3qsr6"&&(h.textContent=v),x=G(M,"にご利用いただけます。"),M.forEach(p),Y=Z(V),k=R(V,"P",{class:!0,"data-svelte-h":!0}),ve(k)!=="svelte-v8nd09"&&(k.textContent=D),V.forEach(p),H=Z(w),E=R(w,"DIV",{class:!0});var Q=L(E);me(J.$$.fragment,Q),F=Z(Q),me(_.$$.fragment,Q),Q.forEach(p),w.forEach(p),this.h()},h:function(){P(e,"class","error-icon svelte-rt5px1"),C(e,A,2749,8,92940),P(n,"class","svelte-rt5px1"),C(n,A,2750,8,92981),P(f,"class","svelte-rt5px1"),C(f,A,2751,8,93010),C(h,A,2754,19,93126),P(y,"class","svelte-rt5px1"),C(y,A,2754,10,93117),P(k,"class","svelte-rt5px1"),C(k,A,2755,10,93178),P(d,"class","recommendation svelte-rt5px1"),C(d,A,2753,8,93078),P(E,"class","action-buttons"),C(E,A,2758,8,93244),P(t,"class","error-content svelte-rt5px1"),C(t,A,2748,6,92904)},m:function(B,w){W(B,t,w),g(t,e),g(t,c),g(t,n),g(t,s),g(t,f),g(t,m),g(t,d),g(d,y),g(y,b),g(y,h),g(y,x),g(d,Y),g(d,k),g(t,H),g(t,E),de(J,E,null),g(E,F),de(_,E,null),K=!0},p:function(B,w){const V={};w[3]&2048&&(V.$$scope={dirty:w,ctx:B}),J.$set(V);const M={};w[3]&2048&&(M.$$scope={dirty:w,ctx:B}),_.$set(M)},i:function(B){K||(j(J.$$.fragment,B),j(_.$$.fragment,B),K=!0)},o:function(B){X(J.$$.fragment,B),X(_.$$.fragment,B),K=!1},d:function(B){B&&p(t),fe(J),fe(_)}};return ee("SvelteRegisterBlock",{block:T,id:Un.name,type:"slot",source:'(2748:4) <Card class=\\"error-card\\">',ctx:r}),T}function xt(r){let t,e,i,c,n,a,s=!r[2]&&r[6].length>0&&Bt(r);i=new Qe({props:{class:"main-card half-width",$$slots:{default:[eo]},$$scope:{ctx:r}},$$inline:!0}),n=new Vn({props:{frequency:r[14],note:r[15],volume:r[13],isMuted:r[0]!=="guiding",muteMessage:"基音再生後に開始",className:"half-width",showGuidance:!1},$$inline:!0});const f={c:function(){s&&s.c(),t=$(),e=N("div"),ge(i.$$.fragment),c=$(),ge(n.$$.fragment),this.h()},l:function(m){s&&s.l(m),t=Z(m),e=R(m,"DIV",{class:!0});var d=L(e);me(i.$$.fragment,d),c=Z(d),me(n.$$.fragment,d),d.forEach(p),this.h()},h:function(){P(e,"class","side-by-side-container svelte-rt5px1"),C(e,A,2596,6,87877)},m:function(m,d){s&&s.m(m,d),W(m,t,d),W(m,e,d),de(i,e,null),g(e,c),de(n,e,null),a=!0},p:function(m,d){!m[2]&&m[6].length>0?s?(s.p(m,d),d[0]&68&&j(s,1)):(s=Bt(m),s.c(),j(s,1),s.m(t.parentNode,t)):s&&(Ie(),X(s,1,1,()=>{s=null}),Me());const y={};d[0]&8395649|d[3]&2048&&(y.$$scope={dirty:d,ctx:m}),i.$set(y);const b={};d[0]&16384&&(b.frequency=m[14]),d[0]&32768&&(b.note=m[15]),d[0]&8192&&(b.volume=m[13]),d[0]&1&&(b.isMuted=m[0]!=="guiding"),n.$set(b)},i:function(m){a||(j(s),j(i.$$.fragment,m),j(n.$$.fragment,m),a=!0)},o:function(m){X(s),X(i.$$.fragment,m),X(n.$$.fragment,m),a=!1},d:function(m){m&&(p(t),p(e)),s&&s.d(m),fe(i),fe(n)}};return ee("SvelteRegisterBlock",{block:f,id:xt.name,type:"if",source:"(2575:4) {#if trainingPhase !== 'results'}",ctx:r}),f}function Bt(r){let t,e;t=new Qe({props:{class:"warning-card",$$slots:{default:[Wn]},$$scope:{ctx:r}},$$inline:!0});const i={c:function(){ge(t.$$.fragment)},l:function(n){me(t.$$.fragment,n)},m:function(n,a){de(t,n,a),e=!0},p:function(n,a){const s={};a[0]&64|a[3]&2048&&(s.$$scope={dirty:a,ctx:n}),t.$set(s)},i:function(n){e||(j(t.$$.fragment,n),e=!0)},o:function(n){X(t.$$.fragment,n),e=!1},d:function(n){fe(t,n)}};return ee("SvelteRegisterBlock",{block:i,id:Bt.name,type:"if",source:"(2578:6) {#if !microphoneHealthy && microphoneErrors.length > 0}",ctx:r}),i}function Vt(r){let t,e=r[101]+"",i;const c={c:function(){t=N("li"),i=U(e),this.h()},l:function(a){t=R(a,"LI",{class:!0});var s=L(t);i=G(s,e),s.forEach(p),this.h()},h:function(){P(t,"class","svelte-rt5px1"),C(t,A,2586,16,87645)},m:function(a,s){W(a,t,s),g(t,i)},p:function(a,s){s[0]&64&&e!==(e=a[101]+"")&&Fe(i,e)},d:function(a){a&&p(t)}};return ee("SvelteRegisterBlock",{block:c,id:Vt.name,type:"each",source:"(2586:14) {#each microphoneErrors as error}",ctx:r}),c}function Wn(r){let t,e,i="⚠️ マイク接続に問題があります",c,n,a,s="マイクが正常に動作していません。以下の問題が検出されました：",f,l,m,d,y,b="解決方法:",h,v=lt(r[6]),x=[];for(let k=0;k<v.length;k+=1)x[k]=Vt(In(r,v,k));const Y={c:function(){t=N("div"),e=N("h3"),e.textContent=i,c=$(),n=N("div"),a=N("p"),a.textContent=s,f=$(),l=N("ul");for(let D=0;D<x.length;D+=1)x[D].c();m=$(),d=N("p"),y=N("strong"),y.textContent=b,h=U(" ページを再読み込みしてマイク許可を再度取得してください。"),this.h()},l:function(D){t=R(D,"DIV",{class:!0});var H=L(t);e=R(H,"H3",{class:!0,"data-svelte-h":!0}),ve(e)!=="svelte-15qec5x"&&(e.textContent=i),H.forEach(p),c=Z(D),n=R(D,"DIV",{class:!0});var E=L(n);a=R(E,"P",{class:!0,"data-svelte-h":!0}),ve(a)!=="svelte-171o2p0"&&(a.textContent=s),f=Z(E),l=R(E,"UL",{class:!0});var J=L(l);for(let _=0;_<x.length;_+=1)x[_].l(J);J.forEach(p),m=Z(E),d=R(E,"P",{class:!0});var F=L(d);y=R(F,"STRONG",{"data-svelte-h":!0}),ve(y)!=="svelte-79o66n"&&(y.textContent=b),h=G(F," ページを再読み込みしてマイク許可を再度取得してください。"),F.forEach(p),E.forEach(p),this.h()},h:function(){P(e,"class","section-title svelte-rt5px1"),C(e,A,2580,12,87369),P(t,"class","card-header svelte-rt5px1"),C(t,A,2579,10,87331),P(a,"class","warning-message svelte-rt5px1"),C(a,A,2583,12,87483),P(l,"class","error-list svelte-rt5px1"),C(l,A,2584,12,87557),C(y,A,2590,14,87756),P(d,"class","fix-instruction svelte-rt5px1"),C(d,A,2589,12,87714),P(n,"class","card-content svelte-rt5px1"),C(n,A,2582,10,87444)},m:function(D,H){W(D,t,H),g(t,e),W(D,c,H),W(D,n,H),g(n,a),g(n,f),g(n,l);for(let E=0;E<x.length;E+=1)x[E]&&x[E].m(l,null);g(n,m),g(n,d),g(d,y),g(d,h)},p:function(D,H){if(H[0]&64){v=lt(D[6]);let E;for(E=0;E<v.length;E+=1){const J=In(D,v,E);x[E]?x[E].p(J,H):(x[E]=Vt(J),x[E].c(),x[E].m(l,null))}for(;E<x.length;E+=1)x[E].d(1);x.length=v.length}},d:function(D){D&&(p(t),p(c),p(n)),xn(x,D)}};return ee("SvelteRegisterBlock",{block:Y,id:Wn.name,type:"slot",source:'(2579:8) <Card class=\\"warning-card\\">',ctx:r}),Y}function Jn(r){let t;function e(a,s){return a[9]?Zn:a[0]==="guiding"?Yn:a[0]==="results"?Xn:Qn}let i=e(r),c=i(r);const n={c:function(){t=N("div"),c.c(),this.h()},l:function(s){t=R(s,"DIV",{class:!0});var f=L(t);c.l(f),f.forEach(p),this.h()},h:function(){P(t,"class","continuous-status svelte-rt5px1"),C(t,A,2613,14,88526)},m:function(s,f){W(s,t,f),c.m(t,null)},p:function(s,f){i===(i=e(s))&&c?c.p(s,f):(c.d(1),c=i(s),c&&(c.c(),c.m(t,null)))},i:Cn,o:Cn,d:function(s){s&&p(t),c.d()}};return ee("SvelteRegisterBlock",{block:n,id:Jn.name,type:"else",source:"(2612:12) {:else}",ctx:r}),n}function Kn(r){let t,e;t=new ut({props:{variant:"primary",$$slots:{default:[$n]},$$scope:{ctx:r}},$$inline:!0}),t.$on("click",r[30]);const i={c:function(){ge(t.$$.fragment)},l:function(n){me(t.$$.fragment,n)},m:function(n,a){de(t,n,a),e=!0},p:function(n,a){const s={};a[3]&2048&&(s.$$scope={dirty:a,ctx:n}),t.$set(s)},i:function(n){e||(j(t.$$.fragment,n),e=!0)},o:function(n){X(t.$$.fragment,n),e=!1},d:function(n){fe(t,n)}};return ee("SvelteRegisterBlock",{block:i,id:Kn.name,type:"if",source:"(2605:12) {#if trainingPhase === 'setup' && !isPlaying && !($currentSessionId > 1)}",ctx:r}),i}function Qn(r){let t,e,i,c;const n={c:function(){t=N("div"),e=U("⚡ 連続モード進行中 ("),i=U(r[23]),c=U("/8)"),this.h()},l:function(s){t=R(s,"DIV",{class:!0});var f=L(t);e=G(f,"⚡ 連続モード進行中 ("),i=G(f,r[23]),c=G(f,"/8)"),f.forEach(p),this.h()},h:function(){P(t,"class","status-text svelte-rt5px1"),C(t,A,2627,18,89116)},m:function(s,f){W(s,t,f),g(t,e),g(t,i),g(t,c)},p:function(s,f){f[0]&8388608&&Fe(i,s[23])},d:function(s){s&&p(t)}};return ee("SvelteRegisterBlock",{block:n,id:Qn.name,type:"else",source:"(2627:16) {:else}",ctx:r}),n}function Xn(r){let t,e,i,c;const n={c:function(){t=N("div"),e=U("✅ セッション "),i=U(r[23]),c=U("/8 完了"),this.h()},l:function(s){t=R(s,"DIV",{class:!0});var f=L(t);e=G(f,"✅ セッション "),i=G(f,r[23]),c=G(f,"/8 完了"),f.forEach(p),this.h()},h:function(){P(t,"class","status-text svelte-rt5px1"),C(t,A,2623,18,88970)},m:function(s,f){W(s,t,f),g(t,e),g(t,i),g(t,c)},p:function(s,f){f[0]&8388608&&Fe(i,s[23])},d:function(s){s&&p(t)}};return ee("SvelteRegisterBlock",{block:n,id:Xn.name,type:"if",source:"(2623:54) ",ctx:r}),n}function Yn(r){let t,e,i,c;const n={c:function(){t=N("div"),e=U("🎤 セッション "),i=U(r[23]),c=U("/8: ドレミ発声中"),this.h()},l:function(s){t=R(s,"DIV",{class:!0});var f=L(t);e=G(f,"🎤 セッション "),i=G(f,r[23]),c=G(f,"/8: ドレミ発声中"),f.forEach(p),this.h()},h:function(){P(t,"class","status-text svelte-rt5px1"),C(t,A,2619,18,88787)},m:function(s,f){W(s,t,f),g(t,e),g(t,i),g(t,c)},p:function(s,f){f[0]&8388608&&Fe(i,s[23])},d:function(s){s&&p(t)}};return ee("SvelteRegisterBlock",{block:n,id:Yn.name,type:"if",source:"(2619:54) ",ctx:r}),n}function Zn(r){let t,e,i,c;const n={c:function(){t=N("div"),e=U("🎵 基音 "),i=U(r[23]),c=U("/8 再生中..."),this.h()},l:function(s){t=R(s,"DIV",{class:!0});var f=L(t);e=G(f,"🎵 基音 "),i=G(f,r[23]),c=G(f,"/8 再生中..."),f.forEach(p),this.h()},h:function(){P(t,"class","status-text svelte-rt5px1"),C(t,A,2615,18,88608)},m:function(s,f){W(s,t,f),g(t,e),g(t,i),g(t,c)},p:function(s,f){f[0]&8388608&&Fe(i,s[23])},d:function(s){s&&p(t)}};return ee("SvelteRegisterBlock",{block:n,id:Zn.name,type:"if",source:"(2615:16) {#if isPlaying}",ctx:r}),n}function $n(r){let t;const e={c:function(){t=U("⚡ 連続チャレンジ開始（8セッション）")},l:function(c){t=G(c,"⚡ 連続チャレンジ開始（8セッション）")},m:function(c,n){W(c,t,n)},d:function(c){c&&p(t)}};return ee("SvelteRegisterBlock",{block:e,id:$n.name,type:"slot",source:'(2606:14) <Button                  variant=\\"primary\\"                 on:click={startContinuousMode}               >',ctx:r}),e}function Ht(r){let t,e,i,c,n,a=r[8].toFixed(1)+"",s,f;const l={c:function(){t=N("div"),e=U("現在の基音: "),i=N("strong"),c=U(r[7]),n=U(" ("),s=U(a),f=U("Hz)"),this.h()},l:function(d){t=R(d,"DIV",{class:!0});var y=L(t);e=G(y,"現在の基音: "),i=R(y,"STRONG",{});var b=L(i);c=G(b,r[7]),b.forEach(p),n=G(y," ("),s=G(y,a),f=G(y,"Hz)"),y.forEach(p),this.h()},h:function(){C(i,A,2636,23,89396),P(t,"class","base-note-info svelte-rt5px1"),C(t,A,2635,14,89344)},m:function(d,y){W(d,t,y),g(t,e),g(t,i),g(i,c),g(t,n),g(t,s),g(t,f)},p:function(d,y){y[0]&128&&Fe(c,d[7]),y[0]&256&&a!==(a=d[8].toFixed(1)+"")&&Fe(s,a)},d:function(d){d&&p(t)}};return ee("SvelteRegisterBlock",{block:l,id:Ht.name,type:"if",source:"(2635:12) {#if currentBaseNote}",ctx:r}),l}function eo(r){let t,e,i="🎹 基音再生",c,n,a,s,f,l,m,d,y="ガイド開始まで",b,h,v,x,Y,k,D,H;const E=[Kn,Jn],J=[];function F(T,q){return T[0]==="setup"&&!T[9]&&!(T[23]>1)?0:1}a=F(r),s=J[a]=E[a](r);let _=r[7]&&Ht(r);k=new zn({props:{size:"20"},$$inline:!0});const K={c:function(){t=N("div"),e=N("h3"),e.textContent=i,c=$(),n=N("div"),s.c(),f=$(),_&&_.c(),l=$(),m=N("div"),d=N("div"),d.textContent=y,b=$(),h=N("div"),v=N("div"),x=$(),Y=N("div"),ge(k.$$.fragment),this.h()},l:function(q){t=R(q,"DIV",{class:!0});var B=L(t);e=R(B,"H3",{class:!0,"data-svelte-h":!0}),ve(e)!=="svelte-syc53b"&&(e.textContent=i),B.forEach(p),c=Z(q),n=R(q,"DIV",{class:!0});var w=L(n);s.l(w),f=Z(w),_&&_.l(w),l=Z(w),m=R(w,"DIV",{class:!0});var V=L(m);d=R(V,"DIV",{class:!0,"data-svelte-h":!0}),ve(d)!=="svelte-1dufnpv"&&(d.textContent=y),b=Z(V),h=R(V,"DIV",{class:!0});var M=L(h);v=R(M,"DIV",{class:!0,style:!0}),L(v).forEach(p),x=Z(M),Y=R(M,"DIV",{class:!0});var Q=L(Y);me(k.$$.fragment,Q),Q.forEach(p),M.forEach(p),V.forEach(p),w.forEach(p),this.h()},h:function(){P(e,"class","section-title svelte-rt5px1"),C(e,A,2600,12,88041),P(t,"class","card-header svelte-rt5px1"),C(t,A,2599,10,88003),P(d,"class","guide-start-label svelte-rt5px1"),C(d,A,2642,14,89621),P(v,"class","guide-progress-fill svelte-rt5px1"),Ke(v,"width",r[11]+"%"),C(v,A,2644,16,89726),P(Y,"class",D="guide-music-icon "+(r[12]?"glowing":"")+" svelte-rt5px1"),C(Y,A,2648,16,89874),P(h,"class","guide-start-bar svelte-rt5px1"),C(h,A,2643,14,89680),P(m,"class","guide-start-bar-container svelte-rt5px1"),C(m,A,2641,12,89567),P(n,"class","card-content svelte-rt5px1"),C(n,A,2602,10,88107)},m:function(q,B){W(q,t,B),g(t,e),W(q,c,B),W(q,n,B),J[a].m(n,null),g(n,f),_&&_.m(n,null),g(n,l),g(n,m),g(m,d),g(m,b),g(m,h),g(h,v),g(h,x),g(h,Y),de(k,Y,null),H=!0},p:function(q,B){let w=a;a=F(q),a===w?J[a].p(q,B):(Ie(),X(J[w],1,1,()=>{J[w]=null}),Me(),s=J[a],s?s.p(q,B):(s=J[a]=E[a](q),s.c()),j(s,1),s.m(n,f)),q[7]?_?_.p(q,B):(_=Ht(q),_.c(),_.m(n,l)):_&&(_.d(1),_=null),(!H||B[0]&2048)&&Ke(v,"width",q[11]+"%"),(!H||B[0]&4096&&D!==(D="guide-music-icon "+(q[12]?"glowing":"")+" svelte-rt5px1"))&&P(Y,"class",D)},i:function(q){H||(j(s),j(k.$$.fragment,q),H=!0)},o:function(q){X(s),X(k.$$.fragment,q),H=!1},d:function(q){q&&(p(t),p(c),p(n)),J[a].d(),_&&_.d(),fe(k)}};return ee("SvelteRegisterBlock",{block:K,id:eo.name,type:"slot",source:'(2599:8) <Card class=\\"main-card half-width\\">',ctx:r}),K}function zt(r){let t,e;t=new Qe({props:{class:"main-card",$$slots:{default:[to]},$$scope:{ctx:r}},$$inline:!0});const i={c:function(){ge(t.$$.fragment)},l:function(n){me(t.$$.fragment,n)},m:function(n,a){de(t,n,a),e=!0},p:function(n,a){const s={};a[0]&1025|a[3]&2048&&(s.$$scope={dirty:a,ctx:n}),t.$set(s)},i:function(n){e||(j(t.$$.fragment,n),e=!0)},o:function(n){X(t.$$.fragment,n),e=!1},d:function(n){fe(t,n)}};return ee("SvelteRegisterBlock",{block:i,id:zt.name,type:"if",source:"(2670:4) {#if trainingPhase !== 'results'}",ctx:r}),i}function jt(r){let t,e=r[98].name+"",i,c,n;const a={c:function(){t=N("div"),i=U(e),c=$(),this.h()},l:function(f){t=R(f,"DIV",{class:!0});var l=L(t);i=G(l,e),c=Z(l),l.forEach(p),this.h()},h:function(){P(t,"class",n="scale-item "+r[98].state+" svelte-rt5px1"),C(t,A,2678,14,90776)},m:function(f,l){W(f,t,l),g(t,i),g(t,c)},p:function(f,l){l[0]&1024&&e!==(e=f[98].name+"")&&Fe(i,e),l[0]&1024&&n!==(n="scale-item "+f[98].state+" svelte-rt5px1")&&P(t,"class",n)},d:function(f){f&&p(t)}};return ee("SvelteRegisterBlock",{block:a,id:jt.name,type:"each",source:"(2678:12) {#each scaleSteps as step, index}",ctx:r}),a}function Lt(r){let t,e,i,c="ドレミファソラシド",n;const a={c:function(){t=N("div"),e=U("ガイドに合わせて "),i=N("strong"),i.textContent=c,n=U(" を歌ってください"),this.h()},l:function(f){t=R(f,"DIV",{class:!0});var l=L(t);e=G(l,"ガイドに合わせて "),i=R(l,"STRONG",{"data-svelte-h":!0}),ve(i)!=="svelte-1dipf74"&&(i.textContent=c),n=G(l," を歌ってください"),l.forEach(p),this.h()},h:function(){C(i,A,2687,23,91043),P(t,"class","guide-instruction svelte-rt5px1"),C(t,A,2686,12,90988)},m:function(f,l){W(f,t,l),g(t,e),g(t,i),g(t,n)},d:function(f){f&&p(t)}};return ee("SvelteRegisterBlock",{block:a,id:Lt.name,type:"if",source:"(2686:10) {#if trainingPhase === 'guiding'}",ctx:r}),a}function to(r){let t,e,i="🎵 ドレミ音階ガイド",c,n,a,s,f=lt(r[10]),l=[];for(let y=0;y<f.length;y+=1)l[y]=jt(Tn(r,f,y));let m=r[0]==="guiding"&&Lt(r);const d={c:function(){t=N("div"),e=N("h3"),e.textContent=i,c=$(),n=N("div"),a=N("div");for(let b=0;b<l.length;b+=1)l[b].c();s=$(),m&&m.c(),this.h()},l:function(b){t=R(b,"DIV",{class:!0});var h=L(t);e=R(h,"H3",{class:!0,"data-svelte-h":!0}),ve(e)!=="svelte-1mor0as"&&(e.textContent=i),h.forEach(p),c=Z(b),n=R(b,"DIV",{class:!0});var v=L(n);a=R(v,"DIV",{class:!0});var x=L(a);for(let Y=0;Y<l.length;Y+=1)l[Y].l(x);x.forEach(p),s=Z(v),m&&m.l(v),v.forEach(p),this.h()},h:function(){P(e,"class","section-title svelte-rt5px1"),C(e,A,2673,10,90587),P(t,"class","card-header svelte-rt5px1"),C(t,A,2672,8,90551),P(a,"class","scale-guide svelte-rt5px1"),C(a,A,2676,10,90690),P(n,"class","card-content svelte-rt5px1"),C(n,A,2675,8,90653)},m:function(b,h){W(b,t,h),g(t,e),W(b,c,h),W(b,n,h),g(n,a);for(let v=0;v<l.length;v+=1)l[v]&&l[v].m(a,null);g(n,s),m&&m.m(n,null)},p:function(b,h){if(h[0]&1024){f=lt(b[10]);let v;for(v=0;v<f.length;v+=1){const x=Tn(b,f,v);l[v]?l[v].p(x,h):(l[v]=jt(x),l[v].c(),l[v].m(a,null))}for(;v<l.length;v+=1)l[v].d(1);l.length=f.length}b[0]==="guiding"?m||(m=Lt(b),m.c(),m.m(n,null)):m&&(m.d(1),m=null)},d:function(b){b&&(p(t),p(c),p(n)),xn(l,b),m&&m.d()}};return ee("SvelteRegisterBlock",{block:d,id:to.name,type:"slot",source:'(2672:6) <Card class=\\"main-card\\">',ctx:r}),d}function Ot(r){let t,e,i,c,n;const a=[oo,no],s=[];function f(d,y){return d[4]&&d[5]?0:d[21]?1:-1}~(t=f(r))&&(e=s[t]=a[t](r));let l=r[0]==="results"&&Gt(r);const m={c:function(){e&&e.c(),i=$(),l&&l.c(),c=ze()},l:function(y){e&&e.l(y),i=Z(y),l&&l.l(y),c=ze()},m:function(y,b){~t&&s[t].m(y,b),W(y,i,b),l&&l.m(y,b),W(y,c,b),n=!0},p:function(y,b){let h=t;t=f(y),t===h?~t&&s[t].p(y,b):(e&&(Ie(),X(s[h],1,1,()=>{s[h]=null}),Me()),~t?(e=s[t],e?e.p(y,b):(e=s[t]=a[t](y),e.c()),j(e,1),e.m(i.parentNode,i)):e=null),y[0]==="results"?l?(l.p(y,b),b[0]&1&&j(l,1)):(l=Gt(y),l.c(),j(l,1),l.m(c.parentNode,c)):l&&(Ie(),X(l,1,1,()=>{l=null}),Me())},i:function(y){n||(j(e),j(l),n=!0)},o:function(y){X(e),X(l),n=!1},d:function(y){y&&(p(i),p(c)),~t&&s[t].d(y),l&&l.d(y)}};return ee("SvelteRegisterBlock",{block:m,id:Ot.name,type:"if",source:"(2697:4) {#if trainingPhase === 'results'}",ctx:r}),m}function no(r){let t,e;t=new Xt({props:{scoreData:r[21],showDetails:!1,className:"mb-6 iphone-no-margin",currentScoreData:r[16],intervalData:r[3],consistencyData:r[17],feedbackData:r[18],technicalFeedbackData:r[19],sessionStatistics:r[20]},$$inline:!0});const i={c:function(){ge(t.$$.fragment)},l:function(n){me(t.$$.fragment,n)},m:function(n,a){de(t,n,a),e=!0},p:function(n,a){const s={};a[0]&2097152&&(s.scoreData=n[21]),a[0]&65536&&(s.currentScoreData=n[16]),a[0]&8&&(s.intervalData=n[3]),a[0]&131072&&(s.consistencyData=n[17]),a[0]&262144&&(s.feedbackData=n[18]),a[0]&524288&&(s.technicalFeedbackData=n[19]),a[0]&1048576&&(s.sessionStatistics=n[20]),t.$set(s)},i:function(n){e||(j(t.$$.fragment,n),e=!0)},o:function(n){X(t.$$.fragment,n),e=!1},d:function(n){fe(t,n)}};return ee("SvelteRegisterBlock",{block:i,id:no.name,type:"if",source:"(2712:40) ",ctx:r}),i}function oo(r){let t,e;t=new Xt({props:{scoreData:r[4],showDetails:!1,className:"mb-6 iphone-no-margin",currentScoreData:r[16],intervalData:r[3],consistencyData:r[17],feedbackData:r[18],technicalFeedbackData:r[19],sessionStatistics:r[20]},$$inline:!0});const i={c:function(){ge(t.$$.fragment)},l:function(n){me(t.$$.fragment,n)},m:function(n,a){de(t,n,a),e=!0},p:function(n,a){const s={};a[0]&16&&(s.scoreData=n[4]),a[0]&65536&&(s.currentScoreData=n[16]),a[0]&8&&(s.intervalData=n[3]),a[0]&131072&&(s.consistencyData=n[17]),a[0]&262144&&(s.feedbackData=n[18]),a[0]&524288&&(s.technicalFeedbackData=n[19]),a[0]&1048576&&(s.sessionStatistics=n[20]),t.$set(s)},i:function(n){e||(j(t.$$.fragment,n),e=!0)},o:function(n){X(t.$$.fragment,n),e=!1},d:function(n){fe(t,n)}};return ee("SvelteRegisterBlock",{block:i,id:oo.name,type:"if",source:"(2699:6) {#if $unifiedScoreData && $isCompleted}",ctx:r}),i}function Gt(r){let t,e;t=new Qe({props:{class:"main-card bottom-action-card",$$slots:{default:[ro]},$$scope:{ctx:r}},$$inline:!0});const i={c:function(){ge(t.$$.fragment)},l:function(n){me(t.$$.fragment,n)},m:function(n,a){de(t,n,a),e=!0},p:function(n,a){const s={};a[0]&32|a[3]&2048&&(s.$$scope={dirty:a,ctx:n}),t.$set(s)},i:function(n){e||(j(t.$$.fragment,n),e=!0)},o:function(n){X(t.$$.fragment,n),e=!1},d:function(n){fe(t,n)}};return ee("SvelteRegisterBlock",{block:i,id:Gt.name,type:"if",source:"(2730:6) {#if trainingPhase === 'results'}",ctx:r}),i}function ro(r){let t,e,i;e=new Qt({props:{isCompleted:r[5],position:"bottom"},$$inline:!0}),e.$on("action",r[29]);const c={c:function(){t=N("div"),ge(e.$$.fragment),this.h()},l:function(a){t=R(a,"DIV",{class:!0});var s=L(t);me(e.$$.fragment,s),s.forEach(p),this.h()},h:function(){P(t,"class","card-content svelte-rt5px1"),C(t,A,2731,10,92490)},m:function(a,s){W(a,t,s),de(e,t,null),i=!0},p:function(a,s){const f={};s[0]&32&&(f.isCompleted=a[5]),e.$set(f)},i:function(a){i||(j(e.$$.fragment,a),i=!0)},o:function(a){X(e.$$.fragment,a),i=!1},d:function(a){a&&p(t),fe(e)}};return ee("SvelteRegisterBlock",{block:c,id:ro.name,type:"slot",source:'(2731:8) <Card class=\\"main-card bottom-action-card\\">',ctx:r}),c}function ao(r){let t,e,i="⚡ 連続チャレンジモード",c,n,a="中級者向け：8セッション連続で基音が自動再生される集中トレーニング",s,f,l,m,d,y,b,h,v,x,Y,k,D,H,E,J,F=r[1]==="granted"&&!r[25]&&Et(r);const _=[Ln,jn],K=[];function T(B,w){return B[1]==="granted"?0:1}D=T(r),H=K[D]=_[D](r);const q={c:function(){t=N("div"),e=N("h1"),e.textContent=i,c=$(),n=N("p"),n.textContent=a,s=$(),F&&F.c(),f=$(),l=N("div"),m=U("📱 "),d=U(Wt),y=U(" | "),b=U(Jt),h=N("br"),v=$(),x=N("small"),Y=U(Kt),k=$(),H.c(),E=ze(),this.h()},l:function(w){t=R(w,"DIV",{class:!0});var V=L(t);e=R(V,"H1",{class:!0,"data-svelte-h":!0}),ve(e)!=="svelte-1nub9gt"&&(e.textContent=i),c=Z(V),n=R(V,"P",{class:!0,"data-svelte-h":!0}),ve(n)!=="svelte-gneggn"&&(n.textContent=a),s=Z(V),F&&F.l(V),f=Z(V),l=R(V,"DIV",{class:!0});var M=L(l);m=G(M,"📱 "),d=G(M,Wt),y=G(M," | "),b=G(M,Jt),h=R(M,"BR",{}),v=Z(M),x=R(M,"SMALL",{style:!0});var Q=L(x);Y=G(Q,Kt),Q.forEach(p),M.forEach(p),V.forEach(p),k=Z(w),H.l(w),E=ze(),this.h()},h:function(){P(e,"class","page-title svelte-rt5px1"),C(e,A,2514,4,85108),P(n,"class","page-description svelte-rt5px1"),C(n,A,2515,4,85153),C(h,A,2549,42,86359),Ke(x,"font-size","0.6rem"),C(x,A,2550,6,86371),P(l,"class","debug-info svelte-rt5px1"),C(l,A,2548,4,86292),P(t,"class","header-section svelte-rt5px1"),C(t,A,2513,2,85075)},m:function(w,V){W(w,t,V),g(t,e),g(t,c),g(t,n),g(t,s),F&&F.m(t,null),g(t,f),g(t,l),g(l,m),g(l,d),g(l,y),g(l,b),g(l,h),g(l,v),g(l,x),g(x,Y),W(w,k,V),K[D].m(w,V),W(w,E,V),J=!0},p:function(w,V){w[1]==="granted"&&!w[25]?F?(F.p(w,V),V[0]&33554434&&j(F,1)):(F=Et(w),F.c(),j(F,1),F.m(t,f)):F&&(Ie(),X(F,1,1,()=>{F=null}),Me());let M=D;D=T(w),D===M?K[D].p(w,V):(Ie(),X(K[M],1,1,()=>{K[M]=null}),Me(),H=K[D],H?H.p(w,V):(H=K[D]=_[D](w),H.c()),j(H,1),H.m(E.parentNode,E))},i:function(w){J||(j(F),j(H),J=!0)},o:function(w){X(F),X(H),J=!1},d:function(w){w&&(p(t),p(k),p(E)),F&&F.d(),K[D].d(w)}};return ee("SvelteRegisterBlock",{block:q,id:ao.name,type:"slot",source:"(2512:0) <PageLayout>",ctx:r}),q}function Ut(r){let t,e,i;e=new Bn({props:{$$slots:{default:[ao]},$$scope:{ctx:r}},$$inline:!0});const c={c:function(){t=$(),ge(e.$$.fragment),this.h()},l:function(a){bo("svelte-13kpo59",An.head).forEach(p),t=Z(a),me(e.$$.fragment,a),this.h()},h:function(){An.title="連続チャレンジモード - 相対音感トレーニング"},m:function(a,s){W(a,t,s),de(e,a,s),i=!0},p:function(a,s){const f={};s[0]&67108863|s[3]&2048&&(f.$$scope={dirty:s,ctx:a}),e.$set(f)},i:function(a){i||(j(e.$$.fragment,a),i=!0)},o:function(a){X(e.$$.fragment,a),i=!1},d:function(a){a&&p(t),fe(e,a)}};return ee("SvelteRegisterBlock",{block:c,id:Ut.name,type:"component",source:"",ctx:r}),c}const Wt="v2.3.1-ANIMATED",Jt="07/29 04:15",Kt="🎬 評価分布アニメーション実装・UX向上";function Mn(){const r=/iPhone/.test(navigator.userAgent),t=/iPad/.test(navigator.userAgent),e=/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document;return r||t||e?(console.log("🔊 [RandomTraining] iOS/iPadOS検出 - 音量35dB設定"),35):(console.log("🔊 [RandomTraining] PC検出 - 音量-6dB設定"),-6)}function Uo(){return{mode:"continuous",timestamp:new Date,duration:480,totalNotes:64,measuredNotes:59,averageAccuracy:79,baseNote:"C5",baseFrequency:523.25,sessionHistory:[{grade:"excellent",accuracy:92,baseNote:"C4",baseFrequency:261.63,timestamp:new Date(Date.now()-7*6e4),measuredNotes:8,noteResults:[{name:"ド",note:"ド",frequency:262,detectedFrequency:264,cents:13,grade:"excellent"},{name:"レ",note:"レ",frequency:294,detectedFrequency:291,cents:-18,grade:"good"},{name:"ミ",note:"ミ",frequency:330,detectedFrequency:335,cents:26,grade:"pass"},{name:"ファ",note:"ファ",frequency:349,detectedFrequency:346,cents:-15,grade:"excellent"},{name:"ソ",note:"ソ",frequency:392,detectedFrequency:388,cents:-18,grade:"good"},{name:"ラ",note:"ラ",frequency:440,detectedFrequency:444,cents:16,grade:"good"},{name:"シ",note:"シ",frequency:494,detectedFrequency:499,cents:17,grade:"good"},{name:"ド（高）",note:"ド（高）",frequency:523,detectedFrequency:520,cents:-10,grade:"excellent"}]},{grade:"good",accuracy:78,baseNote:"D4",baseFrequency:293.66,timestamp:new Date(Date.now()-6*6e4),measuredNotes:7,noteResults:[{name:"ド",note:"ド",frequency:294,detectedFrequency:290,cents:-23,grade:"good"},{name:"レ",note:"レ",frequency:330,detectedFrequency:340,cents:53,grade:"needWork"},{name:"ミ",note:"ミ",frequency:370,detectedFrequency:375,cents:23,grade:"good"},{name:"ファ",note:"ファ",frequency:392,detectedFrequency:385,cents:-31,grade:"pass"},{name:"ソ",note:"ソ",frequency:440,detectedFrequency:432,cents:-31,grade:"pass"},{name:"ラ",note:"ラ",frequency:494,detectedFrequency:510,cents:56,grade:"needWork"},{name:"シ",note:"シ",frequency:554,detectedFrequency:null,cents:null,grade:"notMeasured"},{name:"ド（高）",note:"ド（高）",frequency:587,detectedFrequency:580,cents:-21,grade:"good"}]},{grade:"excellent",accuracy:95,baseNote:"E4",baseFrequency:329.63,timestamp:new Date(Date.now()-5*6e4),measuredNotes:8,noteResults:[{name:"ド",note:"ド",frequency:330,detectedFrequency:332,cents:10,grade:"excellent"},{name:"レ",note:"レ",frequency:370,detectedFrequency:368,cents:-9,grade:"excellent"},{name:"ミ",note:"ミ",frequency:415,detectedFrequency:418,cents:12,grade:"excellent"},{name:"ファ",note:"ファ",frequency:440,detectedFrequency:436,cents:-16,grade:"good"},{name:"ソ",note:"ソ",frequency:494,detectedFrequency:497,cents:11,grade:"excellent"},{name:"ラ",note:"ラ",frequency:554,detectedFrequency:551,cents:-9,grade:"excellent"},{name:"シ",note:"シ",frequency:622,detectedFrequency:625,cents:8,grade:"excellent"},{name:"ド（高）",note:"ド（高）",frequency:659,detectedFrequency:655,cents:-10,grade:"excellent"}]},{grade:"needWork",accuracy:45,baseNote:"F4",baseFrequency:349.23,timestamp:new Date(Date.now()-4*6e4),measuredNotes:6,noteResults:[{name:"ド",note:"ド",frequency:349,detectedFrequency:345,cents:-20,grade:"good"},{name:"レ",note:"レ",frequency:392,detectedFrequency:420,cents:124,grade:"needWork"},{name:"ミ",note:"ミ",frequency:440,detectedFrequency:435,cents:-20,grade:"good"},{name:"ファ",note:"ファ",frequency:466,detectedFrequency:520,cents:195,grade:"needWork"},{name:"ソ",note:"ソ",frequency:523,detectedFrequency:410,cents:-455,grade:"needWork"},{name:"ラ",note:"ラ",frequency:587,detectedFrequency:null,cents:null,grade:"notMeasured"},{name:"シ",note:"シ",frequency:659,detectedFrequency:650,cents:-24,grade:"good"},{name:"ド（高）",note:"ド（高）",frequency:698,detectedFrequency:null,cents:null,grade:"notMeasured"}]},{grade:"good",accuracy:85,baseNote:"G4",baseFrequency:392,timestamp:new Date(Date.now()-3*6e4),measuredNotes:8,noteResults:[{name:"ド",note:"ド",frequency:392,detectedFrequency:395,cents:13,grade:"excellent"},{name:"レ",note:"レ",frequency:440,detectedFrequency:438,cents:-8,grade:"excellent"},{name:"ミ",note:"ミ",frequency:494,detectedFrequency:500,cents:21,grade:"good"},{name:"ファ",note:"ファ",frequency:523,detectedFrequency:520,cents:-10,grade:"excellent"},{name:"ソ",note:"ソ",frequency:587,detectedFrequency:595,cents:24,grade:"good"},{name:"ラ",note:"ラ",frequency:659,detectedFrequency:665,cents:16,grade:"good"},{name:"シ",note:"シ",frequency:740,detectedFrequency:755,cents:35,grade:"pass"},{name:"ド（高）",note:"ド（高）",frequency:784,detectedFrequency:780,cents:-9,grade:"excellent"}]},{grade:"excellent",accuracy:94,baseNote:"A4",baseFrequency:440,timestamp:new Date(Date.now()-2*6e4),measuredNotes:8,noteResults:[{name:"ド",note:"ド",frequency:440,detectedFrequency:442,cents:8,grade:"excellent"},{name:"レ",note:"レ",frequency:494,detectedFrequency:492,cents:-7,grade:"excellent"},{name:"ミ",note:"ミ",frequency:554,detectedFrequency:558,cents:12,grade:"excellent"},{name:"ファ",note:"ファ",frequency:587,detectedFrequency:585,cents:-6,grade:"excellent"},{name:"ソ",note:"ソ",frequency:659,detectedFrequency:665,cents:16,grade:"good"},{name:"ラ",note:"ラ",frequency:740,detectedFrequency:738,cents:-5,grade:"excellent"},{name:"シ",note:"シ",frequency:831,detectedFrequency:840,cents:19,grade:"good"},{name:"ド（高）",note:"ド（高）",frequency:880,detectedFrequency:882,cents:4,grade:"excellent"}]},{grade:"pass",accuracy:68,baseNote:"Bb4",baseFrequency:466.16,timestamp:new Date(Date.now()-1*6e4),measuredNotes:7,noteResults:[{name:"ド",note:"ド",frequency:466,detectedFrequency:470,cents:15,grade:"excellent"},{name:"レ",note:"レ",frequency:523,detectedFrequency:535,cents:39,grade:"pass"},{name:"ミ",note:"ミ",frequency:587,detectedFrequency:600,cents:38,grade:"pass"},{name:"ファ",note:"ファ",frequency:622,detectedFrequency:615,cents:-19,grade:"good"},{name:"ソ",note:"ソ",frequency:698,detectedFrequency:720,cents:54,grade:"needWork"},{name:"ラ",note:"ラ",frequency:784,detectedFrequency:null,cents:null,grade:"notMeasured"},{name:"シ",note:"シ",frequency:880,detectedFrequency:895,cents:29,grade:"pass"},{name:"ド（高）",note:"ド（高）",frequency:932,detectedFrequency:925,cents:-13,grade:"excellent"}]},{grade:"good",accuracy:82,baseNote:"C5",baseFrequency:523.25,timestamp:new Date,measuredNotes:8,noteResults:[{name:"ド",note:"ド",frequency:523,detectedFrequency:526,cents:10,grade:"excellent"},{name:"レ",note:"レ",frequency:587,detectedFrequency:584,cents:-9,grade:"excellent"},{name:"ミ",note:"ミ",frequency:659,detectedFrequency:665,cents:16,grade:"good"},{name:"ファ",note:"ファ",frequency:698,detectedFrequency:692,cents:-15,grade:"excellent"},{name:"ソ",note:"ソ",frequency:784,detectedFrequency:795,cents:24,grade:"good"},{name:"ラ",note:"ラ",frequency:880,detectedFrequency:890,cents:19,grade:"good"},{name:"シ",note:"シ",frequency:988,detectedFrequency:1010,cents:38,grade:"pass"},{name:"ド（高）",note:"ド（高）",frequency:1047,detectedFrequency:1042,cents:-8,grade:"excellent"}]}]}}function It(r){return[{scale:"ド",interval:"unison",intervalName:"ユニゾン"},{scale:"レ",interval:"major_second",intervalName:"長2度"},{scale:"ミ",interval:"major_third",intervalName:"長3度"},{scale:"ファ",interval:"perfect_fourth",intervalName:"完全4度"},{scale:"ソ",interval:"perfect_fifth",intervalName:"完全5度"},{scale:"ラ",interval:"major_sixth",intervalName:"長6度"},{scale:"シ",interval:"major_seventh",intervalName:"長7度"},{scale:"ド（高）",interval:"octave",intervalName:"オクターブ"}].map((e,i)=>{const c=r.find(n=>n.targetNote&&n.targetNote.includes(e.scale))||r[i];if(c&&c.accuracy!=="notMeasured"){const n=parseFloat(c.accuracy)||0,a=Math.round((100-n)*.5);return{type:e.interval,scale:e.scale,intervalName:e.intervalName,attempts:1,averageError:a,accuracy:n}}else return{type:e.interval,scale:e.scale,intervalName:e.intervalName,attempts:0,averageError:null,accuracy:0}})}function En(r){if(!r||!Array.isArray(r))return console.warn("⚠️ [RandomTraining] sessionHistory が無効です"),[];const t=[{type:"unison",scale:"ド",intervalName:"ユニゾン",noteIndex:0},{type:"major_second",scale:"レ",intervalName:"長2度",noteIndex:1},{type:"major_third",scale:"ミ",intervalName:"長3度",noteIndex:2},{type:"perfect_fourth",scale:"ファ",intervalName:"完全4度",noteIndex:3},{type:"perfect_fifth",scale:"ソ",intervalName:"完全5度",noteIndex:4},{type:"major_sixth",scale:"ラ",intervalName:"長6度",noteIndex:5},{type:"major_seventh",scale:"シ",intervalName:"長7度",noteIndex:6},{type:"octave",scale:"ド（高）",intervalName:"オクターブ",noteIndex:7}],e={};return t.forEach(i=>{e[i.type]={type:i.type,scale:i.scale,intervalName:i.intervalName,attempts:0,successCount:0,accuracySum:0,accuracyValues:[],errorValues:[]}}),r.forEach(i=>{!i.noteResults||!Array.isArray(i.noteResults)||i.noteResults.forEach((c,n)=>{if(n>=t.length)return;const a=t[n].type,s=e[a];if(s.attempts++,c.accuracy!=="notMeasured"&&typeof c.accuracy=="number"){s.accuracyValues.push(c.accuracy),s.accuracySum+=c.accuracy;const f=Math.round((100-c.accuracy)*.5);s.errorValues.push(f),c.accuracy>=70&&s.successCount++}})}),t.map(i=>{const c=e[i.type];if(c.attempts===0)return{type:i.type,scale:i.scale,intervalName:i.intervalName,attempts:0,averageError:null,accuracy:0};const n=c.accuracyValues.length>0?Math.round(c.accuracySum/c.accuracyValues.length):0,a=c.errorValues.length>0?Math.round(c.errorValues.reduce((f,l)=>f+l,0)/c.errorValues.length):null,s=c.accuracyValues.length>0?Math.round(c.successCount/c.accuracyValues.length*100):0;return{type:i.type,scale:i.scale,intervalName:i.intervalName,mastery:s,attempts:c.attempts,averageError:a,accuracy:n}})}function Pn(r){const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];if(r<=0)return"ーー";const i=Math.round(12*Math.log2(r/440)),c=(i+9+120)%12,n=Math.floor((i+9)/12)+4;return t[c]+n}function Mt(r,t){const e=[{factor:4,freq:r*4,description:"2オクターブ上"},{factor:3,freq:r*3,description:"1.5オクターブ上"},{factor:2.5,freq:r*2.5,description:"1.3オクターブ上"},{factor:2,freq:r*2,description:"1オクターブ上"},{factor:1.5,freq:r*1.5,description:"0.5オクターブ上"},{factor:1,freq:r,description:"補正なし"},{factor:.75,freq:r*.75,description:"0.33オクターブ下"},{factor:.67,freq:r*.67,description:"0.5オクターブ下"},{factor:.5,freq:r*.5,description:"1オクターブ下"},{factor:.4,freq:r*.4,description:"1.3オクターブ下"},{factor:.33,freq:r*.33,description:"1.5オクターブ下"},{factor:.25,freq:r*.25,description:"2オクターブ下"}];let i=null,c=1/0;const n=t*.5,a=t*1.5,s=e.filter(f=>f.freq>=n&&f.freq<=a);for(const f of s){const l=Math.abs(f.freq-t);l<c&&(c=l,i=f)}if(!i)for(const f of e){const l=Math.abs(f.freq-t);l<c&&(c=l,i=f)}return i?{correctedFrequency:i.freq,factor:i.factor,description:i.description,error:c}:{correctedFrequency:r,factor:1,description:"補正なし（フォールバック）",error:Math.abs(r-t)}}function ot(){try{"scrollTo"in window&&"behavior"in document.documentElement.style?window.scrollTo({top:0,behavior:"smooth"}):window.scrollTo(0,0),document.body&&(document.body.scrollTop=0),document.documentElement&&(document.documentElement.scrollTop=0),document.querySelectorAll("[data-scroll-container], .scroll-container, main").forEach(t=>{t.scrollTo?t.scrollTo(0,0):t.scrollTop=0})}catch(r){console.warn("スクロールエラー:",r);try{window.scroll(0,0)}catch(t){console.error("スクロール完全失敗:",t)}}}function so(r){}function co(r){console.error("❌ PitchDetectorエラー:",r.detail)}function Wo(r,t,e){let i,c,n,a,s,f,l,m,d,y,b,h;Ae(Nt,"currentSessionId"),Te(r,Nt,o=>e(23,n=o)),Ae(qt,"unifiedScoreData"),Te(r,qt,o=>e(4,a=o)),Ae(kt,"isCompleted"),Te(r,kt,o=>e(5,s=o)),Ae(_t,"page"),Te(r,_t,o=>e(53,f=o)),Ae(wt,"remainingSessions"),Te(r,wt,o=>e(54,l=o)),Ae(Ct,"nextBaseName"),Te(r,Ct,o=>e(55,m=o)),Ae(Rt,"nextBaseNote"),Te(r,Rt,o=>e(56,d=o)),Ae(Dt,"sessionHistory"),Te(r,Dt,o=>e(24,y=o)),Ae(At,"trainingProgress"),Te(r,At,o=>e(57,b=o)),Ae(Ft,"isLoading"),Te(r,Ft,o=>e(25,h=o));let{$$slots:v={},$$scope:x}=t;So("Page",v,[]);function Y(o){return nt.evaluateOverall(o)}let k="setup",D=typeof window<"u"?new URLSearchParams(window.location.search).get("from")==="microphone-test"?(se.info("[RandomTraining] マイクテストページからの遷移を検出"),"granted"):(se.info("[RandomTraining] ダイレクトアクセスを検出"),"checking"):"checking",H=!0,E=[];const J=["ド","レ","ミ","ファ","ソ","ラ","シ","ド（高）"];let F="",_=0,K=!1,T=0,q=J.map(o=>({name:o,state:"inactive",completed:!1})),B=null,w=!1,V=0,M=!1,Q=null,ye=!1,ne=[],_e=[],Se=0,Ee=0,je="ーー",Ve=0,Le={correctCount:0,totalCount:8,averageAccuracy:0,averageTime:0,isCompleted:!1},De=null,He={totalScore:0,grade:"C",componentScores:{pitchAccuracy:0,recognitionSpeed:0,intervalMastery:0,directionAccuracy:0,consistency:0}},ke=[],Pe=[],Oe={},Xe={},Ce={totalAttempts:0,successRate:0,averageScore:0,bestScore:0,sessionDuration:0,streakCount:0,fatigueLevel:"fresh",mostDifficultInterval:"-",mostSuccessfulInterval:"-",averageResponseTime:0,sessionStart:Date.now()},ft="intervals",oe=[],le=null,ue=null,Re=!0,ce=null,xe=null,rt=null,at=null,We=null;const Ge=[{note:"C4",name:"ド（中）",frequency:261.63,semitonesFromC:0},{note:"Db4",name:"ド#（中）",frequency:277.18,semitonesFromC:1},{note:"D4",name:"レ（中）",frequency:293.66,semitonesFromC:2},{note:"Eb4",name:"レ#（中）",frequency:311.13,semitonesFromC:3},{note:"E4",name:"ミ（中）",frequency:329.63,semitonesFromC:4},{note:"F4",name:"ファ（中）",frequency:349.23,semitonesFromC:5},{note:"Gb4",name:"ファ#（中）",frequency:369.99,semitonesFromC:6},{note:"Ab4",name:"ラb（中）",frequency:415.3,semitonesFromC:8},{note:"Bb3",name:"シb（低）",frequency:233.08,semitonesFromC:-2},{note:"B3",name:"シ（低）",frequency:246.94,semitonesFromC:-1}];async function Je(){var o;e(1,D="checking");try{if(console.log("🎤 [RandomTraining] AudioManager経由でマイク許可確認開始"),!((o=navigator.mediaDevices)!=null&&o.getUserMedia)){e(1,D="error");return}const u=await Ue.initialize();rt=u.audioContext,xe=u.mediaStream,at=u.sourceNode,console.log("✅ [RandomTraining] AudioManager リソース取得完了"),e(1,D="granted"),e(0,k="setup"),setTimeout(async()=>{if(ce){se.audio("[RandomTraining] PitchDetector初期化開始");const S=/iPhone/.test(navigator.userAgent),I=/iPad/.test(navigator.userAgent),z=/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document;(I||z)&&(console.log("🔧 [RandomTraining] iPad検出 - マイク感度7.0x自動設定開始"),Ue.setSensitivity(7),console.log("✅ [RandomTraining] iPad マイク感度7.0x自動設定完了"));try{console.log("🎤 [RandomTraining] AudioManager再初期化開始（iPad対応）"),await Ue.initialize(),console.log("✅ [RandomTraining] AudioManager再初期化完了")}catch(O){console.warn("⚠️ AudioManager再初期化エラー:",O)}await ce.initialize(),se.audio("[RandomTraining] PitchDetector初期化完了")}},200)}catch(u){se.error("[RandomTraining] マイク許可エラー:",u),e(1,D=(u==null?void 0:u.name)==="NotAllowedError"?"denied":"error")}}function dt(){const o=d,u=m,S=Ge.find(I=>I.note===o)||Ge.find(I=>I.name===u)||Ge[0];if(e(7,F=S.name),e(8,_=S.frequency),se.info(`[BaseNote] 基音設定（localStorage連携）: ${F} = ${_}Hz`),se.info(`[BaseNote] localStorage基音情報: note=${o}, name=${u}`),!_||_<=0)throw se.error("[BaseNote] 基音周波数設定エラー:",S),new Error(`Invalid base frequency: ${_}`)}async function Yt(){if(K||!ue||Re)return;if(D!=="granted"){console.log("🎤 [RandomTraining] マイク許可が必要です。許可取得を開始...");try{await Je(),console.log("🎤 [RandomTraining] マイク許可取得完了")}catch(u){console.error("❌ マイク許可エラー:",u);return}}if(!xe&&D==="granted"){console.log("🎤 [RandomTraining] AudioManagerリソース未初期化のため取得します");try{await Je()}catch(u){console.error("❌ AudioManagerリソース初期化エラー:",u);return}}else xe&&console.log("🎤 [RandomTraining] AudioManagerリソース既存のため再利用");e(9,K=!0),e(0,k="listening"),We=Date.now(),dt();const o=Ge.find(u=>u.name===F).note;ue.triggerAttackRelease(o,2,Tt(),.7),setTimeout(()=>{e(9,K=!1),e(0,k="waiting"),setTimeout(()=>gt(),500)},2e3)}async function Zt(){if(K||!ue||h||!F)return;if(D!=="granted"){console.log("🎤 [RandomTraining] マイク許可が必要です。許可取得を開始...");try{await Je(),console.log("🎤 [RandomTraining] マイク許可取得完了")}catch(u){console.error("❌ マイク許可エラー:",u);return}}if(!xe&&D==="granted"){console.log("🎤 [RandomTraining] AudioManagerリソース未初期化のため取得します");try{await Je()}catch(u){console.error("❌ AudioManagerリソース初期化エラー:",u);return}}else xe&&console.log("🎤 [RandomTraining] AudioManagerリソース既存のため再利用");if(e(9,K=!0),e(0,k="listening"),We=Date.now(),typeof window<"u"&&window.Tone){const u=window.Tone.context||window.Tone.getContext();u&&u.state==="suspended"&&(console.log("🔄 [RandomTraining] AudioContext suspended検出 - 再開中..."),await u.resume(),console.log("✅ [RandomTraining] AudioContext再開完了"))}const o=Ge.find(u=>u.name===F).note;ue.triggerAttackRelease(o,2,Tt(),.7),setTimeout(()=>{e(9,K=!1),e(0,k="waiting"),setTimeout(()=>gt(),500)},2e3)}async function io(){if(K||!ue||h||!F){console.log("🔄 [BaseNoteOnly] 再生条件未満: isPlaying:",K,"sampler:",!!ue,"isLoading:",h,"currentBaseNote:",F);return}if(console.log("🎵 [BaseNoteOnly] 基音のみ再生開始:",F),typeof window<"u"&&window.Tone){const u=window.Tone.context||window.Tone.getContext();u&&u.state==="suspended"&&(console.log("🔄 [BaseNoteOnly] AudioContext suspended検出 - 再開中..."),await u.resume(),console.log("✅ [BaseNoteOnly] AudioContext再開完了"))}const o=Ge.find(u=>u.name===F).note;ue.triggerAttackRelease(o,1.5,Tt(),.7),console.log("🎵 [BaseNoteOnly] 基音再生完了:",o)}function mt(){F&&_>0?Zt():Yt(),$t()}function $t(){Q&&clearInterval(Q),e(11,V=0),M=!0,e(12,ye=!1),console.log("🎵 [GuideStartBar] ガイドスタートバー開始"),Q=setInterval(()=>{e(11,V+=2.5),V>=100&&(e(11,V=100),e(12,ye=!0),console.log("🎵 [GuideStartBar] ガイド開始タイミング！"),setTimeout(()=>{M=!1,e(12,ye=!1),e(11,V=0)},800),clearInterval(Q),Q=null)},50)}function lo(){Q&&(clearInterval(Q),Q=null),M=!1,e(12,ye=!1),e(11,V=0)}function Ye(o,u){const I=[0,2,4,5,7,9,11,12][u],z=o*Math.pow(2,I/12);return se.debug(`[calculateExpectedFrequency] ${q[u].name}: 基音${o.toFixed(1)}Hz + ${I}半音 = ${z.toFixed(1)}Hz`),z}function en(o,u){return Ye(o,u)}function gt(){e(0,k="guiding"),T=0,w=!0,ne=[],console.log(`🎬 ガイド開始: ${F} (${_.toFixed(1)}Hz)`);function o(){if(T<q.length){T>0&&e(10,q[T-1].state="inactive",q),e(10,q[T].state="active",q);const u=en(_,T);St.setScaleContext({baseFrequency:_,currentScale:q[T].name,targetFrequency:u}),console.log(`🎵 [Scale] 基音:${F}(${_.toFixed(0)}Hz) 現在:${q[T].name} 目標:${u.toFixed(0)}Hz`),T>=4&&console.log(`🔍 [デバッグ] Step ${T}: currentBaseFrequency=${_}, currentBaseNote='${F}'`),T++,B=setTimeout(()=>{o()},600)}else tn()}o()}function tn(){w=!1,console.log(`🏁 ガイド完了: ${ne.length}/${q.length}ステップ評価`),q.length>0&&e(10,q[q.length-1].state="inactive",q),ce&&ce.stopDetection(),St.clearContext(),nn(),cn(),oe=J.map(o=>{const u=ne.find(S=>S.stepName===o);return u?{name:u.stepName,cents:u.adjustedFrequency?Math.round(u.centDifference):null,targetFreq:u.expectedFrequency,detectedFreq:u.adjustedFrequency||null,diff:u.adjustedFrequency?u.adjustedFrequency-u.expectedFrequency:null,accuracy:u.accuracy}:{name:o,cents:null,targetFreq:null,detectedFreq:null,diff:null,accuracy:"notMeasured"}}),un(),dn(),e(0,k="results")}function nn(){let o=0,u=0;ne.forEach((z,O)=>{z.isCorrect&&o++,u+=z.accuracy});const S=ne.length>0?Math.round(u/ne.length):0,I=Math.round(o/q.length*100);Le={correctCount:o,totalCount:q.length,averageAccuracy:S,averageTime:0,isCompleted:!0},console.log(`🎯 結果: ${o}/${q.length}正解 (${I}%) 平均精度${S}%`),ne.length>0&&(_e=[...ne])}function uo(){switch(k){case"setup":return Re||!ue?"🎵 音源読み込み中...":"🎤 マイク準備完了 - トレーニング開始可能";case"listening":return"🎵 基音再生中...";case"waiting":return"⏳ 間もなく開始...";case"guiding":return"🎙️ ガイドに合わせてドレミファソラシドを歌ってください";case"results":return"🎉 採点結果";default:return"🔄 準備中..."}}function fo(){return ne.length>0?ne:_e.length>0?_e:[]}function on(){vt(`${it}/microphone-test`)}function Ze(){vt(`${it}/`)}async function rn(){try{e(33,Re=!0),e(32,ue=new zo({urls:{C4:"C4.mp3"},baseUrl:`${it}/audio/piano/`,release:1.5,volume:Mn(),onload:()=>{e(33,Re=!1)},onerror:z=>{console.error("❌ Salamander Piano音源読み込みエラー:",z),e(33,Re=!1)}}).toDestination());const o=/iPhone/.test(navigator.userAgent),u=/iPad/.test(navigator.userAgent),S=/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document,I=o||u||S;console.log(u?"🔍 [RandomTraining] iPad検出:":S?"🔍 [RandomTraining] iPadOS検出:":o?"🔍 [RandomTraining] iPhone検出:":"🔍 [RandomTraining] その他デバイス検出:",navigator.userAgent),console.log("🔊 [RandomTraining] 音量設定維持: 35dB")}catch(o){console.error("サンプラー初期化エラー:",o),e(33,Re=!1)}}async function st(){try{(await navigator.permissions.query({name:"microphone"})).state==="granted"?await Je():e(1,D="denied")}catch{e(1,D="denied")}}function an(){try{De=new Nn,se.info("[RandomTraining] 採点エンジン初期化完了")}catch(o){se.error("[RandomTraining] 採点エンジン初期化エラー:",o)}}function sn(o,u){if(!De||!w)return;const S=T-1;if(S<0||S>=q.length)return;const I=Ye(_,S),z={baseFrequency:_,targetFrequency:I,detectedFrequency:o,detectedNote:u,volume:Se,timestamp:Date.now(),scaleIndex:S,scaleName:q[S].name};try{De.processAttempt(z)}catch(O){se.error("[RandomTraining] 採点エンジンエラー:",O)}}function cn(){if(!De){se.error("[RandomTraining] 採点エンジンが初期化されていません"),ln();return}try{const o=De.generateDetailedReport();e(16,He={totalScore:o.totalScore,grade:o.grade,componentScores:o.componentScores}),o.intervalAnalysis&&o.intervalAnalysis.masteryLevels?e(3,ke=Object.entries(o.intervalAnalysis.masteryLevels).map(([u,S])=>{var I,z;return{type:u,mastery:Math.round(S),attempts:((I=o.intervalAnalysis.attemptCounts)==null?void 0:I[u])||0,accuracy:((z=o.intervalAnalysis.accuracyRates)==null?void 0:z[u])||0}})):(console.warn("⚠️ [RandomTraining] intervalAnalysis.masteryLevels が未定義です"),e(3,ke=[])),o.consistencyHistory&&Array.isArray(o.consistencyHistory)?e(17,Pe=o.consistencyHistory.map((u,S)=>({score:Math.round(u),timestamp:Date.now()-(o.consistencyHistory.length-S)*1e3}))):(console.warn("⚠️ [RandomTraining] consistencyHistory が未定義または配列ではありません"),e(17,Pe=[])),e(18,Oe=o.feedback||{primary:"採点結果を生成中です...",detailed:[],suggestions:[]}),e(20,Ce={totalAttempts:o.totalAttempts||0,successRate:o.successRate||0,averageScore:o.totalScore||0,bestScore:Math.max(o.totalScore||0,Ce.bestScore||0),sessionDuration:Math.round((Date.now()-Ce.sessionStart)/6e4)||0,streakCount:o.streak||0,fatigueLevel:o.fatigueLevel||"normal",mostDifficultInterval:o.mostDifficultInterval||"-",mostSuccessfulInterval:o.mostSuccessfulInterval||"-",averageResponseTime:o.averageResponseTime||0}),se.info("[RandomTraining] 採点結果生成完了:",He)}catch(o){se.error("[RandomTraining] 採点結果生成エラー:",o)}}function ln(){se.info("[RandomTraining] テストデータで採点結果を生成"),e(16,He={totalScore:78,grade:"B+",componentScores:{pitchAccuracy:82,recognitionSpeed:75,intervalMastery:80,directionAccuracy:85,consistency:70}}),e(3,ke=[{type:"unison",mastery:95,attempts:8,accuracy:98},{type:"major_second",mastery:82,attempts:8,accuracy:85},{type:"major_third",mastery:78,attempts:8,accuracy:80},{type:"perfect_fourth",mastery:65,attempts:8,accuracy:68},{type:"perfect_fifth",mastery:88,attempts:8,accuracy:90},{type:"major_sixth",mastery:72,attempts:8,accuracy:75},{type:"major_seventh",mastery:58,attempts:8,accuracy:62},{type:"octave",mastery:92,attempts:8,accuracy:94}]),e(17,Pe=[{score:65,timestamp:Date.now()-42e4},{score:72,timestamp:Date.now()-36e4},{score:68,timestamp:Date.now()-3e5},{score:75,timestamp:Date.now()-24e4},{score:78,timestamp:Date.now()-18e4},{score:82,timestamp:Date.now()-12e4},{score:80,timestamp:Date.now()-6e4},{score:85,timestamp:Date.now()}]),e(18,Oe={type:"improvement",primary:"良い進歩が見られます！",summary:"音程の認識精度が向上しています。特に完全5度とオクターブの習得度が高く、基本的な音感が身についてきています。",details:[{category:"strengths",text:"ユニゾンとオクターブの認識がほぼ完璧です"},{category:"strengths",text:"完全5度の安定性が優秀です"},{category:"improvements",text:"完全4度の練習をもう少し増やしましょう"},{category:"improvements",text:"長7度の認識精度を向上させましょう"},{category:"tips",text:"4度は「ソーファー」の音程です"},{category:"practice",text:"毎日15分の継続練習を心がけましょう"}],nextSteps:["完全4度の集中練習を行いましょう","連続チャレンジモードで実践練習を","1日15分の継続練習を心がけましょう"],motivation:"継続は力なり！あなたの相対音感は確実に向上しています！"}),e(20,Ce={totalAttempts:32,successRate:68.8,averageScore:78,bestScore:85,sessionDuration:8,streakCount:4,fatigueLevel:"normal",mostDifficultInterval:"完全4度",mostSuccessfulInterval:"ユニゾン",averageResponseTime:2.1,sessionStart:Date.now()-48e4}),se.info("[RandomTraining] テスト採点結果生成完了")}function mo(o){ft=o}function un(){if(!oe||oe.length===0){console.warn("[UnifiedScore] noteResultsForDisplay が空です");return}const o=oe.filter(te=>te.accuracy!=="notMeasured").length,u=oe.length,S=oe.filter(te=>te.accuracy!=="notMeasured"&&typeof te.accuracy=="number").map(te=>te.accuracy),I=S.length>0?Math.round(S.reduce((te,Ne)=>te+Ne,0)/S.length):0,z=F||"Unknown",O=_||0,re=oe.map(te=>({name:te.name,note:te.note||te.name,frequency:te.targetFreq||te.expectedFrequency,detectedFrequency:te.detectedFreq,cents:te.cents,grade:nt.evaluateNote(te.cents),targetFreq:te.targetFreq,diff:te.diff})),ie=b,ae=(ie==null?void 0:ie.sessionHistory)||[],qe={timestamp:new Date,baseNote:z,baseFrequency:O,noteResults:re,measuredNotes:o,accuracy:I,grade:nt.evaluateSession(oe)},Be=[...ae,qe];e(21,le={mode:"continuous",timestamp:new Date,duration:60,totalNotes:u,measuredNotes:o,averageAccuracy:I,baseNote:z,baseFrequency:O,noteResults:re,distribution:nt.calculateDistribution(oe),sessionHistory:Be,unifiedGrade:Y(Be)}),console.log("[UnifiedScore] 統合採点データ生成完了（完全版）:",le),fn()}async function fn(){if(!oe||oe.length===0){console.warn("📊 [SessionStorage] 保存データなし");return}try{console.log("📊 [SessionStorage] セッション結果保存開始");const o=oe.map(O=>({name:O.name,cents:O.cents,targetFreq:O.targetFreq||O.expectedFrequency,detectedFreq:O.detectedFreq,diff:O.diff,accuracy:typeof O.accuracy=="number"?O.accuracy:0})),u=We?Math.round((Date.now()-We)/1e3):60;await Rn(o,u,d,m)?(console.log("📊 [SessionStorage] セッション結果保存完了"),console.log("📊 [SessionStorage] 保存後の状況:",{currentSession:n,totalSessions:y.length,isCompleted:s,nextBaseNote:d,nextBaseName:m})):console.error("📊 [SessionStorage] セッション結果保存失敗")}catch(o){console.error("📊 [SessionStorage] セッション保存エラー:",o)}}async function dn(){try{if(De){const o=y||[];for(const[S,I]of o.entries())if(I.noteResults&&I.noteResults.length>0){const z=I.baseFrequency||262;for(const O of I.noteResults)O.detectedFreq&&O.targetFreq&&await De.analyzePerformance({baseFreq:z,targetFreq:O.targetFreq,detectedFreq:O.detectedFreq,responseTime:2e3,volume:50,harmonicCorrection:null})}const u=De.generateDetailedReport();e(16,He={totalScore:u.totalScore||0,grade:u.grade||"C",componentScores:u.componentScores||{accuracy:0,speed:0,consistency:0}}),u.intervalAnalysis&&u.intervalAnalysis.masteryLevels?e(3,ke=Object.entries(u.intervalAnalysis.masteryLevels).map(([S,I])=>{var z;return{type:S,mastery:Math.round(I),attempts:((z=u.intervalAnalysis.attemptCounts)==null?void 0:z[S])||0,accuracy:Math.round(I*.9)}})):e(3,ke=It(oe)),u.consistencyHistory&&Array.isArray(u.consistencyHistory)?e(17,Pe=u.consistencyHistory.map((S,I)=>({score:Math.round(S),timestamp:Date.now()-(u.consistencyHistory.length-I)*1e3}))):e(17,Pe=ht(oe)),e(18,Oe=pt(oe)||u.feedback),console.log("🎯 [generateEnhancedScoringData] 技術分析結果生成を開始"),console.log("🎯 [generateEnhancedScoringData] results:",u),e(19,Xe=mn(u)),console.log("🎯 [generateEnhancedScoringData] technicalFeedbackData結果:",Xe),e(20,Ce={totalAttempts:u.totalAttempts||oe.length,successRate:u.successRate||oe.filter(S=>S.accuracy!=="notMeasured").length/oe.length*100,averageScore:u.totalScore||(le==null?void 0:le.averageAccuracy)||0,bestScore:Math.max(u.totalScore||0,Ce.bestScore||0),sessionDuration:Math.round(60),streakCount:u.streak||0,fatigueLevel:u.fatigueLevel||"normal",mostDifficultInterval:u.mostDifficultInterval||"未特定",mostSuccessfulInterval:u.mostSuccessfulInterval||"未特定",averageResponseTime:u.averageResponseTime||2.5,sessionStart:Date.now()-6e4})}else yt();console.log("[EnhancedScoring] 追加採点データ生成完了")}catch(o){console.error("[EnhancedScoring] データ生成エラー:",o),yt()}}function yt(){const o=oe.filter(S=>S.accuracy!=="notMeasured"),u=(le==null?void 0:le.averageAccuracy)||0;e(16,He={totalScore:Math.round(u*.8),grade:u>=90?"A":u>=80?"B":u>=70?"C":"D",componentScores:{accuracy:u,speed:85,consistency:Math.max(60,u-10)}}),e(3,ke=It(oe)),e(17,Pe=ht()),e(18,Oe=pt(oe)),e(20,Ce={totalAttempts:oe.length,successRate:o.length/oe.length*100,averageScore:u,bestScore:u,sessionDuration:60,streakCount:0,fatigueLevel:"normal",mostDifficultInterval:"未分析",mostSuccessfulInterval:"未分析",averageResponseTime:2.5,sessionStart:Date.now()-6e4})}function ht(o){const u=(le==null?void 0:le.averageAccuracy)||70;return Array.from({length:8},(S,I)=>({score:Math.max(30,Math.min(100,u+(Math.random()-.5)*20)),timestamp:Date.now()-(8-I)*7500}))}function pt(o){const u=o.filter(et=>et.accuracy!=="notMeasured").length,S=(le==null?void 0:le.averageAccuracy)||0,I=8,z=y||[],O=z.length,re={type:"info",categories:[{name:"音程精度",icon:"Target",score:S,message:`${S}%の精度で音程を捉えています`},{name:"測定成功率",icon:"Mic",score:Math.round(u/o.length*100),message:`${o.length}音中${u}音を正常に測定`}]};if(O<I)return re;let ie,ae,qe;const Be=(le==null?void 0:le.unifiedGrade)||"E",te=z.length;let Ne=0,he=0,pe=0;z.forEach(et=>{et.grade==="excellent"?Ne++:et.grade==="good"?he++:et.grade==="pass"&&pe++});const be=te>0?Math.round(Ne/te*100):0,$e=te>0?Math.round((Ne+he+pe)/te*100):0,we=te>0?Math.round((Ne+he+pe)/te*100):0;switch(Be){case"S":ie="excellent",ae="音楽家レベルの相対音感を達成！",qe=`優秀率${be}%超えの実力を証明されました。`;break;case"A":ie="excellent",ae="エキスパートレベル到達！",qe=`優秀率${be}%の安定した音感能力です。`;break;case"B":ie="improvement",ae="プロフィシエント級達成！",qe=`良好率${$e}%の確実な進歩を示しています。`;break;case"C":ie="improvement",ae="アドバンス級到達！",qe=`合格率${we}%で着実に成長中です。`;break;case"D":ie="practice",ae="継続練習で必ず上達！",qe=`現在の合格率${we}%から目標70%へ向けて練習を続けましょう。`;break;case"E":default:ie="encouragement",ae="E級ビギナー",qe="練習開始段階です。継続的な練習で必ず上達します。";break}return{...re,type:ie,primary:ae,summary:qe}}function mn(o){var Be,te,Ne;if((y||[]).length<8||!o)return null;const z=o.improvements||[];(Be=o.detailed)!=null&&Be.statistics;const O=[];let re=0,ie=0;if((te=o.detailed)!=null&&te.intervals){const he=o.detailed.intervals;if(he.totalAnalyses>0){let pe=0,be=0;for(const[$e,we]of Object.entries(he.masteryLevels))we.attempts>0&&(pe+=we.averageAccuracy*we.attempts,be+=we.attempts);re=be>0?pe/be:0}}if((Ne=o.detailed)!=null&&Ne.directions){const he=o.detailed.directions;if(he.totalAnalyses>0){let pe=0,be=0;for(const[$e,we]of Object.entries(he.masteryData))we.attempts>0&&(pe+=we.averageAccuracy*we.attempts,be+=we.attempts);ie=be>0?pe/be:0}}O.push({category:"improvements",text:`音程精度: ${Math.round(re)}%　（音の高さを捉える正確性　目標基準：70〜85%）`}),O.push({category:"improvements",text:`方向性: ${Math.round(ie)}%　（音程の上下判断の精度　目標基準：80〜90%）`});const ae=z.map(he=>({category:"tips",text:he.message})),qe=z.flatMap(he=>(he.actions||[]).map(pe=>({category:"practice",text:pe})));return[...O,...ae,...qe],{type:"info",primary:"詳細分析結果",summary:"音程精度・一貫性・方向性の総合分析",details:O}}kn(async()=>{if(!(typeof localStorage<"u"?localStorage.getItem("mic-test-completed"):null)){console.log("🚫 [RandomTraining] マイクテスト未完了 - 準備画面表示"),st();return}console.log("📊 [SessionStorage] セッション管理初期化開始");try{if(await bt()){if(console.log("📊 [SessionStorage] セッション進行状況の読み込み完了"),console.log("📊 [SessionStorage] 現在のセッション:",n,"/ 8"),console.log("📊 [SessionStorage] 次の基音:",d,"(",m,")"),console.log("📊 [SessionStorage] 完了状況:",s?"8セッション完了":`残り${l}セッション`),s&&(console.log("🔄 [SessionStorage] 8セッション完了検出 - 新サイクル開始処理"),await tt()?console.log("✅ [SessionStorage] 新サイクル開始完了 - セッション1/8から再開"):console.warn("⚠️ [SessionStorage] 新サイクル開始処理が失敗")),n>1&&!s){console.warn("🔄 [SessionStorage] セッション途中でのリロード検出 - セッション1から再開"),console.warn("🔄 [SessionStorage] 現在:",n,"セッション目 → ダイレクトアクセス誘導");const{SessionStorageManager:S}=await Dn(async()=>{const{SessionStorageManager:O}=await import("../chunks/C9IaLGyK.js").then(re=>re.y);return{SessionStorageManager:O}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url),I=S.getInstance();typeof localStorage<"u"&&(localStorage.removeItem("random-training-progress"),localStorage.removeItem("random-training-progress-backup"));const{resetProgress:z}=await Dn(async()=>{const{resetProgress:O}=await import("../chunks/C9IaLGyK.js").then(re=>re.z);return{resetProgress:O}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url);await z(),console.log("🔄 [SessionStorage] localStorage + ストア状態完全リセット完了"),st();return}}else console.log("📊 [SessionStorage] 新規セッション開始")}catch(u){console.error("📊 [SessionStorage] 初期化エラー:",u)}if(rn(),an(),f.url.searchParams.get("from")==="microphone-test"){console.log("🎤 [RandomTraining] マイクテストページからの遷移を検出");const u=new URL(window.location);if(u.searchParams.delete("from"),window.history.replaceState({},"",u),e(1,D="granted"),e(0,k="setup"),console.log('🎤 [RandomTraining] microphoneState="granted", trainingPhase="setup" に設定'),!xe){console.log("🎤 [RandomTraining] AudioManagerリソース取得開始");try{const S=await Ue.initialize();rt=S.audioContext,xe=S.mediaStream,at=S.sourceNode,console.log("🎤 [RandomTraining] AudioManagerリソース取得完了")}catch(S){console.warn("⚠️ AudioManagerリソース取得失敗（後で再試行）:",S)}}if(await new Promise(S=>setTimeout(S,300)),ce&&ce.getIsInitialized&&!ce.getIsInitialized())try{console.log("🎙️ [RandomTraining] PitchDetector初期化開始");const S=Ue.getStatus();console.log("🔍 [RandomTraining] AudioManager状態:",S),(!S.isInitialized||!S.mediaStreamActive)&&(console.log("🔄 [RandomTraining] AudioManager状態不良 - 再初期化実行"),await Ue.initialize()),await ce.initialize(),console.log("✅ [RandomTraining] PitchDetector初期化完了")}catch(S){console.warn("⚠️ PitchDetector初期化失敗:",S)}}else await new Promise(u=>setTimeout(u,100)),st()});function gn(o){const{frequency:u,note:S,volume:I,rawVolume:z,clarity:O}=o.detail;let re=u,ie=S;if(k==="guiding"&&w&&_>0&&u>0){const ae=yn(u);ae&&(re=ae.frequency,ie=ae.note)}e(14,Ee=re),e(15,je=ie),e(13,Se=I),_>0&&re>0?Ve=Math.round(1200*Math.log2(re/_)):Ve=0,hn(u),De&&u>0&&_>0&&sn(u,S)}function yn(o){if(!o||o<=0||!w||!_||Se<25)return null;const S=T-1;if(S<0||S>=q.length)return null;const I=Ye(_,S);if(!I||I<=0)return null;const O=Mt(o,I).correctedFrequency,re=Pn(O);return{frequency:Math.round(O),note:re}}function hn(o,u){if(!o||o<=0||!w)return;if(!_||_<=0){console.error(`❌ [採点エラー] 基音周波数が無効: ${_}Hz`),console.error(`❌ [採点エラー] 基音名: ${F}`),console.error(`❌ [採点エラー] activeStepIndex: ${T-1}`),console.error(`❌ [採点エラー] trainingPhase: ${k}`),console.error(`❌ [採点エラー] isGuideAnimationActive: ${w}`);return}if(Se<25)return;const I=T-1;if(I<0||I>=q.length)return;I>=4&&se.debug(`[採点デバッグ] activeStepIndex=${I} (${q[I].name}), currentBaseFrequency=${_}Hz`);const z=Ye(_,I);if(I>=0&&se.debug(`[音程計算修正版] ${q[I].name}: 期待周波数 ${z.toFixed(1)}Hz`),!z||z<=0||!isFinite(z)){console.error("❌ [採点エラー] 期待周波数計算エラー:"),console.error(`   基音周波数: ${_}Hz`),console.error(`   音階インデックス: ${I}`),console.error(`   期待周波数: ${z}Hz`);return}const O=Mt(o,z),re=O.correctedFrequency,ie=O.factor,ae=Math.round(1200*Math.log2(re/z));if((Math.abs(ae)>200||ie!==1)&&(se.debug(`[プロトタイプ式補正] ${q[I].name}:`),console.warn(`   検出周波数: ${o.toFixed(1)}Hz`),console.warn(`   補正後周波数: ${re.toFixed(1)}Hz`),console.warn(`   期待周波数: ${z.toFixed(1)}Hz`),console.warn(`   セント差: ${ae}¢`),console.warn(`   補正係数: ${ie} (${O.description})`),console.warn(`   基音: ${F} (${_.toFixed(1)}Hz)`)),!isFinite(ae)){console.error("❌ [採点エラー] セント計算エラー:"),console.error(`   検出周波数: ${o}Hz`),console.error(`   期待周波数: ${z}Hz`),console.error(`   セント差: ${ae}`);return}const Be=Math.abs(ae)<=50;if(Se>=15){const he=Math.max(0,Math.round(100-Math.abs(ae))),pe=ne.findIndex($e=>$e.stepIndex===I),be={stepIndex:I,stepName:q[I].name,expectedFrequency:Math.round(z),detectedFrequency:Math.round(o),adjustedFrequency:Math.round(re),centDifference:ae,accuracy:he,isCorrect:Be,correctionFactor:ie,correctionDescription:O.description,timestamp:Date.now()};pe>=0?ne[pe]=be:ne.push(be),ne.length%4===0&&se.realtime(`採点進捗: ${ne.length}/${q.length}ステップ完了`)}}function go(){e(0,k="results"),Le.isCompleted=!0,Le.averageAccuracy=Math.round(Le.correctCount/Le.totalCount*100),ce&&ce.stopDetection(),qn()}async function pn(){if(s){console.warn("🚫 [RestartSame] 8セッション完了状態では再挑戦不可 - 新サイクル開始が必要"),await tt()?(console.log("✅ [RestartSame] 新サイクル開始完了 - セッション1/8から再開"),window.location.reload()):console.error("❌ [RestartSame] 新サイクル開始失敗");return}ot(),e(0,k="setup"),B&&(clearTimeout(B),B=null),ce&&ce.resetDisplayState&&ce.resetDisplayState(),ct(),console.log("🔄 [RestartSame] 同じ基音で再挑戦:",F,_+"Hz"),console.log("🔄 [RestartSame] 基音情報保持完了 - ユーザー操作待機")}async function vn(){if(s){console.warn("🚫 [RestartDifferent] 8セッション完了状態では再挑戦不可 - 新サイクル開始が必要"),await tt()?(console.log("✅ [RestartDifferent] 新サイクル開始完了 - セッション1/8から再開"),window.location.reload()):console.error("❌ [RestartDifferent] 新サイクル開始失敗");return}ot(),e(0,k="setup"),B&&(clearTimeout(B),B=null),e(7,F=""),e(8,_=0),console.log("🔄 [restartDifferentBaseNote] 基音情報をリセットしました"),ce&&ce.resetDisplayState&&ce.resetDisplayState(),ct()}function ct(){T=0,w=!1,ne=[],e(10,q=q.map(o=>({...o,state:"inactive",completed:!1})))}async function _n(){console.log("🚀 [StartNewCycle] 8セッション完了後の最初から挑戦開始");try{await tt()?(console.log("✅ [StartNewCycle] 新サイクル開始完了"),localStorage.getItem("mic-test-completed")?(console.log("✅ [StartNewCycle] マイクテスト完了フラグ確認 - リロードなしで状態リセット"),ot(),await bt(),e(0,k="setup"),ct(),dt(),console.log("✅ [StartNewCycle] 状態リセット完了 - セッション1/8から再開")):window.location.reload()):(console.error("❌ [StartNewCycle] 新サイクル開始失敗"),Ze())}catch(o){console.error("❌ [StartNewCycle] 新サイクル開始エラー:",o),Ze()}}function Sn(o){const{type:u}=o.detail;switch(u){case"same":pn();break;case"different":vn();break;case"restart":_n();break;case"home":Ze();break;default:console.warn("🚫 [ActionButtons] 未知のアクションタイプ:",u)}}function bn(){console.log("⚡ [ContinuousMode] 8セッション連続開始"),mt()}function qn(){console.log("✅ [ContinuousMode] セッション完了:",n),n<8?setTimeout(()=>{console.log("🔄 [ContinuousMode] 次セッション自動開始:",n+1),e(0,k="setup"),mt()},2e3):(console.log("🎉 [ContinuousMode] 8セッション完了！"),setTimeout(()=>{console.log("🏆 [ContinuousMode] 総合評価画面表示完了")},1e3))}function wn(o){const{healthy:u,errors:S,details:I}=o.detail;e(2,H=u),e(6,E=S),u||(console.warn("⚠️ マイクの健康状態が悪化:",S),k==="guiding"&&(e(0,k="setup"),console.warn("🛑 マイク問題によりトレーニングを停止")))}Fn(()=>{console.log("🔄 [RandomTraining] onDestroy - AudioManagerリソースは保持"),ue&&(ue.dispose(),e(32,ue=null))});const yo=[];Oo.keys(t).forEach(o=>{!~yo.indexOf(o)&&o.slice(0,2)!=="$$"&&o!=="slot"&&Go.warn(`<Page> was created with unknown prop '${o}'`)});function ho(o){qo[o?"unshift":"push"](()=>{ce=o,e(22,ce)})}return r.$capture_state=()=>({onMount:kn,onDestroy:Fn,goto:vt,base:it,page:_t,ChevronRight:Ho,Music:zn,Card:Qe,Button:ut,VolumeBar:Do,PitchDisplay:Vo,PitchDetector:Hn,PitchDetectionDisplay:Vn,PageLayout:Bn,Tone:Bo,audioManager:Ue,harmonicCorrection:St,logger:se,ScoreResultPanel:xo,IntervalProgressTracker:Po,ConsistencyGraph:Eo,FeedbackDisplay:Mo,SessionStatistics:Io,UnifiedScoreResultFixed:Xt,ActionButtons:Qt,EvaluationEngine:nt,EnhancedScoringEngine:Nn,trainingProgress:At,currentSessionId:Nt,nextBaseNote:Rt,nextBaseName:Ct,isLoading:Ft,storageError:To,isCompleted:kt,sessionHistory:Dt,overallGrade:Ao,overallAccuracy:No,progressPercentage:Ro,remainingSessions:wt,latestSessionResult:Co,unifiedScoreData:qt,loadProgress:bt,saveSessionResult:Rn,resetProgress:Fo,createNewProgress:ko,startNewCycleIfCompleted:tt,getVolumeForDevice:Mn,calculateUnifiedGrade:Y,generateTestUnifiedScoreData:Uo,trainingPhase:k,microphoneState:D,microphoneHealthy:H,microphoneErrors:E,buildVersion:Wt,buildTimestamp:Jt,updateStatus:Kt,SCALE_NAMES:J,currentBaseNote:F,currentBaseFrequency:_,isPlaying:K,currentScaleIndex:T,scaleSteps:q,guideAnimationTimer:B,isGuideAnimationActive:w,guideStartProgress:V,isGuideStartBarActive:M,guideStartTimer:Q,musicIconGlowing:ye,scaleEvaluations:ne,previousEvaluations:_e,currentVolume:Se,currentFrequency:Ee,detectedNote:je,pitchDifference:Ve,sessionResults:Le,scoringEngine:De,currentScoreData:He,intervalData:ke,consistencyData:Pe,feedbackData:Oe,technicalFeedbackData:Xe,sessionStatistics:Ce,activeTab:ft,noteResultsForDisplay:oe,currentUnifiedScoreData:le,sampler:ue,isSamplerLoading:Re,pitchDetectorComponent:ce,mediaStream:xe,audioContext:rt,sourceNode:at,sessionStartTime:We,baseNotes:Ge,checkMicrophonePermission:Je,selectRandomBaseNote:dt,playRandomBaseNote:Yt,playCurrentBaseNote:Zt,playBaseNoteOnly:io,playBaseNote:mt,startGuideStartBar:$t,cleanupGuideStartBar:lo,calculateExpectedFrequency:Ye,calculateTargetFrequency:en,startGuideAnimation:gt,finishGuideAnimation:tn,calculateFinalResults:nn,getStatusMessage:uo,getDisplayEvaluations:fo,goToMicrophoneTest:on,goHome:Ze,initializeSampler:rn,checkExistingMicrophonePermission:st,initializeScoringEngine:an,updateScoringEngine:sn,generateFinalScoring:cn,generateTestScoreData:ln,switchTab:mo,generateUnifiedScoreData:un,saveSessionToStorage:fn,generateEnhancedScoringData:dn,generateFallbackEnhancedData:yt,generateIntervalDataFromResults:It,generateIntervalDataFromSessionHistory:En,generateConsistencyDataFromResults:ht,generateFeedbackFromResults:pt,generateTechnicalFeedbackFromEnhancedEngine:mn,handlePitchUpdate:gn,getEvaluationCorrectedFrequency:yn,frequencyToNote:Pn,multiStageOctaveCorrection:Mt,evaluateScaleStep:hn,completeSession:go,restartSameBaseNote:pn,restartDifferentBaseNote:vn,scrollToTop:ot,resetSessionState:ct,startNewCycle:_n,handleActionButtonClick:Sn,startContinuousMode:bn,handleSessionComplete:qn,handlePitchDetectorStateChange:so,handlePitchDetectorError:co,handleMicrophoneHealthChange:wn,canRestartSession:c,canStartTraining:i,$currentSessionId:n,$unifiedScoreData:a,$isCompleted:s,$page:f,$remainingSessions:l,$nextBaseName:m,$nextBaseNote:d,$sessionHistory:y,$trainingProgress:b,$isLoading:h}),r.$inject_state=o=>{"trainingPhase"in o&&e(0,k=o.trainingPhase),"microphoneState"in o&&e(1,D=o.microphoneState),"microphoneHealthy"in o&&e(2,H=o.microphoneHealthy),"microphoneErrors"in o&&e(6,E=o.microphoneErrors),"currentBaseNote"in o&&e(7,F=o.currentBaseNote),"currentBaseFrequency"in o&&e(8,_=o.currentBaseFrequency),"isPlaying"in o&&e(9,K=o.isPlaying),"currentScaleIndex"in o&&(T=o.currentScaleIndex),"scaleSteps"in o&&e(10,q=o.scaleSteps),"guideAnimationTimer"in o&&(B=o.guideAnimationTimer),"isGuideAnimationActive"in o&&(w=o.isGuideAnimationActive),"guideStartProgress"in o&&e(11,V=o.guideStartProgress),"isGuideStartBarActive"in o&&(M=o.isGuideStartBarActive),"guideStartTimer"in o&&(Q=o.guideStartTimer),"musicIconGlowing"in o&&e(12,ye=o.musicIconGlowing),"scaleEvaluations"in o&&(ne=o.scaleEvaluations),"previousEvaluations"in o&&(_e=o.previousEvaluations),"currentVolume"in o&&e(13,Se=o.currentVolume),"currentFrequency"in o&&e(14,Ee=o.currentFrequency),"detectedNote"in o&&e(15,je=o.detectedNote),"pitchDifference"in o&&(Ve=o.pitchDifference),"sessionResults"in o&&(Le=o.sessionResults),"scoringEngine"in o&&(De=o.scoringEngine),"currentScoreData"in o&&e(16,He=o.currentScoreData),"intervalData"in o&&e(3,ke=o.intervalData),"consistencyData"in o&&e(17,Pe=o.consistencyData),"feedbackData"in o&&e(18,Oe=o.feedbackData),"technicalFeedbackData"in o&&e(19,Xe=o.technicalFeedbackData),"sessionStatistics"in o&&e(20,Ce=o.sessionStatistics),"activeTab"in o&&(ft=o.activeTab),"noteResultsForDisplay"in o&&(oe=o.noteResultsForDisplay),"currentUnifiedScoreData"in o&&e(21,le=o.currentUnifiedScoreData),"sampler"in o&&e(32,ue=o.sampler),"isSamplerLoading"in o&&e(33,Re=o.isSamplerLoading),"pitchDetectorComponent"in o&&e(22,ce=o.pitchDetectorComponent),"mediaStream"in o&&(xe=o.mediaStream),"audioContext"in o&&(rt=o.audioContext),"sourceNode"in o&&(at=o.sourceNode),"sessionStartTime"in o&&(We=o.sessionStartTime),"canRestartSession"in o&&(c=o.canRestartSession),"canStartTraining"in o&&(i=o.canStartTraining)},t&&"$$inject"in t&&r.$inject_state(t.$$inject),r.$$.update=()=>{r.$$.dirty[0]&6|r.$$.dirty[1]&6&&(i=D==="granted"&&!Re&&ue&&H),r.$$.dirty[0]&1&&(c=k==="results"),r.$$.dirty[0]&56&&a&&s&&a.sessionHistory&&(e(3,ke=En(a.sessionHistory)),console.log("🎵 [RandomTraining] intervalData生成完了:",ke.length,"件")),r.$$.dirty[0]&3&&k==="setup"&&D==="granted"&&ot()},[k,D,H,ke,a,s,E,F,_,K,q,V,ye,Se,Ee,je,He,Pe,Oe,Xe,Ce,le,ce,n,y,h,on,Ze,gn,Sn,bn,wn,ue,Re,ho]}class or extends po{constructor(t){super(t),vo(this,t,Wo,Ut,_o,{},null,[-1,-1,-1,-1]),ee("SvelteRegisterComponent",{component:this,tagName:"Page",options:t,id:Ut.name})}}export{or as component,nr as universal};
