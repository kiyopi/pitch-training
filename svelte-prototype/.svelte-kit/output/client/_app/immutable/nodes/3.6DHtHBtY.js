import{S as dt,i as mt,d as ie,s as pt,v as vt,c as gt,a as ht,F as Oe,b as u,q as Ee,r as Pe,u as Ie,f as z,w as Ve,H as _t,m as R,x as Ne,p as U,y as Ae,W as Qe,X as Tt,g as l,z as i,h as m,I as bt,j as _,k as D,B as be,A as W,o as T,C as Ce,L as $e,e as de,Y as De,N as Ct,J as ne,l as $,t as ee,K as Ge,n as qe}from"../chunks/DkMTtSlo.js";import{g as yt}from"../chunks/D0QH3NT1.js";import"../chunks/Dl4NPMRd.js";import{p as Re}from"../chunks/Bz-2I8h8.js";import{b as We,g as Xe}from"../chunks/C_gpnaUg.js";import{P as et,B as Mt,C as tt}from"../chunks/DFI0yG1U.js";import{a as ue,V as wt,P as st,b as nt}from"../chunks/Cf_vbt4Y.js";const St=!1,kt=!1,Ot=Object.freeze(Object.defineProperty({__proto__:null,prerender:kt,ssr:St},Symbol.toStringTag,{value:"Module"})),{console:Bt,document:Ze}=yt,p="src/routes/microphone-test/+page.svelte";function ot(n){let e,t="マイクのテストを開始します",f,a,d="マイクテスト開始ボタンを押してマイクの使用を許可してください",c,o;function r(w,v){if(w[0]==="pending")return ct;if(w[0]==="denied")return at;if(w[0]==="initial")return it}let C=r(n),b=C&&C(n);const A={c:function(){e=T("h3"),e.textContent=t,f=U(),a=T("p"),a.textContent=d,c=U(),b&&b.c(),o=Ge(),this.h()},l:function(v){e=_(v,"H3",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-gfi16f"&&(e.textContent=t),f=R(v),a=_(v,"P",{class:!0,"data-svelte-h":!0}),W(a)!=="svelte-1w19y1h"&&(a.textContent=d),c=R(v),b&&b.l(v),o=Ge(),this.h()},h:function(){i(e,"class","instructions-title svelte-prem1"),m(e,p,581,12,18787),i(a,"class","instructions-description svelte-prem1"),m(a,p,582,12,18849)},m:function(v,h){z(v,e,h),z(v,f,h),z(v,a,h),z(v,c,h),b&&b.m(v,h),z(v,o,h)},p:function(v,h){C===(C=r(v))&&b?b.p(v,h):(b&&b.d(1),b=C&&C(v),b&&(b.c(),b.m(o.parentNode,o)))},d:function(v){v&&(u(e),u(f),u(a),u(c),u(o)),b&&b.d(v)}};return ie("SvelteRegisterBlock",{block:A,id:ot.name,type:"else",source:"(580:10) {:else}",ctx:n}),A}function lt(n){let e,t="マイク準備完了",f,a,d="音量を調整してからトレーニングを開始してください",c,o,r,C,b,A=n[9]&&(n[9].isIOS||n[8].includes("その他")),w,v,h,y,V,j,q,x,E,N,te="-20dB",K,S,X,Q,Z="+10dB",P,g,k=n[7]?"再生中...":"ド(C4)を再生",H,J,I,Y,oe,le=n[6].toFixed(1)+"",ae,he,_e,se,s,B="0.1x",L,F,me,ce,Le="10.0x",Me,fe,re,Fe="トレーニング開始",xe,ze,G=A&&Ue(n);const He={c:function(){e=T("h3"),e.textContent=t,f=U(),a=T("p"),a.textContent=d,c=U(),o=T("div"),r=T("span"),C=ee(n[8]),b=U(),G&&G.c(),w=U(),v=T("div"),h=T("div"),y=T("label"),V=ee("基音音量: "),j=ee(n[5]),q=ee("dB"),x=U(),E=T("div"),N=T("span"),N.textContent=te,K=U(),S=T("input"),X=U(),Q=T("span"),Q.textContent=Z,P=U(),g=T("button"),H=ee(k),J=U(),I=T("div"),Y=T("label"),oe=ee("マイク感度: "),ae=ee(le),he=ee("x"),_e=U(),se=T("div"),s=T("span"),s.textContent=B,L=U(),F=T("input"),me=U(),ce=T("span"),ce.textContent=Le,Me=U(),fe=T("div"),re=T("button"),re.textContent=Fe,this.h()},l:function(M){e=_(M,"H3",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-11dam81"&&(e.textContent=t),f=R(M),a=_(M,"P",{class:!0,"data-svelte-h":!0}),W(a)!=="svelte-1pr7rqg"&&(a.textContent=d),c=R(M),o=_(M,"DIV",{class:!0});var O=D(o);r=_(O,"SPAN",{class:!0});var Je=D(r);C=$(Je,n[8]),Je.forEach(u),O.forEach(u),b=R(M),G&&G.l(M),w=R(M),v=_(M,"DIV",{class:!0});var we=D(v);h=_(we,"DIV",{class:!0});var pe=D(h);y=_(pe,"LABEL",{class:!0});var Se=D(y);V=$(Se,"基音音量: "),j=$(Se,n[5]),q=$(Se,"dB"),Se.forEach(u),x=R(pe),E=_(pe,"DIV",{class:!0});var ve=D(E);N=_(ve,"SPAN",{class:!0,"data-svelte-h":!0}),W(N)!=="svelte-5u5ai6"&&(N.textContent=te),K=R(ve),S=_(ve,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),X=R(ve),Q=_(ve,"SPAN",{class:!0,"data-svelte-h":!0}),W(Q)!=="svelte-ptz1f5"&&(Q.textContent=Z),ve.forEach(u),P=R(pe),g=_(pe,"BUTTON",{class:!0});var Ye=D(g);H=$(Ye,k),Ye.forEach(u),pe.forEach(u),J=R(we),I=_(we,"DIV",{class:!0});var ke=D(I);Y=_(ke,"LABEL",{class:!0});var Be=D(Y);oe=$(Be,"マイク感度: "),ae=$(Be,le),he=$(Be,"x"),Be.forEach(u),_e=R(ke),se=_(ke,"DIV",{class:!0});var ge=D(se);s=_(ge,"SPAN",{class:!0,"data-svelte-h":!0}),W(s)!=="svelte-1m4xt2o"&&(s.textContent=B),L=R(ge),F=_(ge,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),me=R(ge),ce=_(ge,"SPAN",{class:!0,"data-svelte-h":!0}),W(ce)!=="svelte-1jlarki"&&(ce.textContent=Le),ge.forEach(u),ke.forEach(u),we.forEach(u),Me=R(M),fe=_(M,"DIV",{class:!0});var Ke=D(fe);re=_(Ke,"BUTTON",{class:!0,"data-svelte-h":!0}),W(re)!=="svelte-kae9rs"&&(re.textContent=Fe),Ke.forEach(u),this.h()},h:function(){i(e,"class","ready-title svelte-prem1"),m(e,p,496,12,15480),i(a,"class","ready-description svelte-prem1"),m(a,p,497,12,15529),i(r,"class","device-label svelte-prem1"),m(r,p,501,14,15687),i(o,"class","device-info svelte-prem1"),m(o,p,500,12,15647),i(y,"class","volume-label svelte-prem1"),m(y,p,528,16,16853),i(N,"class","slider-min svelte-prem1"),m(N,p,532,18,17022),i(S,"type","range"),i(S,"min","-20"),i(S,"max","10"),i(S,"step","1"),i(S,"class","volume-slider svelte-prem1"),m(S,p,533,18,17078),i(Q,"class","slider-max svelte-prem1"),m(Q,p,542,18,17391),i(E,"class","volume-slider-container svelte-prem1"),m(E,p,531,16,16966),i(g,"class","base-tone-test-button svelte-prem1"),g.disabled=n[7],m(g,p,544,16,17468),i(h,"class","volume-control-section svelte-prem1"),m(h,p,527,14,16800),i(Y,"class","volume-label svelte-prem1"),m(Y,p,555,16,17854),i(s,"class","slider-min svelte-prem1"),m(s,p,559,18,18034),i(F,"type","range"),i(F,"min","0.1"),i(F,"max","10.0"),i(F,"step","0.1"),i(F,"class","volume-slider svelte-prem1"),m(F,p,560,18,18089),i(ce,"class","slider-max svelte-prem1"),m(ce,p,569,18,18406),i(se,"class","volume-slider-container svelte-prem1"),m(se,p,558,16,17978),i(I,"class","volume-control-section svelte-prem1"),m(I,p,554,14,17801),i(v,"class","volume-controls svelte-prem1"),m(v,p,525,12,16726),i(re,"class","training-start-button enabled svelte-prem1"),m(re,p,575,14,18587),i(fe,"class","training-start-button-area svelte-prem1"),m(fe,p,574,12,18532)},m:function(M,O){z(M,e,O),z(M,f,O),z(M,a,O),z(M,c,O),z(M,o,O),l(o,r),l(r,C),z(M,b,O),G&&G.m(M,O),z(M,w,O),z(M,v,O),l(v,h),l(h,y),l(y,V),l(y,j),l(y,q),l(h,x),l(h,E),l(E,N),l(E,K),l(E,S),De(S,n[5]),l(E,X),l(E,Q),l(h,P),l(h,g),l(g,H),l(v,J),l(v,I),l(I,Y),l(Y,oe),l(Y,ae),l(Y,he),l(I,_e),l(I,se),l(se,s),l(se,L),l(se,F),De(F,n[6]),l(se,me),l(se,ce),z(M,Me,O),z(M,fe,O),l(fe,re),xe||(ze=[ne(S,"change",n[20]),ne(S,"input",n[20]),ne(S,"input",n[14],!1,!1,!1,!1),ne(g,"click",n[15],!1,!1,!1,!1),ne(F,"change",n[21]),ne(F,"input",n[21]),ne(F,"input",n[16],!1,!1,!1,!1),ne(re,"click",n[11],!1,!1,!1,!1)],xe=!0)},p:function(M,O){O[0]&256&&de(C,M[8]),O[0]&768&&(A=M[9]&&(M[9].isIOS||M[8].includes("その他"))),A?G?G.p(M,O):(G=Ue(M),G.c(),G.m(w.parentNode,w)):G&&(G.d(1),G=null),O[0]&32&&de(j,M[5]),O[0]&32&&De(S,M[5]),O[0]&128&&k!==(k=M[7]?"再生中...":"ド(C4)を再生")&&de(H,k),O[0]&128&&Ct(g,"disabled",M[7]),O[0]&64&&le!==(le=M[6].toFixed(1)+"")&&de(ae,le),O[0]&64&&De(F,M[6])},d:function(M){M&&(u(e),u(f),u(a),u(c),u(o),u(b),u(w),u(v),u(Me),u(fe)),G&&G.d(M),xe=!1,$e(ze)}};return ie("SvelteRegisterBlock",{block:He,id:lt.name,type:"if",source:"(495:10) {#if micPermission === 'granted'}",ctx:n}),He}function it(n){let e,t,f="マイクテストを開始",a,d;const c={c:function(){e=T("div"),t=T("button"),t.textContent=f,this.h()},l:function(r){e=_(r,"DIV",{class:!0});var C=D(e);t=_(C,"BUTTON",{class:!0,"data-svelte-h":!0}),W(t)!=="svelte-caex95"&&(t.textContent=f),C.forEach(u),this.h()},h:function(){i(t,"class","mic-test-button start svelte-prem1"),m(t,p,594,16,19404),i(e,"class","mic-test-button-area svelte-prem1"),m(e,p,593,14,19353)},m:function(r,C){z(r,e,C),l(e,t),a||(d=ne(t,"click",n[10],!1,!1,!1,!1),a=!0)},p:qe,d:function(r){r&&u(e),a=!1,d()}};return ie("SvelteRegisterBlock",{block:c,id:it.name,type:"if",source:"(593:50) ",ctx:n}),c}function at(n){let e,t,f="マイク許可を再試行",a,d;const c={c:function(){e=T("div"),t=T("button"),t.textContent=f,this.h()},l:function(r){e=_(r,"DIV",{class:!0});var C=D(e);t=_(C,"BUTTON",{class:!0,"data-svelte-h":!0}),W(t)!=="svelte-1p3n8nt"&&(t.textContent=f),C.forEach(u),this.h()},h:function(){i(t,"class","mic-test-button retry svelte-prem1"),m(t,p,588,16,19145),i(e,"class","mic-test-button-area svelte-prem1"),m(e,p,587,14,19094)},m:function(r,C){z(r,e,C),l(e,t),a||(d=ne(t,"click",n[10],!1,!1,!1,!1),a=!0)},p:qe,d:function(r){r&&u(e),a=!1,d()}};return ie("SvelteRegisterBlock",{block:c,id:at.name,type:"if",source:"(587:49) ",ctx:n}),c}function ct(n){let e,t="マイク準備中...";const f={c:function(){e=T("p"),e.textContent=t,this.h()},l:function(d){e=_(d,"P",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-1vb5g92"&&(e.textContent=t),this.h()},h:function(){i(e,"class","status-text svelte-prem1"),m(e,p,585,14,18993)},m:function(d,c){z(d,e,c)},p:qe,d:function(d){d&&u(e)}};return ie("SvelteRegisterBlock",{block:f,id:ct.name,type:"if",source:"(585:12) {#if micPermission === 'pending'}",ctx:n}),f}function Ue(n){var X,Q;let e,t,f=n[9].isIOS?`${n[9].deviceType}専用設定`:"高感度設定（テスト用）",a,d,c,o,r="高感度設定",C,b,A="超高感度設定",w,v,h,y,V=((X=n[9])==null?void 0:X.divisor)+"",j,q,x=((Q=n[9])==null?void 0:Q.gainCompensation)+"",E,N,te,K;const S={c:function(){e=T("div"),t=T("h4"),a=ee(f),d=U(),c=T("div"),o=T("button"),o.textContent=r,C=U(),b=T("button"),b.textContent=A,w=U(),v=T("div"),h=T("small"),y=ee("仕様書準拠: divisor="),j=ee(V),q=ee(", gain="),E=ee(x),N=ee("x"),this.h()},l:function(P){e=_(P,"DIV",{class:!0});var g=D(e);t=_(g,"H4",{class:!0});var k=D(t);a=$(k,f),k.forEach(u),d=R(g),c=_(g,"DIV",{class:!0});var H=D(c);o=_(H,"BUTTON",{class:!0,"data-svelte-h":!0}),W(o)!=="svelte-1skmm1s"&&(o.textContent=r),C=R(H),b=_(H,"BUTTON",{class:!0,"data-svelte-h":!0}),W(b)!=="svelte-1lgelbb"&&(b.textContent=A),H.forEach(u),w=R(g),v=_(g,"DIV",{class:!0});var J=D(v);h=_(J,"SMALL",{class:!0});var I=D(h);y=$(I,"仕様書準拠: divisor="),j=$(I,V),q=$(I,", gain="),E=$(I,x),N=$(I,"x"),I.forEach(u),J.forEach(u),g.forEach(u),this.h()},h:function(){i(t,"class","preset-title svelte-prem1"),m(t,p,507,16,15948),i(o,"class","preset-button svelte-prem1"),m(o,p,511,18,16151),i(b,"class","preset-button svelte-prem1"),m(b,p,514,18,16296),i(c,"class","preset-buttons svelte-prem1"),m(c,p,510,16,16104),i(h,"class","svelte-prem1"),m(h,p,519,18,16511),i(v,"class","preset-specs svelte-prem1"),m(v,p,518,16,16466),i(e,"class","preset-section svelte-prem1"),m(e,p,506,14,15903)},m:function(P,g){z(P,e,g),l(e,t),l(t,a),l(e,d),l(e,c),l(c,o),l(c,C),l(c,b),l(e,w),l(e,v),l(v,h),l(h,y),l(h,j),l(h,q),l(h,E),l(h,N),te||(K=[ne(o,"click",n[18],!1,!1,!1,!1),ne(b,"click",n[19],!1,!1,!1,!1)],te=!0)},p:function(P,g){var k,H;g[0]&512&&f!==(f=P[9].isIOS?`${P[9].deviceType}専用設定`:"高感度設定（テスト用）")&&de(a,f),g[0]&512&&V!==(V=((k=P[9])==null?void 0:k.divisor)+"")&&de(j,V),g[0]&512&&x!==(x=((H=P[9])==null?void 0:H.gainCompensation)+"")&&de(E,x)},d:function(P){P&&u(e),te=!1,$e(K)}};return ie("SvelteRegisterBlock",{block:S,id:Ue.name,type:"if",source:"(506:12) {#if platformSpecs && (platformSpecs.isIOS || deviceInfo.includes('その他'))}",ctx:n}),S}function rt(n){let e;function t(c,o){return c[0]==="granted"?lt:ot}let f=t(n),a=f(n);const d={c:function(){e=T("div"),a.c(),this.h()},l:function(o){e=_(o,"DIV",{class:!0});var r=D(e);a.l(r),r.forEach(u),this.h()},h:function(){i(e,"class","training-mode-content svelte-prem1"),m(e,p,493,8,15349)},m:function(o,r){z(o,e,r),a.m(e,null)},p:function(o,r){f===(f=t(o))&&a?a.p(o,r):(a.d(1),a=f(o),a&&(a.c(),a.m(e,null)))},d:function(o){o&&u(e),a.d()}};return ie("SvelteRegisterBlock",{block:d,id:rt.name,type:"slot",source:'(493:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:n}),d}function ut(n){let e,t,f,a,d,c,o,r,C,b,A,w,v="マイクテスト",h,y,V="音感トレーニングを始める前に、マイクの動作を確認します",j,q,x,E,N,te,K,S,X;x=new tt({props:{variant:"default",padding:"lg",$$slots:{default:[rt]},$$scope:{ctx:n}},$$inline:!0}),N=new st({props:{frequency:n[2],note:n[3],volume:n[1],isMuted:n[0]!=="granted",muteMessage:"マイク許可後に開始"},$$inline:!0});let Q={isActive:n[0]==="granted",className:"pitch-detector-content",debugMode:!1};S=new nt({props:Q,$$inline:!0}),n[22](S),S.$on("pitchUpdate",n[12]),S.$on("stateChange",ft),S.$on("error",n[13]);const Z={c:function(){e=T("div"),t=T("div"),f=T("div"),a=T("div"),d=Ce("svg"),c=Ce("path"),o=Ce("path"),r=Ce("line"),C=Ce("line"),b=U(),A=T("div"),w=T("h1"),w.textContent=v,h=U(),y=T("p"),y.textContent=V,j=U(),q=T("div"),Ae(x.$$.fragment),E=U(),Ae(N.$$.fragment),te=U(),K=T("div"),Ae(S.$$.fragment),this.h()},l:function(g){e=_(g,"DIV",{class:!0});var k=D(e);t=_(k,"DIV",{class:!0});var H=D(t);f=_(H,"DIV",{class:!0});var J=D(f);a=_(J,"DIV",{class:!0});var I=D(a);d=be(I,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var Y=D(d);c=be(Y,"path",{d:!0}),D(c).forEach(u),o=be(Y,"path",{d:!0}),D(o).forEach(u),r=be(Y,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),D(r).forEach(u),C=be(Y,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),D(C).forEach(u),Y.forEach(u),I.forEach(u),b=R(J),A=_(J,"DIV",{});var oe=D(A);w=_(oe,"H1",{class:!0,"data-svelte-h":!0}),W(w)!=="svelte-z7m4lk"&&(w.textContent=v),h=R(oe),y=_(oe,"P",{class:!0,"data-svelte-h":!0}),W(y)!=="svelte-1vtv92f"&&(y.textContent=V),oe.forEach(u),J.forEach(u),H.forEach(u),j=R(k),q=_(k,"DIV",{class:!0});var le=D(q);Ne(x.$$.fragment,le),le.forEach(u),E=R(k),Ne(N.$$.fragment,k),te=R(k),K=_(k,"DIV",{style:!0});var ae=D(K);Ne(S.$$.fragment,ae),ae.forEach(u),k.forEach(u),this.h()},h:function(){i(c,"d","M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"),m(c,p,477,12,14807),i(o,"d","M19 10v2a7 7 0 0 1-14 0v-2"),m(o,p,478,12,14884),i(r,"x1","12"),i(r,"x2","12"),i(r,"y1","19"),i(r,"y2","22"),m(r,p,479,12,14935),i(C,"x1","8"),i(C,"x2","16"),i(C,"y1","22"),i(C,"y2","22"),m(C,p,480,12,14987),i(d,"width","48"),i(d,"height","48"),i(d,"viewBox","0 0 24 24"),i(d,"fill","none"),i(d,"stroke","currentColor"),i(d,"stroke-width","2"),m(d,p,476,10,14695),i(a,"class","mic-icon svelte-prem1"),m(a,p,475,8,14662),i(w,"class","mic-test-title svelte-prem1"),m(w,p,484,10,15082),i(y,"class","mic-test-description svelte-prem1"),m(y,p,485,10,15131),m(A,p,483,8,15066),i(f,"class","mic-test-header svelte-prem1"),m(f,p,474,6,14624),i(t,"class","header svelte-prem1"),m(t,p,473,4,14597),i(q,"class","training-mode-info svelte-prem1"),m(q,p,491,4,15264),bt(K,"display","none"),m(K,p,614,4,19908),i(e,"class","microphone-test svelte-prem1"),m(e,p,471,2,14545)},m:function(g,k){z(g,e,k),l(e,t),l(t,f),l(f,a),l(a,d),l(d,c),l(d,o),l(d,r),l(d,C),l(f,b),l(f,A),l(A,w),l(A,h),l(A,y),l(e,j),l(e,q),Ve(x,q,null),l(e,E),Ve(N,e,null),l(e,te),l(e,K),Ve(S,K,null),X=!0},p:function(g,k){const H={};k[0]&993|k[1]&16&&(H.$$scope={dirty:k,ctx:g}),x.$set(H);const J={};k[0]&4&&(J.frequency=g[2]),k[0]&8&&(J.note=g[3]),k[0]&2&&(J.volume=g[1]),k[0]&1&&(J.isMuted=g[0]!=="granted"),N.$set(J);const I={};k[0]&1&&(I.isActive=g[0]==="granted"),S.$set(I)},i:function(g){X||(Ie(x.$$.fragment,g),Ie(N.$$.fragment,g),Ie(S.$$.fragment,g),X=!0)},o:function(g){Pe(x.$$.fragment,g),Pe(N.$$.fragment,g),Pe(S.$$.fragment,g),X=!1},d:function(g){g&&u(e),Ee(x),Ee(N),n[22](null),Ee(S)}};return ie("SvelteRegisterBlock",{block:Z,id:ut.name,type:"slot",source:"(471:0) <PageLayout showBackButton={true}>",ctx:n}),Z}function je(n){let e,t,f;t=new et({props:{showBackButton:!0,$$slots:{default:[ut]},$$scope:{ctx:n}},$$inline:!0});const a={c:function(){e=U(),Ae(t.$$.fragment),this.h()},l:function(c){_t("svelte-8st1fo",Ze.head).forEach(u),e=R(c),Ne(t.$$.fragment,c),this.h()},h:function(){Ze.title="マイクテスト - 相対音感トレーニング"},m:function(c,o){z(c,e,o),Ve(t,c,o),f=!0},p:function(c,o){const r={};o[0]&1023|o[1]&16&&(r.$$scope={dirty:o,ctx:c}),t.$set(r)},i:function(c){f||(Ie(t.$$.fragment,c),f=!0)},o:function(c){Pe(t.$$.fragment,c),f=!1},d:function(c){c&&u(e),Ee(t,c)}};return ie("SvelteRegisterBlock",{block:a,id:je.name,type:"component",source:"",ctx:n}),a}function ft(n){}async function ye(){if(typeof window<"u"&&window.Tone){const n=window.Tone.context||window.Tone.getContext();if(n&&n.state==="suspended")return console.log("🔄 [MicTest] AudioContext suspended検出 - 再開中..."),await n.resume(),console.log("✅ [MicTest] AudioContext再開完了"),!0}return!1}function Dt(n,e,t){let f;vt(Re,"page"),gt(n,Re,s=>t(28,f=s));let{$$slots:a={},$$scope:d}=e;ht("Page",a,[]);let c="random";Oe(()=>{f.url.searchParams.has("mode")&&(c=f.url.searchParams.get("mode")||"random")});let o="initial",r="idle",C=null,b=0,A=0,w=0,v="ーー",h=null,y=0,V=1,j=null,q=!1,x="",E=null;Oe(()=>{console.log("🔍 [MicTest-Debug] localStorage完全状態確認開始"),console.log("🔍 [MicTest-Debug] localStorage使用可能:",typeof Storage<"u"),console.log("🔍 [MicTest-Debug] localStorage.length:",localStorage.length),console.log("🔍 [MicTest-Debug] localStorage全内容:");for(let L=0;L<localStorage.length;L++){const F=localStorage.key(L),me=localStorage.getItem(F);console.log(`   ${F}: ${me}`)}const s="pitch-training-audio-settings",B=localStorage.getItem(s);if(console.log(`🔍 [MicTest-Debug] 対象キー '${s}' 存在:`,B!==null),console.log("🔍 [MicTest-Debug] 対象キー内容:",B),B)try{const L=JSON.parse(B);console.log("🔍 [MicTest-Debug] パース済み内容:",L),console.log("🔍 [MicTest-Debug] baseToneVolume値:",L.baseToneVolume)}catch(L){console.error("🔍 [MicTest-Debug] JSON パースエラー:",L)}t(9,E=ue.getPlatformSpecs()),t(8,x=`${E.deviceType}検出`);try{t(5,y=ue.getBaseToneVolume()),console.log(`📖 [MicTest] 保存済み基音音量読み込み: ${y}dB`)}catch(L){console.warn("⚠️ [MicTest] 基音音量読み込みエラー - デフォルト使用:",L),t(5,y=E.isIOS?0:-6)}console.log(`🔍 [MicTest] デバイス情報: ${x}`,navigator.userAgent),console.log(`🔍 [MicTest] タッチサポート: ${"ontouchend"in document}`),console.log(`📊 [MicTest] プラットフォーム仕様適用: divisor=${E.divisor}, gain=${E.gainCompensation}`)});const N={random:{name:"ランダム基音モード",description:"10種類の基音からランダムに選択してトレーニング",color:"green",path:"/training/random"},continuous:{name:"連続チャレンジモード",description:"選択した回数だけ連続で実行し、総合評価を確認",color:"orange",path:"/training/continuous"},chromatic:{name:"12音階モード",description:"クロマチックスケールの上行・下行で完全制覇",color:"purple",path:"/training/chromatic"}},te=N[c]||N.random;async function K(){var s;t(0,o="pending");try{if(console.log("🎤 [MicTest] マイク許可リクエスト開始"),!((s=navigator.mediaDevices)!=null&&s.getUserMedia)){t(0,o="denied"),console.error("❌ [MicTest] getUserMediaがサポートされていません");return}const B=await ue.initialize();if(console.log("✅ [MicTest] AudioManager リソース取得完了"),B.mediaStream&&B.audioContext)t(0,o="granted"),console.log("✅ [MicTest] マイク許可完了"),await ye(),await Y(),setTimeout(async()=>{h&&(console.log("🎙️ [MicTest] PitchDetector初期化開始"),await ye(),await h.initialize(),console.log("✅ [MicTest] PitchDetector初期化完了"),console.log("🎯 [MicTest] PitchDetector isActiveリアクティブで自動検出開始"))},1e3);else throw new Error("リソース取得失敗")}catch(B){console.error("❌ [MicTest] マイク許可エラー:",B),t(0,o=((B==null?void 0:B.name)==="NotAllowedError","denied"))}}function S(){console.log("🚀 [MicTest] トレーニング開始 - ランダム基音モードへ遷移"),localStorage.setItem("mic-test-completed","true"),console.log(`✅ [MicTest] マイクテスト完了フラグ保存（基音音量は既に${y}dBで保存済み）`),Xe(`${We}${te.path}?from=microphone-test`)}function X(s){const{frequency:B,note:L,volume:F,rawVolume:me,clarity:ce}=s.detail;t(2,w=B),t(3,v=L),t(1,A=F),B>0&&H(B)}function Q(s){console.error("❌ [MicTest] PitchDetectorエラー:",s.detail);const{error:B,reason:L,recovery:F}=s.detail;L==="mediastream_ended"&&F==="restart_required"&&(console.log("🔄 [MicTest] MediaStream終了検出 - 自動復旧開始"),t(0,o="initial"),t(1,A=0),t(2,w=0),t(3,v="ーー"),console.log("⚠️ [MicTest] マイク再許可が必要です"))}async function Z(){try{if(console.log("🎹 [MicTest] 基音テスト初期化開始"),typeof window<"u"){if(!window.Tone){console.log("📦 [MicTest] Tone.js動的読み込み開始");const s=document.createElement("script");s.src="https://unpkg.com/tone@latest/build/Tone.js",document.head.appendChild(s),await new Promise((B,L)=>{s.onload=B,s.onerror=L}),console.log("✅ [MicTest] Tone.js読み込み完了")}await window.Tone.start(),j=new window.Tone.Sampler({urls:{C4:"C4.mp3"},baseUrl:"https://tonejs.github.io/audio/salamander/",release:1.5,onload:()=>{console.log("✅ [MicTest] 基音サンプラー読み込み完了")},onerror:s=>{console.error("❌ [MicTest] 基音サンプラー読み込みエラー:",s)}}).toDestination(),P()}else console.warn("⚠️ [MicTest] window未定義 - 基音テスト無効")}catch(s){console.error("❌ [MicTest] 基音テスト初期化エラー:",s)}}function P(){console.log(`🔊 [MicTest-Debug] 基音音量更新開始: ${y}dB`),j&&(j.volume.value=y,console.log(`🔊 [MicTest] Tone.js Sampler音量設定: ${y}dB`));try{console.log("🔍 [MicTest-Debug] AudioManager保存前のlocalStorage状態確認");const s=localStorage.getItem("pitch-training-audio-settings");console.log("🔍 [MicTest-Debug] 保存前データ:",s);const B=ue.setBaseToneVolume(y);console.log("🔍 [MicTest-Debug] AudioManager保存後のlocalStorage状態確認");const L=localStorage.getItem("pitch-training-audio-settings");if(console.log("🔍 [MicTest-Debug] 保存後データ:",L),B){console.log(`✅ [MicTest] 基音音量をlocalStorageに保存成功: ${y}dB`);const F=ue.getBaseToneVolume();console.log(`🔍 [MicTest-Debug] 保存直後検証読み込み: ${F}dB`)}else console.warn(`⚠️ [MicTest] 基音音量保存失敗: ${y}dB`)}catch(s){console.error("❌ [MicTest] AudioManager基音音量保存エラー:",s)}}async function g(){if(!(!j||q))try{t(7,q=!0),console.log("🎵 [MicTest] 基音再生開始: C4"),await ye()&&console.log("🔊 [MicTest] AudioContext再開後に基音再生実行"),await j.triggerAttackRelease("C4",2,window.Tone.now(),.7),setTimeout(()=>{t(7,q=!1),console.log("✅ [MicTest] 基音再生完了")},2e3)}catch(s){console.error("❌ [MicTest] 基音再生エラー:",s),t(7,q=!1)}}async function k(){if(!(!j||r!=="idle"))try{r="playing",b=0,console.log("🎵 [BaseToneTest] C3基音テスト開始"),await ye(),await j.triggerAttackRelease("C3",3,window.Tone.now(),.8),setTimeout(()=>{r==="playing"&&(r="detecting",console.log("🎤 [BaseToneTest] C3検出モード開始"),C=setTimeout(()=>{r==="detecting"&&(r="idle",console.log("⏱️ [BaseToneTest] タイムアウト - 再試行してください"))},1e4))},3e3)}catch(s){console.error("❌ [BaseToneTest] エラー:",s),r="idle"}}function H(s){if(r!=="detecting")return;Math.abs(s-130.81)<=10?(b++,console.log(`🎯 [BaseToneTest] C3検出カウント: ${b}`),b>=5&&(r="success",C&&(clearTimeout(C),C=null),console.log("✅ [BaseToneTest] C3検出成功！"))):b=0}function J(){try{ue.setSensitivity(V),console.log(`🎤 [MicTest] マイク感度更新完了: ${V}x`)}catch(s){console.error("❌ [MicTest] マイク感度調整エラー:",s)}}function I(s){const B=ue.getPlatformSpecs();switch(s){case"ipad-high":t(5,y=3),t(6,V=B.gainCompensation*2);break;case"ipad-extreme":t(5,y=7),t(6,V=B.gainCompensation*4);break;default:return}P(),J(),console.log(`🎯 [MicTest] ${s} プリセット適用: 基音${y}dB, マイク${V}x`),console.log(`📊 [MicTest] プラットフォーム仕様: divisor=${B.divisor}, gainCompensation=${B.gainCompensation}, デバイス=${B.deviceType}`)}async function Y(){await Z();try{t(6,V=ue.getSensitivity()),console.log(`🎤 [MicTest] 現在のマイク感度取得: ${V}x`)}catch(s){console.warn("⚠️ [MicTest] マイク感度取得エラー:",s)}}const oe=[];Object.keys(e).forEach(s=>{!~oe.indexOf(s)&&s.slice(0,2)!=="$$"&&s!=="slot"&&Bt.warn(`<Page> was created with unknown prop '${s}'`)});const le=()=>I("ipad-high"),ae=()=>I("ipad-extreme");function he(){y=Qe(this.value),t(5,y)}function _e(){V=Qe(this.value),t(6,V)}function se(s){Tt[s?"unshift":"push"](()=>{h=s,t(4,h)})}return n.$capture_state=()=>({onMount:Oe,page:Re,goto:Xe,base:We,Card:tt,Button:Mt,PageLayout:et,PitchDetector:nt,PitchDetectionDisplay:st,VolumeBar:wt,audioManager:ue,mode:c,micPermission:o,baseToneTestState:r,baseToneTestTimer:C,c3DetectionCount:b,currentVolume:A,currentFrequency:w,detectedNote:v,pitchDetectorComponent:h,baseToneVolume:y,micSensitivity:V,sampler:j,isBaseTonePlaying:q,deviceInfo:x,platformSpecs:E,trainingModes:N,selectedMode:te,requestMicrophone:K,startTraining:S,handlePitchUpdate:X,handlePitchDetectorStateChange:ft,handlePitchDetectorError:Q,initializeBaseToneTest:Z,updateBaseToneVolume:P,ensureAudioContextRunning:ye,playBaseTone:g,startBaseToneTest:k,checkC3Detection:H,updateMicSensitivity:J,applyPreset:I,onMicrophoneGranted:Y,$page:f}),n.$inject_state=s=>{"mode"in s&&(c=s.mode),"micPermission"in s&&t(0,o=s.micPermission),"baseToneTestState"in s&&(r=s.baseToneTestState),"baseToneTestTimer"in s&&(C=s.baseToneTestTimer),"c3DetectionCount"in s&&(b=s.c3DetectionCount),"currentVolume"in s&&t(1,A=s.currentVolume),"currentFrequency"in s&&t(2,w=s.currentFrequency),"detectedNote"in s&&t(3,v=s.detectedNote),"pitchDetectorComponent"in s&&t(4,h=s.pitchDetectorComponent),"baseToneVolume"in s&&t(5,y=s.baseToneVolume),"micSensitivity"in s&&t(6,V=s.micSensitivity),"sampler"in s&&(j=s.sampler),"isBaseTonePlaying"in s&&t(7,q=s.isBaseTonePlaying),"deviceInfo"in s&&t(8,x=s.deviceInfo),"platformSpecs"in s&&t(9,E=s.platformSpecs)},e&&"$$inject"in e&&n.$inject_state(e.$$inject),[o,A,w,v,h,y,V,q,x,E,K,S,X,Q,P,g,J,I,le,ae,he,_e,se]}class Rt extends dt{constructor(e){super(e),mt(this,e,Dt,je,pt,{},null,[-1,-1]),ie("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:je.name})}}export{Rt as component,Ot as universal};
