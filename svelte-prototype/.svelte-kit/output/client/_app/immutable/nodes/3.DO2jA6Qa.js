import{S as ee,i as ne,d as F,s as oe,v as ie,c as le,a as se,D as mt,E as St,b as m,q as it,r as X,u as K,f as z,w as lt,F as ce,m as L,x as st,p as H,y as ct,g as _,z as h,h as g,j as p,k as B,B as rt,A as G,o as k,C as at,G as Pt,H as Mt,l as Y,t as Q,n as dt,e as _t,I as ft,J as zt,K as ut}from"../chunks/EvMzC0aQ.js";import{g as re}from"../chunks/D0QH3NT1.js";import"../chunks/DrEUfQCr.js";import{p as ht}from"../chunks/CySesqXl.js";import{P as Ft,B as Dt,C as gt}from"../chunks/yXPAb40O.js";import{P as ae,V as Rt}from"../chunks/CmUJIz7r.js";const{console:ue}=re,y="src/routes/microphone-test/+page.svelte";function Nt(s){let t,e="❌ マイクアクセスエラーが発生しました",l,n,o="マイク許可を再試行",i,u;const r={c:function(){t=k("div"),t.textContent=e,l=H(),n=k("button"),n.textContent=o,this.h()},l:function(c){t=p(c,"DIV",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-11p6bhs"&&(t.textContent=e),l=L(c),n=p(c,"BUTTON",{class:!0,"data-svelte-h":!0}),G(n)!=="svelte-1co4n23"&&(n.textContent=o),this.h()},h:function(){h(t,"class","status-indicator error svelte-ztuqv4"),g(t,y,451,14,13404),h(n,"class","retry-button svelte-ztuqv4"),g(n,y,452,14,13480)},m:function(c,a){z(c,t,a),z(c,l,a),z(c,n,a),i||(u=zt(n,"click",s[11],!1),i=!0)},p:dt,d:function(c){c&&(m(t),m(l),m(n)),i=!1,u()}};return F("SvelteRegisterBlock",{block:r,id:Nt.name,type:"if",source:"(451:48) ",ctx:s}),r}function Lt(s){let t,e="❌ マイクアクセスが拒否されました",l,n,o="マイク許可を再試行",i,u;const r={c:function(){t=k("div"),t.textContent=e,l=H(),n=k("button"),n.textContent=o,this.h()},l:function(c){t=p(c,"DIV",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-4rewx4"&&(t.textContent=e),l=L(c),n=p(c,"BUTTON",{class:!0,"data-svelte-h":!0}),G(n)!=="svelte-1co4n23"&&(n.textContent=o),this.h()},h:function(){h(t,"class","status-indicator error svelte-ztuqv4"),g(t,y,446,14,13158),h(n,"class","retry-button svelte-ztuqv4"),g(n,y,447,14,13232)},m:function(c,a){z(c,t,a),z(c,l,a),z(c,n,a),i||(u=zt(n,"click",s[11],!1),i=!0)},p:dt,d:function(c){c&&(m(t),m(l),m(n)),i=!1,u()}};return F("SvelteRegisterBlock",{block:r,id:Lt.name,type:"if",source:"(446:49) ",ctx:s}),r}function Ht(s){let t,e="✅ マイクアクセス許可済み",l,n,o;function i(a,d){return a[6]?jt:Wt}let u=i(s),r=u(s),f=s[8]&&yt(s);const c={c:function(){t=k("div"),t.textContent=e,l=H(),r.c(),n=H(),f&&f.c(),o=ft(),this.h()},l:function(d){t=p(d,"DIV",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-96x1w2"&&(t.textContent=e),l=L(d),r.l(d),n=L(d),f&&f.l(d),o=ft(),this.h()},h:function(){h(t,"class","status-indicator granted svelte-ztuqv4"),g(t,y,433,14,12535)},m:function(d,C){z(d,t,C),z(d,l,C),r.m(d,C),z(d,n,C),f&&f.m(d,C),z(d,o,C)},p:function(d,C){u!==(u=i(d))&&(r.d(1),r=u(d),r&&(r.c(),r.m(n.parentNode,n))),d[8]?f?f.p(d,C):(f=yt(d),f.c(),f.m(o.parentNode,o)):f&&(f.d(1),f=null)},d:function(d){d&&(m(t),m(l),m(n),m(o)),r.d(d),f&&f.d(d)}};return F("SvelteRegisterBlock",{block:c,id:Ht.name,type:"if",source:"(433:50) ",ctx:s}),c}function Tt(s){let t,e="⏳ マイク許可を確認中...";const l={c:function(){t=k("div"),t.textContent=e,this.h()},l:function(o){t=p(o,"DIV",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-qiomfc"&&(t.textContent=e),this.h()},h:function(){h(t,"class","status-indicator pending svelte-ztuqv4"),g(t,y,431,14,12411)},m:function(o,i){z(o,t,i)},p:dt,d:function(o){o&&m(t)}};return F("SvelteRegisterBlock",{block:l,id:Tt.name,type:"if",source:"(431:12) {#if micPermission === 'pending'}",ctx:s}),l}function jt(s){let t,e="🎤 リアルタイム解析中";const l={c:function(){t=k("div"),t.textContent=e,this.h()},l:function(o){t=p(o,"DIV",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-bm11qy"&&(t.textContent=e),this.h()},h:function(){h(t,"class","status-indicator success svelte-ztuqv4"),g(t,y,437,16,12739)},m:function(o,i){z(o,t,i)},d:function(o){o&&m(t)}};return F("SvelteRegisterBlock",{block:l,id:jt.name,type:"else",source:"(437:14) {:else}",ctx:s}),l}function Wt(s){let t,e="⚠️ リスニング準備中...";const l={c:function(){t=k("div"),t.textContent=e,this.h()},l:function(o){t=p(o,"DIV",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-1l9yy07"&&(t.textContent=e),this.h()},h:function(){h(t,"class","status-indicator warning svelte-ztuqv4"),g(t,y,435,16,12642)},m:function(o,i){z(o,t,i)},d:function(o){o&&m(t)}};return F("SvelteRegisterBlock",{block:l,id:Wt.name,type:"if",source:"(435:14) {#if !isListening}",ctx:s}),l}function yt(s){let t,e="⚠️ 音声コンテキストがブロックされています",l,n,o="音声機能を開始",i,u;const r={c:function(){t=k("div"),t.textContent=e,l=H(),n=k("button"),n.textContent=o,this.h()},l:function(c){t=p(c,"DIV",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-rn7aam"&&(t.textContent=e),l=L(c),n=p(c,"BUTTON",{class:!0,"data-svelte-h":!0}),G(n)!=="svelte-vyzu4b"&&(n.textContent=o),this.h()},h:function(){h(t,"class","status-indicator warning svelte-ztuqv4"),g(t,y,440,16,12872),h(n,"class","retry-button svelte-ztuqv4"),g(n,y,441,16,12955)},m:function(c,a){z(c,t,a),z(c,l,a),z(c,n,a),i||(u=zt(n,"click",s[12],!1),i=!0)},p:dt,d:function(c){c&&(m(t),m(l),m(n)),i=!1,u()}};return F("SvelteRegisterBlock",{block:r,id:yt.name,type:"if",source:"(440:14) {#if audioContextBlocked}",ctx:s}),r}function pt(s){let t,e,l,n="音量レベル",o,i,u,r,f,c,a,d="音程検出",C,b,A,U=s[4].toFixed(1)+"",V,w,E,R,q,W,N,T,O,I,x;i=new Rt({props:{volume:s[3],height:"16px",className:"volume-bar-wrapper"},$$inline:!0});let P=!s[1]&&kt(s),S=s[7]>0&&Ct(s);function et(J,D){return J[2]?J[7]<50?Ot:Gt:Ut}let v=et(s),j=v(s),M=s[1]&&!s[2]&&bt(s);const $={c:function(){t=k("div"),e=k("div"),l=k("h3"),l.textContent=n,o=H(),ct(i.$$.fragment),u=H(),r=k("div"),P&&P.c(),f=H(),c=k("div"),a=k("h3"),a.textContent=d,C=H(),b=k("div"),A=k("div"),V=Q(U),w=Q(" Hz"),E=H(),R=k("div"),q=Q(s[5]),W=H(),S&&S.c(),N=H(),T=k("div"),j.c(),O=H(),M&&M.c(),I=ft(),this.h()},l:function(D){t=p(D,"DIV",{class:!0});var Z=B(t);e=p(Z,"DIV",{class:!0});var tt=B(e);l=p(tt,"H3",{class:!0,"data-svelte-h":!0}),G(l)!=="svelte-1nc8gri"&&(l.textContent=n),o=L(tt),st(i.$$.fragment,tt),u=L(tt),r=p(tt,"DIV",{class:!0});var Bt=B(r);P&&P.l(Bt),Bt.forEach(m),tt.forEach(m),f=L(Z),c=p(Z,"DIV",{class:!0});var nt=B(c);a=p(nt,"H3",{class:!0,"data-svelte-h":!0}),G(a)!=="svelte-1ofzoy2"&&(a.textContent=d),C=L(nt),b=p(nt,"DIV",{class:!0});var ot=B(b);A=p(ot,"DIV",{class:!0});var vt=B(A);V=Y(vt,U),w=Y(vt," Hz"),vt.forEach(m),E=L(ot),R=p(ot,"DIV",{class:!0});var wt=B(R);q=Y(wt,s[5]),wt.forEach(m),W=L(ot),S&&S.l(ot),ot.forEach(m),N=L(nt),T=p(nt,"DIV",{class:!0});var Et=B(T);j.l(Et),Et.forEach(m),nt.forEach(m),Z.forEach(m),O=L(D),M&&M.l(D),I=ft(),this.h()},h:function(){h(l,"class","display-title svelte-ztuqv4"),g(l,y,463,16,13843),h(r,"class","volume-status svelte-ztuqv4"),g(r,y,465,16,13994),h(e,"class","volume-section svelte-ztuqv4"),g(e,y,462,14,13798),h(a,"class","display-title svelte-ztuqv4"),g(a,y,474,16,14300),h(A,"class","frequency-value svelte-ztuqv4"),g(A,y,476,18,14402),h(R,"class","note-value svelte-ztuqv4"),g(R,y,477,18,14488),h(b,"class","frequency-display svelte-ztuqv4"),g(b,y,475,16,14352),h(T,"class","frequency-status svelte-ztuqv4"),g(T,y,490,16,15139),h(c,"class","frequency-section"),g(c,y,473,14,14252),h(t,"class","realtime-display svelte-ztuqv4"),g(t,y,460,12,13724)},m:function(D,Z){z(D,t,Z),_(t,e),_(e,l),_(e,o),lt(i,e,null),_(e,u),_(e,r),P&&P.m(r,null),_(t,f),_(t,c),_(c,a),_(c,C),_(c,b),_(b,A),_(A,V),_(A,w),_(b,E),_(b,R),_(R,q),_(b,W),S&&S.m(b,null),_(c,N),_(c,T),j.m(T,null),z(D,O,Z),M&&M.m(D,Z),z(D,I,Z),x=!0},p:function(D,Z){const tt={};Z&8&&(tt.volume=D[3]),i.$set(tt),D[1]?P&&(P.d(1),P=null):P||(P=kt(D),P.c(),P.m(r,null)),(!x||Z&16)&&U!==(U=D[4].toFixed(1)+"")&&_t(V,U),(!x||Z&32)&&_t(q,D[5]),D[7]>0?S?S.p(D,Z):(S=Ct(D),S.c(),S.m(b,null)):S&&(S.d(1),S=null),v!==(v=et(D))&&(j.d(1),j=v(D),j&&(j.c(),j.m(T,null))),D[1]&&!D[2]?M||(M=bt(D),M.c(),M.m(I.parentNode,I)):M&&(M.d(1),M=null)},i:function(D){x||(K(i.$$.fragment,D),x=!0)},o:function(D){X(i.$$.fragment,D),x=!1},d:function(D){D&&(m(t),m(O),m(I)),it(i),P&&P.d(),S&&S.d(),j.d(),M&&M.d(D)}};return F("SvelteRegisterBlock",{block:$,id:pt.name,type:"if",source:"(460:10) {#if micPermission === 'granted' && isListening}",ctx:s}),$}function kt(s){let t,e="⏳ 声を出して音量を確認してください";const l={c:function(){t=k("span"),t.textContent=e,this.h()},l:function(o){t=p(o,"SPAN",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-7eexnn"&&(t.textContent=e),this.h()},h:function(){h(t,"class","status-pending svelte-ztuqv4"),g(t,y,467,20,14082)},m:function(o,i){z(o,t,i)},d:function(o){o&&m(t)}};return F("SvelteRegisterBlock",{block:l,id:kt.name,type:"if",source:"(467:18) {#if !volumeDetected}",ctx:s}),l}function Ct(s){let t,e,l,n,o,i;const u={c:function(){t=k("div"),e=Q("信頼度: "),l=Q(s[7]),n=Q(`%
                      `),o=k("div"),i=k("div"),this.h()},l:function(f){t=p(f,"DIV",{class:!0});var c=B(t);e=Y(c,"信頼度: "),l=Y(c,s[7]),n=Y(c,`%
                      `),o=p(c,"DIV",{class:!0});var a=B(o);i=p(a,"DIV",{class:!0,style:!0}),B(i).forEach(m),a.forEach(m),c.forEach(m),this.h()},h:function(){h(i,"class","confidence-fill svelte-ztuqv4"),ut(i,"width",s[7]+"%"),ut(i,"background-color",s[7]>70?"#10b981":s[7]>40?"#f59e0b":"#ef4444"),g(i,y,482,24,14758),h(o,"class","confidence-bar svelte-ztuqv4"),g(o,y,481,22,14705),h(t,"class","confidence-display svelte-ztuqv4"),g(t,y,479,20,14600)},m:function(f,c){z(f,t,c),_(t,e),_(t,l),_(t,n),_(t,o),_(o,i)},p:function(f,c){c&128&&_t(l,f[7]),c&128&&ut(i,"width",f[7]+"%"),c&128&&ut(i,"background-color",f[7]>70?"#10b981":f[7]>40?"#f59e0b":"#ef4444")},d:function(f){f&&m(t)}};return F("SvelteRegisterBlock",{block:u,id:Ct.name,type:"if",source:"(479:18) {#if detectionConfidence > 0}",ctx:s}),u}function Gt(s){let t,e="✅ 音程検出中";const l={c:function(){t=k("span"),t.textContent=e,this.h()},l:function(o){t=p(o,"SPAN",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-acahk5"&&(t.textContent=e),this.h()},h:function(){h(t,"class","status-success svelte-ztuqv4"),g(t,y,496,20,15464)},m:function(o,i){z(o,t,i)},d:function(o){o&&m(t)}};return F("SvelteRegisterBlock",{block:l,id:Gt.name,type:"else",source:"(496:18) {:else}",ctx:s}),l}function Ot(s){let t,e="⚠️ より明確に発声してください";const l={c:function(){t=k("span"),t.textContent=e,this.h()},l:function(o){t=p(o,"SPAN",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-lq2kpp"&&(t.textContent=e),this.h()},h:function(){h(t,"class","status-warning svelte-ztuqv4"),g(t,y,494,20,15365)},m:function(o,i){z(o,t,i)},d:function(o){o&&m(t)}};return F("SvelteRegisterBlock",{block:l,id:Ot.name,type:"if",source:"(494:53) ",ctx:s}),l}function Ut(s){let t,e="⏳ 「ド」を発声して音程を確認してください";const l={c:function(){t=k("span"),t.textContent=e,this.h()},l:function(o){t=p(o,"SPAN",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-lvftl7"&&(t.textContent=e),this.h()},h:function(){h(t,"class","status-pending svelte-ztuqv4"),g(t,y,492,20,15233)},m:function(o,i){z(o,t,i)},d:function(o){o&&m(t)}};return F("SvelteRegisterBlock",{block:l,id:Ut.name,type:"if",source:"(492:18) {#if !frequencyDetected}",ctx:s}),l}function bt(s){let t,e,l,n="「ド」を発声してください",o,i,u="任意の高さで「ドー」と歌うように発声してください";const r={c:function(){t=k("div"),e=k("div"),l=k("h3"),l.textContent=n,o=H(),i=k("p"),i.textContent=u,this.h()},l:function(c){t=p(c,"DIV",{class:!0});var a=B(t);e=p(a,"DIV",{class:!0});var d=B(e);l=p(d,"H3",{class:!0,"data-svelte-h":!0}),G(l)!=="svelte-xe90gt"&&(l.textContent=n),o=L(d),i=p(d,"P",{class:!0,"data-svelte-h":!0}),G(i)!=="svelte-1rtajtc"&&(i.textContent=u),d.forEach(m),a.forEach(m),this.h()},h:function(){h(l,"class","svelte-ztuqv4"),g(l,y,506,18,15780),h(i,"class","svelte-ztuqv4"),g(i,y,507,18,15820),h(e,"class","guidance-content svelte-ztuqv4"),g(e,y,505,16,15731),h(t,"class","guidance svelte-ztuqv4"),g(t,y,504,14,15692)},m:function(c,a){z(c,t,a),_(t,e),_(e,l),_(e,o),_(e,i)},d:function(c){c&&m(t)}};return F("SvelteRegisterBlock",{block:r,id:bt.name,type:"if",source:"(504:12) {#if volumeDetected && !frequencyDetected}",ctx:s}),r}function Jt(s){let t,e,l,n;function o(c,a){if(c[0]==="pending")return Tt;if(c[0]==="granted")return Ht;if(c[0]==="denied")return Lt;if(c[0]==="error")return Nt}let i=o(s),u=i&&i(s),r=s[0]==="granted"&&s[6]&&pt(s);const f={c:function(){t=k("div"),e=k("div"),u&&u.c(),l=H(),r&&r.c(),this.h()},l:function(a){t=p(a,"DIV",{class:!0});var d=B(t);e=p(d,"DIV",{class:!0});var C=B(e);u&&u.l(C),C.forEach(m),l=L(d),r&&r.l(d),d.forEach(m),this.h()},h:function(){h(e,"class","mic-status svelte-ztuqv4"),g(e,y,429,10,12326),h(t,"class","mic-test-content svelte-ztuqv4"),g(t,y,426,8,12247)},m:function(a,d){z(a,t,d),_(t,e),u&&u.m(e,null),_(t,l),r&&r.m(t,null),n=!0},p:function(a,d){i===(i=o(a))&&u?u.p(a,d):(u&&u.d(1),u=i&&i(a),u&&(u.c(),u.m(e,null))),a[0]==="granted"&&a[6]?r?(r.p(a,d),d&65&&K(r,1)):(r=pt(a),r.c(),K(r,1),r.m(t,null)):r&&(Pt(),X(r,1,1,()=>{r=null}),Mt())},i:function(a){n||(K(r),n=!0)},o:function(a){X(r),n=!1},d:function(a){a&&m(t),u&&u.d(),r&&r.d()}};return F("SvelteRegisterBlock",{block:f,id:Jt.name,type:"slot",source:'(426:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:s}),f}function Zt(s){let t,e;t=new Dt({props:{variant:"disabled",size:"lg",fullWidth:!0,disabled:!0,$$slots:{default:[Yt]},$$scope:{ctx:s}},$$inline:!0});const l={c:function(){ct(t.$$.fragment)},l:function(o){st(t.$$.fragment,o)},m:function(o,i){lt(t,o,i),e=!0},p:function(o,i){const u={};i&33554432&&(u.$$scope={dirty:i,ctx:o}),t.$set(u)},i:function(o){e||(K(t.$$.fragment,o),e=!0)},o:function(o){X(t.$$.fragment,o),e=!1},d:function(o){it(t,o)}};return F("SvelteRegisterBlock",{block:l,id:Zt.name,type:"else",source:"(535:10) {:else}",ctx:s}),l}function Kt(s){let t,e;t=new Dt({props:{href:s[10].path,variant:"primary",size:"lg",fullWidth:!0,$$slots:{default:[Qt]},$$scope:{ctx:s}},$$inline:!0});const l={c:function(){ct(t.$$.fragment)},l:function(o){st(t.$$.fragment,o)},m:function(o,i){lt(t,o,i),e=!0},p:function(o,i){const u={};i&33554432&&(u.$$scope={dirty:i,ctx:o}),t.$set(u)},i:function(o){e||(K(t.$$.fragment,o),e=!0)},o:function(o){X(t.$$.fragment,o),e=!1},d:function(o){it(t,o)}};return F("SvelteRegisterBlock",{block:l,id:Kt.name,type:"if",source:"(526:10) {#if startButtonEnabled}",ctx:s}),l}function Yt(s){let t;const e={c:function(){t=Q("マイクテスト完了後に開始")},l:function(n){t=Y(n,"マイクテスト完了後に開始")},m:function(n,o){z(n,t,o)},d:function(n){n&&m(t)}};return F("SvelteRegisterBlock",{block:e,id:Yt.name,type:"slot",source:'(536:12) <Button                variant=\\"disabled\\"                size=\\"lg\\"                fullWidth                disabled             >',ctx:s}),e}function Qt(s){let t;const e={c:function(){t=Q("トレーニング開始")},l:function(n){t=Y(n,"トレーニング開始")},m:function(n,o){z(n,t,o)},d:function(n){n&&m(t)}};return F("SvelteRegisterBlock",{block:e,id:Qt.name,type:"slot",source:'(527:12) <Button                href={selectedMode.path}                variant=\\"primary\\"                size=\\"lg\\"                fullWidth             >',ctx:s}),e}function Xt(s){let t,e,l=s[10].name+"",n,o,i,u=s[10].description+"",r,f,c,a,d;const C=[Kt,Zt],b=[];function A(V,w){return V[9]?0:1}c=A(s),a=b[c]=C[c](s);const U={c:function(){t=k("div"),e=k("h3"),n=Q(l),o=H(),i=k("p"),r=Q(u),f=H(),a.c(),this.h()},l:function(w){t=p(w,"DIV",{class:!0});var E=B(t);e=p(E,"H3",{class:!0});var R=B(e);n=Y(R,l),R.forEach(m),o=L(E),i=p(E,"P",{class:!0});var q=B(i);r=Y(q,u),q.forEach(m),f=L(E),a.l(E),E.forEach(m),this.h()},h:function(){h(e,"class","start-title svelte-ztuqv4"),g(e,y,520,10,16114),h(i,"class","start-description svelte-ztuqv4"),g(i,y,521,10,16173),h(t,"class","start-content svelte-ztuqv4"),g(t,y,519,8,16076)},m:function(w,E){z(w,t,E),_(t,e),_(e,n),_(t,o),_(t,i),_(i,r),_(t,f),b[c].m(t,null),d=!0},p:function(w,E){let R=c;c=A(w),c===R?b[c].p(w,E):(Pt(),X(b[R],1,1,()=>{b[R]=null}),Mt(),a=b[c],a?a.p(w,E):(a=b[c]=C[c](w),a.c()),K(a,1),a.m(t,null))},i:function(w){d||(K(a),d=!0)},o:function(w){X(a),d=!1},d:function(w){w&&m(t),b[c].d()}};return F("SvelteRegisterBlock",{block:U,id:Xt.name,type:"slot",source:'(519:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:s}),U}function $t(s){let t,e,l,n,o,i,u,r,f,c,a,d,C="マイクテスト",b,A,U="音感トレーニングを始める前に、マイクの動作を確認します",V,w,E,R,q,W,N;E=new gt({props:{variant:"default",padding:"lg",$$slots:{default:[Jt]},$$scope:{ctx:s}},$$inline:!0}),W=new gt({props:{variant:"default",padding:"lg",$$slots:{default:[Xt]},$$scope:{ctx:s}},$$inline:!0});const T={c:function(){t=k("div"),e=k("div"),l=k("div"),n=k("div"),o=at("svg"),i=at("path"),u=at("path"),r=at("line"),f=at("line"),c=H(),a=k("div"),d=k("h1"),d.textContent=C,b=H(),A=k("p"),A.textContent=U,V=H(),w=k("div"),ct(E.$$.fragment),R=H(),q=k("div"),ct(W.$$.fragment),this.h()},l:function(I){t=p(I,"DIV",{class:!0});var x=B(t);e=p(x,"DIV",{class:!0});var P=B(e);l=p(P,"DIV",{class:!0});var S=B(l);n=p(S,"DIV",{class:!0});var et=B(n);o=rt(et,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var v=B(o);i=rt(v,"path",{d:!0}),B(i).forEach(m),u=rt(v,"path",{d:!0}),B(u).forEach(m),r=rt(v,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),B(r).forEach(m),f=rt(v,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),B(f).forEach(m),v.forEach(m),et.forEach(m),c=L(S),a=p(S,"DIV",{});var j=B(a);d=p(j,"H1",{class:!0,"data-svelte-h":!0}),G(d)!=="svelte-z7m4lk"&&(d.textContent=C),b=L(j),A=p(j,"P",{class:!0,"data-svelte-h":!0}),G(A)!=="svelte-1vtv92f"&&(A.textContent=U),j.forEach(m),S.forEach(m),P.forEach(m),V=L(x),w=p(x,"DIV",{class:!0});var M=B(w);st(E.$$.fragment,M),M.forEach(m),R=L(x),q=p(x,"DIV",{class:!0});var $=B(q);st(W.$$.fragment,$),$.forEach(m),x.forEach(m),this.h()},h:function(){h(i,"d","M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"),g(i,y,410,12,11711),h(u,"d","M19 10v2a7 7 0 0 1-14 0v-2"),g(u,y,411,12,11788),h(r,"x1","12"),h(r,"x2","12"),h(r,"y1","19"),h(r,"y2","22"),g(r,y,412,12,11839),h(f,"x1","8"),h(f,"x2","16"),h(f,"y1","22"),h(f,"y2","22"),g(f,y,413,12,11891),h(o,"width","48"),h(o,"height","48"),h(o,"viewBox","0 0 24 24"),h(o,"fill","none"),h(o,"stroke","currentColor"),h(o,"stroke-width","2"),g(o,y,409,10,11599),h(n,"class","mic-icon svelte-ztuqv4"),g(n,y,408,8,11566),h(d,"class","mic-test-title svelte-ztuqv4"),g(d,y,417,10,11986),h(A,"class","mic-test-description svelte-ztuqv4"),g(A,y,418,10,12035),g(a,y,416,8,11970),h(l,"class","mic-test-header svelte-ztuqv4"),g(l,y,407,6,11528),h(e,"class","header svelte-ztuqv4"),g(e,y,406,4,11501),h(w,"class","test-section"),g(w,y,424,4,12168),h(q,"class","start-section"),g(q,y,517,4,15996),h(t,"class","microphone-test svelte-ztuqv4"),g(t,y,404,2,11449)},m:function(I,x){z(I,t,x),_(t,e),_(e,l),_(l,n),_(n,o),_(o,i),_(o,u),_(o,r),_(o,f),_(l,c),_(l,a),_(a,d),_(a,b),_(a,A),_(t,V),_(t,w),lt(E,w,null),_(t,R),_(t,q),lt(W,q,null),N=!0},p:function(I,x){const P={};x&33554943&&(P.$$scope={dirty:x,ctx:I}),E.$set(P);const S={};x&33554944&&(S.$$scope={dirty:x,ctx:I}),W.$set(S)},i:function(I){N||(K(E.$$.fragment,I),K(W.$$.fragment,I),N=!0)},o:function(I){X(E.$$.fragment,I),X(W.$$.fragment,I),N=!1},d:function(I){I&&m(t),it(E),it(W)}};return F("SvelteRegisterBlock",{block:T,id:$t.name,type:"slot",source:"(404:0) <PageLayout showBackButton={true}>",ctx:s}),T}function qt(s){let t,e,l;e=new Ft({props:{showBackButton:!0,$$slots:{default:[$t]},$$scope:{ctx:s}},$$inline:!0});const n={c:function(){t=H(),ct(e.$$.fragment),this.h()},l:function(i){ce("svelte-8st1fo",document.head).forEach(m),t=L(i),st(e.$$.fragment,i),this.h()},h:function(){document.title="マイクテスト - 相対音感トレーニング"},m:function(i,u){z(i,t,u),lt(e,i,u),l=!0},p:function(i,[u]){const r={};u&33555455&&(r.$$scope={dirty:u,ctx:i}),e.$set(r)},i:function(i){l||(K(e.$$.fragment,i),l=!0)},o:function(i){X(e.$$.fragment,i),l=!1},d:function(i){i&&m(t),it(e,i)}};return F("SvelteRegisterBlock",{block:n,id:qt.name,type:"component",source:"",ctx:s}),n}const At=5;function Vt(s){if(s<=0)return"C4（ド4）";const e=Math.round(12*Math.log2(s/440)),l=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=((e+9)%12+12)%12,o=Math.floor((e+9)/12)+4,i=l[n];return`${i}${o}（${{C:"ド","C#":"ド#",D:"レ","D#":"レ#",E:"ミ",F:"ファ","F#":"ファ#",G:"ソ","G#":"ソ#",A:"ラ","A#":"ラ#",B:"シ"}[i]}${o}）`}function It(s,t){let e=0;for(let c=0;c<s.length;c++)e+=s[c]*s[c];if(e=Math.sqrt(e/s.length),e<.01)return 0;const l=te(s,t,70),n=Math.floor(t/800),o=Math.floor(t/70);let i=0,u=0,r=0;for(let c=n;c<=o;c++){let a=0,d=0;for(let C=0;C<l.length-c;C++)a+=l[C]*l[C+c],d+=l[C]*l[C];d>0&&(a=a/Math.sqrt(d),a>i?(r=i,i=a,u=c):a>r&&(r=a))}const f=i-r;if(i>.3&&f>.05&&u>0){const c=Math.min(1,i*f*2);return{frequency:t/u,confidence:c}}return{frequency:0,confidence:0}}function te(s,t,e){const l=1/t,n=1/(e*2*Math.PI),o=n/(n+l),i=new Float32Array(s.length);i[0]=s[0];for(let u=1;u<s.length;u++)i[u]=o*(i[u-1]+s[u]-s[u-1]);return i}function xt(s){if(s.length===0)return 0;if(s.length===1)return s[0];const t=[...s].sort((i,u)=>i-u),e=t[Math.floor(t.length/2)],l=s.filter(i=>Math.abs(i-e)/e<.1);if(l.length===0)return e;let n=0,o=0;for(let i=0;i<l.length;i++){const u=i+1;n+=l[i]*u,o+=u}return n/o}function fe(s,t,e){let l,n;ie(ht,"page"),le(s,ht,v=>e(20,n=v));let{$$slots:o={},$$scope:i}=t;se("Page",o,[]);let u="random";mt(()=>{n.url.searchParams.has("mode")&&(u=n.url.searchParams.get("mode")||"random")});let r="pending",f=!1,c=!1,a=0,d=0,C="",b=!1,A=0,U=!1,V=[];const w={random:{name:"ランダム基音モード",description:"10種類の基音からランダムに選択してトレーニング",color:"green",path:"./training/random"},continuous:{name:"連続チャレンジモード",description:"選択した回数だけ連続で実行し、総合評価を確認",color:"orange",path:"./training/continuous"},chromatic:{name:"12音階モード",description:"クロマチックスケールの上行・下行で完全制覇",color:"purple",path:"./training/chromatic"}},E=w[u]||w.random;async function R(){console.log("マイク許可リクエスト開始"),e(0,r="pending");try{const v=await navigator.mediaDevices.getUserMedia({audio:!0});console.log("マイク許可取得成功"),e(0,r="granted"),v.getTracks().forEach(j=>j.stop()),console.log("リスニング開始準備中..."),setTimeout(()=>{I()},500)}catch(v){console.error("マイク許可エラー:",v),e(0,r="denied")}}let q=null,W=null,N=null,T=null,O=null;async function I(){if(console.log("startListening 開始, micPermission:",r),r!=="granted"){console.log("マイク許可がありません");return}try{if(console.log("Web Audio Context 作成中..."),q=new(window.AudioContext||window.webkitAudioContext),console.log("AudioContext state:",q.state),q.state==="suspended"){console.log("AudioContext suspended - resuming...");try{await q.resume(),console.log("AudioContext resumed successfully, state:",q.state)}catch(M){console.error("AudioContext resume failed:",M),e(8,U=!0);return}}console.log("マイクアクセス開始..."),W=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}}),console.log("アナライザー設定中..."),N=q.createAnalyser(),N.fftSize=2048,N.smoothingTimeConstant=.8,q.createMediaStreamSource(W).connect(N),console.log("メディアストリームソース接続完了");const j=N.frequencyBinCount;T=new Uint8Array(j),console.log("データ配列準備完了, bufferLength:",j),e(6,b=!0),console.log("リアルタイム解析開始"),x()}catch(v){console.error("マイクアクセスエラー:",v),e(0,r="error")}}function x(){if(!b||!N){console.log("解析停止: isListening=",b,"analyser=",!!N);return}window.firstAnalysisLogged||(console.log("初回音声解析実行中..."),window.firstAnalysisLogged=!0),N.getByteFrequencyData(T);let v=0;for(let J=0;J<T.length;J++)v+=T[J]*T[J];const j=Math.sqrt(v/T.length);e(3,a=Math.min(100,j/128*100)),a>20&&(f||console.log("音量検出成功:",a),e(1,f=!0));const M=new Float32Array(N.fftSize);N.getFloatTimeDomainData(M);const $=It(M,q.sampleRate);if($.frequency>0){V.push($.frequency),V.length>At&&V.shift();const J=xt(V);e(4,d=J),e(5,C=Vt(d)),e(7,A=Math.round($.confidence*100)),d>80&&d<800&&(c||console.log("周波数検出成功:",d,"Hz",C),e(2,c=!0))}else V=[],e(4,d=0),e(5,C=""),e(7,A=0);O=requestAnimationFrame(x)}function P(){e(6,b=!1),O&&(cancelAnimationFrame(O),O=null),W&&(W.getTracks().forEach(v=>v.stop()),W=null),q&&q.state!=="closed"&&(q.close(),q=null),N=null,T=null}St(()=>{P()});async function S(){if(q){console.log("手動AudioContext開始...");try{await q.resume(),console.log("手動AudioContext開始成功, state:",q.state),e(8,U=!1),I()}catch(v){console.error("手動AudioContext開始失敗:",v)}}}mt(()=>{setTimeout(()=>{R()},500)});const et=[];return Object.keys(t).forEach(v=>{!~et.indexOf(v)&&v.slice(0,2)!=="$$"&&v!=="slot"&&ue.warn(`<Page> was created with unknown prop '${v}'`)}),s.$capture_state=()=>({onMount:mt,onDestroy:St,page:ht,Card:gt,Button:Dt,PageLayout:Ft,VolumeBar:Rt,PitchDisplay:ae,mode:u,micPermission:r,volumeDetected:f,frequencyDetected:c,currentVolume:a,currentFrequency:d,currentNote:C,isListening:b,detectionConfidence:A,audioContextBlocked:U,frequencyHistory:V,HISTORY_SIZE:At,trainingModes:w,selectedMode:E,frequencyToNote:Vt,requestMicrophone:R,audioContext:q,mediaStream:W,analyser:N,dataArray:T,animationFrame:O,startListening:I,analyzeAudio:x,detectPitchWithAutocorrelation:It,applyHighPassFilter:te,smoothFrequency:xt,stopListening:P,startAudioContextManually:S,startButtonEnabled:l,$page:n}),s.$inject_state=v=>{"mode"in v&&(u=v.mode),"micPermission"in v&&e(0,r=v.micPermission),"volumeDetected"in v&&e(1,f=v.volumeDetected),"frequencyDetected"in v&&e(2,c=v.frequencyDetected),"currentVolume"in v&&e(3,a=v.currentVolume),"currentFrequency"in v&&e(4,d=v.currentFrequency),"currentNote"in v&&e(5,C=v.currentNote),"isListening"in v&&e(6,b=v.isListening),"detectionConfidence"in v&&e(7,A=v.detectionConfidence),"audioContextBlocked"in v&&e(8,U=v.audioContextBlocked),"frequencyHistory"in v&&(V=v.frequencyHistory),"audioContext"in v&&(q=v.audioContext),"mediaStream"in v&&(W=v.mediaStream),"analyser"in v&&(N=v.analyser),"dataArray"in v&&(T=v.dataArray),"animationFrame"in v&&(O=v.animationFrame),"startButtonEnabled"in v&&e(9,l=v.startButtonEnabled)},t&&"$$inject"in t&&s.$inject_state(t.$$inject),s.$$.update=()=>{s.$$.dirty&7&&e(9,l=r==="granted"&&f&&c)},[r,f,c,a,d,C,b,A,U,l,E,R,S]}class ye extends ee{constructor(t){super(t),ne(this,t,fe,qt,oe,{}),F("SvelteRegisterComponent",{component:this,tagName:"Page",options:t,id:qt.name})}}export{ye as component};
