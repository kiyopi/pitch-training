import{S as Xt,i as Yt,d as ze,s as Zt,n as Lt,a as es,D as Vt,J as jt,b as A,O as ts,Q as At,e as q,_ as Ot,f as Ie,g as r,H as qt,z as y,h,E as ss,m as D,j as m,k as b,A as W,l as w,p as _,o as f,t as T,G as lt,L as ns}from"../chunks/DYrQga1O.js";import{g as rs}from"../chunks/D0QH3NT1.js";import"../chunks/CHpRvnA3.js";class Wt{constructor(){this.intervalTypes={unison:{name:"同度",semitones:0,importance:.8,description:"基音と同じ高さ",difficulty:"基本",commonErrors:["微細なピッチのずれ"]},minorSecond:{name:"短2度",semitones:1,importance:.9,description:"半音上",difficulty:"高",commonErrors:["長2度との混同","音程幅の過大評価"]},majorSecond:{name:"長2度",semitones:2,importance:1,description:"全音上（ドレ）",difficulty:"基本",commonErrors:["短2度との混同"]},minorThird:{name:"短3度",semitones:3,importance:1,description:"短調の3度（ドミ♭）",difficulty:"中",commonErrors:["長3度との混同"]},majorThird:{name:"長3度",semitones:4,importance:1,description:"長調の3度（ドミ）",difficulty:"基本",commonErrors:["短3度との混同","完全4度への誤認"]},perfectFourth:{name:"完全4度",semitones:5,importance:.9,description:"安定した協和音程（ドファ）",difficulty:"基本",commonErrors:["長3度・減5度との混同"]},tritone:{name:"減5度",semitones:6,importance:.7,description:"不安定な音程（ドファ#）",difficulty:"高",commonErrors:["完全4度・完全5度との混同"]},perfectFifth:{name:"完全5度",semitones:7,importance:.9,description:"最も安定した音程（ドソ）",difficulty:"基本",commonErrors:["減5度・長6度との混同"]},minorSixth:{name:"短6度",semitones:8,importance:.8,description:"短調的色彩（ドラ♭）",difficulty:"中",commonErrors:["長6度・完全5度との混同"]},majorSixth:{name:"長6度",semitones:9,importance:.8,description:"明るい響き（ドラ）",difficulty:"中",commonErrors:["短6度・短7度との混同"]},minorSeventh:{name:"短7度",semitones:10,importance:.7,description:"属7和音の7度（ドシ♭）",difficulty:"中",commonErrors:["長7度・長6度との混同"]},majorSeventh:{name:"長7度",semitones:11,importance:.7,description:"鋭い不協和音程（ドシ）",difficulty:"高",commonErrors:["短7度・8度との混同"]},octave:{name:"8度",semitones:12,importance:.9,description:"1オクターブ上（ドド）",difficulty:"基本",commonErrors:["HarmonicCorrectionによる倍音誤検出"]}},this.masteryData=new Map,this.analysisHistory=[],this.maxHistoryLength=100,this.debugMode=!0,this.initializeMasteryData(),this.log("🎵 IntervalAnalyzer初期化完了",{intervalCount:Object.keys(this.intervalTypes).length,masteryData:this.masteryData.size})}analyzeInterval(e,t,s){try{const n=this.calculateSemitones(e,t),i=this.identifyInterval(n),a=this.calculateSemitones(e,s),o=this.identifyInterval(a),l=this.calculateIntervalAccuracy(n,a);this.updateMastery(i.key,l);const g=this.getMastery(i.key),d={targetInterval:i,detectedInterval:o,targetSemitones:n,detectedSemitones:a,accuracy:l,mastery:g,isCorrectInterval:i.key===o.key,feedback:this.generateIntervalFeedback(i,o,l),timestamp:Date.now()};return this.recordAnalysis(d),this.debugMode&&this.logAnalysisDetails(d),d}catch(n){return console.error("❌ [IntervalAnalyzer] 分析エラー:",n),this.createErrorResult(e,t,s)}}calculateSemitones(e,t){return!e||!t||e<=0||t<=0?0:(12*Math.log2(t/e)%12+12)%12}identifyInterval(e){let t=null,s=1/0;for(const[n,i]of Object.entries(this.intervalTypes)){const a=Math.abs(e-i.semitones);a<s&&(s=a,t={key:n,...i,distance:a})}return t}calculateIntervalAccuracy(e,t){const s=Math.abs(e-t),n=Math.max(0,100-s*50);return Math.min(100,n)}updateMastery(e,t){this.masteryData.has(e)||this.masteryData.set(e,{attempts:0,totalAccuracy:0,averageAccuracy:0,bestAccuracy:0,recentAttempts:[],lastAttempt:null,trend:"stable"});const s=this.masteryData.get(e);s.attempts++,s.totalAccuracy+=t,s.averageAccuracy=s.totalAccuracy/s.attempts,s.bestAccuracy=Math.max(s.bestAccuracy,t),s.lastAttempt=Date.now(),s.recentAttempts.push(t),s.recentAttempts.length>10&&s.recentAttempts.shift(),s.trend=this.calculateTrend(s.recentAttempts),this.masteryData.set(e,s)}getMastery(e){const t=this.masteryData.get(e);if(!t)return{attempts:0,averageAccuracy:0,bestAccuracy:0,level:"beginner",progress:0};const s=this.determineMasteryLevel(t.averageAccuracy,t.attempts),n=Math.min(100,t.averageAccuracy*t.attempts/500);return{...t,level:s,progress:Math.round(n)}}determineMasteryLevel(e,t){return t<3?"beginner":e>=90&&t>=10?"master":e>=80&&t>=7?"advanced":e>=70&&t>=5?"intermediate":e>=50?"novice":"beginner"}calculateTrend(e){if(e.length<3)return"stable";const t=e.slice(-3),s=e.slice(-6,-3);if(s.length===0)return"stable";const n=t.reduce((o,l)=>o+l,0)/t.length,i=s.reduce((o,l)=>o+l,0)/s.length,a=n-i;return a>5?"improving":a<-5?"declining":"stable"}generateIntervalFeedback(e,t,s){const n=e.key===t.key;if(n&&s>=90)return`🎯 ${e.name}を完璧に認識しました！`;if(n&&s>=70)return`✅ ${e.name}の認識は正しいです。精度を上げてみましょう。`;if(n)return`👍 ${e.name}を認識できています。もう少し正確に。`;const i=this.analyzeIntervalError(e,t);return`❌ ${e.name}ではなく${t.name}と認識されました。${i}`}analyzeIntervalError(e,t){const s=t.semitones-e.semitones;return Math.abs(s)===1?s>0?"少し高めに歌っています。":"少し低めに歌っています。":Math.abs(s)<=2?"音程幅の調整が必要です。":Math.abs(s)>=6?"オクターブ関係の可能性があります。":"音程の特徴を意識してみてください。"}getAllMasteryData(){const e={};for(const[t,s]of Object.entries(this.intervalTypes))e[t]={interval:s,mastery:this.getMastery(t)};return e}getWeakIntervals(e=3){return Object.entries(this.getAllMasteryData()).filter(([s,n])=>n.mastery.attempts>=2).sort((s,n)=>s[1].mastery.averageAccuracy-n[1].mastery.averageAccuracy).slice(0,e).map(([s,n])=>({key:s,name:n.interval.name,accuracy:n.mastery.averageAccuracy,attempts:n.mastery.attempts,improvement:this.generateImprovementTip(s,n)}))}getStrongIntervals(e=3){return Object.entries(this.getAllMasteryData()).filter(([s,n])=>n.mastery.attempts>=3).sort((s,n)=>n[1].mastery.averageAccuracy-s[1].mastery.averageAccuracy).slice(0,e).map(([s,n])=>({key:s,name:n.interval.name,accuracy:n.mastery.averageAccuracy,attempts:n.mastery.attempts,reason:this.generateStrengthReason(s,n)}))}generateImprovementTip(e,t){const s=t.interval;return t.mastery.trend==="improving"?`📈 改善中です！${s.description}の特徴を意識して練習を続けましょう。`:s.commonErrors.length>0?`💡 ${s.commonErrors[0]}に注意してください。`:`🎯 ${s.description}を意識して、ゆっくりと練習してみましょう。`}generateStrengthReason(e,t){const s=t.interval,n=t.mastery;return n.averageAccuracy>=95?`完璧な精度で${s.name}を認識できています！`:n.trend==="improving"?`${s.name}の理解が急速に向上しています。`:`${s.name}の認識が安定しています。`}initializeMasteryData(){}recordAnalysis(e){this.analysisHistory.push(e),this.analysisHistory.length>this.maxHistoryLength&&this.analysisHistory.shift()}createErrorResult(e,t,s){return{targetInterval:{name:"不明",key:"unknown"},detectedInterval:{name:"不明",key:"unknown"},accuracy:0,mastery:{level:"beginner",progress:0},isCorrectInterval:!1,feedback:"音程分析でエラーが発生しました。",error:!0}}logAnalysisDetails(e){var t;console.group(`🎵 [IntervalAnalyzer] ${e.targetInterval.name}分析結果`),console.log("🎯 音程分析:",{目標:`${e.targetInterval.name} (${e.targetSemitones.toFixed(1)}セミトーン)`,検出:`${e.detectedInterval.name} (${e.detectedSemitones.toFixed(1)}セミトーン)`,正解:e.isCorrectInterval?"✅":"❌",精度:`${e.accuracy.toFixed(1)}%`}),console.log("📊 習得状況:",{レベル:e.mastery.level,試行回数:e.mastery.attempts,平均精度:`${((t=e.mastery.averageAccuracy)==null?void 0:t.toFixed(1))||0}%`,進捗:`${e.mastery.progress}%`,トレンド:e.mastery.trend}),console.log("💬 フィードバック:",e.feedback),console.groupEnd()}log(e,t=null){this.debugMode&&(t?console.log(`[IntervalAnalyzer] ${e}`,t):console.log(`[IntervalAnalyzer] ${e}`))}getStatistics(){return{totalAnalyses:this.analysisHistory.length,intervalTypes:Object.keys(this.intervalTypes).length,masteryLevels:Object.fromEntries(this.masteryData),sessionStartTime:this.sessionStartTime||Date.now()}}reset(){this.masteryData.clear(),this.analysisHistory=[],this.initializeMasteryData(),this.log("🔄 IntervalAnalyzer リセット完了")}}typeof window<"u"&&(window.IntervalAnalyzer=Wt);class $t{constructor(){this.directions={ascending:{name:"上行",icon:"↗️",description:"基音より高い音程",color:"#10b981",commonErrors:["オクターブ下認識（倍音効果）","音程幅の過小評価","目標音程の手前で停止"]},descending:{name:"下行",icon:"↘️",description:"基音より低い音程",color:"#3b82f6",commonErrors:["オクターブ上認識（倍音効果）","音程幅の過大評価","目標音程を通り越す"]},unison:{name:"同音",icon:"➡️",description:"基音と同じ高さ",color:"#6b7280",commonErrors:["微細なピッチずれ","倍音による誤認識"]}},this.directionMastery=new Map,this.analysisHistory=[],this.maxHistoryLength=50,this.debugMode=!0,this.thresholds={unison:.5,overshoot:1.5,significant:3},this.initializeDirectionMastery(),this.log("🧭 DirectionAnalyzer初期化完了",{directions:Object.keys(this.directions).length,thresholds:this.thresholds})}analyzeDirection(e,t,s){try{const n=this.determineDirection(e,t),i=this.calculateSemitones(e,t),a=this.determineDirection(e,s),o=this.calculateSemitones(e,s),l=n.key===a.key,g=this.analyzeOvershoot(i,o),d=this.calculateDirectionAccuracy(n.key,a.key,i,o);this.updateDirectionMastery(n.key,d,l);const p=this.getDirectionMastery(n.key),k={targetDirection:n,detectedDirection:a,targetSemitones:i,detectedSemitones:o,directionCorrect:l,accuracy:d,mastery:p,overshoot:g,feedback:this.generateDirectionFeedback(n,a,g,d),timestamp:Date.now()};return this.recordAnalysis(k),this.debugMode&&this.logAnalysisDetails(k),k}catch(n){return console.error("❌ [DirectionAnalyzer] 分析エラー:",n),this.createErrorResult(e,t,s)}}determineDirection(e,t){const s=this.calculateSemitones(e,t);return Math.abs(s)<=this.thresholds.unison?{key:"unison",...this.directions.unison}:s>0?{key:"ascending",...this.directions.ascending}:{key:"descending",...this.directions.descending}}calculateSemitones(e,t){return!e||!t||e<=0||t<=0?0:12*Math.log2(t/e)}analyzeOvershoot(e,t){const s=t-e,n=Math.abs(s);let i="accurate",a="none";return n>=this.thresholds.overshoot&&(s>0?i="overshoot":i="undershoot",n>=this.thresholds.significant?a="severe":a="moderate"),{type:i,severity:a,difference:s,absDifference:n,percentage:n/Math.abs(e)*100}}calculateDirectionAccuracy(e,t,s,n){if(e!==t)return Math.max(0,30-Math.abs(n-s)*5);const i=Math.abs(n-s),a=Math.max(0,100-i*25);return Math.min(100,a)}updateDirectionMastery(e,t,s){this.directionMastery.has(e)||this.directionMastery.set(e,{attempts:0,correctAttempts:0,totalAccuracy:0,averageAccuracy:0,bestAccuracy:0,successRate:0,recentAttempts:[],recentCorrects:[],lastAttempt:null,trend:"stable"});const n=this.directionMastery.get(e);n.attempts++,s&&n.correctAttempts++,n.totalAccuracy+=t,n.averageAccuracy=n.totalAccuracy/n.attempts,n.bestAccuracy=Math.max(n.bestAccuracy,t),n.successRate=n.correctAttempts/n.attempts*100,n.lastAttempt=Date.now(),n.recentAttempts.push(t),n.recentCorrects.push(s),n.recentAttempts.length>10&&(n.recentAttempts.shift(),n.recentCorrects.shift()),n.trend=this.calculateDirectionTrend(n.recentCorrects),this.directionMastery.set(e,n)}getDirectionMastery(e){const t=this.directionMastery.get(e);if(!t)return{attempts:0,successRate:0,averageAccuracy:0,level:"beginner",progress:0};const s=this.determineDirectionLevel(t.successRate,t.attempts),n=Math.min(100,t.successRate*t.attempts/500);return{...t,level:s,progress:Math.round(n)}}determineDirectionLevel(e,t){return t<3?"beginner":e>=95&&t>=10?"master":e>=85&&t>=7?"advanced":e>=75&&t>=5?"intermediate":e>=60?"novice":"beginner"}calculateDirectionTrend(e){if(e.length<5)return"stable";const t=e.slice(-3),s=e.slice(-6,-3);if(s.length===0)return"stable";const n=t.filter(Boolean).length/t.length,i=s.filter(Boolean).length/s.length,a=n-i;return a>.2?"improving":a<-.2?"declining":"stable"}generateDirectionFeedback(e,t,s,n){const i=e.key===t.key;return i&&n>=90?`🎯 ${e.name}の方向性が完璧です！`:i&&n>=70?`✅ ${e.name}の方向は正しいです。距離の調整をしてみましょう。`:i?s.type==="overshoot"?`👍 ${e.name}の方向は正しいですが、少し歌いすぎです。`:s.type==="undershoot"?`👍 ${e.name}の方向は正しいですが、もう少し大きく歌ってみてください。`:`👍 ${e.name}の方向は認識できています。`:e.key==="ascending"&&t.key==="descending"?"❌ 上行のつもりが下行になっています。基音より高く歌ってください。":e.key==="descending"&&t.key==="ascending"?"❌ 下行のつもりが上行になっています。基音より低く歌ってください。":e.key!=="unison"&&t.key==="unison"?`❌ 音程変化が小さすぎます。${e.name}により大きく歌ってください。`:`❌ ${e.name}ではなく${t.name}と認識されました。`}getAllDirectionMastery(){const e={};for(const[t,s]of Object.entries(this.directions))e[t]={direction:s,mastery:this.getDirectionMastery(t)};return e}getDirectionComparison(){const e=this.getDirectionMastery("ascending"),t=this.getDirectionMastery("descending");return{ascending:e,descending:t,comparison:{betterDirection:e.successRate>t.successRate?"ascending":"descending",difference:Math.abs(e.successRate-t.successRate),recommendation:this.generateDirectionRecommendation(e,t)}}}generateDirectionRecommendation(e,t){const s=e.successRate-t.successRate;return Math.abs(s)<10?"上行・下行ともにバランス良く習得できています。":s>10?"下行の練習を重点的に行うことをお勧めします。下向きの音程により意識を向けてみてください。":"上行の練習を重点的に行うことをお勧めします。上向きの音程により意識を向けてみてください。"}initializeDirectionMastery(){for(const e of Object.keys(this.directions))this.directionMastery.has(e)||this.directionMastery.set(e,{attempts:0,correctAttempts:0,totalAccuracy:0,averageAccuracy:0,bestAccuracy:0,successRate:0,recentAttempts:[],recentCorrects:[],lastAttempt:null,trend:"stable"})}recordAnalysis(e){this.analysisHistory.push(e),this.analysisHistory.length>this.maxHistoryLength&&this.analysisHistory.shift()}createErrorResult(e,t,s){return{targetDirection:{name:"不明",key:"unknown"},detectedDirection:{name:"不明",key:"unknown"},directionCorrect:!1,accuracy:0,mastery:{level:"beginner",progress:0},overshoot:{type:"unknown",severity:"none"},feedback:"方向性分析でエラーが発生しました。",error:!0}}logAnalysisDetails(e){var t;console.group(`🧭 [DirectionAnalyzer] ${e.targetDirection.name}分析結果`),console.log("🎯 方向性分析:",{目標:`${e.targetDirection.name} (${e.targetSemitones.toFixed(1)}セミトーン)`,検出:`${e.detectedDirection.name} (${e.detectedSemitones.toFixed(1)}セミトーン)`,正解:e.directionCorrect?"✅":"❌",精度:`${e.accuracy.toFixed(1)}%`}),console.log("📊 オーバーシュート分析:",{タイプ:e.overshoot.type,深刻度:e.overshoot.severity,差分:`${e.overshoot.difference.toFixed(1)}セミトーン`,誤差率:`${e.overshoot.percentage.toFixed(1)}%`}),console.log("📈 習得状況:",{レベル:e.mastery.level,成功率:`${((t=e.mastery.successRate)==null?void 0:t.toFixed(1))||0}%`,試行回数:e.mastery.attempts,トレンド:e.mastery.trend}),console.log("💬 フィードバック:",e.feedback),console.groupEnd()}log(e,t=null){this.debugMode&&(t?console.log(`[DirectionAnalyzer] ${e}`,t):console.log(`[DirectionAnalyzer] ${e}`))}getStatistics(){return{totalAnalyses:this.analysisHistory.length,directionTypes:Object.keys(this.directions).length,masteryData:Object.fromEntries(this.directionMastery),thresholds:this.thresholds}}reset(){this.directionMastery.clear(),this.analysisHistory=[],this.initializeDirectionMastery(),this.log("🔄 DirectionAnalyzer リセット完了")}}typeof window<"u"&&(window.DirectionAnalyzer=$t);class Gt{constructor(e={}){this.config={windowSize:e.windowSize||5,maxHistory:e.maxHistory||100,stabilityThreshold:e.stabilityThreshold||25,trendWindowSize:e.trendWindowSize||10,fatigueDetectionWindow:e.fatigueDetectionWindow||15},this.consistencyData=new Map,this.stabilityHistory=[],this.sessionData={startTime:Date.now(),totalAttempts:0,overallConsistency:0,stabilityTrend:"stable",fatigueLevel:"fresh",concentrationLevel:"high"},this.debugMode=!0,this.log("📊 ConsistencyTracker初期化完了",{config:this.config,sessionStart:new Date(this.sessionData.startTime).toLocaleTimeString()})}recordAttempt(e,t,s,n){try{this.addAttemptData(e,t,s,n);const i=this.calculateIntervalConsistency(e);this.updateOverallConsistency();const a=this.analyzeStabilityTrend(),o=this.analyzeFatigue(),l={intervalType:e,intervalConsistency:i,overallConsistency:this.sessionData.overallConsistency,stabilityTrend:a,fatigueAnalysis:o,recommendations:this.generateConsistencyRecommendations(i,o),timestamp:Date.now()};return this.updateSessionData(l),this.debugMode&&this.logConsistencyDetails(l),l}catch(i){return console.error("❌ [ConsistencyTracker] 記録エラー:",i),this.createErrorResult(e)}}addAttemptData(e,t,s,n){this.consistencyData.has(e)||this.consistencyData.set(e,{attempts:[],statistics:{count:0,mean:0,standardDeviation:0,variance:0,range:0,consistencyScore:0},trend:"stable",lastUpdated:Date.now()});const i=this.consistencyData.get(e),a={centsDiff:t,accuracy:s,responseTime:n,timestamp:Date.now()};i.attempts.push(a),i.attempts.length>this.config.maxHistory&&i.attempts.shift(),this.updateStatistics(e),this.stabilityHistory.push({intervalType:e,centsDiff:Math.abs(t),accuracy:s,timestamp:Date.now()}),this.stabilityHistory.length>this.config.maxHistory&&this.stabilityHistory.shift(),this.sessionData.totalAttempts++}updateStatistics(e){const t=this.consistencyData.get(e),s=t.attempts;if(s.length===0)return;const n=s.map(p=>Math.abs(p.centsDiff)),i=n.length,a=n.reduce((p,k)=>p+k,0)/i,o=n.reduce((p,k)=>p+Math.pow(k-a,2),0)/i,l=Math.sqrt(o),g=Math.max(...n)-Math.min(...n),d=Math.max(0,100-l*2);t.statistics={count:i,mean:Math.round(a*10)/10,standardDeviation:Math.round(l*10)/10,variance:Math.round(o*10)/10,range:Math.round(g*10)/10,consistencyScore:Math.round(d*10)/10},t.trend=this.calculateIntervalTrend(s),t.lastUpdated=Date.now()}calculateIntervalConsistency(e){const t=this.consistencyData.get(e);if(!t||t.attempts.length<2)return{level:"insufficient_data",score:0,description:"データ不足",attempts:(t==null?void 0:t.attempts.length)||0};const s=t.statistics,n=this.determineConsistencyLevel(s.consistencyScore);return{intervalType:e,level:n,score:s.consistencyScore,statistics:s,trend:t.trend,description:this.getConsistencyDescription(n),attempts:s.count,recommendation:this.getIntervalRecommendation(e,s,t.trend)}}determineConsistencyLevel(e){return e>=90?"excellent":e>=75?"good":e>=60?"fair":e>=40?"poor":"very_poor"}getConsistencyDescription(e){return{excellent:"非常に安定した精度で認識できています",good:"安定した認識ができています",fair:"やや不安定ですが、改善の余地があります",poor:"不安定な認識です。練習を重ねましょう",very_poor:"非常に不安定です。基礎練習から始めましょう",insufficient_data:"データが不足しています"}[e]||"評価不能"}updateOverallConsistency(){if(this.stabilityHistory.length<5){this.sessionData.overallConsistency=0;return}const t=this.stabilityHistory.slice(-this.config.trendWindowSize).map(i=>i.centsDiff),s=t.reduce((i,a)=>i+a,0)/t.length,n=Math.sqrt(t.reduce((i,a)=>i+Math.pow(a-s,2),0)/t.length);this.sessionData.overallConsistency=Math.max(0,100-n*2)}analyzeStabilityTrend(){if(this.stabilityHistory.length<this.config.trendWindowSize)return{trend:"insufficient_data",direction:"stable",confidence:0,description:"データ不足"};const e=this.stabilityHistory.slice(-this.config.trendWindowSize),t=Math.floor(this.config.trendWindowSize/2),s=e.slice(0,t),n=e.slice(-t),i=s.reduce((k,S)=>k+S.centsDiff,0)/s.length,a=n.reduce((k,S)=>k+S.centsDiff,0)/n.length,o=i-a,l=o/i*100;let g,d,p;return Math.abs(l)<10?(g="stable",d="stable",p=.7):o>0?(g="improving",d="better",p=Math.min(.9,Math.abs(l)/20)):(g="declining",d="worse",p=Math.min(.9,Math.abs(l)/20)),this.sessionData.stabilityTrend=g,{trend:g,direction:d,confidence:Math.round(p*100)/100,improvement:Math.round(o*10)/10,improvementPercent:Math.round(l*10)/10,description:this.getTrendDescription(g,d)}}analyzeFatigue(){if(this.stabilityHistory.length<this.config.fatigueDetectionWindow)return{fatigueLevel:"unknown",concentrationLevel:"unknown",recommendation:"データ不足のため判定できません"};const e=this.stabilityHistory.slice(-this.config.fatigueDetectionWindow),s=(Date.now()-this.sessionData.startTime)/(1e3*60);let n="fresh";s>30&&(n="moderate"),s>60&&(n="tired"),s>90&&(n="exhausted");const i=e.map(S=>S.accuracy),a=i.reduce((S,C)=>S+C,0)/i.length,o=this.stabilityHistory.map(S=>S.accuracy),g=o.reduce((S,C)=>S+C,0)/o.length-a;let d="fresh";g>5&&(d="moderate"),g>10&&(d="tired"),g>20&&(d="exhausted");const p=this.combineFatigueFactors(n,d),k=this.evaluateConcentration(e);return this.sessionData.fatigueLevel=p,this.sessionData.concentrationLevel=k,{fatigueLevel:p,concentrationLevel:k,sessionMinutes:Math.round(s),accuracyDrop:Math.round(g*10)/10,recommendation:this.getFatigueRecommendation(p,k)}}combineFatigueFactors(e,t){const s=["fresh","moderate","tired","exhausted"],n=s.indexOf(e),i=s.indexOf(t),a=Math.max(n,i);return s[a]}evaluateConcentration(e){const t=e.map(n=>n.centsDiff),s=Math.sqrt(t.reduce((n,i)=>n+Math.pow(i-t.reduce((a,o)=>a+o,0)/t.length,2),0)/t.length);return s<=15?"high":s<=25?"medium":s<=40?"low":"very_low"}generateConsistencyRecommendations(e,t){const s=[];return(t.fatigueLevel==="tired"||t.fatigueLevel==="exhausted")&&s.push({type:"rest",priority:"high",message:"疲労が見られます。10-15分の休憩をお勧めします。",icon:"😴"}),(t.concentrationLevel==="low"||t.concentrationLevel==="very_low")&&s.push({type:"focus",priority:"medium",message:"集中力が低下しています。深呼吸をして、ゆっくりと練習してみてください。",icon:"🧘"}),(e.level==="poor"||e.level==="very_poor")&&s.push({type:"practice",priority:"medium",message:`${e.intervalType}の練習を重点的に行いましょう。ゆっくりと正確に歌うことを意識してください。`,icon:"🎯"}),e.trend==="improving"&&s.push({type:"encouragement",priority:"low",message:"改善が見られます！この調子で練習を続けてください。",icon:"📈"}),s}getIntervalRecommendation(e,t,s){return t.consistencyScore>=80?"安定した認識ができています。この精度を維持しましょう。":s==="improving"?"改善傾向にあります。継続して練習してください。":t.standardDeviation>30?"ばらつきが大きいです。ゆっくりと正確に歌うことを意識してください。":`${e}の特徴を意識して、一定の精度で歌えるよう練習しましょう。`}getTrendDescription(e,t){return{stable:"安定した精度を維持しています",improving:"精度が向上しています",declining:"精度が低下しています"}[e]||"傾向を分析中"}getFatigueRecommendation(e,t){return e==="exhausted"?"今日はここまでにして、十分な休息を取ることをお勧めします。":e==="tired"?"15-20分の休憩を取ってから練習を再開しましょう。":t==="very_low"?"集中力が低下しています。環境を整えて、短時間の集中練習を心がけましょう。":t==="low"?"深呼吸をして、一つ一つの音程に集中して練習してみてください。":"良い状態です。この調子で練習を続けてください。"}calculateIntervalTrend(e){if(e.length<6)return"stable";const t=e.slice(-3),s=e.slice(-6,-3),n=t.reduce((o,l)=>o+Math.abs(l.centsDiff),0)/t.length,a=s.reduce((o,l)=>o+Math.abs(l.centsDiff),0)/s.length-n;return a>5?"improving":a<-5?"declining":"stable"}updateSessionData(e){this.sessionData.overallConsistency=e.overallConsistency,this.sessionData.stabilityTrend=e.stabilityTrend.trend,this.sessionData.fatigueLevel=e.fatigueAnalysis.fatigueLevel,this.sessionData.concentrationLevel=e.fatigueAnalysis.concentrationLevel}createErrorResult(e){return{intervalType:e,intervalConsistency:{level:"error",score:0},overallConsistency:0,stabilityTrend:{trend:"error"},fatigueAnalysis:{fatigueLevel:"unknown"},recommendations:[],error:!0}}logConsistencyDetails(e){var t;console.group(`📊 [ConsistencyTracker] ${e.intervalType}一貫性分析`),console.log("🎯 音程一貫性:",{レベル:e.intervalConsistency.level,スコア:`${e.intervalConsistency.score}%`,標準偏差:`${((t=e.intervalConsistency.statistics)==null?void 0:t.standardDeviation)||0}セント`,試行回数:e.intervalConsistency.attempts}),console.log("📈 トレンド分析:",{全体傾向:e.stabilityTrend.trend,方向:e.stabilityTrend.direction,信頼度:`${(e.stabilityTrend.confidence*100).toFixed(0)}%`,改善度:`${e.stabilityTrend.improvement}セント`}),console.log("😴 疲労分析:",{疲労度:e.fatigueAnalysis.fatigueLevel,集中力:e.fatigueAnalysis.concentrationLevel,セッション時間:`${e.fatigueAnalysis.sessionMinutes}分`,精度低下:`${e.fatigueAnalysis.accuracyDrop}%`}),e.recommendations.length>0&&console.log("💡 推奨事項:",e.recommendations.map(s=>s.message)),console.groupEnd()}log(e,t=null){this.debugMode&&(t?console.log(`[ConsistencyTracker] ${e}`,t):console.log(`[ConsistencyTracker] ${e}`))}getAllConsistencyData(){const e={};for(const[t,s]of this.consistencyData.entries())e[t]={statistics:s.statistics,trend:s.trend,attempts:s.attempts.length,lastUpdated:s.lastUpdated};return{intervalData:e,sessionData:this.sessionData,overallStats:{totalAttempts:this.sessionData.totalAttempts,overallConsistency:this.sessionData.overallConsistency,sessionDuration:Date.now()-this.sessionData.startTime}}}getStatistics(){return{totalIntervalTypes:this.consistencyData.size,totalAttempts:this.sessionData.totalAttempts,sessionDuration:Date.now()-this.sessionData.startTime,overallConsistency:this.sessionData.overallConsistency,stabilityTrend:this.sessionData.stabilityTrend,fatigueLevel:this.sessionData.fatigueLevel}}reset(){this.consistencyData.clear(),this.stabilityHistory=[],this.sessionData={startTime:Date.now(),totalAttempts:0,overallConsistency:0,stabilityTrend:"stable",fatigueLevel:"fresh",concentrationLevel:"high"},this.log("🔄 ConsistencyTracker リセット完了")}}typeof window<"u"&&(window.ConsistencyTracker=Gt);class St{constructor(e={}){var t,s,n,i,a,o,l,g,d,p,k;this.config={weights:{pitchAccuracy:((t=e.weights)==null?void 0:t.pitchAccuracy)||.4,recognitionSpeed:((s=e.weights)==null?void 0:s.recognitionSpeed)||.2,intervalMastery:((n=e.weights)==null?void 0:n.intervalMastery)||.2,directionAccuracy:((i=e.weights)==null?void 0:i.directionAccuracy)||.1,consistency:((a=e.weights)==null?void 0:a.consistency)||.1},speedThresholds:{excellent:((o=e.speedThresholds)==null?void 0:o.excellent)||1e3,good:((l=e.speedThresholds)==null?void 0:l.good)||2e3,fair:((g=e.speedThresholds)==null?void 0:g.fair)||3e3,poor:((d=e.speedThresholds)==null?void 0:d.poor)||5e3},harmonicCorrection:{enabled:((p=e.harmonicCorrection)==null?void 0:p.enabled)??!0,tolerance:((k=e.harmonicCorrection)==null?void 0:k.tolerance)||50},sessionTracking:e.sessionTracking??!0,maxHistorySize:e.maxHistorySize||100},this.intervalAnalyzer=new Wt,this.directionAnalyzer=new $t,this.consistencyTracker=new Gt,this.sessionData={startTime:Date.now(),totalAttempts:0,overallScore:0,performanceHistory:[],currentLevel:"beginner",achievements:new Set,lastAnalysis:null},this.performanceMetrics={averageSpeed:0,accuracyTrend:"stable",strengthAreas:[],improvementAreas:[],sessionProgress:0},this.debugMode=!0,this.log("🎯 EnhancedScoringEngine初期化完了",{weights:this.config.weights,analyzers:["IntervalAnalyzer","DirectionAnalyzer","ConsistencyTracker"]})}async analyzePerformance(e){try{const{baseFreq:t,targetFreq:s,detectedFreq:n,responseTime:i,volume:a=50,harmonicCorrection:o=null}=e,l=this.validateInputs(e);if(!l.valid)return this.createErrorResult(l.error);const g=this.applyHarmonicCorrection(n,o),d=await Promise.all([this.intervalAnalyzer.analyzeInterval(t,s,g),this.directionAnalyzer.analyzeDirection(t,s,g),this.consistencyTracker.recordAttempt(this.getIntervalType(t,s),this.calculateCentsDifference(s,g),this.calculateRawAccuracy(s,g),i)]),[p,k,S]=d,C=this.analyzeRecognitionSpeed(i),H=this.calculateIntegratedScore({intervalAnalysis:p,directionAnalysis:k,consistencyAnalysis:S,speedAnalysis:C,volume:a}),I=this.evaluateOverallPerformance(H),x=this.generateAdaptiveFeedback({intervalAnalysis:p,directionAnalysis:k,consistencyAnalysis:S,speedAnalysis:C,performanceEvaluation:I}),u=this.updateSessionData(H,I),M={timestamp:Date.now(),sessionAttempt:this.sessionData.totalAttempts,analyses:{interval:p,direction:k,consistency:S,speed:C},score:H,performance:I,feedback:x,session:u,metadata:{baseFreq:t,targetFreq:s,detectedFreq:n,correctedFreq:g,responseTime:i,volume:a,harmonicCorrectionApplied:!!o}};return this.recordAnalysisResult(M),this.debugMode&&this.logScoringDetails(M),M}catch(t){return console.error("❌ [EnhancedScoringEngine] 採点エラー:",t),this.createErrorResult("採点処理中にエラーが発生しました")}}validateInputs(e){const{baseFreq:t,targetFreq:s,detectedFreq:n,responseTime:i}=e;return!t||!s||!n?{valid:!1,error:"必要な周波数データが不足しています"}:t<=0||s<=0||n<=0?{valid:!1,error:"周波数は正の値である必要があります"}:i<0||i>3e4?{valid:!1,error:"反応時間が範囲外です"}:{valid:!0}}applyHarmonicCorrection(e,t){return!this.config.harmonicCorrection.enabled||!t?e:t.correctedFrequency&&Math.abs(t.correctedFrequency-e)<=this.config.harmonicCorrection.tolerance?(this.log("🔧 HarmonicCorrection適用",{original:e,corrected:t.correctedFrequency,correction:t.correction}),t.correctedFrequency):e}analyzeRecognitionSpeed(e){const{speedThresholds:t}=this.config;let s,n,i;return e<=t.excellent?(s="excellent",n=100,i="⚡ 素早い認識です！"):e<=t.good?(s="good",n=85,i="👍 良い反応速度です。"):e<=t.fair?(s="fair",n=70,i="📈 もう少し早く認識できると良いでしょう。"):e<=t.poor?(s="poor",n=50,i="🐌 ゆっくりと確実に認識しましょう。"):(s="very_poor",n=25,i="⏰ 時間をかけすぎています。練習を重ねましょう。"),{level:s,score:n,responseTime:e,feedback:i,comparison:this.compareToAverageSpeed(e)}}calculateIntegratedScore(e){const{weights:t}=this.config,{intervalAnalysis:s,directionAnalysis:n,consistencyAnalysis:i,speedAnalysis:a,volume:o}=e,l=s.accuracy||0,g=a.score||0,d=this.calculateMasteryScore(s.mastery),p=n.accuracy||0,k=i.overallConsistency||0,S=l*t.pitchAccuracy+g*t.recognitionSpeed+d*t.intervalMastery+p*t.directionAccuracy+k*t.consistency,C=this.calculateVolumeAdjustment(o),H=Math.min(100,S*C);return{total:Math.round(H*10)/10,components:{pitchAccuracy:Math.round(l*10)/10,recognitionSpeed:Math.round(g*10)/10,intervalMastery:Math.round(d*10)/10,directionAccuracy:Math.round(p*10)/10,consistency:Math.round(k*10)/10},weights:t,volumeAdjustment:Math.round(C*100)/100,grade:this.determineGrade(H)}}calculateMasteryScore(e){if(!e||e.attempts===0)return 0;const t=e.averageAccuracy||0,s=Math.min(20,e.attempts*2),n=e.trend==="improving"?10:0;return Math.min(100,t+s+n)}calculateVolumeAdjustment(e){return e<20?.8:e>80?.95:1}determineGrade(e){return e>=95?"S":e>=90?"A+":e>=85?"A":e>=80?"B+":e>=75?"B":e>=70?"C+":e>=65?"C":e>=60?"D+":e>=55?"D":"F"}evaluateOverallPerformance(e){const t=this.determinePerformanceLevel(e.total),s=this.identifyStrengths(e.components),n=this.identifyWeaknesses(e.components),i=this.calculateImprovement();return{level:t,score:e.total,grade:e.grade,strengths:s,weaknesses:n,improvement:i,recommendation:this.generatePerformanceRecommendation(t,s,n)}}determinePerformanceLevel(e){return e>=90?"excellent":e>=80?"good":e>=70?"average":e>=60?"below_average":"needs_improvement"}identifyStrengths(e){const t=[];return Object.entries(e).forEach(([s,n])=>{n>=85?t.push({area:s,score:n,level:"excellent"}):n>=75&&t.push({area:s,score:n,level:"good"})}),t.sort((s,n)=>n.score-s.score)}identifyWeaknesses(e){const t=[];return Object.entries(e).forEach(([s,n])=>{n<60&&t.push({area:s,score:n,severity:n<40?"high":"medium"})}),t.sort((s,n)=>s.score-n.score)}calculateImprovement(){const e=this.sessionData.performanceHistory;if(e.length<3)return{trend:"insufficient_data",change:0,description:"データ不足"};const t=e.slice(-3),s=e.slice(-6,-3);if(s.length===0)return{trend:"stable",change:0,description:"安定"};const n=t.reduce((g,d)=>g+d,0)/t.length,i=s.reduce((g,d)=>g+d,0)/s.length,a=n-i;let o,l;return a>5?(o="improving",l="向上中"):a<-5?(o="declining",l="低下中"):(o="stable",l="安定"),{trend:o,change:Math.round(a*10)/10,description:l}}generateAdaptiveFeedback(e){const{intervalAnalysis:t,directionAnalysis:s,consistencyAnalysis:n,speedAnalysis:i,performanceEvaluation:a}=e;return{primary:this.getPrimaryFeedback(a),detailed:{interval:t.feedback||"音程分析結果なし",direction:s.feedback||"方向性分析結果なし",consistency:this.getConsistencyFeedback(n),speed:i.feedback||"速度分析結果なし"},recommendations:this.generateRecommendations(e),encouragement:this.generateEncouragement(a),nextSteps:this.suggestNextSteps(a)}}getPrimaryFeedback(e){const{level:t,grade:s,score:n}=e;return{excellent:`🎯 素晴らしい！${s}評価（${n}点）です。`,good:`👍 良い結果です！${s}評価（${n}点）。`,average:`📈 平均的な結果です。${s}評価（${n}点）。`,below_average:`💪 練習を続けましょう。${s}評価（${n}点）。`,needs_improvement:`🎓 基礎から練習していきましょう。${s}評価（${n}点）。`}[t]||`結果: ${s}評価（${n}点）`}getConsistencyFeedback(e){if(e.recommendations&&e.recommendations.length>0)return e.recommendations[0].message;const t=e.overallConsistency||0;return t>=80?"🎯 一貫した精度を保っています。":t>=60?"📊 まずまずの安定性です。":"📈 一貫性の改善が必要です。"}generateRecommendations(e){const t=[];e.consistencyAnalysis.recommendations&&t.push(...e.consistencyAnalysis.recommendations);const{performanceEvaluation:s}=e;if(s.weaknesses.length>0){const n=s.weaknesses[0];t.push({type:"improvement",priority:"high",message:this.getImprovementSuggestion(n.area),icon:"🎯"})}return t}getImprovementSuggestion(e){return{pitchAccuracy:"音程の精度向上のため、ゆっくりと正確に歌う練習をしましょう。",recognitionSpeed:"反応速度向上のため、聞いた瞬間に歌う練習をしましょう。",intervalMastery:"苦手な音程を重点的に練習しましょう。",directionAccuracy:"上行・下行の方向性を意識して練習しましょう。",consistency:"一定の精度を保つため、集中力を高めて練習しましょう。"}[e]||"継続的な練習で改善していきましょう。"}generateEncouragement(e){if(e.improvement.trend==="improving")return"📈 確実に上達しています！この調子で続けましょう。";if(e.strengths.length>0){const t=e.strengths[0];return`⭐ ${this.getAreaName(t.area)}が得意ですね！`}return"🌟 練習を続けることで必ず上達します。頑張りましょう！"}suggestNextSteps(e){if(e.level==="excellent")return"🎓 上級レベルに到達しています。より複雑な音程に挑戦してみましょう。";if(e.weaknesses.length>0){const t=e.weaknesses[0];return`🎯 ${this.getAreaName(t.area)}の練習に重点を置きましょう。`}return"📚 基礎練習を継続し、全体的なレベルアップを目指しましょう。"}getAreaName(e){return{pitchAccuracy:"音程精度",recognitionSpeed:"認識速度",intervalMastery:"音程習得度",directionAccuracy:"方向性認識",consistency:"一貫性"}[e]||e}updateSessionData(e,t){return this.sessionData.totalAttempts++,this.sessionData.performanceHistory.push(e.total),this.sessionData.overallScore=this.calculateSessionAverage(),this.sessionData.currentLevel=t.level,this.sessionData.lastAnalysis=Date.now(),this.sessionData.performanceHistory.length>this.config.maxHistorySize&&this.sessionData.performanceHistory.shift(),this.updatePerformanceMetrics(e,t),this.checkAchievements(e,t),{attempt:this.sessionData.totalAttempts,sessionAverage:this.sessionData.overallScore,sessionDuration:Date.now()-this.sessionData.startTime,level:this.sessionData.currentLevel,newAchievements:Array.from(this.sessionData.achievements)}}calculateSessionAverage(){const e=this.sessionData.performanceHistory;return e.length===0?0:e.reduce((t,s)=>t+s,0)/e.length}updatePerformanceMetrics(e,t){e.components.recognitionSpeed>0&&(this.performanceMetrics.averageSpeed=(this.performanceMetrics.averageSpeed+e.components.recognitionSpeed)/2),this.performanceMetrics.accuracyTrend=t.improvement.trend,this.performanceMetrics.strengthAreas=t.strengths.map(s=>s.area),this.performanceMetrics.improvementAreas=t.weaknesses.map(s=>s.area),this.performanceMetrics.sessionProgress=Math.min(100,this.sessionData.totalAttempts/20*100)}checkAchievements(e,t){this.sessionData.totalAttempts===1&&this.sessionData.achievements.add("first_attempt"),e.total>=90&&!this.sessionData.achievements.has("high_score")&&this.sessionData.achievements.add("high_score"),e.total>=98&&!this.sessionData.achievements.has("perfect_score")&&this.sessionData.achievements.add("perfect_score"),this.sessionData.totalAttempts>=10&&!this.sessionData.achievements.has("persistent")&&this.sessionData.achievements.add("persistent"),t.improvement.trend==="improving"&&!this.sessionData.achievements.has("improving")&&this.sessionData.achievements.add("improving")}compareToAverageSpeed(e){const t=this.performanceMetrics.averageSpeed||2e3,s=e-t;return{sessionAverage:t,difference:s,comparison:s<-500?"much_faster":s<-200?"faster":s<200?"similar":s<500?"slower":"much_slower"}}getIntervalType(e,t){const n=(Math.round(12*Math.log2(t/e))%12+12)%12;return{0:"unison",1:"minorSecond",2:"majorSecond",3:"minorThird",4:"majorThird",5:"perfectFourth",6:"tritone",7:"perfectFifth",8:"minorSixth",9:"majorSixth",10:"minorSeventh",11:"majorSeventh"}[n]||"unknown"}calculateCentsDifference(e,t){return!e||!t?0:1200*Math.log2(t/e)}calculateRawAccuracy(e,t){const s=Math.abs(this.calculateCentsDifference(e,t));return Math.max(0,100-s)}recordAnalysisResult(e){this.sessionData.lastAnalysis=e}createErrorResult(e){return{timestamp:Date.now(),error:!0,message:e,score:{total:0,components:{pitchAccuracy:0,recognitionSpeed:0,intervalMastery:0,directionAccuracy:0,consistency:0},grade:"F"},performance:{level:"needs_improvement",strengths:[],weaknesses:[],improvement:{trend:"unknown",change:0}},feedback:{primary:"エラーが発生しました。もう一度お試しください。",detailed:{},recommendations:[],encouragement:"",nextSteps:""}}}logScoringDetails(e){console.group(`🎯 [EnhancedScoringEngine] 統合採点結果 #${e.sessionAttempt}`),console.log("📊 統合スコア:",{総合:`${e.score.total}点 (${e.score.grade})`,音程精度:`${e.score.components.pitchAccuracy}%`,認識速度:`${e.score.components.recognitionSpeed}%`,音程習得度:`${e.score.components.intervalMastery}%`,方向性精度:`${e.score.components.directionAccuracy}%`,一貫性:`${e.score.components.consistency}%`}),console.log("📈 パフォーマンス:",{レベル:e.performance.level,改善傾向:e.performance.improvement.trend,強み:e.performance.strengths.map(t=>t.area),弱点:e.performance.weaknesses.map(t=>t.area)}),console.log("💬 フィードバック:",{メイン:e.feedback.primary,推奨事項:e.feedback.recommendations.length}),console.log("📚 セッション:",{試行回数:e.session.attempt,平均点:e.session.sessionAverage.toFixed(1),継続時間:`${Math.round(e.session.sessionDuration/6e4)}分`}),console.groupEnd()}log(e,t=null){this.debugMode&&(t?console.log(`[EnhancedScoringEngine] ${e}`,t):console.log(`[EnhancedScoringEngine] ${e}`))}getStatistics(){return{session:this.sessionData,performance:this.performanceMetrics,analyzers:{interval:this.intervalAnalyzer.getStatistics(),direction:this.directionAnalyzer.getStatistics(),consistency:this.consistencyTracker.getStatistics()},config:this.config}}updateConfig(e){this.config={...this.config,...e},this.log("⚙️ 設定更新完了",this.config)}reset(){this.intervalAnalyzer.reset(),this.directionAnalyzer.reset(),this.consistencyTracker.reset(),this.sessionData={startTime:Date.now(),totalAttempts:0,overallScore:0,performanceHistory:[],currentLevel:"beginner",achievements:new Set,lastAnalysis:null},this.performanceMetrics={averageSpeed:0,accuracyTrend:"stable",strengthAreas:[],improvementAreas:[],sessionProgress:0},this.log("🔄 EnhancedScoringEngine リセット完了")}}typeof window<"u"&&(window.EnhancedScoringEngine=St);const{console:is}=rs,v="src/routes/scoring-test/+page.svelte";function Bt(c,e,t){const s=c.slice();return s[12]=e[t],s[14]=t,s}function Ut(c){let e;const t={c:function(){e=T("🧪 全テスト実行")},l:function(n){e=w(n,"🧪 全テスト実行")},m:function(n,i){Ie(n,e,i)},d:function(n){n&&A(e)}};return ze("SvelteRegisterBlock",{block:t,id:Ut.name,type:"else",source:"(224:6) {:else}",ctx:c}),t}function Jt(c){let e;const t={c:function(){e=T("🔄 テスト実行中...")},l:function(n){e=w(n,"🔄 テスト実行中...")},m:function(n,i){Ie(n,e,i)},d:function(n){n&&A(e)}};return ze("SvelteRegisterBlock",{block:t,id:Jt.name,type:"if",source:"(222:6) {#if isRunning}",ctx:c}),t}function Ct(c){let e,t,s,n=c[1].name+"",i,a,o,l,g,d,p=c[4]+1+"",k,S,C=c[6].length+"",H;const I={c:function(){e=f("section"),t=f("h3"),s=T("📊 実行中: "),i=T(n),a=_(),o=f("div"),l=f("div"),g=_(),d=f("p"),k=T(p),S=T(" / "),H=T(C),this.h()},l:function(u){e=m(u,"SECTION",{class:!0});var M=b(e);t=m(M,"H3",{class:!0});var G=b(t);s=w(G,"📊 実行中: "),i=w(G,n),G.forEach(A),a=D(M),o=m(M,"DIV",{class:!0});var V=b(o);l=m(V,"DIV",{class:!0,style:!0}),b(l).forEach(A),V.forEach(A),g=D(M),d=m(M,"P",{});var F=b(d);k=w(F,p),S=w(F," / "),H=w(F,C),F.forEach(A),M.forEach(A),this.h()},h:function(){y(t,"class","svelte-19llkxn"),h(t,v,240,6,5507),y(l,"class","progress-bar svelte-19llkxn"),lt(l,"width",(c[4]+1)/c[6].length*100+"%"),h(l,v,242,8,5580),y(o,"class","progress svelte-19llkxn"),h(o,v,241,6,5549),h(d,v,244,6,5708),y(e,"class","current-test svelte-19llkxn"),h(e,v,239,4,5470)},m:function(u,M){Ie(u,e,M),r(e,t),r(t,s),r(t,i),r(e,a),r(e,o),r(o,l),r(e,g),r(e,d),r(d,k),r(d,S),r(d,H)},p:function(u,M){M&2&&n!==(n=u[1].name+"")&&q(i,n),M&16&&lt(l,"width",(u[4]+1)/u[6].length*100+"%"),M&16&&p!==(p=u[4]+1+"")&&q(k,p)},d:function(u){u&&A(e)}};return ze("SvelteRegisterBlock",{block:I,id:Ct.name,type:"if",source:"(239:2) {#if isRunning && currentTest}",ctx:c}),I}function xt(c){let e,t,s="📋 テスト結果",n,i=jt(c[2]),a=[];for(let l=0;l<i.length;l+=1)a[l]=Et(Bt(c,i,l));const o={c:function(){e=f("section"),t=f("h2"),t.textContent=s,n=_();for(let g=0;g<a.length;g+=1)a[g].c();this.h()},l:function(g){e=m(g,"SECTION",{class:!0});var d=b(e);t=m(d,"H2",{class:!0,"data-svelte-h":!0}),W(t)!=="svelte-s3709x"&&(t.textContent=s),n=D(d);for(let p=0;p<a.length;p+=1)a[p].l(d);d.forEach(A),this.h()},h:function(){y(t,"class","svelte-19llkxn"),h(t,v,251,6,5877),y(e,"class","results svelte-19llkxn"),h(e,v,250,4,5845)},m:function(g,d){Ie(g,e,d),r(e,t),r(e,n);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(e,null)},p:function(g,d){if(d&4){i=jt(g[2]);let p;for(p=0;p<i.length;p+=1){const k=Bt(g,i,p);a[p]?a[p].p(k,d):(a[p]=Et(k),a[p].c(),a[p].m(e,null))}for(;p<a.length;p+=1)a[p].d(1);a.length=i.length}},d:function(g){g&&A(e),ns(a,g)}};return ze("SvelteRegisterBlock",{block:o,id:xt.name,type:"if",source:"(250:2) {#if testResults.length > 0}",ctx:c}),o}function Qt(c){let e,t,s,n,i=c[12].result.score.total+"",a,o,l,g=c[12].result.score.grade+"",d,p,k,S,C,H="音程精度:",I,x,u=c[12].result.score.components.pitchAccuracy+"",M,G,V,F,j,te="認識速度:",ue,B,J=c[12].result.score.components.recognitionSpeed+"",de,Ae,K,P,E,O="音程習得度:",z,U,X=c[12].result.score.components.intervalMastery+"",R,$,Q,se,ie,ke="方向性精度:",fe,ae,Ce=c[12].result.score.components.directionAccuracy+"",ve,xe,nt,be,oe,Le="一貫性:",Ve,Me,he=c[12].result.score.components.consistency+"",De,rt,Ue,Y,pe,Je="💬 フィードバック",Qe,we,ne=c[12].result.feedback.primary+"",_e,it,Ke,re,le,ct="期待値:",Xe,ge=c[12].expected+"",Re,Z=c[12].result.feedback.detailed&&Mt(c);const at={c:function(){e=f("div"),t=f("div"),s=f("div"),n=f("span"),a=T(i),o=_(),l=f("span"),d=T(g),p=_(),k=f("div"),S=f("div"),C=f("span"),C.textContent=H,I=_(),x=f("span"),M=T(u),G=T("%"),V=_(),F=f("div"),j=f("span"),j.textContent=te,ue=_(),B=f("span"),de=T(J),Ae=T("%"),K=_(),P=f("div"),E=f("span"),E.textContent=O,z=_(),U=f("span"),R=T(X),$=T("%"),Q=_(),se=f("div"),ie=f("span"),ie.textContent=ke,fe=_(),ae=f("span"),ve=T(Ce),xe=T("%"),nt=_(),be=f("div"),oe=f("span"),oe.textContent=Le,Ve=_(),Me=f("span"),De=T(he),rt=T("%"),Ue=_(),Y=f("div"),pe=f("h4"),pe.textContent=Je,Qe=_(),we=f("p"),_e=T(ne),it=_(),Z&&Z.c(),Ke=_(),re=f("div"),le=f("strong"),le.textContent=ct,Xe=_(),Re=T(ge),this.h()},l:function(N){e=m(N,"DIV",{class:!0});var L=b(e);t=m(L,"DIV",{class:!0});var Ye=b(t);s=m(Ye,"DIV",{class:!0});var je=b(s);n=m(je,"SPAN",{class:!0,style:!0});var Te=b(n);a=w(Te,i),Te.forEach(A),o=D(je),l=m(je,"SPAN",{class:!0,style:!0});var Oe=b(l);d=w(Oe,g),Oe.forEach(A),je.forEach(A),p=D(Ye),k=m(Ye,"DIV",{class:!0});var me=b(k);S=m(me,"DIV",{class:!0});var qe=b(S);C=m(qe,"SPAN",{class:!0,"data-svelte-h":!0}),W(C)!=="svelte-146tyqf"&&(C.textContent=H),I=D(qe),x=m(qe,"SPAN",{class:!0});var Ze=b(x);M=w(Ze,u),G=w(Ze,"%"),Ze.forEach(A),qe.forEach(A),V=D(me),F=m(me,"DIV",{class:!0});var ye=b(F);j=m(ye,"SPAN",{class:!0,"data-svelte-h":!0}),W(j)!=="svelte-sqw889"&&(j.textContent=te),ue=D(ye),B=m(ye,"SPAN",{class:!0});var Ee=b(B);de=w(Ee,J),Ae=w(Ee,"%"),Ee.forEach(A),ye.forEach(A),K=D(me),P=m(me,"DIV",{class:!0});var et=b(P);E=m(et,"SPAN",{class:!0,"data-svelte-h":!0}),W(E)!=="svelte-1uo5o5u"&&(E.textContent=O),z=D(et),U=m(et,"SPAN",{class:!0});var tt=b(U);R=w(tt,X),$=w(tt,"%"),tt.forEach(A),et.forEach(A),Q=D(me),se=m(me,"DIV",{class:!0});var Se=b(se);ie=m(Se,"SPAN",{class:!0,"data-svelte-h":!0}),W(ie)!=="svelte-vuo93o"&&(ie.textContent=ke),fe=D(Se),ae=m(Se,"SPAN",{class:!0});var He=b(ae);ve=w(He,Ce),xe=w(He,"%"),He.forEach(A),Se.forEach(A),nt=D(me),be=m(me,"DIV",{class:!0});var Fe=b(be);oe=m(Fe,"SPAN",{class:!0,"data-svelte-h":!0}),W(oe)!=="svelte-z9t95r"&&(oe.textContent=Le),Ve=D(Fe),Me=m(Fe,"SPAN",{class:!0});var st=b(Me);De=w(st,he),rt=w(st,"%"),st.forEach(A),Fe.forEach(A),me.forEach(A),Ye.forEach(A),Ue=D(L),Y=m(L,"DIV",{class:!0});var Ne=b(Y);pe=m(Ne,"H4",{class:!0,"data-svelte-h":!0}),W(pe)!=="svelte-1svoycg"&&(pe.textContent=Je),Qe=D(Ne),we=m(Ne,"P",{class:!0});var Be=b(we);_e=w(Be,ne),Be.forEach(A),it=D(Ne),Z&&Z.l(Ne),Ne.forEach(A),Ke=D(L),re=m(L,"DIV",{class:!0});var ee=b(re);le=m(ee,"STRONG",{"data-svelte-h":!0}),W(le)!=="svelte-1ri8yc2"&&(le.textContent=ct),Xe=D(ee),Re=w(ee,ge),ee.forEach(A),L.forEach(A),this.h()},h:function(){y(n,"class","score-value svelte-19llkxn"),lt(n,"color",It(c[12].result.score.total)),h(n,v,269,18,6472),y(l,"class","grade svelte-19llkxn"),lt(l,"color",zt(c[12].result.score.grade)),h(l,v,275,18,6718),y(s,"class","total-score svelte-19llkxn"),h(s,v,268,16,6428),y(C,"class","label svelte-19llkxn"),h(C,v,286,20,7120),y(x,"class","value svelte-19llkxn"),h(x,v,287,20,7173),y(S,"class","component svelte-19llkxn"),h(S,v,285,18,7076),y(j,"class","label svelte-19llkxn"),h(j,v,290,20,7339),y(B,"class","value svelte-19llkxn"),h(B,v,291,20,7392),y(F,"class","component svelte-19llkxn"),h(F,v,289,18,7295),y(E,"class","label svelte-19llkxn"),h(E,v,294,20,7561),y(U,"class","value svelte-19llkxn"),h(U,v,295,20,7615),y(P,"class","component svelte-19llkxn"),h(P,v,293,18,7517),y(ie,"class","label svelte-19llkxn"),h(ie,v,298,20,7783),y(ae,"class","value svelte-19llkxn"),h(ae,v,299,20,7837),y(se,"class","component svelte-19llkxn"),h(se,v,297,18,7739),y(oe,"class","label svelte-19llkxn"),h(oe,v,302,20,8007),y(Me,"class","value svelte-19llkxn"),h(Me,v,303,20,8059),y(be,"class","component svelte-19llkxn"),h(be,v,301,18,7963),y(k,"class","component-scores svelte-19llkxn"),h(k,v,284,16,7027),y(t,"class","score-display svelte-19llkxn"),h(t,v,267,14,6384),y(pe,"class","svelte-19llkxn"),h(pe,v,310,16,8304),y(we,"class","primary-feedback svelte-19llkxn"),h(we,v,311,16,8340),y(Y,"class","feedback svelte-19llkxn"),h(Y,v,309,14,8265),h(le,v,333,16,9367),y(re,"class","expectation svelte-19llkxn"),h(re,v,332,14,9325),y(e,"class","result-content svelte-19llkxn"),h(e,v,265,12,6312)},m:function(N,L){Ie(N,e,L),r(e,t),r(t,s),r(s,n),r(n,a),r(s,o),r(s,l),r(l,d),r(t,p),r(t,k),r(k,S),r(S,C),r(S,I),r(S,x),r(x,M),r(x,G),r(k,V),r(k,F),r(F,j),r(F,ue),r(F,B),r(B,de),r(B,Ae),r(k,K),r(k,P),r(P,E),r(P,z),r(P,U),r(U,R),r(U,$),r(k,Q),r(k,se),r(se,ie),r(se,fe),r(se,ae),r(ae,ve),r(ae,xe),r(k,nt),r(k,be),r(be,oe),r(be,Ve),r(be,Me),r(Me,De),r(Me,rt),r(e,Ue),r(e,Y),r(Y,pe),r(Y,Qe),r(Y,we),r(we,_e),r(Y,it),Z&&Z.m(Y,null),r(e,Ke),r(e,re),r(re,le),r(re,Xe),r(re,Re)},p:function(N,L){L&4&&i!==(i=N[12].result.score.total+"")&&q(a,i),L&4&&lt(n,"color",It(N[12].result.score.total)),L&4&&g!==(g=N[12].result.score.grade+"")&&q(d,g),L&4&&lt(l,"color",zt(N[12].result.score.grade)),L&4&&u!==(u=N[12].result.score.components.pitchAccuracy+"")&&q(M,u),L&4&&J!==(J=N[12].result.score.components.recognitionSpeed+"")&&q(de,J),L&4&&X!==(X=N[12].result.score.components.intervalMastery+"")&&q(R,X),L&4&&Ce!==(Ce=N[12].result.score.components.directionAccuracy+"")&&q(ve,Ce),L&4&&he!==(he=N[12].result.score.components.consistency+"")&&q(De,he),L&4&&ne!==(ne=N[12].result.feedback.primary+"")&&q(_e,ne),N[12].result.feedback.detailed?Z?Z.p(N,L):(Z=Mt(N),Z.c(),Z.m(Y,null)):Z&&(Z.d(1),Z=null),L&4&&ge!==(ge=N[12].expected+"")&&q(Re,ge)},d:function(N){N&&A(e),Z&&Z.d()}};return ze("SvelteRegisterBlock",{block:at,id:Qt.name,type:"else",source:"(265:10) {:else}",ctx:c}),at}function Kt(c){let e,t,s=c[12].error+"",n;const i={c:function(){e=f("div"),t=T("❌ エラー: "),n=T(s),this.h()},l:function(o){e=m(o,"DIV",{class:!0});var l=b(e);t=w(l,"❌ エラー: "),n=w(l,s),l.forEach(A),this.h()},h:function(){y(e,"class","error svelte-19llkxn"),h(e,v,261,12,6203)},m:function(o,l){Ie(o,e,l),r(e,t),r(e,n)},p:function(o,l){l&4&&s!==(s=o[12].error+"")&&q(n,s)},d:function(o){o&&A(e)}};return ze("SvelteRegisterBlock",{block:i,id:Kt.name,type:"if",source:"(261:10) {#if testResult.error}",ctx:c}),i}function Mt(c){let e,t,s,n="音程:",i,a=c[12].result.feedback.detailed.interval+"",o,l,g,d,p="方向性:",k,S=c[12].result.feedback.detailed.direction+"",C,H,I,x,u="一貫性:",M,G=c[12].result.feedback.detailed.consistency+"",V,F,j,te,ue="速度:",B,J=c[12].result.feedback.detailed.speed+"",de;const Ae={c:function(){e=f("div"),t=f("div"),s=f("strong"),s.textContent=n,i=_(),o=T(a),l=_(),g=f("div"),d=f("strong"),d.textContent=p,k=_(),C=T(S),H=_(),I=f("div"),x=f("strong"),x.textContent=u,M=_(),V=T(G),F=_(),j=f("div"),te=f("strong"),te.textContent=ue,B=_(),de=T(J),this.h()},l:function(P){e=m(P,"DIV",{class:!0});var E=b(e);t=m(E,"DIV",{class:!0});var O=b(t);s=m(O,"STRONG",{"data-svelte-h":!0}),W(s)!=="svelte-677z0q"&&(s.textContent=n),i=D(O),o=w(O,a),O.forEach(A),l=D(E),g=m(E,"DIV",{class:!0});var z=b(g);d=m(z,"STRONG",{"data-svelte-h":!0}),W(d)!=="svelte-8yvkz3"&&(d.textContent=p),k=D(z),C=w(z,S),z.forEach(A),H=D(E),I=m(E,"DIV",{class:!0});var U=b(I);x=m(U,"STRONG",{"data-svelte-h":!0}),W(x)!=="svelte-x7tjto"&&(x.textContent=u),M=D(U),V=w(U,G),U.forEach(A),F=D(E),j=m(E,"DIV",{class:!0});var X=b(j);te=m(X,"STRONG",{"data-svelte-h":!0}),W(te)!=="svelte-xkjonl"&&(te.textContent=ue),B=D(X),de=w(X,J),X.forEach(A),E.forEach(A),this.h()},h:function(){h(s,v,316,22,8604),y(t,"class","feedback-item svelte-19llkxn"),h(t,v,315,20,8554),h(d,v,319,22,8769),y(g,"class","feedback-item svelte-19llkxn"),h(g,v,318,20,8719),h(x,v,322,22,8936),y(I,"class","feedback-item svelte-19llkxn"),h(I,v,321,20,8886),h(te,v,325,22,9105),y(j,"class","feedback-item svelte-19llkxn"),h(j,v,324,20,9055),y(e,"class","detailed-feedback svelte-19llkxn"),h(e,v,314,18,8502)},m:function(P,E){Ie(P,e,E),r(e,t),r(t,s),r(t,i),r(t,o),r(e,l),r(e,g),r(g,d),r(g,k),r(g,C),r(e,H),r(e,I),r(I,x),r(I,M),r(I,V),r(e,F),r(e,j),r(j,te),r(j,B),r(j,de)},p:function(P,E){E&4&&a!==(a=P[12].result.feedback.detailed.interval+"")&&q(o,a),E&4&&S!==(S=P[12].result.feedback.detailed.direction+"")&&q(C,S),E&4&&G!==(G=P[12].result.feedback.detailed.consistency+"")&&q(V,G),E&4&&J!==(J=P[12].result.feedback.detailed.speed+"")&&q(de,J)},d:function(P){P&&A(e)}};return ze("SvelteRegisterBlock",{block:Ae,id:Mt.name,type:"if",source:"(314:16) {#if testResult.result.feedback.detailed}",ctx:c}),Ae}function Et(c){let e,t,s,n=c[12].scenario+"",i,a,o,l=c[12].timestamp+"",g,d,p;function k(I,x){return I[12].error?Kt:Qt}let S=k(c),C=S(c);const H={c:function(){e=f("div"),t=f("div"),s=f("h3"),i=T(n),a=_(),o=f("span"),g=T(l),d=_(),C.c(),p=_(),this.h()},l:function(x){e=m(x,"DIV",{class:!0});var u=b(e);t=m(u,"DIV",{class:!0});var M=b(t);s=m(M,"H3",{class:!0});var G=b(s);i=w(G,n),G.forEach(A),a=D(M),o=m(M,"SPAN",{class:!0});var V=b(o);g=w(V,l),V.forEach(A),M.forEach(A),d=D(u),C.l(u),p=D(u),u.forEach(A),this.h()},h:function(){y(s,"class","svelte-19llkxn"),h(s,v,256,12,6033),y(o,"class","timestamp svelte-19llkxn"),h(o,v,257,12,6076),y(t,"class","result-header svelte-19llkxn"),h(t,v,255,10,5993),y(e,"class","result-card svelte-19llkxn"),h(e,v,254,8,5957)},m:function(x,u){Ie(x,e,u),r(e,t),r(t,s),r(s,i),r(t,a),r(t,o),r(o,g),r(e,d),C.m(e,null),r(e,p)},p:function(x,u){u&4&&n!==(n=x[12].scenario+"")&&q(i,n),u&4&&l!==(l=x[12].timestamp+"")&&q(g,l),S===(S=k(x))&&C?C.p(x,u):(C.d(1),C=S(x),C&&(C.c(),C.m(e,p)))},d:function(x){x&&A(e),C.d()}};return ze("SvelteRegisterBlock",{block:H,id:Et.name,type:"each",source:"(254:6) {#each testResults as testResult, index}",ctx:c}),H}function wt(c){let e,t,s="📊 エンジン統計",n,i,a,o,l="セッション情報",g,d,p,k="総試行回数:",S,C,H=c[5].session.totalAttempts+"",I,x,u,M,G="平均スコア:",V,F,j=c[5].session.overallScore.toFixed(1)+"",te,ue,B,J,de="現在レベル:",Ae,K,P=c[5].session.currentLevel+"",E,O,z,U,X="パフォーマンス",R,$,Q,se="平均速度:",ie,ke,fe=c[5].performance.averageSpeed.toFixed(1)+"",ae,Ce,ve,xe,nt="精度トレンド:",be,oe,Le=c[5].performance.accuracyTrend+"",Ve,Me,he,De,rt="セッション進捗:",Ue,Y,pe=c[5].performance.sessionProgress+"",Je,Qe,we,ne,_e,it="分析器統計",Ke,re,le,ct="音程分析:",Xe,ge,Re=c[5].analyzers.interval.totalAnalyses+"",Z,at,Pe,N,L,Ye="方向性分析:",je,Te,Oe=c[5].analyzers.direction.totalAnalyses+"",me,qe,Ze,ye,Ee,et="一貫性追跡:",tt,Se,He=c[5].analyzers.consistency.totalAttempts+"",Fe,st;const Ne={c:function(){e=f("section"),t=f("h2"),t.textContent=s,n=_(),i=f("div"),a=f("div"),o=f("h3"),o.textContent=l,g=_(),d=f("div"),p=f("span"),p.textContent=k,S=_(),C=f("span"),I=T(H),x=_(),u=f("div"),M=f("span"),M.textContent=G,V=_(),F=f("span"),te=T(j),ue=_(),B=f("div"),J=f("span"),J.textContent=de,Ae=_(),K=f("span"),E=T(P),O=_(),z=f("div"),U=f("h3"),U.textContent=X,R=_(),$=f("div"),Q=f("span"),Q.textContent=se,ie=_(),ke=f("span"),ae=T(fe),Ce=_(),ve=f("div"),xe=f("span"),xe.textContent=nt,be=_(),oe=f("span"),Ve=T(Le),Me=_(),he=f("div"),De=f("span"),De.textContent=rt,Ue=_(),Y=f("span"),Je=T(pe),Qe=T("%"),we=_(),ne=f("div"),_e=f("h3"),_e.textContent=it,Ke=_(),re=f("div"),le=f("span"),le.textContent=ct,Xe=_(),ge=f("span"),Z=T(Re),at=T("回"),Pe=_(),N=f("div"),L=f("span"),L.textContent=Ye,je=_(),Te=f("span"),me=T(Oe),qe=T("回"),Ze=_(),ye=f("div"),Ee=f("span"),Ee.textContent=et,tt=_(),Se=f("span"),Fe=T(He),st=T("回"),this.h()},l:function(ee){e=m(ee,"SECTION",{class:!0});var ce=b(e);t=m(ce,"H2",{class:!0,"data-svelte-h":!0}),W(t)!=="svelte-bgef1u"&&(t.textContent=s),n=D(ce),i=m(ce,"DIV",{class:!0});var ot=b(i);a=m(ot,"DIV",{class:!0});var We=b(a);o=m(We,"H3",{class:!0,"data-svelte-h":!0}),W(o)!=="svelte-17emse7"&&(o.textContent=l),g=D(We),d=m(We,"DIV",{class:!0});var ut=b(d);p=m(ut,"SPAN",{class:!0,"data-svelte-h":!0}),W(p)!=="svelte-yy8w1i"&&(p.textContent=k),S=D(ut),C=m(ut,"SPAN",{class:!0});var Rt=b(C);I=w(Rt,H),Rt.forEach(A),ut.forEach(A),x=D(We),u=m(We,"DIV",{class:!0});var dt=b(u);M=m(dt,"SPAN",{class:!0,"data-svelte-h":!0}),W(M)!=="svelte-1yupbzd"&&(M.textContent=G),V=D(dt),F=m(dt,"SPAN",{class:!0});var Pt=b(F);te=w(Pt,j),Pt.forEach(A),dt.forEach(A),ue=D(We),B=m(We,"DIV",{class:!0});var ht=b(B);J=m(ht,"SPAN",{class:!0,"data-svelte-h":!0}),W(J)!=="svelte-1lwfu5j"&&(J.textContent=de),Ae=D(ht),K=m(ht,"SPAN",{class:!0});var Ht=b(K);E=w(Ht,P),Ht.forEach(A),ht.forEach(A),We.forEach(A),O=D(ot),z=m(ot,"DIV",{class:!0});var $e=b(z);U=m($e,"H3",{class:!0,"data-svelte-h":!0}),W(U)!=="svelte-1x0fmtr"&&(U.textContent=X),R=D($e),$=m($e,"DIV",{class:!0});var mt=b($);Q=m(mt,"SPAN",{class:!0,"data-svelte-h":!0}),W(Q)!=="svelte-16r563u"&&(Q.textContent=se),ie=D(mt),ke=m(mt,"SPAN",{class:!0});var Ft=b(ke);ae=w(Ft,fe),Ft.forEach(A),mt.forEach(A),Ce=D($e),ve=m($e,"DIV",{class:!0});var ft=b(ve);xe=m(ft,"SPAN",{class:!0,"data-svelte-h":!0}),W(xe)!=="svelte-1hjadvd"&&(xe.textContent=nt),be=D(ft),oe=m(ft,"SPAN",{class:!0});var Nt=b(oe);Ve=w(Nt,Le),Nt.forEach(A),ft.forEach(A),Me=D($e),he=m($e,"DIV",{class:!0});var vt=b(he);De=m(vt,"SPAN",{class:!0,"data-svelte-h":!0}),W(De)!=="svelte-kq0n13"&&(De.textContent=rt),Ue=D(vt),Y=m(vt,"SPAN",{class:!0});var kt=b(Y);Je=w(kt,pe),Qe=w(kt,"%"),kt.forEach(A),vt.forEach(A),$e.forEach(A),we=D(ot),ne=m(ot,"DIV",{class:!0});var Ge=b(ne);_e=m(Ge,"H3",{class:!0,"data-svelte-h":!0}),W(_e)!=="svelte-bwiav"&&(_e.textContent=it),Ke=D(Ge),re=m(Ge,"DIV",{class:!0});var pt=b(re);le=m(pt,"SPAN",{class:!0,"data-svelte-h":!0}),W(le)!=="svelte-1q5z8h"&&(le.textContent=ct),Xe=D(pt),ge=m(pt,"SPAN",{class:!0});var bt=b(ge);Z=w(bt,Re),at=w(bt,"回"),bt.forEach(A),pt.forEach(A),Pe=D(Ge),N=m(Ge,"DIV",{class:!0});var gt=b(N);L=m(gt,"SPAN",{class:!0,"data-svelte-h":!0}),W(L)!=="svelte-xcx73y"&&(L.textContent=Ye),je=D(gt),Te=m(gt,"SPAN",{class:!0});var Dt=b(Te);me=w(Dt,Oe),qe=w(Dt,"回"),Dt.forEach(A),gt.forEach(A),Ze=D(Ge),ye=m(Ge,"DIV",{class:!0});var yt=b(ye);Ee=m(yt,"SPAN",{class:!0,"data-svelte-h":!0}),W(Ee)!=="svelte-u6xg0h"&&(Ee.textContent=et),tt=D(yt),Se=m(yt,"SPAN",{class:!0});var _t=b(Se);Fe=w(_t,He),st=w(_t,"回"),_t.forEach(A),yt.forEach(A),Ge.forEach(A),ot.forEach(A),ce.forEach(A),this.h()},h:function(){y(t,"class","svelte-19llkxn"),h(t,v,345,6,9595),y(o,"class","svelte-19llkxn"),h(o,v,349,10,9694),y(p,"class","label svelte-19llkxn"),h(p,v,351,12,9757),y(C,"class","value svelte-19llkxn"),h(C,v,352,12,9803),y(d,"class","stat-item svelte-19llkxn"),h(d,v,350,10,9721),y(M,"class","label svelte-19llkxn"),h(M,v,355,12,9929),y(F,"class","value svelte-19llkxn"),h(F,v,356,12,9975),y(u,"class","stat-item svelte-19llkxn"),h(u,v,354,10,9893),y(J,"class","label svelte-19llkxn"),h(J,v,359,12,10111),y(K,"class","value svelte-19llkxn"),h(K,v,360,12,10157),y(B,"class","stat-item svelte-19llkxn"),h(B,v,358,10,10075),y(a,"class","stat-card svelte-19llkxn"),h(a,v,348,8,9660),y(U,"class","svelte-19llkxn"),h(U,v,365,10,10302),y(Q,"class","label svelte-19llkxn"),h(Q,v,367,12,10365),y(ke,"class","value svelte-19llkxn"),h(ke,v,368,12,10410),y($,"class","stat-item svelte-19llkxn"),h($,v,366,10,10329),y(xe,"class","label svelte-19llkxn"),h(xe,v,371,12,10550),y(oe,"class","value svelte-19llkxn"),h(oe,v,372,12,10597),y(ve,"class","stat-item svelte-19llkxn"),h(ve,v,370,10,10514),y(De,"class","label svelte-19llkxn"),h(De,v,375,12,10727),y(Y,"class","value svelte-19llkxn"),h(Y,v,376,12,10775),y(he,"class","stat-item svelte-19llkxn"),h(he,v,374,10,10691),y(z,"class","stat-card svelte-19llkxn"),h(z,v,364,8,10268),y(_e,"class","svelte-19llkxn"),h(_e,v,381,10,10928),y(le,"class","label svelte-19llkxn"),h(le,v,383,12,10989),y(ge,"class","value svelte-19llkxn"),h(ge,v,384,12,11034),y(re,"class","stat-item svelte-19llkxn"),h(re,v,382,10,10953),y(L,"class","label svelte-19llkxn"),h(L,v,387,12,11172),y(Te,"class","value svelte-19llkxn"),h(Te,v,388,12,11218),y(N,"class","stat-item svelte-19llkxn"),h(N,v,386,10,11136),y(Ee,"class","label svelte-19llkxn"),h(Ee,v,391,12,11357),y(Se,"class","value svelte-19llkxn"),h(Se,v,392,12,11403),y(ye,"class","stat-item svelte-19llkxn"),h(ye,v,390,10,11321),y(ne,"class","stat-card svelte-19llkxn"),h(ne,v,380,8,10894),y(i,"class","stats-grid svelte-19llkxn"),h(i,v,347,6,9627),y(e,"class","statistics svelte-19llkxn"),h(e,v,344,4,9560)},m:function(ee,ce){Ie(ee,e,ce),r(e,t),r(e,n),r(e,i),r(i,a),r(a,o),r(a,g),r(a,d),r(d,p),r(d,S),r(d,C),r(C,I),r(a,x),r(a,u),r(u,M),r(u,V),r(u,F),r(F,te),r(a,ue),r(a,B),r(B,J),r(B,Ae),r(B,K),r(K,E),r(i,O),r(i,z),r(z,U),r(z,R),r(z,$),r($,Q),r($,ie),r($,ke),r(ke,ae),r(z,Ce),r(z,ve),r(ve,xe),r(ve,be),r(ve,oe),r(oe,Ve),r(z,Me),r(z,he),r(he,De),r(he,Ue),r(he,Y),r(Y,Je),r(Y,Qe),r(i,we),r(i,ne),r(ne,_e),r(ne,Ke),r(ne,re),r(re,le),r(re,Xe),r(re,ge),r(ge,Z),r(ge,at),r(ne,Pe),r(ne,N),r(N,L),r(N,je),r(N,Te),r(Te,me),r(Te,qe),r(ne,Ze),r(ne,ye),r(ye,Ee),r(ye,tt),r(ye,Se),r(Se,Fe),r(Se,st)},p:function(ee,ce){ce&32&&H!==(H=ee[5].session.totalAttempts+"")&&q(I,H),ce&32&&j!==(j=ee[5].session.overallScore.toFixed(1)+"")&&q(te,j),ce&32&&P!==(P=ee[5].session.currentLevel+"")&&q(E,P),ce&32&&fe!==(fe=ee[5].performance.averageSpeed.toFixed(1)+"")&&q(ae,fe),ce&32&&Le!==(Le=ee[5].performance.accuracyTrend+"")&&q(Ve,Le),ce&32&&pe!==(pe=ee[5].performance.sessionProgress+"")&&q(Je,pe),ce&32&&Re!==(Re=ee[5].analyzers.interval.totalAnalyses+"")&&q(Z,Re),ce&32&&Oe!==(Oe=ee[5].analyzers.direction.totalAnalyses+"")&&q(me,Oe),ce&32&&He!==(He=ee[5].analyzers.consistency.totalAttempts+"")&&q(Fe,He)},d:function(ee){ee&&A(e)}};return ze("SvelteRegisterBlock",{block:Ne,id:wt.name,type:"if",source:"(344:2) {#if engineStats}",ctx:c}),Ne}function Tt(c){let e,t,s,n,i="🎯 Enhanced Scoring Engine",a,o,l="統合採点エンジンのテストページ",g,d,p,k,S,C=c[0]?"準備完了":"初期化中...",H,I,x,u,M,G,V,F,j,te,ue,B,J,de;function Ae(X,R){return X[3]?Jt:Ut}let K=Ae(c),P=K(c),E=c[3]&&c[1]&&Ct(c),O=c[2].length>0&&xt(c),z=c[5]&&wt(c);const U={c:function(){e=_(),t=f("div"),s=f("header"),n=f("h1"),n.textContent=i,a=_(),o=f("p"),o.textContent=l,g=_(),d=f("div"),p=f("span"),k=_(),S=f("span"),H=T(C),I=_(),x=f("section"),u=f("button"),P.c(),G=_(),V=f("button"),F=T("🔄 リセット"),te=_(),E&&E.c(),ue=_(),O&&O.c(),B=_(),z&&z.c(),this.h()},l:function(R){ss("svelte-pwq006",document.head).forEach(A),e=D(R),t=m(R,"DIV",{class:!0});var Q=b(t);s=m(Q,"HEADER",{class:!0});var se=b(s);n=m(se,"H1",{class:!0,"data-svelte-h":!0}),W(n)!=="svelte-f90z2e"&&(n.textContent=i),a=D(se),o=m(se,"P",{class:!0,"data-svelte-h":!0}),W(o)!=="svelte-10mru30"&&(o.textContent=l),g=D(se),d=m(se,"DIV",{class:!0});var ie=b(d);p=m(ie,"SPAN",{class:!0}),b(p).forEach(A),k=D(ie),S=m(ie,"SPAN",{});var ke=b(S);H=w(ke,C),ke.forEach(A),ie.forEach(A),se.forEach(A),I=D(Q),x=m(Q,"SECTION",{class:!0});var fe=b(x);u=m(fe,"BUTTON",{class:!0});var ae=b(u);P.l(ae),ae.forEach(A),G=D(fe),V=m(fe,"BUTTON",{class:!0});var Ce=b(V);F=w(Ce,"🔄 リセット"),Ce.forEach(A),fe.forEach(A),te=D(Q),E&&E.l(Q),ue=D(Q),O&&O.l(Q),B=D(Q),z&&z.l(Q),Q.forEach(A),this.h()},h:function(){document.title="Enhanced Scoring Engine - Test Page",y(n,"class","svelte-19llkxn"),h(n,v,206,4,4696),y(o,"class","svelte-19llkxn"),h(o,v,207,4,4736),y(p,"class","status-indicator svelte-19llkxn"),At(p,"ready",c[0]),At(p,"error",!c[0]),h(p,v,209,6,4790),h(S,v,210,6,4892),y(d,"class","status svelte-19llkxn"),h(d,v,208,4,4763),y(s,"class","header svelte-19llkxn"),h(s,v,205,2,4668),y(u,"class","btn btn-primary svelte-19llkxn"),u.disabled=M=!c[0]||c[3],h(u,v,216,4,5020),y(V,"class","btn btn-secondary svelte-19llkxn"),V.disabled=j=!c[0]||c[3],h(V,v,228,4,5251),y(x,"class","controls svelte-19llkxn"),h(x,v,215,2,4989),y(t,"class","container svelte-19llkxn"),h(t,v,204,0,4642)},m:function(R,$){Ie(R,e,$),Ie(R,t,$),r(t,s),r(s,n),r(s,a),r(s,o),r(s,g),r(s,d),r(d,p),r(d,k),r(d,S),r(S,H),r(t,I),r(t,x),r(x,u),P.m(u,null),r(x,G),r(x,V),r(V,F),r(t,te),E&&E.m(t,null),r(t,ue),O&&O.m(t,null),r(t,B),z&&z.m(t,null),J||(de=[qt(u,"click",c[7],!1),qt(V,"click",c[8],!1)],J=!0)},p:function(R,[$]){$&1&&At(p,"ready",R[0]),$&1&&At(p,"error",!R[0]),$&1&&C!==(C=R[0]?"準備完了":"初期化中...")&&q(H,C),K!==(K=Ae(R))&&(P.d(1),P=K(R),P&&(P.c(),P.m(u,null))),$&9&&M!==(M=!R[0]||R[3])&&Ot(u,"disabled",M),$&9&&j!==(j=!R[0]||R[3])&&Ot(V,"disabled",j),R[3]&&R[1]?E?E.p(R,$):(E=Ct(R),E.c(),E.m(t,ue)):E&&(E.d(1),E=null),R[2].length>0?O?O.p(R,$):(O=xt(R),O.c(),O.m(t,B)):O&&(O.d(1),O=null),R[5]?z?z.p(R,$):(z=wt(R),z.c(),z.m(t,null)):z&&(z.d(1),z=null)},i:Lt,o:Lt,d:function(R){R&&(A(e),A(t)),P.d(),E&&E.d(),O&&O.d(),z&&z.d(),J=!1,ts(de)}};return ze("SvelteRegisterBlock",{block:U,id:Tt.name,type:"component",source:"",ctx:c}),U}function It(c){return c>=90?"#10b981":c>=80?"#3b82f6":c>=70?"#f59e0b":c>=60?"#f97316":"#ef4444"}function zt(c){return["S","A+","A"].includes(c)?"#10b981":["B+","B"].includes(c)?"#3b82f6":["C+","C"].includes(c)?"#f59e0b":["D+","D"].includes(c)?"#f97316":"#ef4444"}function as(c,e,t){let{$$slots:s={},$$scope:n}=e;es("Page",s,[]);let i=null,a=!1,o=[{name:"完璧な長3度認識",baseFreq:440,targetFreq:554.37,detectedFreq:554.37,responseTime:800,volume:60,expected:"高得点"},{name:"やや不正確な完全5度",baseFreq:261.63,targetFreq:392,detectedFreq:385,responseTime:1500,volume:50,expected:"中程度の得点"},{name:"遅い反応での短2度",baseFreq:293.66,targetFreq:311.13,detectedFreq:315,responseTime:4e3,volume:45,expected:"速度減点あり"},{name:"方向性間違い",baseFreq:349.23,targetFreq:293.66,detectedFreq:415.3,responseTime:2200,volume:65,expected:"方向性エラー"}],l=null,g=[],d=!1,p=0,k=null;Vt(()=>{S()});function S(){try{i=new St({weights:{pitchAccuracy:.4,recognitionSpeed:.2,intervalMastery:.2,directionAccuracy:.1,consistency:.1},speedThresholds:{excellent:1e3,good:2e3,fair:3e3,poor:5e3}}),t(0,a=!0),console.log("✅ EnhancedScoringEngine初期化完了")}catch(u){console.error("❌ EnhancedScoringEngine初期化エラー:",u)}}async function C(u){if(!a)return console.error("採点エンジンが初期化されていません"),null;try{console.log(`🧪 テスト実行: ${u.name}`);const M=await i.analyzePerformance({baseFreq:u.baseFreq,targetFreq:u.targetFreq,detectedFreq:u.detectedFreq,responseTime:u.responseTime,volume:u.volume,harmonicCorrection:null});return{scenario:u.name,expected:u.expected,result:M,timestamp:new Date().toLocaleTimeString()}}catch(M){return console.error("❌ テスト実行エラー:",M),{scenario:u.name,expected:u.expected,error:M.message,timestamp:new Date().toLocaleTimeString()}}}async function H(){if(!a){alert("採点エンジンが初期化されていません");return}t(3,d=!0),t(2,g=[]),t(1,l=null),t(4,p=0);for(let u=0;u<o.length;u++){t(4,p=u),t(1,l=o[u]),await new Promise(G=>setTimeout(G,500));const M=await C(o[u]);M&&t(2,g=[...g,M])}t(3,d=!1),t(1,l=null),t(5,k=i.getStatistics()),console.log("✅ 全テスト完了")}function I(){i&&(i.reset(),t(2,g=[]),t(5,k=null),console.log("🔄 エンジンリセット完了"))}const x=[];return Object.keys(e).forEach(u=>{!~x.indexOf(u)&&u.slice(0,2)!=="$$"&&u!=="slot"&&is.warn(`<Page> was created with unknown prop '${u}'`)}),c.$capture_state=()=>({onMount:Vt,EnhancedScoringEngine:St,scoringEngine:i,isInitialized:a,testScenarios:o,currentTest:l,testResults:g,isRunning:d,currentScenarioIndex:p,engineStats:k,initializeScoringEngine:S,runSingleTest:C,runAllTests:H,resetEngine:I,getScoreColor:It,getGradeColor:zt}),c.$inject_state=u=>{"scoringEngine"in u&&(i=u.scoringEngine),"isInitialized"in u&&t(0,a=u.isInitialized),"testScenarios"in u&&t(6,o=u.testScenarios),"currentTest"in u&&t(1,l=u.currentTest),"testResults"in u&&t(2,g=u.testResults),"isRunning"in u&&t(3,d=u.isRunning),"currentScenarioIndex"in u&&t(4,p=u.currentScenarioIndex),"engineStats"in u&&t(5,k=u.engineStats)},e&&"$$inject"in e&&c.$inject_state(e.$$inject),[a,l,g,d,p,k,o,H,I]}class us extends Xt{constructor(e){super(e),Yt(this,e,as,Tt,Zt,{}),ze("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:Tt.name})}}export{us as component};
