const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/ytCVdwWH.js","../chunks/CizCsqwh.js","../chunks/C-w4tHdS.js","../chunks/D0QH3NT1.js","../chunks/ByYRvuZh.js","../assets/sessionStorage.BHSgymFr.css"])))=>i.map(i=>d[i]);
import{_ as Tn}from"../chunks/C1FmrZbK.js";import{S as $t,i as en,s as tn,d as oe,_ as st,a as nn,$ as In,D as Ao,q as ge,r as ee,u as W,w as he,x as pe,y as ye,E as Eo,F as To,G as Io,Q as Qe,Y as Pn,b as v,R as on,e as Te,z as R,K as Ie,L as Pe,f as Y,g as d,h as D,j as q,k as H,l as te,m as K,A as ve,o as C,t as ne,p as Q,M as Ge,v as He,c as je,H as Mn,Z as Bn,J as Po,N as ze,n as Qn}from"../chunks/CizCsqwh.js";import{g as Mo}from"../chunks/D0QH3NT1.js";import"../chunks/C-w4tHdS.js";import{b as ft,g as _t}from"../chunks/ByYRvuZh.js";import{p as St}from"../chunks/ClTM2qOk.js";import{P as Xn,B as dt,C as Xe}from"../chunks/Yk103YIT.js";import{l as le,a as Ze,h as bt,P as Yn,b as $n,V as Bo}from"../chunks/DQP8t4Dz.js";import{I as eo,y as Vo,z as xo,B as Vn,Z as xn,D as Hn,F as jn,l as wt,d as ot,e as Ho,r as jo,f as zn,u as kt,g as zo,h as Dt,p as Lo,o as Oo,j as Go,s as qt,i as Ct,k as Uo,m as Ft,a as Rt,n as Nt,c as At,t as Et,E as Ln,q as at,A as an,U as rn,G as Wo,H as Zo,J as Jo,K as Ko,T as Qo,P as Xo,M as to,C as Yo,S as $o,x as Tt}from"../chunks/ytCVdwWH.js";function no(o){let t;const e=o[2].default,c=Ao(e,o,o[3],null),r={c:function(){c&&c.c()},l:function(a){c&&c.l(a)},m:function(a,i){c&&c.m(a,i),t=!0},p:function(a,i){c&&c.p&&(!t||i&8)&&Eo(c,e,a,a[3],t?Io(e,a[3],i,null):To(a[3]),null)},i:function(a){t||(W(c,a),t=!0)},o:function(a){ee(c,a),t=!1},d:function(a){c&&c.d(a)}};return oe("SvelteRegisterBlock",{block:r,id:no.name,type:"slot",source:'(36:0) <Icon name=\\"navigation\\" {...$$props} iconNode={iconNode}>',ctx:o}),r}function Mt(o){let t,e;const c=[{name:"navigation"},o[1],{iconNode:o[0]}];let r={$$slots:{default:[no]},$$scope:{ctx:o}};for(let a=0;a<c.length;a+=1)r=st(r,c[a]);t=new eo({props:r,$$inline:!0});const n={c:function(){ye(t.$$.fragment)},l:function(i){pe(t.$$.fragment,i)},m:function(i,g){he(t,i,g),e=!0},p:function(i,[g]){const l=g&3?Vo(c,[c[0],g&2&&xo(i[1]),g&1&&{iconNode:i[0]}]):{};g&8&&(l.$$scope={dirty:g,ctx:i}),t.$set(l)},i:function(i){e||(W(t.$$.fragment,i),e=!0)},o:function(i){ee(t.$$.fragment,i),e=!1},d:function(i){ge(t,i)}};return oe("SvelteRegisterBlock",{block:n,id:Mt.name,type:"component",source:"",ctx:o}),n}function ea(o,t,e){let{$$slots:c={},$$scope:r}=t;nn("Navigation",c,["default"]);const n=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11"}]];return o.$$set=a=>{e(1,t=st(st({},t),In(a))),"$$scope"in a&&e(3,r=a.$$scope)},o.$capture_state=()=>({Icon:eo,iconNode:n}),o.$inject_state=a=>{e(1,t=st(st({},t),a))},t&&"$$inject"in t&&o.$inject_state(t.$$inject),t=In(t),[n,t,c,r]}class On extends $t{constructor(t){super(t),en(this,t,ea,Mt,tn,{}),oe("SvelteRegisterComponent",{component:this,tagName:"Navigation",options:t,id:Mt.name})}}const de="src/lib/components/scoring/ScoreResultPanel.svelte";function Gn(o,t,e){const c=o.slice();return c[7]=t[e],c}function Bt(o){let t,e,c,r,n,a,i=o[7].name+"",g,l,f,h,p=o[7].weight+"",m,y,b,A,L=(o[2][o[7].key]||0)+"",P,k,T,F,O,_;var w=o[7].icon;function V(E,I){return{props:{class:"w-5 h-5 text-gray-600"},$$inline:!0}}w&&(r=Pn(w,V()));const B={c:function(){t=C("div"),e=C("div"),c=C("div"),r&&ye(r.$$.fragment),n=Q(),a=C("span"),g=ne(i),l=Q(),f=C("span"),h=ne("("),m=ne(p),y=ne("%)"),b=Q(),A=C("span"),P=ne(L),k=Q(),T=C("div"),F=C("div"),O=Q(),this.h()},l:function(I){t=q(I,"DIV",{class:!0});var S=H(t);e=q(S,"DIV",{class:!0});var G=H(e);c=q(G,"DIV",{class:!0});var J=H(c);r&&pe(r.$$.fragment,J),n=K(J),a=q(J,"SPAN",{class:!0});var M=H(a);g=te(M,i),M.forEach(v),l=K(J),f=q(J,"SPAN",{class:!0});var U=H(f);h=te(U,"("),m=te(U,p),y=te(U,"%)"),U.forEach(v),J.forEach(v),b=K(G),A=q(G,"SPAN",{class:!0});var z=H(A);P=te(z,L),z.forEach(v),G.forEach(v),k=K(S),T=q(S,"DIV",{class:!0});var $=H(T);F=q($,"DIV",{class:!0,style:!0}),H(F).forEach(v),$.forEach(v),O=K(S),S.forEach(v),this.h()},h:function(){R(a,"class","font-medium text-gray-700"),D(a,de,63,14,2916),R(f,"class","text-xs text-gray-500"),D(f,de,64,14,2991),R(c,"class","flex items-center gap-2"),D(c,de,61,12,2780),R(A,"class","font-bold text-lg text-gray-800"),D(A,de,66,12,3084),R(e,"class","flex items-center justify-between mb-1"),D(e,de,60,10,2715),R(F,"class","bg-gradient-to-r from-blue-400 to-blue-600 h-2 rounded-full transition-all duration-500"),Ge(F,"width",(o[2][o[7].key]||0)+"%"),D(F,de,71,12,3289),R(T,"class","w-full bg-gray-200 rounded-full h-2"),D(T,de,70,10,3227),R(t,"class","scoring-aspect svelte-1eorlgc"),D(t,de,59,8,2676)},m:function(I,S){Y(I,t,S),d(t,e),d(e,c),r&&he(r,c,null),d(c,n),d(c,a),d(a,g),d(c,l),d(c,f),d(f,h),d(f,m),d(f,y),d(e,b),d(e,A),d(A,P),d(t,k),d(t,T),d(T,F),d(t,O),_=!0},p:function(I,S){if(w!==(w=I[7].icon)){if(r){Ie();const G=r;ee(G.$$.fragment,1,0,()=>{ge(G,1)}),Pe()}w?(r=Pn(w,V()),ye(r.$$.fragment),W(r.$$.fragment,1),he(r,c,n)):r=null}(!_||S&4)&&L!==(L=(I[2][I[7].key]||0)+"")&&Te(P,L),(!_||S&4)&&Ge(F,"width",(I[2][I[7].key]||0)+"%")},i:function(I){_||(r&&W(r.$$.fragment,I),_=!0)},o:function(I){r&&ee(r.$$.fragment,I),_=!1},d:function(I){I&&v(t),r&&ge(r)}};return oe("SvelteRegisterBlock",{block:B,id:Bt.name,type:"each",source:"(59:6) {#each scoringAspects as aspect}",ctx:o}),B}function Vt(o){let t,e,c,r,n,a,i,g,l,f,h="点",p,m,y,b,A,L,P="グレード",k,T,F,O,_="採点詳細",w,V,B,E,I=Qe(o[5]),S=[];for(let M=0;M<I.length;M+=1)S[M]=Bt(Gn(o,I,M));const G=M=>ee(S[M],1,1,()=>{S[M]=null}),J={c:function(){t=C("div"),e=C("div"),c=C("div"),r=C("div"),n=C("div"),a=C("div"),i=ne(o[0]),l=Q(),f=C("div"),f.textContent=h,p=Q(),m=C("div"),y=C("div"),b=ne(o[1]),A=Q(),L=C("div"),L.textContent=P,T=Q(),F=C("div"),O=C("h3"),O.textContent=_,w=Q(),V=C("div");for(let U=0;U<S.length;U+=1)S[U].c();this.h()},l:function(U){t=q(U,"DIV",{class:!0});var z=H(t);e=q(z,"DIV",{class:!0});var $=H(e);c=q($,"DIV",{class:!0});var se=H(c);r=q(se,"DIV",{class:!0});var be=H(r);n=q(be,"DIV",{class:!0});var ke=H(n);a=q(ke,"DIV",{class:!0});var Me=H(a);i=te(Me,o[0]),Me.forEach(v),l=K(ke),f=q(ke,"DIV",{class:!0,"data-svelte-h":!0}),ve(f)!=="svelte-tq02xs"&&(f.textContent=h),ke.forEach(v),be.forEach(v),p=K(se),m=q(se,"DIV",{class:!0});var _e=H(m);y=q(_e,"DIV",{class:!0});var De=H(y);b=te(De,o[1]),De.forEach(v),A=K(_e),L=q(_e,"DIV",{class:!0,"data-svelte-h":!0}),ve(L)!=="svelte-1varsz0"&&(L.textContent=P),_e.forEach(v),se.forEach(v),$.forEach(v),T=K(z),F=q(z,"DIV",{class:!0});var Fe=H(F);O=q(Fe,"H3",{class:!0,"data-svelte-h":!0}),ve(O)!=="svelte-1qj7xji"&&(O.textContent=_),w=K(Fe),V=q(Fe,"DIV",{class:!0});var qe=H(V);for(let Re=0;Re<S.length;Re+=1)S[Re].l(qe);qe.forEach(v),Fe.forEach(v),z.forEach(v),this.h()},h:function(){R(a,"class",g="text-5xl font-bold "+o[4].text+" svelte-1eorlgc"),D(a,de,43,10,2168),R(f,"class","text-sm text-gray-600"),D(f,de,44,10,2247),R(n,"class","text-center"),D(n,de,42,8,2132),R(r,"class","inline-flex items-center justify-center w-32 h-32 bg-white rounded-full shadow-lg mb-4"),D(r,de,41,6,2023),R(y,"class","text-4xl font-bold mb-2"),D(y,de,48,8,2357),R(L,"class","text-lg opacity-90"),D(L,de,49,8,2416),R(m,"class","text-white"),D(m,de,47,6,2324),R(c,"class","text-center"),D(c,de,40,4,1991),R(e,"class",k="bg-gradient-to-r "+o[4].bg+" p-6 svelte-1eorlgc"),D(e,de,39,2,1936),R(O,"class","text-lg font-semibold text-gray-800 mb-4"),D(O,de,56,4,2538),R(V,"class","space-y-3"),D(V,de,57,4,2605),R(F,"class","p-6"),D(F,de,55,2,2516),R(t,"class",B="score-result-panel "+o[3]+" bg-white rounded-xl shadow-lg overflow-hidden svelte-1eorlgc"),D(t,de,37,0,1821)},m:function(U,z){Y(U,t,z),d(t,e),d(e,c),d(c,r),d(r,n),d(n,a),d(a,i),d(n,l),d(n,f),d(c,p),d(c,m),d(m,y),d(y,b),d(m,A),d(m,L),d(t,T),d(t,F),d(F,O),d(F,w),d(F,V);for(let $=0;$<S.length;$+=1)S[$]&&S[$].m(V,null);E=!0},p:function(U,[z]){if((!E||z&1)&&Te(i,U[0]),(!E||z&16&&g!==(g="text-5xl font-bold "+U[4].text+" svelte-1eorlgc"))&&R(a,"class",g),(!E||z&2)&&Te(b,U[1]),(!E||z&16&&k!==(k="bg-gradient-to-r "+U[4].bg+" p-6 svelte-1eorlgc"))&&R(e,"class",k),z&36){I=Qe(U[5]);let $;for($=0;$<I.length;$+=1){const se=Gn(U,I,$);S[$]?(S[$].p(se,z),W(S[$],1)):(S[$]=Bt(se),S[$].c(),W(S[$],1),S[$].m(V,null))}for(Ie(),$=I.length;$<S.length;$+=1)G($);Pe()}(!E||z&8&&B!==(B="score-result-panel "+U[3]+" bg-white rounded-xl shadow-lg overflow-hidden svelte-1eorlgc"))&&R(t,"class",B)},i:function(U){if(!E){for(let z=0;z<I.length;z+=1)W(S[z]);E=!0}},o:function(U){S=S.filter(Boolean);for(let z=0;z<S.length;z+=1)ee(S[z]);E=!1},d:function(U){U&&v(t),on(S,U)}};return oe("SvelteRegisterBlock",{block:J,id:Vt.name,type:"component",source:"",ctx:o}),J}function ta(o,t,e){let c,{$$slots:r={},$$scope:n}=t;nn("ScoreResultPanel",r,[]);let{totalScore:a=0}=t,{grade:i="C"}=t,{componentScores:g={}}=t,{className:l=""}=t;const f=m=>{const y={S:{bg:"from-yellow-400 to-yellow-600",text:"text-yellow-900",shadow:"shadow-yellow-200"},"A+":{bg:"from-green-400 to-green-600",text:"text-green-900",shadow:"shadow-green-200"},A:{bg:"from-green-500 to-green-700",text:"text-green-900",shadow:"shadow-green-200"},"B+":{bg:"from-blue-400 to-blue-600",text:"text-blue-900",shadow:"shadow-blue-200"},B:{bg:"from-blue-500 to-blue-700",text:"text-blue-900",shadow:"shadow-blue-200"},"C+":{bg:"from-orange-400 to-orange-600",text:"text-orange-900",shadow:"shadow-orange-200"},C:{bg:"from-orange-500 to-orange-700",text:"text-orange-900",shadow:"shadow-orange-200"},"D+":{bg:"from-red-400 to-red-600",text:"text-red-900",shadow:"shadow-red-200"},D:{bg:"from-red-500 to-red-700",text:"text-red-900",shadow:"shadow-red-200"},F:{bg:"from-gray-400 to-gray-600",text:"text-gray-900",shadow:"shadow-gray-200"}};return y[m]||y.C},h=[{key:"pitchAccuracy",name:"音程精度",icon:Vn,weight:40},{key:"recognitionSpeed",name:"認識速度",icon:xn,weight:20},{key:"intervalMastery",name:"音程習得",icon:Hn,weight:20},{key:"directionAccuracy",name:"方向精度",icon:On,weight:10},{key:"consistency",name:"一貫性",icon:jn,weight:10}],p=["totalScore","grade","componentScores","className"];return Object.keys(t).forEach(m=>{!~p.indexOf(m)&&m.slice(0,2)!=="$$"&&m!=="slot"&&console.warn(`<ScoreResultPanel> was created with unknown prop '${m}'`)}),o.$$set=m=>{"totalScore"in m&&e(0,a=m.totalScore),"grade"in m&&e(1,i=m.grade),"componentScores"in m&&e(2,g=m.componentScores),"className"in m&&e(3,l=m.className)},o.$capture_state=()=>({Target:Vn,Zap:xn,BarChart3:Hn,Navigation:On,Activity:jn,totalScore:a,grade:i,componentScores:g,className:l,getGradeStyle:f,scoringAspects:h,gradeStyle:c}),o.$inject_state=m=>{"totalScore"in m&&e(0,a=m.totalScore),"grade"in m&&e(1,i=m.grade),"componentScores"in m&&e(2,g=m.componentScores),"className"in m&&e(3,l=m.className),"gradeStyle"in m&&e(4,c=m.gradeStyle)},t&&"$$inject"in t&&o.$inject_state(t.$$inject),o.$$.update=()=>{o.$$.dirty&2&&e(4,c=f(i))},[a,i,g,l,c,h]}class na extends $t{constructor(t){super(t),en(this,t,ta,Vt,tn,{totalScore:0,grade:1,componentScores:2,className:3}),oe("SvelteRegisterComponent",{component:this,tagName:"ScoreResultPanel",options:t,id:Vt.name})}get totalScore(){throw new Error("<ScoreResultPanel>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set totalScore(t){throw new Error("<ScoreResultPanel>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get grade(){throw new Error("<ScoreResultPanel>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set grade(t){throw new Error("<ScoreResultPanel>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get componentScores(){throw new Error("<ScoreResultPanel>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set componentScores(t){throw new Error("<ScoreResultPanel>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get className(){throw new Error("<ScoreResultPanel>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set className(t){throw new Error("<ScoreResultPanel>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const oa=!1,aa=!1,va=Object.freeze(Object.defineProperty({__proto__:null,prerender:aa,ssr:oa},Symbol.toStringTag,{value:"Module"})),{Object:ra,console:sa}=Mo,j="src/routes/training/random/+page.svelte";function Un(o,t,e){const c=o.slice();return c[96]=t[e],c[98]=e,c}function Wn(o,t,e){const c=o.slice();return c[99]=t[e],c}function xt(o){var I,S,G;let t,e,c,r,n=(((I=o[23])==null?void 0:I.length)||0)+"",a,i,g,l,f,h=8-(((S=o[23])==null?void 0:S.length)||0)+"",p,m,y,b,A,L,P,k,T=Math.round((((G=o[23])==null?void 0:G.length)||0)/8*100)+"",F,O,_,w,V,B=o[0]==="results"&&Ht(o);const E={c:function(){t=C("div"),e=C("div"),c=C("div"),r=C("span"),a=ne(n),i=ne("/8"),g=Q(),l=C("span"),f=ne("残り "),p=ne(h),m=ne(" セッション"),y=Q(),b=C("div"),A=C("div"),L=C("div"),P=Q(),k=C("span"),F=ne(T),O=ne("%"),_=Q(),B&&B.c(),w=ze(),this.h()},l:function(M){t=q(M,"DIV",{class:!0});var U=H(t);e=q(U,"DIV",{class:!0});var z=H(e);c=q(z,"DIV",{class:!0});var $=H(c);r=q($,"SPAN",{class:!0});var se=H(r);a=te(se,n),i=te(se,"/8"),se.forEach(v),g=K($),l=q($,"SPAN",{class:!0});var be=H(l);f=te(be,"残り "),p=te(be,h),m=te(be," セッション"),be.forEach(v),$.forEach(v),y=K(z),b=q(z,"DIV",{class:!0});var ke=H(b);A=q(ke,"DIV",{class:!0});var Me=H(A);L=q(Me,"DIV",{class:!0,style:!0}),H(L).forEach(v),Me.forEach(v),P=K(ke),k=q(ke,"SPAN",{class:!0});var _e=H(k);F=te(_e,T),O=te(_e,"%"),_e.forEach(v),ke.forEach(v),z.forEach(v),U.forEach(v),_=K(M),B&&B.l(M),w=ze(),this.h()},h:function(){var M;R(r,"class","completed-count svelte-1ktm6f3"),D(r,j,2486,12,84406),R(l,"class","remaining-text svelte-1ktm6f3"),D(l,j,2487,12,84488),R(c,"class","session-info svelte-1ktm6f3"),D(c,j,2485,10,84367),R(L,"class","progress-fill svelte-1ktm6f3"),Ge(L,"width",(((M=o[23])==null?void 0:M.length)||0)/8*100+"%"),D(L,j,2491,14,84681),R(A,"class","progress-bar svelte-1ktm6f3"),D(A,j,2490,12,84640),R(k,"class","progress-text svelte-1ktm6f3"),D(k,j,2493,12,84807),R(b,"class","progress-section svelte-1ktm6f3"),D(b,j,2489,10,84597),R(e,"class","session-status svelte-1ktm6f3"),D(e,j,2484,8,84328),R(t,"class","session-progress svelte-1ktm6f3"),D(t,j,2483,6,84289)},m:function(M,U){Y(M,t,U),d(t,e),d(e,c),d(c,r),d(r,a),d(r,i),d(c,g),d(c,l),d(l,f),d(l,p),d(l,m),d(e,y),d(e,b),d(b,A),d(A,L),d(b,P),d(b,k),d(k,F),d(k,O),Y(M,_,U),B&&B.m(M,U),Y(M,w,U),V=!0},p:function(M,U){var z,$,se,be;(!V||U[0]&8388608)&&n!==(n=(((z=M[23])==null?void 0:z.length)||0)+"")&&Te(a,n),(!V||U[0]&8388608)&&h!==(h=8-((($=M[23])==null?void 0:$.length)||0)+"")&&Te(p,h),(!V||U[0]&8388608)&&Ge(L,"width",(((se=M[23])==null?void 0:se.length)||0)/8*100+"%"),(!V||U[0]&8388608)&&T!==(T=Math.round((((be=M[23])==null?void 0:be.length)||0)/8*100)+"")&&Te(F,T),M[0]==="results"?B?(B.p(M,U),U[0]&1&&W(B,1)):(B=Ht(M),B.c(),W(B,1),B.m(w.parentNode,w)):B&&(Ie(),ee(B,1,1,()=>{B=null}),Pe())},i:function(M){V||(W(B),V=!0)},o:function(M){ee(B),V=!1},d:function(M){M&&(v(t),v(_),v(w)),B&&B.d(M)}};return oe("SvelteRegisterBlock",{block:E,id:xt.name,type:"if",source:"(2483:4) {#if microphoneState === 'granted' && !$isLoading}",ctx:o}),E}function Ht(o){let t,e,c;e=new an({props:{isCompleted:o[5],position:"top"},$$inline:!0}),e.$on("action",o[29]);const r={c:function(){t=C("div"),ye(e.$$.fragment),this.h()},l:function(a){t=q(a,"DIV",{class:!0});var i=H(t);pe(e.$$.fragment,i),i.forEach(v),this.h()},h:function(){R(t,"class","top-action-buttons svelte-1ktm6f3"),D(t,j,2501,8,85046)},m:function(a,i){Y(a,t,i),he(e,t,null),c=!0},p:function(a,i){const g={};i[0]&32&&(g.isCompleted=a[5]),e.$set(g)},i:function(a){c||(W(e.$$.fragment,a),c=!0)},o:function(a){ee(e.$$.fragment,a),c=!1},d:function(a){a&&v(t),ge(e)}};return oe("SvelteRegisterBlock",{block:r,id:Ht.name,type:"if",source:"(2501:6) {#if trainingPhase === 'results'}",ctx:o}),r}function oo(o){let t,e;t=new Xe({props:{class:"error-card",$$slots:{default:[co]},$$scope:{ctx:o}},$$inline:!0});const c={c:function(){ye(t.$$.fragment)},l:function(n){pe(t.$$.fragment,n)},m:function(n,a){he(t,n,a),e=!0},p:function(n,a){const i={};a[3]&512&&(i.$$scope={dirty:a,ctx:n}),t.$set(i)},i:function(n){e||(W(t.$$.fragment,n),e=!0)},o:function(n){ee(t.$$.fragment,n),e=!1},d:function(n){ge(t,n)}};return oe("SvelteRegisterBlock",{block:c,id:oo.name,type:"else",source:"(2692:2) {:else}",ctx:o}),c}function ao(o){let t,e,c,r,n,a,i,g={isActive:o[1]==="granted",trainingPhase:o[0],className:"pitch-detector-content",debugMode:!0,disableHarmonicCorrection:!1};e=new $n({props:g,$$inline:!0}),o[33](e),e.$on("pitchUpdate",o[28]),e.$on("stateChange",So),e.$on("error",bo),e.$on("microphoneHealthChange",o[30]);let l=o[0]!=="results"&&jt(o),f=o[0]!=="results"&&Gt(o),h=o[0]==="results"&&Zt(o);const p={c:function(){t=C("div"),ye(e.$$.fragment),c=Q(),l&&l.c(),r=Q(),f&&f.c(),n=Q(),h&&h.c(),a=ze(),this.h()},l:function(y){t=q(y,"DIV",{style:!0});var b=H(t);pe(e.$$.fragment,b),b.forEach(v),c=K(y),l&&l.l(y),r=K(y),f&&f.l(y),n=K(y),h&&h.l(y),a=ze(),this.h()},h:function(){Ge(t,"display","none"),D(t,j,2520,4,85526)},m:function(y,b){Y(y,t,b),he(e,t,null),Y(y,c,b),l&&l.m(y,b),Y(y,r,b),f&&f.m(y,b),Y(y,n,b),h&&h.m(y,b),Y(y,a,b),i=!0},p:function(y,b){const A={};b[0]&2&&(A.isActive=y[1]==="granted"),b[0]&1&&(A.trainingPhase=y[0]),e.$set(A),y[0]!=="results"?l?(l.p(y,b),b[0]&1&&W(l,1)):(l=jt(y),l.c(),W(l,1),l.m(r.parentNode,r)):l&&(Ie(),ee(l,1,1,()=>{l=null}),Pe()),y[0]!=="results"?f?(f.p(y,b),b[0]&1&&W(f,1)):(f=Gt(y),f.c(),W(f,1),f.m(n.parentNode,n)):f&&(Ie(),ee(f,1,1,()=>{f=null}),Pe()),y[0]==="results"?h?(h.p(y,b),b[0]&1&&W(h,1)):(h=Zt(y),h.c(),W(h,1),h.m(a.parentNode,a)):h&&(Ie(),ee(h,1,1,()=>{h=null}),Pe())},i:function(y){i||(W(e.$$.fragment,y),W(l),W(f),W(h),i=!0)},o:function(y){ee(e.$$.fragment,y),ee(l),ee(f),ee(h),i=!1},d:function(y){y&&(v(t),v(c),v(r),v(n),v(a)),o[33](null),ge(e),l&&l.d(y),f&&f.d(y),h&&h.d(y)}};return oe("SvelteRegisterBlock",{block:p,id:ao.name,type:"if",source:"(2519:2) {#if microphoneState === 'granted'}",ctx:o}),p}function ro(o){let t;const e={c:function(){t=ne("🎤 マイクテストページへ移動")},l:function(r){t=te(r,"🎤 マイクテストページへ移動")},m:function(r,n){Y(r,t,n)},d:function(r){r&&v(t)}};return oe("SvelteRegisterBlock",{block:e,id:ro.name,type:"slot",source:'(2706:10) <Button variant=\\"primary\\" on:click={goToMicrophoneTest}>',ctx:o}),e}function so(o){let t;const e={c:function(){t=ne("🏠 ホームに戻る")},l:function(r){t=te(r,"🏠 ホームに戻る")},m:function(r,n){Y(r,t,n)},d:function(r){r&&v(t)}};return oe("SvelteRegisterBlock",{block:e,id:so.name,type:"slot",source:'(2709:10) <Button variant=\\"secondary\\" on:click={goHome}>',ctx:o}),e}function co(o){let t,e,c="🎤",r,n,a="マイクテストが必要です",i,g,l="ランダム基音トレーニングを開始する前に、マイクテストページで音声入力の確認をお願いします。",f,h,p,m,y,b="マイクテスト完了後",A,L,P,k="まずはマイクテストページで音声確認を行ってください。",T,F,O,_,w,V;O=new dt({props:{variant:"primary",$$slots:{default:[ro]},$$scope:{ctx:o}},$$inline:!0}),O.$on("click",o[26]),w=new dt({props:{variant:"secondary",$$slots:{default:[so]},$$scope:{ctx:o}},$$inline:!0}),w.$on("click",o[27]);const B={c:function(){t=C("div"),e=C("div"),e.textContent=c,r=Q(),n=C("h3"),n.textContent=a,i=Q(),g=C("p"),g.textContent=l,f=Q(),h=C("div"),p=C("p"),m=ne("このページは"),y=C("strong"),y.textContent=b,A=ne("にご利用いただけます。"),L=Q(),P=C("p"),P.textContent=k,T=Q(),F=C("div"),ye(O.$$.fragment),_=Q(),ye(w.$$.fragment),this.h()},l:function(I){t=q(I,"DIV",{class:!0});var S=H(t);e=q(S,"DIV",{class:!0,"data-svelte-h":!0}),ve(e)!=="svelte-15rbx8n"&&(e.textContent=c),r=K(S),n=q(S,"H3",{class:!0,"data-svelte-h":!0}),ve(n)!=="svelte-17kvze2"&&(n.textContent=a),i=K(S),g=q(S,"P",{class:!0,"data-svelte-h":!0}),ve(g)!=="svelte-12s9olt"&&(g.textContent=l),f=K(S),h=q(S,"DIV",{class:!0});var G=H(h);p=q(G,"P",{class:!0});var J=H(p);m=te(J,"このページは"),y=q(J,"STRONG",{"data-svelte-h":!0}),ve(y)!=="svelte-1n3qsr6"&&(y.textContent=b),A=te(J,"にご利用いただけます。"),J.forEach(v),L=K(G),P=q(G,"P",{class:!0,"data-svelte-h":!0}),ve(P)!=="svelte-v8nd09"&&(P.textContent=k),G.forEach(v),T=K(S),F=q(S,"DIV",{class:!0});var M=H(F);pe(O.$$.fragment,M),_=K(M),pe(w.$$.fragment,M),M.forEach(v),S.forEach(v),this.h()},h:function(){R(e,"class","error-icon svelte-1ktm6f3"),D(e,j,2695,8,91236),R(n,"class","svelte-1ktm6f3"),D(n,j,2696,8,91277),R(g,"class","svelte-1ktm6f3"),D(g,j,2697,8,91306),D(y,j,2700,19,91424),R(p,"class","svelte-1ktm6f3"),D(p,j,2700,10,91415),R(P,"class","svelte-1ktm6f3"),D(P,j,2701,10,91476),R(h,"class","recommendation svelte-1ktm6f3"),D(h,j,2699,8,91376),R(F,"class","action-buttons"),D(F,j,2704,8,91542),R(t,"class","error-content svelte-1ktm6f3"),D(t,j,2694,6,91200)},m:function(I,S){Y(I,t,S),d(t,e),d(t,r),d(t,n),d(t,i),d(t,g),d(t,f),d(t,h),d(h,p),d(p,m),d(p,y),d(p,A),d(h,L),d(h,P),d(t,T),d(t,F),he(O,F,null),d(F,_),he(w,F,null),V=!0},p:function(I,S){const G={};S[3]&512&&(G.$$scope={dirty:S,ctx:I}),O.$set(G);const J={};S[3]&512&&(J.$$scope={dirty:S,ctx:I}),w.$set(J)},i:function(I){V||(W(O.$$.fragment,I),W(w.$$.fragment,I),V=!0)},o:function(I){ee(O.$$.fragment,I),ee(w.$$.fragment,I),V=!1},d:function(I){I&&v(t),ge(O),ge(w)}};return oe("SvelteRegisterBlock",{block:B,id:co.name,type:"slot",source:'(2694:4) <Card class=\\"error-card\\">',ctx:o}),B}function jt(o){let t,e,c,r,n,a,i=!o[2]&&o[6].length>0&&zt(o);c=new Xe({props:{class:"main-card half-width",$$slots:{default:[go]},$$scope:{ctx:o}},$$inline:!0}),n=new Yn({props:{frequency:o[14],note:o[15],volume:o[13],isMuted:o[0]!=="guiding",muteMessage:"基音再生後に開始",className:"half-width",showGuidance:!1},$$inline:!0});const g={c:function(){i&&i.c(),t=Q(),e=C("div"),ye(c.$$.fragment),r=Q(),ye(n.$$.fragment),this.h()},l:function(f){i&&i.l(f),t=K(f),e=q(f,"DIV",{class:!0});var h=H(e);pe(c.$$.fragment,h),r=K(h),pe(n.$$.fragment,h),h.forEach(v),this.h()},h:function(){R(e,"class","side-by-side-container svelte-1ktm6f3"),D(e,j,2559,6,86863)},m:function(f,h){i&&i.m(f,h),Y(f,t,h),Y(f,e,h),he(c,e,null),d(e,r),he(n,e,null),a=!0},p:function(f,h){!f[2]&&f[6].length>0?i?(i.p(f,h),h[0]&68&&W(i,1)):(i=zt(f),i.c(),W(i,1),i.m(t.parentNode,t)):i&&(Ie(),ee(i,1,1,()=>{i=null}),Pe());const p={};h[0]&7041|h[3]&512&&(p.$$scope={dirty:h,ctx:f}),c.$set(p);const m={};h[0]&16384&&(m.frequency=f[14]),h[0]&32768&&(m.note=f[15]),h[0]&8192&&(m.volume=f[13]),h[0]&1&&(m.isMuted=f[0]!=="guiding"),n.$set(m)},i:function(f){a||(W(i),W(c.$$.fragment,f),W(n.$$.fragment,f),a=!0)},o:function(f){ee(i),ee(c.$$.fragment,f),ee(n.$$.fragment,f),a=!1},d:function(f){f&&(v(t),v(e)),i&&i.d(f),ge(c),ge(n)}};return oe("SvelteRegisterBlock",{block:g,id:jt.name,type:"if",source:"(2538:4) {#if trainingPhase !== 'results'}",ctx:o}),g}function zt(o){let t,e;t=new Xe({props:{class:"warning-card",$$slots:{default:[io]},$$scope:{ctx:o}},$$inline:!0});const c={c:function(){ye(t.$$.fragment)},l:function(n){pe(t.$$.fragment,n)},m:function(n,a){he(t,n,a),e=!0},p:function(n,a){const i={};a[0]&64|a[3]&512&&(i.$$scope={dirty:a,ctx:n}),t.$set(i)},i:function(n){e||(W(t.$$.fragment,n),e=!0)},o:function(n){ee(t.$$.fragment,n),e=!1},d:function(n){ge(t,n)}};return oe("SvelteRegisterBlock",{block:c,id:zt.name,type:"if",source:"(2541:6) {#if !microphoneHealthy && microphoneErrors.length > 0}",ctx:o}),c}function Lt(o){let t,e=o[99]+"",c;const r={c:function(){t=C("li"),c=ne(e),this.h()},l:function(a){t=q(a,"LI",{class:!0});var i=H(t);c=te(i,e),i.forEach(v),this.h()},h:function(){R(t,"class","svelte-1ktm6f3"),D(t,j,2549,16,86631)},m:function(a,i){Y(a,t,i),d(t,c)},p:function(a,i){i[0]&64&&e!==(e=a[99]+"")&&Te(c,e)},d:function(a){a&&v(t)}};return oe("SvelteRegisterBlock",{block:r,id:Lt.name,type:"each",source:"(2549:14) {#each microphoneErrors as error}",ctx:o}),r}function io(o){let t,e,c="⚠️ マイク接続に問題があります",r,n,a,i="マイクが正常に動作していません。以下の問題が検出されました：",g,l,f,h,p,m="解決方法:",y,b=Qe(o[6]),A=[];for(let P=0;P<b.length;P+=1)A[P]=Lt(Wn(o,b,P));const L={c:function(){t=C("div"),e=C("h3"),e.textContent=c,r=Q(),n=C("div"),a=C("p"),a.textContent=i,g=Q(),l=C("ul");for(let k=0;k<A.length;k+=1)A[k].c();f=Q(),h=C("p"),p=C("strong"),p.textContent=m,y=ne(" ページを再読み込みしてマイク許可を再度取得してください。"),this.h()},l:function(k){t=q(k,"DIV",{class:!0});var T=H(t);e=q(T,"H3",{class:!0,"data-svelte-h":!0}),ve(e)!=="svelte-15qec5x"&&(e.textContent=c),T.forEach(v),r=K(k),n=q(k,"DIV",{class:!0});var F=H(n);a=q(F,"P",{class:!0,"data-svelte-h":!0}),ve(a)!=="svelte-171o2p0"&&(a.textContent=i),g=K(F),l=q(F,"UL",{class:!0});var O=H(l);for(let w=0;w<A.length;w+=1)A[w].l(O);O.forEach(v),f=K(F),h=q(F,"P",{class:!0});var _=H(h);p=q(_,"STRONG",{"data-svelte-h":!0}),ve(p)!=="svelte-79o66n"&&(p.textContent=m),y=te(_," ページを再読み込みしてマイク許可を再度取得してください。"),_.forEach(v),F.forEach(v),this.h()},h:function(){R(e,"class","section-title svelte-1ktm6f3"),D(e,j,2543,12,86355),R(t,"class","card-header svelte-1ktm6f3"),D(t,j,2542,10,86317),R(a,"class","warning-message svelte-1ktm6f3"),D(a,j,2546,12,86469),R(l,"class","error-list svelte-1ktm6f3"),D(l,j,2547,12,86543),D(p,j,2553,14,86742),R(h,"class","fix-instruction svelte-1ktm6f3"),D(h,j,2552,12,86700),R(n,"class","card-content svelte-1ktm6f3"),D(n,j,2545,10,86430)},m:function(k,T){Y(k,t,T),d(t,e),Y(k,r,T),Y(k,n,T),d(n,a),d(n,g),d(n,l);for(let F=0;F<A.length;F+=1)A[F]&&A[F].m(l,null);d(n,f),d(n,h),d(h,p),d(h,y)},p:function(k,T){if(T[0]&64){b=Qe(k[6]);let F;for(F=0;F<b.length;F+=1){const O=Wn(k,b,F);A[F]?A[F].p(O,T):(A[F]=Lt(O),A[F].c(),A[F].m(l,null))}for(;F<A.length;F+=1)A[F].d(1);A.length=b.length}},d:function(k){k&&(v(t),v(r),v(n)),on(A,k)}};return oe("SvelteRegisterBlock",{block:L,id:io.name,type:"slot",source:'(2542:8) <Card class=\\"warning-card\\">',ctx:o}),L}function lo(o){let t;const e={c:function(){t=ne("🎹 ランダム基音再生")},l:function(r){t=te(r,"🎹 ランダム基音再生")},m:function(r,n){Y(r,t,n)},p:Qn,d:function(r){r&&v(t)}};return oe("SvelteRegisterBlock",{block:e,id:lo.name,type:"else",source:"(2576:14) {:else}",ctx:o}),e}function uo(o){let t,e,c;const r={c:function(){t=ne("🔄 "),e=ne(o[7]),c=ne(" 再生")},l:function(a){t=te(a,"🔄 "),e=te(a,o[7]),c=te(a," 再生")},m:function(a,i){Y(a,t,i),Y(a,e,i),Y(a,c,i)},p:function(a,i){i[0]&128&&Te(e,a[7])},d:function(a){a&&(v(t),v(e),v(c))}};return oe("SvelteRegisterBlock",{block:r,id:uo.name,type:"if",source:"(2574:68) ",ctx:o}),r}function fo(o){let t;const e={c:function(){t=ne("🎵 再生中...")},l:function(r){t=te(r,"🎵 再生中...")},m:function(r,n){Y(r,t,n)},p:Qn,d:function(r){r&&v(t)}};return oe("SvelteRegisterBlock",{block:e,id:fo.name,type:"if",source:"(2572:14) {#if isPlaying}",ctx:o}),e}function mo(o){let t;function e(a,i){return a[9]?fo:a[7]&&a[8]>0?uo:lo}let c=e(o),r=c(o);const n={c:function(){r.c(),t=ze()},l:function(i){r.l(i),t=ze()},m:function(i,g){r.m(i,g),Y(i,t,g)},p:function(i,g){c===(c=e(i))&&r?r.p(i,g):(r.d(1),r=c(i),r&&(r.c(),r.m(t.parentNode,t)))},d:function(i){i&&v(t),r.d(i)}};return oe("SvelteRegisterBlock",{block:n,id:mo.name,type:"slot",source:`(2567:12) <Button                variant=\\"primary\\"               disabled={isPlaying || trainingPhase === 'guiding' || trainingPhase === 'waiting'}               on:click={playBaseNote}             >`,ctx:o}),n}function Ot(o){let t,e,c,r,n,a=o[8].toFixed(1)+"",i,g;const l={c:function(){t=C("div"),e=ne("現在の基音: "),c=C("strong"),r=ne(o[7]),n=ne(" ("),i=ne(a),g=ne("Hz)"),this.h()},l:function(h){t=q(h,"DIV",{class:!0});var p=H(t);e=te(p,"現在の基音: "),c=q(p,"STRONG",{});var m=H(c);r=te(m,o[7]),m.forEach(v),n=te(p," ("),i=te(p,a),g=te(p,"Hz)"),p.forEach(v),this.h()},h:function(){D(c,j,2582,23,87692),R(t,"class","base-note-info svelte-1ktm6f3"),D(t,j,2581,14,87640)},m:function(h,p){Y(h,t,p),d(t,e),d(t,c),d(c,r),d(t,n),d(t,i),d(t,g)},p:function(h,p){p[0]&128&&Te(r,h[7]),p[0]&256&&a!==(a=h[8].toFixed(1)+"")&&Te(i,a)},d:function(h){h&&v(t)}};return oe("SvelteRegisterBlock",{block:l,id:Ot.name,type:"if",source:"(2581:12) {#if currentBaseNote}",ctx:o}),l}function go(o){let t,e,c="🎹 基音再生",r,n,a,i,g,l,f,h="ガイド開始まで",p,m,y,b,A,L,P,k;a=new dt({props:{variant:"primary",disabled:o[9]||o[0]==="guiding"||o[0]==="waiting",$$slots:{default:[mo]},$$scope:{ctx:o}},$$inline:!0}),a.$on("click",o[25]);let T=o[7]&&Ot(o);L=new to({props:{size:"20"},$$inline:!0});const F={c:function(){t=C("div"),e=C("h3"),e.textContent=c,r=Q(),n=C("div"),ye(a.$$.fragment),i=Q(),T&&T.c(),g=Q(),l=C("div"),f=C("div"),f.textContent=h,p=Q(),m=C("div"),y=C("div"),b=Q(),A=C("div"),ye(L.$$.fragment),this.h()},l:function(_){t=q(_,"DIV",{class:!0});var w=H(t);e=q(w,"H3",{class:!0,"data-svelte-h":!0}),ve(e)!=="svelte-syc53b"&&(e.textContent=c),w.forEach(v),r=K(_),n=q(_,"DIV",{class:!0});var V=H(n);pe(a.$$.fragment,V),i=K(V),T&&T.l(V),g=K(V),l=q(V,"DIV",{class:!0});var B=H(l);f=q(B,"DIV",{class:!0,"data-svelte-h":!0}),ve(f)!=="svelte-1dufnpv"&&(f.textContent=h),p=K(B),m=q(B,"DIV",{class:!0});var E=H(m);y=q(E,"DIV",{class:!0,style:!0}),H(y).forEach(v),b=K(E),A=q(E,"DIV",{class:!0});var I=H(A);pe(L.$$.fragment,I),I.forEach(v),E.forEach(v),B.forEach(v),V.forEach(v),this.h()},h:function(){R(e,"class","section-title svelte-1ktm6f3"),D(e,j,2563,12,87027),R(t,"class","card-header svelte-1ktm6f3"),D(t,j,2562,10,86989),R(f,"class","guide-start-label svelte-1ktm6f3"),D(f,j,2588,14,87917),R(y,"class","guide-progress-fill svelte-1ktm6f3"),Ge(y,"width",o[11]+"%"),D(y,j,2590,16,88022),R(A,"class",P="guide-music-icon "+(o[12]?"glowing":"")+" svelte-1ktm6f3"),D(A,j,2594,16,88170),R(m,"class","guide-start-bar svelte-1ktm6f3"),D(m,j,2589,14,87976),R(l,"class","guide-start-bar-container svelte-1ktm6f3"),D(l,j,2587,12,87863),R(n,"class","card-content svelte-1ktm6f3"),D(n,j,2565,10,87093)},m:function(_,w){Y(_,t,w),d(t,e),Y(_,r,w),Y(_,n,w),he(a,n,null),d(n,i),T&&T.m(n,null),d(n,g),d(n,l),d(l,f),d(l,p),d(l,m),d(m,y),d(m,b),d(m,A),he(L,A,null),k=!0},p:function(_,w){const V={};w[0]&513&&(V.disabled=_[9]||_[0]==="guiding"||_[0]==="waiting"),w[0]&896|w[3]&512&&(V.$$scope={dirty:w,ctx:_}),a.$set(V),_[7]?T?T.p(_,w):(T=Ot(_),T.c(),T.m(n,g)):T&&(T.d(1),T=null),(!k||w[0]&2048)&&Ge(y,"width",_[11]+"%"),(!k||w[0]&4096&&P!==(P="guide-music-icon "+(_[12]?"glowing":"")+" svelte-1ktm6f3"))&&R(A,"class",P)},i:function(_){k||(W(a.$$.fragment,_),W(L.$$.fragment,_),k=!0)},o:function(_){ee(a.$$.fragment,_),ee(L.$$.fragment,_),k=!1},d:function(_){_&&(v(t),v(r),v(n)),ge(a),T&&T.d(),ge(L)}};return oe("SvelteRegisterBlock",{block:F,id:go.name,type:"slot",source:'(2562:8) <Card class=\\"main-card half-width\\">',ctx:o}),F}function Gt(o){let t,e;t=new Xe({props:{class:"main-card",$$slots:{default:[ho]},$$scope:{ctx:o}},$$inline:!0});const c={c:function(){ye(t.$$.fragment)},l:function(n){pe(t.$$.fragment,n)},m:function(n,a){he(t,n,a),e=!0},p:function(n,a){const i={};a[0]&1025|a[3]&512&&(i.$$scope={dirty:a,ctx:n}),t.$set(i)},i:function(n){e||(W(t.$$.fragment,n),e=!0)},o:function(n){ee(t.$$.fragment,n),e=!1},d:function(n){ge(t,n)}};return oe("SvelteRegisterBlock",{block:c,id:Gt.name,type:"if",source:"(2616:4) {#if trainingPhase !== 'results'}",ctx:o}),c}function Ut(o){let t,e=o[96].name+"",c,r,n;const a={c:function(){t=C("div"),c=ne(e),r=Q(),this.h()},l:function(g){t=q(g,"DIV",{class:!0});var l=H(t);c=te(l,e),r=K(l),l.forEach(v),this.h()},h:function(){R(t,"class",n="scale-item "+o[96].state+" svelte-1ktm6f3"),D(t,j,2624,14,89072)},m:function(g,l){Y(g,t,l),d(t,c),d(t,r)},p:function(g,l){l[0]&1024&&e!==(e=g[96].name+"")&&Te(c,e),l[0]&1024&&n!==(n="scale-item "+g[96].state+" svelte-1ktm6f3")&&R(t,"class",n)},d:function(g){g&&v(t)}};return oe("SvelteRegisterBlock",{block:a,id:Ut.name,type:"each",source:"(2624:12) {#each scaleSteps as step, index}",ctx:o}),a}function Wt(o){let t,e,c,r="ドレミファソラシド",n;const a={c:function(){t=C("div"),e=ne("ガイドに合わせて "),c=C("strong"),c.textContent=r,n=ne(" を歌ってください"),this.h()},l:function(g){t=q(g,"DIV",{class:!0});var l=H(t);e=te(l,"ガイドに合わせて "),c=q(l,"STRONG",{"data-svelte-h":!0}),ve(c)!=="svelte-1dipf74"&&(c.textContent=r),n=te(l," を歌ってください"),l.forEach(v),this.h()},h:function(){D(c,j,2633,23,89339),R(t,"class","guide-instruction svelte-1ktm6f3"),D(t,j,2632,12,89284)},m:function(g,l){Y(g,t,l),d(t,e),d(t,c),d(t,n)},d:function(g){g&&v(t)}};return oe("SvelteRegisterBlock",{block:a,id:Wt.name,type:"if",source:"(2632:10) {#if trainingPhase === 'guiding'}",ctx:o}),a}function ho(o){let t,e,c="🎵 ドレミ音階ガイド",r,n,a,i,g=Qe(o[10]),l=[];for(let p=0;p<g.length;p+=1)l[p]=Ut(Un(o,g,p));let f=o[0]==="guiding"&&Wt(o);const h={c:function(){t=C("div"),e=C("h3"),e.textContent=c,r=Q(),n=C("div"),a=C("div");for(let m=0;m<l.length;m+=1)l[m].c();i=Q(),f&&f.c(),this.h()},l:function(m){t=q(m,"DIV",{class:!0});var y=H(t);e=q(y,"H3",{class:!0,"data-svelte-h":!0}),ve(e)!=="svelte-1mor0as"&&(e.textContent=c),y.forEach(v),r=K(m),n=q(m,"DIV",{class:!0});var b=H(n);a=q(b,"DIV",{class:!0});var A=H(a);for(let L=0;L<l.length;L+=1)l[L].l(A);A.forEach(v),i=K(b),f&&f.l(b),b.forEach(v),this.h()},h:function(){R(e,"class","section-title svelte-1ktm6f3"),D(e,j,2619,10,88883),R(t,"class","card-header svelte-1ktm6f3"),D(t,j,2618,8,88847),R(a,"class","scale-guide svelte-1ktm6f3"),D(a,j,2622,10,88986),R(n,"class","card-content svelte-1ktm6f3"),D(n,j,2621,8,88949)},m:function(m,y){Y(m,t,y),d(t,e),Y(m,r,y),Y(m,n,y),d(n,a);for(let b=0;b<l.length;b+=1)l[b]&&l[b].m(a,null);d(n,i),f&&f.m(n,null)},p:function(m,y){if(y[0]&1024){g=Qe(m[10]);let b;for(b=0;b<g.length;b+=1){const A=Un(m,g,b);l[b]?l[b].p(A,y):(l[b]=Ut(A),l[b].c(),l[b].m(a,null))}for(;b<l.length;b+=1)l[b].d(1);l.length=g.length}m[0]==="guiding"?f||(f=Wt(m),f.c(),f.m(n,null)):f&&(f.d(1),f=null)},d:function(m){m&&(v(t),v(r),v(n)),on(l,m),f&&f.d()}};return oe("SvelteRegisterBlock",{block:h,id:ho.name,type:"slot",source:'(2618:6) <Card class=\\"main-card\\">',ctx:o}),h}function Zt(o){let t,e,c,r,n;const a=[po,yo],i=[];function g(h,p){return h[4]&&h[5]?0:h[21]?1:-1}~(t=g(o))&&(e=i[t]=a[t](o));let l=o[0]==="results"&&Jt(o);const f={c:function(){e&&e.c(),c=Q(),l&&l.c(),r=ze()},l:function(p){e&&e.l(p),c=K(p),l&&l.l(p),r=ze()},m:function(p,m){~t&&i[t].m(p,m),Y(p,c,m),l&&l.m(p,m),Y(p,r,m),n=!0},p:function(p,m){let y=t;t=g(p),t===y?~t&&i[t].p(p,m):(e&&(Ie(),ee(i[y],1,1,()=>{i[y]=null}),Pe()),~t?(e=i[t],e?e.p(p,m):(e=i[t]=a[t](p),e.c()),W(e,1),e.m(c.parentNode,c)):e=null),p[0]==="results"?l?(l.p(p,m),m[0]&1&&W(l,1)):(l=Jt(p),l.c(),W(l,1),l.m(r.parentNode,r)):l&&(Ie(),ee(l,1,1,()=>{l=null}),Pe())},i:function(p){n||(W(e),W(l),n=!0)},o:function(p){ee(e),ee(l),n=!1},d:function(p){p&&(v(c),v(r)),~t&&i[t].d(p),l&&l.d(p)}};return oe("SvelteRegisterBlock",{block:f,id:Zt.name,type:"if",source:"(2643:4) {#if trainingPhase === 'results'}",ctx:o}),f}function yo(o){let t,e;t=new rn({props:{scoreData:o[21],showDetails:!1,className:"mb-6 iphone-no-margin",currentScoreData:o[16],intervalData:o[3],consistencyData:o[17],feedbackData:o[18],technicalFeedbackData:o[19],sessionStatistics:o[20]},$$inline:!0});const c={c:function(){ye(t.$$.fragment)},l:function(n){pe(t.$$.fragment,n)},m:function(n,a){he(t,n,a),e=!0},p:function(n,a){const i={};a[0]&2097152&&(i.scoreData=n[21]),a[0]&65536&&(i.currentScoreData=n[16]),a[0]&8&&(i.intervalData=n[3]),a[0]&131072&&(i.consistencyData=n[17]),a[0]&262144&&(i.feedbackData=n[18]),a[0]&524288&&(i.technicalFeedbackData=n[19]),a[0]&1048576&&(i.sessionStatistics=n[20]),t.$set(i)},i:function(n){e||(W(t.$$.fragment,n),e=!0)},o:function(n){ee(t.$$.fragment,n),e=!1},d:function(n){ge(t,n)}};return oe("SvelteRegisterBlock",{block:c,id:yo.name,type:"if",source:"(2658:40) ",ctx:o}),c}function po(o){let t,e;t=new rn({props:{scoreData:o[4],showDetails:!1,className:"mb-6 iphone-no-margin",currentScoreData:o[16],intervalData:o[3],consistencyData:o[17],feedbackData:o[18],technicalFeedbackData:o[19],sessionStatistics:o[20]},$$inline:!0});const c={c:function(){ye(t.$$.fragment)},l:function(n){pe(t.$$.fragment,n)},m:function(n,a){he(t,n,a),e=!0},p:function(n,a){const i={};a[0]&16&&(i.scoreData=n[4]),a[0]&65536&&(i.currentScoreData=n[16]),a[0]&8&&(i.intervalData=n[3]),a[0]&131072&&(i.consistencyData=n[17]),a[0]&262144&&(i.feedbackData=n[18]),a[0]&524288&&(i.technicalFeedbackData=n[19]),a[0]&1048576&&(i.sessionStatistics=n[20]),t.$set(i)},i:function(n){e||(W(t.$$.fragment,n),e=!0)},o:function(n){ee(t.$$.fragment,n),e=!1},d:function(n){ge(t,n)}};return oe("SvelteRegisterBlock",{block:c,id:po.name,type:"if",source:"(2645:6) {#if $unifiedScoreData && $isCompleted}",ctx:o}),c}function Jt(o){let t,e;t=new Xe({props:{class:"main-card bottom-action-card",$$slots:{default:[vo]},$$scope:{ctx:o}},$$inline:!0});const c={c:function(){ye(t.$$.fragment)},l:function(n){pe(t.$$.fragment,n)},m:function(n,a){he(t,n,a),e=!0},p:function(n,a){const i={};a[0]&32|a[3]&512&&(i.$$scope={dirty:a,ctx:n}),t.$set(i)},i:function(n){e||(W(t.$$.fragment,n),e=!0)},o:function(n){ee(t.$$.fragment,n),e=!1},d:function(n){ge(t,n)}};return oe("SvelteRegisterBlock",{block:c,id:Jt.name,type:"if",source:"(2676:6) {#if trainingPhase === 'results'}",ctx:o}),c}function vo(o){let t,e,c;e=new an({props:{isCompleted:o[5],position:"bottom"},$$inline:!0}),e.$on("action",o[29]);const r={c:function(){t=C("div"),ye(e.$$.fragment),this.h()},l:function(a){t=q(a,"DIV",{class:!0});var i=H(t);pe(e.$$.fragment,i),i.forEach(v),this.h()},h:function(){R(t,"class","card-content svelte-1ktm6f3"),D(t,j,2677,10,90786)},m:function(a,i){Y(a,t,i),he(e,t,null),c=!0},p:function(a,i){const g={};i[0]&32&&(g.isCompleted=a[5]),e.$set(g)},i:function(a){c||(W(e.$$.fragment,a),c=!0)},o:function(a){ee(e.$$.fragment,a),c=!1},d:function(a){a&&v(t),ge(e)}};return oe("SvelteRegisterBlock",{block:r,id:vo.name,type:"slot",source:'(2677:8) <Card class=\\"main-card bottom-action-card\\">',ctx:o}),r}function _o(o){let t,e,c="🎵 ランダム基音トレーニング",r,n,a="10種類の基音からランダムに選択してドレミファソラシドを練習",i,g,l,f,h,p,m,y,b,A,L,P,k,T,F,O,_=o[1]==="granted"&&!o[24]&&xt(o);const w=[ao,oo],V=[];function B(I,S){return I[1]==="granted"?0:1}k=B(o),T=V[k]=w[k](o);const E={c:function(){t=C("div"),e=C("h1"),e.textContent=c,r=Q(),n=C("p"),n.textContent=a,i=Q(),_&&_.c(),g=Q(),l=C("div"),f=ne("📱 "),h=ne(Qt),p=ne(" | "),m=ne(Xt),y=C("br"),b=Q(),A=C("small"),L=ne(Yt),P=Q(),T.c(),F=ze(),this.h()},l:function(S){t=q(S,"DIV",{class:!0});var G=H(t);e=q(G,"H1",{class:!0,"data-svelte-h":!0}),ve(e)!=="svelte-1ptm9zr"&&(e.textContent=c),r=K(G),n=q(G,"P",{class:!0,"data-svelte-h":!0}),ve(n)!=="svelte-19nes7"&&(n.textContent=a),i=K(G),_&&_.l(G),g=K(G),l=q(G,"DIV",{class:!0});var J=H(l);f=te(J,"📱 "),h=te(J,Qt),p=te(J," | "),m=te(J,Xt),y=q(J,"BR",{}),b=K(J),A=q(J,"SMALL",{style:!0});var M=H(A);L=te(M,Yt),M.forEach(v),J.forEach(v),G.forEach(v),P=K(S),T.l(S),F=ze(),this.h()},h:function(){R(e,"class","page-title svelte-1ktm6f3"),D(e,j,2477,4,84084),R(n,"class","page-description svelte-1ktm6f3"),D(n,j,2478,4,84132),D(y,j,2512,42,85345),Ge(A,"font-size","0.6rem"),D(A,j,2513,6,85357),R(l,"class","debug-info svelte-1ktm6f3"),D(l,j,2511,4,85278),R(t,"class","header-section svelte-1ktm6f3"),D(t,j,2476,2,84051)},m:function(S,G){Y(S,t,G),d(t,e),d(t,r),d(t,n),d(t,i),_&&_.m(t,null),d(t,g),d(t,l),d(l,f),d(l,h),d(l,p),d(l,m),d(l,y),d(l,b),d(l,A),d(A,L),Y(S,P,G),V[k].m(S,G),Y(S,F,G),O=!0},p:function(S,G){S[1]==="granted"&&!S[24]?_?(_.p(S,G),G[0]&16777218&&W(_,1)):(_=xt(S),_.c(),W(_,1),_.m(t,g)):_&&(Ie(),ee(_,1,1,()=>{_=null}),Pe());let J=k;k=B(S),k===J?V[k].p(S,G):(Ie(),ee(V[J],1,1,()=>{V[J]=null}),Pe(),T=V[k],T?T.p(S,G):(T=V[k]=w[k](S),T.c()),W(T,1),T.m(F.parentNode,F))},i:function(S){O||(W(_),W(T),O=!0)},o:function(S){ee(_),ee(T),O=!1},d:function(S){S&&(v(t),v(P),v(F)),_&&_.d(),V[k].d(S)}};return oe("SvelteRegisterBlock",{block:E,id:_o.name,type:"slot",source:"(2475:0) <PageLayout>",ctx:o}),E}function Kt(o){let t,e;t=new Xn({props:{$$slots:{default:[_o]},$$scope:{ctx:o}},$$inline:!0});const c={c:function(){ye(t.$$.fragment)},l:function(n){pe(t.$$.fragment,n)},m:function(n,a){he(t,n,a),e=!0},p:function(n,a){const i={};a[0]&33554431|a[3]&512&&(i.$$scope={dirty:a,ctx:n}),t.$set(i)},i:function(n){e||(W(t.$$.fragment,n),e=!0)},o:function(n){ee(t.$$.fragment,n),e=!1},d:function(n){ge(t,n)}};return oe("SvelteRegisterBlock",{block:c,id:Kt.name,type:"component",source:"",ctx:o}),c}const Qt="v2.3.1-ANIMATED",Xt="07/29 04:15",Yt="🎬 評価分布アニメーション実装・UX向上";function Zn(){const o=/iPhone/.test(navigator.userAgent),t=/iPad/.test(navigator.userAgent),e=/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document;return o||t||e?(console.log("🔊 [RandomTraining] iOS/iPadOS検出 - 音量35dB設定"),35):(console.log("🔊 [RandomTraining] PC検出 - 音量-6dB設定"),-6)}function ca(){return{mode:"random",timestamp:new Date,duration:480,totalNotes:64,measuredNotes:59,averageAccuracy:79,baseNote:"C5",baseFrequency:523.25,sessionHistory:[{grade:"excellent",accuracy:92,baseNote:"C4",baseFrequency:261.63,timestamp:new Date(Date.now()-7*6e4),measuredNotes:8,noteResults:[{name:"ド",note:"ド",frequency:262,detectedFrequency:264,cents:13,grade:"excellent"},{name:"レ",note:"レ",frequency:294,detectedFrequency:291,cents:-18,grade:"good"},{name:"ミ",note:"ミ",frequency:330,detectedFrequency:335,cents:26,grade:"pass"},{name:"ファ",note:"ファ",frequency:349,detectedFrequency:346,cents:-15,grade:"excellent"},{name:"ソ",note:"ソ",frequency:392,detectedFrequency:388,cents:-18,grade:"good"},{name:"ラ",note:"ラ",frequency:440,detectedFrequency:444,cents:16,grade:"good"},{name:"シ",note:"シ",frequency:494,detectedFrequency:499,cents:17,grade:"good"},{name:"ド（高）",note:"ド（高）",frequency:523,detectedFrequency:520,cents:-10,grade:"excellent"}]},{grade:"good",accuracy:78,baseNote:"D4",baseFrequency:293.66,timestamp:new Date(Date.now()-6*6e4),measuredNotes:7,noteResults:[{name:"ド",note:"ド",frequency:294,detectedFrequency:290,cents:-23,grade:"good"},{name:"レ",note:"レ",frequency:330,detectedFrequency:340,cents:53,grade:"needWork"},{name:"ミ",note:"ミ",frequency:370,detectedFrequency:375,cents:23,grade:"good"},{name:"ファ",note:"ファ",frequency:392,detectedFrequency:385,cents:-31,grade:"pass"},{name:"ソ",note:"ソ",frequency:440,detectedFrequency:432,cents:-31,grade:"pass"},{name:"ラ",note:"ラ",frequency:494,detectedFrequency:510,cents:56,grade:"needWork"},{name:"シ",note:"シ",frequency:554,detectedFrequency:null,cents:null,grade:"notMeasured"},{name:"ド（高）",note:"ド（高）",frequency:587,detectedFrequency:580,cents:-21,grade:"good"}]},{grade:"excellent",accuracy:95,baseNote:"E4",baseFrequency:329.63,timestamp:new Date(Date.now()-5*6e4),measuredNotes:8,noteResults:[{name:"ド",note:"ド",frequency:330,detectedFrequency:332,cents:10,grade:"excellent"},{name:"レ",note:"レ",frequency:370,detectedFrequency:368,cents:-9,grade:"excellent"},{name:"ミ",note:"ミ",frequency:415,detectedFrequency:418,cents:12,grade:"excellent"},{name:"ファ",note:"ファ",frequency:440,detectedFrequency:436,cents:-16,grade:"good"},{name:"ソ",note:"ソ",frequency:494,detectedFrequency:497,cents:11,grade:"excellent"},{name:"ラ",note:"ラ",frequency:554,detectedFrequency:551,cents:-9,grade:"excellent"},{name:"シ",note:"シ",frequency:622,detectedFrequency:625,cents:8,grade:"excellent"},{name:"ド（高）",note:"ド（高）",frequency:659,detectedFrequency:655,cents:-10,grade:"excellent"}]},{grade:"needWork",accuracy:45,baseNote:"F4",baseFrequency:349.23,timestamp:new Date(Date.now()-4*6e4),measuredNotes:6,noteResults:[{name:"ド",note:"ド",frequency:349,detectedFrequency:345,cents:-20,grade:"good"},{name:"レ",note:"レ",frequency:392,detectedFrequency:420,cents:124,grade:"needWork"},{name:"ミ",note:"ミ",frequency:440,detectedFrequency:435,cents:-20,grade:"good"},{name:"ファ",note:"ファ",frequency:466,detectedFrequency:520,cents:195,grade:"needWork"},{name:"ソ",note:"ソ",frequency:523,detectedFrequency:410,cents:-455,grade:"needWork"},{name:"ラ",note:"ラ",frequency:587,detectedFrequency:null,cents:null,grade:"notMeasured"},{name:"シ",note:"シ",frequency:659,detectedFrequency:650,cents:-24,grade:"good"},{name:"ド（高）",note:"ド（高）",frequency:698,detectedFrequency:null,cents:null,grade:"notMeasured"}]},{grade:"good",accuracy:85,baseNote:"G4",baseFrequency:392,timestamp:new Date(Date.now()-3*6e4),measuredNotes:8,noteResults:[{name:"ド",note:"ド",frequency:392,detectedFrequency:395,cents:13,grade:"excellent"},{name:"レ",note:"レ",frequency:440,detectedFrequency:438,cents:-8,grade:"excellent"},{name:"ミ",note:"ミ",frequency:494,detectedFrequency:500,cents:21,grade:"good"},{name:"ファ",note:"ファ",frequency:523,detectedFrequency:520,cents:-10,grade:"excellent"},{name:"ソ",note:"ソ",frequency:587,detectedFrequency:595,cents:24,grade:"good"},{name:"ラ",note:"ラ",frequency:659,detectedFrequency:665,cents:16,grade:"good"},{name:"シ",note:"シ",frequency:740,detectedFrequency:755,cents:35,grade:"pass"},{name:"ド（高）",note:"ド（高）",frequency:784,detectedFrequency:780,cents:-9,grade:"excellent"}]},{grade:"excellent",accuracy:94,baseNote:"A4",baseFrequency:440,timestamp:new Date(Date.now()-2*6e4),measuredNotes:8,noteResults:[{name:"ド",note:"ド",frequency:440,detectedFrequency:442,cents:8,grade:"excellent"},{name:"レ",note:"レ",frequency:494,detectedFrequency:492,cents:-7,grade:"excellent"},{name:"ミ",note:"ミ",frequency:554,detectedFrequency:558,cents:12,grade:"excellent"},{name:"ファ",note:"ファ",frequency:587,detectedFrequency:585,cents:-6,grade:"excellent"},{name:"ソ",note:"ソ",frequency:659,detectedFrequency:665,cents:16,grade:"good"},{name:"ラ",note:"ラ",frequency:740,detectedFrequency:738,cents:-5,grade:"excellent"},{name:"シ",note:"シ",frequency:831,detectedFrequency:840,cents:19,grade:"good"},{name:"ド（高）",note:"ド（高）",frequency:880,detectedFrequency:882,cents:4,grade:"excellent"}]},{grade:"pass",accuracy:68,baseNote:"Bb4",baseFrequency:466.16,timestamp:new Date(Date.now()-1*6e4),measuredNotes:7,noteResults:[{name:"ド",note:"ド",frequency:466,detectedFrequency:470,cents:15,grade:"excellent"},{name:"レ",note:"レ",frequency:523,detectedFrequency:535,cents:39,grade:"pass"},{name:"ミ",note:"ミ",frequency:587,detectedFrequency:600,cents:38,grade:"pass"},{name:"ファ",note:"ファ",frequency:622,detectedFrequency:615,cents:-19,grade:"good"},{name:"ソ",note:"ソ",frequency:698,detectedFrequency:720,cents:54,grade:"needWork"},{name:"ラ",note:"ラ",frequency:784,detectedFrequency:null,cents:null,grade:"notMeasured"},{name:"シ",note:"シ",frequency:880,detectedFrequency:895,cents:29,grade:"pass"},{name:"ド（高）",note:"ド（高）",frequency:932,detectedFrequency:925,cents:-13,grade:"excellent"}]},{grade:"good",accuracy:82,baseNote:"C5",baseFrequency:523.25,timestamp:new Date,measuredNotes:8,noteResults:[{name:"ド",note:"ド",frequency:523,detectedFrequency:526,cents:10,grade:"excellent"},{name:"レ",note:"レ",frequency:587,detectedFrequency:584,cents:-9,grade:"excellent"},{name:"ミ",note:"ミ",frequency:659,detectedFrequency:665,cents:16,grade:"good"},{name:"ファ",note:"ファ",frequency:698,detectedFrequency:692,cents:-15,grade:"excellent"},{name:"ソ",note:"ソ",frequency:784,detectedFrequency:795,cents:24,grade:"good"},{name:"ラ",note:"ラ",frequency:880,detectedFrequency:890,cents:19,grade:"good"},{name:"シ",note:"シ",frequency:988,detectedFrequency:1010,cents:38,grade:"pass"},{name:"ド（高）",note:"ド（高）",frequency:1047,detectedFrequency:1042,cents:-8,grade:"excellent"}]}]}}function It(o){return[{scale:"ド",interval:"unison",intervalName:"ユニゾン"},{scale:"レ",interval:"major_second",intervalName:"長2度"},{scale:"ミ",interval:"major_third",intervalName:"長3度"},{scale:"ファ",interval:"perfect_fourth",intervalName:"完全4度"},{scale:"ソ",interval:"perfect_fifth",intervalName:"完全5度"},{scale:"ラ",interval:"major_sixth",intervalName:"長6度"},{scale:"シ",interval:"major_seventh",intervalName:"長7度"},{scale:"ド（高）",interval:"octave",intervalName:"オクターブ"}].map((e,c)=>{const r=o.find(n=>n.targetNote&&n.targetNote.includes(e.scale))||o[c];if(r&&r.accuracy!=="notMeasured"){const n=parseFloat(r.accuracy)||0,a=Math.round((100-n)*.5);return{type:e.interval,scale:e.scale,intervalName:e.intervalName,attempts:1,averageError:a,accuracy:n}}else return{type:e.interval,scale:e.scale,intervalName:e.intervalName,attempts:0,averageError:null,accuracy:0}})}function Jn(o){if(!o||!Array.isArray(o))return console.warn("⚠️ [RandomTraining] sessionHistory が無効です"),[];const t=[{type:"unison",scale:"ド",intervalName:"ユニゾン",noteIndex:0},{type:"major_second",scale:"レ",intervalName:"長2度",noteIndex:1},{type:"major_third",scale:"ミ",intervalName:"長3度",noteIndex:2},{type:"perfect_fourth",scale:"ファ",intervalName:"完全4度",noteIndex:3},{type:"perfect_fifth",scale:"ソ",intervalName:"完全5度",noteIndex:4},{type:"major_sixth",scale:"ラ",intervalName:"長6度",noteIndex:5},{type:"major_seventh",scale:"シ",intervalName:"長7度",noteIndex:6},{type:"octave",scale:"ド（高）",intervalName:"オクターブ",noteIndex:7}],e={};return t.forEach(c=>{e[c.type]={type:c.type,scale:c.scale,intervalName:c.intervalName,attempts:0,successCount:0,accuracySum:0,accuracyValues:[],errorValues:[]}}),o.forEach(c=>{!c.noteResults||!Array.isArray(c.noteResults)||c.noteResults.forEach((r,n)=>{if(n>=t.length)return;const a=t[n].type,i=e[a];if(i.attempts++,r.accuracy!=="notMeasured"&&typeof r.accuracy=="number"){i.accuracyValues.push(r.accuracy),i.accuracySum+=r.accuracy;const g=Math.round((100-r.accuracy)*.5);i.errorValues.push(g),r.accuracy>=70&&i.successCount++}})}),t.map(c=>{const r=e[c.type];if(r.attempts===0)return{type:c.type,scale:c.scale,intervalName:c.intervalName,attempts:0,averageError:null,accuracy:0};const n=r.accuracyValues.length>0?Math.round(r.accuracySum/r.accuracyValues.length):0,a=r.errorValues.length>0?Math.round(r.errorValues.reduce((g,l)=>g+l,0)/r.errorValues.length):null,i=r.accuracyValues.length>0?Math.round(r.successCount/r.accuracyValues.length*100):0;return{type:c.type,scale:c.scale,intervalName:c.intervalName,mastery:i,attempts:r.attempts,averageError:a,accuracy:n}})}function Kn(o){const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];if(o<=0)return"ーー";const c=Math.round(12*Math.log2(o/440)),r=(c+9+120)%12,n=Math.floor((c+9)/12)+4;return t[r]+n}function Pt(o,t){const e=[{factor:4,freq:o*4,description:"2オクターブ上"},{factor:3,freq:o*3,description:"1.5オクターブ上"},{factor:2.5,freq:o*2.5,description:"1.3オクターブ上"},{factor:2,freq:o*2,description:"1オクターブ上"},{factor:1.5,freq:o*1.5,description:"0.5オクターブ上"},{factor:1,freq:o,description:"補正なし"},{factor:.75,freq:o*.75,description:"0.33オクターブ下"},{factor:.67,freq:o*.67,description:"0.5オクターブ下"},{factor:.5,freq:o*.5,description:"1オクターブ下"},{factor:.4,freq:o*.4,description:"1.3オクターブ下"},{factor:.33,freq:o*.33,description:"1.5オクターブ下"},{factor:.25,freq:o*.25,description:"2オクターブ下"}];let c=null,r=1/0;const n=t*.5,a=t*1.5,i=e.filter(g=>g.freq>=n&&g.freq<=a);for(const g of i){const l=Math.abs(g.freq-t);l<r&&(r=l,c=g)}if(!c)for(const g of e){const l=Math.abs(g.freq-t);l<r&&(r=l,c=g)}return c?{correctedFrequency:c.freq,factor:c.factor,description:c.description,error:r}:{correctedFrequency:o,factor:1,description:"補正なし（フォールバック）",error:Math.abs(o-t)}}function rt(){try{"scrollTo"in window&&"behavior"in document.documentElement.style?window.scrollTo({top:0,behavior:"smooth"}):window.scrollTo(0,0),document.body&&(document.body.scrollTop=0),document.documentElement&&(document.documentElement.scrollTop=0),document.querySelectorAll("[data-scroll-container], .scroll-container, main").forEach(t=>{t.scrollTo?t.scrollTo(0,0):t.scrollTop=0})}catch(o){console.warn("スクロールエラー:",o);try{window.scroll(0,0)}catch(t){console.error("スクロール完全失敗:",t)}}}function So(o){}function bo(o){console.error("❌ PitchDetectorエラー:",o.detail)}function ia(o,t,e){let c,r,n,a,i,g,l,f,h,p,m,y;He(kt,"unifiedScoreData"),je(o,kt,s=>e(4,n=s)),He(Ct,"isCompleted"),je(o,Ct,s=>e(5,a=s)),He(St,"page"),je(o,St,s=>e(52,i=s)),He(At,"currentSessionId"),je(o,At,s=>e(53,g=s)),He(Dt,"remainingSessions"),je(o,Dt,s=>e(54,l=s)),He(Rt,"nextBaseName"),je(o,Rt,s=>e(55,f=s)),He(Nt,"nextBaseNote"),je(o,Nt,s=>e(56,h=s)),He(qt,"sessionHistory"),je(o,qt,s=>e(23,p=s)),He(Et,"trainingProgress"),je(o,Et,s=>e(57,m=s)),He(Ft,"isLoading"),je(o,Ft,s=>e(24,y=s));let{$$slots:b={},$$scope:A}=t;nn("Page",b,[]);function L(s){return at.evaluateOverall(s)}let P="setup",k=typeof window<"u"?new URLSearchParams(window.location.search).get("from")==="microphone-test"?(le.info("[RandomTraining] マイクテストページからの遷移を検出"),"granted"):(le.info("[RandomTraining] ダイレクトアクセスを検出"),"checking"):"checking",T=!0,F=[];const O=["ド","レ","ミ","ファ","ソ","ラ","シ","ド（高）"];let _="",w=0,V=!1,B=0,E=O.map(s=>({name:s,state:"inactive",completed:!1})),I=null,S=!1,G=0,J=!1,M=null,U=!1,z=[],$=[],se=0,be=0,ke="ーー",Me=0,_e={correctCount:0,totalCount:8,averageAccuracy:0,averageTime:0,isCompleted:!1},De=null,Fe={totalScore:0,grade:"C",componentScores:{pitchAccuracy:0,recognitionSpeed:0,intervalMastery:0,directionAccuracy:0,consistency:0}},qe=[],Re=[],Ue={},Ye={},Be={totalAttempts:0,successRate:0,averageScore:0,bestScore:0,sessionDuration:0,streakCount:0,fatigueLevel:"fresh",mostDifficultInterval:"-",mostSuccessfulInterval:"-",averageResponseTime:0,sessionStart:Date.now()},mt="intervals",re=[],me=null,Se=null,Ve=!0,ue=null,Le=null,ct=null,it=null,Je=null;const We=[{note:"C4",name:"ド（中）",frequency:261.63,semitonesFromC:0},{note:"Db4",name:"ド#（中）",frequency:277.18,semitonesFromC:1},{note:"D4",name:"レ（中）",frequency:293.66,semitonesFromC:2},{note:"Eb4",name:"レ#（中）",frequency:311.13,semitonesFromC:3},{note:"E4",name:"ミ（中）",frequency:329.63,semitonesFromC:4},{note:"F4",name:"ファ（中）",frequency:349.23,semitonesFromC:5},{note:"Gb4",name:"ファ#（中）",frequency:369.99,semitonesFromC:6},{note:"Ab4",name:"ラb（中）",frequency:415.3,semitonesFromC:8},{note:"Bb3",name:"シb（低）",frequency:233.08,semitonesFromC:-2},{note:"B3",name:"シ（低）",frequency:246.94,semitonesFromC:-1}];async function Ke(){var s;e(1,k="checking");try{if(console.log("🎤 [RandomTraining] AudioManager経由でマイク許可確認開始"),!((s=navigator.mediaDevices)!=null&&s.getUserMedia)){e(1,k="error");return}const u=await Ze.initialize();ct=u.audioContext,Le=u.mediaStream,it=u.sourceNode,console.log("✅ [RandomTraining] AudioManager リソース取得完了"),e(1,k="granted"),e(0,P="setup"),setTimeout(async()=>{if(ue){le.audio("[RandomTraining] PitchDetector初期化開始");const N=/iPhone/.test(navigator.userAgent),x=/iPad/.test(navigator.userAgent),Z=/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document;(x||Z)&&(console.log("🔧 [RandomTraining] iPad検出 - マイク感度7.0x自動設定開始"),Ze.setSensitivity(7),console.log("✅ [RandomTraining] iPad マイク感度7.0x自動設定完了"));try{console.log("🎤 [RandomTraining] AudioManager再初期化開始（iPad対応）"),await Ze.initialize(),console.log("✅ [RandomTraining] AudioManager再初期化完了")}catch(X){console.warn("⚠️ AudioManager再初期化エラー:",X)}await ue.initialize(),le.audio("[RandomTraining] PitchDetector初期化完了")}},200)}catch(u){le.error("[RandomTraining] マイク許可エラー:",u),e(1,k=(u==null?void 0:u.name)==="NotAllowedError"?"denied":"error")}}function gt(){const s=h,u=f,N=We.find(x=>x.note===s)||We.find(x=>x.name===u)||We[0];if(e(7,_=N.name),e(8,w=N.frequency),le.info(`[BaseNote] 基音設定（localStorage連携）: ${_} = ${w}Hz`),le.info(`[BaseNote] localStorage基音情報: note=${s}, name=${u}`),!w||w<=0)throw le.error("[BaseNote] 基音周波数設定エラー:",N),new Error(`Invalid base frequency: ${w}`)}async function sn(){if(V||!Se||Ve)return;if(k!=="granted"){console.log("🎤 [RandomTraining] マイク許可が必要です。許可取得を開始...");try{await Ke(),console.log("🎤 [RandomTraining] マイク許可取得完了")}catch(u){console.error("❌ マイク許可エラー:",u);return}}if(!Le&&k==="granted"){console.log("🎤 [RandomTraining] AudioManagerリソース未初期化のため取得します");try{await Ke()}catch(u){console.error("❌ AudioManagerリソース初期化エラー:",u);return}}else Le&&console.log("🎤 [RandomTraining] AudioManagerリソース既存のため再利用");e(9,V=!0),e(0,P="listening"),Je=Date.now(),gt();const s=We.find(u=>u.name===_).note;Se.triggerAttackRelease(s,2,Tt(),.7),setTimeout(()=>{e(9,V=!1),e(0,P="waiting"),setTimeout(()=>ht(),500)},2e3)}async function cn(){if(V||!Se||y||!_)return;if(k!=="granted"){console.log("🎤 [RandomTraining] マイク許可が必要です。許可取得を開始...");try{await Ke(),console.log("🎤 [RandomTraining] マイク許可取得完了")}catch(u){console.error("❌ マイク許可エラー:",u);return}}if(!Le&&k==="granted"){console.log("🎤 [RandomTraining] AudioManagerリソース未初期化のため取得します");try{await Ke()}catch(u){console.error("❌ AudioManagerリソース初期化エラー:",u);return}}else Le&&console.log("🎤 [RandomTraining] AudioManagerリソース既存のため再利用");if(e(9,V=!0),e(0,P="listening"),Je=Date.now(),typeof window<"u"&&window.Tone){const u=window.Tone.context||window.Tone.getContext();u&&u.state==="suspended"&&(console.log("🔄 [RandomTraining] AudioContext suspended検出 - 再開中..."),await u.resume(),console.log("✅ [RandomTraining] AudioContext再開完了"))}const s=We.find(u=>u.name===_).note;Se.triggerAttackRelease(s,2,Tt(),.7),setTimeout(()=>{e(9,V=!1),e(0,P="waiting"),setTimeout(()=>ht(),500)},2e3)}async function wo(){if(V||!Se||y||!_){console.log("🔄 [BaseNoteOnly] 再生条件未満: isPlaying:",V,"sampler:",!!Se,"isLoading:",y,"currentBaseNote:",_);return}if(console.log("🎵 [BaseNoteOnly] 基音のみ再生開始:",_),typeof window<"u"&&window.Tone){const u=window.Tone.context||window.Tone.getContext();u&&u.state==="suspended"&&(console.log("🔄 [BaseNoteOnly] AudioContext suspended検出 - 再開中..."),await u.resume(),console.log("✅ [BaseNoteOnly] AudioContext再開完了"))}const s=We.find(u=>u.name===_).note;Se.triggerAttackRelease(s,1.5,Tt(),.7),console.log("🎵 [BaseNoteOnly] 基音再生完了:",s)}function ln(){_&&w>0?cn():sn(),un()}function un(){M&&clearInterval(M),e(11,G=0),J=!0,e(12,U=!1),console.log("🎵 [GuideStartBar] ガイドスタートバー開始"),M=setInterval(()=>{e(11,G+=2.5),G>=100&&(e(11,G=100),e(12,U=!0),console.log("🎵 [GuideStartBar] ガイド開始タイミング！"),setTimeout(()=>{J=!1,e(12,U=!1),e(11,G=0)},800),clearInterval(M),M=null)},50)}function ko(){M&&(clearInterval(M),M=null),J=!1,e(12,U=!1),e(11,G=0)}function $e(s,u){const x=[0,2,4,5,7,9,11,12][u],Z=s*Math.pow(2,x/12);return le.debug(`[calculateExpectedFrequency] ${E[u].name}: 基音${s.toFixed(1)}Hz + ${x}半音 = ${Z.toFixed(1)}Hz`),Z}function fn(s,u){return $e(s,u)}function ht(){e(0,P="guiding"),B=0,S=!0,z=[],console.log(`🎬 ガイド開始: ${_} (${w.toFixed(1)}Hz)`);function s(){if(B<E.length){B>0&&e(10,E[B-1].state="inactive",E),e(10,E[B].state="active",E);const u=fn(w,B);bt.setScaleContext({baseFrequency:w,currentScale:E[B].name,targetFrequency:u}),console.log(`🎵 [Scale] 基音:${_}(${w.toFixed(0)}Hz) 現在:${E[B].name} 目標:${u.toFixed(0)}Hz`),B>=4&&console.log(`🔍 [デバッグ] Step ${B}: currentBaseFrequency=${w}, currentBaseNote='${_}'`),B++,I=setTimeout(()=>{s()},600)}else dn()}s()}function dn(){S=!1,console.log(`🏁 ガイド完了: ${z.length}/${E.length}ステップ評価`),E.length>0&&e(10,E[E.length-1].state="inactive",E),ue&&ue.stopDetection(),bt.clearContext(),mn(),vn(),re=O.map(s=>{const u=z.find(N=>N.stepName===s);return u?{name:u.stepName,cents:u.adjustedFrequency?Math.round(u.centDifference):null,targetFreq:u.expectedFrequency,detectedFreq:u.adjustedFrequency||null,diff:u.adjustedFrequency?u.adjustedFrequency-u.expectedFrequency:null,accuracy:u.accuracy}:{name:s,cents:null,targetFreq:null,detectedFreq:null,diff:null,accuracy:"notMeasured"}}),Sn(),wn(),e(0,P="results")}function mn(){let s=0,u=0;z.forEach((Z,X)=>{Z.isCorrect&&s++,u+=Z.accuracy});const N=z.length>0?Math.round(u/z.length):0,x=Math.round(s/E.length*100);_e={correctCount:s,totalCount:E.length,averageAccuracy:N,averageTime:0,isCompleted:!0},console.log(`🎯 結果: ${s}/${E.length}正解 (${x}%) 平均精度${N}%`),z.length>0&&($=[...z])}function Do(){switch(P){case"setup":return Ve||!Se?"🎵 音源読み込み中...":"🎤 マイク準備完了 - トレーニング開始可能";case"listening":return"🎵 基音再生中...";case"waiting":return"⏳ 間もなく開始...";case"guiding":return"🎙️ ガイドに合わせてドレミファソラシドを歌ってください";case"results":return"🎉 採点結果";default:return"🔄 準備中..."}}function qo(){return z.length>0?z:$.length>0?$:[]}function gn(){_t(`${ft}/microphone-test`)}function et(){_t(`${ft}/`)}async function hn(){try{e(32,Ve=!0),e(31,Se=new $o({urls:{C4:"C4.mp3"},baseUrl:`${ft}/audio/piano/`,release:1.5,volume:Zn(),onload:()=>{e(32,Ve=!1)},onerror:Z=>{console.error("❌ Salamander Piano音源読み込みエラー:",Z),e(32,Ve=!1)}}).toDestination());const s=/iPhone/.test(navigator.userAgent),u=/iPad/.test(navigator.userAgent),N=/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document,x=s||u||N;console.log(u?"🔍 [RandomTraining] iPad検出:":N?"🔍 [RandomTraining] iPadOS検出:":s?"🔍 [RandomTraining] iPhone検出:":"🔍 [RandomTraining] その他デバイス検出:",navigator.userAgent),console.log("🔊 [RandomTraining] 音量設定維持: 35dB")}catch(s){console.error("サンプラー初期化エラー:",s),e(32,Ve=!1)}}async function lt(){try{(await navigator.permissions.query({name:"microphone"})).state==="granted"?await Ke():e(1,k="denied")}catch{e(1,k="denied")}}function yn(){try{De=new Ln,le.info("[RandomTraining] 採点エンジン初期化完了")}catch(s){le.error("[RandomTraining] 採点エンジン初期化エラー:",s)}}function pn(s,u){if(!De||!S)return;const N=B-1;if(N<0||N>=E.length)return;const x=$e(w,N),Z={baseFrequency:w,targetFrequency:x,detectedFrequency:s,detectedNote:u,volume:se,timestamp:Date.now(),scaleIndex:N,scaleName:E[N].name};try{De.processAttempt(Z)}catch(X){le.error("[RandomTraining] 採点エンジンエラー:",X)}}function vn(){if(!De){le.error("[RandomTraining] 採点エンジンが初期化されていません"),_n();return}try{const s=De.generateDetailedReport();e(16,Fe={totalScore:s.totalScore,grade:s.grade,componentScores:s.componentScores}),s.intervalAnalysis&&s.intervalAnalysis.masteryLevels?e(3,qe=Object.entries(s.intervalAnalysis.masteryLevels).map(([u,N])=>{var x,Z;return{type:u,mastery:Math.round(N),attempts:((x=s.intervalAnalysis.attemptCounts)==null?void 0:x[u])||0,accuracy:((Z=s.intervalAnalysis.accuracyRates)==null?void 0:Z[u])||0}})):(console.warn("⚠️ [RandomTraining] intervalAnalysis.masteryLevels が未定義です"),e(3,qe=[])),s.consistencyHistory&&Array.isArray(s.consistencyHistory)?e(17,Re=s.consistencyHistory.map((u,N)=>({score:Math.round(u),timestamp:Date.now()-(s.consistencyHistory.length-N)*1e3}))):(console.warn("⚠️ [RandomTraining] consistencyHistory が未定義または配列ではありません"),e(17,Re=[])),e(18,Ue=s.feedback||{primary:"採点結果を生成中です...",detailed:[],suggestions:[]}),e(20,Be={totalAttempts:s.totalAttempts||0,successRate:s.successRate||0,averageScore:s.totalScore||0,bestScore:Math.max(s.totalScore||0,Be.bestScore||0),sessionDuration:Math.round((Date.now()-Be.sessionStart)/6e4)||0,streakCount:s.streak||0,fatigueLevel:s.fatigueLevel||"normal",mostDifficultInterval:s.mostDifficultInterval||"-",mostSuccessfulInterval:s.mostSuccessfulInterval||"-",averageResponseTime:s.averageResponseTime||0}),le.info("[RandomTraining] 採点結果生成完了:",Fe)}catch(s){le.error("[RandomTraining] 採点結果生成エラー:",s)}}function _n(){le.info("[RandomTraining] テストデータで採点結果を生成"),e(16,Fe={totalScore:78,grade:"B+",componentScores:{pitchAccuracy:82,recognitionSpeed:75,intervalMastery:80,directionAccuracy:85,consistency:70}}),e(3,qe=[{type:"unison",mastery:95,attempts:8,accuracy:98},{type:"major_second",mastery:82,attempts:8,accuracy:85},{type:"major_third",mastery:78,attempts:8,accuracy:80},{type:"perfect_fourth",mastery:65,attempts:8,accuracy:68},{type:"perfect_fifth",mastery:88,attempts:8,accuracy:90},{type:"major_sixth",mastery:72,attempts:8,accuracy:75},{type:"major_seventh",mastery:58,attempts:8,accuracy:62},{type:"octave",mastery:92,attempts:8,accuracy:94}]),e(17,Re=[{score:65,timestamp:Date.now()-42e4},{score:72,timestamp:Date.now()-36e4},{score:68,timestamp:Date.now()-3e5},{score:75,timestamp:Date.now()-24e4},{score:78,timestamp:Date.now()-18e4},{score:82,timestamp:Date.now()-12e4},{score:80,timestamp:Date.now()-6e4},{score:85,timestamp:Date.now()}]),e(18,Ue={type:"improvement",primary:"良い進歩が見られます！",summary:"音程の認識精度が向上しています。特に完全5度とオクターブの習得度が高く、基本的な音感が身についてきています。",details:[{category:"strengths",text:"ユニゾンとオクターブの認識がほぼ完璧です"},{category:"strengths",text:"完全5度の安定性が優秀です"},{category:"improvements",text:"完全4度の練習をもう少し増やしましょう"},{category:"improvements",text:"長7度の認識精度を向上させましょう"},{category:"tips",text:"4度は「ソーファー」の音程です"},{category:"practice",text:"毎日15分の継続練習を心がけましょう"}],nextSteps:["完全4度の集中練習を行いましょう","連続チャレンジモードで実践練習を","1日15分の継続練習を心がけましょう"],motivation:"継続は力なり！あなたの相対音感は確実に向上しています！"}),e(20,Be={totalAttempts:32,successRate:68.8,averageScore:78,bestScore:85,sessionDuration:8,streakCount:4,fatigueLevel:"normal",mostDifficultInterval:"完全4度",mostSuccessfulInterval:"ユニゾン",averageResponseTime:2.1,sessionStart:Date.now()-48e4}),le.info("[RandomTraining] テスト採点結果生成完了")}function Co(s){mt=s}function Sn(){if(!re||re.length===0){console.warn("[UnifiedScore] noteResultsForDisplay が空です");return}const s=re.filter(ae=>ae.accuracy!=="notMeasured").length,u=re.length,N=re.filter(ae=>ae.accuracy!=="notMeasured"&&typeof ae.accuracy=="number").map(ae=>ae.accuracy),x=N.length>0?Math.round(N.reduce((ae,xe)=>ae+xe,0)/N.length):0,Z=_||"Unknown",X=w||0,ce=re.map(ae=>({name:ae.name,note:ae.note||ae.name,frequency:ae.targetFreq||ae.expectedFrequency,detectedFrequency:ae.detectedFreq,cents:ae.cents,grade:at.evaluateNote(ae.cents),targetFreq:ae.targetFreq,diff:ae.diff})),fe=m,ie=(fe==null?void 0:fe.sessionHistory)||[],Ae={timestamp:new Date,baseNote:Z,baseFrequency:X,noteResults:ce,measuredNotes:s,accuracy:x,grade:at.evaluateSession(re)},Oe=[...ie,Ae];e(21,me={mode:"random",timestamp:new Date,duration:60,totalNotes:u,measuredNotes:s,averageAccuracy:x,baseNote:Z,baseFrequency:X,noteResults:ce,distribution:at.calculateDistribution(re),sessionHistory:Oe,unifiedGrade:L(Oe)}),console.log("[UnifiedScore] 統合採点データ生成完了（完全版）:",me),bn()}async function bn(){if(!re||re.length===0){console.warn("📊 [SessionStorage] 保存データなし");return}try{console.log("📊 [SessionStorage] セッション結果保存開始");const s=re.map(X=>({name:X.name,cents:X.cents,targetFreq:X.targetFreq||X.expectedFrequency,detectedFreq:X.detectedFreq,diff:X.diff,accuracy:typeof X.accuracy=="number"?X.accuracy:0})),u=Je?Math.round((Date.now()-Je)/1e3):60;await zn(s,u,h,f)?(console.log("📊 [SessionStorage] セッション結果保存完了"),console.log("📊 [SessionStorage] 保存後の状況:",{currentSession:g,totalSessions:p.length,isCompleted:a,nextBaseNote:h,nextBaseName:f})):console.error("📊 [SessionStorage] セッション結果保存失敗")}catch(s){console.error("📊 [SessionStorage] セッション保存エラー:",s)}}async function wn(){try{if(De){const s=p||[];for(const[N,x]of s.entries())if(x.noteResults&&x.noteResults.length>0){const Z=x.baseFrequency||262;for(const X of x.noteResults)X.detectedFreq&&X.targetFreq&&await De.analyzePerformance({baseFreq:Z,targetFreq:X.targetFreq,detectedFreq:X.detectedFreq,responseTime:2e3,volume:50,harmonicCorrection:null})}const u=De.generateDetailedReport();e(16,Fe={totalScore:u.totalScore||0,grade:u.grade||"C",componentScores:u.componentScores||{accuracy:0,speed:0,consistency:0}}),u.intervalAnalysis&&u.intervalAnalysis.masteryLevels?e(3,qe=Object.entries(u.intervalAnalysis.masteryLevels).map(([N,x])=>{var Z;return{type:N,mastery:Math.round(x),attempts:((Z=u.intervalAnalysis.attemptCounts)==null?void 0:Z[N])||0,accuracy:Math.round(x*.9)}})):e(3,qe=It(re)),u.consistencyHistory&&Array.isArray(u.consistencyHistory)?e(17,Re=u.consistencyHistory.map((N,x)=>({score:Math.round(N),timestamp:Date.now()-(u.consistencyHistory.length-x)*1e3}))):e(17,Re=pt(re)),e(18,Ue=vt(re)||u.feedback),console.log("🎯 [generateEnhancedScoringData] 技術分析結果生成を開始"),console.log("🎯 [generateEnhancedScoringData] results:",u),e(19,Ye=kn(u)),console.log("🎯 [generateEnhancedScoringData] technicalFeedbackData結果:",Ye),e(20,Be={totalAttempts:u.totalAttempts||re.length,successRate:u.successRate||re.filter(N=>N.accuracy!=="notMeasured").length/re.length*100,averageScore:u.totalScore||(me==null?void 0:me.averageAccuracy)||0,bestScore:Math.max(u.totalScore||0,Be.bestScore||0),sessionDuration:Math.round(60),streakCount:u.streak||0,fatigueLevel:u.fatigueLevel||"normal",mostDifficultInterval:u.mostDifficultInterval||"未特定",mostSuccessfulInterval:u.mostSuccessfulInterval||"未特定",averageResponseTime:u.averageResponseTime||2.5,sessionStart:Date.now()-6e4})}else yt();console.log("[EnhancedScoring] 追加採点データ生成完了")}catch(s){console.error("[EnhancedScoring] データ生成エラー:",s),yt()}}function yt(){const s=re.filter(N=>N.accuracy!=="notMeasured"),u=(me==null?void 0:me.averageAccuracy)||0;e(16,Fe={totalScore:Math.round(u*.8),grade:u>=90?"A":u>=80?"B":u>=70?"C":"D",componentScores:{accuracy:u,speed:85,consistency:Math.max(60,u-10)}}),e(3,qe=It(re)),e(17,Re=pt()),e(18,Ue=vt(re)),e(20,Be={totalAttempts:re.length,successRate:s.length/re.length*100,averageScore:u,bestScore:u,sessionDuration:60,streakCount:0,fatigueLevel:"normal",mostDifficultInterval:"未分析",mostSuccessfulInterval:"未分析",averageResponseTime:2.5,sessionStart:Date.now()-6e4})}function pt(s){const u=(me==null?void 0:me.averageAccuracy)||70;return Array.from({length:8},(N,x)=>({score:Math.max(30,Math.min(100,u+(Math.random()-.5)*20)),timestamp:Date.now()-(8-x)*7500}))}function vt(s){const u=s.filter(nt=>nt.accuracy!=="notMeasured").length,N=(me==null?void 0:me.averageAccuracy)||0,x=8,Z=p||[],X=Z.length,ce={type:"info",categories:[{name:"音程精度",icon:"Target",score:N,message:`${N}%の精度で音程を捉えています`},{name:"測定成功率",icon:"Mic",score:Math.round(u/s.length*100),message:`${s.length}音中${u}音を正常に測定`}]};if(X<x)return ce;let fe,ie,Ae;const Oe=(me==null?void 0:me.unifiedGrade)||"E",ae=Z.length;let xe=0,we=0,Ce=0;Z.forEach(nt=>{nt.grade==="excellent"?xe++:nt.grade==="good"?we++:nt.grade==="pass"&&Ce++});const Ne=ae>0?Math.round(xe/ae*100):0,tt=ae>0?Math.round((xe+we+Ce)/ae*100):0,Ee=ae>0?Math.round((xe+we+Ce)/ae*100):0;switch(Oe){case"S":fe="excellent",ie="音楽家レベルの相対音感を達成！",Ae=`優秀率${Ne}%超えの実力を証明されました。`;break;case"A":fe="excellent",ie="エキスパートレベル到達！",Ae=`優秀率${Ne}%の安定した音感能力です。`;break;case"B":fe="improvement",ie="プロフィシエント級達成！",Ae=`良好率${tt}%の確実な進歩を示しています。`;break;case"C":fe="improvement",ie="アドバンス級到達！",Ae=`合格率${Ee}%で着実に成長中です。`;break;case"D":fe="practice",ie="継続練習で必ず上達！",Ae=`現在の合格率${Ee}%から目標70%へ向けて練習を続けましょう。`;break;case"E":default:fe="encouragement",ie="E級ビギナー",Ae="練習開始段階です。継続的な練習で必ず上達します。";break}return{...ce,type:fe,primary:ie,summary:Ae}}function kn(s){var Oe,ae,xe;if((p||[]).length<8||!s)return null;const Z=s.improvements||[];(Oe=s.detailed)!=null&&Oe.statistics;const X=[];let ce=0,fe=0;if((ae=s.detailed)!=null&&ae.intervals){const we=s.detailed.intervals;if(we.totalAnalyses>0){let Ce=0,Ne=0;for(const[tt,Ee]of Object.entries(we.masteryLevels))Ee.attempts>0&&(Ce+=Ee.averageAccuracy*Ee.attempts,Ne+=Ee.attempts);ce=Ne>0?Ce/Ne:0}}if((xe=s.detailed)!=null&&xe.directions){const we=s.detailed.directions;if(we.totalAnalyses>0){let Ce=0,Ne=0;for(const[tt,Ee]of Object.entries(we.masteryData))Ee.attempts>0&&(Ce+=Ee.averageAccuracy*Ee.attempts,Ne+=Ee.attempts);fe=Ne>0?Ce/Ne:0}}X.push({category:"improvements",text:`音程精度: ${Math.round(ce)}%　（音の高さを捉える正確性　目標基準：70〜85%）`}),X.push({category:"improvements",text:`方向性: ${Math.round(fe)}%　（音程の上下判断の精度　目標基準：80〜90%）`});const ie=Z.map(we=>({category:"tips",text:we.message})),Ae=Z.flatMap(we=>(we.actions||[]).map(Ce=>({category:"practice",text:Ce})));return[...X,...ie,...Ae],{type:"info",primary:"詳細分析結果",summary:"音程精度・一貫性・方向性の総合分析",details:X}}Mn(async()=>{if(!(typeof localStorage<"u"?localStorage.getItem("mic-test-completed"):null)){console.log("🚫 [RandomTraining] マイクテスト未完了 - 準備画面表示"),lt();return}console.log("📊 [SessionStorage] セッション管理初期化開始");try{if(await wt()){if(console.log("📊 [SessionStorage] セッション進行状況の読み込み完了"),console.log("📊 [SessionStorage] 現在のセッション:",g,"/ 8"),console.log("📊 [SessionStorage] 次の基音:",h,"(",f,")"),console.log("📊 [SessionStorage] 完了状況:",a?"8セッション完了":`残り${l}セッション`),a&&(console.log("🔄 [SessionStorage] 8セッション完了検出 - 新サイクル開始処理"),await ot()?console.log("✅ [SessionStorage] 新サイクル開始完了 - セッション1/8から再開"):console.warn("⚠️ [SessionStorage] 新サイクル開始処理が失敗")),g>1&&!a){console.warn("🔄 [SessionStorage] セッション途中でのリロード検出 - セッション1から再開"),console.warn("🔄 [SessionStorage] 現在:",g,"セッション目 → ダイレクトアクセス誘導");const{SessionStorageManager:N}=await Tn(async()=>{const{SessionStorageManager:X}=await import("../chunks/ytCVdwWH.js").then(ce=>ce.L);return{SessionStorageManager:X}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url),x=N.getInstance();typeof localStorage<"u"&&(localStorage.removeItem("random-training-progress"),localStorage.removeItem("random-training-progress-backup"));const{resetProgress:Z}=await Tn(async()=>{const{resetProgress:X}=await import("../chunks/ytCVdwWH.js").then(ce=>ce.N);return{resetProgress:X}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url);await Z(),console.log("🔄 [SessionStorage] localStorage + ストア状態完全リセット完了"),lt();return}}else console.log("📊 [SessionStorage] 新規セッション開始")}catch(u){console.error("📊 [SessionStorage] 初期化エラー:",u)}if(hn(),yn(),i.url.searchParams.get("from")==="microphone-test"){console.log("🎤 [RandomTraining] マイクテストページからの遷移を検出");const u=new URL(window.location);if(u.searchParams.delete("from"),window.history.replaceState({},"",u),e(1,k="granted"),e(0,P="setup"),console.log('🎤 [RandomTraining] microphoneState="granted", trainingPhase="setup" に設定'),!Le){console.log("🎤 [RandomTraining] AudioManagerリソース取得開始");try{const N=await Ze.initialize();ct=N.audioContext,Le=N.mediaStream,it=N.sourceNode,console.log("🎤 [RandomTraining] AudioManagerリソース取得完了")}catch(N){console.warn("⚠️ AudioManagerリソース取得失敗（後で再試行）:",N)}}if(await new Promise(N=>setTimeout(N,300)),ue&&ue.getIsInitialized&&!ue.getIsInitialized())try{console.log("🎙️ [RandomTraining] PitchDetector初期化開始");const N=Ze.getStatus();console.log("🔍 [RandomTraining] AudioManager状態:",N),(!N.isInitialized||!N.mediaStreamActive)&&(console.log("🔄 [RandomTraining] AudioManager状態不良 - 再初期化実行"),await Ze.initialize()),await ue.initialize(),console.log("✅ [RandomTraining] PitchDetector初期化完了")}catch(N){console.warn("⚠️ PitchDetector初期化失敗:",N)}}else await new Promise(u=>setTimeout(u,100)),lt()});function Dn(s){const{frequency:u,note:N,volume:x,rawVolume:Z,clarity:X}=s.detail;let ce=u,fe=N;if(P==="guiding"&&S&&w>0&&u>0){const ie=qn(u);ie&&(ce=ie.frequency,fe=ie.note)}e(14,be=ce),e(15,ke=fe),e(13,se=x),w>0&&ce>0?Me=Math.round(1200*Math.log2(ce/w)):Me=0,Cn(u),De&&u>0&&w>0&&pn(u,N)}function qn(s){if(!s||s<=0||!S||!w||se<25)return null;const N=B-1;if(N<0||N>=E.length)return null;const x=$e(w,N);if(!x||x<=0)return null;const X=Pt(s,x).correctedFrequency,ce=Kn(X);return{frequency:Math.round(X),note:ce}}function Cn(s,u){if(!s||s<=0||!S)return;if(!w||w<=0){console.error(`❌ [採点エラー] 基音周波数が無効: ${w}Hz`),console.error(`❌ [採点エラー] 基音名: ${_}`),console.error(`❌ [採点エラー] activeStepIndex: ${B-1}`),console.error(`❌ [採点エラー] trainingPhase: ${P}`),console.error(`❌ [採点エラー] isGuideAnimationActive: ${S}`);return}if(se<25)return;const x=B-1;if(x<0||x>=E.length)return;x>=4&&le.debug(`[採点デバッグ] activeStepIndex=${x} (${E[x].name}), currentBaseFrequency=${w}Hz`);const Z=$e(w,x);if(x>=0&&le.debug(`[音程計算修正版] ${E[x].name}: 期待周波数 ${Z.toFixed(1)}Hz`),!Z||Z<=0||!isFinite(Z)){console.error("❌ [採点エラー] 期待周波数計算エラー:"),console.error(`   基音周波数: ${w}Hz`),console.error(`   音階インデックス: ${x}`),console.error(`   期待周波数: ${Z}Hz`);return}const X=Pt(s,Z),ce=X.correctedFrequency,fe=X.factor,ie=Math.round(1200*Math.log2(ce/Z));if((Math.abs(ie)>200||fe!==1)&&(le.debug(`[プロトタイプ式補正] ${E[x].name}:`),console.warn(`   検出周波数: ${s.toFixed(1)}Hz`),console.warn(`   補正後周波数: ${ce.toFixed(1)}Hz`),console.warn(`   期待周波数: ${Z.toFixed(1)}Hz`),console.warn(`   セント差: ${ie}¢`),console.warn(`   補正係数: ${fe} (${X.description})`),console.warn(`   基音: ${_} (${w.toFixed(1)}Hz)`)),!isFinite(ie)){console.error("❌ [採点エラー] セント計算エラー:"),console.error(`   検出周波数: ${s}Hz`),console.error(`   期待周波数: ${Z}Hz`),console.error(`   セント差: ${ie}`);return}const Oe=Math.abs(ie)<=50;if(se>=15){const we=Math.max(0,Math.round(100-Math.abs(ie))),Ce=z.findIndex(tt=>tt.stepIndex===x),Ne={stepIndex:x,stepName:E[x].name,expectedFrequency:Math.round(Z),detectedFrequency:Math.round(s),adjustedFrequency:Math.round(ce),centDifference:ie,accuracy:we,isCorrect:Oe,correctionFactor:fe,correctionDescription:X.description,timestamp:Date.now()};Ce>=0?z[Ce]=Ne:z.push(Ne),z.length%4===0&&le.realtime(`採点進捗: ${z.length}/${E.length}ステップ完了`)}}function Fo(){e(0,P="completed"),_e.isCompleted=!0,_e.averageAccuracy=Math.round(_e.correctCount/_e.totalCount*100),ue&&ue.stopDetection()}async function Fn(){if(a){console.warn("🚫 [RestartSame] 8セッション完了状態では再挑戦不可 - 新サイクル開始が必要"),await ot()?(console.log("✅ [RestartSame] 新サイクル開始完了 - セッション1/8から再開"),window.location.reload()):console.error("❌ [RestartSame] 新サイクル開始失敗");return}rt(),e(0,P="setup"),I&&(clearTimeout(I),I=null),ue&&ue.resetDisplayState&&ue.resetDisplayState(),ut(),console.log("🔄 [RestartSame] 同じ基音で再挑戦:",_,w+"Hz"),console.log("🔄 [RestartSame] 基音情報保持完了 - ユーザー操作待機")}async function Rn(){if(a){console.warn("🚫 [RestartDifferent] 8セッション完了状態では再挑戦不可 - 新サイクル開始が必要"),await ot()?(console.log("✅ [RestartDifferent] 新サイクル開始完了 - セッション1/8から再開"),window.location.reload()):console.error("❌ [RestartDifferent] 新サイクル開始失敗");return}rt(),e(0,P="setup"),I&&(clearTimeout(I),I=null),e(7,_=""),e(8,w=0),console.log("🔄 [restartDifferentBaseNote] 基音情報をリセットしました"),ue&&ue.resetDisplayState&&ue.resetDisplayState(),ut()}function ut(){B=0,S=!1,z=[],e(10,E=E.map(s=>({...s,state:"inactive",completed:!1})))}async function Nn(){console.log("🚀 [StartNewCycle] 8セッション完了後の最初から挑戦開始");try{await ot()?(console.log("✅ [StartNewCycle] 新サイクル開始完了"),localStorage.getItem("mic-test-completed")?(console.log("✅ [StartNewCycle] マイクテスト完了フラグ確認 - リロードなしで状態リセット"),rt(),await wt(),e(0,P="setup"),ut(),gt(),console.log("✅ [StartNewCycle] 状態リセット完了 - セッション1/8から再開")):window.location.reload()):(console.error("❌ [StartNewCycle] 新サイクル開始失敗"),et())}catch(s){console.error("❌ [StartNewCycle] 新サイクル開始エラー:",s),et()}}function An(s){const{type:u}=s.detail;switch(u){case"same":Fn();break;case"different":Rn();break;case"restart":Nn();break;case"home":et();break;default:console.warn("🚫 [ActionButtons] 未知のアクションタイプ:",u)}}function En(s){const{healthy:u,errors:N,details:x}=s.detail;e(2,T=u),e(6,F=N),u||(console.warn("⚠️ マイクの健康状態が悪化:",N),P==="guiding"&&(e(0,P="setup"),console.warn("🛑 マイク問題によりトレーニングを停止")))}Bn(()=>{console.log("🔄 [RandomTraining] onDestroy - AudioManagerリソースは保持"),Se&&(Se.dispose(),e(31,Se=null))});const Ro=[];ra.keys(t).forEach(s=>{!~Ro.indexOf(s)&&s.slice(0,2)!=="$$"&&s!=="slot"&&sa.warn(`<Page> was created with unknown prop '${s}'`)});function No(s){Po[s?"unshift":"push"](()=>{ue=s,e(22,ue)})}return o.$capture_state=()=>({onMount:Mn,onDestroy:Bn,goto:_t,base:ft,page:St,ChevronRight:Yo,Music:to,Card:Xe,Button:dt,VolumeBar:Bo,PitchDisplay:Xo,PitchDetector:$n,PitchDetectionDisplay:Yn,PageLayout:Xn,Tone:Qo,audioManager:Ze,harmonicCorrection:bt,logger:le,ScoreResultPanel:na,IntervalProgressTracker:Ko,ConsistencyGraph:Jo,FeedbackDisplay:Zo,SessionStatistics:Wo,UnifiedScoreResultFixed:rn,ActionButtons:an,EvaluationEngine:at,EnhancedScoringEngine:Ln,trainingProgress:Et,currentSessionId:At,nextBaseNote:Nt,nextBaseName:Rt,isLoading:Ft,storageError:Uo,isCompleted:Ct,sessionHistory:qt,overallGrade:Go,overallAccuracy:Oo,progressPercentage:Lo,remainingSessions:Dt,latestSessionResult:zo,unifiedScoreData:kt,loadProgress:wt,saveSessionResult:zn,resetProgress:jo,createNewProgress:Ho,startNewCycleIfCompleted:ot,getVolumeForDevice:Zn,calculateUnifiedGrade:L,generateTestUnifiedScoreData:ca,trainingPhase:P,microphoneState:k,microphoneHealthy:T,microphoneErrors:F,buildVersion:Qt,buildTimestamp:Xt,updateStatus:Yt,SCALE_NAMES:O,currentBaseNote:_,currentBaseFrequency:w,isPlaying:V,currentScaleIndex:B,scaleSteps:E,guideAnimationTimer:I,isGuideAnimationActive:S,guideStartProgress:G,isGuideStartBarActive:J,guideStartTimer:M,musicIconGlowing:U,scaleEvaluations:z,previousEvaluations:$,currentVolume:se,currentFrequency:be,detectedNote:ke,pitchDifference:Me,sessionResults:_e,scoringEngine:De,currentScoreData:Fe,intervalData:qe,consistencyData:Re,feedbackData:Ue,technicalFeedbackData:Ye,sessionStatistics:Be,activeTab:mt,noteResultsForDisplay:re,currentUnifiedScoreData:me,sampler:Se,isSamplerLoading:Ve,pitchDetectorComponent:ue,mediaStream:Le,audioContext:ct,sourceNode:it,sessionStartTime:Je,baseNotes:We,checkMicrophonePermission:Ke,selectRandomBaseNote:gt,playRandomBaseNote:sn,playCurrentBaseNote:cn,playBaseNoteOnly:wo,playBaseNote:ln,startGuideStartBar:un,cleanupGuideStartBar:ko,calculateExpectedFrequency:$e,calculateTargetFrequency:fn,startGuideAnimation:ht,finishGuideAnimation:dn,calculateFinalResults:mn,getStatusMessage:Do,getDisplayEvaluations:qo,goToMicrophoneTest:gn,goHome:et,initializeSampler:hn,checkExistingMicrophonePermission:lt,initializeScoringEngine:yn,updateScoringEngine:pn,generateFinalScoring:vn,generateTestScoreData:_n,switchTab:Co,generateUnifiedScoreData:Sn,saveSessionToStorage:bn,generateEnhancedScoringData:wn,generateFallbackEnhancedData:yt,generateIntervalDataFromResults:It,generateIntervalDataFromSessionHistory:Jn,generateConsistencyDataFromResults:pt,generateFeedbackFromResults:vt,generateTechnicalFeedbackFromEnhancedEngine:kn,handlePitchUpdate:Dn,getEvaluationCorrectedFrequency:qn,frequencyToNote:Kn,multiStageOctaveCorrection:Pt,evaluateScaleStep:Cn,completeSession:Fo,restartSameBaseNote:Fn,restartDifferentBaseNote:Rn,scrollToTop:rt,resetSessionState:ut,startNewCycle:Nn,handleActionButtonClick:An,handlePitchDetectorStateChange:So,handlePitchDetectorError:bo,handleMicrophoneHealthChange:En,canRestartSession:r,canStartTraining:c,$unifiedScoreData:n,$isCompleted:a,$page:i,$currentSessionId:g,$remainingSessions:l,$nextBaseName:f,$nextBaseNote:h,$sessionHistory:p,$trainingProgress:m,$isLoading:y}),o.$inject_state=s=>{"trainingPhase"in s&&e(0,P=s.trainingPhase),"microphoneState"in s&&e(1,k=s.microphoneState),"microphoneHealthy"in s&&e(2,T=s.microphoneHealthy),"microphoneErrors"in s&&e(6,F=s.microphoneErrors),"currentBaseNote"in s&&e(7,_=s.currentBaseNote),"currentBaseFrequency"in s&&e(8,w=s.currentBaseFrequency),"isPlaying"in s&&e(9,V=s.isPlaying),"currentScaleIndex"in s&&(B=s.currentScaleIndex),"scaleSteps"in s&&e(10,E=s.scaleSteps),"guideAnimationTimer"in s&&(I=s.guideAnimationTimer),"isGuideAnimationActive"in s&&(S=s.isGuideAnimationActive),"guideStartProgress"in s&&e(11,G=s.guideStartProgress),"isGuideStartBarActive"in s&&(J=s.isGuideStartBarActive),"guideStartTimer"in s&&(M=s.guideStartTimer),"musicIconGlowing"in s&&e(12,U=s.musicIconGlowing),"scaleEvaluations"in s&&(z=s.scaleEvaluations),"previousEvaluations"in s&&($=s.previousEvaluations),"currentVolume"in s&&e(13,se=s.currentVolume),"currentFrequency"in s&&e(14,be=s.currentFrequency),"detectedNote"in s&&e(15,ke=s.detectedNote),"pitchDifference"in s&&(Me=s.pitchDifference),"sessionResults"in s&&(_e=s.sessionResults),"scoringEngine"in s&&(De=s.scoringEngine),"currentScoreData"in s&&e(16,Fe=s.currentScoreData),"intervalData"in s&&e(3,qe=s.intervalData),"consistencyData"in s&&e(17,Re=s.consistencyData),"feedbackData"in s&&e(18,Ue=s.feedbackData),"technicalFeedbackData"in s&&e(19,Ye=s.technicalFeedbackData),"sessionStatistics"in s&&e(20,Be=s.sessionStatistics),"activeTab"in s&&(mt=s.activeTab),"noteResultsForDisplay"in s&&(re=s.noteResultsForDisplay),"currentUnifiedScoreData"in s&&e(21,me=s.currentUnifiedScoreData),"sampler"in s&&e(31,Se=s.sampler),"isSamplerLoading"in s&&e(32,Ve=s.isSamplerLoading),"pitchDetectorComponent"in s&&e(22,ue=s.pitchDetectorComponent),"mediaStream"in s&&(Le=s.mediaStream),"audioContext"in s&&(ct=s.audioContext),"sourceNode"in s&&(it=s.sourceNode),"sessionStartTime"in s&&(Je=s.sessionStartTime),"canRestartSession"in s&&(r=s.canRestartSession),"canStartTraining"in s&&(c=s.canStartTraining)},t&&"$$inject"in t&&o.$inject_state(t.$$inject),o.$$.update=()=>{o.$$.dirty[0]&6|o.$$.dirty[1]&3&&(c=k==="granted"&&!Ve&&Se&&T),o.$$.dirty[0]&1&&(r=P==="results"),o.$$.dirty[0]&56&&n&&a&&n.sessionHistory&&(e(3,qe=Jn(n.sessionHistory)),console.log("🎵 [RandomTraining] intervalData生成完了:",qe.length,"件")),o.$$.dirty[0]&3&&P==="setup"&&k==="granted"&&rt()},[P,k,T,qe,n,a,F,_,w,V,E,G,U,se,be,ke,Fe,Re,Ue,Ye,Be,me,ue,p,y,ln,gn,et,Dn,An,En,Se,Ve,No]}class _a extends $t{constructor(t){super(t),en(this,t,ia,Kt,tn,{},null,[-1,-1,-1,-1]),oe("SvelteRegisterComponent",{component:this,tagName:"Page",options:t,id:Kt.name})}}export{_a as component,va as universal};
