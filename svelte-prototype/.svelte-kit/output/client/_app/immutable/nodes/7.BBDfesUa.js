import{S as Ce,i as De,s as Ee,n as _e,d as m,K as S,y as p,b as L,c as i,e as _,f as C,h as w,j as g,k as V,I as Se,Q as ze,a as W,z as fe,G as J,g as M,t as T,C as se,m as Z,o as x,D as le,H as Ge,E as ne,F as ae,J as je,p as Re,q as Ue,L as Le,r as ye}from"../chunks/Dh4MrDnZ.js";import{e as ge}from"../chunks/D6YF6ztN.js";import"../chunks/IHki7fMi.js";import{P as We,C as de}from"../chunks/BIrZeKHn.js";import{B as $e}from"../chunks/CyYDdAyA.js";const Je=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Ke(l){let e,t,r,n,s,a;return{c(){e=g("div"),t=g("div"),r=g("div"),n=V(),s=g("div"),this.h()},l(c){e=_(c,"DIV",{class:!0});var u=C(e);t=_(u,"DIV",{class:!0,style:!0});var b=C(t);r=_(b,"DIV",{class:!0,style:!0}),C(r).forEach(m),b.forEach(m),n=w(u),s=_(u,"DIV",{class:!0,style:!0}),C(s).forEach(m),u.forEach(m),this.h()},h(){p(r,"class","volume-bar-fill"),S(r,"position","absolute"),S(r,"top","0"),S(r,"left","0"),S(r,"height","100%"),p(t,"class","volume-bar-bg"),S(t,"height",l[1]),S(t,"border-radius","9999px"),S(t,"background-color","#e2e8f0"),S(t,"position","relative"),S(t,"overflow","hidden"),p(s,"class","threshold-indicator svelte-13z7ppf"),S(s,"position","absolute"),S(s,"top","0"),S(s,"left",l[0]+"%"),S(s,"width","2px"),S(s,"height",l[1]),S(s,"background-color","#64748b"),S(s,"border-radius","1px"),p(e,"class",a="volume-bar-container "+l[2]+" svelte-13z7ppf")},m(c,u){L(c,e,u),i(e,t),i(t,r),l[5](r),i(e,n),i(e,s)},p(c,[u]){u&2&&S(t,"height",c[1]),u&1&&S(s,"left",c[0]+"%"),u&2&&S(s,"height",c[1]),u&4&&a!==(a="volume-bar-container "+c[2]+" svelte-13z7ppf")&&p(e,"class",a)},i:_e,o:_e,d(c){c&&m(e),l[5](null)}}}function Qe(l,e,t){let{volume:r=0}=e,{threshold:n=30}=e,{height:s="12px"}=e,{className:a=""}=e,c;function u(o){return o<n?"#94a3b8":o<60?"#10b981":o<80?"#f59e0b":"#ef4444"}function b(o){if(c){const d=Math.max(0,Math.min(100,o)),h=u(d);(!window.volumeBarLastUpdate||Math.abs(window.volumeBarLastUpdate-d)>10)&&(console.log("VolumeBar更新:",d.toFixed(1),"%","color:",h),window.volumeBarLastUpdate=d),t(3,c.style.width=`${d}%`,c),t(3,c.style.backgroundColor=h,c)}}Se(()=>{c&&(t(3,c.style.width="0%",c),t(3,c.style.backgroundColor="#94a3b8",c),t(3,c.style.height=s,c),t(3,c.style.borderRadius="9999px",c),t(3,c.style.transition="all 0.1s ease-out",c))});function f(o){ze[o?"unshift":"push"](()=>{c=o,t(3,c)})}return l.$$set=o=>{"volume"in o&&t(4,r=o.volume),"threshold"in o&&t(0,n=o.threshold),"height"in o&&t(1,s=o.height),"className"in o&&t(2,a=o.className)},l.$$.update=()=>{l.$$.dirty&16&&b(r)},[n,s,a,c,r,f]}class Oe extends Ce{constructor(e){super(),De(this,e,Qe,Ke,Ee,{volume:4,threshold:0,height:1,className:2})}}function ke(l){let e,t,r="精度",n,s,a,c,u,b,f,o=Ne(l[3])+"",d,h,v,$=l[3]>0?"+":"",D,q=l[3].toFixed(1)+"",N,B;return{c(){e=g("div"),t=g("div"),t.textContent=r,n=V(),s=g("div"),a=g("div"),c=V(),u=g("div"),b=V(),f=g("div"),d=T(o),h=V(),v=g("div"),D=T($),N=T(q),B=T("%"),this.h()},l(k){e=_(k,"DIV",{class:!0});var E=C(e);t=_(E,"DIV",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-4oi8f7"&&(t.textContent=r),n=w(E),s=_(E,"DIV",{class:!0});var F=C(s);a=_(F,"DIV",{class:!0,style:!0}),C(a).forEach(m),c=w(F),u=_(F,"DIV",{class:!0}),C(u).forEach(m),F.forEach(m),b=w(E),f=_(E,"DIV",{class:!0,style:!0});var H=C(f);d=M(H,o),H.forEach(m),h=w(E),v=_(E,"DIV",{class:!0});var I=C(v);D=M(I,$),N=M(I,q),B=M(I,"%"),I.forEach(m),E.forEach(m),this.h()},h(){p(t,"class","label svelte-17lpbmi"),p(a,"class","accuracy-bar svelte-17lpbmi"),S(a,"background-color",pe(l[3])),S(a,"width",Math.abs(l[3])+"%"),p(u,"class","accuracy-center svelte-17lpbmi"),p(s,"class","accuracy-bar-container svelte-17lpbmi"),p(f,"class","accuracy-text svelte-17lpbmi"),S(f,"color",pe(l[3])),p(v,"class","accuracy-value svelte-17lpbmi"),p(e,"class","accuracy-display svelte-17lpbmi")},m(k,E){L(k,e,E),i(e,t),i(e,n),i(e,s),i(s,a),i(s,c),i(s,u),i(e,b),i(e,f),i(f,d),i(e,h),i(e,v),i(v,D),i(v,N),i(v,B)},p(k,E){E&8&&S(a,"background-color",pe(k[3])),E&8&&S(a,"width",Math.abs(k[3])+"%"),E&8&&o!==(o=Ne(k[3])+"")&&W(d,o),E&8&&S(f,"color",pe(k[3])),E&8&&$!==($=k[3]>0?"+":"")&&W(D,$),E&8&&q!==(q=k[3].toFixed(1)+"")&&W(N,q)},d(k){k&&m(e)}}}function Xe(l){let e,t,r,n="目標音程",s,a,c=l[6](l[1])+"",u,b,f,o,d="現在の音程",h,v,$=(l[4]&&l[6](l[2])||"---")+"",D,q,N,B,k="周波数",E,F,H=Me(l[0])+"",I,te,R,A=l[4]&&l[2]&&ke(l);return{c(){e=g("div"),t=g("div"),r=g("div"),r.textContent=n,s=V(),a=g("div"),u=T(c),b=V(),f=g("div"),o=g("div"),o.textContent=d,h=V(),v=g("div"),D=T($),q=V(),N=g("div"),B=g("div"),B.textContent=k,E=V(),F=g("div"),I=T(H),te=V(),A&&A.c(),this.h()},l(z){e=_(z,"DIV",{class:!0});var G=C(e);t=_(G,"DIV",{class:!0});var Q=C(t);r=_(Q,"DIV",{class:!0,"data-svelte-h":!0}),J(r)!=="svelte-101q5wq"&&(r.textContent=n),s=w(Q),a=_(Q,"DIV",{class:!0});var ce=C(a);u=M(ce,c),ce.forEach(m),Q.forEach(m),b=w(G),f=_(G,"DIV",{class:!0});var O=C(f);o=_(O,"DIV",{class:!0,"data-svelte-h":!0}),J(o)!=="svelte-1p184h3"&&(o.textContent=d),h=w(O),v=_(O,"DIV",{class:!0});var ee=C(v);D=M(ee,$),ee.forEach(m),O.forEach(m),q=w(G),N=_(G,"DIV",{class:!0});var y=C(N);B=_(y,"DIV",{class:!0,"data-svelte-h":!0}),J(B)!=="svelte-1iigar3"&&(B.textContent=k),E=w(y),F=_(y,"DIV",{class:!0});var K=C(F);I=M(K,H),K.forEach(m),y.forEach(m),te=w(G),A&&A.l(G),G.forEach(m),this.h()},h(){p(r,"class","label svelte-17lpbmi"),p(a,"class","note-name target svelte-17lpbmi"),p(t,"class","target-note svelte-17lpbmi"),p(o,"class","label svelte-17lpbmi"),p(v,"class","note-name current svelte-17lpbmi"),fe(v,"detecting",l[4]),p(f,"class","current-note svelte-17lpbmi"),p(B,"class","label svelte-17lpbmi"),p(F,"class","frequency-value svelte-17lpbmi"),p(N,"class","frequency-display svelte-17lpbmi"),p(e,"class",R="pitch-display "+l[5]+" svelte-17lpbmi")},m(z,G){L(z,e,G),i(e,t),i(t,r),i(t,s),i(t,a),i(a,u),i(e,b),i(e,f),i(f,o),i(f,h),i(f,v),i(v,D),i(e,q),i(e,N),i(N,B),i(N,E),i(N,F),i(F,I),i(e,te),A&&A.m(e,null)},p(z,[G]){G&2&&c!==(c=z[6](z[1])+"")&&W(u,c),G&20&&$!==($=(z[4]&&z[6](z[2])||"---")+"")&&W(D,$),G&16&&fe(v,"detecting",z[4]),G&1&&H!==(H=Me(z[0])+"")&&W(I,H),z[4]&&z[2]?A?A.p(z,G):(A=ke(z),A.c(),A.m(e,null)):A&&(A.d(1),A=null),G&32&&R!==(R="pitch-display "+z[5]+" svelte-17lpbmi")&&p(e,"class",R)},i:_e,o:_e,d(z){z&&m(e),A&&A.d()}}}function pe(l){const e=Math.abs(l);return e<=10?"#10b981":e<=25?"#f59e0b":"#ef4444"}function Ne(l){const e=Math.abs(l);return e<=10?"素晴らしい！":e<=25?"もう少し！":"調整が必要"}function Me(l){return l>0?`${l.toFixed(1)} Hz`:"--.- Hz"}function Ye(l,e,t){let{frequency:r=0}=e,{targetNote:n="C"}=e,{currentNote:s=""}=e,{accuracy:a=0}=e,{isDetecting:c=!1}=e,{className:u=""}=e;const b={C:"ド","C#":"ド#",Db:"レ♭",D:"レ","D#":"レ#",Eb:"ミ♭",E:"ミ",F:"ファ","F#":"ファ#",Gb:"ソ♭",G:"ソ","G#":"ソ#",Ab:"ラ♭",A:"ラ","A#":"ラ#",Bb:"シ♭",B:"シ"};function f(o){return b[o]||o}return l.$$set=o=>{"frequency"in o&&t(0,r=o.frequency),"targetNote"in o&&t(1,n=o.targetNote),"currentNote"in o&&t(2,s=o.currentNote),"accuracy"in o&&t(3,a=o.accuracy),"isDetecting"in o&&t(4,c=o.isDetecting),"className"in o&&t(5,u=o.className)},[r,n,s,a,c,u,f]}class Ze extends Ce{constructor(e){super(),De(this,e,Ye,Xe,Ee,{frequency:0,targetNote:1,currentNote:2,accuracy:3,isDetecting:4,className:5})}}const{document:Te}=Je;function He(l,e,t){const r=l.slice();return r[31]=e[t],r[33]=t,r}function Pe(l,e,t){const r=l.slice();return r[31]=e[t],r[33]=t,r}function xe(l){let e,t,r;return t=new de({props:{variant:"default",padding:"lg",$$slots:{default:[at]},$$scope:{ctx:l}}}),{c(){e=g("div"),ae(t.$$.fragment),this.h()},l(n){e=_(n,"DIV",{class:!0});var s=C(e);ne(t.$$.fragment,s),s.forEach(m),this.h()},h(){p(e,"class","results-screen")},m(n,s){L(n,e,s),le(t,e,null),r=!0},p(n,s){const a={};s[0]&12295|s[1]&16&&(a.$$scope={dirty:s,ctx:n}),t.$set(a)},i(n){r||(x(t.$$.fragment,n),r=!0)},o(n){Z(t.$$.fragment,n),r=!1},d(n){n&&m(e),se(t)}}}function et(l){let e,t,r,n,s,a,c,u,b,f,o;return t=new de({props:{variant:"default",padding:"lg",$$slots:{default:[rt]},$$scope:{ctx:l}}}),a=new de({props:{variant:"default",padding:"md",$$slots:{default:[it]},$$scope:{ctx:l}}}),u=new de({props:{variant:"default",padding:"md",$$slots:{default:[ot]},$$scope:{ctx:l}}}),f=new de({props:{variant:"default",padding:"md",$$slots:{default:[ct]},$$scope:{ctx:l}}}),{c(){e=g("div"),ae(t.$$.fragment),r=V(),n=g("div"),s=g("div"),ae(a.$$.fragment),c=V(),ae(u.$$.fragment),b=V(),ae(f.$$.fragment),this.h()},l(d){e=_(d,"DIV",{class:!0});var h=C(e);ne(t.$$.fragment,h),r=w(h),n=_(h,"DIV",{class:!0});var v=C(n);s=_(v,"DIV",{class:!0});var $=C(s);ne(a.$$.fragment,$),c=w($),ne(u.$$.fragment,$),$.forEach(m),v.forEach(m),b=w(h),ne(f.$$.fragment,h),h.forEach(m),this.h()},h(){p(s,"class","display-grid svelte-1i5musd"),p(n,"class","realtime-display svelte-1i5musd"),p(e,"class","detection-screen")},m(d,h){L(d,e,h),le(t,e,null),i(e,r),i(e,n),i(n,s),le(a,s,null),i(s,c),le(u,s,null),i(e,b),le(f,e,null),o=!0},p(d,h){const v={};h[0]&193|h[1]&16&&(v.$$scope={dirty:h,ctx:d}),t.$set(v);const $={};h[0]&512|h[1]&16&&($.$$scope={dirty:h,ctx:d}),a.$set($);const D={};h[0]&3232|h[1]&16&&(D.$$scope={dirty:h,ctx:d}),u.$set(D);const q={};h[0]&132|h[1]&16&&(q.$$scope={dirty:h,ctx:d}),f.$set(q)},i(d){o||(x(t.$$.fragment,d),x(a.$$.fragment,d),x(u.$$.fragment,d),x(f.$$.fragment,d),o=!0)},o(d){Z(t.$$.fragment,d),Z(a.$$.fragment,d),Z(u.$$.fragment,d),Z(f.$$.fragment,d),o=!1},d(d){d&&m(e),se(t),se(a),se(u),se(f)}}}function tt(l){let e,t,r;return t=new de({props:{variant:"success",padding:"lg",$$slots:{default:[ut]},$$scope:{ctx:l}}}),{c(){e=g("div"),ae(t.$$.fragment),this.h()},l(n){e=_(n,"DIV",{class:!0});var s=C(e);ne(t.$$.fragment,s),s.forEach(m),this.h()},h(){p(e,"class","playing-screen")},m(n,s){L(n,e,s),le(t,e,null),r=!0},p(n,s){const a={};s[0]&64|s[1]&16&&(a.$$scope={dirty:s,ctx:n}),t.$set(a)},i(n){r||(x(t.$$.fragment,n),r=!0)},o(n){Z(t.$$.fragment,n),r=!1},d(n){n&&m(e),se(t)}}}function st(l){let e,t,r;return t=new de({props:{variant:"default",padding:"lg",$$slots:{default:[ht]},$$scope:{ctx:l}}}),{c(){e=g("div"),ae(t.$$.fragment),this.h()},l(n){e=_(n,"DIV",{class:!0});var s=C(e);ne(t.$$.fragment,s),s.forEach(m),this.h()},h(){p(e,"class","start-screen")},m(n,s){L(n,e,s),le(t,e,null),r=!0},p(n,s){const a={};s[0]&8|s[1]&16&&(a.$$scope={dirty:s,ctx:n}),t.$set(a)},i(n){r||(x(t.$$.fragment,n),r=!0)},o(n){Z(t.$$.fragment,n),r=!1},d(n){n&&m(e),se(t)}}}function qe(l){let e,t,r=l[31]+"",n,s,a,c=l[0][l[33]]?"✓":"×",u,b,f;return{c(){e=g("div"),t=g("span"),n=T(r),s=V(),a=g("span"),u=T(c),f=V(),this.h()},l(o){e=_(o,"DIV",{class:!0});var d=C(e);t=_(d,"SPAN",{class:!0});var h=C(t);n=M(h,r),h.forEach(m),s=w(d),a=_(d,"SPAN",{class:!0});var v=C(a);u=M(v,c),v.forEach(m),f=w(d),d.forEach(m),this.h()},h(){p(t,"class","scale-note-name svelte-1i5musd"),p(a,"class",b="scale-result-icon "+(l[0][l[33]]?"correct":"incorrect")+" svelte-1i5musd"),p(e,"class","scale-result svelte-1i5musd")},m(o,d){L(o,e,d),i(e,t),i(t,n),i(e,s),i(e,a),i(a,u),i(e,f)},p(o,d){d[0]&1&&c!==(c=o[0][o[33]]?"✓":"×")&&W(u,c),d[0]&1&&b!==(b="scale-result-icon "+(o[0][o[33]]?"correct":"incorrect")+" svelte-1i5musd")&&p(a,"class",b)},d(o){o&&m(e)}}}function lt(l){let e;return{c(){e=T("もう一度チャレンジ")},l(t){e=M(t,"もう一度チャレンジ")},m(t,r){L(t,e,r)},d(t){t&&m(e)}}}function nt(l){let e;return{c(){e=T("結果を保存")},l(t){e=M(t,"結果を保存")},m(t,r){L(t,e,r)},d(t){t&&m(e)}}}function at(l){let e,t,r="トレーニング結果",n,s,a,c,u,b,f,o="点",d,h,v,$,D,q,N,B,k,E,F,H,I,te,R,A,z="音階別結果",G,Q,ce,O,ee,y,K,X,ie=ge(l[14]),U=[];for(let P=0;P<ie.length;P+=1)U[P]=qe(He(l,ie,P));return ee=new $e({props:{variant:"success",size:"lg",fullWidth:!0,$$slots:{default:[lt]},$$scope:{ctx:l}}}),ee.$on("click",l[17]),K=new $e({props:{variant:"secondary",size:"md",fullWidth:!0,$$slots:{default:[nt]},$$scope:{ctx:l}}}),{c(){e=g("div"),t=g("h2"),t.textContent=r,n=V(),s=g("div"),a=g("div"),c=g("span"),u=T(l[1]),b=V(),f=g("span"),f.textContent=o,h=V(),v=g("div"),$=g("h3"),D=T(l[13]),q=V(),N=g("p"),B=T("8音階中 "),k=T(l[2]),E=T("音階 正解"),F=V(),H=g("p"),I=T(l[12]),te=V(),R=g("div"),A=g("h3"),A.textContent=z,G=V(),Q=g("div");for(let P=0;P<U.length;P+=1)U[P].c();ce=V(),O=g("div"),ae(ee.$$.fragment),y=V(),ae(K.$$.fragment),this.h()},l(P){e=_(P,"DIV",{class:!0});var j=C(e);t=_(j,"H2",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-1w4iqdy"&&(t.textContent=r),n=w(j),s=_(j,"DIV",{class:!0});var re=C(s);a=_(re,"DIV",{class:!0});var ue=C(a);c=_(ue,"SPAN",{class:!0});var Y=C(c);u=M(Y,l[1]),Y.forEach(m),b=w(ue),f=_(ue,"SPAN",{class:!0,"data-svelte-h":!0}),J(f)!=="svelte-yaz7vv"&&(f.textContent=o),ue.forEach(m),h=w(re),v=_(re,"DIV",{class:!0});var oe=C(v);$=_(oe,"H3",{class:!0});var we=C($);D=M(we,l[13]),we.forEach(m),q=w(oe),N=_(oe,"P",{class:!0});var ve=C(N);B=M(ve,"8音階中 "),k=M(ve,l[2]),E=M(ve,"音階 正解"),ve.forEach(m),F=w(oe),H=_(oe,"P",{class:!0});var Ve=C(H);I=M(Ve,l[12]),Ve.forEach(m),oe.forEach(m),re.forEach(m),te=w(j),R=_(j,"DIV",{class:!0});var he=C(R);A=_(he,"H3",{class:!0,"data-svelte-h":!0}),J(A)!=="svelte-140f1nw"&&(A.textContent=z),G=w(he),Q=_(he,"DIV",{class:!0});var Ie=C(Q);for(let be=0;be<U.length;be+=1)U[be].l(Ie);Ie.forEach(m),he.forEach(m),ce=w(j),O=_(j,"DIV",{class:!0});var me=C(O);ne(ee.$$.fragment,me),y=w(me),ne(K.$$.fragment,me),me.forEach(m),j.forEach(m),this.h()},h(){p(t,"class","results-title svelte-1i5musd"),p(c,"class","score-value svelte-1i5musd"),p(f,"class","score-unit svelte-1i5musd"),p(a,"class",d="score-circle "+l[13].toLowerCase()+" svelte-1i5musd"),p($,"class","grade-title svelte-1i5musd"),p(N,"class","score-description svelte-1i5musd"),p(H,"class","feedback-message svelte-1i5musd"),p(v,"class","grade-info svelte-1i5musd"),p(s,"class","score-display svelte-1i5musd"),p(A,"class","details-title svelte-1i5musd"),p(Q,"class","scale-results svelte-1i5musd"),p(R,"class","detailed-results"),p(O,"class","action-buttons svelte-1i5musd"),p(e,"class","results-content svelte-1i5musd")},m(P,j){L(P,e,j),i(e,t),i(e,n),i(e,s),i(s,a),i(a,c),i(c,u),i(a,b),i(a,f),i(s,h),i(s,v),i(v,$),i($,D),i(v,q),i(v,N),i(N,B),i(N,k),i(N,E),i(v,F),i(v,H),i(H,I),i(e,te),i(e,R),i(R,A),i(R,G),i(R,Q);for(let re=0;re<U.length;re+=1)U[re]&&U[re].m(Q,null);i(e,ce),i(e,O),le(ee,O,null),i(O,y),le(K,O,null),X=!0},p(P,j){if((!X||j[0]&2)&&W(u,P[1]),(!X||j[0]&8192&&d!==(d="score-circle "+P[13].toLowerCase()+" svelte-1i5musd"))&&p(a,"class",d),(!X||j[0]&8192)&&W(D,P[13]),(!X||j[0]&4)&&W(k,P[2]),(!X||j[0]&4096)&&W(I,P[12]),j[0]&16385){ie=ge(P[14]);let Y;for(Y=0;Y<ie.length;Y+=1){const oe=He(P,ie,Y);U[Y]?U[Y].p(oe,j):(U[Y]=qe(oe),U[Y].c(),U[Y].m(Q,null))}for(;Y<U.length;Y+=1)U[Y].d(1);U.length=ie.length}const re={};j[1]&16&&(re.$$scope={dirty:j,ctx:P}),ee.$set(re);const ue={};j[1]&16&&(ue.$$scope={dirty:j,ctx:P}),K.$set(ue)},i(P){X||(x(ee.$$.fragment,P),x(K.$$.fragment,P),X=!0)},o(P){Z(ee.$$.fragment,P),Z(K.$$.fragment,P),X=!1},d(P){P&&m(e),Le(U,P),se(ee),se(K)}}}function Be(l){let e,t=l[0][l[33]]?"✓":"×",r,n;return{c(){e=g("span"),r=T(t),this.h()},l(s){e=_(s,"SPAN",{class:!0});var a=C(e);r=M(a,t),a.forEach(m),this.h()},h(){p(e,"class",n="result-icon "+(l[0][l[33]]?"correct":"incorrect")+" svelte-1i5musd")},m(s,a){L(s,e,a),i(e,r)},p(s,a){a[0]&1&&t!==(t=s[0][s[33]]?"✓":"×")&&W(r,t),a[0]&1&&n!==(n="result-icon "+(s[0][s[33]]?"correct":"incorrect")+" svelte-1i5musd")&&p(e,"class",n)},d(s){s&&m(e)}}}function Ae(l){let e,t,r=l[31]+"",n,s,a,c=l[16](l[6],l[33])+"",u,b,f,o,d=l[0][l[33]]!==void 0&&Be(l);return{c(){e=g("div"),t=g("span"),n=T(r),s=V(),a=g("span"),u=T(c),b=T("Hz"),f=V(),d&&d.c(),o=V(),this.h()},l(h){e=_(h,"DIV",{class:!0});var v=C(e);t=_(v,"SPAN",{class:!0});var $=C(t);n=M($,r),$.forEach(m),s=w(v),a=_(v,"SPAN",{class:!0});var D=C(a);u=M(D,c),b=M(D,"Hz"),D.forEach(m),f=w(v),d&&d.l(v),o=w(v),v.forEach(m),this.h()},h(){p(t,"class","note-text svelte-1i5musd"),p(a,"class","note-frequency svelte-1i5musd"),p(e,"class","scale-note svelte-1i5musd"),fe(e,"active",l[33]===l[7]),fe(e,"completed",l[0][l[33]]!==void 0)},m(h,v){L(h,e,v),i(e,t),i(t,n),i(e,s),i(e,a),i(a,u),i(a,b),i(e,f),d&&d.m(e,null),i(e,o)},p(h,v){v[0]&64&&c!==(c=h[16](h[6],h[33])+"")&&W(u,c),h[0][h[33]]!==void 0?d?d.p(h,v):(d=Be(h),d.c(),d.m(e,o)):d&&(d.d(1),d=null),v[0]&128&&fe(e,"active",h[33]===h[7]),v[0]&1&&fe(e,"completed",h[0][h[33]]!==void 0)},d(h){h&&m(e),d&&d.d()}}}function rt(l){let e,t,r="ドレミファソラシドを歌ってください",n,s,a=ge(l[14]),c=[];for(let u=0;u<a.length;u+=1)c[u]=Ae(Pe(l,a,u));return{c(){e=g("div"),t=g("h2"),t.textContent=r,n=V(),s=g("div");for(let u=0;u<c.length;u+=1)c[u].c();this.h()},l(u){e=_(u,"DIV",{class:!0});var b=C(e);t=_(b,"H2",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-9l8glf"&&(t.textContent=r),n=w(b),s=_(b,"DIV",{class:!0});var f=C(s);for(let o=0;o<c.length;o+=1)c[o].l(f);f.forEach(m),b.forEach(m),this.h()},h(){p(t,"class","guide-title svelte-1i5musd"),p(s,"class","scale-guide svelte-1i5musd"),p(e,"class","guide-content svelte-1i5musd")},m(u,b){L(u,e,b),i(e,t),i(e,n),i(e,s);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(s,null)},p(u,b){if(b[0]&82113){a=ge(u[14]);let f;for(f=0;f<a.length;f+=1){const o=Pe(u,a,f);c[f]?c[f].p(o,b):(c[f]=Ae(o),c[f].c(),c[f].m(s,null))}for(;f<c.length;f+=1)c[f].d(1);c.length=a.length}},d(u){u&&m(e),Le(c,u)}}}function it(l){let e,t,r="音量レベル",n,s,a;return s=new Oe({props:{volume:l[9],height:"20px"}}),{c(){e=g("div"),t=g("h3"),t.textContent=r,n=V(),ae(s.$$.fragment),this.h()},l(c){e=_(c,"DIV",{class:!0});var u=C(e);t=_(u,"H3",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-1nc8gri"&&(t.textContent=r),n=w(u),ne(s.$$.fragment,u),u.forEach(m),this.h()},h(){p(t,"class","display-title svelte-1i5musd"),p(e,"class","volume-display")},m(c,u){L(c,e,u),i(e,t),i(e,n),le(s,e,null),a=!0},p(c,u){const b={};u[0]&512&&(b.volume=c[9]),s.$set(b)},i(c){a||(x(s.$$.fragment,c),a=!0)},o(c){Z(s.$$.fragment,c),a=!1},d(c){c&&m(e),se(s)}}}function ot(l){let e,t;return e=new Ze({props:{frequency:l[10],targetNote:l[14][l[7]],currentNote:l[11],accuracy:0,isDetecting:l[5]}}),{c(){ae(e.$$.fragment)},l(r){ne(e.$$.fragment,r)},m(r,n){le(e,r,n),t=!0},p(r,n){const s={};n[0]&1024&&(s.frequency=r[10]),n[0]&128&&(s.targetNote=r[14][r[7]]),n[0]&2048&&(s.currentNote=r[11]),n[0]&32&&(s.isDetecting=r[5]),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){Z(e.$$.fragment,r),t=!1},d(r){se(e,r)}}}function ct(l){let e,t,r="進行状況",n,s,a,c,u=l[14][l[7]]+"",b,f,o=l[7]+1+"",d,h,v,$,D,q,N,B;return{c(){e=g("div"),t=g("h3"),t.textContent=r,n=V(),s=g("div"),a=g("span"),c=T("現在: "),b=T(u),f=T(" ("),d=T(o),h=T("/8)"),v=V(),$=g("span"),D=T("正解: "),q=T(l[2]),N=T("/"),B=T(l[7]),this.h()},l(k){e=_(k,"DIV",{class:!0});var E=C(e);t=_(E,"H3",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-v1qnd4"&&(t.textContent=r),n=w(E),s=_(E,"DIV",{class:!0});var F=C(s);a=_(F,"SPAN",{});var H=C(a);c=M(H,"現在: "),b=M(H,u),f=M(H," ("),d=M(H,o),h=M(H,"/8)"),H.forEach(m),v=w(F),$=_(F,"SPAN",{});var I=C($);D=M(I,"正解: "),q=M(I,l[2]),N=M(I,"/"),B=M(I,l[7]),I.forEach(m),F.forEach(m),E.forEach(m),this.h()},h(){p(t,"class","progress-title svelte-1i5musd"),p(s,"class","progress-details svelte-1i5musd"),p(e,"class","progress-info svelte-1i5musd")},m(k,E){L(k,e,E),i(e,t),i(e,n),i(e,s),i(s,a),i(a,c),i(a,b),i(a,f),i(a,d),i(a,h),i(s,v),i(s,$),i($,D),i($,q),i($,N),i($,B)},p(k,E){E[0]&128&&u!==(u=k[14][k[7]]+"")&&W(b,u),E[0]&128&&o!==(o=k[7]+1+"")&&W(d,o),E[0]&4&&W(q,k[2]),E[0]&128&&W(B,k[7])},d(k){k&&m(e)}}}function ut(l){let e,t,r='<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polygon points="10,8 16,12 10,16"></polygon></svg>',n,s,a="基音再生中",c,u,b,f,o,d,h,v=l[15](l[6])+"",$,D,q,N,B="この音を覚えて「ド」として認識してください",k,E,F='<div class="progress-bar svelte-1i5musd"><div class="progress-fill svelte-1i5musd"></div></div>';return{c(){e=g("div"),t=g("div"),t.innerHTML=r,n=V(),s=g("h2"),s.textContent=a,c=V(),u=g("p"),b=T("基音: "),f=T(l[6]),o=V(),d=g("p"),h=T("周波数: "),$=T(v),D=T("Hz"),q=V(),N=g("p"),N.textContent=B,k=V(),E=g("div"),E.innerHTML=F,this.h()},l(H){e=_(H,"DIV",{class:!0});var I=C(e);t=_(I,"DIV",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-11l4yoz"&&(t.innerHTML=r),n=w(I),s=_(I,"H2",{class:!0,"data-svelte-h":!0}),J(s)!=="svelte-1maueo6"&&(s.textContent=a),c=w(I),u=_(I,"P",{class:!0});var te=C(u);b=M(te,"基音: "),f=M(te,l[6]),te.forEach(m),o=w(I),d=_(I,"P",{class:!0});var R=C(d);h=M(R,"周波数: "),$=M(R,v),D=M(R,"Hz"),R.forEach(m),q=w(I),N=_(I,"P",{class:!0,"data-svelte-h":!0}),J(N)!=="svelte-1hcrx2z"&&(N.textContent=B),k=w(I),E=_(I,"DIV",{class:!0,"data-svelte-h":!0}),J(E)!=="svelte-4yu433"&&(E.innerHTML=F),I.forEach(m),this.h()},h(){p(t,"class","playing-icon svelte-1i5musd"),p(s,"class","playing-title svelte-1i5musd"),p(u,"class","playing-note svelte-1i5musd"),p(d,"class","playing-frequency svelte-1i5musd"),p(N,"class","playing-instruction svelte-1i5musd"),p(E,"class","playing-progress svelte-1i5musd"),p(e,"class","playing-content svelte-1i5musd")},m(H,I){L(H,e,I),i(e,t),i(e,n),i(e,s),i(e,c),i(e,u),i(u,b),i(u,f),i(e,o),i(e,d),i(d,h),i(d,$),i(d,D),i(e,q),i(e,N),i(e,k),i(e,E)},p(H,I){I[0]&64&&W(f,H[6]),I[0]&64&&v!==(v=H[15](H[6])+"")&&W($,v)},d(H){H&&m(e)}}}function dt(l){let e;return{c(){e=T("トレーニング開始")},l(t){e=M(t,"トレーニング開始")},m(t,r){L(t,e,r)},d(t){t&&m(e)}}}function ft(l){let e;return{c(){e=T("ピアノ音源読み込み中...")},l(t){e=M(t,"ピアノ音源読み込み中...")},m(t,r){L(t,e,r)},d(t){t&&m(e)}}}function vt(l){let e;function t(s,a){return s[3]?dt:ft}let r=t(l),n=r(l);return{c(){n.c(),e=ye()},l(s){n.l(s),e=ye()},m(s,a){n.m(s,a),L(s,e,a)},p(s,a){r!==(r=t(s))&&(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&m(e),n.d(s)}}}function Fe(l){let e,t="Salamander Grand Piano 音源を読み込んでいます";return{c(){e=g("p"),e.textContent=t,this.h()},l(r){e=_(r,"P",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-1j6c2dk"&&(e.textContent=t),this.h()},h(){p(e,"class","loading-message svelte-1i5musd")},m(r,n){L(r,e,n)},d(r){r&&m(e)}}}function ht(l){let e,t,r="トレーニング開始",n,s,a=`基音を聞いた後、その音を「ド」として<br/>
              ドレミファソラシドを連続して歌ってください`,c,u,b='<div class="instruction-item svelte-1i5musd"><span class="step-number svelte-1i5musd">1</span> <div><h3 class="svelte-1i5musd">基音を聞く</h3> <p class="svelte-1i5musd">ランダムに選ばれた基音をピアノで再生します</p></div></div> <div class="instruction-item svelte-1i5musd"><span class="step-number svelte-1i5musd">2</span> <div><h3 class="svelte-1i5musd">連続歌唱</h3> <p class="svelte-1i5musd">基音を「ド」として、ドレミファソラシドを連続して歌います</p></div></div> <div class="instruction-item svelte-1i5musd"><span class="step-number svelte-1i5musd">3</span> <div><h3 class="svelte-1i5musd">自動判定</h3> <p class="svelte-1i5musd">歌唱中にリアルタイムで各音階を自動判定します</p></div></div>',f,o,d,h;o=new $e({props:{variant:"success",size:"lg",fullWidth:!0,disabled:!l[3],$$slots:{default:[vt]},$$scope:{ctx:l}}}),o.$on("click",l[17]);let v=!l[3]&&Fe();return{c(){e=g("div"),t=g("h2"),t.textContent=r,n=V(),s=g("p"),s.innerHTML=a,c=V(),u=g("div"),u.innerHTML=b,f=V(),ae(o.$$.fragment),d=V(),v&&v.c(),this.h()},l($){e=_($,"DIV",{class:!0});var D=C(e);t=_(D,"H2",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-177yn6"&&(t.textContent=r),n=w(D),s=_(D,"P",{class:!0,"data-svelte-h":!0}),J(s)!=="svelte-c83iab"&&(s.innerHTML=a),c=w(D),u=_(D,"DIV",{class:!0,"data-svelte-h":!0}),J(u)!=="svelte-u1n8ly"&&(u.innerHTML=b),f=w(D),ne(o.$$.fragment,D),d=w(D),v&&v.l(D),D.forEach(m),this.h()},h(){p(t,"class","start-title svelte-1i5musd"),p(s,"class","start-description svelte-1i5musd"),p(u,"class","instructions svelte-1i5musd"),p(e,"class","start-content svelte-1i5musd")},m($,D){L($,e,D),i(e,t),i(e,n),i(e,s),i(e,c),i(e,u),i(e,f),le(o,e,null),i(e,d),v&&v.m(e,null),h=!0},p($,D){const q={};D[0]&8&&(q.disabled=!$[3]),D[0]&8|D[1]&16&&(q.$$scope={dirty:D,ctx:$}),o.$set(q),$[3]?v&&(v.d(1),v=null):v||(v=Fe(),v.c(),v.m(e,null))},i($){h||(x(o.$$.fragment,$),h=!0)},o($){Z(o.$$.fragment,$),h=!1},d($){$&&m(e),se(o),v&&v.d()}}}function mt(l){let e,t,r='<div class="mode-header svelte-1i5musd"><div class="mode-icon svelte-1i5musd"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg></div> <div><h1 class="mode-title svelte-1i5musd">ランダム基音モード</h1> <p class="mode-description svelte-1i5musd">10種類の基音からランダムに選択してトレーニング</p></div></div>',n,s,a,c;const u=[st,tt,et,xe],b=[];function f(o,d){return!o[4]&&!o[5]&&!o[8]?0:o[4]?1:o[5]?2:o[8]?3:-1}return~(s=f(l))&&(a=b[s]=u[s](l)),{c(){e=g("div"),t=g("div"),t.innerHTML=r,n=V(),a&&a.c(),this.h()},l(o){e=_(o,"DIV",{class:!0});var d=C(e);t=_(d,"DIV",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-1oabx6r"&&(t.innerHTML=r),n=w(d),a&&a.l(d),d.forEach(m),this.h()},h(){p(t,"class","header svelte-1i5musd"),p(e,"class","random-training svelte-1i5musd")},m(o,d){L(o,e,d),i(e,t),i(e,n),~s&&b[s].m(e,null),c=!0},p(o,d){let h=s;s=f(o),s===h?~s&&b[s].p(o,d):(a&&(Re(),Z(b[h],1,1,()=>{b[h]=null}),Ue()),~s?(a=b[s],a?a.p(o,d):(a=b[s]=u[s](o),a.c()),x(a,1),a.m(e,null)):a=null)},i(o){c||(x(a),c=!0)},o(o){Z(a),c=!1},d(o){o&&m(e),~s&&b[s].d()}}}function pt(l){let e,t,r;return t=new We({props:{showBackButton:!0,$$slots:{default:[mt]},$$scope:{ctx:l}}}),{c(){e=V(),ae(t.$$.fragment),this.h()},l(n){Ge("svelte-1nfe5e4",Te.head).forEach(m),e=w(n),ne(t.$$.fragment,n),this.h()},h(){Te.title="ランダム基音モード - 相対音感トレーニング"},m(n,s){L(n,e,s),le(t,n,s),r=!0},p(n,s){const a={};s[0]&16383|s[1]&16&&(a.$$scope={dirty:s,ctx:n}),t.$set(a)},i(n){r||(x(t.$$.fragment,n),r=!0)},o(n){Z(t.$$.fragment,n),r=!1},d(n){n&&m(e),se(t,n)}}}function _t(l,e,t){let r,n,s,a,c=null,u=null,b=!1,f=!1,o=!1,d="",h=0,v=[],$=!1,D=0,q=0,N="";const B=["ド","レ","ミ","ファ","ソ","ラ","シ","ド"],k=["Bb3","B3","C4","Db4","D4","Eb4","E4","F4","Gb4","Ab4"],E={Bb3:233.08,B3:246.94,C4:261.63,Db4:277.18,D4:293.66,Eb4:311.13,E4:329.63,F4:349.23,Gb4:369.99,Ab4:415.3},F=[1,9/8,5/4,4/3,3/2,5/3,15/8,2];async function H(){try{if(typeof window<"u"&&!window.Tone){const y=document.createElement("script");y.src="https://unpkg.com/tone@14.7.77/build/Tone.js",y.onload=async()=>{window.Tone=window.Tone,c=window.Tone,await I()},document.head.appendChild(y)}else window.Tone&&(c=window.Tone,await I())}catch(y){console.error("Tone.js初期化エラー:",y)}}async function I(){try{if(!c)return;c.context.state!=="running"&&await c.start(),u=new c.Sampler({urls:{C4:"C4.mp3"},baseUrl:"https://tonejs.github.io/audio/salamander/",release:1.5,onload:()=>{t(3,b=!0),console.log("Salamander Grand Piano読み込み完了")}}).toDestination()}catch(y){console.error("サンプラー設定エラー:",y)}}Se(()=>{H()}),je(()=>{u&&u.dispose()});function te(y){return Math.round(E[y]||0)}function R(y,K){const X=E[y];return X?Math.round(X*F[K]):0}function A(){const y=Math.floor(Math.random()*k.length);return t(6,d=k[y]),d}function z(){t(7,h=0),t(0,v=[]),t(8,$=!1);const y=A();G(y)}async function G(y){t(4,f=!0),console.log(`基音再生: ${y}`);try{if(!b||!u){console.warn("Tone.js または Sampler が未初期化"),setTimeout(()=>{t(4,f=!1),Q()},2500);return}c.context.state!=="running"&&await c.start(),u.triggerAttackRelease(y,"2.5"),console.log(`Salamander Grand Piano で ${y} 再生開始`),setTimeout(()=>{t(4,f=!1),Q()},2500)}catch(K){console.error("基音再生エラー:",K),setTimeout(()=>{t(4,f=!1),Q()},2500)}}function Q(){t(5,o=!0);const y=B.map((X,ie)=>R(d,ie)),K=setInterval(()=>{if(!o){clearInterval(K);return}t(9,D=40+Math.random()*50);const X=y[h],ie=(Math.random()-.5)*40;t(10,q=X+ie);const U=Math.max(0,100-Math.abs(ie)*2);if(t(11,N=B[h]),Math.random()>.6){const P=U>70;t(0,v[h]=P,v),t(7,h++,h),console.log(`${N}: ${U.toFixed(1)}% 精度, ${P?"正解":"不正解"}`),h>=8&&ce()}},300)}function ce(){t(5,o=!1),t(8,$=!0)}function O(y){return y>=90?"Excellent":y>=70?"Good":y>=50?"Practice":"Needs Work"}function ee(y){return y>=90?"素晴らしい相対音感です！完璧な演奏でした。":y>=70?"良好な相対音感です。もう少し練習すれば完璧になります。":y>=50?"基本的な相対音感は身についています。継続練習で向上できます。":"相対音感の基礎練習から始めましょう。毎日少しずつ練習することが大切です。"}return l.$$.update=()=>{l.$$.dirty[0]&1&&t(2,r=v.filter(y=>y).length),l.$$.dirty[0]&4&&t(1,n=Math.round(r/8*100)),l.$$.dirty[0]&2&&t(13,s=O(n)),l.$$.dirty[0]&2&&t(12,a=ee(n))},[v,n,r,b,f,o,d,h,$,D,q,N,a,s,B,te,R,z]}class Et extends Ce{constructor(e){super(),De(this,e,_t,pt,Ee,{},null,[-1,-1])}}export{Et as component};
