import{S as te,i as ee,d as x,s as ne,v as oe,c as ie,a as se,D as vt,E as Et,b as m,q as ot,r as $,u as K,f as E,w as it,F as le,m as N,x as st,p as H,y as lt,g as h,z as v,h as _,j as p,k as z,B as rt,A as G,o as k,C as at,G as Pt,H as At,l as Q,t as X,n as Ct,e as ht,I as ft,J as Mt,K as ut}from"../chunks/EvMzC0aQ.js";import{g as ce}from"../chunks/D0QH3NT1.js";import"../chunks/DrEUfQCr.js";import{p as mt}from"../chunks/CNllCZxk.js";import{P as Ft,B as qt,C as _t}from"../chunks/yXPAb40O.js";import{P as re,V as Rt}from"../chunks/CmUJIz7r.js";const{console:ae}=ce,g="src/routes/microphone-test/+page.svelte";function xt(c){let t,e="❌ マイクアクセスエラーが発生しました",l,o,n="マイク許可を再試行",i,r;const u={c:function(){t=k("div"),t.textContent=e,l=H(),o=k("button"),o.textContent=n,this.h()},l:function(s){t=p(s,"DIV",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-11p6bhs"&&(t.textContent=e),l=N(s),o=p(s,"BUTTON",{class:!0,"data-svelte-h":!0}),G(o)!=="svelte-1co4n23"&&(o.textContent=n),this.h()},h:function(){v(t,"class","status-indicator error svelte-ztuqv4"),_(t,g,411,14,12032),v(o,"class","retry-button svelte-ztuqv4"),_(o,g,412,14,12108)},m:function(s,a){E(s,t,a),E(s,l,a),E(s,o,a),i||(r=Mt(o,"click",c[10],!1),i=!0)},p:Ct,d:function(s){s&&(m(t),m(l),m(o)),i=!1,r()}};return x("SvelteRegisterBlock",{block:u,id:xt.name,type:"if",source:"(411:48) ",ctx:c}),u}function Nt(c){let t,e="❌ マイクアクセスが拒否されました",l,o,n="マイク許可を再試行",i,r;const u={c:function(){t=k("div"),t.textContent=e,l=H(),o=k("button"),o.textContent=n,this.h()},l:function(s){t=p(s,"DIV",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-4rewx4"&&(t.textContent=e),l=N(s),o=p(s,"BUTTON",{class:!0,"data-svelte-h":!0}),G(o)!=="svelte-1co4n23"&&(o.textContent=n),this.h()},h:function(){v(t,"class","status-indicator error svelte-ztuqv4"),_(t,g,406,14,11786),v(o,"class","retry-button svelte-ztuqv4"),_(o,g,407,14,11860)},m:function(s,a){E(s,t,a),E(s,l,a),E(s,o,a),i||(r=Mt(o,"click",c[10],!1),i=!0)},p:Ct,d:function(s){s&&(m(t),m(l),m(o)),i=!1,r()}};return x("SvelteRegisterBlock",{block:u,id:Nt.name,type:"if",source:"(406:49) ",ctx:c}),u}function Ht(c){let t,e="✅ マイクアクセス許可済み",l,o;function n(d,s){return d[6]?Tt:jt}let i=n(c),r=i(c);const u={c:function(){t=k("div"),t.textContent=e,l=H(),r.c(),o=ft(),this.h()},l:function(s){t=p(s,"DIV",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-96x1w2"&&(t.textContent=e),l=N(s),r.l(s),o=ft(),this.h()},h:function(){v(t,"class","status-indicator granted svelte-ztuqv4"),_(t,g,399,14,11441)},m:function(s,a){E(s,t,a),E(s,l,a),r.m(s,a),E(s,o,a)},p:function(s,a){i!==(i=n(s))&&(r.d(1),r=i(s),r&&(r.c(),r.m(o.parentNode,o)))},d:function(s){s&&(m(t),m(l),m(o)),r.d(s)}};return x("SvelteRegisterBlock",{block:u,id:Ht.name,type:"if",source:"(399:50) ",ctx:c}),u}function Lt(c){let t,e="⏳ マイク許可を確認中...";const l={c:function(){t=k("div"),t.textContent=e,this.h()},l:function(n){t=p(n,"DIV",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-qiomfc"&&(t.textContent=e),this.h()},h:function(){v(t,"class","status-indicator pending svelte-ztuqv4"),_(t,g,397,14,11317)},m:function(n,i){E(n,t,i)},p:Ct,d:function(n){n&&m(t)}};return x("SvelteRegisterBlock",{block:l,id:Lt.name,type:"if",source:"(397:12) {#if micPermission === 'pending'}",ctx:c}),l}function Tt(c){let t,e="🎤 リアルタイム解析中";const l={c:function(){t=k("div"),t.textContent=e,this.h()},l:function(n){t=p(n,"DIV",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-bm11qy"&&(t.textContent=e),this.h()},h:function(){v(t,"class","status-indicator success svelte-ztuqv4"),_(t,g,403,16,11645)},m:function(n,i){E(n,t,i)},d:function(n){n&&m(t)}};return x("SvelteRegisterBlock",{block:l,id:Tt.name,type:"else",source:"(403:14) {:else}",ctx:c}),l}function jt(c){let t,e="⚠️ リスニング準備中...";const l={c:function(){t=k("div"),t.textContent=e,this.h()},l:function(n){t=p(n,"DIV",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-1l9yy07"&&(t.textContent=e),this.h()},h:function(){v(t,"class","status-indicator warning svelte-ztuqv4"),_(t,g,401,16,11548)},m:function(n,i){E(n,t,i)},d:function(n){n&&m(t)}};return x("SvelteRegisterBlock",{block:l,id:jt.name,type:"if",source:"(401:14) {#if !isListening}",ctx:c}),l}function gt(c){let t,e,l,o="音量レベル",n,i,r,u,d,s,a,y="音程検出",w,b,S,L=c[4].toFixed(1)+"",R,D,B,C,A,V,T,j,O,I,M;i=new Rt({props:{volume:c[3],height:"16px",className:"volume-bar-wrapper"},$$inline:!0});let F=!c[1]&&yt(c),f=c[7]>0&&pt(c);function Z(Y,q){return Y[2]?Y[7]<50?Gt:Wt:Ot}let J=Z(c),W=J(c),P=c[1]&&!c[2]&&kt(c);const ct={c:function(){t=k("div"),e=k("div"),l=k("h3"),l.textContent=o,n=H(),lt(i.$$.fragment),r=H(),u=k("div"),F&&F.c(),d=H(),s=k("div"),a=k("h3"),a.textContent=y,w=H(),b=k("div"),S=k("div"),R=X(L),D=X(" Hz"),B=H(),C=k("div"),A=X(c[5]),V=H(),f&&f.c(),T=H(),j=k("div"),W.c(),O=H(),P&&P.c(),I=ft(),this.h()},l:function(q){t=p(q,"DIV",{class:!0});var U=z(t);e=p(U,"DIV",{class:!0});var tt=z(e);l=p(tt,"H3",{class:!0,"data-svelte-h":!0}),G(l)!=="svelte-1nc8gri"&&(l.textContent=o),n=N(tt),st(i.$$.fragment,tt),r=N(tt),u=p(tt,"DIV",{class:!0});var zt=z(u);F&&F.l(zt),zt.forEach(m),tt.forEach(m),d=N(U),s=p(U,"DIV",{class:!0});var et=z(s);a=p(et,"H3",{class:!0,"data-svelte-h":!0}),G(a)!=="svelte-1ofzoy2"&&(a.textContent=y),w=N(et),b=p(et,"DIV",{class:!0});var nt=z(b);S=p(nt,"DIV",{class:!0});var dt=z(S);R=Q(dt,L),D=Q(dt," Hz"),dt.forEach(m),B=N(nt),C=p(nt,"DIV",{class:!0});var Dt=z(C);A=Q(Dt,c[5]),Dt.forEach(m),V=N(nt),f&&f.l(nt),nt.forEach(m),T=N(et),j=p(et,"DIV",{class:!0});var Bt=z(j);W.l(Bt),Bt.forEach(m),et.forEach(m),U.forEach(m),O=N(q),P&&P.l(q),I=ft(),this.h()},h:function(){v(l,"class","display-title svelte-ztuqv4"),_(l,g,423,16,12471),v(u,"class","volume-status svelte-ztuqv4"),_(u,g,425,16,12622),v(e,"class","volume-section svelte-ztuqv4"),_(e,g,422,14,12426),v(a,"class","display-title svelte-ztuqv4"),_(a,g,434,16,12928),v(S,"class","frequency-value svelte-ztuqv4"),_(S,g,436,18,13030),v(C,"class","note-value svelte-ztuqv4"),_(C,g,437,18,13116),v(b,"class","frequency-display svelte-ztuqv4"),_(b,g,435,16,12980),v(j,"class","frequency-status svelte-ztuqv4"),_(j,g,450,16,13767),v(s,"class","frequency-section"),_(s,g,433,14,12880),v(t,"class","realtime-display svelte-ztuqv4"),_(t,g,420,12,12352)},m:function(q,U){E(q,t,U),h(t,e),h(e,l),h(e,n),it(i,e,null),h(e,r),h(e,u),F&&F.m(u,null),h(t,d),h(t,s),h(s,a),h(s,w),h(s,b),h(b,S),h(S,R),h(S,D),h(b,B),h(b,C),h(C,A),h(b,V),f&&f.m(b,null),h(s,T),h(s,j),W.m(j,null),E(q,O,U),P&&P.m(q,U),E(q,I,U),M=!0},p:function(q,U){const tt={};U&8&&(tt.volume=q[3]),i.$set(tt),q[1]?F&&(F.d(1),F=null):F||(F=yt(q),F.c(),F.m(u,null)),(!M||U&16)&&L!==(L=q[4].toFixed(1)+"")&&ht(R,L),(!M||U&32)&&ht(A,q[5]),q[7]>0?f?f.p(q,U):(f=pt(q),f.c(),f.m(b,null)):f&&(f.d(1),f=null),J!==(J=Z(q))&&(W.d(1),W=J(q),W&&(W.c(),W.m(j,null))),q[1]&&!q[2]?P||(P=kt(q),P.c(),P.m(I.parentNode,I)):P&&(P.d(1),P=null)},i:function(q){M||(K(i.$$.fragment,q),M=!0)},o:function(q){$(i.$$.fragment,q),M=!1},d:function(q){q&&(m(t),m(O),m(I)),ot(i),F&&F.d(),f&&f.d(),W.d(),P&&P.d(q)}};return x("SvelteRegisterBlock",{block:ct,id:gt.name,type:"if",source:"(420:10) {#if micPermission === 'granted' && isListening}",ctx:c}),ct}function yt(c){let t,e="⏳ 声を出して音量を確認してください";const l={c:function(){t=k("span"),t.textContent=e,this.h()},l:function(n){t=p(n,"SPAN",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-7eexnn"&&(t.textContent=e),this.h()},h:function(){v(t,"class","status-pending svelte-ztuqv4"),_(t,g,427,20,12710)},m:function(n,i){E(n,t,i)},d:function(n){n&&m(t)}};return x("SvelteRegisterBlock",{block:l,id:yt.name,type:"if",source:"(427:18) {#if !volumeDetected}",ctx:c}),l}function pt(c){let t,e,l,o,n,i;const r={c:function(){t=k("div"),e=X("信頼度: "),l=X(c[7]),o=X(`%
                      `),n=k("div"),i=k("div"),this.h()},l:function(d){t=p(d,"DIV",{class:!0});var s=z(t);e=Q(s,"信頼度: "),l=Q(s,c[7]),o=Q(s,`%
                      `),n=p(s,"DIV",{class:!0});var a=z(n);i=p(a,"DIV",{class:!0,style:!0}),z(i).forEach(m),a.forEach(m),s.forEach(m),this.h()},h:function(){v(i,"class","confidence-fill svelte-ztuqv4"),ut(i,"width",c[7]+"%"),ut(i,"background-color",c[7]>70?"#10b981":c[7]>40?"#f59e0b":"#ef4444"),_(i,g,442,24,13386),v(n,"class","confidence-bar svelte-ztuqv4"),_(n,g,441,22,13333),v(t,"class","confidence-display svelte-ztuqv4"),_(t,g,439,20,13228)},m:function(d,s){E(d,t,s),h(t,e),h(t,l),h(t,o),h(t,n),h(n,i)},p:function(d,s){s&128&&ht(l,d[7]),s&128&&ut(i,"width",d[7]+"%"),s&128&&ut(i,"background-color",d[7]>70?"#10b981":d[7]>40?"#f59e0b":"#ef4444")},d:function(d){d&&m(t)}};return x("SvelteRegisterBlock",{block:r,id:pt.name,type:"if",source:"(439:18) {#if detectionConfidence > 0}",ctx:c}),r}function Wt(c){let t,e="✅ 音程検出中";const l={c:function(){t=k("span"),t.textContent=e,this.h()},l:function(n){t=p(n,"SPAN",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-acahk5"&&(t.textContent=e),this.h()},h:function(){v(t,"class","status-success svelte-ztuqv4"),_(t,g,456,20,14092)},m:function(n,i){E(n,t,i)},d:function(n){n&&m(t)}};return x("SvelteRegisterBlock",{block:l,id:Wt.name,type:"else",source:"(456:18) {:else}",ctx:c}),l}function Gt(c){let t,e="⚠️ より明確に発声してください";const l={c:function(){t=k("span"),t.textContent=e,this.h()},l:function(n){t=p(n,"SPAN",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-lq2kpp"&&(t.textContent=e),this.h()},h:function(){v(t,"class","status-warning svelte-ztuqv4"),_(t,g,454,20,13993)},m:function(n,i){E(n,t,i)},d:function(n){n&&m(t)}};return x("SvelteRegisterBlock",{block:l,id:Gt.name,type:"if",source:"(454:53) ",ctx:c}),l}function Ot(c){let t,e="⏳ 「ド」を発声して音程を確認してください";const l={c:function(){t=k("span"),t.textContent=e,this.h()},l:function(n){t=p(n,"SPAN",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-lvftl7"&&(t.textContent=e),this.h()},h:function(){v(t,"class","status-pending svelte-ztuqv4"),_(t,g,452,20,13861)},m:function(n,i){E(n,t,i)},d:function(n){n&&m(t)}};return x("SvelteRegisterBlock",{block:l,id:Ot.name,type:"if",source:"(452:18) {#if !frequencyDetected}",ctx:c}),l}function kt(c){let t,e,l,o="「ド」を発声してください",n,i,r="任意の高さで「ドー」と歌うように発声してください";const u={c:function(){t=k("div"),e=k("div"),l=k("h3"),l.textContent=o,n=H(),i=k("p"),i.textContent=r,this.h()},l:function(s){t=p(s,"DIV",{class:!0});var a=z(t);e=p(a,"DIV",{class:!0});var y=z(e);l=p(y,"H3",{class:!0,"data-svelte-h":!0}),G(l)!=="svelte-xe90gt"&&(l.textContent=o),n=N(y),i=p(y,"P",{class:!0,"data-svelte-h":!0}),G(i)!=="svelte-1rtajtc"&&(i.textContent=r),y.forEach(m),a.forEach(m),this.h()},h:function(){v(l,"class","svelte-ztuqv4"),_(l,g,466,18,14408),v(i,"class","svelte-ztuqv4"),_(i,g,467,18,14448),v(e,"class","guidance-content svelte-ztuqv4"),_(e,g,465,16,14359),v(t,"class","guidance svelte-ztuqv4"),_(t,g,464,14,14320)},m:function(s,a){E(s,t,a),h(t,e),h(e,l),h(e,n),h(e,i)},d:function(s){s&&m(t)}};return x("SvelteRegisterBlock",{block:u,id:kt.name,type:"if",source:"(464:12) {#if volumeDetected && !frequencyDetected}",ctx:c}),u}function Ut(c){let t,e,l,o;function n(s,a){if(s[0]==="pending")return Lt;if(s[0]==="granted")return Ht;if(s[0]==="denied")return Nt;if(s[0]==="error")return xt}let i=n(c),r=i&&i(c),u=c[0]==="granted"&&c[6]&&gt(c);const d={c:function(){t=k("div"),e=k("div"),r&&r.c(),l=H(),u&&u.c(),this.h()},l:function(a){t=p(a,"DIV",{class:!0});var y=z(t);e=p(y,"DIV",{class:!0});var w=z(e);r&&r.l(w),w.forEach(m),l=N(y),u&&u.l(y),y.forEach(m),this.h()},h:function(){v(e,"class","mic-status svelte-ztuqv4"),_(e,g,395,10,11232),v(t,"class","mic-test-content svelte-ztuqv4"),_(t,g,392,8,11153)},m:function(a,y){E(a,t,y),h(t,e),r&&r.m(e,null),h(t,l),u&&u.m(t,null),o=!0},p:function(a,y){i===(i=n(a))&&r?r.p(a,y):(r&&r.d(1),r=i&&i(a),r&&(r.c(),r.m(e,null))),a[0]==="granted"&&a[6]?u?(u.p(a,y),y&65&&K(u,1)):(u=gt(a),u.c(),K(u,1),u.m(t,null)):u&&(Pt(),$(u,1,1,()=>{u=null}),At())},i:function(a){o||(K(u),o=!0)},o:function(a){$(u),o=!1},d:function(a){a&&m(t),r&&r.d(),u&&u.d()}};return x("SvelteRegisterBlock",{block:d,id:Ut.name,type:"slot",source:'(392:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:c}),d}function Jt(c){let t,e;t=new qt({props:{variant:"disabled",size:"lg",fullWidth:!0,disabled:!0,$$slots:{default:[Kt]},$$scope:{ctx:c}},$$inline:!0});const l={c:function(){lt(t.$$.fragment)},l:function(n){st(t.$$.fragment,n)},m:function(n,i){it(t,n,i),e=!0},p:function(n,i){const r={};i&8388608&&(r.$$scope={dirty:i,ctx:n}),t.$set(r)},i:function(n){e||(K(t.$$.fragment,n),e=!0)},o:function(n){$(t.$$.fragment,n),e=!1},d:function(n){ot(t,n)}};return x("SvelteRegisterBlock",{block:l,id:Jt.name,type:"else",source:"(495:10) {:else}",ctx:c}),l}function Zt(c){let t,e;t=new qt({props:{href:c[9].path,variant:"primary",size:"lg",fullWidth:!0,$$slots:{default:[Yt]},$$scope:{ctx:c}},$$inline:!0});const l={c:function(){lt(t.$$.fragment)},l:function(n){st(t.$$.fragment,n)},m:function(n,i){it(t,n,i),e=!0},p:function(n,i){const r={};i&8388608&&(r.$$scope={dirty:i,ctx:n}),t.$set(r)},i:function(n){e||(K(t.$$.fragment,n),e=!0)},o:function(n){$(t.$$.fragment,n),e=!1},d:function(n){ot(t,n)}};return x("SvelteRegisterBlock",{block:l,id:Zt.name,type:"if",source:"(486:10) {#if startButtonEnabled}",ctx:c}),l}function Kt(c){let t;const e={c:function(){t=X("マイクテスト完了後に開始")},l:function(o){t=Q(o,"マイクテスト完了後に開始")},m:function(o,n){E(o,t,n)},d:function(o){o&&m(t)}};return x("SvelteRegisterBlock",{block:e,id:Kt.name,type:"slot",source:'(496:12) <Button                variant=\\"disabled\\"                size=\\"lg\\"                fullWidth                disabled             >',ctx:c}),e}function Yt(c){let t;const e={c:function(){t=X("トレーニング開始")},l:function(o){t=Q(o,"トレーニング開始")},m:function(o,n){E(o,t,n)},d:function(o){o&&m(t)}};return x("SvelteRegisterBlock",{block:e,id:Yt.name,type:"slot",source:'(487:12) <Button                href={selectedMode.path}                variant=\\"primary\\"                size=\\"lg\\"                fullWidth             >',ctx:c}),e}function Qt(c){let t,e,l=c[9].name+"",o,n,i,r=c[9].description+"",u,d,s,a,y;const w=[Zt,Jt],b=[];function S(R,D){return R[8]?0:1}s=S(c),a=b[s]=w[s](c);const L={c:function(){t=k("div"),e=k("h3"),o=X(l),n=H(),i=k("p"),u=X(r),d=H(),a.c(),this.h()},l:function(D){t=p(D,"DIV",{class:!0});var B=z(t);e=p(B,"H3",{class:!0});var C=z(e);o=Q(C,l),C.forEach(m),n=N(B),i=p(B,"P",{class:!0});var A=z(i);u=Q(A,r),A.forEach(m),d=N(B),a.l(B),B.forEach(m),this.h()},h:function(){v(e,"class","start-title svelte-ztuqv4"),_(e,g,480,10,14742),v(i,"class","start-description svelte-ztuqv4"),_(i,g,481,10,14801),v(t,"class","start-content svelte-ztuqv4"),_(t,g,479,8,14704)},m:function(D,B){E(D,t,B),h(t,e),h(e,o),h(t,n),h(t,i),h(i,u),h(t,d),b[s].m(t,null),y=!0},p:function(D,B){let C=s;s=S(D),s===C?b[s].p(D,B):(Pt(),$(b[C],1,1,()=>{b[C]=null}),At(),a=b[s],a?a.p(D,B):(a=b[s]=w[s](D),a.c()),K(a,1),a.m(t,null))},i:function(D){y||(K(a),y=!0)},o:function(D){$(a),y=!1},d:function(D){D&&m(t),b[s].d()}};return x("SvelteRegisterBlock",{block:L,id:Qt.name,type:"slot",source:'(479:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:c}),L}function Xt(c){let t,e,l,o,n,i,r,u,d,s,a,y,w="マイクテスト",b,S,L="音感トレーニングを始める前に、マイクの動作を確認します",R,D,B,C,A,V,T;B=new _t({props:{variant:"default",padding:"lg",$$slots:{default:[Ut]},$$scope:{ctx:c}},$$inline:!0}),V=new _t({props:{variant:"default",padding:"lg",$$slots:{default:[Qt]},$$scope:{ctx:c}},$$inline:!0});const j={c:function(){t=k("div"),e=k("div"),l=k("div"),o=k("div"),n=at("svg"),i=at("path"),r=at("path"),u=at("line"),d=at("line"),s=H(),a=k("div"),y=k("h1"),y.textContent=w,b=H(),S=k("p"),S.textContent=L,R=H(),D=k("div"),lt(B.$$.fragment),C=H(),A=k("div"),lt(V.$$.fragment),this.h()},l:function(I){t=p(I,"DIV",{class:!0});var M=z(t);e=p(M,"DIV",{class:!0});var F=z(e);l=p(F,"DIV",{class:!0});var f=z(l);o=p(f,"DIV",{class:!0});var Z=z(o);n=rt(Z,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var J=z(n);i=rt(J,"path",{d:!0}),z(i).forEach(m),r=rt(J,"path",{d:!0}),z(r).forEach(m),u=rt(J,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),z(u).forEach(m),d=rt(J,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),z(d).forEach(m),J.forEach(m),Z.forEach(m),s=N(f),a=p(f,"DIV",{});var W=z(a);y=p(W,"H1",{class:!0,"data-svelte-h":!0}),G(y)!=="svelte-z7m4lk"&&(y.textContent=w),b=N(W),S=p(W,"P",{class:!0,"data-svelte-h":!0}),G(S)!=="svelte-1vtv92f"&&(S.textContent=L),W.forEach(m),f.forEach(m),F.forEach(m),R=N(M),D=p(M,"DIV",{class:!0});var P=z(D);st(B.$$.fragment,P),P.forEach(m),C=N(M),A=p(M,"DIV",{class:!0});var ct=z(A);st(V.$$.fragment,ct),ct.forEach(m),M.forEach(m),this.h()},h:function(){v(i,"d","M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"),_(i,g,376,12,10617),v(r,"d","M19 10v2a7 7 0 0 1-14 0v-2"),_(r,g,377,12,10694),v(u,"x1","12"),v(u,"x2","12"),v(u,"y1","19"),v(u,"y2","22"),_(u,g,378,12,10745),v(d,"x1","8"),v(d,"x2","16"),v(d,"y1","22"),v(d,"y2","22"),_(d,g,379,12,10797),v(n,"width","48"),v(n,"height","48"),v(n,"viewBox","0 0 24 24"),v(n,"fill","none"),v(n,"stroke","currentColor"),v(n,"stroke-width","2"),_(n,g,375,10,10505),v(o,"class","mic-icon svelte-ztuqv4"),_(o,g,374,8,10472),v(y,"class","mic-test-title svelte-ztuqv4"),_(y,g,383,10,10892),v(S,"class","mic-test-description svelte-ztuqv4"),_(S,g,384,10,10941),_(a,g,382,8,10876),v(l,"class","mic-test-header svelte-ztuqv4"),_(l,g,373,6,10434),v(e,"class","header svelte-ztuqv4"),_(e,g,372,4,10407),v(D,"class","test-section"),_(D,g,390,4,11074),v(A,"class","start-section"),_(A,g,477,4,14624),v(t,"class","microphone-test svelte-ztuqv4"),_(t,g,370,2,10355)},m:function(I,M){E(I,t,M),h(t,e),h(e,l),h(l,o),h(o,n),h(n,i),h(n,r),h(n,u),h(n,d),h(l,s),h(l,a),h(a,y),h(a,b),h(a,S),h(t,R),h(t,D),it(B,D,null),h(t,C),h(t,A),it(V,A,null),T=!0},p:function(I,M){const F={};M&8388863&&(F.$$scope={dirty:M,ctx:I}),B.$set(F);const f={};M&8388864&&(f.$$scope={dirty:M,ctx:I}),V.$set(f)},i:function(I){T||(K(B.$$.fragment,I),K(V.$$.fragment,I),T=!0)},o:function(I){$(B.$$.fragment,I),$(V.$$.fragment,I),T=!1},d:function(I){I&&m(t),ot(B),ot(V)}};return x("SvelteRegisterBlock",{block:j,id:Xt.name,type:"slot",source:"(370:0) <PageLayout showBackButton={true}>",ctx:c}),j}function bt(c){let t,e,l;e=new Ft({props:{showBackButton:!0,$$slots:{default:[Xt]},$$scope:{ctx:c}},$$inline:!0});const o={c:function(){t=H(),lt(e.$$.fragment),this.h()},l:function(i){le("svelte-8st1fo",document.head).forEach(m),t=N(i),st(e.$$.fragment,i),this.h()},h:function(){document.title="マイクテスト - 相対音感トレーニング"},m:function(i,r){E(i,t,r),it(e,i,r),l=!0},p:function(i,[r]){const u={};r&8389119&&(u.$$scope={dirty:r,ctx:i}),e.$set(u)},i:function(i){l||(K(e.$$.fragment,i),l=!0)},o:function(i){$(e.$$.fragment,i),l=!1},d:function(i){i&&m(t),ot(e,i)}};return x("SvelteRegisterBlock",{block:o,id:bt.name,type:"component",source:"",ctx:c}),o}const wt=5;function St(c){if(c<=0)return"C4（ド4）";const e=Math.round(12*Math.log2(c/440)),l=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],o=((e+9)%12+12)%12,n=Math.floor((e+9)/12)+4,i=l[o];return`${i}${n}（${{C:"ド","C#":"ド#",D:"レ","D#":"レ#",E:"ミ",F:"ファ","F#":"ファ#",G:"ソ","G#":"ソ#",A:"ラ","A#":"ラ#",B:"シ"}[i]}${n}）`}function Vt(c,t){let e=0;for(let s=0;s<c.length;s++)e+=c[s]*c[s];if(e=Math.sqrt(e/c.length),e<.01)return 0;const l=$t(c,t,70),o=Math.floor(t/800),n=Math.floor(t/70);let i=0,r=0,u=0;for(let s=o;s<=n;s++){let a=0,y=0;for(let w=0;w<l.length-s;w++)a+=l[w]*l[w+s],y+=l[w]*l[w];y>0&&(a=a/Math.sqrt(y),a>i?(u=i,i=a,r=s):a>u&&(u=a))}const d=i-u;if(i>.3&&d>.05&&r>0){const s=Math.min(1,i*d*2);return{frequency:t/r,confidence:s}}return{frequency:0,confidence:0}}function $t(c,t,e){const l=1/t,o=1/(e*2*Math.PI),n=o/(o+l),i=new Float32Array(c.length);i[0]=c[0];for(let r=1;r<c.length;r++)i[r]=n*(i[r-1]+c[r]-c[r-1]);return i}function It(c){if(c.length===0)return 0;if(c.length===1)return c[0];const t=[...c].sort((i,r)=>i-r),e=t[Math.floor(t.length/2)],l=c.filter(i=>Math.abs(i-e)/e<.1);if(l.length===0)return e;let o=0,n=0;for(let i=0;i<l.length;i++){const r=i+1;o+=l[i]*r,n+=r}return o/n}function ue(c,t,e){let l,o;oe(mt,"page"),ie(c,mt,f=>e(18,o=f));let{$$slots:n={},$$scope:i}=t;se("Page",n,[]);let r="random";vt(()=>{o.url.searchParams.has("mode")&&(r=o.url.searchParams.get("mode")||"random")});let u="pending",d=!1,s=!1,a=0,y=0,w="",b=!1,S=0,L=[];const R={random:{name:"ランダム基音モード",description:"10種類の基音からランダムに選択してトレーニング",color:"green",path:"./training/random"},continuous:{name:"連続チャレンジモード",description:"選択した回数だけ連続で実行し、総合評価を確認",color:"orange",path:"./training/continuous"},chromatic:{name:"12音階モード",description:"クロマチックスケールの上行・下行で完全制覇",color:"purple",path:"./training/chromatic"}},D=R[r]||R.random;async function B(){console.log("マイク許可リクエスト開始"),e(0,u="pending");try{const f=await navigator.mediaDevices.getUserMedia({audio:!0});console.log("マイク許可取得成功"),e(0,u="granted"),f.getTracks().forEach(Z=>Z.stop()),console.log("リスニング開始準備中..."),setTimeout(()=>{O()},500)}catch(f){console.error("マイク許可エラー:",f),e(0,u="denied")}}let C=null,A=null,V=null,T=null,j=null;async function O(){if(console.log("startListening 開始, micPermission:",u),u!=="granted"){console.log("マイク許可がありません");return}try{console.log("Web Audio Context 作成中..."),C=new(window.AudioContext||window.webkitAudioContext),C.state==="suspended"&&(console.log("AudioContext suspended - resuming..."),await C.resume()),console.log("マイクアクセス開始..."),A=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}}),console.log("アナライザー設定中..."),V=C.createAnalyser(),V.fftSize=2048,V.smoothingTimeConstant=.8,C.createMediaStreamSource(A).connect(V);const Z=V.frequencyBinCount;T=new Uint8Array(Z),e(6,b=!0),console.log("リアルタイム解析開始"),I()}catch(f){console.error("マイクアクセスエラー:",f),e(0,u="error")}}function I(){if(!b||!V){console.log("解析停止: isListening=",b,"analyser=",!!V);return}V.getByteFrequencyData(T);let f=0;for(let P=0;P<T.length;P++)f+=T[P]*T[P];const Z=Math.sqrt(f/T.length);e(3,a=Math.min(100,Z/128*100)),a>20&&(d||console.log("音量検出成功:",a),e(1,d=!0));const J=new Float32Array(V.fftSize);V.getFloatTimeDomainData(J);const W=Vt(J,C.sampleRate);if(W.frequency>0){L.push(W.frequency),L.length>wt&&L.shift();const P=It(L);e(4,y=P),e(5,w=St(y)),e(7,S=Math.round(W.confidence*100)),y>80&&y<800&&(s||console.log("周波数検出成功:",y,"Hz",w),e(2,s=!0))}else L=[],e(4,y=0),e(5,w=""),e(7,S=0);j=requestAnimationFrame(I)}function M(){e(6,b=!1),j&&(cancelAnimationFrame(j),j=null),A&&(A.getTracks().forEach(f=>f.stop()),A=null),C&&C.state!=="closed"&&(C.close(),C=null),V=null,T=null}Et(()=>{M()}),vt(()=>{setTimeout(()=>{B()},500)});const F=[];return Object.keys(t).forEach(f=>{!~F.indexOf(f)&&f.slice(0,2)!=="$$"&&f!=="slot"&&ae.warn(`<Page> was created with unknown prop '${f}'`)}),c.$capture_state=()=>({onMount:vt,onDestroy:Et,page:mt,Card:_t,Button:qt,PageLayout:Ft,VolumeBar:Rt,PitchDisplay:re,mode:r,micPermission:u,volumeDetected:d,frequencyDetected:s,currentVolume:a,currentFrequency:y,currentNote:w,isListening:b,detectionConfidence:S,frequencyHistory:L,HISTORY_SIZE:wt,trainingModes:R,selectedMode:D,frequencyToNote:St,requestMicrophone:B,audioContext:C,mediaStream:A,analyser:V,dataArray:T,animationFrame:j,startListening:O,analyzeAudio:I,detectPitchWithAutocorrelation:Vt,applyHighPassFilter:$t,smoothFrequency:It,stopListening:M,startButtonEnabled:l,$page:o}),c.$inject_state=f=>{"mode"in f&&(r=f.mode),"micPermission"in f&&e(0,u=f.micPermission),"volumeDetected"in f&&e(1,d=f.volumeDetected),"frequencyDetected"in f&&e(2,s=f.frequencyDetected),"currentVolume"in f&&e(3,a=f.currentVolume),"currentFrequency"in f&&e(4,y=f.currentFrequency),"currentNote"in f&&e(5,w=f.currentNote),"isListening"in f&&e(6,b=f.isListening),"detectionConfidence"in f&&e(7,S=f.detectionConfidence),"frequencyHistory"in f&&(L=f.frequencyHistory),"audioContext"in f&&(C=f.audioContext),"mediaStream"in f&&(A=f.mediaStream),"analyser"in f&&(V=f.analyser),"dataArray"in f&&(T=f.dataArray),"animationFrame"in f&&(j=f.animationFrame),"startButtonEnabled"in f&&e(8,l=f.startButtonEnabled)},t&&"$$inject"in t&&c.$inject_state(t.$$inject),c.$$.update=()=>{c.$$.dirty&7&&e(8,l=u==="granted"&&d&&s)},[u,d,s,a,y,w,b,S,l,D,B]}class ge extends te{constructor(t){super(t),ee(this,t,ue,bt,ne,{}),x("SvelteRegisterComponent",{component:this,tagName:"Page",options:t,id:bt.name})}}export{ge as component};
