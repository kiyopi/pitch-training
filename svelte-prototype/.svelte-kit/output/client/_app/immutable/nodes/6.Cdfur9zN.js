const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/DzFNKnhn.js","../chunks/Be0szi1F.js","../chunks/CzYZU643.js","../chunks/D0QH3NT1.js","../chunks/CGE1Ttke.js","../assets/sessionStorage.BHSgymFr.css"])))=>i.map(i=>d[i]);
import{_ as In}from"../chunks/C1FmrZbK.js";import{S as en,i as tn,s as nn,d as se,a0 as at,a as sn,a1 as Nn,D as Es,q as ge,r as ee,u as U,w as he,x as pe,y as ye,E as Is,F as Ns,G as Ps,Q as Xe,Y as Pn,b as v,T as rn,e as Ee,z as q,K as Ie,L as Ne,f as Y,g as y,h as k,j as M,k as B,l as te,m as K,A as ve,o as C,t as ne,p as X,M as Ge,v as Be,c as Le,H as xn,Z as zn,J as xs,N as Ve,n as Xn}from"../chunks/Be0szi1F.js";import{g as zs}from"../chunks/D0QH3NT1.js";import"../chunks/CzYZU643.js";import{b as dt,g as St}from"../chunks/CGE1Ttke.js";import{p as bt}from"../chunks/BTQHM1s2.js";import{P as Qn,B as ft,C as Qe}from"../chunks/iHfyItqC.js";import{l as le,a as Ze,h as Dt,P as Yn,b as $n,V as Hs}from"../chunks/CA7GL6z4.js";import{I as es,w as Bs,x as Ls,y as Hn,Z as Bn,z as Ln,B as Vn,l as wt,s as st,d as Vs,r as js,e as jn,u as _t,f as Os,g as At,p as Gs,o as Ws,h as Us,j as kt,i as Mt,k as Zs,m as Ct,a as Rt,n as qt,c as Ft,t as Tt,E as rt,A as on,U as an,D as Js,F as Ks,G as Xs,H as Qs,T as Ys,P as $s,M as ts,C as er,S as tr,J as Et}from"../chunks/DzFNKnhn.js";function ns(a){let e;const t=a[2].default,n=Es(t,a,a[3],null),s={c:function(){n&&n.c()},l:function(o){n&&n.l(o)},m:function(o,i){n&&n.m(o,i),e=!0},p:function(o,i){n&&n.p&&(!e||i&8)&&Is(n,t,o,o[3],e?Ps(t,o[3],i,null):Ns(o[3]),null)},i:function(o){e||(U(n,o),e=!0)},o:function(o){ee(n,o),e=!1},d:function(o){n&&n.d(o)}};return se("SvelteRegisterBlock",{block:s,id:ns.name,type:"slot",source:'(36:0) <Icon name=\\"navigation\\" {...$$props} iconNode={iconNode}>',ctx:a}),s}function Pt(a){let e,t;const n=[{name:"navigation"},a[1],{iconNode:a[0]}];let s={$$slots:{default:[ns]},$$scope:{ctx:a}};for(let o=0;o<n.length;o+=1)s=at(s,n[o]);e=new es({props:s,$$inline:!0});const r={c:function(){ye(e.$$.fragment)},l:function(i){pe(e.$$.fragment,i)},m:function(i,d){he(e,i,d),t=!0},p:function(i,[d]){const l=d&3?Bs(n,[n[0],d&2&&Ls(i[1]),d&1&&{iconNode:i[0]}]):{};d&8&&(l.$$scope={dirty:d,ctx:i}),e.$set(l)},i:function(i){t||(U(e.$$.fragment,i),t=!0)},o:function(i){ee(e.$$.fragment,i),t=!1},d:function(i){ge(e,i)}};return se("SvelteRegisterBlock",{block:r,id:Pt.name,type:"component",source:"",ctx:a}),r}function nr(a,e,t){let{$$slots:n={},$$scope:s}=e;sn("Navigation",n,["default"]);const r=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11"}]];return a.$$set=o=>{t(1,e=at(at({},e),Nn(o))),"$$scope"in o&&t(3,s=o.$$scope)},a.$capture_state=()=>({Icon:es,iconNode:r}),a.$inject_state=o=>{t(1,e=at(at({},e),o))},e&&"$$inject"in e&&a.$inject_state(e.$$inject),e=Nn(e),[r,e,n,s]}class On extends en{constructor(e){super(e),tn(this,e,nr,Pt,nn,{}),se("SvelteRegisterComponent",{component:this,tagName:"Navigation",options:e,id:Pt.name})}}const fe="src/lib/components/scoring/ScoreResultPanel.svelte";function Gn(a,e,t){const n=a.slice();return n[7]=e[t],n}function xt(a){let e,t,n,s,r,o,i=a[7].name+"",d,l,u,f,h=a[7].weight+"",m,p,S,A,L=(a[2][a[7].key]||0)+"",E,w,T,R,O,b;var _=a[7].icon;function z(I,N){return{props:{class:"w-5 h-5 text-gray-600"},$$inline:!0}}_&&(s=Pn(_,z()));const x={c:function(){e=C("div"),t=C("div"),n=C("div"),s&&ye(s.$$.fragment),r=X(),o=C("span"),d=ne(i),l=X(),u=C("span"),f=ne("("),m=ne(h),p=ne("%)"),S=X(),A=C("span"),E=ne(L),w=X(),T=C("div"),R=C("div"),O=X(),this.h()},l:function(N){e=M(N,"DIV",{class:!0});var D=B(e);t=M(D,"DIV",{class:!0});var G=B(t);n=M(G,"DIV",{class:!0});var J=B(n);s&&pe(s.$$.fragment,J),r=K(J),o=M(J,"SPAN",{class:!0});var P=B(o);d=te(P,i),P.forEach(v),l=K(J),u=M(J,"SPAN",{class:!0});var W=B(u);f=te(W,"("),m=te(W,h),p=te(W,"%)"),W.forEach(v),J.forEach(v),S=K(G),A=M(G,"SPAN",{class:!0});var j=B(A);E=te(j,L),j.forEach(v),G.forEach(v),w=K(D),T=M(D,"DIV",{class:!0});var $=B(T);R=M($,"DIV",{class:!0,style:!0}),B(R).forEach(v),$.forEach(v),O=K(D),D.forEach(v),this.h()},h:function(){q(o,"class","font-medium text-gray-700"),k(o,fe,63,14,2916),q(u,"class","text-xs text-gray-500"),k(u,fe,64,14,2991),q(n,"class","flex items-center gap-2"),k(n,fe,61,12,2780),q(A,"class","font-bold text-lg text-gray-800"),k(A,fe,66,12,3084),q(t,"class","flex items-center justify-between mb-1"),k(t,fe,60,10,2715),q(R,"class","bg-gradient-to-r from-blue-400 to-blue-600 h-2 rounded-full transition-all duration-500"),Ge(R,"width",(a[2][a[7].key]||0)+"%"),k(R,fe,71,12,3289),q(T,"class","w-full bg-gray-200 rounded-full h-2"),k(T,fe,70,10,3227),q(e,"class","scoring-aspect svelte-1eorlgc"),k(e,fe,59,8,2676)},m:function(N,D){Y(N,e,D),y(e,t),y(t,n),s&&he(s,n,null),y(n,r),y(n,o),y(o,d),y(n,l),y(n,u),y(u,f),y(u,m),y(u,p),y(t,S),y(t,A),y(A,E),y(e,w),y(e,T),y(T,R),y(e,O),b=!0},p:function(N,D){if(_!==(_=N[7].icon)){if(s){Ie();const G=s;ee(G.$$.fragment,1,0,()=>{ge(G,1)}),Ne()}_?(s=Pn(_,z()),ye(s.$$.fragment),U(s.$$.fragment,1),he(s,n,r)):s=null}(!b||D&4)&&L!==(L=(N[2][N[7].key]||0)+"")&&Ee(E,L),(!b||D&4)&&Ge(R,"width",(N[2][N[7].key]||0)+"%")},i:function(N){b||(s&&U(s.$$.fragment,N),b=!0)},o:function(N){s&&ee(s.$$.fragment,N),b=!1},d:function(N){N&&v(e),s&&ge(s)}};return se("SvelteRegisterBlock",{block:x,id:xt.name,type:"each",source:"(59:6) {#each scoringAspects as aspect}",ctx:a}),x}function zt(a){let e,t,n,s,r,o,i,d,l,u,f="ç‚¹",h,m,p,S,A,L,E="ã‚°ãƒ¬ãƒ¼ãƒ‰",w,T,R,O,b="æ¡ç‚¹è©³ç´°",_,z,x,I,N=Xe(a[5]),D=[];for(let P=0;P<N.length;P+=1)D[P]=xt(Gn(a,N,P));const G=P=>ee(D[P],1,1,()=>{D[P]=null}),J={c:function(){e=C("div"),t=C("div"),n=C("div"),s=C("div"),r=C("div"),o=C("div"),i=ne(a[0]),l=X(),u=C("div"),u.textContent=f,h=X(),m=C("div"),p=C("div"),S=ne(a[1]),A=X(),L=C("div"),L.textContent=E,T=X(),R=C("div"),O=C("h3"),O.textContent=b,_=X(),z=C("div");for(let W=0;W<D.length;W+=1)D[W].c();this.h()},l:function(W){e=M(W,"DIV",{class:!0});var j=B(e);t=M(j,"DIV",{class:!0});var $=B(t);n=M($,"DIV",{class:!0});var ae=B(n);s=M(ae,"DIV",{class:!0});var De=B(s);r=M(De,"DIV",{class:!0});var _e=B(r);o=M(_e,"DIV",{class:!0});var Pe=B(o);i=te(Pe,a[0]),Pe.forEach(v),l=K(_e),u=M(_e,"DIV",{class:!0,"data-svelte-h":!0}),ve(u)!=="svelte-tq02xs"&&(u.textContent=f),_e.forEach(v),De.forEach(v),h=K(ae),m=M(ae,"DIV",{class:!0});var Se=B(m);p=M(Se,"DIV",{class:!0});var Ae=B(p);S=te(Ae,a[1]),Ae.forEach(v),A=K(Se),L=M(Se,"DIV",{class:!0,"data-svelte-h":!0}),ve(L)!=="svelte-1varsz0"&&(L.textContent=E),Se.forEach(v),ae.forEach(v),$.forEach(v),T=K(j),R=M(j,"DIV",{class:!0});var Ce=B(R);O=M(Ce,"H3",{class:!0,"data-svelte-h":!0}),ve(O)!=="svelte-1qj7xji"&&(O.textContent=b),_=K(Ce),z=M(Ce,"DIV",{class:!0});var ke=B(z);for(let Re=0;Re<D.length;Re+=1)D[Re].l(ke);ke.forEach(v),Ce.forEach(v),j.forEach(v),this.h()},h:function(){q(o,"class",d="text-5xl font-bold "+a[4].text+" svelte-1eorlgc"),k(o,fe,43,10,2168),q(u,"class","text-sm text-gray-600"),k(u,fe,44,10,2247),q(r,"class","text-center"),k(r,fe,42,8,2132),q(s,"class","inline-flex items-center justify-center w-32 h-32 bg-white rounded-full shadow-lg mb-4"),k(s,fe,41,6,2023),q(p,"class","text-4xl font-bold mb-2"),k(p,fe,48,8,2357),q(L,"class","text-lg opacity-90"),k(L,fe,49,8,2416),q(m,"class","text-white"),k(m,fe,47,6,2324),q(n,"class","text-center"),k(n,fe,40,4,1991),q(t,"class",w="bg-gradient-to-r "+a[4].bg+" p-6 svelte-1eorlgc"),k(t,fe,39,2,1936),q(O,"class","text-lg font-semibold text-gray-800 mb-4"),k(O,fe,56,4,2538),q(z,"class","space-y-3"),k(z,fe,57,4,2605),q(R,"class","p-6"),k(R,fe,55,2,2516),q(e,"class",x="score-result-panel "+a[3]+" bg-white rounded-xl shadow-lg overflow-hidden svelte-1eorlgc"),k(e,fe,37,0,1821)},m:function(W,j){Y(W,e,j),y(e,t),y(t,n),y(n,s),y(s,r),y(r,o),y(o,i),y(r,l),y(r,u),y(n,h),y(n,m),y(m,p),y(p,S),y(m,A),y(m,L),y(e,T),y(e,R),y(R,O),y(R,_),y(R,z);for(let $=0;$<D.length;$+=1)D[$]&&D[$].m(z,null);I=!0},p:function(W,[j]){if((!I||j&1)&&Ee(i,W[0]),(!I||j&16&&d!==(d="text-5xl font-bold "+W[4].text+" svelte-1eorlgc"))&&q(o,"class",d),(!I||j&2)&&Ee(S,W[1]),(!I||j&16&&w!==(w="bg-gradient-to-r "+W[4].bg+" p-6 svelte-1eorlgc"))&&q(t,"class",w),j&36){N=Xe(W[5]);let $;for($=0;$<N.length;$+=1){const ae=Gn(W,N,$);D[$]?(D[$].p(ae,j),U(D[$],1)):(D[$]=xt(ae),D[$].c(),U(D[$],1),D[$].m(z,null))}for(Ie(),$=N.length;$<D.length;$+=1)G($);Ne()}(!I||j&8&&x!==(x="score-result-panel "+W[3]+" bg-white rounded-xl shadow-lg overflow-hidden svelte-1eorlgc"))&&q(e,"class",x)},i:function(W){if(!I){for(let j=0;j<N.length;j+=1)U(D[j]);I=!0}},o:function(W){D=D.filter(Boolean);for(let j=0;j<D.length;j+=1)ee(D[j]);I=!1},d:function(W){W&&v(e),rn(D,W)}};return se("SvelteRegisterBlock",{block:J,id:zt.name,type:"component",source:"",ctx:a}),J}function sr(a,e,t){let n,{$$slots:s={},$$scope:r}=e;sn("ScoreResultPanel",s,[]);let{totalScore:o=0}=e,{grade:i="C"}=e,{componentScores:d={}}=e,{className:l=""}=e;const u=m=>{const p={S:{bg:"from-yellow-400 to-yellow-600",text:"text-yellow-900",shadow:"shadow-yellow-200"},"A+":{bg:"from-green-400 to-green-600",text:"text-green-900",shadow:"shadow-green-200"},A:{bg:"from-green-500 to-green-700",text:"text-green-900",shadow:"shadow-green-200"},"B+":{bg:"from-blue-400 to-blue-600",text:"text-blue-900",shadow:"shadow-blue-200"},B:{bg:"from-blue-500 to-blue-700",text:"text-blue-900",shadow:"shadow-blue-200"},"C+":{bg:"from-orange-400 to-orange-600",text:"text-orange-900",shadow:"shadow-orange-200"},C:{bg:"from-orange-500 to-orange-700",text:"text-orange-900",shadow:"shadow-orange-200"},"D+":{bg:"from-red-400 to-red-600",text:"text-red-900",shadow:"shadow-red-200"},D:{bg:"from-red-500 to-red-700",text:"text-red-900",shadow:"shadow-red-200"},F:{bg:"from-gray-400 to-gray-600",text:"text-gray-900",shadow:"shadow-gray-200"}};return p[m]||p.C},f=[{key:"pitchAccuracy",name:"éŸ³ç¨‹ç²¾åº¦",icon:Hn,weight:40},{key:"recognitionSpeed",name:"èªè­˜é€Ÿåº¦",icon:Bn,weight:20},{key:"intervalMastery",name:"éŸ³ç¨‹ç¿’å¾—",icon:Ln,weight:20},{key:"directionAccuracy",name:"æ–¹å‘ç²¾åº¦",icon:On,weight:10},{key:"consistency",name:"ä¸€è²«æ€§",icon:Vn,weight:10}],h=["totalScore","grade","componentScores","className"];return Object.keys(e).forEach(m=>{!~h.indexOf(m)&&m.slice(0,2)!=="$$"&&m!=="slot"&&console.warn(`<ScoreResultPanel> was created with unknown prop '${m}'`)}),a.$$set=m=>{"totalScore"in m&&t(0,o=m.totalScore),"grade"in m&&t(1,i=m.grade),"componentScores"in m&&t(2,d=m.componentScores),"className"in m&&t(3,l=m.className)},a.$capture_state=()=>({Target:Hn,Zap:Bn,BarChart3:Ln,Navigation:On,Activity:Vn,totalScore:o,grade:i,componentScores:d,className:l,getGradeStyle:u,scoringAspects:f,gradeStyle:n}),a.$inject_state=m=>{"totalScore"in m&&t(0,o=m.totalScore),"grade"in m&&t(1,i=m.grade),"componentScores"in m&&t(2,d=m.componentScores),"className"in m&&t(3,l=m.className),"gradeStyle"in m&&t(4,n=m.gradeStyle)},e&&"$$inject"in e&&a.$inject_state(e.$$inject),a.$$.update=()=>{a.$$.dirty&2&&t(4,n=u(i))},[o,i,d,l,n,f]}class rr extends en{constructor(e){super(e),tn(this,e,sr,zt,nn,{totalScore:0,grade:1,componentScores:2,className:3}),se("SvelteRegisterComponent",{component:this,tagName:"ScoreResultPanel",options:e,id:zt.name})}get totalScore(){throw new Error("<ScoreResultPanel>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set totalScore(e){throw new Error("<ScoreResultPanel>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get grade(){throw new Error("<ScoreResultPanel>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set grade(e){throw new Error("<ScoreResultPanel>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get componentScores(){throw new Error("<ScoreResultPanel>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set componentScores(e){throw new Error("<ScoreResultPanel>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get className(){throw new Error("<ScoreResultPanel>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set className(e){throw new Error("<ScoreResultPanel>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const or=!1,ar=!1,br=Object.freeze(Object.defineProperty({__proto__:null,prerender:ar,ssr:or},Symbol.toStringTag,{value:"Module"}));class ss{constructor(){this.intervalTypes={unison:{name:"åŒåº¦",semitones:0,importance:.8,description:"åŸºéŸ³ã¨åŒã˜é«˜ã•",difficulty:"åŸºæœ¬",commonErrors:["å¾®ç´°ãªãƒ”ãƒƒãƒã®ãšã‚Œ"]},minorSecond:{name:"çŸ­2åº¦",semitones:1,importance:.9,description:"åŠéŸ³ä¸Š",difficulty:"é«˜",commonErrors:["é•·2åº¦ã¨ã®æ··åŒ","éŸ³ç¨‹å¹…ã®éå¤§è©•ä¾¡"]},majorSecond:{name:"é•·2åº¦",semitones:2,importance:1,description:"å…¨éŸ³ä¸Šï¼ˆãƒ‰ãƒ¬ï¼‰",difficulty:"åŸºæœ¬",commonErrors:["çŸ­2åº¦ã¨ã®æ··åŒ"]},minorThird:{name:"çŸ­3åº¦",semitones:3,importance:1,description:"çŸ­èª¿ã®3åº¦ï¼ˆãƒ‰ãƒŸâ™­ï¼‰",difficulty:"ä¸­",commonErrors:["é•·3åº¦ã¨ã®æ··åŒ"]},majorThird:{name:"é•·3åº¦",semitones:4,importance:1,description:"é•·èª¿ã®3åº¦ï¼ˆãƒ‰ãƒŸï¼‰",difficulty:"åŸºæœ¬",commonErrors:["çŸ­3åº¦ã¨ã®æ··åŒ","å®Œå…¨4åº¦ã¸ã®èª¤èª"]},perfectFourth:{name:"å®Œå…¨4åº¦",semitones:5,importance:.9,description:"å®‰å®šã—ãŸå”å’ŒéŸ³ç¨‹ï¼ˆãƒ‰ãƒ•ã‚¡ï¼‰",difficulty:"åŸºæœ¬",commonErrors:["é•·3åº¦ãƒ»æ¸›5åº¦ã¨ã®æ··åŒ"]},tritone:{name:"æ¸›5åº¦",semitones:6,importance:.7,description:"ä¸å®‰å®šãªéŸ³ç¨‹ï¼ˆãƒ‰ãƒ•ã‚¡#ï¼‰",difficulty:"é«˜",commonErrors:["å®Œå…¨4åº¦ãƒ»å®Œå…¨5åº¦ã¨ã®æ··åŒ"]},perfectFifth:{name:"å®Œå…¨5åº¦",semitones:7,importance:.9,description:"æœ€ã‚‚å®‰å®šã—ãŸéŸ³ç¨‹ï¼ˆãƒ‰ã‚½ï¼‰",difficulty:"åŸºæœ¬",commonErrors:["æ¸›5åº¦ãƒ»é•·6åº¦ã¨ã®æ··åŒ"]},minorSixth:{name:"çŸ­6åº¦",semitones:8,importance:.8,description:"çŸ­èª¿çš„è‰²å½©ï¼ˆãƒ‰ãƒ©â™­ï¼‰",difficulty:"ä¸­",commonErrors:["é•·6åº¦ãƒ»å®Œå…¨5åº¦ã¨ã®æ··åŒ"]},majorSixth:{name:"é•·6åº¦",semitones:9,importance:.8,description:"æ˜ã‚‹ã„éŸ¿ãï¼ˆãƒ‰ãƒ©ï¼‰",difficulty:"ä¸­",commonErrors:["çŸ­6åº¦ãƒ»çŸ­7åº¦ã¨ã®æ··åŒ"]},minorSeventh:{name:"çŸ­7åº¦",semitones:10,importance:.7,description:"å±7å’ŒéŸ³ã®7åº¦ï¼ˆãƒ‰ã‚·â™­ï¼‰",difficulty:"ä¸­",commonErrors:["é•·7åº¦ãƒ»é•·6åº¦ã¨ã®æ··åŒ"]},majorSeventh:{name:"é•·7åº¦",semitones:11,importance:.7,description:"é‹­ã„ä¸å”å’ŒéŸ³ç¨‹ï¼ˆãƒ‰ã‚·ï¼‰",difficulty:"é«˜",commonErrors:["çŸ­7åº¦ãƒ»8åº¦ã¨ã®æ··åŒ"]},octave:{name:"8åº¦",semitones:12,importance:.9,description:"1ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸Šï¼ˆãƒ‰ãƒ‰ï¼‰",difficulty:"åŸºæœ¬",commonErrors:["HarmonicCorrectionã«ã‚ˆã‚‹å€éŸ³èª¤æ¤œå‡º"]}},this.masteryData=new Map,this.analysisHistory=[],this.maxHistoryLength=100,this.debugMode=!0,this.initializeMasteryData(),this.log("ğŸµ IntervalAnalyzeråˆæœŸåŒ–å®Œäº†",{intervalCount:Object.keys(this.intervalTypes).length,masteryData:this.masteryData.size})}analyzeInterval(e,t,n){try{const s=this.calculateSemitones(e,t),r=this.identifyInterval(s),o=this.calculateSemitones(e,n),i=this.identifyInterval(o),d=this.calculateIntervalAccuracy(s,o);this.updateMastery(r.key,d);const l=this.getMastery(r.key),u={targetInterval:r,detectedInterval:i,targetSemitones:s,detectedSemitones:o,accuracy:d,mastery:l,masteryLevels:Object.fromEntries(this.masteryData),isCorrectInterval:r.key===i.key,feedback:this.generateIntervalFeedback(r,i,d),timestamp:Date.now()};return this.recordAnalysis(u),this.debugMode&&this.logAnalysisDetails(u),u}catch(s){return console.error("âŒ [IntervalAnalyzer] åˆ†æã‚¨ãƒ©ãƒ¼:",s),this.createErrorResult(e,t,n)}}calculateSemitones(e,t){return!e||!t||e<=0||t<=0?0:(12*Math.log2(t/e)%12+12)%12}identifyInterval(e){let t=null,n=1/0;for(const[s,r]of Object.entries(this.intervalTypes)){const o=Math.abs(e-r.semitones);o<n&&(n=o,t={key:s,...r,distance:o})}return t}calculateIntervalAccuracy(e,t){const n=Math.abs(e-t),s=Math.max(0,100-n*50);return Math.min(100,s)}updateMastery(e,t){this.masteryData.has(e)||this.masteryData.set(e,{attempts:0,totalAccuracy:0,averageAccuracy:0,bestAccuracy:0,recentAttempts:[],lastAttempt:null,trend:"stable"});const n=this.masteryData.get(e);n.attempts++,n.totalAccuracy+=t,n.averageAccuracy=n.totalAccuracy/n.attempts,n.bestAccuracy=Math.max(n.bestAccuracy,t),n.lastAttempt=Date.now(),n.recentAttempts.push(t),n.recentAttempts.length>10&&n.recentAttempts.shift(),n.trend=this.calculateTrend(n.recentAttempts),this.masteryData.set(e,n)}getMastery(e){const t=this.masteryData.get(e);if(!t)return{attempts:0,averageAccuracy:0,bestAccuracy:0,level:"beginner",progress:0};const n=this.determineMasteryLevel(t.averageAccuracy,t.attempts),s=Math.min(100,t.averageAccuracy*t.attempts/500);return{...t,level:n,progress:Math.round(s)}}determineMasteryLevel(e,t){return t<3?"beginner":e>=90&&t>=10?"master":e>=80&&t>=7?"advanced":e>=70&&t>=5?"intermediate":e>=50?"novice":"beginner"}calculateTrend(e){if(e.length<3)return"stable";const t=e.slice(-3),n=e.slice(-6,-3);if(n.length===0)return"stable";const s=t.reduce((i,d)=>i+d,0)/t.length,r=n.reduce((i,d)=>i+d,0)/n.length,o=s-r;return o>5?"improving":o<-5?"declining":"stable"}generateIntervalFeedback(e,t,n){const s=e.key===t.key;if(s&&n>=90)return`ğŸ¯ ${e.name}ã‚’å®Œç’§ã«èªè­˜ã—ã¾ã—ãŸï¼`;if(s&&n>=70)return`âœ… ${e.name}ã®èªè­˜ã¯æ­£ã—ã„ã§ã™ã€‚ç²¾åº¦ã‚’ä¸Šã’ã¦ã¿ã¾ã—ã‚‡ã†ã€‚`;if(s)return`ğŸ‘ ${e.name}ã‚’èªè­˜ã§ãã¦ã„ã¾ã™ã€‚ã‚‚ã†å°‘ã—æ­£ç¢ºã«ã€‚`;const r=this.analyzeIntervalError(e,t);return`âŒ ${e.name}ã§ã¯ãªã${t.name}ã¨èªè­˜ã•ã‚Œã¾ã—ãŸã€‚${r}`}analyzeIntervalError(e,t){const n=t.semitones-e.semitones;return Math.abs(n)===1?n>0?"å°‘ã—é«˜ã‚ã«æ­Œã£ã¦ã„ã¾ã™ã€‚":"å°‘ã—ä½ã‚ã«æ­Œã£ã¦ã„ã¾ã™ã€‚":Math.abs(n)<=2?"éŸ³ç¨‹å¹…ã®èª¿æ•´ãŒå¿…è¦ã§ã™ã€‚":Math.abs(n)>=6?"ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–é–¢ä¿‚ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚":"éŸ³ç¨‹ã®ç‰¹å¾´ã‚’æ„è­˜ã—ã¦ã¿ã¦ãã ã•ã„ã€‚"}getAllMasteryData(){const e={};for(const[t,n]of Object.entries(this.intervalTypes))e[t]={interval:n,mastery:this.getMastery(t)};return e}getWeakIntervals(e=3){return Object.entries(this.getAllMasteryData()).filter(([n,s])=>s.mastery.attempts>=2).sort((n,s)=>n[1].mastery.averageAccuracy-s[1].mastery.averageAccuracy).slice(0,e).map(([n,s])=>({key:n,name:s.interval.name,accuracy:s.mastery.averageAccuracy,attempts:s.mastery.attempts,improvement:this.generateImprovementTip(n,s)}))}getStrongIntervals(e=3){return Object.entries(this.getAllMasteryData()).filter(([n,s])=>s.mastery.attempts>=3).sort((n,s)=>s[1].mastery.averageAccuracy-n[1].mastery.averageAccuracy).slice(0,e).map(([n,s])=>({key:n,name:s.interval.name,accuracy:s.mastery.averageAccuracy,attempts:s.mastery.attempts,reason:this.generateStrengthReason(n,s)}))}generateImprovementTip(e,t){const n=t.interval;return t.mastery.trend==="improving"?`ğŸ“ˆ æ”¹å–„ä¸­ã§ã™ï¼${n.description}ã®ç‰¹å¾´ã‚’æ„è­˜ã—ã¦ç·´ç¿’ã‚’ç¶šã‘ã¾ã—ã‚‡ã†ã€‚`:n.commonErrors.length>0?`ğŸ’¡ ${n.commonErrors[0]}ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚`:`ğŸ¯ ${n.description}ã‚’æ„è­˜ã—ã¦ã€ã‚†ã£ãã‚Šã¨ç·´ç¿’ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚`}generateStrengthReason(e,t){const n=t.interval,s=t.mastery;return s.averageAccuracy>=95?`å®Œç’§ãªç²¾åº¦ã§${n.name}ã‚’èªè­˜ã§ãã¦ã„ã¾ã™ï¼`:s.trend==="improving"?`${n.name}ã®ç†è§£ãŒæ€¥é€Ÿã«å‘ä¸Šã—ã¦ã„ã¾ã™ã€‚`:`${n.name}ã®èªè­˜ãŒå®‰å®šã—ã¦ã„ã¾ã™ã€‚`}initializeMasteryData(){}recordAnalysis(e){this.analysisHistory.push(e),this.analysisHistory.length>this.maxHistoryLength&&this.analysisHistory.shift()}createErrorResult(e,t,n){return{targetInterval:{name:"ä¸æ˜",key:"unknown"},detectedInterval:{name:"ä¸æ˜",key:"unknown"},accuracy:0,mastery:{level:"beginner",progress:0},masteryLevels:Object.fromEntries(this.masteryData),isCorrectInterval:!1,feedback:"éŸ³ç¨‹åˆ†æã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",error:!0}}logAnalysisDetails(e){var t;console.group(`ğŸµ [IntervalAnalyzer] ${e.targetInterval.name}åˆ†æçµæœ`),console.log("ğŸ¯ éŸ³ç¨‹åˆ†æ:",{ç›®æ¨™:`${e.targetInterval.name} (${e.targetSemitones.toFixed(1)}ã‚»ãƒŸãƒˆãƒ¼ãƒ³)`,æ¤œå‡º:`${e.detectedInterval.name} (${e.detectedSemitones.toFixed(1)}ã‚»ãƒŸãƒˆãƒ¼ãƒ³)`,æ­£è§£:e.isCorrectInterval?"âœ…":"âŒ",ç²¾åº¦:`${e.accuracy.toFixed(1)}%`}),console.log("ğŸ“Š ç¿’å¾—çŠ¶æ³:",{ãƒ¬ãƒ™ãƒ«:e.mastery.level,è©¦è¡Œå›æ•°:e.mastery.attempts,å¹³å‡ç²¾åº¦:`${((t=e.mastery.averageAccuracy)==null?void 0:t.toFixed(1))||0}%`,é€²æ—:`${e.mastery.progress}%`,ãƒˆãƒ¬ãƒ³ãƒ‰:e.mastery.trend}),console.log("ğŸ’¬ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯:",e.feedback),console.groupEnd()}log(e,t=null){this.debugMode&&(t?console.log(`[IntervalAnalyzer] ${e}`,t):console.log(`[IntervalAnalyzer] ${e}`))}getStatistics(){return{totalAnalyses:this.analysisHistory.length,intervalTypes:Object.keys(this.intervalTypes).length,masteryLevels:Object.fromEntries(this.masteryData),sessionStartTime:this.sessionStartTime||Date.now()}}reset(){this.masteryData.clear(),this.analysisHistory=[],this.initializeMasteryData(),this.log("ğŸ”„ IntervalAnalyzer ãƒªã‚»ãƒƒãƒˆå®Œäº†")}}typeof window<"u"&&(window.IntervalAnalyzer=ss);class rs{constructor(){this.directions={ascending:{name:"ä¸Šè¡Œ",icon:"â†—ï¸",description:"åŸºéŸ³ã‚ˆã‚Šé«˜ã„éŸ³ç¨‹",color:"#10b981",commonErrors:["ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸‹èªè­˜ï¼ˆå€éŸ³åŠ¹æœï¼‰","éŸ³ç¨‹å¹…ã®éå°è©•ä¾¡","ç›®æ¨™éŸ³ç¨‹ã®æ‰‹å‰ã§åœæ­¢"]},descending:{name:"ä¸‹è¡Œ",icon:"â†˜ï¸",description:"åŸºéŸ³ã‚ˆã‚Šä½ã„éŸ³ç¨‹",color:"#3b82f6",commonErrors:["ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸Šèªè­˜ï¼ˆå€éŸ³åŠ¹æœï¼‰","éŸ³ç¨‹å¹…ã®éå¤§è©•ä¾¡","ç›®æ¨™éŸ³ç¨‹ã‚’é€šã‚Šè¶Šã™"]},unison:{name:"åŒéŸ³",icon:"â¡ï¸",description:"åŸºéŸ³ã¨åŒã˜é«˜ã•",color:"#6b7280",commonErrors:["å¾®ç´°ãªãƒ”ãƒƒãƒãšã‚Œ","å€éŸ³ã«ã‚ˆã‚‹èª¤èªè­˜"]}},this.directionMastery=new Map,this.analysisHistory=[],this.maxHistoryLength=50,this.debugMode=!0,this.thresholds={unison:.5,overshoot:1.5,significant:3},this.initializeDirectionMastery(),this.log("ğŸ§­ DirectionAnalyzeråˆæœŸåŒ–å®Œäº†",{directions:Object.keys(this.directions).length,thresholds:this.thresholds})}analyzeDirection(e,t,n){try{const s=this.determineDirection(e,t),r=this.calculateSemitones(e,t),o=this.determineDirection(e,n),i=this.calculateSemitones(e,n),d=s.key===o.key,l=this.analyzeOvershoot(r,i),u=this.calculateDirectionAccuracy(s.key,o.key,r,i);this.updateDirectionMastery(s.key,u,d);const f=this.getDirectionMastery(s.key),h={targetDirection:s,detectedDirection:o,targetSemitones:r,detectedSemitones:i,directionCorrect:d,accuracy:u,mastery:f,overshoot:l,feedback:this.generateDirectionFeedback(s,o,l,u),timestamp:Date.now()};return this.recordAnalysis(h),this.debugMode&&this.logAnalysisDetails(h),h}catch(s){return console.error("âŒ [DirectionAnalyzer] åˆ†æã‚¨ãƒ©ãƒ¼:",s),this.createErrorResult(e,t,n)}}determineDirection(e,t){const n=this.calculateSemitones(e,t);return Math.abs(n)<=this.thresholds.unison?{key:"unison",...this.directions.unison}:n>0?{key:"ascending",...this.directions.ascending}:{key:"descending",...this.directions.descending}}calculateSemitones(e,t){return!e||!t||e<=0||t<=0?0:12*Math.log2(t/e)}analyzeOvershoot(e,t){const n=t-e,s=Math.abs(n);let r="accurate",o="none";return s>=this.thresholds.overshoot&&(n>0?r="overshoot":r="undershoot",s>=this.thresholds.significant?o="severe":o="moderate"),{type:r,severity:o,difference:n,absDifference:s,percentage:s/Math.abs(e)*100}}calculateDirectionAccuracy(e,t,n,s){if(e!==t)return Math.max(0,30-Math.abs(s-n)*5);const r=Math.abs(s-n),o=Math.max(0,100-r*25);return Math.min(100,o)}updateDirectionMastery(e,t,n){this.directionMastery.has(e)||this.directionMastery.set(e,{attempts:0,correctAttempts:0,totalAccuracy:0,averageAccuracy:0,bestAccuracy:0,successRate:0,recentAttempts:[],recentCorrects:[],lastAttempt:null,trend:"stable"});const s=this.directionMastery.get(e);s.attempts++,n&&s.correctAttempts++,s.totalAccuracy+=t,s.averageAccuracy=s.totalAccuracy/s.attempts,s.bestAccuracy=Math.max(s.bestAccuracy,t),s.successRate=s.correctAttempts/s.attempts*100,s.lastAttempt=Date.now(),s.recentAttempts.push(t),s.recentCorrects.push(n),s.recentAttempts.length>10&&(s.recentAttempts.shift(),s.recentCorrects.shift()),s.trend=this.calculateDirectionTrend(s.recentCorrects),this.directionMastery.set(e,s)}getDirectionMastery(e){const t=this.directionMastery.get(e);if(!t)return{attempts:0,successRate:0,averageAccuracy:0,level:"beginner",progress:0};const n=this.determineDirectionLevel(t.successRate,t.attempts),s=Math.min(100,t.successRate*t.attempts/500);return{...t,level:n,progress:Math.round(s)}}determineDirectionLevel(e,t){return t<3?"beginner":e>=95&&t>=10?"master":e>=85&&t>=7?"advanced":e>=75&&t>=5?"intermediate":e>=60?"novice":"beginner"}calculateDirectionTrend(e){if(e.length<5)return"stable";const t=e.slice(-3),n=e.slice(-6,-3);if(n.length===0)return"stable";const s=t.filter(Boolean).length/t.length,r=n.filter(Boolean).length/n.length,o=s-r;return o>.2?"improving":o<-.2?"declining":"stable"}generateDirectionFeedback(e,t,n,s){const r=e.key===t.key;return r&&s>=90?`ğŸ¯ ${e.name}ã®æ–¹å‘æ€§ãŒå®Œç’§ã§ã™ï¼`:r&&s>=70?`âœ… ${e.name}ã®æ–¹å‘ã¯æ­£ã—ã„ã§ã™ã€‚è·é›¢ã®èª¿æ•´ã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚`:r?n.type==="overshoot"?`ğŸ‘ ${e.name}ã®æ–¹å‘ã¯æ­£ã—ã„ã§ã™ãŒã€å°‘ã—æ­Œã„ã™ãã§ã™ã€‚`:n.type==="undershoot"?`ğŸ‘ ${e.name}ã®æ–¹å‘ã¯æ­£ã—ã„ã§ã™ãŒã€ã‚‚ã†å°‘ã—å¤§ããæ­Œã£ã¦ã¿ã¦ãã ã•ã„ã€‚`:`ğŸ‘ ${e.name}ã®æ–¹å‘ã¯èªè­˜ã§ãã¦ã„ã¾ã™ã€‚`:e.key==="ascending"&&t.key==="descending"?"âŒ ä¸Šè¡Œã®ã¤ã‚‚ã‚ŠãŒä¸‹è¡Œã«ãªã£ã¦ã„ã¾ã™ã€‚åŸºéŸ³ã‚ˆã‚Šé«˜ãæ­Œã£ã¦ãã ã•ã„ã€‚":e.key==="descending"&&t.key==="ascending"?"âŒ ä¸‹è¡Œã®ã¤ã‚‚ã‚ŠãŒä¸Šè¡Œã«ãªã£ã¦ã„ã¾ã™ã€‚åŸºéŸ³ã‚ˆã‚Šä½ãæ­Œã£ã¦ãã ã•ã„ã€‚":e.key!=="unison"&&t.key==="unison"?`âŒ éŸ³ç¨‹å¤‰åŒ–ãŒå°ã•ã™ãã¾ã™ã€‚${e.name}ã«ã‚ˆã‚Šå¤§ããæ­Œã£ã¦ãã ã•ã„ã€‚`:`âŒ ${e.name}ã§ã¯ãªã${t.name}ã¨èªè­˜ã•ã‚Œã¾ã—ãŸã€‚`}getAllDirectionMastery(){const e={};for(const[t,n]of Object.entries(this.directions))e[t]={direction:n,mastery:this.getDirectionMastery(t)};return e}getDirectionComparison(){const e=this.getDirectionMastery("ascending"),t=this.getDirectionMastery("descending");return{ascending:e,descending:t,comparison:{betterDirection:e.successRate>t.successRate?"ascending":"descending",difference:Math.abs(e.successRate-t.successRate),recommendation:this.generateDirectionRecommendation(e,t)}}}generateDirectionRecommendation(e,t){const n=e.successRate-t.successRate;return Math.abs(n)<10?"ä¸Šè¡Œãƒ»ä¸‹è¡Œã¨ã‚‚ã«ãƒãƒ©ãƒ³ã‚¹è‰¯ãç¿’å¾—ã§ãã¦ã„ã¾ã™ã€‚":n>10?"ä¸‹è¡Œã®ç·´ç¿’ã‚’é‡ç‚¹çš„ã«è¡Œã†ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚ä¸‹å‘ãã®éŸ³ç¨‹ã«ã‚ˆã‚Šæ„è­˜ã‚’å‘ã‘ã¦ã¿ã¦ãã ã•ã„ã€‚":"ä¸Šè¡Œã®ç·´ç¿’ã‚’é‡ç‚¹çš„ã«è¡Œã†ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚ä¸Šå‘ãã®éŸ³ç¨‹ã«ã‚ˆã‚Šæ„è­˜ã‚’å‘ã‘ã¦ã¿ã¦ãã ã•ã„ã€‚"}initializeDirectionMastery(){for(const e of Object.keys(this.directions))this.directionMastery.has(e)||this.directionMastery.set(e,{attempts:0,correctAttempts:0,totalAccuracy:0,averageAccuracy:0,bestAccuracy:0,successRate:0,recentAttempts:[],recentCorrects:[],lastAttempt:null,trend:"stable"})}recordAnalysis(e){this.analysisHistory.push(e),this.analysisHistory.length>this.maxHistoryLength&&this.analysisHistory.shift()}createErrorResult(e,t,n){return{targetDirection:{name:"ä¸æ˜",key:"unknown"},detectedDirection:{name:"ä¸æ˜",key:"unknown"},directionCorrect:!1,accuracy:0,mastery:{level:"beginner",progress:0},overshoot:{type:"unknown",severity:"none"},feedback:"æ–¹å‘æ€§åˆ†æã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",error:!0}}logAnalysisDetails(e){var t;console.group(`ğŸ§­ [DirectionAnalyzer] ${e.targetDirection.name}åˆ†æçµæœ`),console.log("ğŸ¯ æ–¹å‘æ€§åˆ†æ:",{ç›®æ¨™:`${e.targetDirection.name} (${e.targetSemitones.toFixed(1)}ã‚»ãƒŸãƒˆãƒ¼ãƒ³)`,æ¤œå‡º:`${e.detectedDirection.name} (${e.detectedSemitones.toFixed(1)}ã‚»ãƒŸãƒˆãƒ¼ãƒ³)`,æ­£è§£:e.directionCorrect?"âœ…":"âŒ",ç²¾åº¦:`${e.accuracy.toFixed(1)}%`}),console.log("ğŸ“Š ã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ¥ãƒ¼ãƒˆåˆ†æ:",{ã‚¿ã‚¤ãƒ—:e.overshoot.type,æ·±åˆ»åº¦:e.overshoot.severity,å·®åˆ†:`${e.overshoot.difference.toFixed(1)}ã‚»ãƒŸãƒˆãƒ¼ãƒ³`,èª¤å·®ç‡:`${e.overshoot.percentage.toFixed(1)}%`}),console.log("ğŸ“ˆ ç¿’å¾—çŠ¶æ³:",{ãƒ¬ãƒ™ãƒ«:e.mastery.level,æˆåŠŸç‡:`${((t=e.mastery.successRate)==null?void 0:t.toFixed(1))||0}%`,è©¦è¡Œå›æ•°:e.mastery.attempts,ãƒˆãƒ¬ãƒ³ãƒ‰:e.mastery.trend}),console.log("ğŸ’¬ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯:",e.feedback),console.groupEnd()}log(e,t=null){this.debugMode&&(t?console.log(`[DirectionAnalyzer] ${e}`,t):console.log(`[DirectionAnalyzer] ${e}`))}getStatistics(){return{totalAnalyses:this.analysisHistory.length,directionTypes:Object.keys(this.directions).length,masteryData:Object.fromEntries(this.directionMastery),thresholds:this.thresholds}}reset(){this.directionMastery.clear(),this.analysisHistory=[],this.initializeDirectionMastery(),this.log("ğŸ”„ DirectionAnalyzer ãƒªã‚»ãƒƒãƒˆå®Œäº†")}}typeof window<"u"&&(window.DirectionAnalyzer=rs);class os{constructor(e={}){this.config={windowSize:e.windowSize||5,maxHistory:e.maxHistory||100,stabilityThreshold:e.stabilityThreshold||25,trendWindowSize:e.trendWindowSize||10,fatigueDetectionWindow:e.fatigueDetectionWindow||15},this.consistencyData=new Map,this.stabilityHistory=[],this.sessionData={startTime:Date.now(),totalAttempts:0,overallConsistency:0,stabilityTrend:"stable",fatigueLevel:"fresh",concentrationLevel:"high"},this.debugMode=!0,this.log("ğŸ“Š ConsistencyTrackeråˆæœŸåŒ–å®Œäº†",{config:this.config,sessionStart:new Date(this.sessionData.startTime).toLocaleTimeString()})}recordAttempt(e,t,n,s){try{this.addAttemptData(e,t,n,s);const r=this.calculateIntervalConsistency(e);this.updateOverallConsistency();const o=this.analyzeStabilityTrend(),i=this.analyzeFatigue(),d={intervalType:e,intervalConsistency:r,overallConsistency:this.sessionData.overallConsistency,stabilityTrend:o,fatigueAnalysis:i,recommendations:this.generateConsistencyRecommendations(r,i),timestamp:Date.now()};return this.updateSessionData(d),this.debugMode&&this.logConsistencyDetails(d),d}catch(r){return console.error("âŒ [ConsistencyTracker] è¨˜éŒ²ã‚¨ãƒ©ãƒ¼:",r),this.createErrorResult(e)}}addAttemptData(e,t,n,s){this.consistencyData.has(e)||this.consistencyData.set(e,{attempts:[],statistics:{count:0,mean:0,standardDeviation:0,variance:0,range:0,consistencyScore:0},trend:"stable",lastUpdated:Date.now()});const r=this.consistencyData.get(e),o={centsDiff:t,accuracy:n,responseTime:s,timestamp:Date.now()};r.attempts.push(o),r.attempts.length>this.config.maxHistory&&r.attempts.shift(),this.updateStatistics(e),this.stabilityHistory.push({intervalType:e,centsDiff:Math.abs(t),accuracy:n,timestamp:Date.now()}),this.stabilityHistory.length>this.config.maxHistory&&this.stabilityHistory.shift(),this.sessionData.totalAttempts++}updateStatistics(e){const t=this.consistencyData.get(e),n=t.attempts;if(n.length===0)return;const s=n.map(f=>Math.abs(f.centsDiff)),r=s.length,o=s.reduce((f,h)=>f+h,0)/r,i=s.reduce((f,h)=>f+Math.pow(h-o,2),0)/r,d=Math.sqrt(i),l=Math.max(...s)-Math.min(...s),u=Math.max(0,100-d*2);t.statistics={count:r,mean:Math.round(o*10)/10,standardDeviation:Math.round(d*10)/10,variance:Math.round(i*10)/10,range:Math.round(l*10)/10,consistencyScore:Math.round(u*10)/10},t.trend=this.calculateIntervalTrend(n),t.lastUpdated=Date.now()}calculateIntervalConsistency(e){const t=this.consistencyData.get(e);if(!t||t.attempts.length<2)return{level:"insufficient_data",score:0,description:"ãƒ‡ãƒ¼ã‚¿ä¸è¶³",attempts:(t==null?void 0:t.attempts.length)||0};const n=t.statistics,s=this.determineConsistencyLevel(n.consistencyScore);return{intervalType:e,level:s,score:n.consistencyScore,statistics:n,trend:t.trend,description:this.getConsistencyDescription(s),attempts:n.count,recommendation:this.getIntervalRecommendation(e,n,t.trend)}}determineConsistencyLevel(e){return e>=90?"excellent":e>=75?"good":e>=60?"fair":e>=40?"poor":"very_poor"}getConsistencyDescription(e){return{excellent:"éå¸¸ã«å®‰å®šã—ãŸç²¾åº¦ã§èªè­˜ã§ãã¦ã„ã¾ã™",good:"å®‰å®šã—ãŸèªè­˜ãŒã§ãã¦ã„ã¾ã™",fair:"ã‚„ã‚„ä¸å®‰å®šã§ã™ãŒã€æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™",poor:"ä¸å®‰å®šãªèªè­˜ã§ã™ã€‚ç·´ç¿’ã‚’é‡ã­ã¾ã—ã‚‡ã†",very_poor:"éå¸¸ã«ä¸å®‰å®šã§ã™ã€‚åŸºç¤ç·´ç¿’ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†",insufficient_data:"ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™"}[e]||"è©•ä¾¡ä¸èƒ½"}updateOverallConsistency(){if(this.stabilityHistory.length<5){this.sessionData.overallConsistency=0;return}const t=this.stabilityHistory.slice(-this.config.trendWindowSize).map(r=>r.centsDiff),n=t.reduce((r,o)=>r+o,0)/t.length,s=Math.sqrt(t.reduce((r,o)=>r+Math.pow(o-n,2),0)/t.length);this.sessionData.overallConsistency=Math.max(0,100-s*2)}analyzeStabilityTrend(){if(this.stabilityHistory.length<this.config.trendWindowSize)return{trend:"insufficient_data",direction:"stable",confidence:0,description:"ãƒ‡ãƒ¼ã‚¿ä¸è¶³"};const e=this.stabilityHistory.slice(-this.config.trendWindowSize),t=Math.floor(this.config.trendWindowSize/2),n=e.slice(0,t),s=e.slice(-t),r=n.reduce((h,m)=>h+m.centsDiff,0)/n.length,o=s.reduce((h,m)=>h+m.centsDiff,0)/s.length,i=r-o,d=i/r*100;let l,u,f;return Math.abs(d)<10?(l="stable",u="stable",f=.7):i>0?(l="improving",u="better",f=Math.min(.9,Math.abs(d)/20)):(l="declining",u="worse",f=Math.min(.9,Math.abs(d)/20)),this.sessionData.stabilityTrend=l,{trend:l,direction:u,confidence:Math.round(f*100)/100,improvement:Math.round(i*10)/10,improvementPercent:Math.round(d*10)/10,description:this.getTrendDescription(l,u)}}analyzeFatigue(){if(this.stabilityHistory.length<this.config.fatigueDetectionWindow)return{fatigueLevel:"unknown",concentrationLevel:"unknown",recommendation:"ãƒ‡ãƒ¼ã‚¿ä¸è¶³ã®ãŸã‚åˆ¤å®šã§ãã¾ã›ã‚“"};const e=this.stabilityHistory.slice(-this.config.fatigueDetectionWindow),n=(Date.now()-this.sessionData.startTime)/(1e3*60);let s="fresh";n>30&&(s="moderate"),n>60&&(s="tired"),n>90&&(s="exhausted");const r=e.map(m=>m.accuracy),o=r.reduce((m,p)=>m+p,0)/r.length,i=this.stabilityHistory.map(m=>m.accuracy),l=i.reduce((m,p)=>m+p,0)/i.length-o;let u="fresh";l>5&&(u="moderate"),l>10&&(u="tired"),l>20&&(u="exhausted");const f=this.combineFatigueFactors(s,u),h=this.evaluateConcentration(e);return this.sessionData.fatigueLevel=f,this.sessionData.concentrationLevel=h,{fatigueLevel:f,concentrationLevel:h,sessionMinutes:Math.round(n),accuracyDrop:Math.round(l*10)/10,recommendation:this.getFatigueRecommendation(f,h)}}combineFatigueFactors(e,t){const n=["fresh","moderate","tired","exhausted"],s=n.indexOf(e),r=n.indexOf(t),o=Math.max(s,r);return n[o]}evaluateConcentration(e){const t=e.map(s=>s.centsDiff),n=Math.sqrt(t.reduce((s,r)=>s+Math.pow(r-t.reduce((o,i)=>o+i,0)/t.length,2),0)/t.length);return n<=15?"high":n<=25?"medium":n<=40?"low":"very_low"}generateConsistencyRecommendations(e,t){const n=[];return(t.fatigueLevel==="tired"||t.fatigueLevel==="exhausted")&&n.push({type:"rest",priority:"high",message:"ç–²åŠ´ãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚10-15åˆ†ã®ä¼‘æ†©ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚",icon:"ğŸ˜´"}),(t.concentrationLevel==="low"||t.concentrationLevel==="very_low")&&n.push({type:"focus",priority:"medium",message:"é›†ä¸­åŠ›ãŒä½ä¸‹ã—ã¦ã„ã¾ã™ã€‚æ·±å‘¼å¸ã‚’ã—ã¦ã€ã‚†ã£ãã‚Šã¨ç·´ç¿’ã—ã¦ã¿ã¦ãã ã•ã„ã€‚",icon:"ğŸ§˜"}),(e.level==="poor"||e.level==="very_poor")&&n.push({type:"practice",priority:"medium",message:`${e.intervalType}ã®ç·´ç¿’ã‚’é‡ç‚¹çš„ã«è¡Œã„ã¾ã—ã‚‡ã†ã€‚ã‚†ã£ãã‚Šã¨æ­£ç¢ºã«æ­Œã†ã“ã¨ã‚’æ„è­˜ã—ã¦ãã ã•ã„ã€‚`,icon:"ğŸ¯"}),e.trend==="improving"&&n.push({type:"encouragement",priority:"low",message:"æ”¹å–„ãŒè¦‹ã‚‰ã‚Œã¾ã™ï¼ã“ã®èª¿å­ã§ç·´ç¿’ã‚’ç¶šã‘ã¦ãã ã•ã„ã€‚",icon:"ğŸ“ˆ"}),n}getIntervalRecommendation(e,t,n){return t.consistencyScore>=80?"å®‰å®šã—ãŸèªè­˜ãŒã§ãã¦ã„ã¾ã™ã€‚ã“ã®ç²¾åº¦ã‚’ç¶­æŒã—ã¾ã—ã‚‡ã†ã€‚":n==="improving"?"æ”¹å–„å‚¾å‘ã«ã‚ã‚Šã¾ã™ã€‚ç¶™ç¶šã—ã¦ç·´ç¿’ã—ã¦ãã ã•ã„ã€‚":t.standardDeviation>30?"ã°ã‚‰ã¤ããŒå¤§ãã„ã§ã™ã€‚ã‚†ã£ãã‚Šã¨æ­£ç¢ºã«æ­Œã†ã“ã¨ã‚’æ„è­˜ã—ã¦ãã ã•ã„ã€‚":`${e}ã®ç‰¹å¾´ã‚’æ„è­˜ã—ã¦ã€ä¸€å®šã®ç²¾åº¦ã§æ­Œãˆã‚‹ã‚ˆã†ç·´ç¿’ã—ã¾ã—ã‚‡ã†ã€‚`}getTrendDescription(e,t){return{stable:"å®‰å®šã—ãŸç²¾åº¦ã‚’ç¶­æŒã—ã¦ã„ã¾ã™",improving:"ç²¾åº¦ãŒå‘ä¸Šã—ã¦ã„ã¾ã™",declining:"ç²¾åº¦ãŒä½ä¸‹ã—ã¦ã„ã¾ã™"}[e]||"å‚¾å‘ã‚’åˆ†æä¸­"}getFatigueRecommendation(e,t){return e==="exhausted"?"ä»Šæ—¥ã¯ã“ã“ã¾ã§ã«ã—ã¦ã€ååˆ†ãªä¼‘æ¯ã‚’å–ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚":e==="tired"?"15-20åˆ†ã®ä¼‘æ†©ã‚’å–ã£ã¦ã‹ã‚‰ç·´ç¿’ã‚’å†é–‹ã—ã¾ã—ã‚‡ã†ã€‚":t==="very_low"?"é›†ä¸­åŠ›ãŒä½ä¸‹ã—ã¦ã„ã¾ã™ã€‚ç’°å¢ƒã‚’æ•´ãˆã¦ã€çŸ­æ™‚é–“ã®é›†ä¸­ç·´ç¿’ã‚’å¿ƒãŒã‘ã¾ã—ã‚‡ã†ã€‚":t==="low"?"æ·±å‘¼å¸ã‚’ã—ã¦ã€ä¸€ã¤ä¸€ã¤ã®éŸ³ç¨‹ã«é›†ä¸­ã—ã¦ç·´ç¿’ã—ã¦ã¿ã¦ãã ã•ã„ã€‚":"è‰¯ã„çŠ¶æ…‹ã§ã™ã€‚ã“ã®èª¿å­ã§ç·´ç¿’ã‚’ç¶šã‘ã¦ãã ã•ã„ã€‚"}calculateIntervalTrend(e){if(e.length<6)return"stable";const t=e.slice(-3),n=e.slice(-6,-3),s=t.reduce((i,d)=>i+Math.abs(d.centsDiff),0)/t.length,o=n.reduce((i,d)=>i+Math.abs(d.centsDiff),0)/n.length-s;return o>5?"improving":o<-5?"declining":"stable"}updateSessionData(e){this.sessionData.overallConsistency=e.overallConsistency,this.sessionData.stabilityTrend=e.stabilityTrend.trend,this.sessionData.fatigueLevel=e.fatigueAnalysis.fatigueLevel,this.sessionData.concentrationLevel=e.fatigueAnalysis.concentrationLevel}createErrorResult(e){return{intervalType:e,intervalConsistency:{level:"error",score:0},overallConsistency:0,stabilityTrend:{trend:"error"},fatigueAnalysis:{fatigueLevel:"unknown"},recommendations:[],error:!0}}logConsistencyDetails(e){var t;console.group(`ğŸ“Š [ConsistencyTracker] ${e.intervalType}ä¸€è²«æ€§åˆ†æ`),console.log("ğŸ¯ éŸ³ç¨‹ä¸€è²«æ€§:",{ãƒ¬ãƒ™ãƒ«:e.intervalConsistency.level,ã‚¹ã‚³ã‚¢:`${e.intervalConsistency.score}%`,æ¨™æº–åå·®:`${((t=e.intervalConsistency.statistics)==null?void 0:t.standardDeviation)||0}ã‚»ãƒ³ãƒˆ`,è©¦è¡Œå›æ•°:e.intervalConsistency.attempts}),console.log("ğŸ“ˆ ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ:",{å…¨ä½“å‚¾å‘:e.stabilityTrend.trend,æ–¹å‘:e.stabilityTrend.direction,ä¿¡é ¼åº¦:`${(e.stabilityTrend.confidence*100).toFixed(0)}%`,æ”¹å–„åº¦:`${e.stabilityTrend.improvement}ã‚»ãƒ³ãƒˆ`}),console.log("ğŸ˜´ ç–²åŠ´åˆ†æ:",{ç–²åŠ´åº¦:e.fatigueAnalysis.fatigueLevel,é›†ä¸­åŠ›:e.fatigueAnalysis.concentrationLevel,ã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚é–“:`${e.fatigueAnalysis.sessionMinutes}åˆ†`,ç²¾åº¦ä½ä¸‹:`${e.fatigueAnalysis.accuracyDrop}%`}),e.recommendations.length>0&&console.log("ğŸ’¡ æ¨å¥¨äº‹é …:",e.recommendations.map(n=>n.message)),console.groupEnd()}log(e,t=null){this.debugMode&&(t?console.log(`[ConsistencyTracker] ${e}`,t):console.log(`[ConsistencyTracker] ${e}`))}getAllConsistencyData(){const e={};for(const[t,n]of this.consistencyData.entries())e[t]={statistics:n.statistics,trend:n.trend,attempts:n.attempts.length,lastUpdated:n.lastUpdated};return{intervalData:e,sessionData:this.sessionData,overallStats:{totalAttempts:this.sessionData.totalAttempts,overallConsistency:this.sessionData.overallConsistency,sessionDuration:Date.now()-this.sessionData.startTime}}}getStatistics(){return{totalIntervalTypes:this.consistencyData.size,totalAttempts:this.sessionData.totalAttempts,sessionDuration:Date.now()-this.sessionData.startTime,overallConsistency:this.sessionData.overallConsistency,stabilityTrend:this.sessionData.stabilityTrend,fatigueLevel:this.sessionData.fatigueLevel}}reset(){this.consistencyData.clear(),this.stabilityHistory=[],this.sessionData={startTime:Date.now(),totalAttempts:0,overallConsistency:0,stabilityTrend:"stable",fatigueLevel:"fresh",concentrationLevel:"high"},this.log("ğŸ”„ ConsistencyTracker ãƒªã‚»ãƒƒãƒˆå®Œäº†")}}typeof window<"u"&&(window.ConsistencyTracker=os);class Ht{constructor(e={}){var t,n,s,r,o,i,d,l,u,f,h;this.config={weights:{pitchAccuracy:((t=e.weights)==null?void 0:t.pitchAccuracy)||.4,recognitionSpeed:((n=e.weights)==null?void 0:n.recognitionSpeed)||.2,intervalMastery:((s=e.weights)==null?void 0:s.intervalMastery)||.2,directionAccuracy:((r=e.weights)==null?void 0:r.directionAccuracy)||.1,consistency:((o=e.weights)==null?void 0:o.consistency)||.1},speedThresholds:{excellent:((i=e.speedThresholds)==null?void 0:i.excellent)||1e3,good:((d=e.speedThresholds)==null?void 0:d.good)||2e3,fair:((l=e.speedThresholds)==null?void 0:l.fair)||3e3,poor:((u=e.speedThresholds)==null?void 0:u.poor)||5e3},harmonicCorrection:{enabled:((f=e.harmonicCorrection)==null?void 0:f.enabled)??!0,tolerance:((h=e.harmonicCorrection)==null?void 0:h.tolerance)||50},sessionTracking:e.sessionTracking??!0,maxHistorySize:e.maxHistorySize||100},this.intervalAnalyzer=new ss,this.directionAnalyzer=new rs,this.consistencyTracker=new os,this.sessionData={startTime:Date.now(),totalAttempts:0,overallScore:0,performanceHistory:[],currentLevel:"beginner",achievements:new Set,lastAnalysis:null},this.performanceMetrics={averageSpeed:0,accuracyTrend:"stable",strengthAreas:[],improvementAreas:[],sessionProgress:0},this.debugMode=!0,this.log("ğŸ¯ EnhancedScoringEngineåˆæœŸåŒ–å®Œäº†",{weights:this.config.weights,analyzers:["IntervalAnalyzer","DirectionAnalyzer","ConsistencyTracker"]})}async analyzePerformance(e){try{const{baseFreq:t,targetFreq:n,detectedFreq:s,responseTime:r,volume:o=50,harmonicCorrection:i=null}=e,d=this.validateInputs(e);if(!d.valid)return this.createErrorResult(d.error);const l=this.applyHarmonicCorrection(s,i),u=await Promise.all([this.intervalAnalyzer.analyzeInterval(t,n,l),this.directionAnalyzer.analyzeDirection(t,n,l),this.consistencyTracker.recordAttempt(this.getIntervalType(t,n),this.calculateCentsDifference(n,l),this.calculateRawAccuracy(n,l),r)]),[f,h,m]=u,p=this.analyzeRecognitionSpeed(r),S=this.calculateIntegratedScore({intervalAnalysis:f,directionAnalysis:h,consistencyAnalysis:m,speedAnalysis:p,volume:o}),A=this.evaluateOverallPerformance(S),L=this.generateAdaptiveFeedback({intervalAnalysis:f,directionAnalysis:h,consistencyAnalysis:m,speedAnalysis:p,performanceEvaluation:A}),E=this.updateSessionData(S,A),w={timestamp:Date.now(),sessionAttempt:this.sessionData.totalAttempts,analyses:{interval:f,direction:h,consistency:m,speed:p},score:S,performance:A,feedback:L,session:E,metadata:{baseFreq:t,targetFreq:n,detectedFreq:s,correctedFreq:l,responseTime:r,volume:o,harmonicCorrectionApplied:!!i}};return this.recordAnalysisResult(w),this.debugMode&&this.logScoringDetails(w),w}catch(t){return console.error("âŒ [EnhancedScoringEngine] æ¡ç‚¹ã‚¨ãƒ©ãƒ¼:",t),this.createErrorResult("æ¡ç‚¹å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")}}validateInputs(e){const{baseFreq:t,targetFreq:n,detectedFreq:s,responseTime:r}=e;return!t||!n||!s?{valid:!1,error:"å¿…è¦ãªå‘¨æ³¢æ•°ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™"}:t<=0||n<=0||s<=0?{valid:!1,error:"å‘¨æ³¢æ•°ã¯æ­£ã®å€¤ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™"}:r<0||r>3e4?{valid:!1,error:"åå¿œæ™‚é–“ãŒç¯„å›²å¤–ã§ã™"}:{valid:!0}}applyHarmonicCorrection(e,t){return!this.config.harmonicCorrection.enabled||!t?e:t.correctedFrequency&&Math.abs(t.correctedFrequency-e)<=this.config.harmonicCorrection.tolerance?(this.log("ğŸ”§ HarmonicCorrectioné©ç”¨",{original:e,corrected:t.correctedFrequency,correction:t.correction}),t.correctedFrequency):e}analyzeRecognitionSpeed(e){const{speedThresholds:t}=this.config;let n,s,r;return e<=t.excellent?(n="excellent",s=100,r="âš¡ ç´ æ—©ã„èªè­˜ã§ã™ï¼"):e<=t.good?(n="good",s=85,r="ğŸ‘ è‰¯ã„åå¿œé€Ÿåº¦ã§ã™ã€‚"):e<=t.fair?(n="fair",s=70,r="ğŸ“ˆ ã‚‚ã†å°‘ã—æ—©ãèªè­˜ã§ãã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚"):e<=t.poor?(n="poor",s=50,r="ğŸŒ ã‚†ã£ãã‚Šã¨ç¢ºå®Ÿã«èªè­˜ã—ã¾ã—ã‚‡ã†ã€‚"):(n="very_poor",s=25,r="â° æ™‚é–“ã‚’ã‹ã‘ã™ãã¦ã„ã¾ã™ã€‚ç·´ç¿’ã‚’é‡ã­ã¾ã—ã‚‡ã†ã€‚"),{level:n,score:s,responseTime:e,feedback:r,comparison:this.compareToAverageSpeed(e)}}calculateIntegratedScore(e){const{weights:t}=this.config,{intervalAnalysis:n,directionAnalysis:s,consistencyAnalysis:r,speedAnalysis:o,volume:i}=e,d=n.accuracy||0,l=o.score||0,u=this.calculateMasteryScore(n.mastery),f=s.accuracy||0,h=r.overallConsistency||0,m=d*t.pitchAccuracy+l*t.recognitionSpeed+u*t.intervalMastery+f*t.directionAccuracy+h*t.consistency,p=this.calculateVolumeAdjustment(i),S=Math.min(100,m*p);return{total:Math.round(S*10)/10,components:{pitchAccuracy:Math.round(d*10)/10,recognitionSpeed:Math.round(l*10)/10,intervalMastery:Math.round(u*10)/10,directionAccuracy:Math.round(f*10)/10,consistency:Math.round(h*10)/10},weights:t,volumeAdjustment:Math.round(p*100)/100,grade:this.determineGrade(S)}}calculateMasteryScore(e){if(!e||e.attempts===0)return 0;const t=e.averageAccuracy||0,n=Math.min(20,e.attempts*2),s=e.trend==="improving"?10:0;return Math.min(100,t+n+s)}calculateVolumeAdjustment(e){return e<20?.8:e>80?.95:1}determineGrade(e){return e>=95?"S":e>=90?"A+":e>=85?"A":e>=80?"B+":e>=75?"B":e>=70?"C+":e>=65?"C":e>=60?"D+":e>=55?"D":"F"}evaluateOverallPerformance(e){const t=this.determinePerformanceLevel(e.total),n=this.identifyStrengths(e.components),s=this.identifyWeaknesses(e.components),r=this.calculateImprovement();return{level:t,score:e.total,grade:e.grade,strengths:n,weaknesses:s,improvement:r,recommendation:this.generatePerformanceRecommendation(t,n,s)}}determinePerformanceLevel(e){return e>=90?"excellent":e>=80?"good":e>=70?"average":e>=60?"below_average":"needs_improvement"}identifyStrengths(e){const t=[];return Object.entries(e).forEach(([n,s])=>{s>=85?t.push({area:n,score:s,level:"excellent"}):s>=75&&t.push({area:n,score:s,level:"good"})}),t.sort((n,s)=>s.score-n.score)}identifyWeaknesses(e){const t=[];return Object.entries(e).forEach(([n,s])=>{s<60&&t.push({area:n,score:s,severity:s<40?"high":"medium"})}),t.sort((n,s)=>n.score-s.score)}calculateImprovement(){const e=this.sessionData.performanceHistory;if(e.length<3)return{trend:"insufficient_data",change:0,description:"ãƒ‡ãƒ¼ã‚¿ä¸è¶³"};const t=e.slice(-3),n=e.slice(-6,-3);if(n.length===0)return{trend:"stable",change:0,description:"å®‰å®š"};const s=t.reduce((l,u)=>l+u,0)/t.length,r=n.reduce((l,u)=>l+u,0)/n.length,o=s-r;let i,d;return o>5?(i="improving",d="å‘ä¸Šä¸­"):o<-5?(i="declining",d="ä½ä¸‹ä¸­"):(i="stable",d="å®‰å®š"),{trend:i,change:Math.round(o*10)/10,description:d}}generateAdaptiveFeedback(e){const{intervalAnalysis:t,directionAnalysis:n,consistencyAnalysis:s,speedAnalysis:r,performanceEvaluation:o}=e;return{primary:this.getPrimaryFeedback(o),detailed:{interval:t.feedback||"éŸ³ç¨‹åˆ†æçµæœãªã—",direction:n.feedback||"æ–¹å‘æ€§åˆ†æçµæœãªã—",consistency:this.getConsistencyFeedback(s),speed:r.feedback||"é€Ÿåº¦åˆ†æçµæœãªã—"},recommendations:this.generateRecommendations(e),encouragement:this.generateEncouragement(o),nextSteps:this.suggestNextSteps(o)}}getPrimaryFeedback(e){const{level:t,grade:n,score:s}=e;return{excellent:`ğŸ¯ ç´ æ™´ã‚‰ã—ã„ï¼${n}è©•ä¾¡ï¼ˆ${s}ç‚¹ï¼‰ã§ã™ã€‚`,good:`ğŸ‘ è‰¯ã„çµæœã§ã™ï¼${n}è©•ä¾¡ï¼ˆ${s}ç‚¹ï¼‰ã€‚`,average:`ğŸ“ˆ å¹³å‡çš„ãªçµæœã§ã™ã€‚${n}è©•ä¾¡ï¼ˆ${s}ç‚¹ï¼‰ã€‚`,below_average:`ğŸ’ª ç·´ç¿’ã‚’ç¶šã‘ã¾ã—ã‚‡ã†ã€‚${n}è©•ä¾¡ï¼ˆ${s}ç‚¹ï¼‰ã€‚`,needs_improvement:`ğŸ“ åŸºç¤ã‹ã‚‰ç·´ç¿’ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚${n}è©•ä¾¡ï¼ˆ${s}ç‚¹ï¼‰ã€‚`}[t]||`çµæœ: ${n}è©•ä¾¡ï¼ˆ${s}ç‚¹ï¼‰`}getConsistencyFeedback(e){if(e.recommendations&&e.recommendations.length>0)return e.recommendations[0].message;const t=e.overallConsistency||0;return t>=80?"ğŸ¯ ä¸€è²«ã—ãŸç²¾åº¦ã‚’ä¿ã£ã¦ã„ã¾ã™ã€‚":t>=60?"ğŸ“Š ã¾ãšã¾ãšã®å®‰å®šæ€§ã§ã™ã€‚":"ğŸ“ˆ ä¸€è²«æ€§ã®æ”¹å–„ãŒå¿…è¦ã§ã™ã€‚"}generateRecommendations(e){const t=[];e.consistencyAnalysis.recommendations&&t.push(...e.consistencyAnalysis.recommendations);const{performanceEvaluation:n}=e;if(n.weaknesses.length>0){const s=n.weaknesses[0];t.push({type:"improvement",priority:"high",message:this.getImprovementSuggestion(s.area),icon:"ğŸ¯"})}return t}getImprovementSuggestion(e){return{pitchAccuracy:"éŸ³ç¨‹ã®ç²¾åº¦å‘ä¸Šã®ãŸã‚ã€ã‚†ã£ãã‚Šã¨æ­£ç¢ºã«æ­Œã†ç·´ç¿’ã‚’ã—ã¾ã—ã‚‡ã†ã€‚",recognitionSpeed:"åå¿œé€Ÿåº¦å‘ä¸Šã®ãŸã‚ã€èã„ãŸç¬é–“ã«æ­Œã†ç·´ç¿’ã‚’ã—ã¾ã—ã‚‡ã†ã€‚",intervalMastery:"è‹¦æ‰‹ãªéŸ³ç¨‹ã‚’é‡ç‚¹çš„ã«ç·´ç¿’ã—ã¾ã—ã‚‡ã†ã€‚",directionAccuracy:"ä¸Šè¡Œãƒ»ä¸‹è¡Œã®æ–¹å‘æ€§ã‚’æ„è­˜ã—ã¦ç·´ç¿’ã—ã¾ã—ã‚‡ã†ã€‚",consistency:"ä¸€å®šã®ç²¾åº¦ã‚’ä¿ã¤ãŸã‚ã€é›†ä¸­åŠ›ã‚’é«˜ã‚ã¦ç·´ç¿’ã—ã¾ã—ã‚‡ã†ã€‚"}[e]||"ç¶™ç¶šçš„ãªç·´ç¿’ã§æ”¹å–„ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚"}generateEncouragement(e){if(e.improvement.trend==="improving")return"ğŸ“ˆ ç¢ºå®Ÿã«ä¸Šé”ã—ã¦ã„ã¾ã™ï¼ã“ã®èª¿å­ã§ç¶šã‘ã¾ã—ã‚‡ã†ã€‚";if(e.strengths.length>0){const t=e.strengths[0];return`â­ ${this.getAreaName(t.area)}ãŒå¾—æ„ã§ã™ã­ï¼`}return"ğŸŒŸ ç·´ç¿’ã‚’ç¶šã‘ã‚‹ã“ã¨ã§å¿…ãšä¸Šé”ã—ã¾ã™ã€‚é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼"}suggestNextSteps(e){if(e.level==="excellent")return"ğŸ“ ä¸Šç´šãƒ¬ãƒ™ãƒ«ã«åˆ°é”ã—ã¦ã„ã¾ã™ã€‚ã‚ˆã‚Šè¤‡é›‘ãªéŸ³ç¨‹ã«æŒ‘æˆ¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚";if(e.weaknesses.length>0){const t=e.weaknesses[0];return`ğŸ¯ ${this.getAreaName(t.area)}ã®ç·´ç¿’ã«é‡ç‚¹ã‚’ç½®ãã¾ã—ã‚‡ã†ã€‚`}return"ğŸ“š åŸºç¤ç·´ç¿’ã‚’ç¶™ç¶šã—ã€å…¨ä½“çš„ãªãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚"}getAreaName(e){return{pitchAccuracy:"éŸ³ç¨‹ç²¾åº¦",recognitionSpeed:"èªè­˜é€Ÿåº¦",intervalMastery:"éŸ³ç¨‹ç¿’å¾—åº¦",directionAccuracy:"æ–¹å‘æ€§èªè­˜",consistency:"ä¸€è²«æ€§"}[e]||e}updateSessionData(e,t){return this.sessionData.totalAttempts++,this.sessionData.performanceHistory.push(e.total),this.sessionData.overallScore=this.calculateSessionAverage(),this.sessionData.currentLevel=t.level,this.sessionData.lastAnalysis=Date.now(),this.sessionData.performanceHistory.length>this.config.maxHistorySize&&this.sessionData.performanceHistory.shift(),this.updatePerformanceMetrics(e,t),this.checkAchievements(e,t),{attempt:this.sessionData.totalAttempts,sessionAverage:this.sessionData.overallScore,sessionDuration:Date.now()-this.sessionData.startTime,level:this.sessionData.currentLevel,newAchievements:Array.from(this.sessionData.achievements)}}calculateSessionAverage(){const e=this.sessionData.performanceHistory;return e.length===0?0:e.reduce((t,n)=>t+n,0)/e.length}updatePerformanceMetrics(e,t){e.components.recognitionSpeed>0&&(this.performanceMetrics.averageSpeed=(this.performanceMetrics.averageSpeed+e.components.recognitionSpeed)/2),this.performanceMetrics.accuracyTrend=t.improvement.trend,this.performanceMetrics.strengthAreas=t.strengths.map(n=>n.area),this.performanceMetrics.improvementAreas=t.weaknesses.map(n=>n.area),this.performanceMetrics.sessionProgress=Math.min(100,this.sessionData.totalAttempts/20*100)}checkAchievements(e,t){this.sessionData.totalAttempts===1&&this.sessionData.achievements.add("first_attempt"),e.total>=90&&!this.sessionData.achievements.has("high_score")&&this.sessionData.achievements.add("high_score"),e.total>=98&&!this.sessionData.achievements.has("perfect_score")&&this.sessionData.achievements.add("perfect_score"),this.sessionData.totalAttempts>=10&&!this.sessionData.achievements.has("persistent")&&this.sessionData.achievements.add("persistent"),t.improvement.trend==="improving"&&!this.sessionData.achievements.has("improving")&&this.sessionData.achievements.add("improving")}compareToAverageSpeed(e){const t=this.performanceMetrics.averageSpeed||2e3,n=e-t;return{sessionAverage:t,difference:n,comparison:n<-500?"much_faster":n<-200?"faster":n<200?"similar":n<500?"slower":"much_slower"}}getIntervalType(e,t){const s=(Math.round(12*Math.log2(t/e))%12+12)%12;return{0:"unison",1:"minorSecond",2:"majorSecond",3:"minorThird",4:"majorThird",5:"perfectFourth",6:"tritone",7:"perfectFifth",8:"minorSixth",9:"majorSixth",10:"minorSeventh",11:"majorSeventh"}[s]||"unknown"}calculateCentsDifference(e,t){return!e||!t?0:1200*Math.log2(t/e)}calculateRawAccuracy(e,t){const n=Math.abs(this.calculateCentsDifference(e,t));return Math.max(0,100-n)}recordAnalysisResult(e){this.sessionData.lastAnalysis=e}createErrorResult(e){return{timestamp:Date.now(),error:!0,message:e,score:{total:0,components:{pitchAccuracy:0,recognitionSpeed:0,intervalMastery:0,directionAccuracy:0,consistency:0},grade:"F"},performance:{level:"needs_improvement",strengths:[],weaknesses:[],improvement:{trend:"unknown",change:0}},feedback:{primary:"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",detailed:{},recommendations:[],encouragement:"",nextSteps:""}}}logScoringDetails(e){console.group(`ğŸ¯ [EnhancedScoringEngine] çµ±åˆæ¡ç‚¹çµæœ #${e.sessionAttempt}`),console.log("ğŸ“Š çµ±åˆã‚¹ã‚³ã‚¢:",{ç·åˆ:`${e.score.total}ç‚¹ (${e.score.grade})`,éŸ³ç¨‹ç²¾åº¦:`${e.score.components.pitchAccuracy}%`,èªè­˜é€Ÿåº¦:`${e.score.components.recognitionSpeed}%`,éŸ³ç¨‹ç¿’å¾—åº¦:`${e.score.components.intervalMastery}%`,æ–¹å‘æ€§ç²¾åº¦:`${e.score.components.directionAccuracy}%`,ä¸€è²«æ€§:`${e.score.components.consistency}%`}),console.log("ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹:",{ãƒ¬ãƒ™ãƒ«:e.performance.level,æ”¹å–„å‚¾å‘:e.performance.improvement.trend,å¼·ã¿:e.performance.strengths.map(t=>t.area),å¼±ç‚¹:e.performance.weaknesses.map(t=>t.area)}),console.log("ğŸ’¬ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯:",{ãƒ¡ã‚¤ãƒ³:e.feedback.primary,æ¨å¥¨äº‹é …:e.feedback.recommendations.length}),console.log("ğŸ“š ã‚»ãƒƒã‚·ãƒ§ãƒ³:",{è©¦è¡Œå›æ•°:e.session.attempt,å¹³å‡ç‚¹:e.session.sessionAverage.toFixed(1),ç¶™ç¶šæ™‚é–“:`${Math.round(e.session.sessionDuration/6e4)}åˆ†`}),console.groupEnd()}log(e,t=null){this.debugMode&&(t?console.log(`[EnhancedScoringEngine] ${e}`,t):console.log(`[EnhancedScoringEngine] ${e}`))}async processAttempt(e){return await this.analyzePerformance(e)}generateDetailedReport(){var f,h,m,p,S,A,L,E;const e=this.getStatistics(),t=this.sessionData,n={totalScore:t.overallScore,totalAttempts:t.totalAttempts,averageScore:t.totalAttempts>0?t.overallScore/t.totalAttempts:0,sessionDuration:Date.now()-t.startTime,level:t.currentLevel},s={intervals:e.analyzers.interval,directions:e.analyzers.direction,consistency:e.analyzers.consistency},r=this.generateImprovementSuggestions(),o={startTime:t.startTime,duration:Date.now()-t.startTime,attempts:t.totalAttempts,achievements:Array.from(t.achievements),performanceHistory:t.performanceHistory.slice(-10)},i={primary:r.length>0?r[0].message:"è‰¯å¥½ãªæ¼”å¥ã§ã™ï¼",detailed:r.map(w=>w.message),suggestions:r.map(w=>w.actions).flat()},d=[{label:"éŸ³ç¨‹ç²¾åº¦",value:Math.round(((f=e.analyzers.interval)==null?void 0:f.averageAccuracy)||0),weight:40},{label:"èªè­˜é€Ÿåº¦",value:Math.round(100-(e.averageResponseTime||5e3)/50),weight:20},{label:"éŸ³ç¨‹ç¿’å¾—",value:Math.round(((h=e.analyzers.interval)==null?void 0:h.masteryLevel)||0),weight:20},{label:"æ–¹å‘ç²¾åº¦",value:Math.round(((m=e.analyzers.direction)==null?void 0:m.accuracy)||0),weight:10},{label:"ä¸€è²«æ€§",value:Math.round(((p=e.analyzers.consistency)==null?void 0:p.score)||0),weight:10}],l=d.reduce((w,T)=>w+T.value*T.weight/100,0);let u="C";return l>=90?u="S":l>=80?u="A":l>=70&&(u="B"),{timestamp:Date.now(),totalScore:Math.round(l),grade:u,componentScores:d,feedback:i,intervalAnalysis:{masteryLevels:((S=e.analyzers.interval)==null?void 0:S.intervalMastery)||{},attemptCounts:((A=e.analyzers.interval)==null?void 0:A.attemptCounts)||{},accuracyRates:((L=e.analyzers.interval)==null?void 0:L.accuracyRates)||{}},consistencyHistory:((E=e.analyzers.consistency)==null?void 0:E.recentScores)||[],overall:n,detailed:s,improvements:r,session:o,metadata:{version:"2.2.1-FIXED",engine:"EnhancedScoringEngine"}}}generatePerformanceRecommendation(e,t,n){const s=[];switch(e){case"excellent":s.push("ç´ æ™´ã‚‰ã—ã„æ¼”å¥ã§ã™ï¼ã“ã®ç²¾åº¦ã‚’ç¶­æŒã—ãªãŒã‚‰ã€ã‚ˆã‚Šé›£ã—ã„éŸ³ç¨‹ã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚");break;case"good":s.push("è‰¯å¥½ãªç²¾åº¦ã§ã™ã€‚å®‰å®šã—ãŸæ¼”å¥ã‚’ç¶™ç¶šã—ã€å¼±ç‚¹åˆ†é‡ã®å‘ä¸Šã‚’å›³ã‚Šã¾ã—ã‚‡ã†ã€‚");break;case"average":s.push("åŸºæœ¬çš„ãªèƒ½åŠ›ã¯èº«ã«ã¤ã„ã¦ã„ã¾ã™ã€‚ç¶™ç¶šçš„ãªç·´ç¿’ã§æ›´ãªã‚‹å‘ä¸ŠãŒæœŸå¾…ã§ãã¾ã™ã€‚");break;case"needs_improvement":s.push("åŸºç¤ç·´ç¿’ã‚’é‡ç‚¹çš„ã«è¡Œã„ã€éŸ³ç¨‹æ„Ÿè¦šã®å‘ä¸Šã‚’å›³ã‚Šã¾ã—ã‚‡ã†ã€‚");break;default:s.push("åŸºæœ¬çš„ãªéŸ³ç¨‹ã‹ã‚‰æ®µéšçš„ã«ç·´ç¿’ã‚’é‡ã­ã¦ã€éŸ³æ„Ÿã‚’è‚²ã¦ã¦ã„ãã¾ã—ã‚‡ã†ã€‚")}return n.includes("interval")&&s.push("éŸ³ç¨‹ã®æ­£ç¢ºæ€§å‘ä¸Šã®ãŸã‚ã€æ¥½å™¨ã§ã®ç¢ºèªã‚’ä½µç”¨ã—ãŸç·´ç¿’ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚"),n.includes("direction")&&s.push("éŸ³ç¨‹ã®ä¸Šè¡Œãƒ»ä¸‹è¡Œåˆ¤å®šã®ç²¾åº¦å‘ä¸Šã®ãŸã‚ã€éŸ³éšç·´ç¿’ã‚’å–ã‚Šå…¥ã‚Œã¾ã—ã‚‡ã†ã€‚"),n.includes("consistency")&&s.push("å®‰å®šã—ãŸç²¾åº¦ã‚’ä¿ã¤ãŸã‚ã€é›†ä¸­åŠ›ã‚’ç¶­æŒã—ãŸç¶™ç¶šçš„ãªç·´ç¿’ãŒåŠ¹æœçš„ã§ã™ã€‚"),n.includes("speed")&&s.push("èªè­˜é€Ÿåº¦å‘ä¸Šã®ãŸã‚ã€çŸ­æ™‚é–“ã§ã®é›†ä¸­çš„ãªåˆ¤å®šç·´ç¿’ã‚’è¡Œã„ã¾ã—ã‚‡ã†ã€‚"),s.join(" ")}generateImprovementSuggestions(){const e=[],t=this.getStatistics();return t.analyzers.interval.averageAccuracy<70&&e.push({category:"interval",priority:"high",message:"éŸ³ç¨‹ã®æ­£ç¢ºæ€§å‘ä¸ŠãŒå¿…è¦ã§ã™ã€‚åŸºæœ¬çš„ãªéŸ³ç¨‹ï¼ˆå®Œå…¨5åº¦ã€ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ï¼‰ã‹ã‚‰ç·´ç¿’ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚",actions:["åŸºæœ¬éŸ³ç¨‹ã®é›†ä¸­ç·´ç¿’","æ¥½å™¨ã§ã®ç¢ºèª","æ­Œå”±ç·´ç¿’"]}),t.analyzers.direction.accuracy<80&&e.push({category:"direction",priority:"medium",message:"éŸ³ç¨‹ã®ä¸Šè¡Œãƒ»ä¸‹è¡Œã®åˆ¤æ–­ç²¾åº¦ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚",actions:["éŸ³éšç·´ç¿’","è´éŸ³ç·´ç¿’","ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«è­˜åˆ¥"]}),t.analyzers.consistency.score<75&&e.push({category:"consistency",priority:"medium",message:"å®‰å®šã—ãŸç²¾åº¦ã‚’ä¿ã¤ãŸã‚ã€ç¶™ç¶šçš„ãªç·´ç¿’ãŒåŠ¹æœçš„ã§ã™ã€‚",actions:["å®šæœŸçš„ãªç·´ç¿’","é›†ä¸­åŠ›å‘ä¸Š","ç–²åŠ´ç®¡ç†"]}),e}getStatistics(){return{session:this.sessionData,performance:this.performanceMetrics,analyzers:{interval:this.intervalAnalyzer.getStatistics(),direction:this.directionAnalyzer.getStatistics(),consistency:this.consistencyTracker.getStatistics()},config:this.config}}updateConfig(e){this.config={...this.config,...e},this.log("âš™ï¸ è¨­å®šæ›´æ–°å®Œäº†",this.config)}reset(){this.intervalAnalyzer.reset(),this.directionAnalyzer.reset(),this.consistencyTracker.reset(),this.sessionData={startTime:Date.now(),totalAttempts:0,overallScore:0,performanceHistory:[],currentLevel:"beginner",achievements:new Set,lastAnalysis:null},this.performanceMetrics={averageSpeed:0,accuracyTrend:"stable",strengthAreas:[],improvementAreas:[],sessionProgress:0},this.log("ğŸ”„ EnhancedScoringEngine ãƒªã‚»ãƒƒãƒˆå®Œäº†")}}typeof window<"u"&&(window.EnhancedScoringEngine=Ht);const{Object:ir,console:cr}=zs,V="src/routes/training/random/+page.svelte";function Wn(a,e,t){const n=a.slice();return n[96]=e[t],n[98]=t,n}function Un(a,e,t){const n=a.slice();return n[99]=e[t],n}function Bt(a){var N,D,G;let e,t,n,s,r=(((N=a[23])==null?void 0:N.length)||0)+"",o,i,d,l,u,f=8-(((D=a[23])==null?void 0:D.length)||0)+"",h,m,p,S,A,L,E,w,T=Math.round((((G=a[23])==null?void 0:G.length)||0)/8*100)+"",R,O,b,_,z,x=a[0]==="results"&&Lt(a);const I={c:function(){e=C("div"),t=C("div"),n=C("div"),s=C("span"),o=ne(r),i=ne("/8"),d=X(),l=C("span"),u=ne("æ®‹ã‚Š "),h=ne(f),m=ne(" ã‚»ãƒƒã‚·ãƒ§ãƒ³"),p=X(),S=C("div"),A=C("div"),L=C("div"),E=X(),w=C("span"),R=ne(T),O=ne("%"),b=X(),x&&x.c(),_=Ve(),this.h()},l:function(P){e=M(P,"DIV",{class:!0});var W=B(e);t=M(W,"DIV",{class:!0});var j=B(t);n=M(j,"DIV",{class:!0});var $=B(n);s=M($,"SPAN",{class:!0});var ae=B(s);o=te(ae,r),i=te(ae,"/8"),ae.forEach(v),d=K($),l=M($,"SPAN",{class:!0});var De=B(l);u=te(De,"æ®‹ã‚Š "),h=te(De,f),m=te(De," ã‚»ãƒƒã‚·ãƒ§ãƒ³"),De.forEach(v),$.forEach(v),p=K(j),S=M(j,"DIV",{class:!0});var _e=B(S);A=M(_e,"DIV",{class:!0});var Pe=B(A);L=M(Pe,"DIV",{class:!0,style:!0}),B(L).forEach(v),Pe.forEach(v),E=K(_e),w=M(_e,"SPAN",{class:!0});var Se=B(w);R=te(Se,T),O=te(Se,"%"),Se.forEach(v),_e.forEach(v),j.forEach(v),W.forEach(v),b=K(P),x&&x.l(P),_=Ve(),this.h()},h:function(){var P;q(s,"class","completed-count svelte-1ktm6f3"),k(s,V,2486,12,84406),q(l,"class","remaining-text svelte-1ktm6f3"),k(l,V,2487,12,84488),q(n,"class","session-info svelte-1ktm6f3"),k(n,V,2485,10,84367),q(L,"class","progress-fill svelte-1ktm6f3"),Ge(L,"width",(((P=a[23])==null?void 0:P.length)||0)/8*100+"%"),k(L,V,2491,14,84681),q(A,"class","progress-bar svelte-1ktm6f3"),k(A,V,2490,12,84640),q(w,"class","progress-text svelte-1ktm6f3"),k(w,V,2493,12,84807),q(S,"class","progress-section svelte-1ktm6f3"),k(S,V,2489,10,84597),q(t,"class","session-status svelte-1ktm6f3"),k(t,V,2484,8,84328),q(e,"class","session-progress svelte-1ktm6f3"),k(e,V,2483,6,84289)},m:function(P,W){Y(P,e,W),y(e,t),y(t,n),y(n,s),y(s,o),y(s,i),y(n,d),y(n,l),y(l,u),y(l,h),y(l,m),y(t,p),y(t,S),y(S,A),y(A,L),y(S,E),y(S,w),y(w,R),y(w,O),Y(P,b,W),x&&x.m(P,W),Y(P,_,W),z=!0},p:function(P,W){var j,$,ae,De;(!z||W[0]&8388608)&&r!==(r=(((j=P[23])==null?void 0:j.length)||0)+"")&&Ee(o,r),(!z||W[0]&8388608)&&f!==(f=8-((($=P[23])==null?void 0:$.length)||0)+"")&&Ee(h,f),(!z||W[0]&8388608)&&Ge(L,"width",(((ae=P[23])==null?void 0:ae.length)||0)/8*100+"%"),(!z||W[0]&8388608)&&T!==(T=Math.round((((De=P[23])==null?void 0:De.length)||0)/8*100)+"")&&Ee(R,T),P[0]==="results"?x?(x.p(P,W),W[0]&1&&U(x,1)):(x=Lt(P),x.c(),U(x,1),x.m(_.parentNode,_)):x&&(Ie(),ee(x,1,1,()=>{x=null}),Ne())},i:function(P){z||(U(x),z=!0)},o:function(P){ee(x),z=!1},d:function(P){P&&(v(e),v(b),v(_)),x&&x.d(P)}};return se("SvelteRegisterBlock",{block:I,id:Bt.name,type:"if",source:"(2483:4) {#if microphoneState === 'granted' && !$isLoading}",ctx:a}),I}function Lt(a){let e,t,n;t=new on({props:{isCompleted:a[5],position:"top"},$$inline:!0}),t.$on("action",a[29]);const s={c:function(){e=C("div"),ye(t.$$.fragment),this.h()},l:function(o){e=M(o,"DIV",{class:!0});var i=B(e);pe(t.$$.fragment,i),i.forEach(v),this.h()},h:function(){q(e,"class","top-action-buttons svelte-1ktm6f3"),k(e,V,2501,8,85046)},m:function(o,i){Y(o,e,i),he(t,e,null),n=!0},p:function(o,i){const d={};i[0]&32&&(d.isCompleted=o[5]),t.$set(d)},i:function(o){n||(U(t.$$.fragment,o),n=!0)},o:function(o){ee(t.$$.fragment,o),n=!1},d:function(o){o&&v(e),ge(t)}};return se("SvelteRegisterBlock",{block:s,id:Lt.name,type:"if",source:"(2501:6) {#if trainingPhase === 'results'}",ctx:a}),s}function as(a){let e,t;e=new Qe({props:{class:"error-card",$$slots:{default:[us]},$$scope:{ctx:a}},$$inline:!0});const n={c:function(){ye(e.$$.fragment)},l:function(r){pe(e.$$.fragment,r)},m:function(r,o){he(e,r,o),t=!0},p:function(r,o){const i={};o[3]&512&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i:function(r){t||(U(e.$$.fragment,r),t=!0)},o:function(r){ee(e.$$.fragment,r),t=!1},d:function(r){ge(e,r)}};return se("SvelteRegisterBlock",{block:n,id:as.name,type:"else",source:"(2692:2) {:else}",ctx:a}),n}function is(a){let e,t,n,s,r,o,i,d={isActive:a[1]==="granted",trainingPhase:a[0],className:"pitch-detector-content",debugMode:!0,disableHarmonicCorrection:!1};t=new $n({props:d,$$inline:!0}),a[33](t),t.$on("pitchUpdate",a[28]),t.$on("stateChange",ws),t.$on("error",_s),t.$on("microphoneHealthChange",a[30]);let l=a[0]!=="results"&&Vt(a),u=a[0]!=="results"&&Wt(a),f=a[0]==="results"&&Jt(a);const h={c:function(){e=C("div"),ye(t.$$.fragment),n=X(),l&&l.c(),s=X(),u&&u.c(),r=X(),f&&f.c(),o=Ve(),this.h()},l:function(p){e=M(p,"DIV",{style:!0});var S=B(e);pe(t.$$.fragment,S),S.forEach(v),n=K(p),l&&l.l(p),s=K(p),u&&u.l(p),r=K(p),f&&f.l(p),o=Ve(),this.h()},h:function(){Ge(e,"display","none"),k(e,V,2520,4,85526)},m:function(p,S){Y(p,e,S),he(t,e,null),Y(p,n,S),l&&l.m(p,S),Y(p,s,S),u&&u.m(p,S),Y(p,r,S),f&&f.m(p,S),Y(p,o,S),i=!0},p:function(p,S){const A={};S[0]&2&&(A.isActive=p[1]==="granted"),S[0]&1&&(A.trainingPhase=p[0]),t.$set(A),p[0]!=="results"?l?(l.p(p,S),S[0]&1&&U(l,1)):(l=Vt(p),l.c(),U(l,1),l.m(s.parentNode,s)):l&&(Ie(),ee(l,1,1,()=>{l=null}),Ne()),p[0]!=="results"?u?(u.p(p,S),S[0]&1&&U(u,1)):(u=Wt(p),u.c(),U(u,1),u.m(r.parentNode,r)):u&&(Ie(),ee(u,1,1,()=>{u=null}),Ne()),p[0]==="results"?f?(f.p(p,S),S[0]&1&&U(f,1)):(f=Jt(p),f.c(),U(f,1),f.m(o.parentNode,o)):f&&(Ie(),ee(f,1,1,()=>{f=null}),Ne())},i:function(p){i||(U(t.$$.fragment,p),U(l),U(u),U(f),i=!0)},o:function(p){ee(t.$$.fragment,p),ee(l),ee(u),ee(f),i=!1},d:function(p){p&&(v(e),v(n),v(s),v(r),v(o)),a[33](null),ge(t),l&&l.d(p),u&&u.d(p),f&&f.d(p)}};return se("SvelteRegisterBlock",{block:h,id:is.name,type:"if",source:"(2519:2) {#if microphoneState === 'granted'}",ctx:a}),h}function cs(a){let e;const t={c:function(){e=ne("ğŸ¤ ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã¸ç§»å‹•")},l:function(s){e=te(s,"ğŸ¤ ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã¸ç§»å‹•")},m:function(s,r){Y(s,e,r)},d:function(s){s&&v(e)}};return se("SvelteRegisterBlock",{block:t,id:cs.name,type:"slot",source:'(2706:10) <Button variant=\\"primary\\" on:click={goToMicrophoneTest}>',ctx:a}),t}function ls(a){let e;const t={c:function(){e=ne("ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹")},l:function(s){e=te(s,"ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹")},m:function(s,r){Y(s,e,r)},d:function(s){s&&v(e)}};return se("SvelteRegisterBlock",{block:t,id:ls.name,type:"slot",source:'(2709:10) <Button variant=\\"secondary\\" on:click={goHome}>',ctx:a}),t}function us(a){let e,t,n="ğŸ¤",s,r,o="ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãŒå¿…è¦ã§ã™",i,d,l="ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’é–‹å§‹ã™ã‚‹å‰ã«ã€ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã§éŸ³å£°å…¥åŠ›ã®ç¢ºèªã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚",u,f,h,m,p,S="ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œ",A,L,E,w="ã¾ãšã¯ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã§éŸ³å£°ç¢ºèªã‚’è¡Œã£ã¦ãã ã•ã„ã€‚",T,R,O,b,_,z;O=new ft({props:{variant:"primary",$$slots:{default:[cs]},$$scope:{ctx:a}},$$inline:!0}),O.$on("click",a[26]),_=new ft({props:{variant:"secondary",$$slots:{default:[ls]},$$scope:{ctx:a}},$$inline:!0}),_.$on("click",a[27]);const x={c:function(){e=C("div"),t=C("div"),t.textContent=n,s=X(),r=C("h3"),r.textContent=o,i=X(),d=C("p"),d.textContent=l,u=X(),f=C("div"),h=C("p"),m=ne("ã“ã®ãƒšãƒ¼ã‚¸ã¯"),p=C("strong"),p.textContent=S,A=ne("ã«ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚"),L=X(),E=C("p"),E.textContent=w,T=X(),R=C("div"),ye(O.$$.fragment),b=X(),ye(_.$$.fragment),this.h()},l:function(N){e=M(N,"DIV",{class:!0});var D=B(e);t=M(D,"DIV",{class:!0,"data-svelte-h":!0}),ve(t)!=="svelte-15rbx8n"&&(t.textContent=n),s=K(D),r=M(D,"H3",{class:!0,"data-svelte-h":!0}),ve(r)!=="svelte-17kvze2"&&(r.textContent=o),i=K(D),d=M(D,"P",{class:!0,"data-svelte-h":!0}),ve(d)!=="svelte-12s9olt"&&(d.textContent=l),u=K(D),f=M(D,"DIV",{class:!0});var G=B(f);h=M(G,"P",{class:!0});var J=B(h);m=te(J,"ã“ã®ãƒšãƒ¼ã‚¸ã¯"),p=M(J,"STRONG",{"data-svelte-h":!0}),ve(p)!=="svelte-1n3qsr6"&&(p.textContent=S),A=te(J,"ã«ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚"),J.forEach(v),L=K(G),E=M(G,"P",{class:!0,"data-svelte-h":!0}),ve(E)!=="svelte-v8nd09"&&(E.textContent=w),G.forEach(v),T=K(D),R=M(D,"DIV",{class:!0});var P=B(R);pe(O.$$.fragment,P),b=K(P),pe(_.$$.fragment,P),P.forEach(v),D.forEach(v),this.h()},h:function(){q(t,"class","error-icon svelte-1ktm6f3"),k(t,V,2695,8,91236),q(r,"class","svelte-1ktm6f3"),k(r,V,2696,8,91277),q(d,"class","svelte-1ktm6f3"),k(d,V,2697,8,91306),k(p,V,2700,19,91424),q(h,"class","svelte-1ktm6f3"),k(h,V,2700,10,91415),q(E,"class","svelte-1ktm6f3"),k(E,V,2701,10,91476),q(f,"class","recommendation svelte-1ktm6f3"),k(f,V,2699,8,91376),q(R,"class","action-buttons"),k(R,V,2704,8,91542),q(e,"class","error-content svelte-1ktm6f3"),k(e,V,2694,6,91200)},m:function(N,D){Y(N,e,D),y(e,t),y(e,s),y(e,r),y(e,i),y(e,d),y(e,u),y(e,f),y(f,h),y(h,m),y(h,p),y(h,A),y(f,L),y(f,E),y(e,T),y(e,R),he(O,R,null),y(R,b),he(_,R,null),z=!0},p:function(N,D){const G={};D[3]&512&&(G.$$scope={dirty:D,ctx:N}),O.$set(G);const J={};D[3]&512&&(J.$$scope={dirty:D,ctx:N}),_.$set(J)},i:function(N){z||(U(O.$$.fragment,N),U(_.$$.fragment,N),z=!0)},o:function(N){ee(O.$$.fragment,N),ee(_.$$.fragment,N),z=!1},d:function(N){N&&v(e),ge(O),ge(_)}};return se("SvelteRegisterBlock",{block:x,id:us.name,type:"slot",source:'(2694:4) <Card class=\\"error-card\\">',ctx:a}),x}function Vt(a){let e,t,n,s,r,o,i=!a[2]&&a[6].length>0&&jt(a);n=new Qe({props:{class:"main-card half-width",$$slots:{default:[ys]},$$scope:{ctx:a}},$$inline:!0}),r=new Yn({props:{frequency:a[14],note:a[15],volume:a[13],isMuted:a[0]!=="guiding",muteMessage:"åŸºéŸ³å†ç”Ÿå¾Œã«é–‹å§‹",className:"half-width",showGuidance:!1},$$inline:!0});const d={c:function(){i&&i.c(),e=X(),t=C("div"),ye(n.$$.fragment),s=X(),ye(r.$$.fragment),this.h()},l:function(u){i&&i.l(u),e=K(u),t=M(u,"DIV",{class:!0});var f=B(t);pe(n.$$.fragment,f),s=K(f),pe(r.$$.fragment,f),f.forEach(v),this.h()},h:function(){q(t,"class","side-by-side-container svelte-1ktm6f3"),k(t,V,2559,6,86863)},m:function(u,f){i&&i.m(u,f),Y(u,e,f),Y(u,t,f),he(n,t,null),y(t,s),he(r,t,null),o=!0},p:function(u,f){!u[2]&&u[6].length>0?i?(i.p(u,f),f[0]&68&&U(i,1)):(i=jt(u),i.c(),U(i,1),i.m(e.parentNode,e)):i&&(Ie(),ee(i,1,1,()=>{i=null}),Ne());const h={};f[0]&7041|f[3]&512&&(h.$$scope={dirty:f,ctx:u}),n.$set(h);const m={};f[0]&16384&&(m.frequency=u[14]),f[0]&32768&&(m.note=u[15]),f[0]&8192&&(m.volume=u[13]),f[0]&1&&(m.isMuted=u[0]!=="guiding"),r.$set(m)},i:function(u){o||(U(i),U(n.$$.fragment,u),U(r.$$.fragment,u),o=!0)},o:function(u){ee(i),ee(n.$$.fragment,u),ee(r.$$.fragment,u),o=!1},d:function(u){u&&(v(e),v(t)),i&&i.d(u),ge(n),ge(r)}};return se("SvelteRegisterBlock",{block:d,id:Vt.name,type:"if",source:"(2538:4) {#if trainingPhase !== 'results'}",ctx:a}),d}function jt(a){let e,t;e=new Qe({props:{class:"warning-card",$$slots:{default:[ds]},$$scope:{ctx:a}},$$inline:!0});const n={c:function(){ye(e.$$.fragment)},l:function(r){pe(e.$$.fragment,r)},m:function(r,o){he(e,r,o),t=!0},p:function(r,o){const i={};o[0]&64|o[3]&512&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i:function(r){t||(U(e.$$.fragment,r),t=!0)},o:function(r){ee(e.$$.fragment,r),t=!1},d:function(r){ge(e,r)}};return se("SvelteRegisterBlock",{block:n,id:jt.name,type:"if",source:"(2541:6) {#if !microphoneHealthy && microphoneErrors.length > 0}",ctx:a}),n}function Ot(a){let e,t=a[99]+"",n;const s={c:function(){e=C("li"),n=ne(t),this.h()},l:function(o){e=M(o,"LI",{class:!0});var i=B(e);n=te(i,t),i.forEach(v),this.h()},h:function(){q(e,"class","svelte-1ktm6f3"),k(e,V,2549,16,86631)},m:function(o,i){Y(o,e,i),y(e,n)},p:function(o,i){i[0]&64&&t!==(t=o[99]+"")&&Ee(n,t)},d:function(o){o&&v(e)}};return se("SvelteRegisterBlock",{block:s,id:Ot.name,type:"each",source:"(2549:14) {#each microphoneErrors as error}",ctx:a}),s}function ds(a){let e,t,n="âš ï¸ ãƒã‚¤ã‚¯æ¥ç¶šã«å•é¡ŒãŒã‚ã‚Šã¾ã™",s,r,o,i="ãƒã‚¤ã‚¯ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã›ã‚“ã€‚ä»¥ä¸‹ã®å•é¡ŒãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸï¼š",d,l,u,f,h,m="è§£æ±ºæ–¹æ³•:",p,S=Xe(a[6]),A=[];for(let E=0;E<S.length;E+=1)A[E]=Ot(Un(a,S,E));const L={c:function(){e=C("div"),t=C("h3"),t.textContent=n,s=X(),r=C("div"),o=C("p"),o.textContent=i,d=X(),l=C("ul");for(let w=0;w<A.length;w+=1)A[w].c();u=X(),f=C("p"),h=C("strong"),h.textContent=m,p=ne(" ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãƒã‚¤ã‚¯è¨±å¯ã‚’å†åº¦å–å¾—ã—ã¦ãã ã•ã„ã€‚"),this.h()},l:function(w){e=M(w,"DIV",{class:!0});var T=B(e);t=M(T,"H3",{class:!0,"data-svelte-h":!0}),ve(t)!=="svelte-15qec5x"&&(t.textContent=n),T.forEach(v),s=K(w),r=M(w,"DIV",{class:!0});var R=B(r);o=M(R,"P",{class:!0,"data-svelte-h":!0}),ve(o)!=="svelte-171o2p0"&&(o.textContent=i),d=K(R),l=M(R,"UL",{class:!0});var O=B(l);for(let _=0;_<A.length;_+=1)A[_].l(O);O.forEach(v),u=K(R),f=M(R,"P",{class:!0});var b=B(f);h=M(b,"STRONG",{"data-svelte-h":!0}),ve(h)!=="svelte-79o66n"&&(h.textContent=m),p=te(b," ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãƒã‚¤ã‚¯è¨±å¯ã‚’å†åº¦å–å¾—ã—ã¦ãã ã•ã„ã€‚"),b.forEach(v),R.forEach(v),this.h()},h:function(){q(t,"class","section-title svelte-1ktm6f3"),k(t,V,2543,12,86355),q(e,"class","card-header svelte-1ktm6f3"),k(e,V,2542,10,86317),q(o,"class","warning-message svelte-1ktm6f3"),k(o,V,2546,12,86469),q(l,"class","error-list svelte-1ktm6f3"),k(l,V,2547,12,86543),k(h,V,2553,14,86742),q(f,"class","fix-instruction svelte-1ktm6f3"),k(f,V,2552,12,86700),q(r,"class","card-content svelte-1ktm6f3"),k(r,V,2545,10,86430)},m:function(w,T){Y(w,e,T),y(e,t),Y(w,s,T),Y(w,r,T),y(r,o),y(r,d),y(r,l);for(let R=0;R<A.length;R+=1)A[R]&&A[R].m(l,null);y(r,u),y(r,f),y(f,h),y(f,p)},p:function(w,T){if(T[0]&64){S=Xe(w[6]);let R;for(R=0;R<S.length;R+=1){const O=Un(w,S,R);A[R]?A[R].p(O,T):(A[R]=Ot(O),A[R].c(),A[R].m(l,null))}for(;R<A.length;R+=1)A[R].d(1);A.length=S.length}},d:function(w){w&&(v(e),v(s),v(r)),rn(A,w)}};return se("SvelteRegisterBlock",{block:L,id:ds.name,type:"slot",source:'(2542:8) <Card class=\\"warning-card\\">',ctx:a}),L}function fs(a){let e;const t={c:function(){e=ne("ğŸ¹ ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³å†ç”Ÿ")},l:function(s){e=te(s,"ğŸ¹ ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³å†ç”Ÿ")},m:function(s,r){Y(s,e,r)},p:Xn,d:function(s){s&&v(e)}};return se("SvelteRegisterBlock",{block:t,id:fs.name,type:"else",source:"(2576:14) {:else}",ctx:a}),t}function ms(a){let e,t,n;const s={c:function(){e=ne("ğŸ”„ "),t=ne(a[7]),n=ne(" å†ç”Ÿ")},l:function(o){e=te(o,"ğŸ”„ "),t=te(o,a[7]),n=te(o," å†ç”Ÿ")},m:function(o,i){Y(o,e,i),Y(o,t,i),Y(o,n,i)},p:function(o,i){i[0]&128&&Ee(t,o[7])},d:function(o){o&&(v(e),v(t),v(n))}};return se("SvelteRegisterBlock",{block:s,id:ms.name,type:"if",source:"(2574:68) ",ctx:a}),s}function gs(a){let e;const t={c:function(){e=ne("ğŸµ å†ç”Ÿä¸­...")},l:function(s){e=te(s,"ğŸµ å†ç”Ÿä¸­...")},m:function(s,r){Y(s,e,r)},p:Xn,d:function(s){s&&v(e)}};return se("SvelteRegisterBlock",{block:t,id:gs.name,type:"if",source:"(2572:14) {#if isPlaying}",ctx:a}),t}function hs(a){let e;function t(o,i){return o[9]?gs:o[7]&&o[8]>0?ms:fs}let n=t(a),s=n(a);const r={c:function(){s.c(),e=Ve()},l:function(i){s.l(i),e=Ve()},m:function(i,d){s.m(i,d),Y(i,e,d)},p:function(i,d){n===(n=t(i))&&s?s.p(i,d):(s.d(1),s=n(i),s&&(s.c(),s.m(e.parentNode,e)))},d:function(i){i&&v(e),s.d(i)}};return se("SvelteRegisterBlock",{block:r,id:hs.name,type:"slot",source:`(2567:12) <Button                variant=\\"primary\\"               disabled={isPlaying || trainingPhase === 'guiding' || trainingPhase === 'waiting'}               on:click={playBaseNote}             >`,ctx:a}),r}function Gt(a){let e,t,n,s,r,o=a[8].toFixed(1)+"",i,d;const l={c:function(){e=C("div"),t=ne("ç¾åœ¨ã®åŸºéŸ³: "),n=C("strong"),s=ne(a[7]),r=ne(" ("),i=ne(o),d=ne("Hz)"),this.h()},l:function(f){e=M(f,"DIV",{class:!0});var h=B(e);t=te(h,"ç¾åœ¨ã®åŸºéŸ³: "),n=M(h,"STRONG",{});var m=B(n);s=te(m,a[7]),m.forEach(v),r=te(h," ("),i=te(h,o),d=te(h,"Hz)"),h.forEach(v),this.h()},h:function(){k(n,V,2582,23,87692),q(e,"class","base-note-info svelte-1ktm6f3"),k(e,V,2581,14,87640)},m:function(f,h){Y(f,e,h),y(e,t),y(e,n),y(n,s),y(e,r),y(e,i),y(e,d)},p:function(f,h){h[0]&128&&Ee(s,f[7]),h[0]&256&&o!==(o=f[8].toFixed(1)+"")&&Ee(i,o)},d:function(f){f&&v(e)}};return se("SvelteRegisterBlock",{block:l,id:Gt.name,type:"if",source:"(2581:12) {#if currentBaseNote}",ctx:a}),l}function ys(a){let e,t,n="ğŸ¹ åŸºéŸ³å†ç”Ÿ",s,r,o,i,d,l,u,f="ã‚¬ã‚¤ãƒ‰é–‹å§‹ã¾ã§",h,m,p,S,A,L,E,w;o=new ft({props:{variant:"primary",disabled:a[9]||a[0]==="guiding"||a[0]==="waiting",$$slots:{default:[hs]},$$scope:{ctx:a}},$$inline:!0}),o.$on("click",a[25]);let T=a[7]&&Gt(a);L=new ts({props:{size:"20"},$$inline:!0});const R={c:function(){e=C("div"),t=C("h3"),t.textContent=n,s=X(),r=C("div"),ye(o.$$.fragment),i=X(),T&&T.c(),d=X(),l=C("div"),u=C("div"),u.textContent=f,h=X(),m=C("div"),p=C("div"),S=X(),A=C("div"),ye(L.$$.fragment),this.h()},l:function(b){e=M(b,"DIV",{class:!0});var _=B(e);t=M(_,"H3",{class:!0,"data-svelte-h":!0}),ve(t)!=="svelte-syc53b"&&(t.textContent=n),_.forEach(v),s=K(b),r=M(b,"DIV",{class:!0});var z=B(r);pe(o.$$.fragment,z),i=K(z),T&&T.l(z),d=K(z),l=M(z,"DIV",{class:!0});var x=B(l);u=M(x,"DIV",{class:!0,"data-svelte-h":!0}),ve(u)!=="svelte-1dufnpv"&&(u.textContent=f),h=K(x),m=M(x,"DIV",{class:!0});var I=B(m);p=M(I,"DIV",{class:!0,style:!0}),B(p).forEach(v),S=K(I),A=M(I,"DIV",{class:!0});var N=B(A);pe(L.$$.fragment,N),N.forEach(v),I.forEach(v),x.forEach(v),z.forEach(v),this.h()},h:function(){q(t,"class","section-title svelte-1ktm6f3"),k(t,V,2563,12,87027),q(e,"class","card-header svelte-1ktm6f3"),k(e,V,2562,10,86989),q(u,"class","guide-start-label svelte-1ktm6f3"),k(u,V,2588,14,87917),q(p,"class","guide-progress-fill svelte-1ktm6f3"),Ge(p,"width",a[11]+"%"),k(p,V,2590,16,88022),q(A,"class",E="guide-music-icon "+(a[12]?"glowing":"")+" svelte-1ktm6f3"),k(A,V,2594,16,88170),q(m,"class","guide-start-bar svelte-1ktm6f3"),k(m,V,2589,14,87976),q(l,"class","guide-start-bar-container svelte-1ktm6f3"),k(l,V,2587,12,87863),q(r,"class","card-content svelte-1ktm6f3"),k(r,V,2565,10,87093)},m:function(b,_){Y(b,e,_),y(e,t),Y(b,s,_),Y(b,r,_),he(o,r,null),y(r,i),T&&T.m(r,null),y(r,d),y(r,l),y(l,u),y(l,h),y(l,m),y(m,p),y(m,S),y(m,A),he(L,A,null),w=!0},p:function(b,_){const z={};_[0]&513&&(z.disabled=b[9]||b[0]==="guiding"||b[0]==="waiting"),_[0]&896|_[3]&512&&(z.$$scope={dirty:_,ctx:b}),o.$set(z),b[7]?T?T.p(b,_):(T=Gt(b),T.c(),T.m(r,d)):T&&(T.d(1),T=null),(!w||_[0]&2048)&&Ge(p,"width",b[11]+"%"),(!w||_[0]&4096&&E!==(E="guide-music-icon "+(b[12]?"glowing":"")+" svelte-1ktm6f3"))&&q(A,"class",E)},i:function(b){w||(U(o.$$.fragment,b),U(L.$$.fragment,b),w=!0)},o:function(b){ee(o.$$.fragment,b),ee(L.$$.fragment,b),w=!1},d:function(b){b&&(v(e),v(s),v(r)),ge(o),T&&T.d(),ge(L)}};return se("SvelteRegisterBlock",{block:R,id:ys.name,type:"slot",source:'(2562:8) <Card class=\\"main-card half-width\\">',ctx:a}),R}function Wt(a){let e,t;e=new Qe({props:{class:"main-card",$$slots:{default:[ps]},$$scope:{ctx:a}},$$inline:!0});const n={c:function(){ye(e.$$.fragment)},l:function(r){pe(e.$$.fragment,r)},m:function(r,o){he(e,r,o),t=!0},p:function(r,o){const i={};o[0]&1025|o[3]&512&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i:function(r){t||(U(e.$$.fragment,r),t=!0)},o:function(r){ee(e.$$.fragment,r),t=!1},d:function(r){ge(e,r)}};return se("SvelteRegisterBlock",{block:n,id:Wt.name,type:"if",source:"(2616:4) {#if trainingPhase !== 'results'}",ctx:a}),n}function Ut(a){let e,t=a[96].name+"",n,s,r;const o={c:function(){e=C("div"),n=ne(t),s=X(),this.h()},l:function(d){e=M(d,"DIV",{class:!0});var l=B(e);n=te(l,t),s=K(l),l.forEach(v),this.h()},h:function(){q(e,"class",r="scale-item "+a[96].state+" svelte-1ktm6f3"),k(e,V,2624,14,89072)},m:function(d,l){Y(d,e,l),y(e,n),y(e,s)},p:function(d,l){l[0]&1024&&t!==(t=d[96].name+"")&&Ee(n,t),l[0]&1024&&r!==(r="scale-item "+d[96].state+" svelte-1ktm6f3")&&q(e,"class",r)},d:function(d){d&&v(e)}};return se("SvelteRegisterBlock",{block:o,id:Ut.name,type:"each",source:"(2624:12) {#each scaleSteps as step, index}",ctx:a}),o}function Zt(a){let e,t,n,s="ãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚·ãƒ‰",r;const o={c:function(){e=C("div"),t=ne("ã‚¬ã‚¤ãƒ‰ã«åˆã‚ã›ã¦ "),n=C("strong"),n.textContent=s,r=ne(" ã‚’æ­Œã£ã¦ãã ã•ã„"),this.h()},l:function(d){e=M(d,"DIV",{class:!0});var l=B(e);t=te(l,"ã‚¬ã‚¤ãƒ‰ã«åˆã‚ã›ã¦ "),n=M(l,"STRONG",{"data-svelte-h":!0}),ve(n)!=="svelte-1dipf74"&&(n.textContent=s),r=te(l," ã‚’æ­Œã£ã¦ãã ã•ã„"),l.forEach(v),this.h()},h:function(){k(n,V,2633,23,89339),q(e,"class","guide-instruction svelte-1ktm6f3"),k(e,V,2632,12,89284)},m:function(d,l){Y(d,e,l),y(e,t),y(e,n),y(e,r)},d:function(d){d&&v(e)}};return se("SvelteRegisterBlock",{block:o,id:Zt.name,type:"if",source:"(2632:10) {#if trainingPhase === 'guiding'}",ctx:a}),o}function ps(a){let e,t,n="ğŸµ ãƒ‰ãƒ¬ãƒŸéŸ³éšã‚¬ã‚¤ãƒ‰",s,r,o,i,d=Xe(a[10]),l=[];for(let h=0;h<d.length;h+=1)l[h]=Ut(Wn(a,d,h));let u=a[0]==="guiding"&&Zt(a);const f={c:function(){e=C("div"),t=C("h3"),t.textContent=n,s=X(),r=C("div"),o=C("div");for(let m=0;m<l.length;m+=1)l[m].c();i=X(),u&&u.c(),this.h()},l:function(m){e=M(m,"DIV",{class:!0});var p=B(e);t=M(p,"H3",{class:!0,"data-svelte-h":!0}),ve(t)!=="svelte-1mor0as"&&(t.textContent=n),p.forEach(v),s=K(m),r=M(m,"DIV",{class:!0});var S=B(r);o=M(S,"DIV",{class:!0});var A=B(o);for(let L=0;L<l.length;L+=1)l[L].l(A);A.forEach(v),i=K(S),u&&u.l(S),S.forEach(v),this.h()},h:function(){q(t,"class","section-title svelte-1ktm6f3"),k(t,V,2619,10,88883),q(e,"class","card-header svelte-1ktm6f3"),k(e,V,2618,8,88847),q(o,"class","scale-guide svelte-1ktm6f3"),k(o,V,2622,10,88986),q(r,"class","card-content svelte-1ktm6f3"),k(r,V,2621,8,88949)},m:function(m,p){Y(m,e,p),y(e,t),Y(m,s,p),Y(m,r,p),y(r,o);for(let S=0;S<l.length;S+=1)l[S]&&l[S].m(o,null);y(r,i),u&&u.m(r,null)},p:function(m,p){if(p[0]&1024){d=Xe(m[10]);let S;for(S=0;S<d.length;S+=1){const A=Wn(m,d,S);l[S]?l[S].p(A,p):(l[S]=Ut(A),l[S].c(),l[S].m(o,null))}for(;S<l.length;S+=1)l[S].d(1);l.length=d.length}m[0]==="guiding"?u||(u=Zt(m),u.c(),u.m(r,null)):u&&(u.d(1),u=null)},d:function(m){m&&(v(e),v(s),v(r)),rn(l,m),u&&u.d()}};return se("SvelteRegisterBlock",{block:f,id:ps.name,type:"slot",source:'(2618:6) <Card class=\\"main-card\\">',ctx:a}),f}function Jt(a){let e,t,n,s,r;const o=[Ss,vs],i=[];function d(f,h){return f[4]&&f[5]?0:f[21]?1:-1}~(e=d(a))&&(t=i[e]=o[e](a));let l=a[0]==="results"&&Kt(a);const u={c:function(){t&&t.c(),n=X(),l&&l.c(),s=Ve()},l:function(h){t&&t.l(h),n=K(h),l&&l.l(h),s=Ve()},m:function(h,m){~e&&i[e].m(h,m),Y(h,n,m),l&&l.m(h,m),Y(h,s,m),r=!0},p:function(h,m){let p=e;e=d(h),e===p?~e&&i[e].p(h,m):(t&&(Ie(),ee(i[p],1,1,()=>{i[p]=null}),Ne()),~e?(t=i[e],t?t.p(h,m):(t=i[e]=o[e](h),t.c()),U(t,1),t.m(n.parentNode,n)):t=null),h[0]==="results"?l?(l.p(h,m),m[0]&1&&U(l,1)):(l=Kt(h),l.c(),U(l,1),l.m(s.parentNode,s)):l&&(Ie(),ee(l,1,1,()=>{l=null}),Ne())},i:function(h){r||(U(t),U(l),r=!0)},o:function(h){ee(t),ee(l),r=!1},d:function(h){h&&(v(n),v(s)),~e&&i[e].d(h),l&&l.d(h)}};return se("SvelteRegisterBlock",{block:u,id:Jt.name,type:"if",source:"(2643:4) {#if trainingPhase === 'results'}",ctx:a}),u}function vs(a){let e,t;e=new an({props:{scoreData:a[21],showDetails:!1,className:"mb-6 iphone-no-margin",currentScoreData:a[16],intervalData:a[3],consistencyData:a[17],feedbackData:a[18],technicalFeedbackData:a[19],sessionStatistics:a[20]},$$inline:!0});const n={c:function(){ye(e.$$.fragment)},l:function(r){pe(e.$$.fragment,r)},m:function(r,o){he(e,r,o),t=!0},p:function(r,o){const i={};o[0]&2097152&&(i.scoreData=r[21]),o[0]&65536&&(i.currentScoreData=r[16]),o[0]&8&&(i.intervalData=r[3]),o[0]&131072&&(i.consistencyData=r[17]),o[0]&262144&&(i.feedbackData=r[18]),o[0]&524288&&(i.technicalFeedbackData=r[19]),o[0]&1048576&&(i.sessionStatistics=r[20]),e.$set(i)},i:function(r){t||(U(e.$$.fragment,r),t=!0)},o:function(r){ee(e.$$.fragment,r),t=!1},d:function(r){ge(e,r)}};return se("SvelteRegisterBlock",{block:n,id:vs.name,type:"if",source:"(2658:40) ",ctx:a}),n}function Ss(a){let e,t;e=new an({props:{scoreData:a[4],showDetails:!1,className:"mb-6 iphone-no-margin",currentScoreData:a[16],intervalData:a[3],consistencyData:a[17],feedbackData:a[18],technicalFeedbackData:a[19],sessionStatistics:a[20]},$$inline:!0});const n={c:function(){ye(e.$$.fragment)},l:function(r){pe(e.$$.fragment,r)},m:function(r,o){he(e,r,o),t=!0},p:function(r,o){const i={};o[0]&16&&(i.scoreData=r[4]),o[0]&65536&&(i.currentScoreData=r[16]),o[0]&8&&(i.intervalData=r[3]),o[0]&131072&&(i.consistencyData=r[17]),o[0]&262144&&(i.feedbackData=r[18]),o[0]&524288&&(i.technicalFeedbackData=r[19]),o[0]&1048576&&(i.sessionStatistics=r[20]),e.$set(i)},i:function(r){t||(U(e.$$.fragment,r),t=!0)},o:function(r){ee(e.$$.fragment,r),t=!1},d:function(r){ge(e,r)}};return se("SvelteRegisterBlock",{block:n,id:Ss.name,type:"if",source:"(2645:6) {#if $unifiedScoreData && $isCompleted}",ctx:a}),n}function Kt(a){let e,t;e=new Qe({props:{class:"main-card bottom-action-card",$$slots:{default:[bs]},$$scope:{ctx:a}},$$inline:!0});const n={c:function(){ye(e.$$.fragment)},l:function(r){pe(e.$$.fragment,r)},m:function(r,o){he(e,r,o),t=!0},p:function(r,o){const i={};o[0]&32|o[3]&512&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i:function(r){t||(U(e.$$.fragment,r),t=!0)},o:function(r){ee(e.$$.fragment,r),t=!1},d:function(r){ge(e,r)}};return se("SvelteRegisterBlock",{block:n,id:Kt.name,type:"if",source:"(2676:6) {#if trainingPhase === 'results'}",ctx:a}),n}function bs(a){let e,t,n;t=new on({props:{isCompleted:a[5],position:"bottom"},$$inline:!0}),t.$on("action",a[29]);const s={c:function(){e=C("div"),ye(t.$$.fragment),this.h()},l:function(o){e=M(o,"DIV",{class:!0});var i=B(e);pe(t.$$.fragment,i),i.forEach(v),this.h()},h:function(){q(e,"class","card-content svelte-1ktm6f3"),k(e,V,2677,10,90786)},m:function(o,i){Y(o,e,i),he(t,e,null),n=!0},p:function(o,i){const d={};i[0]&32&&(d.isCompleted=o[5]),t.$set(d)},i:function(o){n||(U(t.$$.fragment,o),n=!0)},o:function(o){ee(t.$$.fragment,o),n=!1},d:function(o){o&&v(e),ge(t)}};return se("SvelteRegisterBlock",{block:s,id:bs.name,type:"slot",source:'(2677:8) <Card class=\\"main-card bottom-action-card\\">',ctx:a}),s}function Ds(a){let e,t,n="ğŸµ ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",s,r,o="10ç¨®é¡ã®åŸºéŸ³ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠã—ã¦ãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚·ãƒ‰ã‚’ç·´ç¿’",i,d,l,u,f,h,m,p,S,A,L,E,w,T,R,O,b=a[1]==="granted"&&!a[24]&&Bt(a);const _=[is,as],z=[];function x(N,D){return N[1]==="granted"?0:1}w=x(a),T=z[w]=_[w](a);const I={c:function(){e=C("div"),t=C("h1"),t.textContent=n,s=X(),r=C("p"),r.textContent=o,i=X(),b&&b.c(),d=X(),l=C("div"),u=ne("ğŸ“± "),f=ne(Qt),h=ne(" | "),m=ne(Yt),p=C("br"),S=X(),A=C("small"),L=ne($t),E=X(),T.c(),R=Ve(),this.h()},l:function(D){e=M(D,"DIV",{class:!0});var G=B(e);t=M(G,"H1",{class:!0,"data-svelte-h":!0}),ve(t)!=="svelte-1ptm9zr"&&(t.textContent=n),s=K(G),r=M(G,"P",{class:!0,"data-svelte-h":!0}),ve(r)!=="svelte-19nes7"&&(r.textContent=o),i=K(G),b&&b.l(G),d=K(G),l=M(G,"DIV",{class:!0});var J=B(l);u=te(J,"ğŸ“± "),f=te(J,Qt),h=te(J," | "),m=te(J,Yt),p=M(J,"BR",{}),S=K(J),A=M(J,"SMALL",{style:!0});var P=B(A);L=te(P,$t),P.forEach(v),J.forEach(v),G.forEach(v),E=K(D),T.l(D),R=Ve(),this.h()},h:function(){q(t,"class","page-title svelte-1ktm6f3"),k(t,V,2477,4,84084),q(r,"class","page-description svelte-1ktm6f3"),k(r,V,2478,4,84132),k(p,V,2512,42,85345),Ge(A,"font-size","0.6rem"),k(A,V,2513,6,85357),q(l,"class","debug-info svelte-1ktm6f3"),k(l,V,2511,4,85278),q(e,"class","header-section svelte-1ktm6f3"),k(e,V,2476,2,84051)},m:function(D,G){Y(D,e,G),y(e,t),y(e,s),y(e,r),y(e,i),b&&b.m(e,null),y(e,d),y(e,l),y(l,u),y(l,f),y(l,h),y(l,m),y(l,p),y(l,S),y(l,A),y(A,L),Y(D,E,G),z[w].m(D,G),Y(D,R,G),O=!0},p:function(D,G){D[1]==="granted"&&!D[24]?b?(b.p(D,G),G[0]&16777218&&U(b,1)):(b=Bt(D),b.c(),U(b,1),b.m(e,d)):b&&(Ie(),ee(b,1,1,()=>{b=null}),Ne());let J=w;w=x(D),w===J?z[w].p(D,G):(Ie(),ee(z[J],1,1,()=>{z[J]=null}),Ne(),T=z[w],T?T.p(D,G):(T=z[w]=_[w](D),T.c()),U(T,1),T.m(R.parentNode,R))},i:function(D){O||(U(b),U(T),O=!0)},o:function(D){ee(b),ee(T),O=!1},d:function(D){D&&(v(e),v(E),v(R)),b&&b.d(),z[w].d(D)}};return se("SvelteRegisterBlock",{block:I,id:Ds.name,type:"slot",source:"(2475:0) <PageLayout>",ctx:a}),I}function Xt(a){let e,t;e=new Qn({props:{$$slots:{default:[Ds]},$$scope:{ctx:a}},$$inline:!0});const n={c:function(){ye(e.$$.fragment)},l:function(r){pe(e.$$.fragment,r)},m:function(r,o){he(e,r,o),t=!0},p:function(r,o){const i={};o[0]&33554431|o[3]&512&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i:function(r){t||(U(e.$$.fragment,r),t=!0)},o:function(r){ee(e.$$.fragment,r),t=!1},d:function(r){ge(e,r)}};return se("SvelteRegisterBlock",{block:n,id:Xt.name,type:"component",source:"",ctx:a}),n}const Qt="v2.3.1-ANIMATED",Yt="07/29 04:15",$t="ğŸ¬ è©•ä¾¡åˆ†å¸ƒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…ãƒ»UXå‘ä¸Š";function Zn(){const a=/iPhone/.test(navigator.userAgent),e=/iPad/.test(navigator.userAgent),t=/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document;return a||e||t?(console.log("ğŸ”Š [RandomTraining] iOS/iPadOSæ¤œå‡º - éŸ³é‡35dBè¨­å®š"),35):(console.log("ğŸ”Š [RandomTraining] PCæ¤œå‡º - éŸ³é‡-6dBè¨­å®š"),-6)}function lr(){return{mode:"random",timestamp:new Date,duration:480,totalNotes:64,measuredNotes:59,averageAccuracy:79,baseNote:"C5",baseFrequency:523.25,sessionHistory:[{grade:"excellent",accuracy:92,baseNote:"C4",baseFrequency:261.63,timestamp:new Date(Date.now()-7*6e4),measuredNotes:8,noteResults:[{name:"ãƒ‰",note:"ãƒ‰",frequency:262,detectedFrequency:264,cents:13,grade:"excellent"},{name:"ãƒ¬",note:"ãƒ¬",frequency:294,detectedFrequency:291,cents:-18,grade:"good"},{name:"ãƒŸ",note:"ãƒŸ",frequency:330,detectedFrequency:335,cents:26,grade:"pass"},{name:"ãƒ•ã‚¡",note:"ãƒ•ã‚¡",frequency:349,detectedFrequency:346,cents:-15,grade:"excellent"},{name:"ã‚½",note:"ã‚½",frequency:392,detectedFrequency:388,cents:-18,grade:"good"},{name:"ãƒ©",note:"ãƒ©",frequency:440,detectedFrequency:444,cents:16,grade:"good"},{name:"ã‚·",note:"ã‚·",frequency:494,detectedFrequency:499,cents:17,grade:"good"},{name:"ãƒ‰ï¼ˆé«˜ï¼‰",note:"ãƒ‰ï¼ˆé«˜ï¼‰",frequency:523,detectedFrequency:520,cents:-10,grade:"excellent"}]},{grade:"good",accuracy:78,baseNote:"D4",baseFrequency:293.66,timestamp:new Date(Date.now()-6*6e4),measuredNotes:7,noteResults:[{name:"ãƒ‰",note:"ãƒ‰",frequency:294,detectedFrequency:290,cents:-23,grade:"good"},{name:"ãƒ¬",note:"ãƒ¬",frequency:330,detectedFrequency:340,cents:53,grade:"needWork"},{name:"ãƒŸ",note:"ãƒŸ",frequency:370,detectedFrequency:375,cents:23,grade:"good"},{name:"ãƒ•ã‚¡",note:"ãƒ•ã‚¡",frequency:392,detectedFrequency:385,cents:-31,grade:"pass"},{name:"ã‚½",note:"ã‚½",frequency:440,detectedFrequency:432,cents:-31,grade:"pass"},{name:"ãƒ©",note:"ãƒ©",frequency:494,detectedFrequency:510,cents:56,grade:"needWork"},{name:"ã‚·",note:"ã‚·",frequency:554,detectedFrequency:null,cents:null,grade:"notMeasured"},{name:"ãƒ‰ï¼ˆé«˜ï¼‰",note:"ãƒ‰ï¼ˆé«˜ï¼‰",frequency:587,detectedFrequency:580,cents:-21,grade:"good"}]},{grade:"excellent",accuracy:95,baseNote:"E4",baseFrequency:329.63,timestamp:new Date(Date.now()-5*6e4),measuredNotes:8,noteResults:[{name:"ãƒ‰",note:"ãƒ‰",frequency:330,detectedFrequency:332,cents:10,grade:"excellent"},{name:"ãƒ¬",note:"ãƒ¬",frequency:370,detectedFrequency:368,cents:-9,grade:"excellent"},{name:"ãƒŸ",note:"ãƒŸ",frequency:415,detectedFrequency:418,cents:12,grade:"excellent"},{name:"ãƒ•ã‚¡",note:"ãƒ•ã‚¡",frequency:440,detectedFrequency:436,cents:-16,grade:"good"},{name:"ã‚½",note:"ã‚½",frequency:494,detectedFrequency:497,cents:11,grade:"excellent"},{name:"ãƒ©",note:"ãƒ©",frequency:554,detectedFrequency:551,cents:-9,grade:"excellent"},{name:"ã‚·",note:"ã‚·",frequency:622,detectedFrequency:625,cents:8,grade:"excellent"},{name:"ãƒ‰ï¼ˆé«˜ï¼‰",note:"ãƒ‰ï¼ˆé«˜ï¼‰",frequency:659,detectedFrequency:655,cents:-10,grade:"excellent"}]},{grade:"needWork",accuracy:45,baseNote:"F4",baseFrequency:349.23,timestamp:new Date(Date.now()-4*6e4),measuredNotes:6,noteResults:[{name:"ãƒ‰",note:"ãƒ‰",frequency:349,detectedFrequency:345,cents:-20,grade:"good"},{name:"ãƒ¬",note:"ãƒ¬",frequency:392,detectedFrequency:420,cents:124,grade:"needWork"},{name:"ãƒŸ",note:"ãƒŸ",frequency:440,detectedFrequency:435,cents:-20,grade:"good"},{name:"ãƒ•ã‚¡",note:"ãƒ•ã‚¡",frequency:466,detectedFrequency:520,cents:195,grade:"needWork"},{name:"ã‚½",note:"ã‚½",frequency:523,detectedFrequency:410,cents:-455,grade:"needWork"},{name:"ãƒ©",note:"ãƒ©",frequency:587,detectedFrequency:null,cents:null,grade:"notMeasured"},{name:"ã‚·",note:"ã‚·",frequency:659,detectedFrequency:650,cents:-24,grade:"good"},{name:"ãƒ‰ï¼ˆé«˜ï¼‰",note:"ãƒ‰ï¼ˆé«˜ï¼‰",frequency:698,detectedFrequency:null,cents:null,grade:"notMeasured"}]},{grade:"good",accuracy:85,baseNote:"G4",baseFrequency:392,timestamp:new Date(Date.now()-3*6e4),measuredNotes:8,noteResults:[{name:"ãƒ‰",note:"ãƒ‰",frequency:392,detectedFrequency:395,cents:13,grade:"excellent"},{name:"ãƒ¬",note:"ãƒ¬",frequency:440,detectedFrequency:438,cents:-8,grade:"excellent"},{name:"ãƒŸ",note:"ãƒŸ",frequency:494,detectedFrequency:500,cents:21,grade:"good"},{name:"ãƒ•ã‚¡",note:"ãƒ•ã‚¡",frequency:523,detectedFrequency:520,cents:-10,grade:"excellent"},{name:"ã‚½",note:"ã‚½",frequency:587,detectedFrequency:595,cents:24,grade:"good"},{name:"ãƒ©",note:"ãƒ©",frequency:659,detectedFrequency:665,cents:16,grade:"good"},{name:"ã‚·",note:"ã‚·",frequency:740,detectedFrequency:755,cents:35,grade:"pass"},{name:"ãƒ‰ï¼ˆé«˜ï¼‰",note:"ãƒ‰ï¼ˆé«˜ï¼‰",frequency:784,detectedFrequency:780,cents:-9,grade:"excellent"}]},{grade:"excellent",accuracy:94,baseNote:"A4",baseFrequency:440,timestamp:new Date(Date.now()-2*6e4),measuredNotes:8,noteResults:[{name:"ãƒ‰",note:"ãƒ‰",frequency:440,detectedFrequency:442,cents:8,grade:"excellent"},{name:"ãƒ¬",note:"ãƒ¬",frequency:494,detectedFrequency:492,cents:-7,grade:"excellent"},{name:"ãƒŸ",note:"ãƒŸ",frequency:554,detectedFrequency:558,cents:12,grade:"excellent"},{name:"ãƒ•ã‚¡",note:"ãƒ•ã‚¡",frequency:587,detectedFrequency:585,cents:-6,grade:"excellent"},{name:"ã‚½",note:"ã‚½",frequency:659,detectedFrequency:665,cents:16,grade:"good"},{name:"ãƒ©",note:"ãƒ©",frequency:740,detectedFrequency:738,cents:-5,grade:"excellent"},{name:"ã‚·",note:"ã‚·",frequency:831,detectedFrequency:840,cents:19,grade:"good"},{name:"ãƒ‰ï¼ˆé«˜ï¼‰",note:"ãƒ‰ï¼ˆé«˜ï¼‰",frequency:880,detectedFrequency:882,cents:4,grade:"excellent"}]},{grade:"pass",accuracy:68,baseNote:"Bb4",baseFrequency:466.16,timestamp:new Date(Date.now()-1*6e4),measuredNotes:7,noteResults:[{name:"ãƒ‰",note:"ãƒ‰",frequency:466,detectedFrequency:470,cents:15,grade:"excellent"},{name:"ãƒ¬",note:"ãƒ¬",frequency:523,detectedFrequency:535,cents:39,grade:"pass"},{name:"ãƒŸ",note:"ãƒŸ",frequency:587,detectedFrequency:600,cents:38,grade:"pass"},{name:"ãƒ•ã‚¡",note:"ãƒ•ã‚¡",frequency:622,detectedFrequency:615,cents:-19,grade:"good"},{name:"ã‚½",note:"ã‚½",frequency:698,detectedFrequency:720,cents:54,grade:"needWork"},{name:"ãƒ©",note:"ãƒ©",frequency:784,detectedFrequency:null,cents:null,grade:"notMeasured"},{name:"ã‚·",note:"ã‚·",frequency:880,detectedFrequency:895,cents:29,grade:"pass"},{name:"ãƒ‰ï¼ˆé«˜ï¼‰",note:"ãƒ‰ï¼ˆé«˜ï¼‰",frequency:932,detectedFrequency:925,cents:-13,grade:"excellent"}]},{grade:"good",accuracy:82,baseNote:"C5",baseFrequency:523.25,timestamp:new Date,measuredNotes:8,noteResults:[{name:"ãƒ‰",note:"ãƒ‰",frequency:523,detectedFrequency:526,cents:10,grade:"excellent"},{name:"ãƒ¬",note:"ãƒ¬",frequency:587,detectedFrequency:584,cents:-9,grade:"excellent"},{name:"ãƒŸ",note:"ãƒŸ",frequency:659,detectedFrequency:665,cents:16,grade:"good"},{name:"ãƒ•ã‚¡",note:"ãƒ•ã‚¡",frequency:698,detectedFrequency:692,cents:-15,grade:"excellent"},{name:"ã‚½",note:"ã‚½",frequency:784,detectedFrequency:795,cents:24,grade:"good"},{name:"ãƒ©",note:"ãƒ©",frequency:880,detectedFrequency:890,cents:19,grade:"good"},{name:"ã‚·",note:"ã‚·",frequency:988,detectedFrequency:1010,cents:38,grade:"pass"},{name:"ãƒ‰ï¼ˆé«˜ï¼‰",note:"ãƒ‰ï¼ˆé«˜ï¼‰",frequency:1047,detectedFrequency:1042,cents:-8,grade:"excellent"}]}]}}function It(a){return[{scale:"ãƒ‰",interval:"unison",intervalName:"ãƒ¦ãƒ‹ã‚¾ãƒ³"},{scale:"ãƒ¬",interval:"major_second",intervalName:"é•·2åº¦"},{scale:"ãƒŸ",interval:"major_third",intervalName:"é•·3åº¦"},{scale:"ãƒ•ã‚¡",interval:"perfect_fourth",intervalName:"å®Œå…¨4åº¦"},{scale:"ã‚½",interval:"perfect_fifth",intervalName:"å®Œå…¨5åº¦"},{scale:"ãƒ©",interval:"major_sixth",intervalName:"é•·6åº¦"},{scale:"ã‚·",interval:"major_seventh",intervalName:"é•·7åº¦"},{scale:"ãƒ‰ï¼ˆé«˜ï¼‰",interval:"octave",intervalName:"ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–"}].map((t,n)=>{const s=a.find(r=>r.targetNote&&r.targetNote.includes(t.scale))||a[n];if(s&&s.accuracy!=="notMeasured"){const r=parseFloat(s.accuracy)||0,o=Math.round((100-r)*.5);return{type:t.interval,scale:t.scale,intervalName:t.intervalName,attempts:1,averageError:o,accuracy:r}}else return{type:t.interval,scale:t.scale,intervalName:t.intervalName,attempts:0,averageError:null,accuracy:0}})}function Jn(a){if(!a||!Array.isArray(a))return console.warn("âš ï¸ [RandomTraining] sessionHistory ãŒç„¡åŠ¹ã§ã™"),[];const e=[{type:"unison",scale:"ãƒ‰",intervalName:"ãƒ¦ãƒ‹ã‚¾ãƒ³",noteIndex:0},{type:"major_second",scale:"ãƒ¬",intervalName:"é•·2åº¦",noteIndex:1},{type:"major_third",scale:"ãƒŸ",intervalName:"é•·3åº¦",noteIndex:2},{type:"perfect_fourth",scale:"ãƒ•ã‚¡",intervalName:"å®Œå…¨4åº¦",noteIndex:3},{type:"perfect_fifth",scale:"ã‚½",intervalName:"å®Œå…¨5åº¦",noteIndex:4},{type:"major_sixth",scale:"ãƒ©",intervalName:"é•·6åº¦",noteIndex:5},{type:"major_seventh",scale:"ã‚·",intervalName:"é•·7åº¦",noteIndex:6},{type:"octave",scale:"ãƒ‰ï¼ˆé«˜ï¼‰",intervalName:"ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–",noteIndex:7}],t={};return e.forEach(n=>{t[n.type]={type:n.type,scale:n.scale,intervalName:n.intervalName,attempts:0,successCount:0,accuracySum:0,accuracyValues:[],errorValues:[]}}),a.forEach(n=>{!n.noteResults||!Array.isArray(n.noteResults)||n.noteResults.forEach((s,r)=>{if(r>=e.length)return;const o=e[r].type,i=t[o];if(i.attempts++,s.accuracy!=="notMeasured"&&typeof s.accuracy=="number"){i.accuracyValues.push(s.accuracy),i.accuracySum+=s.accuracy;const d=Math.round((100-s.accuracy)*.5);i.errorValues.push(d),s.accuracy>=70&&i.successCount++}})}),e.map(n=>{const s=t[n.type];if(s.attempts===0)return{type:n.type,scale:n.scale,intervalName:n.intervalName,attempts:0,averageError:null,accuracy:0};const r=s.accuracyValues.length>0?Math.round(s.accuracySum/s.accuracyValues.length):0,o=s.errorValues.length>0?Math.round(s.errorValues.reduce((d,l)=>d+l,0)/s.errorValues.length):null,i=s.accuracyValues.length>0?Math.round(s.successCount/s.accuracyValues.length*100):0;return{type:n.type,scale:n.scale,intervalName:n.intervalName,mastery:i,attempts:s.attempts,averageError:o,accuracy:r}})}function Kn(a){const e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];if(a<=0)return"ãƒ¼ãƒ¼";const n=Math.round(12*Math.log2(a/440)),s=(n+9+120)%12,r=Math.floor((n+9)/12)+4;return e[s]+r}function Nt(a,e){const t=[{factor:4,freq:a*4,description:"2ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸Š"},{factor:3,freq:a*3,description:"1.5ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸Š"},{factor:2.5,freq:a*2.5,description:"1.3ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸Š"},{factor:2,freq:a*2,description:"1ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸Š"},{factor:1.5,freq:a*1.5,description:"0.5ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸Š"},{factor:1,freq:a,description:"è£œæ­£ãªã—"},{factor:.75,freq:a*.75,description:"0.33ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸‹"},{factor:.67,freq:a*.67,description:"0.5ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸‹"},{factor:.5,freq:a*.5,description:"1ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸‹"},{factor:.4,freq:a*.4,description:"1.3ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸‹"},{factor:.33,freq:a*.33,description:"1.5ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸‹"},{factor:.25,freq:a*.25,description:"2ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸‹"}];let n=null,s=1/0;const r=e*.5,o=e*1.5,i=t.filter(d=>d.freq>=r&&d.freq<=o);for(const d of i){const l=Math.abs(d.freq-e);l<s&&(s=l,n=d)}if(!n)for(const d of t){const l=Math.abs(d.freq-e);l<s&&(s=l,n=d)}return n?{correctedFrequency:n.freq,factor:n.factor,description:n.description,error:s}:{correctedFrequency:a,factor:1,description:"è£œæ­£ãªã—ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰",error:Math.abs(a-e)}}function ot(){try{"scrollTo"in window&&"behavior"in document.documentElement.style?window.scrollTo({top:0,behavior:"smooth"}):window.scrollTo(0,0),document.body&&(document.body.scrollTop=0),document.documentElement&&(document.documentElement.scrollTop=0),document.querySelectorAll("[data-scroll-container], .scroll-container, main").forEach(e=>{e.scrollTo?e.scrollTo(0,0):e.scrollTop=0})}catch(a){console.warn("ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼:",a);try{window.scroll(0,0)}catch(e){console.error("ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å®Œå…¨å¤±æ•—:",e)}}}function ws(a){}function _s(a){console.error("âŒ PitchDetectorã‚¨ãƒ©ãƒ¼:",a.detail)}function ur(a,e,t){let n,s,r,o,i,d,l,u,f,h,m,p;Be(_t,"unifiedScoreData"),Le(a,_t,c=>t(4,r=c)),Be(Mt,"isCompleted"),Le(a,Mt,c=>t(5,o=c)),Be(bt,"page"),Le(a,bt,c=>t(52,i=c)),Be(Ft,"currentSessionId"),Le(a,Ft,c=>t(53,d=c)),Be(At,"remainingSessions"),Le(a,At,c=>t(54,l=c)),Be(Rt,"nextBaseName"),Le(a,Rt,c=>t(55,u=c)),Be(qt,"nextBaseNote"),Le(a,qt,c=>t(56,f=c)),Be(kt,"sessionHistory"),Le(a,kt,c=>t(23,h=c)),Be(Tt,"trainingProgress"),Le(a,Tt,c=>t(57,m=c)),Be(Ct,"isLoading"),Le(a,Ct,c=>t(24,p=c));let{$$slots:S={},$$scope:A}=e;sn("Page",S,[]);function L(c){return rt.evaluateOverall(c)}let E="setup",w=typeof window<"u"?new URLSearchParams(window.location.search).get("from")==="microphone-test"?(le.info("[RandomTraining] ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‹ã‚‰ã®é·ç§»ã‚’æ¤œå‡º"),"granted"):(le.info("[RandomTraining] ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚’æ¤œå‡º"),"checking"):"checking",T=!0,R=[];const O=["ãƒ‰","ãƒ¬","ãƒŸ","ãƒ•ã‚¡","ã‚½","ãƒ©","ã‚·","ãƒ‰ï¼ˆé«˜ï¼‰"];let b="",_=0,z=!1,x=0,I=O.map(c=>({name:c,state:"inactive",completed:!1})),N=null,D=!1,G=0,J=!1,P=null,W=!1,j=[],$=[],ae=0,De=0,_e="ãƒ¼ãƒ¼",Pe=0,Se={correctCount:0,totalCount:8,averageAccuracy:0,averageTime:0,isCompleted:!1},Ae=null,Ce={totalScore:0,grade:"C",componentScores:{pitchAccuracy:0,recognitionSpeed:0,intervalMastery:0,directionAccuracy:0,consistency:0}},ke=[],Re=[],We={},Ye={},xe={totalAttempts:0,successRate:0,averageScore:0,bestScore:0,sessionDuration:0,streakCount:0,fatigueLevel:"fresh",mostDifficultInterval:"-",mostSuccessfulInterval:"-",averageResponseTime:0,sessionStart:Date.now()},mt="intervals",oe=[],me=null,be=null,ze=!0,ue=null,je=null,it=null,ct=null,Je=null;const Ue=[{note:"C4",name:"ãƒ‰ï¼ˆä¸­ï¼‰",frequency:261.63,semitonesFromC:0},{note:"Db4",name:"ãƒ‰#ï¼ˆä¸­ï¼‰",frequency:277.18,semitonesFromC:1},{note:"D4",name:"ãƒ¬ï¼ˆä¸­ï¼‰",frequency:293.66,semitonesFromC:2},{note:"Eb4",name:"ãƒ¬#ï¼ˆä¸­ï¼‰",frequency:311.13,semitonesFromC:3},{note:"E4",name:"ãƒŸï¼ˆä¸­ï¼‰",frequency:329.63,semitonesFromC:4},{note:"F4",name:"ãƒ•ã‚¡ï¼ˆä¸­ï¼‰",frequency:349.23,semitonesFromC:5},{note:"Gb4",name:"ãƒ•ã‚¡#ï¼ˆä¸­ï¼‰",frequency:369.99,semitonesFromC:6},{note:"Ab4",name:"ãƒ©bï¼ˆä¸­ï¼‰",frequency:415.3,semitonesFromC:8},{note:"Bb3",name:"ã‚·bï¼ˆä½ï¼‰",frequency:233.08,semitonesFromC:-2},{note:"B3",name:"ã‚·ï¼ˆä½ï¼‰",frequency:246.94,semitonesFromC:-1}];async function Ke(){var c;t(1,w="checking");try{if(console.log("ğŸ¤ [RandomTraining] AudioManagerçµŒç”±ã§ãƒã‚¤ã‚¯è¨±å¯ç¢ºèªé–‹å§‹"),!((c=navigator.mediaDevices)!=null&&c.getUserMedia)){t(1,w="error");return}const g=await Ze.initialize();it=g.audioContext,je=g.mediaStream,ct=g.sourceNode,console.log("âœ… [RandomTraining] AudioManager ãƒªã‚½ãƒ¼ã‚¹å–å¾—å®Œäº†"),t(1,w="granted"),t(0,E="setup"),setTimeout(async()=>{if(ue){le.audio("[RandomTraining] PitchDetectoråˆæœŸåŒ–é–‹å§‹");const F=/iPhone/.test(navigator.userAgent),H=/iPad/.test(navigator.userAgent),Z=/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document;(H||Z)&&(console.log("ğŸ”§ [RandomTraining] iPadæ¤œå‡º - ãƒã‚¤ã‚¯æ„Ÿåº¦7.0xè‡ªå‹•è¨­å®šé–‹å§‹"),Ze.setSensitivity(7),console.log("âœ… [RandomTraining] iPad ãƒã‚¤ã‚¯æ„Ÿåº¦7.0xè‡ªå‹•è¨­å®šå®Œäº†"));try{console.log("ğŸ¤ [RandomTraining] AudioManagerå†åˆæœŸåŒ–é–‹å§‹ï¼ˆiPadå¯¾å¿œï¼‰"),await Ze.initialize(),console.log("âœ… [RandomTraining] AudioManagerå†åˆæœŸåŒ–å®Œäº†")}catch(Q){console.warn("âš ï¸ AudioManagerå†åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:",Q)}await ue.initialize(),le.audio("[RandomTraining] PitchDetectoråˆæœŸåŒ–å®Œäº†")}},200)}catch(g){le.error("[RandomTraining] ãƒã‚¤ã‚¯è¨±å¯ã‚¨ãƒ©ãƒ¼:",g),t(1,w=(g==null?void 0:g.name)==="NotAllowedError"?"denied":"error")}}function gt(){const c=f,g=u,F=Ue.find(H=>H.note===c)||Ue.find(H=>H.name===g)||Ue[0];if(t(7,b=F.name),t(8,_=F.frequency),le.info(`[BaseNote] åŸºéŸ³è¨­å®šï¼ˆlocalStorageé€£æºï¼‰: ${b} = ${_}Hz`),le.info(`[BaseNote] localStorageåŸºéŸ³æƒ…å ±: note=${c}, name=${g}`),!_||_<=0)throw le.error("[BaseNote] åŸºéŸ³å‘¨æ³¢æ•°è¨­å®šã‚¨ãƒ©ãƒ¼:",F),new Error(`Invalid base frequency: ${_}`)}async function cn(){if(z||!be||ze)return;if(w!=="granted"){console.log("ğŸ¤ [RandomTraining] ãƒã‚¤ã‚¯è¨±å¯ãŒå¿…è¦ã§ã™ã€‚è¨±å¯å–å¾—ã‚’é–‹å§‹...");try{await Ke(),console.log("ğŸ¤ [RandomTraining] ãƒã‚¤ã‚¯è¨±å¯å–å¾—å®Œäº†")}catch(g){console.error("âŒ ãƒã‚¤ã‚¯è¨±å¯ã‚¨ãƒ©ãƒ¼:",g);return}}if(!je&&w==="granted"){console.log("ğŸ¤ [RandomTraining] AudioManagerãƒªã‚½ãƒ¼ã‚¹æœªåˆæœŸåŒ–ã®ãŸã‚å–å¾—ã—ã¾ã™");try{await Ke()}catch(g){console.error("âŒ AudioManagerãƒªã‚½ãƒ¼ã‚¹åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:",g);return}}else je&&console.log("ğŸ¤ [RandomTraining] AudioManagerãƒªã‚½ãƒ¼ã‚¹æ—¢å­˜ã®ãŸã‚å†åˆ©ç”¨");t(9,z=!0),t(0,E="listening"),Je=Date.now(),gt();const c=Ue.find(g=>g.name===b).note;be.triggerAttackRelease(c,2,Et(),.7),setTimeout(()=>{t(9,z=!1),t(0,E="waiting"),setTimeout(()=>ht(),500)},2e3)}async function ln(){if(z||!be||p||!b)return;if(w!=="granted"){console.log("ğŸ¤ [RandomTraining] ãƒã‚¤ã‚¯è¨±å¯ãŒå¿…è¦ã§ã™ã€‚è¨±å¯å–å¾—ã‚’é–‹å§‹...");try{await Ke(),console.log("ğŸ¤ [RandomTraining] ãƒã‚¤ã‚¯è¨±å¯å–å¾—å®Œäº†")}catch(g){console.error("âŒ ãƒã‚¤ã‚¯è¨±å¯ã‚¨ãƒ©ãƒ¼:",g);return}}if(!je&&w==="granted"){console.log("ğŸ¤ [RandomTraining] AudioManagerãƒªã‚½ãƒ¼ã‚¹æœªåˆæœŸåŒ–ã®ãŸã‚å–å¾—ã—ã¾ã™");try{await Ke()}catch(g){console.error("âŒ AudioManagerãƒªã‚½ãƒ¼ã‚¹åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:",g);return}}else je&&console.log("ğŸ¤ [RandomTraining] AudioManagerãƒªã‚½ãƒ¼ã‚¹æ—¢å­˜ã®ãŸã‚å†åˆ©ç”¨");if(t(9,z=!0),t(0,E="listening"),Je=Date.now(),typeof window<"u"&&window.Tone){const g=window.Tone.context||window.Tone.getContext();g&&g.state==="suspended"&&(console.log("ğŸ”„ [RandomTraining] AudioContext suspendedæ¤œå‡º - å†é–‹ä¸­..."),await g.resume(),console.log("âœ… [RandomTraining] AudioContextå†é–‹å®Œäº†"))}const c=Ue.find(g=>g.name===b).note;be.triggerAttackRelease(c,2,Et(),.7),setTimeout(()=>{t(9,z=!1),t(0,E="waiting"),setTimeout(()=>ht(),500)},2e3)}async function As(){if(z||!be||p||!b){console.log("ğŸ”„ [BaseNoteOnly] å†ç”Ÿæ¡ä»¶æœªæº€: isPlaying:",z,"sampler:",!!be,"isLoading:",p,"currentBaseNote:",b);return}if(console.log("ğŸµ [BaseNoteOnly] åŸºéŸ³ã®ã¿å†ç”Ÿé–‹å§‹:",b),typeof window<"u"&&window.Tone){const g=window.Tone.context||window.Tone.getContext();g&&g.state==="suspended"&&(console.log("ğŸ”„ [BaseNoteOnly] AudioContext suspendedæ¤œå‡º - å†é–‹ä¸­..."),await g.resume(),console.log("âœ… [BaseNoteOnly] AudioContextå†é–‹å®Œäº†"))}const c=Ue.find(g=>g.name===b).note;be.triggerAttackRelease(c,1.5,Et(),.7),console.log("ğŸµ [BaseNoteOnly] åŸºéŸ³å†ç”Ÿå®Œäº†:",c)}function un(){b&&_>0?ln():cn(),dn()}function dn(){P&&clearInterval(P),t(11,G=0),J=!0,t(12,W=!1),console.log("ğŸµ [GuideStartBar] ã‚¬ã‚¤ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆãƒãƒ¼é–‹å§‹"),P=setInterval(()=>{t(11,G+=2.5),G>=100&&(t(11,G=100),t(12,W=!0),console.log("ğŸµ [GuideStartBar] ã‚¬ã‚¤ãƒ‰é–‹å§‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼"),setTimeout(()=>{J=!1,t(12,W=!1),t(11,G=0)},800),clearInterval(P),P=null)},50)}function ks(){P&&(clearInterval(P),P=null),J=!1,t(12,W=!1),t(11,G=0)}function $e(c,g){const H=[0,2,4,5,7,9,11,12][g],Z=c*Math.pow(2,H/12);return le.debug(`[calculateExpectedFrequency] ${I[g].name}: åŸºéŸ³${c.toFixed(1)}Hz + ${H}åŠéŸ³ = ${Z.toFixed(1)}Hz`),Z}function fn(c,g){return $e(c,g)}function ht(){t(0,E="guiding"),x=0,D=!0,j=[],console.log(`ğŸ¬ ã‚¬ã‚¤ãƒ‰é–‹å§‹: ${b} (${_.toFixed(1)}Hz)`);function c(){if(x<I.length){x>0&&t(10,I[x-1].state="inactive",I),t(10,I[x].state="active",I);const g=fn(_,x);Dt.setScaleContext({baseFrequency:_,currentScale:I[x].name,targetFrequency:g}),console.log(`ğŸµ [Scale] åŸºéŸ³:${b}(${_.toFixed(0)}Hz) ç¾åœ¨:${I[x].name} ç›®æ¨™:${g.toFixed(0)}Hz`),x>=4&&console.log(`ğŸ” [ãƒ‡ãƒãƒƒã‚°] Step ${x}: currentBaseFrequency=${_}, currentBaseNote='${b}'`),x++,N=setTimeout(()=>{c()},600)}else mn()}c()}function mn(){D=!1,console.log(`ğŸ ã‚¬ã‚¤ãƒ‰å®Œäº†: ${j.length}/${I.length}ã‚¹ãƒ†ãƒƒãƒ—è©•ä¾¡`),I.length>0&&t(10,I[I.length-1].state="inactive",I),ue&&ue.stopDetection(),Dt.clearContext(),gn(),Sn(),oe=O.map(c=>{const g=j.find(F=>F.stepName===c);return g?{name:g.stepName,cents:g.adjustedFrequency?Math.round(g.centDifference):null,targetFreq:g.expectedFrequency,detectedFreq:g.adjustedFrequency||null,diff:g.adjustedFrequency?g.adjustedFrequency-g.expectedFrequency:null,accuracy:g.accuracy}:{name:c,cents:null,targetFreq:null,detectedFreq:null,diff:null,accuracy:"notMeasured"}}),Dn(),_n(),t(0,E="results")}function gn(){let c=0,g=0;j.forEach((Z,Q)=>{Z.isCorrect&&c++,g+=Z.accuracy});const F=j.length>0?Math.round(g/j.length):0,H=Math.round(c/I.length*100);Se={correctCount:c,totalCount:I.length,averageAccuracy:F,averageTime:0,isCompleted:!0},console.log(`ğŸ¯ çµæœ: ${c}/${I.length}æ­£è§£ (${H}%) å¹³å‡ç²¾åº¦${F}%`),j.length>0&&($=[...j])}function Ms(){switch(E){case"setup":return ze||!be?"ğŸµ éŸ³æºèª­ã¿è¾¼ã¿ä¸­...":"ğŸ¤ ãƒã‚¤ã‚¯æº–å‚™å®Œäº† - ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é–‹å§‹å¯èƒ½";case"listening":return"ğŸµ åŸºéŸ³å†ç”Ÿä¸­...";case"waiting":return"â³ é–“ã‚‚ãªãé–‹å§‹...";case"guiding":return"ğŸ™ï¸ ã‚¬ã‚¤ãƒ‰ã«åˆã‚ã›ã¦ãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚·ãƒ‰ã‚’æ­Œã£ã¦ãã ã•ã„";case"results":return"ğŸ‰ æ¡ç‚¹çµæœ";default:return"ğŸ”„ æº–å‚™ä¸­..."}}function Cs(){return j.length>0?j:$.length>0?$:[]}function hn(){St(`${dt}/microphone-test`)}function et(){St(`${dt}/`)}async function yn(){try{t(32,ze=!0),t(31,be=new tr({urls:{C4:"C4.mp3"},baseUrl:`${dt}/audio/piano/`,release:1.5,volume:Zn(),onload:()=>{t(32,ze=!1)},onerror:Z=>{console.error("âŒ Salamander PianoéŸ³æºèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",Z),t(32,ze=!1)}}).toDestination());const c=/iPhone/.test(navigator.userAgent),g=/iPad/.test(navigator.userAgent),F=/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document,H=c||g||F;console.log(g?"ğŸ” [RandomTraining] iPadæ¤œå‡º:":F?"ğŸ” [RandomTraining] iPadOSæ¤œå‡º:":c?"ğŸ” [RandomTraining] iPhoneæ¤œå‡º:":"ğŸ” [RandomTraining] ãã®ä»–ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º:",navigator.userAgent),console.log("ğŸ”Š [RandomTraining] éŸ³é‡è¨­å®šç¶­æŒ: 35dB")}catch(c){console.error("ã‚µãƒ³ãƒ—ãƒ©ãƒ¼åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:",c),t(32,ze=!1)}}async function lt(){try{(await navigator.permissions.query({name:"microphone"})).state==="granted"?await Ke():t(1,w="denied")}catch{t(1,w="denied")}}function pn(){try{Ae=new Ht,le.info("[RandomTraining] æ¡ç‚¹ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–å®Œäº†")}catch(c){le.error("[RandomTraining] æ¡ç‚¹ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:",c)}}function vn(c,g){if(!Ae||!D)return;const F=x-1;if(F<0||F>=I.length)return;const H=$e(_,F),Z={baseFrequency:_,targetFrequency:H,detectedFrequency:c,detectedNote:g,volume:ae,timestamp:Date.now(),scaleIndex:F,scaleName:I[F].name};try{Ae.processAttempt(Z)}catch(Q){le.error("[RandomTraining] æ¡ç‚¹ã‚¨ãƒ³ã‚¸ãƒ³ã‚¨ãƒ©ãƒ¼:",Q)}}function Sn(){if(!Ae){le.error("[RandomTraining] æ¡ç‚¹ã‚¨ãƒ³ã‚¸ãƒ³ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“"),bn();return}try{const c=Ae.generateDetailedReport();t(16,Ce={totalScore:c.totalScore,grade:c.grade,componentScores:c.componentScores}),c.intervalAnalysis&&c.intervalAnalysis.masteryLevels?t(3,ke=Object.entries(c.intervalAnalysis.masteryLevels).map(([g,F])=>{var H,Z;return{type:g,mastery:Math.round(F),attempts:((H=c.intervalAnalysis.attemptCounts)==null?void 0:H[g])||0,accuracy:((Z=c.intervalAnalysis.accuracyRates)==null?void 0:Z[g])||0}})):(console.warn("âš ï¸ [RandomTraining] intervalAnalysis.masteryLevels ãŒæœªå®šç¾©ã§ã™"),t(3,ke=[])),c.consistencyHistory&&Array.isArray(c.consistencyHistory)?t(17,Re=c.consistencyHistory.map((g,F)=>({score:Math.round(g),timestamp:Date.now()-(c.consistencyHistory.length-F)*1e3}))):(console.warn("âš ï¸ [RandomTraining] consistencyHistory ãŒæœªå®šç¾©ã¾ãŸã¯é…åˆ—ã§ã¯ã‚ã‚Šã¾ã›ã‚“"),t(17,Re=[])),t(18,We=c.feedback||{primary:"æ¡ç‚¹çµæœã‚’ç”Ÿæˆä¸­ã§ã™...",detailed:[],suggestions:[]}),t(20,xe={totalAttempts:c.totalAttempts||0,successRate:c.successRate||0,averageScore:c.totalScore||0,bestScore:Math.max(c.totalScore||0,xe.bestScore||0),sessionDuration:Math.round((Date.now()-xe.sessionStart)/6e4)||0,streakCount:c.streak||0,fatigueLevel:c.fatigueLevel||"normal",mostDifficultInterval:c.mostDifficultInterval||"-",mostSuccessfulInterval:c.mostSuccessfulInterval||"-",averageResponseTime:c.averageResponseTime||0}),le.info("[RandomTraining] æ¡ç‚¹çµæœç”Ÿæˆå®Œäº†:",Ce)}catch(c){le.error("[RandomTraining] æ¡ç‚¹çµæœç”Ÿæˆã‚¨ãƒ©ãƒ¼:",c)}}function bn(){le.info("[RandomTraining] ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§æ¡ç‚¹çµæœã‚’ç”Ÿæˆ"),t(16,Ce={totalScore:78,grade:"B+",componentScores:{pitchAccuracy:82,recognitionSpeed:75,intervalMastery:80,directionAccuracy:85,consistency:70}}),t(3,ke=[{type:"unison",mastery:95,attempts:8,accuracy:98},{type:"major_second",mastery:82,attempts:8,accuracy:85},{type:"major_third",mastery:78,attempts:8,accuracy:80},{type:"perfect_fourth",mastery:65,attempts:8,accuracy:68},{type:"perfect_fifth",mastery:88,attempts:8,accuracy:90},{type:"major_sixth",mastery:72,attempts:8,accuracy:75},{type:"major_seventh",mastery:58,attempts:8,accuracy:62},{type:"octave",mastery:92,attempts:8,accuracy:94}]),t(17,Re=[{score:65,timestamp:Date.now()-42e4},{score:72,timestamp:Date.now()-36e4},{score:68,timestamp:Date.now()-3e5},{score:75,timestamp:Date.now()-24e4},{score:78,timestamp:Date.now()-18e4},{score:82,timestamp:Date.now()-12e4},{score:80,timestamp:Date.now()-6e4},{score:85,timestamp:Date.now()}]),t(18,We={type:"improvement",primary:"è‰¯ã„é€²æ­©ãŒè¦‹ã‚‰ã‚Œã¾ã™ï¼",summary:"éŸ³ç¨‹ã®èªè­˜ç²¾åº¦ãŒå‘ä¸Šã—ã¦ã„ã¾ã™ã€‚ç‰¹ã«å®Œå…¨5åº¦ã¨ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ã®ç¿’å¾—åº¦ãŒé«˜ãã€åŸºæœ¬çš„ãªéŸ³æ„ŸãŒèº«ã«ã¤ã„ã¦ãã¦ã„ã¾ã™ã€‚",details:[{category:"strengths",text:"ãƒ¦ãƒ‹ã‚¾ãƒ³ã¨ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ã®èªè­˜ãŒã»ã¼å®Œç’§ã§ã™"},{category:"strengths",text:"å®Œå…¨5åº¦ã®å®‰å®šæ€§ãŒå„ªç§€ã§ã™"},{category:"improvements",text:"å®Œå…¨4åº¦ã®ç·´ç¿’ã‚’ã‚‚ã†å°‘ã—å¢—ã‚„ã—ã¾ã—ã‚‡ã†"},{category:"improvements",text:"é•·7åº¦ã®èªè­˜ç²¾åº¦ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†"},{category:"tips",text:"4åº¦ã¯ã€Œã‚½ãƒ¼ãƒ•ã‚¡ãƒ¼ã€ã®éŸ³ç¨‹ã§ã™"},{category:"practice",text:"æ¯æ—¥15åˆ†ã®ç¶™ç¶šç·´ç¿’ã‚’å¿ƒãŒã‘ã¾ã—ã‚‡ã†"}],nextSteps:["å®Œå…¨4åº¦ã®é›†ä¸­ç·´ç¿’ã‚’è¡Œã„ã¾ã—ã‚‡ã†","é€£ç¶šãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè·µç·´ç¿’ã‚’","1æ—¥15åˆ†ã®ç¶™ç¶šç·´ç¿’ã‚’å¿ƒãŒã‘ã¾ã—ã‚‡ã†"],motivation:"ç¶™ç¶šã¯åŠ›ãªã‚Šï¼ã‚ãªãŸã®ç›¸å¯¾éŸ³æ„Ÿã¯ç¢ºå®Ÿã«å‘ä¸Šã—ã¦ã„ã¾ã™ï¼"}),t(20,xe={totalAttempts:32,successRate:68.8,averageScore:78,bestScore:85,sessionDuration:8,streakCount:4,fatigueLevel:"normal",mostDifficultInterval:"å®Œå…¨4åº¦",mostSuccessfulInterval:"ãƒ¦ãƒ‹ã‚¾ãƒ³",averageResponseTime:2.1,sessionStart:Date.now()-48e4}),le.info("[RandomTraining] ãƒ†ã‚¹ãƒˆæ¡ç‚¹çµæœç”Ÿæˆå®Œäº†")}function Rs(c){mt=c}function Dn(){if(!oe||oe.length===0){console.warn("[UnifiedScore] noteResultsForDisplay ãŒç©ºã§ã™");return}const c=oe.filter(re=>re.accuracy!=="notMeasured").length,g=oe.length,F=oe.filter(re=>re.accuracy!=="notMeasured"&&typeof re.accuracy=="number").map(re=>re.accuracy),H=F.length>0?Math.round(F.reduce((re,He)=>re+He,0)/F.length):0,Z=b||"Unknown",Q=_||0,ie=oe.map(re=>({name:re.name,note:re.note||re.name,frequency:re.targetFreq||re.expectedFrequency,detectedFrequency:re.detectedFreq,cents:re.cents,grade:rt.evaluateNote(re.cents),targetFreq:re.targetFreq,diff:re.diff})),de=m,ce=(de==null?void 0:de.sessionHistory)||[],Fe={timestamp:new Date,baseNote:Z,baseFrequency:Q,noteResults:ie,measuredNotes:c,accuracy:H,grade:rt.evaluateSession(oe)},Oe=[...ce,Fe];t(21,me={mode:"random",timestamp:new Date,duration:60,totalNotes:g,measuredNotes:c,averageAccuracy:H,baseNote:Z,baseFrequency:Q,noteResults:ie,distribution:rt.calculateDistribution(oe),sessionHistory:Oe,unifiedGrade:L(Oe)}),console.log("[UnifiedScore] çµ±åˆæ¡ç‚¹ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†ï¼ˆå®Œå…¨ç‰ˆï¼‰:",me),wn()}async function wn(){if(!oe||oe.length===0){console.warn("ğŸ“Š [SessionStorage] ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãªã—");return}try{console.log("ğŸ“Š [SessionStorage] ã‚»ãƒƒã‚·ãƒ§ãƒ³çµæœä¿å­˜é–‹å§‹");const c=oe.map(Q=>({name:Q.name,cents:Q.cents,targetFreq:Q.targetFreq||Q.expectedFrequency,detectedFreq:Q.detectedFreq,diff:Q.diff,accuracy:typeof Q.accuracy=="number"?Q.accuracy:0})),g=Je?Math.round((Date.now()-Je)/1e3):60;await jn(c,g,f,u)?(console.log("ğŸ“Š [SessionStorage] ã‚»ãƒƒã‚·ãƒ§ãƒ³çµæœä¿å­˜å®Œäº†"),console.log("ğŸ“Š [SessionStorage] ä¿å­˜å¾Œã®çŠ¶æ³:",{currentSession:d,totalSessions:h.length,isCompleted:o,nextBaseNote:f,nextBaseName:u})):console.error("ğŸ“Š [SessionStorage] ã‚»ãƒƒã‚·ãƒ§ãƒ³çµæœä¿å­˜å¤±æ•—")}catch(c){console.error("ğŸ“Š [SessionStorage] ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜ã‚¨ãƒ©ãƒ¼:",c)}}async function _n(){try{if(Ae){const c=h||[];for(const[F,H]of c.entries())if(H.noteResults&&H.noteResults.length>0){const Z=H.baseFrequency||262;for(const Q of H.noteResults)Q.detectedFreq&&Q.targetFreq&&await Ae.analyzePerformance({baseFreq:Z,targetFreq:Q.targetFreq,detectedFreq:Q.detectedFreq,responseTime:2e3,volume:50,harmonicCorrection:null})}const g=Ae.generateDetailedReport();t(16,Ce={totalScore:g.totalScore||0,grade:g.grade||"C",componentScores:g.componentScores||{accuracy:0,speed:0,consistency:0}}),g.intervalAnalysis&&g.intervalAnalysis.masteryLevels?t(3,ke=Object.entries(g.intervalAnalysis.masteryLevels).map(([F,H])=>{var Z;return{type:F,mastery:Math.round(H),attempts:((Z=g.intervalAnalysis.attemptCounts)==null?void 0:Z[F])||0,accuracy:Math.round(H*.9)}})):t(3,ke=It(oe)),g.consistencyHistory&&Array.isArray(g.consistencyHistory)?t(17,Re=g.consistencyHistory.map((F,H)=>({score:Math.round(F),timestamp:Date.now()-(g.consistencyHistory.length-H)*1e3}))):t(17,Re=pt(oe)),t(18,We=vt(oe)||g.feedback),console.log("ğŸ¯ [generateEnhancedScoringData] æŠ€è¡“åˆ†æçµæœç”Ÿæˆã‚’é–‹å§‹"),console.log("ğŸ¯ [generateEnhancedScoringData] results:",g),t(19,Ye=An(g)),console.log("ğŸ¯ [generateEnhancedScoringData] technicalFeedbackDataçµæœ:",Ye),t(20,xe={totalAttempts:g.totalAttempts||oe.length,successRate:g.successRate||oe.filter(F=>F.accuracy!=="notMeasured").length/oe.length*100,averageScore:g.totalScore||(me==null?void 0:me.averageAccuracy)||0,bestScore:Math.max(g.totalScore||0,xe.bestScore||0),sessionDuration:Math.round(60),streakCount:g.streak||0,fatigueLevel:g.fatigueLevel||"normal",mostDifficultInterval:g.mostDifficultInterval||"æœªç‰¹å®š",mostSuccessfulInterval:g.mostSuccessfulInterval||"æœªç‰¹å®š",averageResponseTime:g.averageResponseTime||2.5,sessionStart:Date.now()-6e4})}else yt();console.log("[EnhancedScoring] è¿½åŠ æ¡ç‚¹ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†")}catch(c){console.error("[EnhancedScoring] ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚¨ãƒ©ãƒ¼:",c),yt()}}function yt(){const c=oe.filter(F=>F.accuracy!=="notMeasured"),g=(me==null?void 0:me.averageAccuracy)||0;t(16,Ce={totalScore:Math.round(g*.8),grade:g>=90?"A":g>=80?"B":g>=70?"C":"D",componentScores:{accuracy:g,speed:85,consistency:Math.max(60,g-10)}}),t(3,ke=It(oe)),t(17,Re=pt()),t(18,We=vt(oe)),t(20,xe={totalAttempts:oe.length,successRate:c.length/oe.length*100,averageScore:g,bestScore:g,sessionDuration:60,streakCount:0,fatigueLevel:"normal",mostDifficultInterval:"æœªåˆ†æ",mostSuccessfulInterval:"æœªåˆ†æ",averageResponseTime:2.5,sessionStart:Date.now()-6e4})}function pt(c){const g=(me==null?void 0:me.averageAccuracy)||70;return Array.from({length:8},(F,H)=>({score:Math.max(30,Math.min(100,g+(Math.random()-.5)*20)),timestamp:Date.now()-(8-H)*7500}))}function vt(c){const g=c.filter(nt=>nt.accuracy!=="notMeasured").length,F=(me==null?void 0:me.averageAccuracy)||0,H=8,Z=h||[],Q=Z.length,ie={type:"info",categories:[{name:"éŸ³ç¨‹ç²¾åº¦",icon:"Target",score:F,message:`${F}%ã®ç²¾åº¦ã§éŸ³ç¨‹ã‚’æ‰ãˆã¦ã„ã¾ã™`},{name:"æ¸¬å®šæˆåŠŸç‡",icon:"Mic",score:Math.round(g/c.length*100),message:`${c.length}éŸ³ä¸­${g}éŸ³ã‚’æ­£å¸¸ã«æ¸¬å®š`}]};if(Q<H)return ie;let de,ce,Fe;const Oe=(me==null?void 0:me.unifiedGrade)||"E",re=Z.length;let He=0,we=0,Me=0;Z.forEach(nt=>{nt.grade==="excellent"?He++:nt.grade==="good"?we++:nt.grade==="pass"&&Me++});const qe=re>0?Math.round(He/re*100):0,tt=re>0?Math.round((He+we+Me)/re*100):0,Te=re>0?Math.round((He+we+Me)/re*100):0;switch(Oe){case"S":de="excellent",ce="éŸ³æ¥½å®¶ãƒ¬ãƒ™ãƒ«ã®ç›¸å¯¾éŸ³æ„Ÿã‚’é”æˆï¼",Fe=`å„ªç§€ç‡${qe}%è¶…ãˆã®å®ŸåŠ›ã‚’è¨¼æ˜ã•ã‚Œã¾ã—ãŸã€‚`;break;case"A":de="excellent",ce="ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«åˆ°é”ï¼",Fe=`å„ªç§€ç‡${qe}%ã®å®‰å®šã—ãŸéŸ³æ„Ÿèƒ½åŠ›ã§ã™ã€‚`;break;case"B":de="improvement",ce="ãƒ—ãƒ­ãƒ•ã‚£ã‚·ã‚¨ãƒ³ãƒˆç´šé”æˆï¼",Fe=`è‰¯å¥½ç‡${tt}%ã®ç¢ºå®Ÿãªé€²æ­©ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚`;break;case"C":de="improvement",ce="ã‚¢ãƒ‰ãƒãƒ³ã‚¹ç´šåˆ°é”ï¼",Fe=`åˆæ ¼ç‡${Te}%ã§ç€å®Ÿã«æˆé•·ä¸­ã§ã™ã€‚`;break;case"D":de="practice",ce="ç¶™ç¶šç·´ç¿’ã§å¿…ãšä¸Šé”ï¼",Fe=`ç¾åœ¨ã®åˆæ ¼ç‡${Te}%ã‹ã‚‰ç›®æ¨™70%ã¸å‘ã‘ã¦ç·´ç¿’ã‚’ç¶šã‘ã¾ã—ã‚‡ã†ã€‚`;break;case"E":default:de="encouragement",ce="Eç´šãƒ“ã‚®ãƒŠãƒ¼",Fe="ç·´ç¿’é–‹å§‹æ®µéšã§ã™ã€‚ç¶™ç¶šçš„ãªç·´ç¿’ã§å¿…ãšä¸Šé”ã—ã¾ã™ã€‚";break}return{...ie,type:de,primary:ce,summary:Fe}}function An(c){var Oe,re,He;if((h||[]).length<8||!c)return null;const Z=c.improvements||[];(Oe=c.detailed)!=null&&Oe.statistics;const Q=[];let ie=0,de=0;if((re=c.detailed)!=null&&re.intervals){const we=c.detailed.intervals;if(we.totalAnalyses>0){let Me=0,qe=0;for(const[tt,Te]of Object.entries(we.masteryLevels))Te.attempts>0&&(Me+=Te.averageAccuracy*Te.attempts,qe+=Te.attempts);ie=qe>0?Me/qe:0}}if((He=c.detailed)!=null&&He.directions){const we=c.detailed.directions;if(we.totalAnalyses>0){let Me=0,qe=0;for(const[tt,Te]of Object.entries(we.masteryData))Te.attempts>0&&(Me+=Te.averageAccuracy*Te.attempts,qe+=Te.attempts);de=qe>0?Me/qe:0}}Q.push({category:"improvements",text:`éŸ³ç¨‹ç²¾åº¦: ${Math.round(ie)}%ã€€ï¼ˆéŸ³ã®é«˜ã•ã‚’æ‰ãˆã‚‹æ­£ç¢ºæ€§ã€€ç›®æ¨™åŸºæº–ï¼š70ã€œ85%ï¼‰`}),Q.push({category:"improvements",text:`æ–¹å‘æ€§: ${Math.round(de)}%ã€€ï¼ˆéŸ³ç¨‹ã®ä¸Šä¸‹åˆ¤æ–­ã®ç²¾åº¦ã€€ç›®æ¨™åŸºæº–ï¼š80ã€œ90%ï¼‰`});const ce=Z.map(we=>({category:"tips",text:we.message})),Fe=Z.flatMap(we=>(we.actions||[]).map(Me=>({category:"practice",text:Me})));return[...Q,...ce,...Fe],{type:"info",primary:"è©³ç´°åˆ†æçµæœ",summary:"éŸ³ç¨‹ç²¾åº¦ãƒ»ä¸€è²«æ€§ãƒ»æ–¹å‘æ€§ã®ç·åˆåˆ†æ",details:Q}}xn(async()=>{if(!(typeof localStorage<"u"?localStorage.getItem("mic-test-completed"):null)){console.log("ğŸš« [RandomTraining] ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆæœªå®Œäº† - æº–å‚™ç”»é¢è¡¨ç¤º"),lt();return}console.log("ğŸ“Š [SessionStorage] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†åˆæœŸåŒ–é–‹å§‹");try{if(await wt()){if(console.log("ğŸ“Š [SessionStorage] ã‚»ãƒƒã‚·ãƒ§ãƒ³é€²è¡ŒçŠ¶æ³ã®èª­ã¿è¾¼ã¿å®Œäº†"),console.log("ğŸ“Š [SessionStorage] ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³:",d,"/ 8"),console.log("ğŸ“Š [SessionStorage] æ¬¡ã®åŸºéŸ³:",f,"(",u,")"),console.log("ğŸ“Š [SessionStorage] å®Œäº†çŠ¶æ³:",o?"8ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†":`æ®‹ã‚Š${l}ã‚»ãƒƒã‚·ãƒ§ãƒ³`),o&&(console.log("ğŸ”„ [SessionStorage] 8ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†æ¤œå‡º - æ–°ã‚µã‚¤ã‚¯ãƒ«é–‹å§‹å‡¦ç†"),await st()?console.log("âœ… [SessionStorage] æ–°ã‚µã‚¤ã‚¯ãƒ«é–‹å§‹å®Œäº† - ã‚»ãƒƒã‚·ãƒ§ãƒ³1/8ã‹ã‚‰å†é–‹"):console.warn("âš ï¸ [SessionStorage] æ–°ã‚µã‚¤ã‚¯ãƒ«é–‹å§‹å‡¦ç†ãŒå¤±æ•—")),d>1&&!o){console.warn("ğŸ”„ [SessionStorage] ã‚»ãƒƒã‚·ãƒ§ãƒ³é€”ä¸­ã§ã®ãƒªãƒ­ãƒ¼ãƒ‰æ¤œå‡º - ã‚»ãƒƒã‚·ãƒ§ãƒ³1ã‹ã‚‰å†é–‹"),console.warn("ğŸ”„ [SessionStorage] ç¾åœ¨:",d,"ã‚»ãƒƒã‚·ãƒ§ãƒ³ç›® â†’ ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚¢ã‚¯ã‚»ã‚¹èª˜å°");const{SessionStorageManager:F}=await In(async()=>{const{SessionStorageManager:Q}=await import("../chunks/DzFNKnhn.js").then(ie=>ie.K);return{SessionStorageManager:Q}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url),H=F.getInstance();typeof localStorage<"u"&&(localStorage.removeItem("random-training-progress"),localStorage.removeItem("random-training-progress-backup"));const{resetProgress:Z}=await In(async()=>{const{resetProgress:Q}=await import("../chunks/DzFNKnhn.js").then(ie=>ie.L);return{resetProgress:Q}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url);await Z(),console.log("ğŸ”„ [SessionStorage] localStorage + ã‚¹ãƒˆã‚¢çŠ¶æ…‹å®Œå…¨ãƒªã‚»ãƒƒãƒˆå®Œäº†"),lt();return}}else console.log("ğŸ“Š [SessionStorage] æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹")}catch(g){console.error("ğŸ“Š [SessionStorage] åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:",g)}if(yn(),pn(),i.url.searchParams.get("from")==="microphone-test"){console.log("ğŸ¤ [RandomTraining] ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‹ã‚‰ã®é·ç§»ã‚’æ¤œå‡º");const g=new URL(window.location);if(g.searchParams.delete("from"),window.history.replaceState({},"",g),t(1,w="granted"),t(0,E="setup"),console.log('ğŸ¤ [RandomTraining] microphoneState="granted", trainingPhase="setup" ã«è¨­å®š'),!je){console.log("ğŸ¤ [RandomTraining] AudioManagerãƒªã‚½ãƒ¼ã‚¹å–å¾—é–‹å§‹");try{const F=await Ze.initialize();it=F.audioContext,je=F.mediaStream,ct=F.sourceNode,console.log("ğŸ¤ [RandomTraining] AudioManagerãƒªã‚½ãƒ¼ã‚¹å–å¾—å®Œäº†")}catch(F){console.warn("âš ï¸ AudioManagerãƒªã‚½ãƒ¼ã‚¹å–å¾—å¤±æ•—ï¼ˆå¾Œã§å†è©¦è¡Œï¼‰:",F)}}if(await new Promise(F=>setTimeout(F,300)),ue&&ue.getIsInitialized&&!ue.getIsInitialized())try{console.log("ğŸ™ï¸ [RandomTraining] PitchDetectoråˆæœŸåŒ–é–‹å§‹");const F=Ze.getStatus();console.log("ğŸ” [RandomTraining] AudioManagerçŠ¶æ…‹:",F),(!F.isInitialized||!F.mediaStreamActive)&&(console.log("ğŸ”„ [RandomTraining] AudioManagerçŠ¶æ…‹ä¸è‰¯ - å†åˆæœŸåŒ–å®Ÿè¡Œ"),await Ze.initialize()),await ue.initialize(),console.log("âœ… [RandomTraining] PitchDetectoråˆæœŸåŒ–å®Œäº†")}catch(F){console.warn("âš ï¸ PitchDetectoråˆæœŸåŒ–å¤±æ•—:",F)}}else await new Promise(g=>setTimeout(g,100)),lt()});function kn(c){const{frequency:g,note:F,volume:H,rawVolume:Z,clarity:Q}=c.detail;let ie=g,de=F;if(E==="guiding"&&D&&_>0&&g>0){const ce=Mn(g);ce&&(ie=ce.frequency,de=ce.note)}t(14,De=ie),t(15,_e=de),t(13,ae=H),_>0&&ie>0?Pe=Math.round(1200*Math.log2(ie/_)):Pe=0,Cn(g),Ae&&g>0&&_>0&&vn(g,F)}function Mn(c){if(!c||c<=0||!D||!_||ae<25)return null;const F=x-1;if(F<0||F>=I.length)return null;const H=$e(_,F);if(!H||H<=0)return null;const Q=Nt(c,H).correctedFrequency,ie=Kn(Q);return{frequency:Math.round(Q),note:ie}}function Cn(c,g){if(!c||c<=0||!D)return;if(!_||_<=0){console.error(`âŒ [æ¡ç‚¹ã‚¨ãƒ©ãƒ¼] åŸºéŸ³å‘¨æ³¢æ•°ãŒç„¡åŠ¹: ${_}Hz`),console.error(`âŒ [æ¡ç‚¹ã‚¨ãƒ©ãƒ¼] åŸºéŸ³å: ${b}`),console.error(`âŒ [æ¡ç‚¹ã‚¨ãƒ©ãƒ¼] activeStepIndex: ${x-1}`),console.error(`âŒ [æ¡ç‚¹ã‚¨ãƒ©ãƒ¼] trainingPhase: ${E}`),console.error(`âŒ [æ¡ç‚¹ã‚¨ãƒ©ãƒ¼] isGuideAnimationActive: ${D}`);return}if(ae<25)return;const H=x-1;if(H<0||H>=I.length)return;H>=4&&le.debug(`[æ¡ç‚¹ãƒ‡ãƒãƒƒã‚°] activeStepIndex=${H} (${I[H].name}), currentBaseFrequency=${_}Hz`);const Z=$e(_,H);if(H>=0&&le.debug(`[éŸ³ç¨‹è¨ˆç®—ä¿®æ­£ç‰ˆ] ${I[H].name}: æœŸå¾…å‘¨æ³¢æ•° ${Z.toFixed(1)}Hz`),!Z||Z<=0||!isFinite(Z)){console.error("âŒ [æ¡ç‚¹ã‚¨ãƒ©ãƒ¼] æœŸå¾…å‘¨æ³¢æ•°è¨ˆç®—ã‚¨ãƒ©ãƒ¼:"),console.error(`   åŸºéŸ³å‘¨æ³¢æ•°: ${_}Hz`),console.error(`   éŸ³éšã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: ${H}`),console.error(`   æœŸå¾…å‘¨æ³¢æ•°: ${Z}Hz`);return}const Q=Nt(c,Z),ie=Q.correctedFrequency,de=Q.factor,ce=Math.round(1200*Math.log2(ie/Z));if((Math.abs(ce)>200||de!==1)&&(le.debug(`[ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—å¼è£œæ­£] ${I[H].name}:`),console.warn(`   æ¤œå‡ºå‘¨æ³¢æ•°: ${c.toFixed(1)}Hz`),console.warn(`   è£œæ­£å¾Œå‘¨æ³¢æ•°: ${ie.toFixed(1)}Hz`),console.warn(`   æœŸå¾…å‘¨æ³¢æ•°: ${Z.toFixed(1)}Hz`),console.warn(`   ã‚»ãƒ³ãƒˆå·®: ${ce}Â¢`),console.warn(`   è£œæ­£ä¿‚æ•°: ${de} (${Q.description})`),console.warn(`   åŸºéŸ³: ${b} (${_.toFixed(1)}Hz)`)),!isFinite(ce)){console.error("âŒ [æ¡ç‚¹ã‚¨ãƒ©ãƒ¼] ã‚»ãƒ³ãƒˆè¨ˆç®—ã‚¨ãƒ©ãƒ¼:"),console.error(`   æ¤œå‡ºå‘¨æ³¢æ•°: ${c}Hz`),console.error(`   æœŸå¾…å‘¨æ³¢æ•°: ${Z}Hz`),console.error(`   ã‚»ãƒ³ãƒˆå·®: ${ce}`);return}const Oe=Math.abs(ce)<=50;if(ae>=15){const we=Math.max(0,Math.round(100-Math.abs(ce))),Me=j.findIndex(tt=>tt.stepIndex===H),qe={stepIndex:H,stepName:I[H].name,expectedFrequency:Math.round(Z),detectedFrequency:Math.round(c),adjustedFrequency:Math.round(ie),centDifference:ce,accuracy:we,isCorrect:Oe,correctionFactor:de,correctionDescription:Q.description,timestamp:Date.now()};Me>=0?j[Me]=qe:j.push(qe),j.length%4===0&&le.realtime(`æ¡ç‚¹é€²æ—: ${j.length}/${I.length}ã‚¹ãƒ†ãƒƒãƒ—å®Œäº†`)}}function qs(){t(0,E="completed"),Se.isCompleted=!0,Se.averageAccuracy=Math.round(Se.correctCount/Se.totalCount*100),ue&&ue.stopDetection()}async function Rn(){if(o){console.warn("ğŸš« [RestartSame] 8ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†çŠ¶æ…‹ã§ã¯å†æŒ‘æˆ¦ä¸å¯ - æ–°ã‚µã‚¤ã‚¯ãƒ«é–‹å§‹ãŒå¿…è¦"),await st()?(console.log("âœ… [RestartSame] æ–°ã‚µã‚¤ã‚¯ãƒ«é–‹å§‹å®Œäº† - ã‚»ãƒƒã‚·ãƒ§ãƒ³1/8ã‹ã‚‰å†é–‹"),window.location.reload()):console.error("âŒ [RestartSame] æ–°ã‚µã‚¤ã‚¯ãƒ«é–‹å§‹å¤±æ•—");return}ot(),t(0,E="setup"),N&&(clearTimeout(N),N=null),ue&&ue.resetDisplayState&&ue.resetDisplayState(),ut(),console.log("ğŸ”„ [RestartSame] åŒã˜åŸºéŸ³ã§å†æŒ‘æˆ¦:",b,_+"Hz"),console.log("ğŸ”„ [RestartSame] åŸºéŸ³æƒ…å ±ä¿æŒå®Œäº† - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå¾…æ©Ÿ")}async function qn(){if(o){console.warn("ğŸš« [RestartDifferent] 8ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†çŠ¶æ…‹ã§ã¯å†æŒ‘æˆ¦ä¸å¯ - æ–°ã‚µã‚¤ã‚¯ãƒ«é–‹å§‹ãŒå¿…è¦"),await st()?(console.log("âœ… [RestartDifferent] æ–°ã‚µã‚¤ã‚¯ãƒ«é–‹å§‹å®Œäº† - ã‚»ãƒƒã‚·ãƒ§ãƒ³1/8ã‹ã‚‰å†é–‹"),window.location.reload()):console.error("âŒ [RestartDifferent] æ–°ã‚µã‚¤ã‚¯ãƒ«é–‹å§‹å¤±æ•—");return}ot(),t(0,E="setup"),N&&(clearTimeout(N),N=null),t(7,b=""),t(8,_=0),console.log("ğŸ”„ [restartDifferentBaseNote] åŸºéŸ³æƒ…å ±ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ"),ue&&ue.resetDisplayState&&ue.resetDisplayState(),ut()}function ut(){x=0,D=!1,j=[],t(10,I=I.map(c=>({...c,state:"inactive",completed:!1})))}async function Fn(){console.log("ğŸš€ [StartNewCycle] 8ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†å¾Œã®æœ€åˆã‹ã‚‰æŒ‘æˆ¦é–‹å§‹");try{await st()?(console.log("âœ… [StartNewCycle] æ–°ã‚µã‚¤ã‚¯ãƒ«é–‹å§‹å®Œäº†"),localStorage.getItem("mic-test-completed")?(console.log("âœ… [StartNewCycle] ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆå®Œäº†ãƒ•ãƒ©ã‚°ç¢ºèª - ãƒªãƒ­ãƒ¼ãƒ‰ãªã—ã§çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ"),ot(),await wt(),t(0,E="setup"),ut(),gt(),console.log("âœ… [StartNewCycle] çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆå®Œäº† - ã‚»ãƒƒã‚·ãƒ§ãƒ³1/8ã‹ã‚‰å†é–‹")):window.location.reload()):(console.error("âŒ [StartNewCycle] æ–°ã‚µã‚¤ã‚¯ãƒ«é–‹å§‹å¤±æ•—"),et())}catch(c){console.error("âŒ [StartNewCycle] æ–°ã‚µã‚¤ã‚¯ãƒ«é–‹å§‹ã‚¨ãƒ©ãƒ¼:",c),et()}}function Tn(c){const{type:g}=c.detail;switch(g){case"same":Rn();break;case"different":qn();break;case"restart":Fn();break;case"home":et();break;default:console.warn("ğŸš« [ActionButtons] æœªçŸ¥ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—:",g)}}function En(c){const{healthy:g,errors:F,details:H}=c.detail;t(2,T=g),t(6,R=F),g||(console.warn("âš ï¸ ãƒã‚¤ã‚¯ã®å¥åº·çŠ¶æ…‹ãŒæ‚ªåŒ–:",F),E==="guiding"&&(t(0,E="setup"),console.warn("ğŸ›‘ ãƒã‚¤ã‚¯å•é¡Œã«ã‚ˆã‚Šãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’åœæ­¢")))}zn(()=>{console.log("ğŸ”„ [RandomTraining] onDestroy - AudioManagerãƒªã‚½ãƒ¼ã‚¹ã¯ä¿æŒ"),be&&(be.dispose(),t(31,be=null))});const Fs=[];ir.keys(e).forEach(c=>{!~Fs.indexOf(c)&&c.slice(0,2)!=="$$"&&c!=="slot"&&cr.warn(`<Page> was created with unknown prop '${c}'`)});function Ts(c){xs[c?"unshift":"push"](()=>{ue=c,t(22,ue)})}return a.$capture_state=()=>({onMount:xn,onDestroy:zn,goto:St,base:dt,page:bt,ChevronRight:er,Music:ts,Card:Qe,Button:ft,VolumeBar:Hs,PitchDisplay:$s,PitchDetector:$n,PitchDetectionDisplay:Yn,PageLayout:Qn,Tone:Ys,audioManager:Ze,harmonicCorrection:Dt,logger:le,ScoreResultPanel:rr,IntervalProgressTracker:Qs,ConsistencyGraph:Xs,FeedbackDisplay:Ks,SessionStatistics:Js,UnifiedScoreResultFixed:an,ActionButtons:on,EvaluationEngine:rt,EnhancedScoringEngine:Ht,trainingProgress:Tt,currentSessionId:Ft,nextBaseNote:qt,nextBaseName:Rt,isLoading:Ct,storageError:Zs,isCompleted:Mt,sessionHistory:kt,overallGrade:Us,overallAccuracy:Ws,progressPercentage:Gs,remainingSessions:At,latestSessionResult:Os,unifiedScoreData:_t,loadProgress:wt,saveSessionResult:jn,resetProgress:js,createNewProgress:Vs,startNewCycleIfCompleted:st,getVolumeForDevice:Zn,calculateUnifiedGrade:L,generateTestUnifiedScoreData:lr,trainingPhase:E,microphoneState:w,microphoneHealthy:T,microphoneErrors:R,buildVersion:Qt,buildTimestamp:Yt,updateStatus:$t,SCALE_NAMES:O,currentBaseNote:b,currentBaseFrequency:_,isPlaying:z,currentScaleIndex:x,scaleSteps:I,guideAnimationTimer:N,isGuideAnimationActive:D,guideStartProgress:G,isGuideStartBarActive:J,guideStartTimer:P,musicIconGlowing:W,scaleEvaluations:j,previousEvaluations:$,currentVolume:ae,currentFrequency:De,detectedNote:_e,pitchDifference:Pe,sessionResults:Se,scoringEngine:Ae,currentScoreData:Ce,intervalData:ke,consistencyData:Re,feedbackData:We,technicalFeedbackData:Ye,sessionStatistics:xe,activeTab:mt,noteResultsForDisplay:oe,currentUnifiedScoreData:me,sampler:be,isSamplerLoading:ze,pitchDetectorComponent:ue,mediaStream:je,audioContext:it,sourceNode:ct,sessionStartTime:Je,baseNotes:Ue,checkMicrophonePermission:Ke,selectRandomBaseNote:gt,playRandomBaseNote:cn,playCurrentBaseNote:ln,playBaseNoteOnly:As,playBaseNote:un,startGuideStartBar:dn,cleanupGuideStartBar:ks,calculateExpectedFrequency:$e,calculateTargetFrequency:fn,startGuideAnimation:ht,finishGuideAnimation:mn,calculateFinalResults:gn,getStatusMessage:Ms,getDisplayEvaluations:Cs,goToMicrophoneTest:hn,goHome:et,initializeSampler:yn,checkExistingMicrophonePermission:lt,initializeScoringEngine:pn,updateScoringEngine:vn,generateFinalScoring:Sn,generateTestScoreData:bn,switchTab:Rs,generateUnifiedScoreData:Dn,saveSessionToStorage:wn,generateEnhancedScoringData:_n,generateFallbackEnhancedData:yt,generateIntervalDataFromResults:It,generateIntervalDataFromSessionHistory:Jn,generateConsistencyDataFromResults:pt,generateFeedbackFromResults:vt,generateTechnicalFeedbackFromEnhancedEngine:An,handlePitchUpdate:kn,getEvaluationCorrectedFrequency:Mn,frequencyToNote:Kn,multiStageOctaveCorrection:Nt,evaluateScaleStep:Cn,completeSession:qs,restartSameBaseNote:Rn,restartDifferentBaseNote:qn,scrollToTop:ot,resetSessionState:ut,startNewCycle:Fn,handleActionButtonClick:Tn,handlePitchDetectorStateChange:ws,handlePitchDetectorError:_s,handleMicrophoneHealthChange:En,canRestartSession:s,canStartTraining:n,$unifiedScoreData:r,$isCompleted:o,$page:i,$currentSessionId:d,$remainingSessions:l,$nextBaseName:u,$nextBaseNote:f,$sessionHistory:h,$trainingProgress:m,$isLoading:p}),a.$inject_state=c=>{"trainingPhase"in c&&t(0,E=c.trainingPhase),"microphoneState"in c&&t(1,w=c.microphoneState),"microphoneHealthy"in c&&t(2,T=c.microphoneHealthy),"microphoneErrors"in c&&t(6,R=c.microphoneErrors),"currentBaseNote"in c&&t(7,b=c.currentBaseNote),"currentBaseFrequency"in c&&t(8,_=c.currentBaseFrequency),"isPlaying"in c&&t(9,z=c.isPlaying),"currentScaleIndex"in c&&(x=c.currentScaleIndex),"scaleSteps"in c&&t(10,I=c.scaleSteps),"guideAnimationTimer"in c&&(N=c.guideAnimationTimer),"isGuideAnimationActive"in c&&(D=c.isGuideAnimationActive),"guideStartProgress"in c&&t(11,G=c.guideStartProgress),"isGuideStartBarActive"in c&&(J=c.isGuideStartBarActive),"guideStartTimer"in c&&(P=c.guideStartTimer),"musicIconGlowing"in c&&t(12,W=c.musicIconGlowing),"scaleEvaluations"in c&&(j=c.scaleEvaluations),"previousEvaluations"in c&&($=c.previousEvaluations),"currentVolume"in c&&t(13,ae=c.currentVolume),"currentFrequency"in c&&t(14,De=c.currentFrequency),"detectedNote"in c&&t(15,_e=c.detectedNote),"pitchDifference"in c&&(Pe=c.pitchDifference),"sessionResults"in c&&(Se=c.sessionResults),"scoringEngine"in c&&(Ae=c.scoringEngine),"currentScoreData"in c&&t(16,Ce=c.currentScoreData),"intervalData"in c&&t(3,ke=c.intervalData),"consistencyData"in c&&t(17,Re=c.consistencyData),"feedbackData"in c&&t(18,We=c.feedbackData),"technicalFeedbackData"in c&&t(19,Ye=c.technicalFeedbackData),"sessionStatistics"in c&&t(20,xe=c.sessionStatistics),"activeTab"in c&&(mt=c.activeTab),"noteResultsForDisplay"in c&&(oe=c.noteResultsForDisplay),"currentUnifiedScoreData"in c&&t(21,me=c.currentUnifiedScoreData),"sampler"in c&&t(31,be=c.sampler),"isSamplerLoading"in c&&t(32,ze=c.isSamplerLoading),"pitchDetectorComponent"in c&&t(22,ue=c.pitchDetectorComponent),"mediaStream"in c&&(je=c.mediaStream),"audioContext"in c&&(it=c.audioContext),"sourceNode"in c&&(ct=c.sourceNode),"sessionStartTime"in c&&(Je=c.sessionStartTime),"canRestartSession"in c&&(s=c.canRestartSession),"canStartTraining"in c&&(n=c.canStartTraining)},e&&"$$inject"in e&&a.$inject_state(e.$$inject),a.$$.update=()=>{a.$$.dirty[0]&6|a.$$.dirty[1]&3&&(n=w==="granted"&&!ze&&be&&T),a.$$.dirty[0]&1&&(s=E==="results"),a.$$.dirty[0]&56&&r&&o&&r.sessionHistory&&(t(3,ke=Jn(r.sessionHistory)),console.log("ğŸµ [RandomTraining] intervalDataç”Ÿæˆå®Œäº†:",ke.length,"ä»¶")),a.$$.dirty[0]&3&&E==="setup"&&w==="granted"&&ot()},[E,w,T,ke,r,o,R,b,_,z,I,G,W,ae,De,_e,Ce,Re,We,Ye,xe,me,ue,h,p,un,hn,et,kn,Tn,En,be,ze,Ts]}class Dr extends en{constructor(e){super(e),tn(this,e,ur,Xt,nn,{},null,[-1,-1,-1,-1]),se("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:Xt.name})}}export{Dr as component,br as universal};
