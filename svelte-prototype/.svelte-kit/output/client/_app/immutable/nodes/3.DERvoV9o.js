import{S as Bt,i as Tt,d as A,s as Vt,v as xt,c as St,a as It,D as ut,b as h,q as K,r as Q,u as W,f as T,w as X,E as qt,m as R,x as Y,p as U,y as tt,F as Nt,g as y,z as d,h as p,G as Rt,j as b,k as B,B as G,A as j,o as k,C as Z,n as et,H as ct,l as nt,t as ot,I as dt}from"../chunks/BJ74v9sL.js";import{g as Ut}from"../chunks/D0QH3NT1.js";import"../chunks/DEjcJ3UU.js";import{p as st}from"../chunks/j3UJksNM.js";import{b as ft,g as ht}from"../chunks/xueUs-vQ.js";import{P as vt,B as jt,C as pt}from"../chunks/DUi99-yi.js";import{a as mt,V as At,P as _t,b as gt}from"../chunks/COU30Idw.js";const{console:Ot}=Ut,_="src/routes/microphone-test/+page.svelte";function yt(a){let t,e="マイクのテストを開始します",r,n,i="マイクテスト開始ボタンを押してマイクの使用を許可してください",s,o;function c(g,m){if(g[0]==="pending")return Pt;if(g[0]==="denied")return Ct;if(g[0]==="initial")return kt}let l=c(a),u=l&&l(a);const v={c:function(){t=k("h3"),t.textContent=e,r=U(),n=k("p"),n.textContent=i,s=U(),u&&u.c(),o=dt(),this.h()},l:function(m){t=b(m,"H3",{class:!0,"data-svelte-h":!0}),j(t)!=="svelte-gfi16f"&&(t.textContent=e),r=R(m),n=b(m,"P",{class:!0,"data-svelte-h":!0}),j(n)!=="svelte-1w19y1h"&&(n.textContent=i),s=R(m),u&&u.l(m),o=dt(),this.h()},h:function(){d(t,"class","instructions-title svelte-s1thfd"),p(t,_,184,12,5713),d(n,"class","instructions-description svelte-s1thfd"),p(n,_,185,12,5775)},m:function(m,w){T(m,t,w),T(m,r,w),T(m,n,w),T(m,s,w),u&&u.m(m,w),T(m,o,w)},p:function(m,w){l===(l=c(m))&&u?u.p(m,w):(u&&u.d(1),u=l&&l(m),u&&(u.c(),u.m(o.parentNode,o)))},d:function(m){m&&(h(t),h(r),h(n),h(s),h(o)),u&&u.d(m)}};return A("SvelteRegisterBlock",{block:v,id:yt.name,type:"else",source:"(183:10) {:else}",ctx:a}),v}function bt(a){let t,e="マイク準備完了",r,n,i,s=a[5].name+"",o,c,l,u,v,g="トレーニング開始",m,w;const V={c:function(){t=k("h3"),t.textContent=e,r=U(),n=k("p"),i=ot("トレーニング開始ボタンを押して"),o=ot(s),c=ot("へ進んでください"),l=U(),u=k("div"),v=k("button"),v.textContent=g,this.h()},l:function(C){t=b(C,"H3",{class:!0,"data-svelte-h":!0}),j(t)!=="svelte-11dam81"&&(t.textContent=e),r=R(C),n=b(C,"P",{class:!0});var P=B(n);i=nt(P,"トレーニング開始ボタンを押して"),o=nt(P,s),c=nt(P,"へ進んでください"),P.forEach(h),l=R(C),u=b(C,"DIV",{class:!0});var x=B(u);v=b(x,"BUTTON",{class:!0,"data-svelte-h":!0}),j(v)!=="svelte-kae9rs"&&(v.textContent=g),x.forEach(h),this.h()},h:function(){d(t,"class","ready-title svelte-s1thfd"),p(t,_,174,12,5308),d(n,"class","ready-description svelte-s1thfd"),p(n,_,175,12,5357),d(v,"class","training-start-button enabled svelte-s1thfd"),p(v,_,178,14,5513),d(u,"class","training-start-button-area svelte-s1thfd"),p(u,_,177,12,5458)},m:function(C,P){T(C,t,P),T(C,r,P),T(C,n,P),y(n,i),y(n,o),y(n,c),T(C,l,P),T(C,u,P),y(u,v),m||(w=ct(v,"click",a[7],!1),m=!0)},p:et,d:function(C){C&&(h(t),h(r),h(n),h(l),h(u)),m=!1,w()}};return A("SvelteRegisterBlock",{block:V,id:bt.name,type:"if",source:"(173:10) {#if micPermission === 'granted'}",ctx:a}),V}function kt(a){let t,e,r="マイクテストを開始",n,i;const s={c:function(){t=k("div"),e=k("button"),e.textContent=r,this.h()},l:function(c){t=b(c,"DIV",{class:!0});var l=B(t);e=b(l,"BUTTON",{class:!0,"data-svelte-h":!0}),j(e)!=="svelte-caex95"&&(e.textContent=r),l.forEach(h),this.h()},h:function(){d(e,"class","mic-test-button start svelte-s1thfd"),p(e,_,197,16,6330),d(t,"class","mic-test-button-area svelte-s1thfd"),p(t,_,196,14,6279)},m:function(c,l){T(c,t,l),y(t,e),n||(i=ct(e,"click",a[6],!1),n=!0)},p:et,d:function(c){c&&h(t),n=!1,i()}};return A("SvelteRegisterBlock",{block:s,id:kt.name,type:"if",source:"(196:50) ",ctx:a}),s}function Ct(a){let t,e,r="マイク許可を再試行",n,i;const s={c:function(){t=k("div"),e=k("button"),e.textContent=r,this.h()},l:function(c){t=b(c,"DIV",{class:!0});var l=B(t);e=b(l,"BUTTON",{class:!0,"data-svelte-h":!0}),j(e)!=="svelte-1p3n8nt"&&(e.textContent=r),l.forEach(h),this.h()},h:function(){d(e,"class","mic-test-button retry svelte-s1thfd"),p(e,_,191,16,6071),d(t,"class","mic-test-button-area svelte-s1thfd"),p(t,_,190,14,6020)},m:function(c,l){T(c,t,l),y(t,e),n||(i=ct(e,"click",a[6],!1),n=!0)},p:et,d:function(c){c&&h(t),n=!1,i()}};return A("SvelteRegisterBlock",{block:s,id:Ct.name,type:"if",source:"(190:49) ",ctx:a}),s}function Pt(a){let t,e="マイク準備中...";const r={c:function(){t=k("p"),t.textContent=e,this.h()},l:function(i){t=b(i,"P",{class:!0,"data-svelte-h":!0}),j(t)!=="svelte-1vb5g92"&&(t.textContent=e),this.h()},h:function(){d(t,"class","status-text svelte-s1thfd"),p(t,_,188,14,5919)},m:function(i,s){T(i,t,s)},p:et,d:function(i){i&&h(t)}};return A("SvelteRegisterBlock",{block:r,id:Pt.name,type:"if",source:"(188:12) {#if micPermission === 'pending'}",ctx:a}),r}function Mt(a){let t;function e(s,o){return s[0]==="granted"?bt:yt}let r=e(a),n=r(a);const i={c:function(){t=k("div"),n.c(),this.h()},l:function(o){t=b(o,"DIV",{class:!0});var c=B(t);n.l(c),c.forEach(h),this.h()},h:function(){d(t,"class","training-mode-content svelte-s1thfd"),p(t,_,171,8,5187)},m:function(o,c){T(o,t,c),n.m(t,null)},p:function(o,c){r===(r=e(o))&&n?n.p(o,c):(n.d(1),n=r(o),n&&(n.c(),n.m(t,null)))},d:function(o){o&&h(t),n.d()}};return A("SvelteRegisterBlock",{block:i,id:Mt.name,type:"slot",source:'(171:6) <Card variant=\\"default\\" padding=\\"lg\\">',ctx:a}),i}function Dt(a){let t,e,r,n,i,s,o,c,l,u,v,g,m="マイクテスト",w,V,q="音感トレーニングを始める前に、マイクの動作を確認します",C,P,x,f,D,O,I,S,F;x=new pt({props:{variant:"default",padding:"lg",$$slots:{default:[Mt]},$$scope:{ctx:a}},$$inline:!0}),D=new _t({props:{frequency:a[2],note:a[3],volume:a[1],isMuted:a[0]!=="granted",muteMessage:"マイク許可後に開始"},$$inline:!0});let Et={isActive:a[0]==="granted",className:"pitch-detector-content",debugMode:!1};S=new gt({props:Et,$$inline:!0}),a[10](S),S.$on("pitchUpdate",a[8]),S.$on("stateChange",wt),S.$on("error",a[9]);const rt={c:function(){t=k("div"),e=k("div"),r=k("div"),n=k("div"),i=Z("svg"),s=Z("path"),o=Z("path"),c=Z("line"),l=Z("line"),u=U(),v=k("div"),g=k("h1"),g.textContent=m,w=U(),V=k("p"),V.textContent=q,C=U(),P=k("div"),tt(x.$$.fragment),f=U(),tt(D.$$.fragment),O=U(),I=k("div"),tt(S.$$.fragment),this.h()},l:function(M){t=b(M,"DIV",{class:!0});var E=B(t);e=b(E,"DIV",{class:!0});var H=B(e);r=b(H,"DIV",{class:!0});var N=B(r);n=b(N,"DIV",{class:!0});var $=B(n);i=G($,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var L=B(i);s=G(L,"path",{d:!0}),B(s).forEach(h),o=G(L,"path",{d:!0}),B(o).forEach(h),c=G(L,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),B(c).forEach(h),l=G(L,"line",{x1:!0,x2:!0,y1:!0,y2:!0}),B(l).forEach(h),L.forEach(h),$.forEach(h),u=R(N),v=b(N,"DIV",{});var J=B(v);g=b(J,"H1",{class:!0,"data-svelte-h":!0}),j(g)!=="svelte-z7m4lk"&&(g.textContent=m),w=R(J),V=b(J,"P",{class:!0,"data-svelte-h":!0}),j(V)!=="svelte-1vtv92f"&&(V.textContent=q),J.forEach(h),N.forEach(h),H.forEach(h),C=R(E),P=b(E,"DIV",{class:!0});var at=B(P);Y(x.$$.fragment,at),at.forEach(h),f=R(E),Y(D.$$.fragment,E),O=R(E),I=b(E,"DIV",{style:!0});var lt=B(I);Y(S.$$.fragment,lt),lt.forEach(h),E.forEach(h),this.h()},h:function(){d(s,"d","M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"),p(s,_,155,12,4645),d(o,"d","M19 10v2a7 7 0 0 1-14 0v-2"),p(o,_,156,12,4722),d(c,"x1","12"),d(c,"x2","12"),d(c,"y1","19"),d(c,"y2","22"),p(c,_,157,12,4773),d(l,"x1","8"),d(l,"x2","16"),d(l,"y1","22"),d(l,"y2","22"),p(l,_,158,12,4825),d(i,"width","48"),d(i,"height","48"),d(i,"viewBox","0 0 24 24"),d(i,"fill","none"),d(i,"stroke","currentColor"),d(i,"stroke-width","2"),p(i,_,154,10,4533),d(n,"class","mic-icon svelte-s1thfd"),p(n,_,153,8,4500),d(g,"class","mic-test-title svelte-s1thfd"),p(g,_,162,10,4920),d(V,"class","mic-test-description svelte-s1thfd"),p(V,_,163,10,4969),p(v,_,161,8,4904),d(r,"class","mic-test-header svelte-s1thfd"),p(r,_,152,6,4462),d(e,"class","header svelte-s1thfd"),p(e,_,151,4,4435),d(P,"class","training-mode-info svelte-s1thfd"),p(P,_,169,4,5102),Rt(I,"display","none"),p(I,_,217,4,6834),d(t,"class","microphone-test svelte-s1thfd"),p(t,_,149,2,4383)},m:function(M,E){T(M,t,E),y(t,e),y(e,r),y(r,n),y(n,i),y(i,s),y(i,o),y(i,c),y(i,l),y(r,u),y(r,v),y(v,g),y(v,w),y(v,V),y(t,C),y(t,P),X(x,P,null),y(t,f),X(D,t,null),y(t,O),y(t,I),X(S,I,null),F=!0},p:function(M,E){const H={};E&16385&&(H.$$scope={dirty:E,ctx:M}),x.$set(H);const N={};E&4&&(N.frequency=M[2]),E&8&&(N.note=M[3]),E&2&&(N.volume=M[1]),E&1&&(N.isMuted=M[0]!=="granted"),D.$set(N);const $={};E&1&&($.isActive=M[0]==="granted"),S.$set($)},i:function(M){F||(W(x.$$.fragment,M),W(D.$$.fragment,M),W(S.$$.fragment,M),F=!0)},o:function(M){Q(x.$$.fragment,M),Q(D.$$.fragment,M),Q(S.$$.fragment,M),F=!1},d:function(M){M&&h(t),K(x),K(D),a[10](null),K(S)}};return A("SvelteRegisterBlock",{block:rt,id:Dt.name,type:"slot",source:"(149:0) <PageLayout showBackButton={true}>",ctx:a}),rt}function it(a){let t,e,r;e=new vt({props:{showBackButton:!0,$$slots:{default:[Dt]},$$scope:{ctx:a}},$$inline:!0});const n={c:function(){t=U(),tt(e.$$.fragment),this.h()},l:function(s){qt("svelte-8st1fo",document.head).forEach(h),t=R(s),Y(e.$$.fragment,s),this.h()},h:function(){document.title="マイクテスト - 相対音感トレーニング"},m:function(s,o){T(s,t,o),X(e,s,o),r=!0},p:function(s,[o]){const c={};o&16415&&(c.$$scope={dirty:o,ctx:s}),e.$set(c)},i:function(s){r||(W(e.$$.fragment,s),r=!0)},o:function(s){Q(e.$$.fragment,s),r=!1},d:function(s){s&&h(t),K(e,s)}};return A("SvelteRegisterBlock",{block:n,id:it.name,type:"component",source:"",ctx:a}),n}function wt(a){}function zt(a,t,e){let r;xt(st,"page"),St(a,st,f=>e(12,r=f));let{$$slots:n={},$$scope:i}=t;It("Page",n,[]);let s="random";ut(()=>{r.url.searchParams.has("mode")&&(s=r.url.searchParams.get("mode")||"random")});let o="initial",c=0,l=0,u="ーー",v=null;const g={random:{name:"ランダム基音モード",description:"10種類の基音からランダムに選択してトレーニング",color:"green",path:"/training/random"},continuous:{name:"連続チャレンジモード",description:"選択した回数だけ連続で実行し、総合評価を確認",color:"orange",path:"/training/continuous"},chromatic:{name:"12音階モード",description:"クロマチックスケールの上行・下行で完全制覇",color:"purple",path:"/training/chromatic"}},m=g[s]||g.random;async function w(){var f;e(0,o="pending");try{if(console.log("🎤 [MicTest] マイク許可リクエスト開始"),!((f=navigator.mediaDevices)!=null&&f.getUserMedia)){e(0,o="denied"),console.error("❌ [MicTest] getUserMediaがサポートされていません");return}const D=await mt.initialize();if(console.log("✅ [MicTest] AudioManager リソース取得完了"),D.mediaStream&&D.audioContext)e(0,o="granted"),console.log("✅ [MicTest] マイク許可完了"),setTimeout(async()=>{v&&(console.log("🎙️ [MicTest] PitchDetector初期化開始"),await v.initialize(),console.log("✅ [MicTest] PitchDetector初期化完了"),console.log("🎯 [MicTest] PitchDetector isActiveリアクティブで自動検出開始"))},1e3);else throw new Error("リソース取得失敗")}catch(D){console.error("❌ [MicTest] マイク許可エラー:",D),e(0,o=((D==null?void 0:D.name)==="NotAllowedError","denied"))}}function V(){console.log("🚀 [MicTest] トレーニング開始 - ランダム基音モードへ遷移"),localStorage.setItem("mic-test-completed","true"),console.log("✅ [MicTest] マイクテスト完了フラグを保存"),ht(`${ft}${m.path}?from=microphone-test`)}function q(f){const{frequency:D,note:O,volume:I,rawVolume:S,clarity:F}=f.detail;e(2,l=D),e(3,u=O),e(1,c=I)}function C(f){console.error("❌ [MicTest] PitchDetectorエラー:",f.detail);const{error:D,reason:O,recovery:I}=f.detail;O==="mediastream_ended"&&I==="restart_required"&&(console.log("🔄 [MicTest] MediaStream終了検出 - 自動復旧開始"),e(0,o="initial"),e(1,c=0),e(2,l=0),e(3,u="ーー"),console.log("⚠️ [MicTest] マイク再許可が必要です"))}const P=[];Object.keys(t).forEach(f=>{!~P.indexOf(f)&&f.slice(0,2)!=="$$"&&f!=="slot"&&Ot.warn(`<Page> was created with unknown prop '${f}'`)});function x(f){Nt[f?"unshift":"push"](()=>{v=f,e(4,v)})}return a.$capture_state=()=>({onMount:ut,page:st,goto:ht,base:ft,Card:pt,Button:jt,PageLayout:vt,PitchDetector:gt,PitchDetectionDisplay:_t,VolumeBar:At,audioManager:mt,mode:s,micPermission:o,currentVolume:c,currentFrequency:l,detectedNote:u,pitchDetectorComponent:v,trainingModes:g,selectedMode:m,requestMicrophone:w,startTraining:V,handlePitchUpdate:q,handlePitchDetectorStateChange:wt,handlePitchDetectorError:C,$page:r}),a.$inject_state=f=>{"mode"in f&&(s=f.mode),"micPermission"in f&&e(0,o=f.micPermission),"currentVolume"in f&&e(1,c=f.currentVolume),"currentFrequency"in f&&e(2,l=f.currentFrequency),"detectedNote"in f&&e(3,u=f.detectedNote),"pitchDetectorComponent"in f&&e(4,v=f.pitchDetectorComponent)},t&&"$$inject"in t&&a.$inject_state(t.$$inject),[o,c,l,u,v,m,w,V,q,C,x]}class Kt extends Bt{constructor(t){super(t),Tt(this,t,zt,it,Vt,{}),A("SvelteRegisterComponent",{component:this,tagName:"Page",options:t,id:it.name})}}export{Kt as component};
