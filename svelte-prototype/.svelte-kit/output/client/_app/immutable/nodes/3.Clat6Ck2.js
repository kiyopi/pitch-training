import{S as ot,i as ct,s as ut,d,C as Z,m as W,o as X,b as E,D as Y,H as dt,h as I,E as tt,k as T,F as et,l as ft,I as ht,J as mt,c as u,y as m,e as v,f as A,G as B,j as p,K as at,a as K,g as z,t as H,r as rt,n as st,A as nt}from"../chunks/uh9PtHny.js";import"../chunks/IHki7fMi.js";import{p as vt}from"../chunks/DkgQdnC4.js";import{g as pt,b as _t}from"../chunks/CUnwKmM_.js";import{P as gt,C as lt}from"../chunks/D0Fu-G_v.js";function yt(o){let e,t="マイク準備完了",l,s,r="トレーニング開始ボタンを押してランダム基音モードへ進んでください",n,a,c,i="トレーニング開始",_,k;return{c(){e=p("h3"),e.textContent=t,l=T(),s=p("p"),s.textContent=r,n=T(),a=p("div"),c=p("button"),c.textContent=i,this.h()},l(g){e=v(g,"H3",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-11dam81"&&(e.textContent=t),l=I(g),s=v(g,"P",{class:!0,"data-svelte-h":!0}),B(s)!=="svelte-5idwhi"&&(s.textContent=r),n=I(g),a=v(g,"DIV",{class:!0});var h=A(a);c=v(h,"BUTTON",{class:!0,"data-svelte-h":!0}),B(c)!=="svelte-1udqj6u"&&(c.textContent=i),h.forEach(d),this.h()},h(){m(e,"class","ready-title svelte-19mrh3"),m(s,"class","ready-description svelte-19mrh3"),m(c,"class","training-start-button enabled svelte-19mrh3"),m(a,"class","training-start-button-area svelte-19mrh3")},m(g,h){E(g,e,h),E(g,l,h),E(g,s,h),E(g,n,h),E(g,a,h),u(a,c),_||(k=nt(c,"click",o[13]),_=!0)},p:st,d(g){g&&(d(e),d(l),d(s),d(n),d(a)),_=!1,k()}}}function Ct(o){let e,t;function l(i,_){return i[3]==="granted"&&i[4]&&(!i[0]||!i[1])?Dt:bt}let s=l(o),r=s(o);function n(i,_){if(i[3]==="pending")return Vt;if(i[3]==="denied")return At;if(i[3]==="initial")return kt}let a=n(o),c=a&&a(o);return{c(){r.c(),e=T(),c&&c.c(),t=rt()},l(i){r.l(i),e=I(i),c&&c.l(i),t=rt()},m(i,_){r.m(i,_),E(i,e,_),c&&c.m(i,_),E(i,t,_)},p(i,_){s!==(s=l(i))&&(r.d(1),r=s(i),r&&(r.c(),r.m(e.parentNode,e))),a===(a=n(i))&&c?c.p(i,_):(c&&c.d(1),c=a&&a(i),c&&(c.c(),c.m(t.parentNode,t)))},d(i){i&&(d(e),d(t)),r.d(i),c&&c.d(i)}}}function bt(o){let e,t="マイクのテストを開始します",l,s,r="マイクテスト開始ボタンを押してマイクの使用を許可してください";return{c(){e=p("h3"),e.textContent=t,l=T(),s=p("p"),s.textContent=r,this.h()},l(n){e=v(n,"H3",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-gfi16f"&&(e.textContent=t),l=I(n),s=v(n,"P",{class:!0,"data-svelte-h":!0}),B(s)!=="svelte-1w19y1h"&&(s.textContent=r),this.h()},h(){m(e,"class","instructions-title svelte-19mrh3"),m(s,"class","instructions-description svelte-19mrh3")},m(n,a){E(n,e,a),E(n,l,a),E(n,s,a)},d(n){n&&(d(e),d(l),d(s))}}}function Dt(o){let e,t="「ドー」と発声してください";return{c(){e=p("p"),e.textContent=t,this.h()},l(l){e=v(l,"P",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-15d2sx7"&&(e.textContent=t),this.h()},h(){m(e,"class","status-text voice-instruction svelte-19mrh3")},m(l,s){E(l,e,s)},d(l){l&&d(e)}}}function kt(o){let e,t,l="マイクテストを開始",s,r;return{c(){e=p("div"),t=p("button"),t.textContent=l,this.h()},l(n){e=v(n,"DIV",{class:!0});var a=A(e);t=v(a,"BUTTON",{class:!0,"data-svelte-h":!0}),B(t)!=="svelte-caex95"&&(t.textContent=l),a.forEach(d),this.h()},h(){m(t,"class","mic-test-button start svelte-19mrh3"),m(e,"class","mic-test-button-area svelte-19mrh3")},m(n,a){E(n,e,a),u(e,t),s||(r=nt(t,"click",o[12]),s=!0)},p:st,d(n){n&&d(e),s=!1,r()}}}function At(o){let e,t,l="マイク許可を再試行",s,r;return{c(){e=p("div"),t=p("button"),t.textContent=l,this.h()},l(n){e=v(n,"DIV",{class:!0});var a=A(e);t=v(a,"BUTTON",{class:!0,"data-svelte-h":!0}),B(t)!=="svelte-1p3n8nt"&&(t.textContent=l),a.forEach(d),this.h()},h(){m(t,"class","mic-test-button retry svelte-19mrh3"),m(e,"class","mic-test-button-area svelte-19mrh3")},m(n,a){E(n,e,a),u(e,t),s||(r=nt(t,"click",o[12]),s=!0)},p:st,d(n){n&&d(e),s=!1,r()}}}function Vt(o){let e,t="マイク準備中...";return{c(){e=p("p"),e.textContent=t,this.h()},l(l){e=v(l,"P",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-1vb5g92"&&(e.textContent=t),this.h()},h(){m(e,"class","status-text svelte-19mrh3")},m(l,s){E(l,e,s)},p:st,d(l){l&&d(e)}}}function $t(o){let e;function t(r,n){return r[2]?yt:Ct}let l=t(o),s=l(o);return{c(){e=p("div"),s.c(),this.h()},l(r){e=v(r,"DIV",{class:!0});var n=A(e);s.l(n),n.forEach(d),this.h()},h(){m(e,"class","training-mode-content svelte-19mrh3")},m(r,n){E(r,e,n),s.m(e,null)},p(r,n){l===(l=t(r))&&s?s.p(r,n):(s.d(1),s=l(r),s&&(s.c(),s.m(e,null)))},d(r){r&&d(e),s.d()}}}function it(o){let e,t,l,s,r="フィルター前:",n,a,c=o[8].toFixed(1)+"",i,_,k,g,h,b="フィルター後:",V,y,f=o[9].toFixed(1)+"",w,C,$,D,x,M="ノイズ削減:",U,P,G,N;return{c(){e=p("div"),t=p("div"),l=p("div"),s=p("span"),s.textContent=r,n=T(),a=p("span"),i=H(c),_=H("%"),k=T(),g=p("div"),h=p("span"),h.textContent=b,V=T(),y=p("span"),w=H(f),C=H("%"),$=T(),D=p("div"),x=p("span"),x.textContent=M,U=T(),P=p("span"),G=H(o[10]),N=H("%"),this.h()},l(F){e=v(F,"DIV",{class:!0});var q=A(e);t=v(q,"DIV",{class:!0});var S=A(t);l=v(S,"DIV",{class:!0});var J=A(l);s=v(J,"SPAN",{class:!0,"data-svelte-h":!0}),B(s)!=="svelte-1nh45c7"&&(s.textContent=r),n=I(J),a=v(J,"SPAN",{class:!0});var O=A(a);i=z(O,c),_=z(O,"%"),O.forEach(d),J.forEach(d),k=I(S),g=v(S,"DIV",{class:!0});var Q=A(g);h=v(Q,"SPAN",{class:!0,"data-svelte-h":!0}),B(h)!=="svelte-fz1u1y"&&(h.textContent=b),V=I(Q),y=v(Q,"SPAN",{class:!0});var R=A(y);w=z(R,f),C=z(R,"%"),R.forEach(d),Q.forEach(d),$=I(S),D=v(S,"DIV",{class:!0});var j=A(D);x=v(j,"SPAN",{class:!0,"data-svelte-h":!0}),B(x)!=="svelte-3jbm0v"&&(x.textContent=M),U=I(j),P=v(j,"SPAN",{class:!0});var L=A(P);G=z(L,o[10]),N=z(L,"%"),L.forEach(d),j.forEach(d),S.forEach(d),q.forEach(d),this.h()},h(){m(s,"class","stat-label svelte-19mrh3"),m(a,"class","stat-value raw svelte-19mrh3"),m(l,"class","stat-item svelte-19mrh3"),m(h,"class","stat-label svelte-19mrh3"),m(y,"class","stat-value filtered svelte-19mrh3"),m(g,"class","stat-item svelte-19mrh3"),m(x,"class","stat-label svelte-19mrh3"),m(P,"class","stat-value reduction svelte-19mrh3"),m(D,"class","stat-item svelte-19mrh3"),m(t,"class","noise-stats svelte-19mrh3"),m(e,"class","noise-reduction-info svelte-19mrh3")},m(F,q){E(F,e,q),u(e,t),u(t,l),u(l,s),u(l,n),u(l,a),u(a,i),u(a,_),u(t,k),u(t,g),u(g,h),u(g,V),u(g,y),u(y,w),u(y,C),u(t,$),u(t,D),u(D,x),u(D,U),u(D,P),u(P,G),u(P,N)},p(F,q){q&256&&c!==(c=F[8].toFixed(1)+"")&&K(i,c),q&512&&f!==(f=F[9].toFixed(1)+"")&&K(w,f),q&1024&&K(G,F[10])},d(F){F&&d(e)}}}function xt(o){let e;return{c(){e=H(" ")},l(t){e=z(t," ")},m(t,l){E(t,e,l)},d(t){t&&d(e)}}}function Et(o){let e;return{c(){e=H("⏳ 声を出して音量を確認してください")},l(t){e=z(t,"⏳ 声を出して音量を確認してください")},m(t,l){E(t,e,l)},d(t){t&&d(e)}}}function wt(o){let e,t,l,s="音量レベル",r,n,a,c,i,_=o[5].toFixed(1)+"",k,g,h,b,V,y,f=o[4]&&it(o);function w(D,x){return!D[0]&&D[4]?Et:xt}let C=w(o),$=C(o);return{c(){e=p("div"),t=p("div"),l=p("h3"),l.textContent=s,r=T(),n=p("div"),a=p("div"),c=T(),i=p("div"),k=H(_),g=H("%"),h=T(),f&&f.c(),b=T(),V=p("div"),y=p("span"),$.c(),this.h()},l(D){e=v(D,"DIV",{class:!0});var x=A(e);t=v(x,"DIV",{class:!0});var M=A(t);l=v(M,"H3",{class:!0,"data-svelte-h":!0}),B(l)!=="svelte-1nc8gri"&&(l.textContent=s),r=I(M),n=v(M,"DIV",{class:!0});var U=A(n);a=v(U,"DIV",{class:!0,style:!0}),A(a).forEach(d),U.forEach(d),c=I(M),i=v(M,"DIV",{class:!0});var P=A(i);k=z(P,_),g=z(P,"%"),P.forEach(d),h=I(M),f&&f.l(M),b=I(M),V=v(M,"DIV",{class:!0});var G=A(V);y=v(G,"SPAN",{class:!0});var N=A(y);$.l(N),N.forEach(d),G.forEach(d),M.forEach(d),x.forEach(d),this.h()},h(){m(l,"class","display-title svelte-19mrh3"),m(a,"class","volume-bar svelte-19mrh3"),at(a,"width",o[5]+"%"),m(n,"class","volume-bar-container svelte-19mrh3"),m(i,"class","volume-text svelte-19mrh3"),m(y,"class","status-pending svelte-19mrh3"),m(V,"class","volume-status svelte-19mrh3"),m(t,"class","volume-section svelte-19mrh3"),m(e,"class","card-inner svelte-19mrh3")},m(D,x){E(D,e,x),u(e,t),u(t,l),u(t,r),u(t,n),u(n,a),u(t,c),u(t,i),u(i,k),u(i,g),u(t,h),f&&f.m(t,null),u(t,b),u(t,V),u(V,y),$.m(y,null)},p(D,x){x&32&&at(a,"width",D[5]+"%"),x&32&&_!==(_=D[5].toFixed(1)+"")&&K(k,_),D[4]?f?f.p(D,x):(f=it(D),f.c(),f.m(t,b)):f&&(f.d(1),f=null),C!==(C=w(D))&&($.d(1),$=C(D),$&&($.c(),$.m(y,null)))},d(D){D&&d(e),f&&f.d(),$.d()}}}function Ft(o){let e;return{c(){e=H(" ")},l(t){e=z(t," ")},m(t,l){E(t,e,l)},d(t){t&&d(e)}}}function qt(o){let e;return{c(){e=H("⏳ 「ド」を発声して音程を確認してください")},l(t){e=z(t,"⏳ 「ド」を発声して音程を確認してください")},m(t,l){E(t,e,l)},d(t){t&&d(e)}}}function It(o){let e,t,l,s="音程検出",r,n,a,c=o[6]>0?o[6].toFixed(1)+" Hz":"ーー",i,_,k,g,h,b,V;function y(C,$){return!C[1]&&C[4]?qt:Ft}let f=y(o),w=f(o);return{c(){e=p("div"),t=p("div"),l=p("h3"),l.textContent=s,r=T(),n=p("div"),a=p("div"),i=H(c),_=T(),k=p("div"),g=H(o[7]),h=T(),b=p("div"),V=p("span"),w.c(),this.h()},l(C){e=v(C,"DIV",{class:!0});var $=A(e);t=v($,"DIV",{class:!0});var D=A(t);l=v(D,"H3",{class:!0,"data-svelte-h":!0}),B(l)!=="svelte-1ofzoy2"&&(l.textContent=s),r=I(D),n=v(D,"DIV",{class:!0});var x=A(n);a=v(x,"DIV",{class:!0});var M=A(a);i=z(M,c),M.forEach(d),_=I(x),k=v(x,"DIV",{class:!0});var U=A(k);g=z(U,o[7]),U.forEach(d),x.forEach(d),h=I(D),b=v(D,"DIV",{class:!0});var P=A(b);V=v(P,"SPAN",{class:!0});var G=A(V);w.l(G),G.forEach(d),P.forEach(d),D.forEach(d),$.forEach(d),this.h()},h(){m(l,"class","display-title svelte-19mrh3"),m(a,"class","frequency-value svelte-19mrh3"),m(k,"class","note-value svelte-19mrh3"),m(n,"class","frequency-display svelte-19mrh3"),m(V,"class","status-pending svelte-19mrh3"),m(b,"class","frequency-status svelte-19mrh3"),m(t,"class","frequency-section svelte-19mrh3"),m(e,"class","card-inner svelte-19mrh3")},m(C,$){E(C,e,$),u(e,t),u(t,l),u(t,r),u(t,n),u(n,a),u(a,i),u(n,_),u(n,k),u(k,g),u(t,h),u(t,b),u(b,V),w.m(V,null)},p(C,$){$&64&&c!==(c=C[6]>0?C[6].toFixed(1)+" Hz":"ーー")&&K(i,c),$&128&&K(g,C[7]),f!==(f=y(C))&&(w.d(1),w=f(C),w&&(w.c(),w.m(V,null)))},d(C){C&&d(e),w.d()}}}function Tt(o){let e,t,l='<div class="mic-test-header svelte-19mrh3"><div class="mic-icon svelte-19mrh3"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" x2="12" y1="19" y2="22"></line><line x1="8" x2="16" y1="22" y2="22"></line></svg></div> <div><h1 class="mic-test-title svelte-19mrh3">マイクテスト</h1> <p class="mic-test-description svelte-19mrh3">音感トレーニングを始める前に、マイクの動作を確認します</p></div></div>',s,r,n,a,c,i,_,k,g;return n=new lt({props:{variant:"default",padding:"lg",$$slots:{default:[$t]},$$scope:{ctx:o}}}),i=new lt({props:{variant:"default",padding:"lg",$$slots:{default:[wt]},$$scope:{ctx:o}}}),k=new lt({props:{variant:"default",padding:"lg",$$slots:{default:[It]},$$scope:{ctx:o}}}),{c(){e=p("div"),t=p("div"),t.innerHTML=l,s=T(),r=p("div"),et(n.$$.fragment),a=T(),c=p("div"),et(i.$$.fragment),_=T(),et(k.$$.fragment),this.h()},l(h){e=v(h,"DIV",{class:!0});var b=A(e);t=v(b,"DIV",{class:!0,"data-svelte-h":!0}),B(t)!=="svelte-4qcd63"&&(t.innerHTML=l),s=I(b),r=v(b,"DIV",{class:!0});var V=A(r);tt(n.$$.fragment,V),V.forEach(d),a=I(b),c=v(b,"DIV",{class:!0});var y=A(c);tt(i.$$.fragment,y),_=I(y),tt(k.$$.fragment,y),y.forEach(d),b.forEach(d),this.h()},h(){m(t,"class","header svelte-19mrh3"),m(r,"class","training-mode-info svelte-19mrh3"),m(c,"class","test-section svelte-19mrh3"),m(e,"class","microphone-test svelte-19mrh3")},m(h,b){E(h,e,b),u(e,t),u(e,s),u(e,r),Y(n,r,null),u(e,a),u(e,c),Y(i,c,null),u(c,_),Y(k,c,null),g=!0},p(h,b){const V={};b&16777247&&(V.$$scope={dirty:b,ctx:h}),n.$set(V);const y={};b&16779057&&(y.$$scope={dirty:b,ctx:h}),i.$set(y);const f={};b&16777426&&(f.$$scope={dirty:b,ctx:h}),k.$set(f)},i(h){g||(X(n.$$.fragment,h),X(i.$$.fragment,h),X(k.$$.fragment,h),g=!0)},o(h){W(n.$$.fragment,h),W(i.$$.fragment,h),W(k.$$.fragment,h),g=!1},d(h){h&&d(e),Z(n),Z(i),Z(k)}}}function Mt(o){let e,t,l;return t=new gt({props:{showBackButton:!0,$$slots:{default:[Tt]},$$scope:{ctx:o}}}),{c(){e=T(),et(t.$$.fragment),this.h()},l(s){dt("svelte-8st1fo",document.head).forEach(d),e=I(s),tt(t.$$.fragment,s),this.h()},h(){document.title="マイクテスト - 相対音感トレーニング"},m(s,r){E(s,e,r),Y(t,s,r),l=!0},p(s,[r]){const n={};r&16779263&&(n.$$scope={dirty:r,ctx:s}),t.$set(n)},i(s){l||(X(t.$$.fragment,s),l=!0)},o(s){W(t.$$.fragment,s),l=!1},d(s){s&&d(e),Z(t,s)}}}function Pt(o,e){let t=0;for(let a=0;a<o.length;a++)t+=o[a]*o[a];if(t=Math.sqrt(t/o.length),t<.005)return 0;const l=Math.floor(e/800),s=Math.floor(e/80);let r=0,n=0;for(let a=l;a<=s;a++){let c=0,i=0;for(let _=0;_<o.length-a;_++)c+=o[_]*o[_+a],i+=o[_]*o[_];i>0&&(c=c/Math.sqrt(i),c>r&&(r=c,n=a))}return r>.25?e/n:0}function Nt(o){const t=Math.round(12*Math.log2(o/440)),l=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],s=((t+9)%12+12)%12,r=Math.floor((t+9)/12)+4,n=l[s];return`${n}${r}（${{C:"ド","C#":"ド#",D:"レ","D#":"レ#",E:"ミ",F:"ファ","F#":"ファ#",G:"ソ","G#":"ソ#",A:"ラ","A#":"ラ#",B:"シ"}[n]}${r}）`}function St(o,e,t){let l;ft(o,vt,N=>t(20,l=N));let s="random";ht(()=>{l.url.searchParams.has("mode")&&(s=l.url.searchParams.get("mode")||"random")});let r="initial",n=!1,a=!1,c=!1,i=!1,_=0,k=0,g="ーー",h=0,b=0,V=0,y=null,f=null,w=null,C=null,$=null;const D={random:{name:"ランダム基音モード",description:"10種類の基音からランダムに選択してトレーニング",color:"green",path:"/training/random"},continuous:{name:"連続チャレンジモード",description:"選択した回数だけ連続で実行し、総合評価を確認",color:"orange",path:"/training/continuous"},chromatic:{name:"12音階モード",description:"クロマチックスケールの上行・下行で完全制覇",color:"purple",path:"/training/chromatic"}},x=D[s]||D.random;async function M(){t(3,r="pending");try{w=await navigator.mediaDevices.getUserMedia({audio:!0}),t(3,r="granted"),f=new(window.AudioContext||window.webkitAudioContext),f.state==="suspended"&&await f.resume();const N=f.createMediaStreamSource(w);y=f.createAnalyser(),y.fftSize=2048,y.smoothingTimeConstant=.8,y.minDecibels=-90,y.maxDecibels=-10,N.connect(y);const F=f.createBiquadFilter();F.type="highpass",F.frequency.setValueAtTime(80,f.currentTime),F.Q.setValueAtTime(.7,f.currentTime);const q=f.createBiquadFilter();q.type="lowpass",q.frequency.setValueAtTime(800,f.currentTime),q.Q.setValueAtTime(.7,f.currentTime);const S=f.createBiquadFilter();S.type="notch",S.frequency.setValueAtTime(60,f.currentTime),S.Q.setValueAtTime(10,f.currentTime),C=f.createAnalyser(),C.fftSize=2048,C.smoothingTimeConstant=.8,C.minDecibels=-90,C.maxDecibels=-10,N.connect(F),F.connect(q),q.connect(S),S.connect(C),t(4,n=!0),U()}catch{t(3,r="denied")}}function U(){if(!n||!C||!y)return;const N=C.frequencyBinCount,F=new Uint8Array(N),q=new Uint8Array(y.frequencyBinCount);C.getByteFrequencyData(F),y.getByteFrequencyData(q);let S=0;for(let L=0;L<q.length;L++)S+=q[L]*q[L];const J=Math.sqrt(S/q.length);t(8,h=Math.min(100,J/30*100));let O=0;for(let L=0;L<F.length;L++)O+=F[L]*F[L];const Q=Math.sqrt(O/F.length);t(9,b=Math.min(100,Q/30*100)),t(5,_=b),h>0?t(10,V=Math.max(0,Math.round((h-b)/h*100))):t(10,V=0),_>15&&t(0,a=!0);const R=new Float32Array(C.fftSize);C.getFloatTimeDomainData(R);const j=Pt(R,f.sampleRate);j>80&&j<800?(t(6,k=j),t(7,g=Nt(j)),t(1,c=!0)):(t(6,k=0),t(7,g="ーー")),$=requestAnimationFrame(U)}function P(){t(4,n=!1),$&&(cancelAnimationFrame($),$=null),w&&(w.getTracks().forEach(N=>N.stop()),w=null),f&&f.state!=="closed"&&(f.close(),f=null),C=null,y=null}mt(()=>{P()});const G=()=>pt(`${_t}${x.path}`);return o.$$.update=()=>{o.$$.dirty&7&&a&&c&&!i&&t(2,i=!0)},[a,c,i,r,n,_,k,g,h,b,V,x,M,G]}class Gt extends ot{constructor(e){super(),ct(this,e,St,Mt,ut,{})}}export{Gt as component};
