class b{constructor(){this.intervalTypes={unison:{name:"同度",semitones:0,importance:.8,description:"基音と同じ高さ",difficulty:"基本",commonErrors:["微細なピッチのずれ"]},minorSecond:{name:"短2度",semitones:1,importance:.9,description:"半音上",difficulty:"高",commonErrors:["長2度との混同","音程幅の過大評価"]},majorSecond:{name:"長2度",semitones:2,importance:1,description:"全音上（ドレ）",difficulty:"基本",commonErrors:["短2度との混同"]},minorThird:{name:"短3度",semitones:3,importance:1,description:"短調の3度（ドミ♭）",difficulty:"中",commonErrors:["長3度との混同"]},majorThird:{name:"長3度",semitones:4,importance:1,description:"長調の3度（ドミ）",difficulty:"基本",commonErrors:["短3度との混同","完全4度への誤認"]},perfectFourth:{name:"完全4度",semitones:5,importance:.9,description:"安定した協和音程（ドファ）",difficulty:"基本",commonErrors:["長3度・減5度との混同"]},tritone:{name:"減5度",semitones:6,importance:.7,description:"不安定な音程（ドファ#）",difficulty:"高",commonErrors:["完全4度・完全5度との混同"]},perfectFifth:{name:"完全5度",semitones:7,importance:.9,description:"最も安定した音程（ドソ）",difficulty:"基本",commonErrors:["減5度・長6度との混同"]},minorSixth:{name:"短6度",semitones:8,importance:.8,description:"短調的色彩（ドラ♭）",difficulty:"中",commonErrors:["長6度・完全5度との混同"]},majorSixth:{name:"長6度",semitones:9,importance:.8,description:"明るい響き（ドラ）",difficulty:"中",commonErrors:["短6度・短7度との混同"]},minorSeventh:{name:"短7度",semitones:10,importance:.7,description:"属7和音の7度（ドシ♭）",difficulty:"中",commonErrors:["長7度・長6度との混同"]},majorSeventh:{name:"長7度",semitones:11,importance:.7,description:"鋭い不協和音程（ドシ）",difficulty:"高",commonErrors:["短7度・8度との混同"]},octave:{name:"8度",semitones:12,importance:.9,description:"1オクターブ上（ドド）",difficulty:"基本",commonErrors:["HarmonicCorrectionによる倍音誤検出"]}},this.masteryData=new Map,this.analysisHistory=[],this.maxHistoryLength=100,this.debugMode=!0,this.initializeMasteryData(),this.log("🎵 IntervalAnalyzer初期化完了",{intervalCount:Object.keys(this.intervalTypes).length,masteryData:this.masteryData.size})}analyzeInterval(e,t,s){try{const n=this.calculateSemitones(e,t),r=this.identifyInterval(n),i=this.calculateSemitones(e,s),a=this.identifyInterval(i),o=this.calculateIntervalAccuracy(n,i);this.updateMastery(r.key,o);const c=this.getMastery(r.key),l={targetInterval:r,detectedInterval:a,targetSemitones:n,detectedSemitones:i,accuracy:o,mastery:c,masteryLevels:Object.fromEntries(this.masteryData),isCorrectInterval:r.key===a.key,feedback:this.generateIntervalFeedback(r,a,o),timestamp:Date.now()};return this.recordAnalysis(l),this.debugMode&&this.logAnalysisDetails(l),l}catch(n){return console.error("❌ [IntervalAnalyzer] 分析エラー:",n),this.createErrorResult(e,t,s)}}calculateSemitones(e,t){return!e||!t||e<=0||t<=0?0:(12*Math.log2(t/e)%12+12)%12}identifyInterval(e){let t=null,s=1/0;for(const[n,r]of Object.entries(this.intervalTypes)){const i=Math.abs(e-r.semitones);i<s&&(s=i,t={key:n,...r,distance:i})}return t}calculateIntervalAccuracy(e,t){const s=Math.abs(e-t),n=Math.max(0,100-s*50);return Math.min(100,n)}updateMastery(e,t){this.masteryData.has(e)||this.masteryData.set(e,{attempts:0,totalAccuracy:0,averageAccuracy:0,bestAccuracy:0,recentAttempts:[],lastAttempt:null,trend:"stable"});const s=this.masteryData.get(e);s.attempts++,s.totalAccuracy+=t,s.averageAccuracy=s.totalAccuracy/s.attempts,s.bestAccuracy=Math.max(s.bestAccuracy,t),s.lastAttempt=Date.now(),s.recentAttempts.push(t),s.recentAttempts.length>10&&s.recentAttempts.shift(),s.trend=this.calculateTrend(s.recentAttempts),this.masteryData.set(e,s)}getMastery(e){const t=this.masteryData.get(e);if(!t)return{attempts:0,averageAccuracy:0,bestAccuracy:0,level:"beginner",progress:0};const s=this.determineMasteryLevel(t.averageAccuracy,t.attempts),n=Math.min(100,t.averageAccuracy*t.attempts/500);return{...t,level:s,progress:Math.round(n)}}determineMasteryLevel(e,t){return t<3?"beginner":e>=90&&t>=10?"master":e>=80&&t>=7?"advanced":e>=70&&t>=5?"intermediate":e>=50?"novice":"beginner"}calculateTrend(e){if(e.length<3)return"stable";const t=e.slice(-3),s=e.slice(-6,-3);if(s.length===0)return"stable";const n=t.reduce((a,o)=>a+o,0)/t.length,r=s.reduce((a,o)=>a+o,0)/s.length,i=n-r;return i>5?"improving":i<-5?"declining":"stable"}generateIntervalFeedback(e,t,s){const n=e.key===t.key;if(n&&s>=90)return`🎯 ${e.name}を完璧に認識しました！`;if(n&&s>=70)return`✅ ${e.name}の認識は正しいです。精度を上げてみましょう。`;if(n)return`👍 ${e.name}を認識できています。もう少し正確に。`;const r=this.analyzeIntervalError(e,t);return`❌ ${e.name}ではなく${t.name}と認識されました。${r}`}analyzeIntervalError(e,t){const s=t.semitones-e.semitones;return Math.abs(s)===1?s>0?"少し高めに歌っています。":"少し低めに歌っています。":Math.abs(s)<=2?"音程幅の調整が必要です。":Math.abs(s)>=6?"オクターブ関係の可能性があります。":"音程の特徴を意識してみてください。"}getAllMasteryData(){const e={};for(const[t,s]of Object.entries(this.intervalTypes))e[t]={interval:s,mastery:this.getMastery(t)};return e}getWeakIntervals(e=3){return Object.entries(this.getAllMasteryData()).filter(([s,n])=>n.mastery.attempts>=2).sort((s,n)=>s[1].mastery.averageAccuracy-n[1].mastery.averageAccuracy).slice(0,e).map(([s,n])=>({key:s,name:n.interval.name,accuracy:n.mastery.averageAccuracy,attempts:n.mastery.attempts,improvement:this.generateImprovementTip(s,n)}))}getStrongIntervals(e=3){return Object.entries(this.getAllMasteryData()).filter(([s,n])=>n.mastery.attempts>=3).sort((s,n)=>n[1].mastery.averageAccuracy-s[1].mastery.averageAccuracy).slice(0,e).map(([s,n])=>({key:s,name:n.interval.name,accuracy:n.mastery.averageAccuracy,attempts:n.mastery.attempts,reason:this.generateStrengthReason(s,n)}))}generateImprovementTip(e,t){const s=t.interval;return t.mastery.trend==="improving"?`📈 改善中です！${s.description}の特徴を意識して練習を続けましょう。`:s.commonErrors.length>0?`💡 ${s.commonErrors[0]}に注意してください。`:`🎯 ${s.description}を意識して、ゆっくりと練習してみましょう。`}generateStrengthReason(e,t){const s=t.interval,n=t.mastery;return n.averageAccuracy>=95?`完璧な精度で${s.name}を認識できています！`:n.trend==="improving"?`${s.name}の理解が急速に向上しています。`:`${s.name}の認識が安定しています。`}initializeMasteryData(){}recordAnalysis(e){this.analysisHistory.push(e),this.analysisHistory.length>this.maxHistoryLength&&this.analysisHistory.shift()}createErrorResult(e,t,s){return{targetInterval:{name:"不明",key:"unknown"},detectedInterval:{name:"不明",key:"unknown"},accuracy:0,mastery:{level:"beginner",progress:0},masteryLevels:Object.fromEntries(this.masteryData),isCorrectInterval:!1,feedback:"音程分析でエラーが発生しました。",error:!0}}logAnalysisDetails(e){var t;console.group(`🎵 [IntervalAnalyzer] ${e.targetInterval.name}分析結果`),console.log("🎯 音程分析:",{目標:`${e.targetInterval.name} (${e.targetSemitones.toFixed(1)}セミトーン)`,検出:`${e.detectedInterval.name} (${e.detectedSemitones.toFixed(1)}セミトーン)`,正解:e.isCorrectInterval?"✅":"❌",精度:`${e.accuracy.toFixed(1)}%`}),console.log("📊 習得状況:",{レベル:e.mastery.level,試行回数:e.mastery.attempts,平均精度:`${((t=e.mastery.averageAccuracy)==null?void 0:t.toFixed(1))||0}%`,進捗:`${e.mastery.progress}%`,トレンド:e.mastery.trend}),console.log("💬 フィードバック:",e.feedback),console.groupEnd()}log(e,t=null){this.debugMode&&(t?console.log(`[IntervalAnalyzer] ${e}`,t):console.log(`[IntervalAnalyzer] ${e}`))}getStatistics(){return{totalAnalyses:this.analysisHistory.length,intervalTypes:Object.keys(this.intervalTypes).length,masteryLevels:Object.fromEntries(this.masteryData),sessionStartTime:this.sessionStartTime||Date.now()}}reset(){this.masteryData.clear(),this.analysisHistory=[],this.initializeMasteryData(),this.log("🔄 IntervalAnalyzer リセット完了")}}typeof window<"u"&&(window.IntervalAnalyzer=b);class M{constructor(){this.directions={ascending:{name:"上行",icon:"↗️",description:"基音より高い音程",color:"#10b981",commonErrors:["オクターブ下認識（倍音効果）","音程幅の過小評価","目標音程の手前で停止"]},descending:{name:"下行",icon:"↘️",description:"基音より低い音程",color:"#3b82f6",commonErrors:["オクターブ上認識（倍音効果）","音程幅の過大評価","目標音程を通り越す"]},unison:{name:"同音",icon:"➡️",description:"基音と同じ高さ",color:"#6b7280",commonErrors:["微細なピッチずれ","倍音による誤認識"]}},this.directionMastery=new Map,this.analysisHistory=[],this.maxHistoryLength=50,this.debugMode=!0,this.thresholds={unison:.5,overshoot:1.5,significant:3},this.initializeDirectionMastery(),this.log("🧭 DirectionAnalyzer初期化完了",{directions:Object.keys(this.directions).length,thresholds:this.thresholds})}analyzeDirection(e,t,s){try{const n=this.determineDirection(e,t),r=this.calculateSemitones(e,t),i=this.determineDirection(e,s),a=this.calculateSemitones(e,s),o=n.key===i.key,c=this.analyzeOvershoot(r,a),l=this.calculateDirectionAccuracy(n.key,i.key,r,a);this.updateDirectionMastery(n.key,l,o);const m=this.getDirectionMastery(n.key),h={targetDirection:n,detectedDirection:i,targetSemitones:r,detectedSemitones:a,directionCorrect:o,accuracy:l,mastery:m,overshoot:c,feedback:this.generateDirectionFeedback(n,i,c,l),timestamp:Date.now()};return this.recordAnalysis(h),this.debugMode&&this.logAnalysisDetails(h),h}catch(n){return console.error("❌ [DirectionAnalyzer] 分析エラー:",n),this.createErrorResult(e,t,s)}}determineDirection(e,t){const s=this.calculateSemitones(e,t);return Math.abs(s)<=this.thresholds.unison?{key:"unison",...this.directions.unison}:s>0?{key:"ascending",...this.directions.ascending}:{key:"descending",...this.directions.descending}}calculateSemitones(e,t){return!e||!t||e<=0||t<=0?0:12*Math.log2(t/e)}analyzeOvershoot(e,t){const s=t-e,n=Math.abs(s);let r="accurate",i="none";return n>=this.thresholds.overshoot&&(s>0?r="overshoot":r="undershoot",n>=this.thresholds.significant?i="severe":i="moderate"),{type:r,severity:i,difference:s,absDifference:n,percentage:n/Math.abs(e)*100}}calculateDirectionAccuracy(e,t,s,n){if(e!==t)return Math.max(0,30-Math.abs(n-s)*5);const r=Math.abs(n-s),i=Math.max(0,100-r*25);return Math.min(100,i)}updateDirectionMastery(e,t,s){this.directionMastery.has(e)||this.directionMastery.set(e,{attempts:0,correctAttempts:0,totalAccuracy:0,averageAccuracy:0,bestAccuracy:0,successRate:0,recentAttempts:[],recentCorrects:[],lastAttempt:null,trend:"stable"});const n=this.directionMastery.get(e);n.attempts++,s&&n.correctAttempts++,n.totalAccuracy+=t,n.averageAccuracy=n.totalAccuracy/n.attempts,n.bestAccuracy=Math.max(n.bestAccuracy,t),n.successRate=n.correctAttempts/n.attempts*100,n.lastAttempt=Date.now(),n.recentAttempts.push(t),n.recentCorrects.push(s),n.recentAttempts.length>10&&(n.recentAttempts.shift(),n.recentCorrects.shift()),n.trend=this.calculateDirectionTrend(n.recentCorrects),this.directionMastery.set(e,n)}getDirectionMastery(e){const t=this.directionMastery.get(e);if(!t)return{attempts:0,successRate:0,averageAccuracy:0,level:"beginner",progress:0};const s=this.determineDirectionLevel(t.successRate,t.attempts),n=Math.min(100,t.successRate*t.attempts/500);return{...t,level:s,progress:Math.round(n)}}determineDirectionLevel(e,t){return t<3?"beginner":e>=95&&t>=10?"master":e>=85&&t>=7?"advanced":e>=75&&t>=5?"intermediate":e>=60?"novice":"beginner"}calculateDirectionTrend(e){if(e.length<5)return"stable";const t=e.slice(-3),s=e.slice(-6,-3);if(s.length===0)return"stable";const n=t.filter(Boolean).length/t.length,r=s.filter(Boolean).length/s.length,i=n-r;return i>.2?"improving":i<-.2?"declining":"stable"}generateDirectionFeedback(e,t,s,n){const r=e.key===t.key;return r&&n>=90?`🎯 ${e.name}の方向性が完璧です！`:r&&n>=70?`✅ ${e.name}の方向は正しいです。距離の調整をしてみましょう。`:r?s.type==="overshoot"?`👍 ${e.name}の方向は正しいですが、少し歌いすぎです。`:s.type==="undershoot"?`👍 ${e.name}の方向は正しいですが、もう少し大きく歌ってみてください。`:`👍 ${e.name}の方向は認識できています。`:e.key==="ascending"&&t.key==="descending"?"❌ 上行のつもりが下行になっています。基音より高く歌ってください。":e.key==="descending"&&t.key==="ascending"?"❌ 下行のつもりが上行になっています。基音より低く歌ってください。":e.key!=="unison"&&t.key==="unison"?`❌ 音程変化が小さすぎます。${e.name}により大きく歌ってください。`:`❌ ${e.name}ではなく${t.name}と認識されました。`}getAllDirectionMastery(){const e={};for(const[t,s]of Object.entries(this.directions))e[t]={direction:s,mastery:this.getDirectionMastery(t)};return e}getDirectionComparison(){const e=this.getDirectionMastery("ascending"),t=this.getDirectionMastery("descending");return{ascending:e,descending:t,comparison:{betterDirection:e.successRate>t.successRate?"ascending":"descending",difference:Math.abs(e.successRate-t.successRate),recommendation:this.generateDirectionRecommendation(e,t)}}}generateDirectionRecommendation(e,t){const s=e.successRate-t.successRate;return Math.abs(s)<10?"上行・下行ともにバランス良く習得できています。":s>10?"下行の練習を重点的に行うことをお勧めします。下向きの音程により意識を向けてみてください。":"上行の練習を重点的に行うことをお勧めします。上向きの音程により意識を向けてみてください。"}initializeDirectionMastery(){for(const e of Object.keys(this.directions))this.directionMastery.has(e)||this.directionMastery.set(e,{attempts:0,correctAttempts:0,totalAccuracy:0,averageAccuracy:0,bestAccuracy:0,successRate:0,recentAttempts:[],recentCorrects:[],lastAttempt:null,trend:"stable"})}recordAnalysis(e){this.analysisHistory.push(e),this.analysisHistory.length>this.maxHistoryLength&&this.analysisHistory.shift()}createErrorResult(e,t,s){return{targetDirection:{name:"不明",key:"unknown"},detectedDirection:{name:"不明",key:"unknown"},directionCorrect:!1,accuracy:0,mastery:{level:"beginner",progress:0},overshoot:{type:"unknown",severity:"none"},feedback:"方向性分析でエラーが発生しました。",error:!0}}logAnalysisDetails(e){var t;console.group(`🧭 [DirectionAnalyzer] ${e.targetDirection.name}分析結果`),console.log("🎯 方向性分析:",{目標:`${e.targetDirection.name} (${e.targetSemitones.toFixed(1)}セミトーン)`,検出:`${e.detectedDirection.name} (${e.detectedSemitones.toFixed(1)}セミトーン)`,正解:e.directionCorrect?"✅":"❌",精度:`${e.accuracy.toFixed(1)}%`}),console.log("📊 オーバーシュート分析:",{タイプ:e.overshoot.type,深刻度:e.overshoot.severity,差分:`${e.overshoot.difference.toFixed(1)}セミトーン`,誤差率:`${e.overshoot.percentage.toFixed(1)}%`}),console.log("📈 習得状況:",{レベル:e.mastery.level,成功率:`${((t=e.mastery.successRate)==null?void 0:t.toFixed(1))||0}%`,試行回数:e.mastery.attempts,トレンド:e.mastery.trend}),console.log("💬 フィードバック:",e.feedback),console.groupEnd()}log(e,t=null){this.debugMode&&(t?console.log(`[DirectionAnalyzer] ${e}`,t):console.log(`[DirectionAnalyzer] ${e}`))}getStatistics(){return{totalAnalyses:this.analysisHistory.length,directionTypes:Object.keys(this.directions).length,masteryData:Object.fromEntries(this.directionMastery),thresholds:this.thresholds}}reset(){this.directionMastery.clear(),this.analysisHistory=[],this.initializeDirectionMastery(),this.log("🔄 DirectionAnalyzer リセット完了")}}typeof window<"u"&&(window.DirectionAnalyzer=M);class S{constructor(e={}){this.config={windowSize:e.windowSize||5,maxHistory:e.maxHistory||100,stabilityThreshold:e.stabilityThreshold||25,trendWindowSize:e.trendWindowSize||10,fatigueDetectionWindow:e.fatigueDetectionWindow||15},this.consistencyData=new Map,this.stabilityHistory=[],this.sessionData={startTime:Date.now(),totalAttempts:0,overallConsistency:0,stabilityTrend:"stable",fatigueLevel:"fresh",concentrationLevel:"high"},this.debugMode=!0,this.log("📊 ConsistencyTracker初期化完了",{config:this.config,sessionStart:new Date(this.sessionData.startTime).toLocaleTimeString()})}recordAttempt(e,t,s,n){try{this.addAttemptData(e,t,s,n);const r=this.calculateIntervalConsistency(e);this.updateOverallConsistency();const i=this.analyzeStabilityTrend(),a=this.analyzeFatigue(),o={intervalType:e,intervalConsistency:r,overallConsistency:this.sessionData.overallConsistency,stabilityTrend:i,fatigueAnalysis:a,recommendations:this.generateConsistencyRecommendations(r,a),timestamp:Date.now()};return this.updateSessionData(o),this.debugMode&&this.logConsistencyDetails(o),o}catch(r){return console.error("❌ [ConsistencyTracker] 記録エラー:",r),this.createErrorResult(e)}}addAttemptData(e,t,s,n){this.consistencyData.has(e)||this.consistencyData.set(e,{attempts:[],statistics:{count:0,mean:0,standardDeviation:0,variance:0,range:0,consistencyScore:0},trend:"stable",lastUpdated:Date.now()});const r=this.consistencyData.get(e),i={centsDiff:t,accuracy:s,responseTime:n,timestamp:Date.now()};r.attempts.push(i),r.attempts.length>this.config.maxHistory&&r.attempts.shift(),this.updateStatistics(e),this.stabilityHistory.push({intervalType:e,centsDiff:Math.abs(t),accuracy:s,timestamp:Date.now()}),this.stabilityHistory.length>this.config.maxHistory&&this.stabilityHistory.shift(),this.sessionData.totalAttempts++}updateStatistics(e){const t=this.consistencyData.get(e),s=t.attempts;if(s.length===0)return;const n=s.map(m=>Math.abs(m.centsDiff)),r=n.length,i=n.reduce((m,h)=>m+h,0)/r,a=n.reduce((m,h)=>m+Math.pow(h-i,2),0)/r,o=Math.sqrt(a),c=Math.max(...n)-Math.min(...n),l=Math.max(0,100-o*2);t.statistics={count:r,mean:Math.round(i*10)/10,standardDeviation:Math.round(o*10)/10,variance:Math.round(a*10)/10,range:Math.round(c*10)/10,consistencyScore:Math.round(l*10)/10},t.trend=this.calculateIntervalTrend(s),t.lastUpdated=Date.now()}calculateIntervalConsistency(e){const t=this.consistencyData.get(e);if(!t||t.attempts.length<2)return{level:"insufficient_data",score:0,description:"データ不足",attempts:(t==null?void 0:t.attempts.length)||0};const s=t.statistics,n=this.determineConsistencyLevel(s.consistencyScore);return{intervalType:e,level:n,score:s.consistencyScore,statistics:s,trend:t.trend,description:this.getConsistencyDescription(n),attempts:s.count,recommendation:this.getIntervalRecommendation(e,s,t.trend)}}determineConsistencyLevel(e){return e>=90?"excellent":e>=75?"good":e>=60?"fair":e>=40?"poor":"very_poor"}getConsistencyDescription(e){return{excellent:"非常に安定した精度で認識できています",good:"安定した認識ができています",fair:"やや不安定ですが、改善の余地があります",poor:"不安定な認識です。練習を重ねましょう",very_poor:"非常に不安定です。基礎練習から始めましょう",insufficient_data:"データが不足しています"}[e]||"評価不能"}updateOverallConsistency(){if(this.stabilityHistory.length<5){this.sessionData.overallConsistency=0;return}const t=this.stabilityHistory.slice(-this.config.trendWindowSize).map(r=>r.centsDiff),s=t.reduce((r,i)=>r+i,0)/t.length,n=Math.sqrt(t.reduce((r,i)=>r+Math.pow(i-s,2),0)/t.length);this.sessionData.overallConsistency=Math.max(0,100-n*2)}analyzeStabilityTrend(){if(this.stabilityHistory.length<this.config.trendWindowSize)return{trend:"insufficient_data",direction:"stable",confidence:0,description:"データ不足"};const e=this.stabilityHistory.slice(-this.config.trendWindowSize),t=Math.floor(this.config.trendWindowSize/2),s=e.slice(0,t),n=e.slice(-t),r=s.reduce((h,d)=>h+d.centsDiff,0)/s.length,i=n.reduce((h,d)=>h+d.centsDiff,0)/n.length,a=r-i,o=a/r*100;let c,l,m;return Math.abs(o)<10?(c="stable",l="stable",m=.7):a>0?(c="improving",l="better",m=Math.min(.9,Math.abs(o)/20)):(c="declining",l="worse",m=Math.min(.9,Math.abs(o)/20)),this.sessionData.stabilityTrend=c,{trend:c,direction:l,confidence:Math.round(m*100)/100,improvement:Math.round(a*10)/10,improvementPercent:Math.round(o*10)/10,description:this.getTrendDescription(c,l)}}analyzeFatigue(){if(this.stabilityHistory.length<this.config.fatigueDetectionWindow)return{fatigueLevel:"unknown",concentrationLevel:"unknown",recommendation:"データ不足のため判定できません"};const e=this.stabilityHistory.slice(-this.config.fatigueDetectionWindow),s=(Date.now()-this.sessionData.startTime)/(1e3*60);let n="fresh";s>30&&(n="moderate"),s>60&&(n="tired"),s>90&&(n="exhausted");const r=e.map(d=>d.accuracy),i=r.reduce((d,u)=>d+u,0)/r.length,a=this.stabilityHistory.map(d=>d.accuracy),c=a.reduce((d,u)=>d+u,0)/a.length-i;let l="fresh";c>5&&(l="moderate"),c>10&&(l="tired"),c>20&&(l="exhausted");const m=this.combineFatigueFactors(n,l),h=this.evaluateConcentration(e);return this.sessionData.fatigueLevel=m,this.sessionData.concentrationLevel=h,{fatigueLevel:m,concentrationLevel:h,sessionMinutes:Math.round(s),accuracyDrop:Math.round(c*10)/10,recommendation:this.getFatigueRecommendation(m,h)}}combineFatigueFactors(e,t){const s=["fresh","moderate","tired","exhausted"],n=s.indexOf(e),r=s.indexOf(t),i=Math.max(n,r);return s[i]}evaluateConcentration(e){const t=e.map(n=>n.centsDiff),s=Math.sqrt(t.reduce((n,r)=>n+Math.pow(r-t.reduce((i,a)=>i+a,0)/t.length,2),0)/t.length);return s<=15?"high":s<=25?"medium":s<=40?"low":"very_low"}generateConsistencyRecommendations(e,t){const s=[];return(t.fatigueLevel==="tired"||t.fatigueLevel==="exhausted")&&s.push({type:"rest",priority:"high",message:"疲労が見られます。10-15分の休憩をお勧めします。",icon:"😴"}),(t.concentrationLevel==="low"||t.concentrationLevel==="very_low")&&s.push({type:"focus",priority:"medium",message:"集中力が低下しています。深呼吸をして、ゆっくりと練習してみてください。",icon:"🧘"}),(e.level==="poor"||e.level==="very_poor")&&s.push({type:"practice",priority:"medium",message:`${e.intervalType}の練習を重点的に行いましょう。ゆっくりと正確に歌うことを意識してください。`,icon:"🎯"}),e.trend==="improving"&&s.push({type:"encouragement",priority:"low",message:"改善が見られます！この調子で練習を続けてください。",icon:"📈"}),s}getIntervalRecommendation(e,t,s){return t.consistencyScore>=80?"安定した認識ができています。この精度を維持しましょう。":s==="improving"?"改善傾向にあります。継続して練習してください。":t.standardDeviation>30?"ばらつきが大きいです。ゆっくりと正確に歌うことを意識してください。":`${e}の特徴を意識して、一定の精度で歌えるよう練習しましょう。`}getTrendDescription(e,t){return{stable:"安定した精度を維持しています",improving:"精度が向上しています",declining:"精度が低下しています"}[e]||"傾向を分析中"}getFatigueRecommendation(e,t){return e==="exhausted"?"今日はここまでにして、十分な休息を取ることをお勧めします。":e==="tired"?"15-20分の休憩を取ってから練習を再開しましょう。":t==="very_low"?"集中力が低下しています。環境を整えて、短時間の集中練習を心がけましょう。":t==="low"?"深呼吸をして、一つ一つの音程に集中して練習してみてください。":"良い状態です。この調子で練習を続けてください。"}calculateIntervalTrend(e){if(e.length<6)return"stable";const t=e.slice(-3),s=e.slice(-6,-3),n=t.reduce((a,o)=>a+Math.abs(o.centsDiff),0)/t.length,i=s.reduce((a,o)=>a+Math.abs(o.centsDiff),0)/s.length-n;return i>5?"improving":i<-5?"declining":"stable"}updateSessionData(e){this.sessionData.overallConsistency=e.overallConsistency,this.sessionData.stabilityTrend=e.stabilityTrend.trend,this.sessionData.fatigueLevel=e.fatigueAnalysis.fatigueLevel,this.sessionData.concentrationLevel=e.fatigueAnalysis.concentrationLevel}createErrorResult(e){return{intervalType:e,intervalConsistency:{level:"error",score:0},overallConsistency:0,stabilityTrend:{trend:"error"},fatigueAnalysis:{fatigueLevel:"unknown"},recommendations:[],error:!0}}logConsistencyDetails(e){var t;console.group(`📊 [ConsistencyTracker] ${e.intervalType}一貫性分析`),console.log("🎯 音程一貫性:",{レベル:e.intervalConsistency.level,スコア:`${e.intervalConsistency.score}%`,標準偏差:`${((t=e.intervalConsistency.statistics)==null?void 0:t.standardDeviation)||0}セント`,試行回数:e.intervalConsistency.attempts}),console.log("📈 トレンド分析:",{全体傾向:e.stabilityTrend.trend,方向:e.stabilityTrend.direction,信頼度:`${(e.stabilityTrend.confidence*100).toFixed(0)}%`,改善度:`${e.stabilityTrend.improvement}セント`}),console.log("😴 疲労分析:",{疲労度:e.fatigueAnalysis.fatigueLevel,集中力:e.fatigueAnalysis.concentrationLevel,セッション時間:`${e.fatigueAnalysis.sessionMinutes}分`,精度低下:`${e.fatigueAnalysis.accuracyDrop}%`}),e.recommendations.length>0&&console.log("💡 推奨事項:",e.recommendations.map(s=>s.message)),console.groupEnd()}log(e,t=null){this.debugMode&&(t?console.log(`[ConsistencyTracker] ${e}`,t):console.log(`[ConsistencyTracker] ${e}`))}getAllConsistencyData(){const e={};for(const[t,s]of this.consistencyData.entries())e[t]={statistics:s.statistics,trend:s.trend,attempts:s.attempts.length,lastUpdated:s.lastUpdated};return{intervalData:e,sessionData:this.sessionData,overallStats:{totalAttempts:this.sessionData.totalAttempts,overallConsistency:this.sessionData.overallConsistency,sessionDuration:Date.now()-this.sessionData.startTime}}}getStatistics(){return{totalIntervalTypes:this.consistencyData.size,totalAttempts:this.sessionData.totalAttempts,sessionDuration:Date.now()-this.sessionData.startTime,overallConsistency:this.sessionData.overallConsistency,stabilityTrend:this.sessionData.stabilityTrend,fatigueLevel:this.sessionData.fatigueLevel}}reset(){this.consistencyData.clear(),this.stabilityHistory=[],this.sessionData={startTime:Date.now(),totalAttempts:0,overallConsistency:0,stabilityTrend:"stable",fatigueLevel:"fresh",concentrationLevel:"high"},this.log("🔄 ConsistencyTracker リセット完了")}}typeof window<"u"&&(window.ConsistencyTracker=S);class w{constructor(e={}){var t,s,n,r,i,a,o,c,l,m,h;this.config={weights:{pitchAccuracy:((t=e.weights)==null?void 0:t.pitchAccuracy)||.4,recognitionSpeed:((s=e.weights)==null?void 0:s.recognitionSpeed)||.2,intervalMastery:((n=e.weights)==null?void 0:n.intervalMastery)||.2,directionAccuracy:((r=e.weights)==null?void 0:r.directionAccuracy)||.1,consistency:((i=e.weights)==null?void 0:i.consistency)||.1},speedThresholds:{excellent:((a=e.speedThresholds)==null?void 0:a.excellent)||1e3,good:((o=e.speedThresholds)==null?void 0:o.good)||2e3,fair:((c=e.speedThresholds)==null?void 0:c.fair)||3e3,poor:((l=e.speedThresholds)==null?void 0:l.poor)||5e3},harmonicCorrection:{enabled:((m=e.harmonicCorrection)==null?void 0:m.enabled)??!0,tolerance:((h=e.harmonicCorrection)==null?void 0:h.tolerance)||50},sessionTracking:e.sessionTracking??!0,maxHistorySize:e.maxHistorySize||100},this.intervalAnalyzer=new b,this.directionAnalyzer=new M,this.consistencyTracker=new S,this.sessionData={startTime:Date.now(),totalAttempts:0,overallScore:0,performanceHistory:[],currentLevel:"beginner",achievements:new Set,lastAnalysis:null},this.performanceMetrics={averageSpeed:0,accuracyTrend:"stable",strengthAreas:[],improvementAreas:[],sessionProgress:0},this.debugMode=!0,this.log("🎯 EnhancedScoringEngine初期化完了",{weights:this.config.weights,analyzers:["IntervalAnalyzer","DirectionAnalyzer","ConsistencyTracker"]})}async analyzePerformance(e){try{const{baseFreq:t,targetFreq:s,detectedFreq:n,responseTime:r,volume:i=50,harmonicCorrection:a=null}=e,o=this.validateInputs(e);if(!o.valid)return this.createErrorResult(o.error);const c=this.applyHarmonicCorrection(n,a),l=await Promise.all([this.intervalAnalyzer.analyzeInterval(t,s,c),this.directionAnalyzer.analyzeDirection(t,s,c),this.consistencyTracker.recordAttempt(this.getIntervalType(t,s),this.calculateCentsDifference(s,c),this.calculateRawAccuracy(s,c),r)]),[m,h,d]=l,u=this.analyzeRecognitionSpeed(r),y=this.calculateIntegratedScore({intervalAnalysis:m,directionAnalysis:h,consistencyAnalysis:d,speedAnalysis:u,volume:i}),p=this.evaluateOverallPerformance(y),f=this.generateAdaptiveFeedback({intervalAnalysis:m,directionAnalysis:h,consistencyAnalysis:d,speedAnalysis:u,performanceEvaluation:p}),v=this.updateSessionData(y,p),g={timestamp:Date.now(),sessionAttempt:this.sessionData.totalAttempts,analyses:{interval:m,direction:h,consistency:d,speed:u},score:y,performance:p,feedback:f,session:v,metadata:{baseFreq:t,targetFreq:s,detectedFreq:n,correctedFreq:c,responseTime:r,volume:i,harmonicCorrectionApplied:!!a}};return this.recordAnalysisResult(g),this.debugMode&&this.logScoringDetails(g),g}catch(t){return console.error("❌ [EnhancedScoringEngine] 採点エラー:",t),this.createErrorResult("採点処理中にエラーが発生しました")}}validateInputs(e){const{baseFreq:t,targetFreq:s,detectedFreq:n,responseTime:r}=e;return!t||!s||!n?{valid:!1,error:"必要な周波数データが不足しています"}:t<=0||s<=0||n<=0?{valid:!1,error:"周波数は正の値である必要があります"}:r<0||r>3e4?{valid:!1,error:"反応時間が範囲外です"}:{valid:!0}}applyHarmonicCorrection(e,t){return!this.config.harmonicCorrection.enabled||!t?e:t.correctedFrequency&&Math.abs(t.correctedFrequency-e)<=this.config.harmonicCorrection.tolerance?(this.log("🔧 HarmonicCorrection適用",{original:e,corrected:t.correctedFrequency,correction:t.correction}),t.correctedFrequency):e}analyzeRecognitionSpeed(e){const{speedThresholds:t}=this.config;let s,n,r;return e<=t.excellent?(s="excellent",n=100,r="⚡ 素早い認識です！"):e<=t.good?(s="good",n=85,r="👍 良い反応速度です。"):e<=t.fair?(s="fair",n=70,r="📈 もう少し早く認識できると良いでしょう。"):e<=t.poor?(s="poor",n=50,r="🐌 ゆっくりと確実に認識しましょう。"):(s="very_poor",n=25,r="⏰ 時間をかけすぎています。練習を重ねましょう。"),{level:s,score:n,responseTime:e,feedback:r,comparison:this.compareToAverageSpeed(e)}}calculateIntegratedScore(e){const{weights:t}=this.config,{intervalAnalysis:s,directionAnalysis:n,consistencyAnalysis:r,speedAnalysis:i,volume:a}=e,o=s.accuracy||0,c=i.score||0,l=this.calculateMasteryScore(s.mastery),m=n.accuracy||0,h=r.overallConsistency||0,d=o*t.pitchAccuracy+c*t.recognitionSpeed+l*t.intervalMastery+m*t.directionAccuracy+h*t.consistency,u=this.calculateVolumeAdjustment(a),y=Math.min(100,d*u);return{total:Math.round(y*10)/10,components:{pitchAccuracy:Math.round(o*10)/10,recognitionSpeed:Math.round(c*10)/10,intervalMastery:Math.round(l*10)/10,directionAccuracy:Math.round(m*10)/10,consistency:Math.round(h*10)/10},weights:t,volumeAdjustment:Math.round(u*100)/100,grade:this.determineGrade(y)}}calculateMasteryScore(e){if(!e||e.attempts===0)return 0;const t=e.averageAccuracy||0,s=Math.min(20,e.attempts*2),n=e.trend==="improving"?10:0;return Math.min(100,t+s+n)}calculateVolumeAdjustment(e){return e<20?.8:e>80?.95:1}determineGrade(e){return e>=95?"S":e>=90?"A+":e>=85?"A":e>=80?"B+":e>=75?"B":e>=70?"C+":e>=65?"C":e>=60?"D+":e>=55?"D":"F"}evaluateOverallPerformance(e){const t=this.determinePerformanceLevel(e.total),s=this.identifyStrengths(e.components),n=this.identifyWeaknesses(e.components),r=this.calculateImprovement();return{level:t,score:e.total,grade:e.grade,strengths:s,weaknesses:n,improvement:r,recommendation:this.generatePerformanceRecommendation(t,s,n)}}determinePerformanceLevel(e){return e>=90?"excellent":e>=80?"good":e>=70?"average":e>=60?"below_average":"needs_improvement"}identifyStrengths(e){const t=[];return Object.entries(e).forEach(([s,n])=>{n>=85?t.push({area:s,score:n,level:"excellent"}):n>=75&&t.push({area:s,score:n,level:"good"})}),t.sort((s,n)=>n.score-s.score)}identifyWeaknesses(e){const t=[];return Object.entries(e).forEach(([s,n])=>{n<60&&t.push({area:s,score:n,severity:n<40?"high":"medium"})}),t.sort((s,n)=>s.score-n.score)}calculateImprovement(){const e=this.sessionData.performanceHistory;if(e.length<3)return{trend:"insufficient_data",change:0,description:"データ不足"};const t=e.slice(-3),s=e.slice(-6,-3);if(s.length===0)return{trend:"stable",change:0,description:"安定"};const n=t.reduce((c,l)=>c+l,0)/t.length,r=s.reduce((c,l)=>c+l,0)/s.length,i=n-r;let a,o;return i>5?(a="improving",o="向上中"):i<-5?(a="declining",o="低下中"):(a="stable",o="安定"),{trend:a,change:Math.round(i*10)/10,description:o}}generateAdaptiveFeedback(e){const{intervalAnalysis:t,directionAnalysis:s,consistencyAnalysis:n,speedAnalysis:r,performanceEvaluation:i}=e;return{primary:this.getPrimaryFeedback(i),detailed:{interval:t.feedback||"音程分析結果なし",direction:s.feedback||"方向性分析結果なし",consistency:this.getConsistencyFeedback(n),speed:r.feedback||"速度分析結果なし"},recommendations:this.generateRecommendations(e),encouragement:this.generateEncouragement(i),nextSteps:this.suggestNextSteps(i)}}getPrimaryFeedback(e){const{level:t,grade:s,score:n}=e;return{excellent:`🎯 素晴らしい！${s}評価（${n}点）です。`,good:`👍 良い結果です！${s}評価（${n}点）。`,average:`📈 平均的な結果です。${s}評価（${n}点）。`,below_average:`💪 練習を続けましょう。${s}評価（${n}点）。`,needs_improvement:`🎓 基礎から練習していきましょう。${s}評価（${n}点）。`}[t]||`結果: ${s}評価（${n}点）`}getConsistencyFeedback(e){if(e.recommendations&&e.recommendations.length>0)return e.recommendations[0].message;const t=e.overallConsistency||0;return t>=80?"🎯 一貫した精度を保っています。":t>=60?"📊 まずまずの安定性です。":"📈 一貫性の改善が必要です。"}generateRecommendations(e){const t=[];e.consistencyAnalysis.recommendations&&t.push(...e.consistencyAnalysis.recommendations);const{performanceEvaluation:s}=e;if(s.weaknesses.length>0){const n=s.weaknesses[0];t.push({type:"improvement",priority:"high",message:this.getImprovementSuggestion(n.area),icon:"🎯"})}return t}getImprovementSuggestion(e){return{pitchAccuracy:"音程の精度向上のため、ゆっくりと正確に歌う練習をしましょう。",recognitionSpeed:"反応速度向上のため、聞いた瞬間に歌う練習をしましょう。",intervalMastery:"苦手な音程を重点的に練習しましょう。",directionAccuracy:"上行・下行の方向性を意識して練習しましょう。",consistency:"一定の精度を保つため、集中力を高めて練習しましょう。"}[e]||"継続的な練習で改善していきましょう。"}generateEncouragement(e){if(e.improvement.trend==="improving")return"📈 確実に上達しています！この調子で続けましょう。";if(e.strengths.length>0){const t=e.strengths[0];return`⭐ ${this.getAreaName(t.area)}が得意ですね！`}return"🌟 練習を続けることで必ず上達します。頑張りましょう！"}suggestNextSteps(e){if(e.level==="excellent")return"🎓 上級レベルに到達しています。より複雑な音程に挑戦してみましょう。";if(e.weaknesses.length>0){const t=e.weaknesses[0];return`🎯 ${this.getAreaName(t.area)}の練習に重点を置きましょう。`}return"📚 基礎練習を継続し、全体的なレベルアップを目指しましょう。"}getAreaName(e){return{pitchAccuracy:"音程精度",recognitionSpeed:"認識速度",intervalMastery:"音程習得度",directionAccuracy:"方向性認識",consistency:"一貫性"}[e]||e}updateSessionData(e,t){return this.sessionData.totalAttempts++,this.sessionData.performanceHistory.push(e.total),this.sessionData.overallScore=this.calculateSessionAverage(),this.sessionData.currentLevel=t.level,this.sessionData.lastAnalysis=Date.now(),this.sessionData.performanceHistory.length>this.config.maxHistorySize&&this.sessionData.performanceHistory.shift(),this.updatePerformanceMetrics(e,t),this.checkAchievements(e,t),{attempt:this.sessionData.totalAttempts,sessionAverage:this.sessionData.overallScore,sessionDuration:Date.now()-this.sessionData.startTime,level:this.sessionData.currentLevel,newAchievements:Array.from(this.sessionData.achievements)}}calculateSessionAverage(){const e=this.sessionData.performanceHistory;return e.length===0?0:e.reduce((t,s)=>t+s,0)/e.length}updatePerformanceMetrics(e,t){e.components.recognitionSpeed>0&&(this.performanceMetrics.averageSpeed=(this.performanceMetrics.averageSpeed+e.components.recognitionSpeed)/2),this.performanceMetrics.accuracyTrend=t.improvement.trend,this.performanceMetrics.strengthAreas=t.strengths.map(s=>s.area),this.performanceMetrics.improvementAreas=t.weaknesses.map(s=>s.area),this.performanceMetrics.sessionProgress=Math.min(100,this.sessionData.totalAttempts/20*100)}checkAchievements(e,t){this.sessionData.totalAttempts===1&&this.sessionData.achievements.add("first_attempt"),e.total>=90&&!this.sessionData.achievements.has("high_score")&&this.sessionData.achievements.add("high_score"),e.total>=98&&!this.sessionData.achievements.has("perfect_score")&&this.sessionData.achievements.add("perfect_score"),this.sessionData.totalAttempts>=10&&!this.sessionData.achievements.has("persistent")&&this.sessionData.achievements.add("persistent"),t.improvement.trend==="improving"&&!this.sessionData.achievements.has("improving")&&this.sessionData.achievements.add("improving")}compareToAverageSpeed(e){const t=this.performanceMetrics.averageSpeed||2e3,s=e-t;return{sessionAverage:t,difference:s,comparison:s<-500?"much_faster":s<-200?"faster":s<200?"similar":s<500?"slower":"much_slower"}}getIntervalType(e,t){const n=(Math.round(12*Math.log2(t/e))%12+12)%12;return{0:"unison",1:"minorSecond",2:"majorSecond",3:"minorThird",4:"majorThird",5:"perfectFourth",6:"tritone",7:"perfectFifth",8:"minorSixth",9:"majorSixth",10:"minorSeventh",11:"majorSeventh"}[n]||"unknown"}calculateCentsDifference(e,t){return!e||!t?0:1200*Math.log2(t/e)}calculateRawAccuracy(e,t){const s=Math.abs(this.calculateCentsDifference(e,t));return Math.max(0,100-s)}recordAnalysisResult(e){this.sessionData.lastAnalysis=e}createErrorResult(e){return{timestamp:Date.now(),error:!0,message:e,score:{total:0,components:{pitchAccuracy:0,recognitionSpeed:0,intervalMastery:0,directionAccuracy:0,consistency:0},grade:"F"},performance:{level:"needs_improvement",strengths:[],weaknesses:[],improvement:{trend:"unknown",change:0}},feedback:{primary:"エラーが発生しました。もう一度お試しください。",detailed:{},recommendations:[],encouragement:"",nextSteps:""}}}logScoringDetails(e){console.group(`🎯 [EnhancedScoringEngine] 統合採点結果 #${e.sessionAttempt}`),console.log("📊 統合スコア:",{総合:`${e.score.total}点 (${e.score.grade})`,音程精度:`${e.score.components.pitchAccuracy}%`,認識速度:`${e.score.components.recognitionSpeed}%`,音程習得度:`${e.score.components.intervalMastery}%`,方向性精度:`${e.score.components.directionAccuracy}%`,一貫性:`${e.score.components.consistency}%`}),console.log("📈 パフォーマンス:",{レベル:e.performance.level,改善傾向:e.performance.improvement.trend,強み:e.performance.strengths.map(t=>t.area),弱点:e.performance.weaknesses.map(t=>t.area)}),console.log("💬 フィードバック:",{メイン:e.feedback.primary,推奨事項:e.feedback.recommendations.length}),console.log("📚 セッション:",{試行回数:e.session.attempt,平均点:e.session.sessionAverage.toFixed(1),継続時間:`${Math.round(e.session.sessionDuration/6e4)}分`}),console.groupEnd()}log(e,t=null){this.debugMode&&(t?console.log(`[EnhancedScoringEngine] ${e}`,t):console.log(`[EnhancedScoringEngine] ${e}`))}async processAttempt(e){return await this.analyzePerformance(e)}generateDetailedReport(){var m,h,d,u,y,p,f,v;const e=this.getStatistics(),t=this.sessionData,s={totalScore:t.overallScore,totalAttempts:t.totalAttempts,averageScore:t.totalAttempts>0?t.overallScore/t.totalAttempts:0,sessionDuration:Date.now()-t.startTime,level:t.currentLevel},n={intervals:e.analyzers.interval,directions:e.analyzers.direction,consistency:e.analyzers.consistency},r=this.generateImprovementSuggestions(),i={startTime:t.startTime,duration:Date.now()-t.startTime,attempts:t.totalAttempts,achievements:Array.from(t.achievements),performanceHistory:t.performanceHistory.slice(-10)},a={primary:r.length>0?r[0].message:"良好な演奏です！",detailed:r.map(g=>g.message),suggestions:r.map(g=>g.actions).flat()},o=[{label:"音程精度",value:Math.round(((m=e.analyzers.interval)==null?void 0:m.averageAccuracy)||0),weight:40},{label:"認識速度",value:Math.round(100-(e.averageResponseTime||5e3)/50),weight:20},{label:"音程習得",value:Math.round(((h=e.analyzers.interval)==null?void 0:h.masteryLevel)||0),weight:20},{label:"方向精度",value:Math.round(((d=e.analyzers.direction)==null?void 0:d.accuracy)||0),weight:10},{label:"一貫性",value:Math.round(((u=e.analyzers.consistency)==null?void 0:u.score)||0),weight:10}],c=o.reduce((g,D)=>g+D.value*D.weight/100,0);let l="C";return c>=90?l="S":c>=80?l="A":c>=70&&(l="B"),{timestamp:Date.now(),totalScore:Math.round(c),grade:l,componentScores:o,feedback:a,intervalAnalysis:{masteryLevels:((y=e.analyzers.interval)==null?void 0:y.intervalMastery)||{},attemptCounts:((p=e.analyzers.interval)==null?void 0:p.attemptCounts)||{},accuracyRates:((f=e.analyzers.interval)==null?void 0:f.accuracyRates)||{}},consistencyHistory:((v=e.analyzers.consistency)==null?void 0:v.recentScores)||[],overall:s,detailed:n,improvements:r,session:i,metadata:{version:"2.2.1-FIXED",engine:"EnhancedScoringEngine"}}}generateImprovementSuggestions(){const e=[],t=this.getStatistics();return t.analyzers.interval.averageAccuracy<70&&e.push({category:"interval",priority:"high",message:"音程の正確性向上が必要です。基本的な音程（完全5度、オクターブ）から練習を始めましょう。",actions:["基本音程の集中練習","楽器での確認","歌唱練習"]}),t.analyzers.direction.accuracy<80&&e.push({category:"direction",priority:"medium",message:"音程の上行・下行の判断精度を向上させましょう。",actions:["音階練習","聴音練習","インターバル識別"]}),t.analyzers.consistency.score<75&&e.push({category:"consistency",priority:"medium",message:"安定した精度を保つため、継続的な練習が効果的です。",actions:["定期的な練習","集中力向上","疲労管理"]}),e}getStatistics(){return{session:this.sessionData,performance:this.performanceMetrics,analyzers:{interval:this.intervalAnalyzer.getStatistics(),direction:this.directionAnalyzer.getStatistics(),consistency:this.consistencyTracker.getStatistics()},config:this.config}}updateConfig(e){this.config={...this.config,...e},this.log("⚙️ 設定更新完了",this.config)}reset(){this.intervalAnalyzer.reset(),this.directionAnalyzer.reset(),this.consistencyTracker.reset(),this.sessionData={startTime:Date.now(),totalAttempts:0,overallScore:0,performanceHistory:[],currentLevel:"beginner",achievements:new Set,lastAnalysis:null},this.performanceMetrics={averageSpeed:0,accuracyTrend:"stable",strengthAreas:[],improvementAreas:[],sessionProgress:0},this.log("🔄 EnhancedScoringEngine リセット完了")}}typeof window<"u"&&(window.EnhancedScoringEngine=w);export{w as E};
