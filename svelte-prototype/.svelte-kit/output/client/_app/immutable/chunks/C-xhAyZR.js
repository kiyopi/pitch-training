var dt=Object.defineProperty;var mt=(i,e,t)=>e in i?dt(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var U=(i,e,t)=>mt(i,typeof e!="symbol"?e+"":e,t);import{S as He,i as Re,s as qe,d as ae,n as Ye,a as je,D as Ie,b as P,G as B,z as F,f as fe,g as M,h as z,j as E,k as H,m as O,o as N,p as $,F as ft,a0 as Ze,K as Oe,q as Le,r as We,u as Ge,e as Ce,w as Qe,l as Se,A as Pe,x as Ke,t as Fe,y as Ue}from"./CBDdZxR7.js";import{g as gt}from"./D0QH3NT1.js";import"./CmL6UHZb.js";import{C as et}from"./BhW-5LyT.js";function vt(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function G(i){if(this.size=i|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=i<<1;for(var e=new Array(this.size*2),t=0;t<e.length;t+=2){const l=Math.PI*t/this.size;e[t]=Math.cos(l),e[t+1]=-Math.sin(l)}this.table=e;for(var o=0,s=1;this.size>s;s<<=1)o++;this._width=o%2===0?o-1:o,this._bitrev=new Array(1<<this._width);for(var n=0;n<this._bitrev.length;n++){this._bitrev[n]=0;for(var r=0;r<this._width;r+=2){var u=this._width-r-2;this._bitrev[n]|=(n>>>r&3)<<u}}this._out=null,this._data=null,this._inv=0}var yt=G;G.prototype.fromComplexArray=function(e,t){for(var o=t||new Array(e.length>>>1),s=0;s<e.length;s+=2)o[s>>>1]=e[s];return o};G.prototype.createComplexArray=function(){const e=new Array(this._csize);for(var t=0;t<e.length;t++)e[t]=0;return e};G.prototype.toComplexArray=function(e,t){for(var o=t||this.createComplexArray(),s=0;s<o.length;s+=2)o[s]=e[s>>>1],o[s+1]=0;return o};G.prototype.completeSpectrum=function(e){for(var t=this._csize,o=t>>>1,s=2;s<o;s+=2)e[t-s]=e[s],e[t-s+1]=-e[s+1]};G.prototype.transform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=0,this._transform4(),this._out=null,this._data=null};G.prototype.realTransform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=0,this._realTransform4(),this._out=null,this._data=null};G.prototype.inverseTransform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=1,this._transform4();for(var o=0;o<e.length;o++)e[o]/=this.size;this._out=null,this._data=null};G.prototype._transform4=function(){var e=this._out,t=this._csize,o=this._width,s=1<<o,n=t/s<<1,r,u,l=this._bitrev;if(n===4)for(r=0,u=0;r<t;r+=n,u++){const v=l[u];this._singleTransform2(r,v,s)}else for(r=0,u=0;r<t;r+=n,u++){const v=l[u];this._singleTransform4(r,v,s)}var a=this._inv?-1:1,d=this.table;for(s>>=2;s>=2;s>>=2){n=t/s<<1;var g=n>>>2;for(r=0;r<t;r+=n)for(var m=r+g,w=r,h=0;w<m;w+=2,h+=s){const v=w,y=v+g,f=y+g,b=f+g,_=e[v],x=e[v+1],A=e[y],p=e[y+1],S=e[f],C=e[f+1],T=e[b],R=e[b+1],L=_,q=x,X=d[h],Q=a*d[h+1],V=A*X-p*Q,Z=A*Q+p*X,ee=d[2*h],te=a*d[2*h+1],se=S*ee-C*te,Y=S*te+C*ee,ne=d[3*h],ce=a*d[3*h+1],le=T*ne-R*ce,ue=T*ce+R*ne,oe=L+se,re=q+Y,he=L-se,c=q-Y,D=V+le,I=Z+ue,j=a*(V-le),k=a*(Z-ue),ie=oe+D,_e=re+I,ge=oe-D,pe=re-I,Me=he+k,de=c-j,ve=he-k,De=c+j;e[v]=ie,e[v+1]=_e,e[y]=Me,e[y+1]=de,e[f]=ge,e[f+1]=pe,e[b]=ve,e[b+1]=De}}};G.prototype._singleTransform2=function(e,t,o){const s=this._out,n=this._data,r=n[t],u=n[t+1],l=n[t+o],a=n[t+o+1],d=r+l,g=u+a,m=r-l,w=u-a;s[e]=d,s[e+1]=g,s[e+2]=m,s[e+3]=w};G.prototype._singleTransform4=function(e,t,o){const s=this._out,n=this._data,r=this._inv?-1:1,u=o*2,l=o*3,a=n[t],d=n[t+1],g=n[t+o],m=n[t+o+1],w=n[t+u],h=n[t+u+1],v=n[t+l],y=n[t+l+1],f=a+w,b=d+h,_=a-w,x=d-h,A=g+v,p=m+y,S=r*(g-v),C=r*(m-y),T=f+A,R=b+p,L=_+C,q=x-S,X=f-A,Q=b-p,V=_-C,Z=x+S;s[e]=T,s[e+1]=R,s[e+2]=L,s[e+3]=q,s[e+4]=X,s[e+5]=Q,s[e+6]=V,s[e+7]=Z};G.prototype._realTransform4=function(){var e=this._out,t=this._csize,o=this._width,s=1<<o,n=t/s<<1,r,u,l=this._bitrev;if(n===4)for(r=0,u=0;r<t;r+=n,u++){const Ne=l[u];this._singleRealTransform2(r,Ne>>>1,s>>>1)}else for(r=0,u=0;r<t;r+=n,u++){const Ne=l[u];this._singleRealTransform4(r,Ne>>>1,s>>>1)}var a=this._inv?-1:1,d=this.table;for(s>>=2;s>=2;s>>=2){n=t/s<<1;var g=n>>>1,m=g>>>1,w=m>>>1;for(r=0;r<t;r+=n)for(var h=0,v=0;h<=w;h+=2,v+=s){var y=r+h,f=y+m,b=f+m,_=b+m,x=e[y],A=e[y+1],p=e[f],S=e[f+1],C=e[b],T=e[b+1],R=e[_],L=e[_+1],q=x,X=A,Q=d[v],V=a*d[v+1],Z=p*Q-S*V,ee=p*V+S*Q,te=d[2*v],se=a*d[2*v+1],Y=C*te-T*se,ne=C*se+T*te,ce=d[3*v],le=a*d[3*v+1],ue=R*ce-L*le,oe=R*le+L*ce,re=q+Y,he=X+ne,c=q-Y,D=X-ne,I=Z+ue,j=ee+oe,k=a*(Z-ue),ie=a*(ee-oe),_e=re+I,ge=he+j,pe=c+ie,Me=D-k;if(e[y]=_e,e[y+1]=ge,e[f]=pe,e[f+1]=Me,h===0){var de=re-I,ve=he-j;e[b]=de,e[b+1]=ve;continue}if(h!==w){var De=c,ze=-D,K=re,Ee=-he,ot=-a*ie,rt=-a*k,it=-a*j,at=-a*I,ct=De+ot,lt=ze+rt,ut=K+at,ht=Ee-it,Je=r+m-h,Xe=r+g-h;e[Je]=ct,e[Je+1]=lt,e[Xe]=ut,e[Xe+1]=ht}}}};G.prototype._singleRealTransform2=function(e,t,o){const s=this._out,n=this._data,r=n[t],u=n[t+o],l=r+u,a=r-u;s[e]=l,s[e+1]=0,s[e+2]=a,s[e+3]=0};G.prototype._singleRealTransform4=function(e,t,o){const s=this._out,n=this._data,r=this._inv?-1:1,u=o*2,l=o*3,a=n[t],d=n[t+o],g=n[t+u],m=n[t+l],w=a+g,h=a-g,v=d+m,y=r*(d-m),f=w+v,b=h,_=-y,x=w-v,A=h,p=y;s[e]=f,s[e+1]=0,s[e+2]=b,s[e+3]=_,s[e+4]=x,s[e+5]=0,s[e+6]=A,s[e+7]=p};const wt=vt(yt);class Ae{constructor(e,t){U(this,"_inputLength");U(this,"_fft");U(this,"_bufferSupplier");U(this,"_paddedInputBuffer");U(this,"_transformBuffer");U(this,"_inverseBuffer");if(e<1)throw new Error("Input length must be at least one");this._inputLength=e,this._fft=new wt(pt(2*e)),this._bufferSupplier=t,this._paddedInputBuffer=this._bufferSupplier(this._fft.size),this._transformBuffer=this._bufferSupplier(2*this._fft.size),this._inverseBuffer=this._bufferSupplier(2*this._fft.size)}static forFloat32Array(e){return new Ae(e,t=>new Float32Array(t))}static forFloat64Array(e){return new Ae(e,t=>new Float64Array(t))}static forNumberArray(e){return new Ae(e,t=>Array(t))}get inputLength(){return this._inputLength}autocorrelate(e,t=this._bufferSupplier(e.length)){if(e.length!==this._inputLength)throw new Error(`Input must have length ${this._inputLength} but had length ${e.length}`);for(let s=0;s<e.length;s++)this._paddedInputBuffer[s]=e[s];for(let s=e.length;s<this._paddedInputBuffer.length;s++)this._paddedInputBuffer[s]=0;this._fft.realTransform(this._transformBuffer,this._paddedInputBuffer),this._fft.completeSpectrum(this._transformBuffer);const o=this._transformBuffer;for(let s=0;s<o.length;s+=2)o[s]=o[s]*o[s]+o[s+1]*o[s+1],o[s+1]=0;this._fft.inverseTransform(this._inverseBuffer,this._transformBuffer);for(let s=0;s<e.length;s++)t[s]=this._inverseBuffer[2*s];return t}}function bt(i){const e=[];let t=!1,o=-1/0,s=-1;for(let n=1;n<i.length-1;n++)i[n-1]<=0&&i[n]>0?(t=!0,s=n,o=i[n]):i[n-1]>0&&i[n]<=0?(t=!1,s!==-1&&e.push(s)):t&&i[n]>o&&(o=i[n],s=n);return e}function _t(i,e){const[t,o,s]=[i-1,i,i+1],[n,r,u]=[e[t],e[o],e[s]],l=n/2-r+u/2,a=-(n/2)*(o+s)+r*(t+s)-u/2*(t+o),d=n*o*s/2-r*t*s+u*t*o/2,g=-a/(2*l),m=l*g*g+a*g+d;return[g,m]}class be{constructor(e,t){U(this,"_autocorrelator");U(this,"_nsdfBuffer");U(this,"_clarityThreshold",.9);U(this,"_minVolumeAbsolute",0);U(this,"_maxInputAmplitude",1);this._autocorrelator=new Ae(e,t),this._nsdfBuffer=t(e)}static forFloat32Array(e){return new be(e,t=>new Float32Array(t))}static forFloat64Array(e){return new be(e,t=>new Float64Array(t))}static forNumberArray(e){return new be(e,t=>Array(t))}get inputLength(){return this._autocorrelator.inputLength}set clarityThreshold(e){if(!Number.isFinite(e)||e<=0||e>1)throw new Error("clarityThreshold must be a number in the range (0, 1]");this._clarityThreshold=e}set minVolumeAbsolute(e){if(!Number.isFinite(e)||e<0||e>this._maxInputAmplitude)throw new Error(`minVolumeAbsolute must be a number in the range [0, ${this._maxInputAmplitude}]`);this._minVolumeAbsolute=e}set minVolumeDecibels(e){if(!Number.isFinite(e)||e>0)throw new Error("minVolumeDecibels must be a number <= 0");this._minVolumeAbsolute=this._maxInputAmplitude*10**(e/10)}set maxInputAmplitude(e){if(!Number.isFinite(e)||e<=0)throw new Error("maxInputAmplitude must be a number > 0");this._maxInputAmplitude=e}findPitch(e,t){if(this._belowMinimumVolume(e))return[0,0];this._nsdf(e);const o=bt(this._nsdfBuffer);if(o.length===0)return[0,0];const s=Math.max(...o.map(l=>this._nsdfBuffer[l])),n=o.find(l=>this._nsdfBuffer[l]>=this._clarityThreshold*s),[r,u]=_t(n,this._nsdfBuffer);return[t/r,Math.min(u,1)]}_belowMinimumVolume(e){if(this._minVolumeAbsolute===0)return!1;let t=0;for(let o=0;o<e.length;o++)t+=e[o]**2;return Math.sqrt(t/e.length)<this._minVolumeAbsolute}_nsdf(e){this._autocorrelator.autocorrelate(e,this._nsdfBuffer);let t=2*this._nsdfBuffer[0],o;for(o=0;o<this._nsdfBuffer.length&&t>0;o++)this._nsdfBuffer[o]=2*this._nsdfBuffer[o]/t,t-=e[o]**2+e[e.length-o-1]**2;for(;o<this._nsdfBuffer.length;o++)this._nsdfBuffer[o]=0}}function pt(i){return i--,i|=i>>1,i|=i>>2,i|=i>>4,i|=i>>8,i|=i>>16,i++,i}const xe="src/lib/components/VolumeBar.svelte";function Ve(i){let e,t,o,s,n,r;const u={c:function(){e=N("div"),t=N("div"),o=N("div"),s=$(),n=N("div"),this.h()},l:function(a){e=E(a,"DIV",{class:!0});var d=H(e);t=E(d,"DIV",{class:!0,style:!0});var g=H(t);o=E(g,"DIV",{class:!0,style:!0}),H(o).forEach(P),g.forEach(P),s=O(d),n=E(d,"DIV",{class:!0,style:!0}),H(n).forEach(P),d.forEach(P),this.h()},h:function(){F(o,"class","volume-bar-fill"),B(o,"position","absolute"),B(o,"top","0"),B(o,"left","0"),B(o,"height","100%"),z(o,xe,51,4,1464),F(t,"class","volume-bar-bg"),B(t,"height",i[1]),B(t,"border-radius","9999px"),B(t,"background-color","#e2e8f0"),B(t,"position","relative"),B(t,"overflow","hidden"),z(t,xe,50,2,1318),F(n,"class","threshold-indicator svelte-13z7ppf"),B(n,"position","absolute"),B(n,"top","0"),B(n,"left",i[0]+"%"),B(n,"width","2px"),B(n,"height",i[1]),B(n,"background-color","#64748b"),B(n,"border-radius","1px"),z(n,xe,59,2,1643),F(e,"class",r="volume-bar-container "+i[2]+" svelte-13z7ppf"),z(e,xe,49,0,1269)},m:function(a,d){fe(a,e,d),M(e,t),M(t,o),i[5](o),M(e,s),M(e,n)},p:function(a,[d]){d&2&&B(t,"height",a[1]),d&1&&B(n,"left",a[0]+"%"),d&2&&B(n,"height",a[1]),d&4&&r!==(r="volume-bar-container "+a[2]+" svelte-13z7ppf")&&F(e,"class",r)},i:Ye,o:Ye,d:function(a){a&&P(e),i[5](null)}};return ae("SvelteRegisterBlock",{block:u,id:Ve.name,type:"component",source:"",ctx:i}),u}function Mt(i,e,t){let{$$slots:o={},$$scope:s}=e;je("VolumeBar",o,[]);let{volume:n=0}=e,{threshold:r=30}=e,{height:u="12px"}=e,{className:l=""}=e,a;function d(h){return h<r?`rgba(37, 99, 235, ${Math.max(.2,h/r*.8)})`:"#2563eb"}function g(h){if(a){const v=Math.max(0,Math.min(100,h)),y=d(v);t(3,a.style.width=`${v}%`,a),t(3,a.style.backgroundColor=y,a)}}Ie(()=>{a&&(t(3,a.style.width="0%",a),t(3,a.style.backgroundColor="#2563eb",a),t(3,a.style.height=u,a),t(3,a.style.borderRadius="9999px",a),t(3,a.style.transition="width 0.2s ease-out, background-color 0.2s ease-out",a))});const m=["volume","threshold","height","className"];Object.keys(e).forEach(h=>{!~m.indexOf(h)&&h.slice(0,2)!=="$$"&&h!=="slot"&&console.warn(`<VolumeBar> was created with unknown prop '${h}'`)});function w(h){ft[h?"unshift":"push"](()=>{a=h,t(3,a)})}return i.$$set=h=>{"volume"in h&&t(4,n=h.volume),"threshold"in h&&t(0,r=h.threshold),"height"in h&&t(1,u=h.height),"className"in h&&t(2,l=h.className)},i.$capture_state=()=>({onMount:Ie,volume:n,threshold:r,height:u,className:l,barElement:a,getVolumeColor:d,updateVolumeBar:g}),i.$inject_state=h=>{"volume"in h&&t(4,n=h.volume),"threshold"in h&&t(0,r=h.threshold),"height"in h&&t(1,u=h.height),"className"in h&&t(2,l=h.className),"barElement"in h&&t(3,a=h.barElement)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),i.$$.update=()=>{i.$$.dirty&16&&g(n)},[r,u,l,a,n,w]}class Te extends He{constructor(e){super(e),Re(this,e,Mt,Ve,qe,{volume:4,threshold:0,height:1,className:2}),ae("SvelteRegisterComponent",{component:this,tagName:"VolumeBar",options:e,id:Ve.name})}get volume(){throw new Error("<VolumeBar>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set volume(e){throw new Error("<VolumeBar>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get threshold(){throw new Error("<VolumeBar>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set threshold(e){throw new Error("<VolumeBar>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get height(){throw new Error("<VolumeBar>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set height(e){throw new Error("<VolumeBar>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get className(){throw new Error("<VolumeBar>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set className(e){throw new Error("<VolumeBar>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}class Dt{constructor(){this.audioContext=null,this.mediaStream=null,this.sourceNode=null,this.analysers=new Map,this.filters=new Map,this.refCount=0,this.initPromise=null,this.isInitialized=!1,this.lastError=null}async initialize(){var e,t,o;if(this.initPromise)return this.initPromise;if(this.isInitialized&&this.audioContext&&this.mediaStream){const s=this.checkMediaStreamHealth();if(s.healthy)return this.refCount++,{audioContext:this.audioContext,mediaStream:this.mediaStream,sourceNode:this.sourceNode};console.warn("‚ö†Ô∏è [AudioManager] MediaStream‰∏çÂÅ•Â∫∑Ê§úÂá∫ - Âº∑Âà∂ÂÜçÂàùÊúüÂåñ:",s.reason),console.log("üîÑ [AudioManager] ‰∏çÂÅ•Â∫∑„Å™MediaStreamË©≥Á¥∞:",{mediaStreamActive:(e=this.mediaStream)==null?void 0:e.active,trackCount:(t=this.mediaStream)==null?void 0:t.getTracks().length,trackStates:(o=this.mediaStream)==null?void 0:o.getTracks().map(n=>({kind:n.kind,readyState:n.readyState,enabled:n.enabled,muted:n.muted}))}),this._cleanup(),this.isInitialized=!1,this.refCount=0,await new Promise(n=>setTimeout(n,100)),console.log("üîÑ [AudioManager] „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÂÆå‰∫Ü - ÂÜçÂàùÊúüÂåñÈñãÂßã")}this.initPromise=this._doInitialize();try{const s=await this.initPromise;return this.initPromise=null,s}catch(s){throw this.initPromise=null,s}}async _doInitialize(){try{if(console.log("üé§ [AudioManager] ÂàùÊúüÂåñÈñãÂßã"),this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext),console.log("‚úÖ [AudioManager] AudioContext‰ΩúÊàêÂÆå‰∫Ü")),this.audioContext.state==="suspended"&&(await this.audioContext.resume(),console.log("‚úÖ [AudioManager] AudioContextÂÜçÈñãÂÆå‰∫Ü")),!this.mediaStream){const e={audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,sampleRate:44100,channelCount:1,sampleSize:16,latency:.1,volume:1,deviceId:{ideal:"default"}}};console.log("üé§ [AudioManager] SafariÂØæÂøúË®≠ÂÆö„ÅßMediaStreamÂèñÂæó‰∏≠:",e),this.mediaStream=await navigator.mediaDevices.getUserMedia(e),console.log("‚úÖ [AudioManager] MediaStreamÂèñÂæóÂÆå‰∫Ü")}if(!this.sourceNode){this.sourceNode=this.audioContext.createMediaStreamSource(this.mediaStream),console.log("‚úÖ [AudioManager] SourceNode‰ΩúÊàêÂÆå‰∫Ü");const e=this.mediaStream.getTracks();console.log("üé§ [AudioManager] MediaStream tracks:",e.map(t=>({kind:t.kind,label:t.label,enabled:t.enabled,readyState:t.readyState,muted:t.muted})))}return this.isInitialized=!0,this.refCount++,this.lastError=null,console.log(`üé§ [AudioManager] ÂàùÊúüÂåñÂÆå‰∫Ü (ÂèÇÁÖß„Ç´„Ç¶„É≥„Éà: ${this.refCount})`),{audioContext:this.audioContext,mediaStream:this.mediaStream,sourceNode:this.sourceNode}}catch(e){throw console.error("‚ùå [AudioManager] ÂàùÊúüÂåñ„Ç®„É©„Éº:",e),this.lastError=e,this.isInitialized=!1,this._cleanup(),e}}createAnalyser(e,t={}){if(!this.isInitialized||!this.audioContext||!this.sourceNode)throw new Error("AudioManager not initialized. Call initialize() first.");this.removeAnalyser(e);const{fftSize:o=2048,smoothingTimeConstant:s=.8,minDecibels:n=-90,maxDecibels:r=-10,useFilters:u=!0}=t,l=this.audioContext.createAnalyser();if(l.fftSize=Math.min(o,2048),l.smoothingTimeConstant=Math.max(s,.7),l.minDecibels=Math.max(n,-80),l.maxDecibels=Math.min(r,-10),this.sourceNode,u){const a=this._createFilterChain();this.filters.set(e,a),this.sourceNode.connect(a.highpass),a.highpass.connect(a.lowpass),a.lowpass.connect(a.notch),a.notch.connect(l),console.log(`üîß [AudioManager] „Éï„Ç£„É´„Çø„Éº‰ªò„ÅçAnalyser‰ΩúÊàê: ${e}`)}else this.sourceNode.connect(l),console.log(`üîß [AudioManager] Áîü‰ø°Âè∑Analyser‰ΩúÊàê: ${e}`);return this.analysers.set(e,l),l}_createFilterChain(){const e=this.audioContext.createBiquadFilter();e.type="highpass",e.frequency.setValueAtTime(80,this.audioContext.currentTime),e.Q.setValueAtTime(.7,this.audioContext.currentTime);const t=this.audioContext.createBiquadFilter();t.type="lowpass",t.frequency.setValueAtTime(800,this.audioContext.currentTime),t.Q.setValueAtTime(.7,this.audioContext.currentTime);const o=this.audioContext.createBiquadFilter();return o.type="notch",o.frequency.setValueAtTime(60,this.audioContext.currentTime),o.Q.setValueAtTime(10,this.audioContext.currentTime),{highpass:e,lowpass:t,notch:o}}removeAnalyser(e){if(this.analysers.has(e)&&(this.analysers.get(e).disconnect(),this.analysers.delete(e),console.log(`üóëÔ∏è [AudioManager] AnalyserÂâäÈô§: ${e}`)),this.filters.has(e)){const t=this.filters.get(e);t.highpass.disconnect(),t.lowpass.disconnect(),t.notch.disconnect(),this.filters.delete(e),console.log(`üóëÔ∏è [AudioManager] „Éï„Ç£„É´„Çø„Éº„ÉÅ„Çß„Éº„É≥ÂâäÈô§: ${e}`)}}release(e=[]){e.forEach(t=>this.removeAnalyser(t)),this.refCount=Math.max(0,this.refCount-1),console.log(`üìâ [AudioManager] ÂèÇÁÖß„Ç´„Ç¶„É≥„ÉàÊ∏õÁÆó: ${this.refCount}`),this.refCount<=0&&(console.log("üßπ [AudioManager] ÂÖ®„É™„ÇΩ„Éº„Çπ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÈñãÂßã"),this._cleanup())}forceCleanup(){console.log("üö® [AudioManager] Âº∑Âà∂„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÂÆüË°å"),this._cleanup()}_cleanup(){console.log("üßπ [AudioManager] „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÈñãÂßã");for(const e of this.analysers.keys())this.removeAnalyser(e);if(this.mediaStream){const e=this.mediaStream.getTracks();console.log(`üõë [AudioManager] MediaStreamÂÅúÊ≠¢‰∏≠: ${e.length} tracks`),e.forEach((t,o)=>{try{t.readyState!=="ended"?(t.stop(),console.log(`üõë [AudioManager] Track ${o} ÂÅúÊ≠¢ÂÆå‰∫Ü`)):console.log(`‚ö†Ô∏è [AudioManager] Track ${o} Êó¢„Å´ÁµÇ‰∫ÜÊ∏à„Åø`)}catch(s){console.warn(`‚ö†Ô∏è [AudioManager] Track ${o} ÂÅúÊ≠¢„Ç®„É©„Éº:`,s)}}),this.mediaStream=null}if(this.audioContext&&this.audioContext.state!=="closed"){try{this.audioContext.close(),console.log("üõë [AudioManager] AudioContextÈñâÈéñÂÆå‰∫Ü")}catch(e){console.warn("‚ö†Ô∏è [AudioManager] AudioContextÈñâÈéñ„Ç®„É©„Éº:",e)}this.audioContext=null}this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=null),this.isInitialized=!1,this.refCount=0,this.initPromise=null,console.log("‚úÖ [AudioManager] „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÂÆå‰∫Ü")}getStatus(){var e,t;return{isInitialized:this.isInitialized,refCount:this.refCount,audioContextState:((e=this.audioContext)==null?void 0:e.state)||"none",mediaStreamActive:((t=this.mediaStream)==null?void 0:t.active)||!1,activeAnalysers:Array.from(this.analysers.keys()),activeFilters:Array.from(this.filters.keys()),lastError:this.lastError}}checkMediaStreamHealth(){if(!this.mediaStream)return{healthy:!1,reason:"MediaStream not initialized"};if(!this.mediaStream.active)return{healthy:!1,reason:"MediaStream inactive"};const e=this.mediaStream.getTracks();if(e.length===0)return{healthy:!1,reason:"No tracks available"};const t=e.find(o=>o.kind==="audio");return t?t.readyState==="ended"?{healthy:!1,reason:"Audio track ended"}:t.enabled?t.muted?{healthy:!1,reason:"Audio track muted"}:this.mediaStream.active&&t.readyState!=="live"?{healthy:!1,reason:"Track state inconsistent with MediaStream"}:{healthy:!0,track:t}:{healthy:!1,reason:"Audio track disabled"}:{healthy:!1,reason:"No audio track found"}}}const ye=new Dt;typeof window<"u"&&(window.audioManager=ye);class At{constructor(e={}){this.vocalRangeMin=e.vocalRangeMin||130.81,this.vocalRangeMax=e.vocalRangeMax||1046.5,this.stabilityThreshold=e.stabilityThreshold||.1,this.evaluationWeights={vocalRange:e.vocalRangeWeight||.4,continuity:e.continuityWeight||.4,musical:e.musicalWeight||.2},this.fundamentalCandidates=e.fundamentalCandidates||[1,.5,.333,.25,2],this.harmonicHistory=[],this.previousFrequency=0,this.maxHistoryLength=5,this.debugMode=!0,this.currentContext={},console.log("üîß [HarmonicCorrection] Áµ±‰∏ÄÂÄçÈü≥Ë£úÊ≠£„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÂÆå‰∫Ü")}correctHarmonic(e,t=!1){if(!e||e<=0)return 0;const s=this.fundamentalCandidates.map(u=>({frequency:e*u,ratio:u})).map(u=>{const l=this.evaluateFundamental(u.frequency);return{...u,...l}}),n=s.reduce((u,l)=>l.totalScore>u.totalScore?l:u),r=this.stabilizeFrequency(n.frequency);return(t||this.debugMode)&&this.logHarmonicCorrection(e,s,n,r,this.currentContext),this.previousFrequency=r,r}logHarmonicCorrection(e,t,o,s,n={}){console.group(`üîß [HarmonicCorrection] ${e.toFixed(1)}Hz ‚Üí ${s.toFixed(1)}Hz`);const r=this.frequencyToNote(e),u=this.frequencyToNote(s);console.log(`üìù Èü≥Á®ãÂ§âÊèõ: ${r} ‚Üí ${u}`);const l=this.getCorrectionType(o.ratio);if(console.log(`üéØ Ë£úÊ≠£„Çø„Ç§„Éó: ${l}`),n.baseFrequency&&n.currentScale&&n.targetFrequency){console.log("üéµ Èü≥Èöé„Ç≥„É≥„ÉÜ„Ç≠„Çπ„Éà:"),console.log(`   Âü∫Èü≥: ${n.baseFrequency.toFixed(1)}Hz (${this.frequencyToNote(n.baseFrequency)})`),console.log(`   ÁèæÂú®„ÅÆÈü≥Èöé: ${n.currentScale}`),console.log(`   ÁõÆÊ®ôÂë®Ê≥¢Êï∞: ${n.targetFrequency.toFixed(1)}Hz (${this.frequencyToNote(n.targetFrequency)})`);const d=s-n.targetFrequency,g=1200*Math.log2(s/n.targetFrequency);console.log(`   ÁõÆÊ®ô„Å®„ÅÆÂ∑Æ: ${d>0?"+":""}${d.toFixed(1)}Hz (${g>0?"+":""}${g.toFixed(0)}„Çª„É≥„Éà)`);const m=Math.abs(g)<=50?"üéØ È´òÁ≤æÂ∫¶":Math.abs(g)<=100?"‚úÖ ËâØÂ•Ω":Math.abs(g)<=200?"‚ö†Ô∏è Ë¶ÅÊîπÂñÑ":"‚ùå ‰∏çÊ≠£Á¢∫";console.log(`   Á≤æÂ∫¶Ë©ï‰æ°: ${m} (${Math.abs(g).toFixed(0)}„Çª„É≥„ÉàÂ∑Æ)`)}console.table(t.map(d=>({ÂÄçÁéá:`${d.ratio.toFixed(3)}x`,Âë®Ê≥¢Êï∞:`${d.frequency.toFixed(1)}Hz`,Èü≥Âêç:this.frequencyToNote(d.frequency),Èü≥Âüü:d.vocalRangeScore.toFixed(2),ÈÄ£Á∂öÊÄß:d.continuityScore.toFixed(2),Èü≥Ê•ΩÊÄß:d.musicalScore.toFixed(2),Á∑èÂêà:d.totalScore.toFixed(3),ÈÅ∏Êäû:d===o?"‚úÖ":""})));const a=Math.abs(s-o.frequency);a>.5&&console.log(`üîÑ ÂÆâÂÆöÂåñ: ${o.frequency.toFixed(1)}Hz ‚Üí ${s.toFixed(1)}Hz (${a.toFixed(1)}HzË™øÊï¥)`),console.groupEnd()}getCorrectionType(e){return Math.abs(e-1)<.01?"Ë£úÊ≠£„Å™„ÅóÔºàÂü∫Èü≥Ôºâ":Math.abs(e-.5)<.01?"2ÂÄçÈü≥Ë£úÊ≠£Ôºà1„Ç™„ÇØ„Çø„Éº„Éñ‰∏ãÔºâ":Math.abs(e-.333)<.01?"3ÂÄçÈü≥Ë£úÊ≠£Ôºà1„Ç™„ÇØ„Çø„Éº„Éñ+5Â∫¶‰∏ãÔºâ":Math.abs(e-.25)<.01?"4ÂÄçÈü≥Ë£úÊ≠£Ôºà2„Ç™„ÇØ„Çø„Éº„Éñ‰∏ãÔºâ":Math.abs(e-2)<.01?"„Ç™„ÇØ„Çø„Éº„Éñ‰∏äË£úÊ≠£":`„Ç´„Çπ„Çø„É†Ë£úÊ≠£Ôºà${e.toFixed(3)}xÔºâ`}frequencyToNote(e){if(!e||e<=0)return"---";const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],s=Math.round(12*Math.log2(e/440)),n=(s+9+120)%12,r=Math.floor((s+9)/12)+4;return t[n]+r}evaluateFundamental(e){const o=e>=this.vocalRangeMin&&e<=this.vocalRangeMax?1:0,s=this.previousFrequency>0?1-Math.min(Math.abs(e-this.previousFrequency)/this.previousFrequency,1):.5,n=this.calculateMusicalScore(e),r=o*this.evaluationWeights.vocalRange+s*this.evaluationWeights.continuity+n*this.evaluationWeights.musical;return{vocalRangeScore:o,continuityScore:s,musicalScore:n,totalScore:r}}calculateMusicalScore(e){const o=Math.log2(e/261.63)*12,s=Math.round(o),n=Math.abs(o-s);return Math.max(0,1-n/.5)}stabilizeFrequency(e){if(!e||e<=0)return 0;if(this.harmonicHistory.push(e),this.harmonicHistory.length>this.maxHistoryLength&&this.harmonicHistory.shift(),this.harmonicHistory.length<2)return e;const t=[...this.harmonicHistory].sort((r,u)=>r-u),o=t[Math.floor(t.length/2)],s=o*this.stabilityThreshold;return Math.abs(e-o)>s?o+Math.sign(e-o)*s:e}resetHistory(){this.harmonicHistory=[],this.previousFrequency=0}updateConfig(e){Object.assign(this,e),console.log("‚öôÔ∏è [HarmonicCorrection] Ë®≠ÂÆöÊõ¥Êñ∞:",e)}enableDebugLogging(){this.debugMode=!0,console.log("üîç [HarmonicCorrection] „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞ÊúâÂäπÂåñ - Ê¨°Âõû„ÅÆË£úÊ≠£„Åã„ÇâË©≥Á¥∞„É≠„Ç∞„ÇíÂá∫Âäõ„Åó„Åæ„Åô"),console.log("ÁÑ°ÂäπÂåñ„Åô„Çã„Å´„ÅØ: harmonicCorrection.disableDebugLogging()")}disableDebugLogging(){this.debugMode=!1,console.log("üîç [HarmonicCorrection] „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞ÁÑ°ÂäπÂåñ")}setScaleContext(e){this.currentContext={baseFrequency:e.baseFrequency,currentScale:e.currentScale,targetFrequency:e.targetFrequency}}clearContext(){this.currentContext={}}getStatus(){return{vocalRangeMin:this.vocalRangeMin,vocalRangeMax:this.vocalRangeMax,stabilityThreshold:this.stabilityThreshold,evaluationWeights:this.evaluationWeights,historyLength:this.harmonicHistory.length,previousFrequency:this.previousFrequency,recentHistory:this.harmonicHistory.slice(-3)}}}const we=new At;typeof window<"u"&&(window.harmonicCorrection=we);const{Error:W,console:Ct}=gt,me="src/lib/components/PitchDetector.svelte";function Be(i){let e,t,o,s,n=(i[2]>0?Math.round(i[2]):"---")+"",r,u,l,a="Hz",d,g,m="|",w,h,v,y,f,b,_;f=new Te({props:{volume:i[2]>0?i[1]:0,className:"volume-bar"},$$inline:!0});const x={c:function(){e=N("div"),t=N("div"),o=N("div"),s=N("span"),r=Fe(n),u=$(),l=N("span"),l.textContent=a,d=$(),g=N("span"),g.textContent=m,w=$(),h=N("span"),v=Fe(i[3]),y=$(),Ue(f.$$.fragment),this.h()},l:function(p){e=E(p,"DIV",{class:!0});var S=H(e);t=E(S,"DIV",{class:!0});var C=H(t);o=E(C,"DIV",{class:!0});var T=H(o);s=E(T,"SPAN",{class:!0});var R=H(s);r=Se(R,n),R.forEach(P),u=O(T),l=E(T,"SPAN",{class:!0,"data-svelte-h":!0}),Pe(l)!=="svelte-5uyilv"&&(l.textContent=a),d=O(T),g=E(T,"SPAN",{class:!0,"data-svelte-h":!0}),Pe(g)!=="svelte-1dytxz4"&&(g.textContent=m),w=O(T),h=E(T,"SPAN",{class:!0});var L=H(h);v=Se(L,i[3]),L.forEach(P),T.forEach(P),y=O(C),Ke(f.$$.fragment,C),C.forEach(P),S.forEach(P),this.h()},h:function(){F(s,"class","detected-frequency svelte-vc1bho"),z(s,me,515,6,14878),F(l,"class","hz-suffix svelte-vc1bho"),z(l,me,516,6,14986),F(g,"class","divider svelte-vc1bho"),z(g,me,517,6,15026),F(h,"class","detected-note svelte-vc1bho"),z(h,me,518,6,15063),F(o,"class","detection-card svelte-vc1bho"),z(o,me,514,4,14843),F(t,"class","detection-display svelte-vc1bho"),z(t,me,513,2,14807),F(e,"class",b="pitch-detector "+i[0]+" svelte-vc1bho"),z(e,me,512,0,14764)},m:function(p,S){fe(p,e,S),M(e,t),M(t,o),M(o,s),M(s,r),M(o,u),M(o,l),M(o,d),M(o,g),M(o,w),M(o,h),M(h,v),M(t,y),Qe(f,t,null),_=!0},p:function(p,S){(!_||S[0]&4)&&n!==(n=(p[2]>0?Math.round(p[2]):"---")+"")&&Ce(r,n),(!_||S[0]&8)&&Ce(v,p[3]);const C={};S[0]&6&&(C.volume=p[2]>0?p[1]:0),f.$set(C),(!_||S[0]&1&&b!==(b="pitch-detector "+p[0]+" svelte-vc1bho"))&&F(e,"class",b)},i:function(p){_||(Ge(f.$$.fragment,p),_=!0)},o:function(p){We(f.$$.fragment,p),_=!1},d:function(p){p&&P(e),Le(f)}};return ae("SvelteRegisterBlock",{block:x,id:Be.name,type:"component",source:"",ctx:i}),x}function $e(i){const e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];if(i<=0)return"„Éº„Éº";const o=Math.round(12*Math.log2(i/440)),s=(o+9+120)%12,n=Math.floor((o+9)/12)+4;return e[s]+n}function St(i,e,t){let{$$slots:o={},$$scope:s}=e;je("PitchDetector",o,[]);const n=Ze();let{isActive:r=!1}=e,{className:u=""}=e,{debugMode:l=!1}=e,a="uninitialized",d=null,g=!1,m=null,w=null,h=null,v=null,y=null,f=null,b=null,_=!1,x=[],A=new Map,p=0,S=0,C=0,T="„Éº„Éº",R=0,L=[],q=[],X=0,Q=0,V=null;function Z(){p=0,t(1,S=0),t(2,C=0),t(3,T="„Éº„Éº"),R=0,X=0,Q=0,L=[],q=[],we.resetHistory(),l&&console.log("üîÑ [PitchDetector] Display state reset")}function ee(){if(!l)return;const c=new Date().toLocaleTimeString(),D={timestamp:c,componentState:a,isActive:r,isDetecting:_,isInitialized:g,mediaStreamActive:w?w.active:null,mediaStreamTracks:w?w.getTracks().length:0,trackStates:w?w.getTracks().map(k=>({kind:k.kind,enabled:k.enabled,readyState:k.readyState,muted:k.muted})):[],audioContextState:m?m.state:null,hasAnalyser:!!v,currentVolume:p,currentFrequency:C};console.log(`üé§ [PitchDetector] ${c}:`,D);let I=!0,j=[];w&&!w.active&&(console.warn("‚ö†Ô∏è [PitchDetector] MediaStream is inactive!",w),I=!1,j.push("MediaStream inactive")),m&&m.state==="suspended"&&(console.warn("‚ö†Ô∏è [PitchDetector] AudioContext is suspended!",m),I=!1,j.push("AudioContext suspended")),w&&w.getTracks().forEach((k,ie)=>{k.readyState==="ended"&&(console.error(`‚ùå [PitchDetector] Track ${ie} has ended!`,k),I=!1,j.push(`Track ${ie} ended`))}),n("microphoneHealthChange",{healthy:I,errors:j,details:D})}async function te(){try{t(14,a="initializing"),d=null,console.log("üéôÔ∏è [PitchDetector] AudioManagerÁµåÁî±„ÅßÂàùÊúüÂåñÈñãÂßã");const c=await ye.initialize();m=c.audioContext,w=c.mediaStream,h=c.sourceNode,console.log("‚úÖ [PitchDetector] AudioManager „É™„ÇΩ„Éº„ÇπÂèñÂæóÂÆå‰∫Ü");const D=`pitch-detector-filtered-${Date.now()}`;t(15,v=ye.createAnalyser(D,{fftSize:2048,smoothingTimeConstant:.8,minDecibels:-90,maxDecibels:-10,useFilters:!0})),x.push(D);const I=`pitch-detector-raw-${Date.now()}`;y=ye.createAnalyser(I,{fftSize:2048,smoothingTimeConstant:.8,minDecibels:-90,maxDecibels:-10,useFilters:!1}),x.push(I),console.log("‚úÖ [PitchDetector] Analyser‰ΩúÊàêÂÆå‰∫Ü:",x),f=be.forFloat32Array(v.fftSize),t(14,a="ready"),g=!0,n("stateChange",{state:a}),re(),console.log("‚úÖ [PitchDetector] ÂàùÊúüÂåñÂÆå‰∫Ü")}catch(c){throw console.error("‚ùå [PitchDetector] ÂàùÊúüÂåñ„Ç®„É©„Éº:",c),t(14,a="error"),d=c,g=!1,n("error",{error:c,context:"initialization"}),c}}function se(){if(a!=="ready"){const c=new Error(`Cannot start detection: component state is ${a}`);return n("error",{error:c,context:"start-detection"}),!1}if(!v||!f||!m){const c=new Error("Required components not available");return t(14,a="error"),n("error",{error:c,context:"start-detection"}),!1}return t(14,a="detecting"),t(16,_=!0),n("stateChange",{state:a}),ne(),!0}function Y(){t(16,_=!1),b&&(cancelAnimationFrame(b),b=null),a==="detecting"&&g&&(t(14,a="ready"),n("stateChange",{state:a}))}function ne(){if(!_||!v||!y||!f)return;const c=v.fftSize,D=new Float32Array(c),I=new Float32Array(y.fftSize);v.getFloatTimeDomainData(D),y.getFloatTimeDomainData(I);let j=0;for(let K=0;K<c;K++)j+=Math.abs(D[K]);const k=Math.sqrt(j/c),ie=Math.log10(k+.001)*50+100,_e=Math.max(0,Math.min(100,ie));let ge=0;for(let K=0;K<I.length;K++)ge+=Math.abs(I[K]);const pe=Math.sqrt(ge/I.length),Me=Math.log10(pe+.001)*50+100;t(1,S=Math.max(0,Math.min(100,Me))),q.push(_e),q.length>5&&q.shift(),Q=q.reduce((K,Ee)=>K+Ee,0)/q.length,p=Q;const[de,ve]=f.findPitch(D,m.sampleRate),De=de>=65&&de<=1200;if(de&&ve>.6&&p>10&&De){const K=we.correctHarmonic(de);t(2,C=Math.round(K)),t(3,T=$e(C)),R=ve}else C===0&&we.resetHistory(),t(2,C=0),t(3,T="„Éº„Éº"),R=0;const ze=C>0?S:0;n("pitchUpdate",{frequency:C,note:T,volume:p,rawVolume:ze,clarity:R}),b=requestAnimationFrame(ne)}function ce(){return g&&a==="ready"}function le(){return{componentState:a,isInitialized:g,isDetecting:_,lastError:d,hasRequiredComponents:!!(v&&f&&m&&w)}}async function ue(){console.log("üîÑ [PitchDetector] ÂÜçÂàùÊúüÂåñÈñãÂßã"),oe(),await new Promise(c=>setTimeout(c,100)),await te(),console.log("‚úÖ [PitchDetector] ÂÜçÂàùÊúüÂåñÂÆå‰∫Ü")}function oe(){console.log("üßπ [PitchDetector] „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÈñãÂßã"),Y(),A.size>0&&(A.forEach((c,D)=>{D.removeEventListener("ended",c.endedHandler),D.removeEventListener("mute",c.muteHandler),D.removeEventListener("unmute",c.unmuteHandler)}),A.clear(),console.log("üîÑ [PitchDetector] MediaStream„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºÂâäÈô§")),x.length>0&&(ye.release(x),console.log("üì§ [PitchDetector] AudioManager„Å´AnalyserËß£ÊîæÈÄöÁü•:",x),x=[]),t(14,a="uninitialized"),g=!1,d=null,m=null,w=null,h=null,t(15,v=null),y=null,f=null,L=[],q=[],we.resetHistory(),console.log("‚úÖ [PitchDetector] „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÂÆå‰∫Ü")}function re(){if(!w)return;const c=w.getTracks();c.forEach(D=>{const I=()=>{console.error("üö® [PitchDetector] MediaStreamTrackÁµÇ‰∫ÜÊ§úÂá∫:",D.kind),t(14,a="error"),d=new Error(`MediaStreamTrack (${D.kind}) ended`),n("error",{error:d,reason:"mediastream_ended",recovery:"restart_required"}),_&&Y()},j=()=>{console.warn("‚ö†Ô∏è [PitchDetector] MediaStreamTrack muted:",D.kind),n("warning",{reason:"track_muted",track:D.kind})},k=()=>{console.log("‚úÖ [PitchDetector] MediaStreamTrack unmuted:",D.kind),n("info",{reason:"track_unmuted",track:D.kind})};D.addEventListener("ended",I),D.addEventListener("mute",j),D.addEventListener("unmute",k),A.set(D,{endedHandler:I,muteHandler:j,unmuteHandler:k})}),console.log("üîç [PitchDetector] MediaStreamÁõ£Ë¶ñÈñãÂßã:",c.length+" tracks")}Oe(()=>{V&&(clearInterval(V),t(17,V=null)),console.log("üîÑ [PitchDetector] onDestroy - AudioManager„É™„ÇΩ„Éº„Çπ„ÅØ‰øùÊåÅ")});const he=["isActive","className","debugMode"];return Object.keys(e).forEach(c=>{!~he.indexOf(c)&&c.slice(0,2)!=="$$"&&c!=="slot"&&Ct.warn(`<PitchDetector> was created with unknown prop '${c}'`)}),i.$$set=c=>{"isActive"in c&&t(4,r=c.isActive),"className"in c&&t(0,u=c.className),"debugMode"in c&&t(5,l=c.debugMode)},i.$capture_state=()=>({onMount:Ie,onDestroy:Oe,createEventDispatcher:Ze,PitchDetector:be,VolumeBar:Te,audioManager:ye,harmonicCorrection:we,dispatch:n,isActive:r,className:u,debugMode:l,componentState:a,lastError:d,isInitialized:g,audioContext:m,mediaStream:w,sourceNode:h,analyser:v,rawAnalyser:y,pitchDetector:f,animationFrame:b,isDetecting:_,analyserIds:x,mediaStreamListeners:A,currentVolume:p,rawVolume:S,currentFrequency:C,detectedNote:T,pitchClarity:R,frequencyHistory:L,volumeHistory:q,stableFrequency:X,stableVolume:Q,debugInterval:V,resetDisplayState:Z,checkMicrophoneStatus:ee,initialize:te,startDetection:se,stopDetection:Y,detectPitch:ne,frequencyToNote:$e,getIsInitialized:ce,getState:le,reinitialize:ue,cleanup:oe,setupMediaStreamMonitoring:re}),i.$inject_state=c=>{"isActive"in c&&t(4,r=c.isActive),"className"in c&&t(0,u=c.className),"debugMode"in c&&t(5,l=c.debugMode),"componentState"in c&&t(14,a=c.componentState),"lastError"in c&&(d=c.lastError),"isInitialized"in c&&(g=c.isInitialized),"audioContext"in c&&(m=c.audioContext),"mediaStream"in c&&(w=c.mediaStream),"sourceNode"in c&&(h=c.sourceNode),"analyser"in c&&t(15,v=c.analyser),"rawAnalyser"in c&&(y=c.rawAnalyser),"pitchDetector"in c&&(f=c.pitchDetector),"animationFrame"in c&&(b=c.animationFrame),"isDetecting"in c&&t(16,_=c.isDetecting),"analyserIds"in c&&(x=c.analyserIds),"mediaStreamListeners"in c&&(A=c.mediaStreamListeners),"currentVolume"in c&&(p=c.currentVolume),"rawVolume"in c&&t(1,S=c.rawVolume),"currentFrequency"in c&&t(2,C=c.currentFrequency),"detectedNote"in c&&t(3,T=c.detectedNote),"pitchClarity"in c&&(R=c.pitchClarity),"frequencyHistory"in c&&(L=c.frequencyHistory),"volumeHistory"in c&&(q=c.volumeHistory),"stableFrequency"in c&&(X=c.stableFrequency),"stableVolume"in c&&(Q=c.stableVolume),"debugInterval"in c&&t(17,V=c.debugInterval)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),i.$$.update=()=>{i.$$.dirty[0]&131104&&(l&&!V?(console.log("üîç [PitchDetector] Debug mode enabled - starting status monitoring"),t(17,V=setInterval(ee,3e3)),ee()):!l&&V&&(console.log("üîç [PitchDetector] Debug mode disabled - stopping status monitoring"),clearInterval(V),t(17,V=null))),i.$$.dirty[0]&114704&&(r&&a==="ready"&&v&&!_?se():!r&&_&&Y())},[u,S,C,T,r,l,Z,te,se,Y,ce,le,ue,oe,a,v,_,V]}class Nt extends He{constructor(e){super(e),Re(this,e,St,Be,qe,{isActive:4,className:0,debugMode:5,resetDisplayState:6,initialize:7,startDetection:8,stopDetection:9,getIsInitialized:10,getState:11,reinitialize:12,cleanup:13},null,[-1,-1]),ae("SvelteRegisterComponent",{component:this,tagName:"PitchDetector_1",options:e,id:Be.name})}get isActive(){throw new W("<PitchDetector>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set isActive(e){throw new W("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get className(){throw new W("<PitchDetector>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set className(e){throw new W("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get debugMode(){throw new W("<PitchDetector>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set debugMode(e){throw new W("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get resetDisplayState(){return this.$$.ctx[6]}set resetDisplayState(e){throw new W("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get initialize(){return this.$$.ctx[7]}set initialize(e){throw new W("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get startDetection(){return this.$$.ctx[8]}set startDetection(e){throw new W("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get stopDetection(){return this.$$.ctx[9]}set stopDetection(e){throw new W("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get getIsInitialized(){return this.$$.ctx[10]}set getIsInitialized(e){throw new W("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get getState(){return this.$$.ctx[11]}set getState(e){throw new W("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get reinitialize(){return this.$$.ctx[12]}set reinitialize(e){throw new W("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get cleanup(){return this.$$.ctx[13]}set cleanup(e){throw new W("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const J="src/lib/components/PitchDetectionDisplay.svelte";function tt(i){let e,t,o=(i[0]>0?Math.round(i[0]):"---")+"",s,n,r,u="Hz",l,a,d="|",g,m,w;const h={c:function(){e=N("div"),t=N("span"),s=Fe(o),n=$(),r=N("span"),r.textContent=u,l=$(),a=N("span"),a.textContent=d,g=$(),m=N("span"),w=Fe(i[1]),this.h()},l:function(y){e=E(y,"DIV",{class:!0});var f=H(e);t=E(f,"SPAN",{class:!0});var b=H(t);s=Se(b,o),b.forEach(P),n=O(f),r=E(f,"SPAN",{class:!0,"data-svelte-h":!0}),Pe(r)!=="svelte-5uyilv"&&(r.textContent=u),l=O(f),a=E(f,"SPAN",{class:!0,"data-svelte-h":!0}),Pe(a)!=="svelte-1dytxz4"&&(a.textContent=d),g=O(f),m=E(f,"SPAN",{class:!0});var _=H(m);w=Se(_,i[1]),_.forEach(P),f.forEach(P),this.h()},h:function(){F(t,"class","detected-frequency svelte-1datf0r"),z(t,J,25,14,712),F(r,"class","hz-suffix svelte-1datf0r"),z(r,J,26,14,814),F(a,"class","divider svelte-1datf0r"),z(a,J,27,14,862),F(m,"class","detected-note svelte-1datf0r"),z(m,J,28,14,907),F(e,"class","detection-values svelte-1datf0r"),z(e,J,24,12,667)},m:function(y,f){fe(y,e,f),M(e,t),M(t,s),M(e,n),M(e,r),M(e,l),M(e,a),M(e,g),M(e,m),M(m,w)},p:function(y,f){f&1&&o!==(o=(y[0]>0?Math.round(y[0]):"---")+"")&&Ce(s,o),f&2&&Ce(w,y[1])},d:function(y){y&&P(e)}};return ae("SvelteRegisterBlock",{block:h,id:tt.name,type:"else",source:"(24:10) {:else}",ctx:i}),h}function st(i){let e,t;const o={c:function(){e=N("span"),t=Fe(i[4]),this.h()},l:function(n){e=E(n,"SPAN",{class:!0});var r=H(e);t=Se(r,i[4]),r.forEach(P),this.h()},h:function(){F(e,"class","muted-message svelte-1datf0r"),z(e,J,22,12,588)},m:function(n,r){fe(n,e,r),M(e,t)},p:function(n,r){r&16&&Ce(t,n[4])},d:function(n){n&&P(e)}};return ae("SvelteRegisterBlock",{block:o,id:st.name,type:"if",source:"(22:10) {#if isMuted}",ctx:i}),o}function nt(i){let e,t,o="üéôÔ∏è „É™„Ç¢„É´„Çø„Ç§„É†Èü≥Á®ãÊ§úÂá∫",s,n,r,u,l,a,d,g;function m(y,f){return y[3]?st:tt}let w=m(i),h=w(i);d=new Te({props:{volume:!i[3]&&i[0]>0?i[2]:0,className:"volume-bar"},$$inline:!0});const v={c:function(){e=N("div"),t=N("h3"),t.textContent=o,s=$(),n=N("div"),r=N("div"),u=N("div"),l=N("div"),h.c(),a=$(),Ue(d.$$.fragment),this.h()},l:function(f){e=E(f,"DIV",{class:!0});var b=H(e);t=E(b,"H3",{class:!0,"data-svelte-h":!0}),Pe(t)!=="svelte-1bj87i9"&&(t.textContent=o),b.forEach(P),s=O(f),n=E(f,"DIV",{class:!0});var _=H(n);r=E(_,"DIV",{class:!0});var x=H(r);u=E(x,"DIV",{class:!0});var A=H(u);l=E(A,"DIV",{class:!0});var p=H(l);h.l(p),p.forEach(P),a=O(A),Ke(d.$$.fragment,A),A.forEach(P),x.forEach(P),_.forEach(P),this.h()},h:function(){F(t,"class","section-title svelte-1datf0r"),z(t,J,15,4,360),F(e,"class","card-header svelte-1datf0r"),z(e,J,14,2,330),F(l,"class","detection-card svelte-1datf0r"),z(l,J,20,8,523),F(u,"class","detection-display svelte-1datf0r"),z(u,J,19,6,483),F(r,"class","pitch-detector svelte-1datf0r"),z(r,J,18,4,448),F(n,"class","card-content svelte-1datf0r"),z(n,J,17,2,417)},m:function(f,b){fe(f,e,b),M(e,t),fe(f,s,b),fe(f,n,b),M(n,r),M(r,u),M(u,l),h.m(l,null),M(u,a),Qe(d,u,null),g=!0},p:function(f,b){w===(w=m(f))&&h?h.p(f,b):(h.d(1),h=w(f),h&&(h.c(),h.m(l,null)));const _={};b&13&&(_.volume=!f[3]&&f[0]>0?f[2]:0),d.$set(_)},i:function(f){g||(Ge(d.$$.fragment,f),g=!0)},o:function(f){We(d.$$.fragment,f),g=!1},d:function(f){f&&(P(e),P(s),P(n)),h.d(),Le(d)}};return ae("SvelteRegisterBlock",{block:v,id:nt.name,type:"slot",source:'(14:0) <Card class=\\"main-card {className}\\">',ctx:i}),v}function ke(i){let e,t;e=new et({props:{class:"main-card "+i[5],$$slots:{default:[nt]},$$scope:{ctx:i}},$$inline:!0});const o={c:function(){Ue(e.$$.fragment)},l:function(n){Ke(e.$$.fragment,n)},m:function(n,r){Qe(e,n,r),t=!0},p:function(n,[r]){const u={};r&32&&(u.class="main-card "+n[5]),r&95&&(u.$$scope={dirty:r,ctx:n}),e.$set(u)},i:function(n){t||(Ge(e.$$.fragment,n),t=!0)},o:function(n){We(e.$$.fragment,n),t=!1},d:function(n){Le(e,n)}};return ae("SvelteRegisterBlock",{block:o,id:ke.name,type:"component",source:"",ctx:i}),o}function Pt(i,e,t){let{$$slots:o={},$$scope:s}=e;je("PitchDetectionDisplay",o,[]);let{frequency:n=0}=e,{note:r="„Éº„Éº"}=e,{volume:u=0}=e,{isMuted:l=!1}=e,{muteMessage:a="ÂæÖÊ©ü‰∏≠..."}=e,{className:d=""}=e;const g=["frequency","note","volume","isMuted","muteMessage","className"];return Object.keys(e).forEach(m=>{!~g.indexOf(m)&&m.slice(0,2)!=="$$"&&m!=="slot"&&console.warn(`<PitchDetectionDisplay> was created with unknown prop '${m}'`)}),i.$$set=m=>{"frequency"in m&&t(0,n=m.frequency),"note"in m&&t(1,r=m.note),"volume"in m&&t(2,u=m.volume),"isMuted"in m&&t(3,l=m.isMuted),"muteMessage"in m&&t(4,a=m.muteMessage),"className"in m&&t(5,d=m.className)},i.$capture_state=()=>({Card:et,VolumeBar:Te,frequency:n,note:r,volume:u,isMuted:l,muteMessage:a,className:d}),i.$inject_state=m=>{"frequency"in m&&t(0,n=m.frequency),"note"in m&&t(1,r=m.note),"volume"in m&&t(2,u=m.volume),"isMuted"in m&&t(3,l=m.isMuted),"muteMessage"in m&&t(4,a=m.muteMessage),"className"in m&&t(5,d=m.className)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),[n,r,u,l,a,d]}class It extends He{constructor(e){super(e),Re(this,e,Pt,ke,qe,{frequency:0,note:1,volume:2,isMuted:3,muteMessage:4,className:5}),ae("SvelteRegisterComponent",{component:this,tagName:"PitchDetectionDisplay",options:e,id:ke.name})}get frequency(){throw new Error("<PitchDetectionDisplay>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set frequency(e){throw new Error("<PitchDetectionDisplay>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get note(){throw new Error("<PitchDetectionDisplay>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set note(e){throw new Error("<PitchDetectionDisplay>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get volume(){throw new Error("<PitchDetectionDisplay>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set volume(e){throw new Error("<PitchDetectionDisplay>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get isMuted(){throw new Error("<PitchDetectionDisplay>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set isMuted(e){throw new Error("<PitchDetectionDisplay>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get muteMessage(){throw new Error("<PitchDetectionDisplay>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set muteMessage(e){throw new Error("<PitchDetectionDisplay>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get className(){throw new Error("<PitchDetectionDisplay>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set className(e){throw new Error("<PitchDetectionDisplay>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}export{It as P,Te as V,ye as a,Nt as b,we as h};
