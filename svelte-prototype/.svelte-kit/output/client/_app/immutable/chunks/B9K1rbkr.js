var mt=Object.defineProperty;var ft=(r,e,t)=>e in r?mt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var X=(r,e,t)=>ft(r,typeof e!="symbol"?e+"":e,t);import{S as He,i as je,s as Le,d as le,n as Oe,a as Ge,D as Be,b as P,G as k,z as E,f as we,g as D,h as z,j as N,k as q,m as $,o as F,p as ee,F as gt,a0 as $e,K as et,q as Qe,r as Ke,u as Ue,e as Se,w as Je,l as Pe,A as Ee,x as We,t as xe,y as Xe}from"./CBDdZxR7.js";import{g as vt}from"./D0QH3NT1.js";import"./CmL6UHZb.js";import{C as st}from"./BhW-5LyT.js";function yt(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function U(r){if(this.size=r|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=r<<1;for(var e=new Array(this.size*2),t=0;t<e.length;t+=2){const l=Math.PI*t/this.size;e[t]=Math.cos(l),e[t+1]=-Math.sin(l)}this.table=e;for(var o=0,n=1;this.size>n;n<<=1)o++;this._width=o%2===0?o-1:o,this._bitrev=new Array(1<<this._width);for(var s=0;s<this._bitrev.length;s++){this._bitrev[s]=0;for(var a=0;a<this._width;a+=2){var d=this._width-a-2;this._bitrev[s]|=(s>>>a&3)<<d}}this._out=null,this._data=null,this._inv=0}var wt=U;U.prototype.fromComplexArray=function(e,t){for(var o=t||new Array(e.length>>>1),n=0;n<e.length;n+=2)o[n>>>1]=e[n];return o};U.prototype.createComplexArray=function(){const e=new Array(this._csize);for(var t=0;t<e.length;t++)e[t]=0;return e};U.prototype.toComplexArray=function(e,t){for(var o=t||this.createComplexArray(),n=0;n<o.length;n+=2)o[n]=e[n>>>1],o[n+1]=0;return o};U.prototype.completeSpectrum=function(e){for(var t=this._csize,o=t>>>1,n=2;n<o;n+=2)e[t-n]=e[n],e[t-n+1]=-e[n+1]};U.prototype.transform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=0,this._transform4(),this._out=null,this._data=null};U.prototype.realTransform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=0,this._realTransform4(),this._out=null,this._data=null};U.prototype.inverseTransform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=1,this._transform4();for(var o=0;o<e.length;o++)e[o]/=this.size;this._out=null,this._data=null};U.prototype._transform4=function(){var e=this._out,t=this._csize,o=this._width,n=1<<o,s=t/n<<1,a,d,l=this._bitrev;if(s===4)for(a=0,d=0;a<t;a+=s,d++){const v=l[d];this._singleTransform2(a,v,n)}else for(a=0,d=0;a<t;a+=s,d++){const v=l[d];this._singleTransform4(a,v,n)}var i=this._inv?-1:1,m=this.table;for(n>>=2;n>=2;n>>=2){s=t/n<<1;var g=s>>>2;for(a=0;a<t;a+=s)for(var h=a+g,y=a,u=0;y<h;y+=2,u+=n){const v=y,w=v+g,f=w+g,_=f+g,b=e[v],x=e[v+1],M=e[w],p=e[w+1],S=e[f],C=e[f+1],T=e[_],H=e[_+1],G=b,j=x,Z=m[u],J=i*m[u+1],Q=M*Z-p*J,R=M*J+p*Z,L=m[2*u],ue=i*m[2*u+1],te=S*L-C*ue,ne=S*ue+C*L,se=m[3*u],O=i*m[3*u+1],oe=T*se-H*O,he=T*O+H*se,de=G+te,re=j+ne,ie=G-te,ae=j-ne,me=Q+oe,fe=R+he,c=i*(Q-oe),A=i*(R-he),I=de+me,V=re+fe,B=de-me,ce=re-fe,ve=ie+A,ge=ae-c,Ae=ie-A,De=ae+c;e[v]=I,e[v+1]=V,e[w]=ve,e[w+1]=ge,e[f]=B,e[f+1]=ce,e[_]=Ae,e[_+1]=De}}};U.prototype._singleTransform2=function(e,t,o){const n=this._out,s=this._data,a=s[t],d=s[t+1],l=s[t+o],i=s[t+o+1],m=a+l,g=d+i,h=a-l,y=d-i;n[e]=m,n[e+1]=g,n[e+2]=h,n[e+3]=y};U.prototype._singleTransform4=function(e,t,o){const n=this._out,s=this._data,a=this._inv?-1:1,d=o*2,l=o*3,i=s[t],m=s[t+1],g=s[t+o],h=s[t+o+1],y=s[t+d],u=s[t+d+1],v=s[t+l],w=s[t+l+1],f=i+y,_=m+u,b=i-y,x=m-u,M=g+v,p=h+w,S=a*(g-v),C=a*(h-w),T=f+M,H=_+p,G=b+C,j=x-S,Z=f-M,J=_-p,Q=b-C,R=x+S;n[e]=T,n[e+1]=H,n[e+2]=G,n[e+3]=j,n[e+4]=Z,n[e+5]=J,n[e+6]=Q,n[e+7]=R};U.prototype._realTransform4=function(){var e=this._out,t=this._csize,o=this._width,n=1<<o,s=t/n<<1,a,d,l=this._bitrev;if(s===4)for(a=0,d=0;a<t;a+=s,d++){const Ve=l[d];this._singleRealTransform2(a,Ve>>>1,n>>>1)}else for(a=0,d=0;a<t;a+=s,d++){const Ve=l[d];this._singleRealTransform4(a,Ve>>>1,n>>>1)}var i=this._inv?-1:1,m=this.table;for(n>>=2;n>=2;n>>=2){s=t/n<<1;var g=s>>>1,h=g>>>1,y=h>>>1;for(a=0;a<t;a+=s)for(var u=0,v=0;u<=y;u+=2,v+=n){var w=a+u,f=w+h,_=f+h,b=_+h,x=e[w],M=e[w+1],p=e[f],S=e[f+1],C=e[_],T=e[_+1],H=e[b],G=e[b+1],j=x,Z=M,J=m[v],Q=i*m[v+1],R=p*J-S*Q,L=p*Q+S*J,ue=m[2*v],te=i*m[2*v+1],ne=C*ue-T*te,se=C*te+T*ue,O=m[3*v],oe=i*m[3*v+1],he=H*O-G*oe,de=H*oe+G*O,re=j+ne,ie=Z+se,ae=j-ne,me=Z-se,fe=R+he,c=L+de,A=i*(R-he),I=i*(L-de),V=re+fe,B=ie+c,ce=ae+I,ve=me-A;if(e[w]=V,e[w+1]=B,e[f]=ce,e[f+1]=ve,u===0){var ge=re-fe,Ae=ie-c;e[_]=ge,e[_+1]=Ae;continue}if(u!==y){var De=ae,_e=-me,Te=re,Ne=-ie,Fe=-i*I,W=-i*A,Me=-i*c,ct=-i*fe,lt=De+Fe,ut=_e+W,ht=Te+ct,dt=Ne-Me,Ye=a+h-u,Ze=a+g-u;e[Ye]=lt,e[Ye+1]=ut,e[Ze]=ht,e[Ze+1]=dt}}}};U.prototype._singleRealTransform2=function(e,t,o){const n=this._out,s=this._data,a=s[t],d=s[t+o],l=a+d,i=a-d;n[e]=l,n[e+1]=0,n[e+2]=i,n[e+3]=0};U.prototype._singleRealTransform4=function(e,t,o){const n=this._out,s=this._data,a=this._inv?-1:1,d=o*2,l=o*3,i=s[t],m=s[t+o],g=s[t+d],h=s[t+l],y=i+g,u=i-g,v=m+h,w=a*(m-h),f=y+v,_=u,b=-w,x=y-v,M=u,p=w;n[e]=f,n[e+1]=0,n[e+2]=_,n[e+3]=b,n[e+4]=x,n[e+5]=0,n[e+6]=M,n[e+7]=p};const _t=yt(wt);class Ce{constructor(e,t){X(this,"_inputLength");X(this,"_fft");X(this,"_bufferSupplier");X(this,"_paddedInputBuffer");X(this,"_transformBuffer");X(this,"_inverseBuffer");if(e<1)throw new Error("Input length must be at least one");this._inputLength=e,this._fft=new _t(At(2*e)),this._bufferSupplier=t,this._paddedInputBuffer=this._bufferSupplier(this._fft.size),this._transformBuffer=this._bufferSupplier(2*this._fft.size),this._inverseBuffer=this._bufferSupplier(2*this._fft.size)}static forFloat32Array(e){return new Ce(e,t=>new Float32Array(t))}static forFloat64Array(e){return new Ce(e,t=>new Float64Array(t))}static forNumberArray(e){return new Ce(e,t=>Array(t))}get inputLength(){return this._inputLength}autocorrelate(e,t=this._bufferSupplier(e.length)){if(e.length!==this._inputLength)throw new Error(`Input must have length ${this._inputLength} but had length ${e.length}`);for(let n=0;n<e.length;n++)this._paddedInputBuffer[n]=e[n];for(let n=e.length;n<this._paddedInputBuffer.length;n++)this._paddedInputBuffer[n]=0;this._fft.realTransform(this._transformBuffer,this._paddedInputBuffer),this._fft.completeSpectrum(this._transformBuffer);const o=this._transformBuffer;for(let n=0;n<o.length;n+=2)o[n]=o[n]*o[n]+o[n+1]*o[n+1],o[n+1]=0;this._fft.inverseTransform(this._inverseBuffer,this._transformBuffer);for(let n=0;n<e.length;n++)t[n]=this._inverseBuffer[2*n];return t}}function bt(r){const e=[];let t=!1,o=-1/0,n=-1;for(let s=1;s<r.length-1;s++)r[s-1]<=0&&r[s]>0?(t=!0,n=s,o=r[s]):r[s-1]>0&&r[s]<=0?(t=!1,n!==-1&&e.push(n)):t&&r[s]>o&&(o=r[s],n=s);return e}function pt(r,e){const[t,o,n]=[r-1,r,r+1],[s,a,d]=[e[t],e[o],e[n]],l=s/2-a+d/2,i=-(s/2)*(o+n)+a*(t+n)-d/2*(t+o),m=s*o*n/2-a*t*n+d*t*o/2,g=-i/(2*l),h=l*g*g+i*g+m;return[g,h]}class pe{constructor(e,t){X(this,"_autocorrelator");X(this,"_nsdfBuffer");X(this,"_clarityThreshold",.9);X(this,"_minVolumeAbsolute",0);X(this,"_maxInputAmplitude",1);this._autocorrelator=new Ce(e,t),this._nsdfBuffer=t(e)}static forFloat32Array(e){return new pe(e,t=>new Float32Array(t))}static forFloat64Array(e){return new pe(e,t=>new Float64Array(t))}static forNumberArray(e){return new pe(e,t=>Array(t))}get inputLength(){return this._autocorrelator.inputLength}set clarityThreshold(e){if(!Number.isFinite(e)||e<=0||e>1)throw new Error("clarityThreshold must be a number in the range (0, 1]");this._clarityThreshold=e}set minVolumeAbsolute(e){if(!Number.isFinite(e)||e<0||e>this._maxInputAmplitude)throw new Error(`minVolumeAbsolute must be a number in the range [0, ${this._maxInputAmplitude}]`);this._minVolumeAbsolute=e}set minVolumeDecibels(e){if(!Number.isFinite(e)||e>0)throw new Error("minVolumeDecibels must be a number <= 0");this._minVolumeAbsolute=this._maxInputAmplitude*10**(e/10)}set maxInputAmplitude(e){if(!Number.isFinite(e)||e<=0)throw new Error("maxInputAmplitude must be a number > 0");this._maxInputAmplitude=e}findPitch(e,t){if(this._belowMinimumVolume(e))return[0,0];this._nsdf(e);const o=bt(this._nsdfBuffer);if(o.length===0)return[0,0];const n=Math.max(...o.map(l=>this._nsdfBuffer[l])),s=o.find(l=>this._nsdfBuffer[l]>=this._clarityThreshold*n),[a,d]=pt(s,this._nsdfBuffer);return[t/a,Math.min(d,1)]}_belowMinimumVolume(e){if(this._minVolumeAbsolute===0)return!1;let t=0;for(let o=0;o<e.length;o++)t+=e[o]**2;return Math.sqrt(t/e.length)<this._minVolumeAbsolute}_nsdf(e){this._autocorrelator.autocorrelate(e,this._nsdfBuffer);let t=2*this._nsdfBuffer[0],o;for(o=0;o<this._nsdfBuffer.length&&t>0;o++)this._nsdfBuffer[o]=2*this._nsdfBuffer[o]/t,t-=e[o]**2+e[e.length-o-1]**2;for(;o<this._nsdfBuffer.length;o++)this._nsdfBuffer[o]=0}}function At(r){return r--,r|=r>>1,r|=r>>2,r|=r>>4,r|=r>>8,r|=r>>16,r++,r}const Ie="src/lib/components/VolumeBar.svelte";function ke(r){let e,t,o,n,s,a;const d={c:function(){e=F("div"),t=F("div"),o=F("div"),n=ee(),s=F("div"),this.h()},l:function(i){e=N(i,"DIV",{class:!0});var m=q(e);t=N(m,"DIV",{class:!0,style:!0});var g=q(t);o=N(g,"DIV",{class:!0,style:!0}),q(o).forEach(P),g.forEach(P),n=$(m),s=N(m,"DIV",{class:!0,style:!0}),q(s).forEach(P),m.forEach(P),this.h()},h:function(){E(o,"class","volume-bar-fill"),k(o,"position","absolute"),k(o,"top","0"),k(o,"left","0"),k(o,"height","100%"),z(o,Ie,51,4,1464),E(t,"class","volume-bar-bg"),k(t,"height",r[1]),k(t,"border-radius","9999px"),k(t,"background-color","#e2e8f0"),k(t,"position","relative"),k(t,"overflow","hidden"),z(t,Ie,50,2,1318),E(s,"class","threshold-indicator svelte-13z7ppf"),k(s,"position","absolute"),k(s,"top","0"),k(s,"left",r[0]+"%"),k(s,"width","2px"),k(s,"height",r[1]),k(s,"background-color","#64748b"),k(s,"border-radius","1px"),z(s,Ie,59,2,1643),E(e,"class",a="volume-bar-container "+r[2]+" svelte-13z7ppf"),z(e,Ie,49,0,1269)},m:function(i,m){we(i,e,m),D(e,t),D(t,o),r[5](o),D(e,n),D(e,s)},p:function(i,[m]){m&2&&k(t,"height",i[1]),m&1&&k(s,"left",i[0]+"%"),m&2&&k(s,"height",i[1]),m&4&&a!==(a="volume-bar-container "+i[2]+" svelte-13z7ppf")&&E(e,"class",a)},i:Oe,o:Oe,d:function(i){i&&P(e),r[5](null)}};return le("SvelteRegisterBlock",{block:d,id:ke.name,type:"component",source:"",ctx:r}),d}function Dt(r,e,t){let{$$slots:o={},$$scope:n}=e;Ge("VolumeBar",o,[]);let{volume:s=0}=e,{threshold:a=30}=e,{height:d="12px"}=e,{className:l=""}=e,i;function m(u){return u<a?`rgba(37, 99, 235, ${Math.max(.2,u/a*.8)})`:"#2563eb"}function g(u){if(i){const v=Math.max(0,Math.min(100,u)),w=m(v);t(3,i.style.width=`${v}%`,i),t(3,i.style.backgroundColor=w,i)}}Be(()=>{i&&(t(3,i.style.width="0%",i),t(3,i.style.backgroundColor="#2563eb",i),t(3,i.style.height=d,i),t(3,i.style.borderRadius="9999px",i),t(3,i.style.transition="width 0.2s ease-out, background-color 0.2s ease-out",i))});const h=["volume","threshold","height","className"];Object.keys(e).forEach(u=>{!~h.indexOf(u)&&u.slice(0,2)!=="$$"&&u!=="slot"&&console.warn(`<VolumeBar> was created with unknown prop '${u}'`)});function y(u){gt[u?"unshift":"push"](()=>{i=u,t(3,i)})}return r.$$set=u=>{"volume"in u&&t(4,s=u.volume),"threshold"in u&&t(0,a=u.threshold),"height"in u&&t(1,d=u.height),"className"in u&&t(2,l=u.className)},r.$capture_state=()=>({onMount:Be,volume:s,threshold:a,height:d,className:l,barElement:i,getVolumeColor:m,updateVolumeBar:g}),r.$inject_state=u=>{"volume"in u&&t(4,s=u.volume),"threshold"in u&&t(0,a=u.threshold),"height"in u&&t(1,d=u.height),"className"in u&&t(2,l=u.className),"barElement"in u&&t(3,i=u.barElement)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),r.$$.update=()=>{r.$$.dirty&16&&g(s)},[a,d,l,i,s,y]}class ze extends He{constructor(e){super(e),je(this,e,Dt,ke,Le,{volume:4,threshold:0,height:1,className:2}),le("SvelteRegisterComponent",{component:this,tagName:"VolumeBar",options:e,id:ke.name})}get volume(){throw new Error("<VolumeBar>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set volume(e){throw new Error("<VolumeBar>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get threshold(){throw new Error("<VolumeBar>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set threshold(e){throw new Error("<VolumeBar>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get height(){throw new Error("<VolumeBar>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set height(e){throw new Error("<VolumeBar>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get className(){throw new Error("<VolumeBar>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set className(e){throw new Error("<VolumeBar>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}class Mt{constructor(){this.audioContext=null,this.mediaStream=null,this.sourceNode=null,this.analysers=new Map,this.filters=new Map,this.refCount=0,this.initPromise=null,this.isInitialized=!1,this.lastError=null}async initialize(){var e,t,o;if(this.initPromise)return this.initPromise;if(this.isInitialized&&this.audioContext&&this.mediaStream){const n=this.checkMediaStreamHealth();if(n.healthy)return this.refCount++,{audioContext:this.audioContext,mediaStream:this.mediaStream,sourceNode:this.sourceNode};console.warn("‚ö†Ô∏è [AudioManager] MediaStream‰∏çÂÅ•Â∫∑Ê§úÂá∫ - Âº∑Âà∂ÂÜçÂàùÊúüÂåñ:",n.reason),console.log("üîÑ [AudioManager] ‰∏çÂÅ•Â∫∑„Å™MediaStreamË©≥Á¥∞:",{mediaStreamActive:(e=this.mediaStream)==null?void 0:e.active,trackCount:(t=this.mediaStream)==null?void 0:t.getTracks().length,trackStates:(o=this.mediaStream)==null?void 0:o.getTracks().map(s=>({kind:s.kind,readyState:s.readyState,enabled:s.enabled,muted:s.muted}))}),this._cleanup(),this.isInitialized=!1,this.refCount=0,await new Promise(s=>setTimeout(s,100)),console.log("üîÑ [AudioManager] „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÂÆå‰∫Ü - ÂÜçÂàùÊúüÂåñÈñãÂßã")}this.initPromise=this._doInitialize();try{const n=await this.initPromise;return this.initPromise=null,n}catch(n){throw this.initPromise=null,n}}async _doInitialize(){try{if(console.log("üé§ [AudioManager] ÂàùÊúüÂåñÈñãÂßã"),this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext),console.log("‚úÖ [AudioManager] AudioContext‰ΩúÊàêÂÆå‰∫Ü")),this.audioContext.state==="suspended"&&(await this.audioContext.resume(),console.log("‚úÖ [AudioManager] AudioContextÂÜçÈñãÂÆå‰∫Ü")),!this.mediaStream){const e={audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,sampleRate:44100,channelCount:1,sampleSize:16,latency:.1,volume:1,deviceId:{ideal:"default"}}};console.log("üé§ [AudioManager] SafariÂØæÂøúË®≠ÂÆö„ÅßMediaStreamÂèñÂæó‰∏≠:",e),this.mediaStream=await navigator.mediaDevices.getUserMedia(e),console.log("‚úÖ [AudioManager] MediaStreamÂèñÂæóÂÆå‰∫Ü")}if(!this.sourceNode){this.sourceNode=this.audioContext.createMediaStreamSource(this.mediaStream),console.log("‚úÖ [AudioManager] SourceNode‰ΩúÊàêÂÆå‰∫Ü");const e=this.mediaStream.getTracks();console.log("üé§ [AudioManager] MediaStream tracks:",e.map(t=>({kind:t.kind,label:t.label,enabled:t.enabled,readyState:t.readyState,muted:t.muted})))}return this.isInitialized=!0,this.refCount++,this.lastError=null,console.log(`üé§ [AudioManager] ÂàùÊúüÂåñÂÆå‰∫Ü (ÂèÇÁÖß„Ç´„Ç¶„É≥„Éà: ${this.refCount})`),{audioContext:this.audioContext,mediaStream:this.mediaStream,sourceNode:this.sourceNode}}catch(e){throw console.error("‚ùå [AudioManager] ÂàùÊúüÂåñ„Ç®„É©„Éº:",e),this.lastError=e,this.isInitialized=!1,this._cleanup(),e}}createAnalyser(e,t={}){if(!this.isInitialized||!this.audioContext||!this.sourceNode)throw new Error("AudioManager not initialized. Call initialize() first.");this.removeAnalyser(e);const{fftSize:o=2048,smoothingTimeConstant:n=.8,minDecibels:s=-90,maxDecibels:a=-10,useFilters:d=!0}=t,l=this.audioContext.createAnalyser();if(l.fftSize=Math.min(o,2048),l.smoothingTimeConstant=Math.max(n,.7),l.minDecibels=Math.max(s,-80),l.maxDecibels=Math.min(a,-10),this.sourceNode,d){const i=this._createFilterChain();this.filters.set(e,i),this.sourceNode.connect(i.highpass),i.highpass.connect(i.lowpass),i.lowpass.connect(i.notch),i.notch.connect(l),console.log(`üîß [AudioManager] „Éï„Ç£„É´„Çø„Éº‰ªò„ÅçAnalyser‰ΩúÊàê: ${e}`)}else this.sourceNode.connect(l),console.log(`üîß [AudioManager] Áîü‰ø°Âè∑Analyser‰ΩúÊàê: ${e}`);return this.analysers.set(e,l),l}_createFilterChain(){const e=this.audioContext.createBiquadFilter();e.type="highpass",e.frequency.setValueAtTime(80,this.audioContext.currentTime),e.Q.setValueAtTime(.7,this.audioContext.currentTime);const t=this.audioContext.createBiquadFilter();t.type="lowpass",t.frequency.setValueAtTime(800,this.audioContext.currentTime),t.Q.setValueAtTime(.7,this.audioContext.currentTime);const o=this.audioContext.createBiquadFilter();return o.type="notch",o.frequency.setValueAtTime(60,this.audioContext.currentTime),o.Q.setValueAtTime(10,this.audioContext.currentTime),{highpass:e,lowpass:t,notch:o}}removeAnalyser(e){if(this.analysers.has(e)&&(this.analysers.get(e).disconnect(),this.analysers.delete(e),console.log(`üóëÔ∏è [AudioManager] AnalyserÂâäÈô§: ${e}`)),this.filters.has(e)){const t=this.filters.get(e);t.highpass.disconnect(),t.lowpass.disconnect(),t.notch.disconnect(),this.filters.delete(e),console.log(`üóëÔ∏è [AudioManager] „Éï„Ç£„É´„Çø„Éº„ÉÅ„Çß„Éº„É≥ÂâäÈô§: ${e}`)}}release(e=[]){e.forEach(t=>this.removeAnalyser(t)),this.refCount=Math.max(0,this.refCount-1),console.log(`üìâ [AudioManager] ÂèÇÁÖß„Ç´„Ç¶„É≥„ÉàÊ∏õÁÆó: ${this.refCount}`),this.refCount<=0&&(console.log("üßπ [AudioManager] ÂÖ®„É™„ÇΩ„Éº„Çπ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÈñãÂßã"),this._cleanup())}forceCleanup(){console.log("üö® [AudioManager] Âº∑Âà∂„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÂÆüË°å"),this._cleanup()}_cleanup(){console.log("üßπ [AudioManager] „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÈñãÂßã");for(const e of this.analysers.keys())this.removeAnalyser(e);if(this.mediaStream){const e=this.mediaStream.getTracks();console.log(`üõë [AudioManager] MediaStreamÂÅúÊ≠¢‰∏≠: ${e.length} tracks`),e.forEach((t,o)=>{try{t.readyState!=="ended"?(t.stop(),console.log(`üõë [AudioManager] Track ${o} ÂÅúÊ≠¢ÂÆå‰∫Ü`)):console.log(`‚ö†Ô∏è [AudioManager] Track ${o} Êó¢„Å´ÁµÇ‰∫ÜÊ∏à„Åø`)}catch(n){console.warn(`‚ö†Ô∏è [AudioManager] Track ${o} ÂÅúÊ≠¢„Ç®„É©„Éº:`,n)}}),this.mediaStream=null}if(this.audioContext&&this.audioContext.state!=="closed"){try{this.audioContext.close(),console.log("üõë [AudioManager] AudioContextÈñâÈéñÂÆå‰∫Ü")}catch(e){console.warn("‚ö†Ô∏è [AudioManager] AudioContextÈñâÈéñ„Ç®„É©„Éº:",e)}this.audioContext=null}this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=null),this.isInitialized=!1,this.refCount=0,this.initPromise=null,console.log("‚úÖ [AudioManager] „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÂÆå‰∫Ü")}getStatus(){var e,t;return{isInitialized:this.isInitialized,refCount:this.refCount,audioContextState:((e=this.audioContext)==null?void 0:e.state)||"none",mediaStreamActive:((t=this.mediaStream)==null?void 0:t.active)||!1,activeAnalysers:Array.from(this.analysers.keys()),activeFilters:Array.from(this.filters.keys()),lastError:this.lastError}}checkMediaStreamHealth(){if(!this.mediaStream)return{healthy:!1,reason:"MediaStream not initialized"};if(!this.mediaStream.active)return{healthy:!1,reason:"MediaStream inactive"};const e=this.mediaStream.getTracks();if(e.length===0)return{healthy:!1,reason:"No tracks available"};const t=e.find(o=>o.kind==="audio");return t?t.readyState==="ended"?{healthy:!1,reason:"Audio track ended"}:t.enabled?t.muted?{healthy:!1,reason:"Audio track muted"}:this.mediaStream.active&&t.readyState!=="live"?{healthy:!1,reason:"Track state inconsistent with MediaStream"}:{healthy:!0,track:t}:{healthy:!1,reason:"Audio track disabled"}:{healthy:!1,reason:"No audio track found"}}}const be=new Mt;typeof window<"u"&&(window.audioManager=be);const{Error:K,console:Ct}=vt,ye="src/lib/components/PitchDetector.svelte";function Re(r){let e,t,o,n,s=(r[2]>0?Math.round(r[2]):"---")+"",a,d,l,i="Hz",m,g,h="|",y,u,v,w,f,_,b;f=new ze({props:{volume:r[2]>0?r[1]:0,className:"volume-bar"},$$inline:!0});const x={c:function(){e=F("div"),t=F("div"),o=F("div"),n=F("span"),a=xe(s),d=ee(),l=F("span"),l.textContent=i,m=ee(),g=F("span"),g.textContent=h,y=ee(),u=F("span"),v=xe(r[3]),w=ee(),Xe(f.$$.fragment),this.h()},l:function(p){e=N(p,"DIV",{class:!0});var S=q(e);t=N(S,"DIV",{class:!0});var C=q(t);o=N(C,"DIV",{class:!0});var T=q(o);n=N(T,"SPAN",{class:!0});var H=q(n);a=Pe(H,s),H.forEach(P),d=$(T),l=N(T,"SPAN",{class:!0,"data-svelte-h":!0}),Ee(l)!=="svelte-5uyilv"&&(l.textContent=i),m=$(T),g=N(T,"SPAN",{class:!0,"data-svelte-h":!0}),Ee(g)!=="svelte-1dytxz4"&&(g.textContent=h),y=$(T),u=N(T,"SPAN",{class:!0});var G=q(u);v=Pe(G,r[3]),G.forEach(P),T.forEach(P),w=$(C),We(f.$$.fragment,C),C.forEach(P),S.forEach(P),this.h()},h:function(){E(n,"class","detected-frequency svelte-vc1bho"),z(n,ye,595,6,17375),E(l,"class","hz-suffix svelte-vc1bho"),z(l,ye,596,6,17483),E(g,"class","divider svelte-vc1bho"),z(g,ye,597,6,17523),E(u,"class","detected-note svelte-vc1bho"),z(u,ye,598,6,17560),E(o,"class","detection-card svelte-vc1bho"),z(o,ye,594,4,17340),E(t,"class","detection-display svelte-vc1bho"),z(t,ye,593,2,17304),E(e,"class",_="pitch-detector "+r[0]+" svelte-vc1bho"),z(e,ye,592,0,17261)},m:function(p,S){we(p,e,S),D(e,t),D(t,o),D(o,n),D(n,a),D(o,d),D(o,l),D(o,m),D(o,g),D(o,y),D(o,u),D(u,v),D(t,w),Je(f,t,null),b=!0},p:function(p,S){(!b||S[0]&4)&&s!==(s=(p[2]>0?Math.round(p[2]):"---")+"")&&Se(a,s),(!b||S[0]&8)&&Se(v,p[3]);const C={};S[0]&6&&(C.volume=p[2]>0?p[1]:0),f.$set(C),(!b||S[0]&1&&_!==(_="pitch-detector "+p[0]+" svelte-vc1bho"))&&E(e,"class",_)},i:function(p){b||(Ue(f.$$.fragment,p),b=!0)},o:function(p){Ke(f.$$.fragment,p),b=!1},d:function(p){p&&P(e),Qe(f)}};return le("SvelteRegisterBlock",{block:x,id:Re.name,type:"component",source:"",ctx:r}),x}function ot(r){const t=Math.log2(r/261.63)*12,o=Math.round(t),n=Math.abs(t-o);return Math.max(0,1-n/.5)}function tt(r,e){const t=[r,r/2,r/3,r/4,r*2],o=130.81,n=1046.5,s=l=>{const m=l>=o&&l<=n?1:0,g=e>0?1-Math.min(Math.abs(l-e)/e,1):.5,h=ot(l),y=m*.4+g*.4+h*.2;return{freq:l,score:y}};return t.map(s).reduce((l,i)=>i.score>l.score?i:l).freq}function nt(r){const e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];if(r<=0)return"„Éº„Éº";const o=Math.round(12*Math.log2(r/440)),n=(o+9+120)%12,s=Math.floor((o+9)/12)+4;return e[n]+s}function St(r,e,t){let{$$slots:o={},$$scope:n}=e;Ge("PitchDetector",o,[]);const s=$e();let{isActive:a=!1}=e,{className:d=""}=e,{debugMode:l=!1}=e,i="uninitialized",m=null,g=!1,h=null,y=null,u=null,v=null,w=null,f=null,_=null,b=!1,x=[],M=new Map,p=0,S=0,C=0,T="„Éº„Éº",H=0,G=[],j=[],Z=0,J=0,Q=0,R=[],L=null;function ue(){p=0,t(1,S=0),t(2,C=0),t(3,T="„Éº„Éº"),H=0,Z=0,J=0,Q=0,G=[],j=[],R=[],l&&console.log("üîÑ [PitchDetector] Display state reset")}function te(){if(!l)return;const c=new Date().toLocaleTimeString(),A={timestamp:c,componentState:i,isActive:a,isDetecting:b,isInitialized:g,mediaStreamActive:y?y.active:null,mediaStreamTracks:y?y.getTracks().length:0,trackStates:y?y.getTracks().map(B=>({kind:B.kind,enabled:B.enabled,readyState:B.readyState,muted:B.muted})):[],audioContextState:h?h.state:null,hasAnalyser:!!v,currentVolume:p,currentFrequency:C};console.log(`üé§ [PitchDetector] ${c}:`,A);let I=!0,V=[];y&&!y.active&&(console.warn("‚ö†Ô∏è [PitchDetector] MediaStream is inactive!",y),I=!1,V.push("MediaStream inactive")),h&&h.state==="suspended"&&(console.warn("‚ö†Ô∏è [PitchDetector] AudioContext is suspended!",h),I=!1,V.push("AudioContext suspended")),y&&y.getTracks().forEach((B,ce)=>{B.readyState==="ended"&&(console.error(`‚ùå [PitchDetector] Track ${ce} has ended!`,B),I=!1,V.push(`Track ${ce} ended`))}),s("microphoneHealthChange",{healthy:I,errors:V,details:A})}async function ne(){try{t(14,i="initializing"),m=null,console.log("üéôÔ∏è [PitchDetector] AudioManagerÁµåÁî±„ÅßÂàùÊúüÂåñÈñãÂßã");const c=await be.initialize();h=c.audioContext,y=c.mediaStream,u=c.sourceNode,console.log("‚úÖ [PitchDetector] AudioManager „É™„ÇΩ„Éº„ÇπÂèñÂæóÂÆå‰∫Ü");const A=`pitch-detector-filtered-${Date.now()}`;t(15,v=be.createAnalyser(A,{fftSize:2048,smoothingTimeConstant:.8,minDecibels:-90,maxDecibels:-10,useFilters:!0})),x.push(A);const I=`pitch-detector-raw-${Date.now()}`;w=be.createAnalyser(I,{fftSize:2048,smoothingTimeConstant:.8,minDecibels:-90,maxDecibels:-10,useFilters:!1}),x.push(I),console.log("‚úÖ [PitchDetector] Analyser‰ΩúÊàêÂÆå‰∫Ü:",x),f=pe.forFloat32Array(v.fftSize),t(14,i="ready"),g=!0,s("stateChange",{state:i}),me(),console.log("‚úÖ [PitchDetector] ÂàùÊúüÂåñÂÆå‰∫Ü")}catch(c){throw console.error("‚ùå [PitchDetector] ÂàùÊúüÂåñ„Ç®„É©„Éº:",c),t(14,i="error"),m=c,g=!1,s("error",{error:c,context:"initialization"}),c}}function se(){if(i!=="ready"){const c=new Error(`Cannot start detection: component state is ${i}`);return s("error",{error:c,context:"start-detection"}),!1}if(!v||!f||!h){const c=new Error("Required components not available");return t(14,i="error"),s("error",{error:c,context:"start-detection"}),!1}return t(14,i="detecting"),t(16,b=!0),s("stateChange",{state:i}),oe(),!0}function O(){t(16,b=!1),_&&(cancelAnimationFrame(_),_=null),i==="detecting"&&g&&(t(14,i="ready"),s("stateChange",{state:i}))}function oe(){if(!b||!v||!w||!f)return;const c=v.fftSize,A=new Float32Array(c),I=new Float32Array(w.fftSize);v.getFloatTimeDomainData(A),w.getFloatTimeDomainData(I);let V=0;for(let W=0;W<c;W++)V+=Math.abs(A[W]);const B=Math.sqrt(V/c),ce=Math.log10(B+.001)*50+100,ve=Math.max(0,Math.min(100,ce));let ge=0;for(let W=0;W<I.length;W++)ge+=Math.abs(I[W]);const Ae=Math.sqrt(ge/I.length),De=Math.log10(Ae+.001)*50+100;t(1,S=Math.max(0,Math.min(100,De))),j.push(ve),j.length>5&&j.shift(),J=j.reduce((W,Me)=>W+Me,0)/j.length,p=J;const[_e,Te]=f.findPitch(A,h.sampleRate),Ne=_e>=65&&_e<=1200;if(_e&&Te>.6&&p>10&&Ne){const W=tt(_e,Q),Me=he(W);t(2,C=Math.round(Me)),t(3,T=nt(C)),H=Te,Q=C}else R.length>0&&(R=[]),C===0&&(Q=0),t(2,C=0),t(3,T="„Éº„Éº"),H=0;const Fe=C>0?S:0;s("pitchUpdate",{frequency:C,note:T,volume:p,rawVolume:Fe,clarity:H}),_=requestAnimationFrame(oe)}function he(c,A=.1){R.push(c),R.length>5&&R.shift();const I=[...R].sort((ve,ge)=>ve-ge),V=I[Math.floor(I.length/2)],B=V*A;return Math.abs(c-V)>B?V+Math.sign(c-V)*B:c}function de(){return g&&i==="ready"}function re(){return{componentState:i,isInitialized:g,isDetecting:b,lastError:m,hasRequiredComponents:!!(v&&f&&h&&y)}}async function ie(){console.log("üîÑ [PitchDetector] ÂÜçÂàùÊúüÂåñÈñãÂßã"),ae(),await new Promise(c=>setTimeout(c,100)),await ne(),console.log("‚úÖ [PitchDetector] ÂÜçÂàùÊúüÂåñÂÆå‰∫Ü")}function ae(){console.log("üßπ [PitchDetector] „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÈñãÂßã"),O(),M.size>0&&(M.forEach((c,A)=>{A.removeEventListener("ended",c.endedHandler),A.removeEventListener("mute",c.muteHandler),A.removeEventListener("unmute",c.unmuteHandler)}),M.clear(),console.log("üîÑ [PitchDetector] MediaStream„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºÂâäÈô§")),x.length>0&&(be.release(x),console.log("üì§ [PitchDetector] AudioManager„Å´AnalyserËß£ÊîæÈÄöÁü•:",x),x=[]),t(14,i="uninitialized"),g=!1,m=null,h=null,y=null,u=null,t(15,v=null),w=null,f=null,G=[],j=[],R=[],console.log("‚úÖ [PitchDetector] „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÂÆå‰∫Ü")}function me(){if(!y)return;const c=y.getTracks();c.forEach(A=>{const I=()=>{console.error("üö® [PitchDetector] MediaStreamTrackÁµÇ‰∫ÜÊ§úÂá∫:",A.kind),t(14,i="error"),m=new Error(`MediaStreamTrack (${A.kind}) ended`),s("error",{error:m,reason:"mediastream_ended",recovery:"restart_required"}),b&&O()},V=()=>{console.warn("‚ö†Ô∏è [PitchDetector] MediaStreamTrack muted:",A.kind),s("warning",{reason:"track_muted",track:A.kind})},B=()=>{console.log("‚úÖ [PitchDetector] MediaStreamTrack unmuted:",A.kind),s("info",{reason:"track_unmuted",track:A.kind})};A.addEventListener("ended",I),A.addEventListener("mute",V),A.addEventListener("unmute",B),M.set(A,{endedHandler:I,muteHandler:V,unmuteHandler:B})}),console.log("üîç [PitchDetector] MediaStreamÁõ£Ë¶ñÈñãÂßã:",c.length+" tracks")}et(()=>{L&&(clearInterval(L),t(17,L=null)),console.log("üîÑ [PitchDetector] onDestroy - AudioManager„É™„ÇΩ„Éº„Çπ„ÅØ‰øùÊåÅ")});const fe=["isActive","className","debugMode"];return Object.keys(e).forEach(c=>{!~fe.indexOf(c)&&c.slice(0,2)!=="$$"&&c!=="slot"&&Ct.warn(`<PitchDetector> was created with unknown prop '${c}'`)}),r.$$set=c=>{"isActive"in c&&t(4,a=c.isActive),"className"in c&&t(0,d=c.className),"debugMode"in c&&t(5,l=c.debugMode)},r.$capture_state=()=>({onMount:Be,onDestroy:et,createEventDispatcher:$e,PitchDetector:pe,VolumeBar:ze,audioManager:be,dispatch:s,isActive:a,className:d,debugMode:l,componentState:i,lastError:m,isInitialized:g,audioContext:h,mediaStream:y,sourceNode:u,analyser:v,rawAnalyser:w,pitchDetector:f,animationFrame:_,isDetecting:b,analyserIds:x,mediaStreamListeners:M,currentVolume:p,rawVolume:S,currentFrequency:C,detectedNote:T,pitchClarity:H,frequencyHistory:G,volumeHistory:j,stableFrequency:Z,stableVolume:J,previousFrequency:Q,harmonicHistory:R,debugInterval:L,resetDisplayState:ue,checkMicrophoneStatus:te,initialize:ne,startDetection:se,stopDetection:O,detectPitch:oe,calculateMusicalScore:ot,correctHarmonicFrequency:tt,stabilizeFrequency:he,frequencyToNote:nt,getIsInitialized:de,getState:re,reinitialize:ie,cleanup:ae,setupMediaStreamMonitoring:me}),r.$inject_state=c=>{"isActive"in c&&t(4,a=c.isActive),"className"in c&&t(0,d=c.className),"debugMode"in c&&t(5,l=c.debugMode),"componentState"in c&&t(14,i=c.componentState),"lastError"in c&&(m=c.lastError),"isInitialized"in c&&(g=c.isInitialized),"audioContext"in c&&(h=c.audioContext),"mediaStream"in c&&(y=c.mediaStream),"sourceNode"in c&&(u=c.sourceNode),"analyser"in c&&t(15,v=c.analyser),"rawAnalyser"in c&&(w=c.rawAnalyser),"pitchDetector"in c&&(f=c.pitchDetector),"animationFrame"in c&&(_=c.animationFrame),"isDetecting"in c&&t(16,b=c.isDetecting),"analyserIds"in c&&(x=c.analyserIds),"mediaStreamListeners"in c&&(M=c.mediaStreamListeners),"currentVolume"in c&&(p=c.currentVolume),"rawVolume"in c&&t(1,S=c.rawVolume),"currentFrequency"in c&&t(2,C=c.currentFrequency),"detectedNote"in c&&t(3,T=c.detectedNote),"pitchClarity"in c&&(H=c.pitchClarity),"frequencyHistory"in c&&(G=c.frequencyHistory),"volumeHistory"in c&&(j=c.volumeHistory),"stableFrequency"in c&&(Z=c.stableFrequency),"stableVolume"in c&&(J=c.stableVolume),"previousFrequency"in c&&(Q=c.previousFrequency),"harmonicHistory"in c&&(R=c.harmonicHistory),"debugInterval"in c&&t(17,L=c.debugInterval)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),r.$$.update=()=>{r.$$.dirty[0]&131104&&(l&&!L?(console.log("üîç [PitchDetector] Debug mode enabled - starting status monitoring"),t(17,L=setInterval(te,3e3)),te()):!l&&L&&(console.log("üîç [PitchDetector] Debug mode disabled - stopping status monitoring"),clearInterval(L),t(17,L=null))),r.$$.dirty[0]&114704&&(a&&i==="ready"&&v&&!b?se():!a&&b&&O())},[d,S,C,T,a,l,ue,ne,se,O,de,re,ie,ae,i,v,b,L]}class Nt extends He{constructor(e){super(e),je(this,e,St,Re,Le,{isActive:4,className:0,debugMode:5,resetDisplayState:6,initialize:7,startDetection:8,stopDetection:9,getIsInitialized:10,getState:11,reinitialize:12,cleanup:13},null,[-1,-1]),le("SvelteRegisterComponent",{component:this,tagName:"PitchDetector_1",options:e,id:Re.name})}get isActive(){throw new K("<PitchDetector>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set isActive(e){throw new K("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get className(){throw new K("<PitchDetector>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set className(e){throw new K("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get debugMode(){throw new K("<PitchDetector>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set debugMode(e){throw new K("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get resetDisplayState(){return this.$$.ctx[6]}set resetDisplayState(e){throw new K("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get initialize(){return this.$$.ctx[7]}set initialize(e){throw new K("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get startDetection(){return this.$$.ctx[8]}set startDetection(e){throw new K("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get stopDetection(){return this.$$.ctx[9]}set stopDetection(e){throw new K("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get getIsInitialized(){return this.$$.ctx[10]}set getIsInitialized(e){throw new K("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get getState(){return this.$$.ctx[11]}set getState(e){throw new K("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get reinitialize(){return this.$$.ctx[12]}set reinitialize(e){throw new K("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get cleanup(){return this.$$.ctx[13]}set cleanup(e){throw new K("<PitchDetector>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const Y="src/lib/components/PitchDetectionDisplay.svelte";function rt(r){let e,t,o=(r[0]>0?Math.round(r[0]):"---")+"",n,s,a,d="Hz",l,i,m="|",g,h,y;const u={c:function(){e=F("div"),t=F("span"),n=xe(o),s=ee(),a=F("span"),a.textContent=d,l=ee(),i=F("span"),i.textContent=m,g=ee(),h=F("span"),y=xe(r[1]),this.h()},l:function(w){e=N(w,"DIV",{class:!0});var f=q(e);t=N(f,"SPAN",{class:!0});var _=q(t);n=Pe(_,o),_.forEach(P),s=$(f),a=N(f,"SPAN",{class:!0,"data-svelte-h":!0}),Ee(a)!=="svelte-5uyilv"&&(a.textContent=d),l=$(f),i=N(f,"SPAN",{class:!0,"data-svelte-h":!0}),Ee(i)!=="svelte-1dytxz4"&&(i.textContent=m),g=$(f),h=N(f,"SPAN",{class:!0});var b=q(h);y=Pe(b,r[1]),b.forEach(P),f.forEach(P),this.h()},h:function(){E(t,"class","detected-frequency svelte-1datf0r"),z(t,Y,25,14,712),E(a,"class","hz-suffix svelte-1datf0r"),z(a,Y,26,14,814),E(i,"class","divider svelte-1datf0r"),z(i,Y,27,14,862),E(h,"class","detected-note svelte-1datf0r"),z(h,Y,28,14,907),E(e,"class","detection-values svelte-1datf0r"),z(e,Y,24,12,667)},m:function(w,f){we(w,e,f),D(e,t),D(t,n),D(e,s),D(e,a),D(e,l),D(e,i),D(e,g),D(e,h),D(h,y)},p:function(w,f){f&1&&o!==(o=(w[0]>0?Math.round(w[0]):"---")+"")&&Se(n,o),f&2&&Se(y,w[1])},d:function(w){w&&P(e)}};return le("SvelteRegisterBlock",{block:u,id:rt.name,type:"else",source:"(24:10) {:else}",ctx:r}),u}function it(r){let e,t;const o={c:function(){e=F("span"),t=xe(r[4]),this.h()},l:function(s){e=N(s,"SPAN",{class:!0});var a=q(e);t=Pe(a,r[4]),a.forEach(P),this.h()},h:function(){E(e,"class","muted-message svelte-1datf0r"),z(e,Y,22,12,588)},m:function(s,a){we(s,e,a),D(e,t)},p:function(s,a){a&16&&Se(t,s[4])},d:function(s){s&&P(e)}};return le("SvelteRegisterBlock",{block:o,id:it.name,type:"if",source:"(22:10) {#if isMuted}",ctx:r}),o}function at(r){let e,t,o="üéôÔ∏è „É™„Ç¢„É´„Çø„Ç§„É†Èü≥Á®ãÊ§úÂá∫",n,s,a,d,l,i,m,g;function h(w,f){return w[3]?it:rt}let y=h(r),u=y(r);m=new ze({props:{volume:!r[3]&&r[0]>0?r[2]:0,className:"volume-bar"},$$inline:!0});const v={c:function(){e=F("div"),t=F("h3"),t.textContent=o,n=ee(),s=F("div"),a=F("div"),d=F("div"),l=F("div"),u.c(),i=ee(),Xe(m.$$.fragment),this.h()},l:function(f){e=N(f,"DIV",{class:!0});var _=q(e);t=N(_,"H3",{class:!0,"data-svelte-h":!0}),Ee(t)!=="svelte-1bj87i9"&&(t.textContent=o),_.forEach(P),n=$(f),s=N(f,"DIV",{class:!0});var b=q(s);a=N(b,"DIV",{class:!0});var x=q(a);d=N(x,"DIV",{class:!0});var M=q(d);l=N(M,"DIV",{class:!0});var p=q(l);u.l(p),p.forEach(P),i=$(M),We(m.$$.fragment,M),M.forEach(P),x.forEach(P),b.forEach(P),this.h()},h:function(){E(t,"class","section-title svelte-1datf0r"),z(t,Y,15,4,360),E(e,"class","card-header svelte-1datf0r"),z(e,Y,14,2,330),E(l,"class","detection-card svelte-1datf0r"),z(l,Y,20,8,523),E(d,"class","detection-display svelte-1datf0r"),z(d,Y,19,6,483),E(a,"class","pitch-detector svelte-1datf0r"),z(a,Y,18,4,448),E(s,"class","card-content svelte-1datf0r"),z(s,Y,17,2,417)},m:function(f,_){we(f,e,_),D(e,t),we(f,n,_),we(f,s,_),D(s,a),D(a,d),D(d,l),u.m(l,null),D(d,i),Je(m,d,null),g=!0},p:function(f,_){y===(y=h(f))&&u?u.p(f,_):(u.d(1),u=y(f),u&&(u.c(),u.m(l,null)));const b={};_&13&&(b.volume=!f[3]&&f[0]>0?f[2]:0),m.$set(b)},i:function(f){g||(Ue(m.$$.fragment,f),g=!0)},o:function(f){Ke(m.$$.fragment,f),g=!1},d:function(f){f&&(P(e),P(n),P(s)),u.d(),Qe(m)}};return le("SvelteRegisterBlock",{block:v,id:at.name,type:"slot",source:'(14:0) <Card class=\\"main-card {className}\\">',ctx:r}),v}function qe(r){let e,t;e=new st({props:{class:"main-card "+r[5],$$slots:{default:[at]},$$scope:{ctx:r}},$$inline:!0});const o={c:function(){Xe(e.$$.fragment)},l:function(s){We(e.$$.fragment,s)},m:function(s,a){Je(e,s,a),t=!0},p:function(s,[a]){const d={};a&32&&(d.class="main-card "+s[5]),a&95&&(d.$$scope={dirty:a,ctx:s}),e.$set(d)},i:function(s){t||(Ue(e.$$.fragment,s),t=!0)},o:function(s){Ke(e.$$.fragment,s),t=!1},d:function(s){Qe(e,s)}};return le("SvelteRegisterBlock",{block:o,id:qe.name,type:"component",source:"",ctx:r}),o}function Pt(r,e,t){let{$$slots:o={},$$scope:n}=e;Ge("PitchDetectionDisplay",o,[]);let{frequency:s=0}=e,{note:a="„Éº„Éº"}=e,{volume:d=0}=e,{isMuted:l=!1}=e,{muteMessage:i="ÂæÖÊ©ü‰∏≠..."}=e,{className:m=""}=e;const g=["frequency","note","volume","isMuted","muteMessage","className"];return Object.keys(e).forEach(h=>{!~g.indexOf(h)&&h.slice(0,2)!=="$$"&&h!=="slot"&&console.warn(`<PitchDetectionDisplay> was created with unknown prop '${h}'`)}),r.$$set=h=>{"frequency"in h&&t(0,s=h.frequency),"note"in h&&t(1,a=h.note),"volume"in h&&t(2,d=h.volume),"isMuted"in h&&t(3,l=h.isMuted),"muteMessage"in h&&t(4,i=h.muteMessage),"className"in h&&t(5,m=h.className)},r.$capture_state=()=>({Card:st,VolumeBar:ze,frequency:s,note:a,volume:d,isMuted:l,muteMessage:i,className:m}),r.$inject_state=h=>{"frequency"in h&&t(0,s=h.frequency),"note"in h&&t(1,a=h.note),"volume"in h&&t(2,d=h.volume),"isMuted"in h&&t(3,l=h.isMuted),"muteMessage"in h&&t(4,i=h.muteMessage),"className"in h&&t(5,m=h.className)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),[s,a,d,l,i,m]}class Ft extends He{constructor(e){super(e),je(this,e,Pt,qe,Le,{frequency:0,note:1,volume:2,isMuted:3,muteMessage:4,className:5}),le("SvelteRegisterComponent",{component:this,tagName:"PitchDetectionDisplay",options:e,id:qe.name})}get frequency(){throw new Error("<PitchDetectionDisplay>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set frequency(e){throw new Error("<PitchDetectionDisplay>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get note(){throw new Error("<PitchDetectionDisplay>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set note(e){throw new Error("<PitchDetectionDisplay>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get volume(){throw new Error("<PitchDetectionDisplay>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set volume(e){throw new Error("<PitchDetectionDisplay>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get isMuted(){throw new Error("<PitchDetectionDisplay>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set isMuted(e){throw new Error("<PitchDetectionDisplay>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get muteMessage(){throw new Error("<PitchDetectionDisplay>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set muteMessage(e){throw new Error("<PitchDetectionDisplay>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get className(){throw new Error("<PitchDetectionDisplay>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set className(e){throw new Error("<PitchDetectionDisplay>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}export{Ft as P,ze as V,be as a,Nt as b};
