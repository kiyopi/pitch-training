import { c as create_ssr_component, b as validate_store, d as subscribe, o as onDestroy, v as validate_component, e as escape } from "../../../chunks/ssr.js";
import { p as page } from "../../../chunks/stores.js";
import { P as PageLayout, C as Card, B as Button } from "../../../chunks/PageLayout.js";
/* empty css                                                         */
const css = {
  code: ".microphone-test.svelte-ztuqv4.svelte-ztuqv4{max-width:800px;margin:0 auto;display:flex;flex-direction:column;gap:var(--space-6)}.header.svelte-ztuqv4.svelte-ztuqv4{text-align:center}.mic-test-header.svelte-ztuqv4.svelte-ztuqv4{display:flex;align-items:center;justify-content:center;gap:var(--space-4);margin-bottom:var(--space-4)}.mic-icon.svelte-ztuqv4.svelte-ztuqv4{width:64px;height:64px;border-radius:50%;background-color:#dbeafe;color:#2563eb;display:flex;align-items:center;justify-content:center;flex-shrink:0}.mic-test-title.svelte-ztuqv4.svelte-ztuqv4{font-size:var(--text-2xl);font-weight:700;color:var(--color-gray-900);margin:0 0 var(--space-2) 0}.mic-test-description.svelte-ztuqv4.svelte-ztuqv4{font-size:var(--text-base);color:var(--color-gray-600);margin:0}.mic-test-content.svelte-ztuqv4.svelte-ztuqv4{text-align:center}.mic-status.svelte-ztuqv4.svelte-ztuqv4{margin-bottom:var(--space-6);display:flex;flex-direction:column;gap:var(--space-2)}.status-indicator.svelte-ztuqv4.svelte-ztuqv4{padding:var(--space-3);border-radius:8px;font-weight:600;font-size:var(--text-sm)}.status-indicator.pending.svelte-ztuqv4.svelte-ztuqv4{background-color:#fef3c7;color:#92400e;border:1px solid #fcd34d}.status-indicator.granted.svelte-ztuqv4.svelte-ztuqv4{background-color:#dcfce7;color:#166534;border:1px solid #86efac}.status-indicator.success.svelte-ztuqv4.svelte-ztuqv4{background-color:#dcfce7;color:#166534;border:1px solid #86efac}.status-indicator.warning.svelte-ztuqv4.svelte-ztuqv4{background-color:#fef3c7;color:#92400e;border:1px solid #fcd34d}.status-indicator.error.svelte-ztuqv4.svelte-ztuqv4{background-color:#fee2e2;color:#991b1b;border:1px solid #fca5a5}.retry-button.svelte-ztuqv4.svelte-ztuqv4{padding:var(--space-2) var(--space-4);background-color:#2563eb;color:white;border:none;border-radius:6px;font-weight:600;cursor:pointer;transition:background-color 0.2s}.retry-button.svelte-ztuqv4.svelte-ztuqv4:hover{background-color:#1d4ed8}.realtime-display.svelte-ztuqv4.svelte-ztuqv4{display:grid;gap:var(--space-6);margin-bottom:var(--space-6)}.display-title.svelte-ztuqv4.svelte-ztuqv4{font-size:var(--text-lg);font-weight:600;color:var(--color-gray-900);margin:0 0 var(--space-3) 0}.volume-section.svelte-ztuqv4.svelte-ztuqv4{display:flex;flex-direction:column;justify-content:center;min-height:120px}.frequency-display.svelte-ztuqv4.svelte-ztuqv4{margin-bottom:var(--space-2)}.frequency-value.svelte-ztuqv4.svelte-ztuqv4{font-size:var(--text-2xl);font-weight:700;color:var(--color-gray-900);margin-bottom:var(--space-1)}.note-value.svelte-ztuqv4.svelte-ztuqv4{font-size:var(--text-lg);font-weight:600;color:var(--color-gray-700)}.volume-status.svelte-ztuqv4.svelte-ztuqv4,.frequency-status.svelte-ztuqv4.svelte-ztuqv4{text-align:center}.status-success.svelte-ztuqv4.svelte-ztuqv4{color:var(--color-success);font-weight:600}.status-pending.svelte-ztuqv4.svelte-ztuqv4{color:var(--color-gray-600)}.status-warning.svelte-ztuqv4.svelte-ztuqv4{color:#f59e0b;font-weight:600}.confidence-display.svelte-ztuqv4.svelte-ztuqv4{margin-top:var(--space-2);font-size:var(--text-sm);color:var(--color-gray-700)}.confidence-bar.svelte-ztuqv4.svelte-ztuqv4{width:100%;height:8px;background-color:var(--color-gray-200);border-radius:4px;margin-top:var(--space-1);overflow:hidden}.confidence-fill.svelte-ztuqv4.svelte-ztuqv4{height:100%;border-radius:4px;transition:width 0.2s ease, background-color 0.2s ease}.guidance.svelte-ztuqv4.svelte-ztuqv4{padding:var(--space-4);background:#dbeafe;border-radius:8px;border:1px solid #93c5fd}.guidance-content.svelte-ztuqv4 h3.svelte-ztuqv4{font-size:var(--text-lg);font-weight:600;color:var(--color-gray-900);margin:0 0 var(--space-1) 0}.guidance-content.svelte-ztuqv4 p.svelte-ztuqv4{font-size:var(--text-sm);color:var(--color-gray-600);margin:0}.start-content.svelte-ztuqv4.svelte-ztuqv4{text-align:center}.start-title.svelte-ztuqv4.svelte-ztuqv4{font-size:var(--text-xl);font-weight:600;color:var(--color-gray-900);margin:0 0 var(--space-2) 0}.start-description.svelte-ztuqv4.svelte-ztuqv4{font-size:var(--text-base);color:var(--color-gray-600);margin:0 0 var(--space-6) 0}@media(min-width: 768px){.mic-test-header.svelte-ztuqv4.svelte-ztuqv4{flex-direction:row;text-align:left}.realtime-display.svelte-ztuqv4.svelte-ztuqv4{grid-template-columns:1fr 1fr}}",
  map: `{"version":3,"file":"+page.svelte","sources":["+page.svelte"],"sourcesContent":["<script>\\n  import { onMount, onDestroy } from 'svelte';\\n  import { page } from '$app/stores';\\n  import Card from '$lib/components/Card.svelte';\\n  import Button from '$lib/components/Button.svelte';\\n  import PageLayout from '$lib/components/PageLayout.svelte';\\n  import VolumeBar from '$lib/components/VolumeBar.svelte';\\n  import PitchDisplay from '$lib/components/PitchDisplay.svelte';\\n\\n  // URL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ mode ã‚’å–å¾—\\n  let mode = 'random';\\n  \\n  onMount(() => {\\n    if ($page.url.searchParams.has('mode')) {\\n      mode = $page.url.searchParams.get('mode') || 'random';\\n    }\\n  });\\n\\n  // ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆçŠ¶æ…‹ç®¡ç†\\n  let micPermission = 'initial'; // 'initial' | 'pending' | 'granted' | 'denied' | 'error'\\n  let volumeDetected = false;\\n  let frequencyDetected = false;\\n  let currentVolume = 0;\\n  let currentFrequency = 0;\\n  let currentNote = '';\\n  let isListening = false;\\n  let detectionConfidence = 0; // æ¤œå‡ºä¿¡é ¼åº¦ (0-100)\\n  let audioContextBlocked = false; // AudioContexté–‹å§‹ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸå ´åˆ\\n  \\n  // å‘¨æ³¢æ•°å¹³æ»‘åŒ–ã®ãŸã‚ã®å±¥æ­´\\n  let frequencyHistory = [];\\n  const HISTORY_SIZE = 5;\\n\\n  // ãƒ‡ãƒãƒƒã‚°ç”¨: çŠ¶æ…‹å¤‰æ›´ã‚’ç›£è¦–\\n  $: {\\n    console.log('çŠ¶æ…‹å¤‰æ›´ - micPermission:', micPermission, 'isListening:', isListening, 'audioContextBlocked:', audioContextBlocked);\\n  }\\n\\n  // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰è¨­å®š\\n  const trainingModes = {\\n    random: {\\n      name: 'ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ãƒ¢ãƒ¼ãƒ‰',\\n      description: '10ç¨®é¡ã®åŸºéŸ³ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠã—ã¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°',\\n      color: 'green',\\n      path: './training/random'\\n    },\\n    continuous: {\\n      name: 'é€£ç¶šãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰',\\n      description: 'é¸æŠã—ãŸå›æ•°ã ã‘é€£ç¶šã§å®Ÿè¡Œã—ã€ç·åˆè©•ä¾¡ã‚’ç¢ºèª',\\n      color: 'orange',\\n      path: './training/continuous'\\n    },\\n    chromatic: {\\n      name: '12éŸ³éšãƒ¢ãƒ¼ãƒ‰',\\n      description: 'ã‚¯ãƒ­ãƒãƒãƒƒã‚¯ã‚¹ã‚±ãƒ¼ãƒ«ã®ä¸Šè¡Œãƒ»ä¸‹è¡Œã§å®Œå…¨åˆ¶è¦‡',\\n      color: 'purple',\\n      path: './training/chromatic'\\n    }\\n  };\\n\\n  const selectedMode = trainingModes[mode] || trainingModes.random;\\n  $: startButtonEnabled = micPermission === 'granted' && volumeDetected && frequencyDetected;\\n\\n  // éŸ³åå¤‰æ›\\n  function frequencyToNote(frequency) {\\n    if (frequency <= 0) return 'C4ï¼ˆãƒ‰4ï¼‰';\\n    \\n    const A4 = 440;\\n    const semitonesFromA4 = Math.round(12 * Math.log2(frequency / A4));\\n    const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\\n    const noteIndex = ((semitonesFromA4 + 9) % 12 + 12) % 12;\\n    const octave = Math.floor((semitonesFromA4 + 9) / 12) + 4;\\n    \\n    const note = noteNames[noteIndex];\\n    const noteNamesJa = {\\n      'C': 'ãƒ‰', 'C#': 'ãƒ‰#', 'D': 'ãƒ¬', 'D#': 'ãƒ¬#', 'E': 'ãƒŸ', 'F': 'ãƒ•ã‚¡',\\n      'F#': 'ãƒ•ã‚¡#', 'G': 'ã‚½', 'G#': 'ã‚½#', 'A': 'ãƒ©', 'A#': 'ãƒ©#', 'B': 'ã‚·'\\n    };\\n    \\n    return \`\${note}\${octave}ï¼ˆ\${noteNamesJa[note]}\${octave}ï¼‰\`;\\n  }\\n\\n  // ãƒã‚¤ã‚¯è¨±å¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆAudioContextã¯ä½œæˆã—ãªã„ï¼‰\\n  async function requestMicrophone() {\\n    console.log('ãƒã‚¤ã‚¯è¨±å¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–‹å§‹');\\n    micPermission = 'pending';\\n    \\n    try {\\n      // ãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\\n      console.log('ãƒã‚¤ã‚¯è¨±å¯å–å¾—æˆåŠŸ');\\n      micPermission = 'granted';\\n      \\n      // ãƒ†ã‚¹ãƒˆç”¨ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åœæ­¢\\n      stream.getTracks().forEach(track => track.stop());\\n      \\n      // AudioContextã®ä½œæˆã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒªãƒƒã‚¯ã¾ã§å¾…æ©Ÿ\\n      console.log('ãƒã‚¤ã‚¯è¨±å¯å®Œäº† - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒªãƒƒã‚¯ã§AudioContexté–‹å§‹ã‚’å¾…æ©Ÿ');\\n    } catch (error) {\\n      console.error('ãƒã‚¤ã‚¯è¨±å¯ã‚¨ãƒ©ãƒ¼:', error);\\n      micPermission = 'denied';\\n    }\\n  }\\n\\n  // Web Audio APIå¤‰æ•°\\n  let audioContext = null;\\n  let mediaStream = null;\\n  let analyser = null;\\n  let dataArray = null;\\n  let animationFrame = null;\\n\\n  // ãƒªã‚¹ãƒ‹ãƒ³ã‚°é–‹å§‹ï¼ˆAudioContextã¯æ—¢ã«ä½œæˆæ¸ˆã¿å‰æï¼‰\\n  async function startListening() {\\n    console.log('startListening é–‹å§‹, micPermission:', micPermission);\\n    \\n    if (micPermission !== 'granted') {\\n      console.log('ãƒã‚¤ã‚¯è¨±å¯ãŒã‚ã‚Šã¾ã›ã‚“');\\n      return;\\n    }\\n\\n    if (!audioContext) {\\n      console.log('AudioContextãŒä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“');\\n      audioContextBlocked = true;\\n      return;\\n    }\\n    \\n    try {\\n      console.log('AudioContext state:', audioContext.state);\\n      \\n      // AudioContextãŒsuspendedã®å ´åˆã¯è‡ªå‹•resumeï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒªãƒƒã‚¯å†…ãªã®ã§æˆåŠŸã™ã‚‹ã¯ãšï¼‰\\n      if (audioContext.state === 'suspended') {\\n        console.log('AudioContext suspended - attempting resume...');\\n        await audioContext.resume();\\n        console.log('AudioContext resumed, new state:', audioContext.state);\\n      }\\n      \\n      console.log('ãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹é–‹å§‹...');\\n      // ãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹\\n      mediaStream = await navigator.mediaDevices.getUserMedia({ \\n        audio: {\\n          echoCancellation: false,\\n          noiseSuppression: false,\\n          autoGainControl: false\\n        } \\n      });\\n      \\n      // MediaStreamTrackçµ‚äº†ã‚¤ãƒ™ãƒ³ãƒˆã®ç›£è¦–\\n      mediaStream.getTracks().forEach(track => {\\n        track.addEventListener('ended', () => {\\n          console.log('MediaStreamTrack ended - stopping analysis');\\n          stopListening();\\n          micPermission = 'error';\\n        });\\n      });\\n      \\n      console.log('ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼è¨­å®šä¸­...');\\n      // ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼è¨­å®š\\n      analyser = audioContext.createAnalyser();\\n      analyser.fftSize = 2048;\\n      analyser.smoothingTimeConstant = 0.8;\\n      \\n      const source = audioContext.createMediaStreamSource(mediaStream);\\n      source.connect(analyser);\\n      console.log('ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚½ãƒ¼ã‚¹æ¥ç¶šå®Œäº†');\\n      \\n      // ãƒ‡ãƒ¼ã‚¿é…åˆ—\\n      const bufferLength = analyser.frequencyBinCount;\\n      dataArray = new Uint8Array(bufferLength);\\n      console.log('ãƒ‡ãƒ¼ã‚¿é…åˆ—æº–å‚™å®Œäº†, bufferLength:', bufferLength);\\n      \\n      isListening = true;\\n      console.log('ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è§£æé–‹å§‹');\\n      \\n      // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è§£æé–‹å§‹\\n      analyzeAudio();\\n      \\n    } catch (error) {\\n      console.error('ãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼:', error);\\n      console.error('ã‚¨ãƒ©ãƒ¼è©³ç´°:', {\\n        name: error.name,\\n        message: error.message,\\n        code: error.code\\n      });\\n      micPermission = 'error';\\n      audioContextBlocked = true;\\n    }\\n  }\\n\\n  // éŸ³å£°è§£æãƒ«ãƒ¼ãƒ—\\n  function analyzeAudio() {\\n    if (!isListening || !analyser) {\\n      console.log('è§£æåœæ­¢: isListening=', isListening, 'analyser=', !!analyser);\\n      return;\\n    }\\n    \\n    // æœ€åˆã®å®Ÿè¡Œãƒ­ã‚°ï¼ˆ1å›ã ã‘ï¼‰\\n    if (!window.firstAnalysisLogged) {\\n      console.log('åˆå›éŸ³å£°è§£æå®Ÿè¡Œä¸­...');\\n      window.firstAnalysisLogged = true;\\n    }\\n    \\n    // å‘¨æ³¢æ•°ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆéŸ³é‡è¨ˆç®—ç”¨ï¼‰\\n    analyser.getByteFrequencyData(dataArray);\\n    \\n    // éŸ³é‡è¨ˆç®—ï¼ˆRMSï¼‰\\n    let sum = 0;\\n    for (let i = 0; i < dataArray.length; i++) {\\n      sum += dataArray[i] * dataArray[i];\\n    }\\n    const rms = Math.sqrt(sum / dataArray.length);\\n    currentVolume = Math.min(100, (rms / 128) * 100);\\n    \\n    if (currentVolume > 20) {\\n      if (!volumeDetected) {\\n        console.log('éŸ³é‡æ¤œå‡ºæˆåŠŸ:', currentVolume);\\n      }\\n      volumeDetected = true;\\n    }\\n    \\n    // æ™‚é–“é ˜åŸŸãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆéŸ³ç¨‹æ¤œå‡ºç”¨ï¼‰\\n    const timeDataArray = new Float32Array(analyser.fftSize);\\n    analyser.getFloatTimeDomainData(timeDataArray);\\n    \\n    // è‡ªå·±ç›¸é–¢é–¢æ•°ã«ã‚ˆã‚‹åŸºæœ¬å‘¨æ³¢æ•°æ¤œå‡º\\n    const detectionResult = detectPitchWithAutocorrelation(timeDataArray, audioContext.sampleRate);\\n    \\n    if (detectionResult.frequency > 0) {\\n      // å‘¨æ³¢æ•°å±¥æ­´ã«è¿½åŠ \\n      frequencyHistory.push(detectionResult.frequency);\\n      if (frequencyHistory.length > HISTORY_SIZE) {\\n        frequencyHistory.shift();\\n      }\\n      \\n      // å¹³æ»‘åŒ–ã•ã‚ŒãŸå‘¨æ³¢æ•°ã‚’è¨ˆç®—\\n      const smoothedFrequency = smoothFrequency(frequencyHistory);\\n      currentFrequency = smoothedFrequency;\\n      currentNote = frequencyToNote(currentFrequency);\\n      detectionConfidence = Math.round(detectionResult.confidence * 100);\\n      \\n      if (currentFrequency > 80 && currentFrequency < 800) { // äººå£°ç¯„å›²\\n        if (!frequencyDetected) {\\n          console.log('å‘¨æ³¢æ•°æ¤œå‡ºæˆåŠŸ:', currentFrequency, 'Hz', currentNote);\\n        }\\n        frequencyDetected = true;\\n      }\\n    } else {\\n      // æ¤œå‡ºå¤±æ•—æ™‚ã¯å±¥æ­´ã‚’ã‚¯ãƒªã‚¢\\n      frequencyHistory = [];\\n      currentFrequency = 0;\\n      currentNote = '';\\n      detectionConfidence = 0;\\n    }\\n    \\n    // æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ \\n    animationFrame = requestAnimationFrame(analyzeAudio);\\n  }\\n\\n  // è‡ªå·±ç›¸é–¢é–¢æ•°ã«ã‚ˆã‚‹éŸ³ç¨‹æ¤œå‡ºï¼ˆæ”¹è‰¯ç‰ˆï¼‰\\n  function detectPitchWithAutocorrelation(buffer, sampleRate) {\\n    // éŸ³é‡ãƒã‚§ãƒƒã‚¯ï¼ˆé–¾å€¤ä»¥ä¸‹ã¯å‡¦ç†ã—ãªã„ï¼‰\\n    let rms = 0;\\n    for (let i = 0; i < buffer.length; i++) {\\n      rms += buffer[i] * buffer[i];\\n    }\\n    rms = Math.sqrt(rms / buffer.length);\\n    if (rms < 0.01) return 0; // éŸ³é‡ãŒå°ã•ã™ãã‚‹å ´åˆ\\n    \\n    // ãƒã‚¤ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨ï¼ˆä½å‘¨æ³¢ãƒã‚¤ã‚ºé™¤å»ï¼‰\\n    const filteredBuffer = applyHighPassFilter(buffer, sampleRate, 70);\\n    \\n    // è‡ªå·±ç›¸é–¢é–¢æ•°è¨ˆç®—ã®ç¯„å›²è¨­å®š\\n    const minPeriod = Math.floor(sampleRate / 800); // æœ€é«˜800Hz\\n    const maxPeriod = Math.floor(sampleRate / 70);  // æœ€ä½70Hz\\n    \\n    let bestCorrelation = 0;\\n    let bestPeriod = 0;\\n    let secondBestCorrelation = 0;\\n    \\n    // å„é…å»¶ï¼ˆperiodï¼‰ã§ã®è‡ªå·±ç›¸é–¢ã‚’è¨ˆç®—\\n    for (let period = minPeriod; period <= maxPeriod; period++) {\\n      let correlation = 0;\\n      let normalizer = 0;\\n      \\n      // æ­£è¦åŒ–ã•ã‚ŒãŸè‡ªå·±ç›¸é–¢è¨ˆç®—\\n      for (let i = 0; i < filteredBuffer.length - period; i++) {\\n        correlation += filteredBuffer[i] * filteredBuffer[i + period];\\n        normalizer += filteredBuffer[i] * filteredBuffer[i];\\n      }\\n      \\n      if (normalizer > 0) {\\n        correlation = correlation / Math.sqrt(normalizer);\\n        \\n        // ç›¸é–¢å€¤ã®æ›´æ–°\\n        if (correlation > bestCorrelation) {\\n          secondBestCorrelation = bestCorrelation;\\n          bestCorrelation = correlation;\\n          bestPeriod = period;\\n        } else if (correlation > secondBestCorrelation) {\\n          secondBestCorrelation = correlation;\\n        }\\n      }\\n    }\\n    \\n    // æ˜ç¢ºãªãƒ”ãƒ¼ã‚¯ãŒã‚ã‚‹å ´åˆã®ã¿å‘¨æ³¢æ•°ã‚’è¿”ã™\\n    const clarity = bestCorrelation - secondBestCorrelation;\\n    if (bestCorrelation > 0.3 && clarity > 0.05 && bestPeriod > 0) {\\n      // ä¿¡é ¼åº¦ã‚’è¨ˆç®— (0.0 - 1.0)\\n      const confidence = Math.min(1.0, bestCorrelation * clarity * 2);\\n      return {\\n        frequency: sampleRate / bestPeriod,\\n        confidence: confidence\\n      };\\n    }\\n    \\n    return { frequency: 0, confidence: 0 };\\n  }\\n\\n  // ã‚·ãƒ³ãƒ—ãƒ«ãªãƒã‚¤ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆIIR 1æ¬¡ï¼‰\\n  function applyHighPassFilter(buffer, sampleRate, cutoffFreq) {\\n    const dt = 1.0 / sampleRate;\\n    const rc = 1.0 / (cutoffFreq * 2 * Math.PI);\\n    const alpha = rc / (rc + dt);\\n    \\n    const filtered = new Float32Array(buffer.length);\\n    filtered[0] = buffer[0];\\n    \\n    for (let i = 1; i < buffer.length; i++) {\\n      filtered[i] = alpha * (filtered[i-1] + buffer[i] - buffer[i-1]);\\n    }\\n    \\n    return filtered;\\n  }\\n\\n  // å‘¨æ³¢æ•°å¹³æ»‘åŒ–é–¢æ•°\\n  function smoothFrequency(frequencies) {\\n    if (frequencies.length === 0) return 0;\\n    if (frequencies.length === 1) return frequencies[0];\\n    \\n    // å¤–ã‚Œå€¤ã‚’é™¤å»ã—ãŸä¸­å¤®å€¤çš„ãªå¹³æ»‘åŒ–\\n    const sorted = [...frequencies].sort((a, b) => a - b);\\n    const median = sorted[Math.floor(sorted.length / 2)];\\n    \\n    // ä¸­å¤®å€¤ã‹ã‚‰å¤§ããå¤–ã‚ŒãŸå€¤ã‚’é™¤å¤–\\n    const filtered = frequencies.filter(f => Math.abs(f - median) / median < 0.1);\\n    \\n    if (filtered.length === 0) return median;\\n    \\n    // æ®‹ã£ãŸå€¤ã®åŠ é‡å¹³å‡ï¼ˆæ–°ã—ã„å€¤ã»ã©é‡ã¿å¤§ï¼‰\\n    let weightedSum = 0;\\n    let totalWeight = 0;\\n    \\n    for (let i = 0; i < filtered.length; i++) {\\n      const weight = (i + 1); // æ–°ã—ã„å€¤ã»ã©é‡ã„\\n      weightedSum += filtered[i] * weight;\\n      totalWeight += weight;\\n    }\\n    \\n    return weightedSum / totalWeight;\\n  }\\n\\n  // ãƒªã‚¹ãƒ‹ãƒ³ã‚°åœæ­¢\\n  function stopListening() {\\n    isListening = false;\\n    \\n    if (animationFrame) {\\n      cancelAnimationFrame(animationFrame);\\n      animationFrame = null;\\n    }\\n    \\n    if (mediaStream) {\\n      mediaStream.getTracks().forEach(track => track.stop());\\n      mediaStream = null;\\n    }\\n    \\n    if (audioContext && audioContext.state !== 'closed') {\\n      audioContext.close();\\n      audioContext = null;\\n    }\\n    \\n    analyser = null;\\n    dataArray = null;\\n  }\\n\\n  // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç ´æ£„æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\\n  onDestroy(() => {\\n    stopListening();\\n  });\\n\\n  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒªãƒƒã‚¯ã§AudioContextã‚’é–‹å§‹\\n  async function startAudioContextManually() {\\n    console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒªãƒƒã‚¯ã§AudioContexté–‹å§‹...');\\n    \\n    if (micPermission !== 'granted') {\\n      console.log('ãƒã‚¤ã‚¯è¨±å¯ãŒå¿…è¦ã§ã™');\\n      return;\\n    }\\n\\n    try {\\n      // æ–°ã—ã„AudioContextã‚’ä½œæˆ\\n      audioContext = new (window.AudioContext || window.webkitAudioContext)();\\n      console.log('AudioContextä½œæˆå®Œäº†, state:', audioContext.state);\\n      \\n      audioContextBlocked = false;\\n      \\n      // ãƒªã‚¹ãƒ‹ãƒ³ã‚°é–‹å§‹\\n      await startListening();\\n    } catch (error) {\\n      console.error('AudioContexté–‹å§‹å¤±æ•—:', error);\\n      audioContextBlocked = true;\\n    }\\n  }\\n\\n  onMount(() => {\\n    // è‡ªå‹•ãƒã‚¤ã‚¯è¨±å¯ã¯å®Ÿè¡Œã—ãªã„ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚’å¾…ã¤ï¼‰\\n    console.log('ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº† - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚’å¾…æ©Ÿä¸­');\\n    console.log('åˆæœŸçŠ¶æ…‹ - micPermission:', micPermission, 'isListening:', isListening, 'audioContextBlocked:', audioContextBlocked);\\n  });\\n<\/script>\\n\\n<svelte:head>\\n  <title>ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆ - ç›¸å¯¾éŸ³æ„Ÿãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>\\n</svelte:head>\\n\\n<PageLayout showBackButton={true}>\\n  <div class=\\"microphone-test\\">\\n    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->\\n    <div class=\\"header\\">\\n      <div class=\\"mic-test-header\\">\\n        <div class=\\"mic-icon\\">\\n          <svg width=\\"48\\" height=\\"48\\" viewBox=\\"0 0 24 24\\" fill=\\"none\\" stroke=\\"currentColor\\" stroke-width=\\"2\\">\\n            <path d=\\"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z\\"/>\\n            <path d=\\"M19 10v2a7 7 0 0 1-14 0v-2\\"/>\\n            <line x1=\\"12\\" x2=\\"12\\" y1=\\"19\\" y2=\\"22\\"/>\\n            <line x1=\\"8\\" x2=\\"16\\" y1=\\"22\\" y2=\\"22\\"/>\\n          </svg>\\n        </div>\\n        <div>\\n          <h1 class=\\"mic-test-title\\">ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆ</h1>\\n          <p class=\\"mic-test-description\\">éŸ³æ„Ÿãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’å§‹ã‚ã‚‹å‰ã«ã€ãƒã‚¤ã‚¯ã®å‹•ä½œã‚’ç¢ºèªã—ã¾ã™</p>\\n        </div>\\n      </div>\\n    </div>\\n\\n    <!-- ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->\\n    <div class=\\"test-section\\">\\n      <Card variant=\\"default\\" padding=\\"lg\\">\\n        <div class=\\"mic-test-content\\">\\n          \\n          <!-- ãƒã‚¤ã‚¯çŠ¶æ…‹è¡¨ç¤º -->\\n          <div class=\\"mic-status\\">\\n            {#if micPermission === 'pending'}\\n              <div class=\\"status-indicator pending\\">â³ ãƒã‚¤ã‚¯è¨±å¯ã‚’ç¢ºèªä¸­...</div>\\n            {:else if micPermission === 'granted'}\\n              <div class=\\"status-indicator granted\\">âœ… ãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯æ¸ˆã¿</div>\\n              {#if !isListening && !audioContextBlocked}\\n                <div class=\\"status-indicator warning\\">ğŸµ éŸ³å£°æ©Ÿèƒ½ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</div>\\n                <button class=\\"retry-button\\" on:click={startAudioContextManually}>\\n                  ğŸ¤ ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹\\n                </button>\\n              {:else if !isListening && audioContextBlocked}\\n                <div class=\\"status-indicator warning\\">âš ï¸ éŸ³å£°ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™</div>\\n                <button class=\\"retry-button\\" on:click={startAudioContextManually}>\\n                  éŸ³å£°æ©Ÿèƒ½ã‚’å†è©¦è¡Œ\\n                </button>\\n              {:else if isListening}\\n                <div class=\\"status-indicator success\\">ğŸ¤ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è§£æä¸­</div>\\n              {/if}\\n            {:else if micPermission === 'denied'}\\n              <div class=\\"status-indicator error\\">âŒ ãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ</div>\\n              <button class=\\"retry-button\\" on:click={requestMicrophone}>\\n                ãƒã‚¤ã‚¯è¨±å¯ã‚’å†è©¦è¡Œ\\n              </button>\\n            {:else if micPermission === 'error'}\\n              <div class=\\"status-indicator error\\">âŒ ãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</div>\\n              <button class=\\"retry-button\\" on:click={requestMicrophone}>\\n                ãƒã‚¤ã‚¯è¨±å¯ã‚’å†è©¦è¡Œ\\n              </button>\\n            {:else}\\n              <div class=\\"status-indicator pending\\">ğŸ¤ ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„</div>\\n              <button class=\\"retry-button\\" on:click={requestMicrophone}>\\n                ãƒã‚¤ã‚¯è¨±å¯ã‚’å–å¾—\\n              </button>\\n            {/if}\\n          </div>\\n\\n          <!-- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º -->\\n          {#if micPermission === 'granted' && isListening}\\n            <div class=\\"realtime-display\\">\\n              <!-- éŸ³é‡ãƒ¬ãƒ™ãƒ« -->\\n              <div class=\\"volume-section\\">\\n                <h3 class=\\"display-title\\">éŸ³é‡ãƒ¬ãƒ™ãƒ«</h3>\\n                <VolumeBar volume={currentVolume} height=\\"16px\\" className=\\"volume-bar-wrapper\\" />\\n                <div class=\\"volume-status\\">\\n                  {#if !volumeDetected}\\n                    <span class=\\"status-pending\\">â³ å£°ã‚’å‡ºã—ã¦éŸ³é‡ã‚’ç¢ºèªã—ã¦ãã ã•ã„</span>\\n                  {/if}\\n                </div>\\n              </div>\\n\\n              <!-- å‘¨æ³¢æ•°ãƒ»éŸ³ç¨‹è¡¨ç¤º -->\\n              <div class=\\"frequency-section\\">\\n                <h3 class=\\"display-title\\">éŸ³ç¨‹æ¤œå‡º</h3>\\n                <div class=\\"frequency-display\\">\\n                  <div class=\\"frequency-value\\">{currentFrequency.toFixed(1)} Hz</div>\\n                  <div class=\\"note-value\\">{currentNote}</div>\\n                  {#if detectionConfidence > 0}\\n                    <div class=\\"confidence-display\\">\\n                      ä¿¡é ¼åº¦: {detectionConfidence}%\\n                      <div class=\\"confidence-bar\\">\\n                        <div \\n                          class=\\"confidence-fill\\" \\n                          style=\\"width: {detectionConfidence}%; background-color: {detectionConfidence > 70 ? '#10b981' : detectionConfidence > 40 ? '#f59e0b' : '#ef4444'}\\"\\n                        ></div>\\n                      </div>\\n                    </div>\\n                  {/if}\\n                </div>\\n                <div class=\\"frequency-status\\">\\n                  {#if !frequencyDetected}\\n                    <span class=\\"status-pending\\">â³ ã€Œãƒ‰ã€ã‚’ç™ºå£°ã—ã¦éŸ³ç¨‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„</span>\\n                  {:else if detectionConfidence < 50}\\n                    <span class=\\"status-warning\\">âš ï¸ ã‚ˆã‚Šæ˜ç¢ºã«ç™ºå£°ã—ã¦ãã ã•ã„</span>\\n                  {:else}\\n                    <span class=\\"status-success\\">âœ… éŸ³ç¨‹æ¤œå‡ºä¸­</span>\\n                  {/if}\\n                </div>\\n              </div>\\n            </div>\\n\\n            <!-- ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ -->\\n            {#if volumeDetected && !frequencyDetected}\\n              <div class=\\"guidance\\">\\n                <div class=\\"guidance-content\\">\\n                  <h3>ã€Œãƒ‰ã€ã‚’ç™ºå£°ã—ã¦ãã ã•ã„</h3>\\n                  <p>ä»»æ„ã®é«˜ã•ã§ã€Œãƒ‰ãƒ¼ã€ã¨æ­Œã†ã‚ˆã†ã«ç™ºå£°ã—ã¦ãã ã•ã„</p>\\n                </div>\\n              </div>\\n            {/if}\\n          {/if}\\n        </div>\\n      </Card>\\n    </div>\\n\\n    <!-- ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ -->\\n    <div class=\\"start-section\\">\\n      <Card variant=\\"default\\" padding=\\"lg\\">\\n        <div class=\\"start-content\\">\\n          <h3 class=\\"start-title\\">{selectedMode.name}</h3>\\n          <p class=\\"start-description\\">\\n            {selectedMode.description}\\n          </p>\\n          \\n          {#if startButtonEnabled}\\n            <Button \\n              href={selectedMode.path} \\n              variant=\\"primary\\" \\n              size=\\"lg\\" \\n              fullWidth\\n            >\\n              ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é–‹å§‹\\n            </Button>\\n          {:else}\\n            <Button \\n              variant=\\"disabled\\" \\n              size=\\"lg\\" \\n              fullWidth \\n              disabled\\n            >\\n              ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œã«é–‹å§‹\\n            </Button>\\n          {/if}\\n        </div>\\n      </Card>\\n    </div>\\n  </div>\\n</PageLayout>\\n\\n<style>\\n  .microphone-test {\\n    max-width: 800px;\\n    margin: 0 auto;\\n    display: flex;\\n    flex-direction: column;\\n    gap: var(--space-6);\\n  }\\n\\n  .header {\\n    text-align: center;\\n  }\\n\\n  .mic-test-header {\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n    gap: var(--space-4);\\n    margin-bottom: var(--space-4);\\n  }\\n\\n  .mic-icon {\\n    width: 64px;\\n    height: 64px;\\n    border-radius: 50%;\\n    background-color: #dbeafe;\\n    color: #2563eb;\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n    flex-shrink: 0;\\n  }\\n\\n  .mic-test-title {\\n    font-size: var(--text-2xl);\\n    font-weight: 700;\\n    color: var(--color-gray-900);\\n    margin: 0 0 var(--space-2) 0;\\n  }\\n\\n  .mic-test-description {\\n    font-size: var(--text-base);\\n    color: var(--color-gray-600);\\n    margin: 0;\\n  }\\n\\n  .mic-test-content {\\n    text-align: center;\\n  }\\n\\n  .mic-status {\\n    margin-bottom: var(--space-6);\\n    display: flex;\\n    flex-direction: column;\\n    gap: var(--space-2);\\n  }\\n\\n  .status-indicator {\\n    padding: var(--space-3);\\n    border-radius: 8px;\\n    font-weight: 600;\\n    font-size: var(--text-sm);\\n  }\\n\\n  .status-indicator.pending {\\n    background-color: #fef3c7;\\n    color: #92400e;\\n    border: 1px solid #fcd34d;\\n  }\\n\\n  .status-indicator.granted {\\n    background-color: #dcfce7;\\n    color: #166534;\\n    border: 1px solid #86efac;\\n  }\\n\\n  .status-indicator.success {\\n    background-color: #dcfce7;\\n    color: #166534;\\n    border: 1px solid #86efac;\\n  }\\n\\n  .status-indicator.warning {\\n    background-color: #fef3c7;\\n    color: #92400e;\\n    border: 1px solid #fcd34d;\\n  }\\n\\n  .status-indicator.error {\\n    background-color: #fee2e2;\\n    color: #991b1b;\\n    border: 1px solid #fca5a5;\\n  }\\n\\n  .retry-button {\\n    padding: var(--space-2) var(--space-4);\\n    background-color: #2563eb;\\n    color: white;\\n    border: none;\\n    border-radius: 6px;\\n    font-weight: 600;\\n    cursor: pointer;\\n    transition: background-color 0.2s;\\n  }\\n\\n  .retry-button:hover {\\n    background-color: #1d4ed8;\\n  }\\n\\n  .realtime-display {\\n    display: grid;\\n    gap: var(--space-6);\\n    margin-bottom: var(--space-6);\\n  }\\n\\n  .display-title {\\n    font-size: var(--text-lg);\\n    font-weight: 600;\\n    color: var(--color-gray-900);\\n    margin: 0 0 var(--space-3) 0;\\n  }\\n\\n  .volume-section {\\n    display: flex;\\n    flex-direction: column;\\n    justify-content: center;\\n    min-height: 120px;\\n  }\\n\\n  .volume-bar-wrapper {\\n    margin-bottom: var(--space-2);\\n  }\\n\\n  .frequency-display {\\n    margin-bottom: var(--space-2);\\n  }\\n\\n  .frequency-value {\\n    font-size: var(--text-2xl);\\n    font-weight: 700;\\n    color: var(--color-gray-900);\\n    margin-bottom: var(--space-1);\\n  }\\n\\n  .note-value {\\n    font-size: var(--text-lg);\\n    font-weight: 600;\\n    color: var(--color-gray-700);\\n  }\\n\\n  .volume-status,\\n  .frequency-status {\\n    text-align: center;\\n  }\\n\\n  .status-success {\\n    color: var(--color-success);\\n    font-weight: 600;\\n  }\\n\\n  .status-pending {\\n    color: var(--color-gray-600);\\n  }\\n\\n  .status-warning {\\n    color: #f59e0b;\\n    font-weight: 600;\\n  }\\n\\n  .confidence-display {\\n    margin-top: var(--space-2);\\n    font-size: var(--text-sm);\\n    color: var(--color-gray-700);\\n  }\\n\\n  .confidence-bar {\\n    width: 100%;\\n    height: 8px;\\n    background-color: var(--color-gray-200);\\n    border-radius: 4px;\\n    margin-top: var(--space-1);\\n    overflow: hidden;\\n  }\\n\\n  .confidence-fill {\\n    height: 100%;\\n    border-radius: 4px;\\n    transition: width 0.2s ease, background-color 0.2s ease;\\n  }\\n\\n  .guidance {\\n    padding: var(--space-4);\\n    background: #dbeafe;\\n    border-radius: 8px;\\n    border: 1px solid #93c5fd;\\n  }\\n\\n  .guidance-content h3 {\\n    font-size: var(--text-lg);\\n    font-weight: 600;\\n    color: var(--color-gray-900);\\n    margin: 0 0 var(--space-1) 0;\\n  }\\n\\n  .guidance-content p {\\n    font-size: var(--text-sm);\\n    color: var(--color-gray-600);\\n    margin: 0;\\n  }\\n\\n  .start-content {\\n    text-align: center;\\n  }\\n\\n  .start-title {\\n    font-size: var(--text-xl);\\n    font-weight: 600;\\n    color: var(--color-gray-900);\\n    margin: 0 0 var(--space-2) 0;\\n  }\\n\\n  .start-description {\\n    font-size: var(--text-base);\\n    color: var(--color-gray-600);\\n    margin: 0 0 var(--space-6) 0;\\n  }\\n\\n  @media (min-width: 768px) {\\n    .mic-test-header {\\n      flex-direction: row;\\n      text-align: left;\\n    }\\n\\n    .realtime-display {\\n      grid-template-columns: 1fr 1fr;\\n    }\\n  }\\n</style>"],"names":[],"mappings":"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"}`
};
const Page = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let startButtonEnabled;
  let $$unsubscribe_page;
  validate_store(page, "page");
  $$unsubscribe_page = subscribe(page, (value) => value);
  let mode = "random";
  let micPermission = "initial";
  let isListening = false;
  let audioContextBlocked = false;
  const trainingModes = {
    random: {
      name: "ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ãƒ¢ãƒ¼ãƒ‰",
      description: "10ç¨®é¡ã®åŸºéŸ³ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠã—ã¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",
      color: "green",
      path: "./training/random"
    },
    continuous: {
      name: "é€£ç¶šãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰",
      description: "é¸æŠã—ãŸå›æ•°ã ã‘é€£ç¶šã§å®Ÿè¡Œã—ã€ç·åˆè©•ä¾¡ã‚’ç¢ºèª",
      color: "orange",
      path: "./training/continuous"
    },
    chromatic: {
      name: "12éŸ³éšãƒ¢ãƒ¼ãƒ‰",
      description: "ã‚¯ãƒ­ãƒãƒãƒƒã‚¯ã‚¹ã‚±ãƒ¼ãƒ«ã®ä¸Šè¡Œãƒ»ä¸‹è¡Œã§å®Œå…¨åˆ¶è¦‡",
      color: "purple",
      path: "./training/chromatic"
    }
  };
  const selectedMode = trainingModes[mode] || trainingModes.random;
  function stopListening() {
    isListening = false;
  }
  onDestroy(() => {
    stopListening();
  });
  $$result.css.add(css);
  {
    {
      console.log("çŠ¶æ…‹å¤‰æ›´ - micPermission:", micPermission, "isListening:", isListening, "audioContextBlocked:", audioContextBlocked);
    }
  }
  startButtonEnabled = micPermission === "granted";
  $$unsubscribe_page();
  return `${$$result.head += `<!-- HEAD_svelte-8st1fo_START -->${$$result.title = `<title>ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆ - ç›¸å¯¾éŸ³æ„Ÿãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>`, ""}<!-- HEAD_svelte-8st1fo_END -->`, ""} ${validate_component(PageLayout, "PageLayout").$$render($$result, { showBackButton: true }, {}, {
    default: () => {
      return `<div class="microphone-test svelte-ztuqv4"> <div class="header svelte-ztuqv4"><div class="mic-test-header svelte-ztuqv4"><div class="mic-icon svelte-ztuqv4"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" x2="12" y1="19" y2="22"></line><line x1="8" x2="16" y1="22" y2="22"></line></svg></div> <div><h1 class="mic-test-title svelte-ztuqv4" data-svelte-h="svelte-z7m4lk">ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆ</h1> <p class="mic-test-description svelte-ztuqv4" data-svelte-h="svelte-1vtv92f">éŸ³æ„Ÿãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’å§‹ã‚ã‚‹å‰ã«ã€ãƒã‚¤ã‚¯ã®å‹•ä½œã‚’ç¢ºèªã—ã¾ã™</p></div></div></div>  <div class="test-section">${validate_component(Card, "Card").$$render($$result, { variant: "default", padding: "lg" }, {}, {
        default: () => {
          return `<div class="mic-test-content svelte-ztuqv4"> <div class="mic-status svelte-ztuqv4">${`${`${`${`<div class="status-indicator pending svelte-ztuqv4" data-svelte-h="svelte-1trsgl3">ğŸ¤ ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„</div> <button class="retry-button svelte-ztuqv4" data-svelte-h="svelte-1m6icav">ãƒã‚¤ã‚¯è¨±å¯ã‚’å–å¾—</button>`}`}`}`}</div>  ${``}</div>`;
        }
      })}</div>  <div class="start-section">${validate_component(Card, "Card").$$render($$result, { variant: "default", padding: "lg" }, {}, {
        default: () => {
          return `<div class="start-content svelte-ztuqv4"><h3 class="start-title svelte-ztuqv4">${escape(selectedMode.name)}</h3> <p class="start-description svelte-ztuqv4">${escape(selectedMode.description)}</p> ${startButtonEnabled ? `${validate_component(Button, "Button").$$render(
            $$result,
            {
              href: selectedMode.path,
              variant: "primary",
              size: "lg",
              fullWidth: true
            },
            {},
            {
              default: () => {
                return `ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é–‹å§‹`;
              }
            }
          )}` : `${validate_component(Button, "Button").$$render(
            $$result,
            {
              variant: "disabled",
              size: "lg",
              fullWidth: true,
              disabled: true
            },
            {},
            {
              default: () => {
                return `ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œã«é–‹å§‹`;
              }
            }
          )}`}</div>`;
        }
      })}</div></div>`;
    }
  })}`;
});
export {
  Page as default
};
