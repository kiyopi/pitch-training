import { c as create_ssr_component, g as add_attribute, e as escape, h as createEventDispatcher, o as onDestroy, v as validate_component, b as validate_store, d as subscribe, f as each } from "../../../../chunks/ssr.js";
import { p as page } from "../../../../chunks/stores.js";
import { P as PageLayout, C as Card } from "../../../../chunks/PageLayout.js";
import { B as Button } from "../../../../chunks/Button.js";
import { PitchDetector } from "pitchy";
import { a as audioManager } from "../../../../chunks/AudioManager.js";
import "tone";
const css$2 = {
  code: ".volume-bar-container.svelte-13z7ppf{position:relative;width:100%}.threshold-indicator.svelte-13z7ppf{opacity:0.6;pointer-events:none}",
  map: `{"version":3,"file":"VolumeBar.svelte","sources":["VolumeBar.svelte"],"sourcesContent":["<script>\\n  import { onMount } from 'svelte';\\n  \\n  export let volume = 0; // 0-100ã®éŸ³é‡å€¤\\n  export let threshold = 30; // ã—ãã„å€¤\\n  export let height = '12px';\\n  export let className = '';\\n  \\n  let barElement;\\n  \\n  // éŸ³é‡ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸè‰²ã®è¨ˆç®—ï¼ˆé’é€éã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰\\n  function getVolumeColor(volume) {\\n    if (volume < threshold) {\\n      // ä½éŸ³é‡æ™‚: é€éç‡é«˜ã„é’\\n      const alpha = Math.max(0.2, volume / threshold * 0.8);\\n      return \`rgba(37, 99, 235, \${alpha})\`;\\n    }\\n    // é«˜éŸ³é‡æ™‚: é€éç‡0ï¼ˆå®Œå…¨ãªé’ï¼‰\\n    return '#2563eb';\\n  }\\n  \\n  // éŸ³é‡ãƒãƒ¼ã®æ›´æ–°ï¼ˆDOMç›´æ¥æ“ä½œï¼‰\\n  function updateVolumeBar(newVolume) {\\n    if (barElement) {\\n      const clampedVolume = Math.max(0, Math.min(100, newVolume));\\n      const color = getVolumeColor(clampedVolume);\\n      \\n      // ãƒ­ã‚°å‰Šé™¤\\n      \\n      barElement.style.width = \`\${clampedVolume}%\`;\\n      barElement.style.backgroundColor = color;\\n    }\\n  }\\n  \\n  // volumeãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å¤‰æ›´ã‚’ç›£è¦–\\n  $: updateVolumeBar(volume);\\n  \\n  onMount(() => {\\n    // åˆæœŸã‚¹ã‚¿ã‚¤ãƒ«è¨­å®šï¼ˆiPhone WebKitå¯¾å¿œï¼‰\\n    if (barElement) {\\n      barElement.style.width = '0%';\\n      barElement.style.backgroundColor = '#2563eb';\\n      barElement.style.height = height;\\n      barElement.style.borderRadius = '9999px';\\n      barElement.style.transition = 'width 0.2s ease-out, background-color 0.2s ease-out'; // ã‚ˆã‚Šæ»‘ã‚‰ã‹ãªãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³\\n    }\\n  });\\n<\/script>\\n\\n<div class=\\"volume-bar-container {className}\\">\\n  <div class=\\"volume-bar-bg\\" style=\\"height: {height}; border-radius: 9999px; background-color: #e2e8f0; position: relative; overflow: hidden;\\">\\n    <div \\n      bind:this={barElement}\\n      class=\\"volume-bar-fill\\"\\n      style=\\"position: absolute; top: 0; left: 0; height: 100%;\\"\\n    ></div>\\n  </div>\\n  \\n  <!-- ã—ãã„å€¤ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->\\n  <div \\n    class=\\"threshold-indicator\\" \\n    style=\\"position: absolute; top: 0; left: {threshold}%; width: 2px; height: {height}; background-color: #64748b; border-radius: 1px;\\"\\n  ></div>\\n</div>\\n\\n<style>\\n  .volume-bar-container {\\n    position: relative;\\n    width: 100%;\\n  }\\n  \\n  .threshold-indicator {\\n    opacity: 0.6;\\n    pointer-events: none;\\n  }\\n</style>"],"names":[],"mappings":"AAkEE,oCAAsB,CACpB,QAAQ,CAAE,QAAQ,CAClB,KAAK,CAAE,IACT,CAEA,mCAAqB,CACnB,OAAO,CAAE,GAAG,CACZ,cAAc,CAAE,IAClB"}`
};
const VolumeBar = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let { volume = 0 } = $$props;
  let { threshold = 30 } = $$props;
  let { height = "12px" } = $$props;
  let { className = "" } = $$props;
  let barElement;
  if ($$props.volume === void 0 && $$bindings.volume && volume !== void 0) $$bindings.volume(volume);
  if ($$props.threshold === void 0 && $$bindings.threshold && threshold !== void 0) $$bindings.threshold(threshold);
  if ($$props.height === void 0 && $$bindings.height && height !== void 0) $$bindings.height(height);
  if ($$props.className === void 0 && $$bindings.className && className !== void 0) $$bindings.className(className);
  $$result.css.add(css$2);
  return `<div class="${"volume-bar-container " + escape(className, true) + " svelte-13z7ppf"}"><div class="volume-bar-bg" style="${"height: " + escape(height, true) + "; border-radius: 9999px; background-color: #e2e8f0; position: relative; overflow: hidden;"}"><div class="volume-bar-fill" style="position: absolute; top: 0; left: 0; height: 100%;"${add_attribute("this", barElement, 0)}></div></div>  <div class="threshold-indicator svelte-13z7ppf" style="${"position: absolute; top: 0; left: " + escape(threshold, true) + "%; width: 2px; height: " + escape(height, true) + "; background-color: #64748b; border-radius: 1px;"}"></div> </div>`;
});
const css$1 = {
  code: ".pitch-detector.svelte-vc1bho{padding:1rem}.detection-display.svelte-vc1bho{display:flex;flex-direction:column;gap:1rem}.detection-card.svelte-vc1bho{display:inline-flex;align-items:baseline;gap:0.5rem;padding:1rem 1.5rem;background:hsl(0 0% 100%);border:1px solid hsl(214.3 31.8% 91.4%);border-radius:8px;width:fit-content}.detected-frequency.svelte-vc1bho{font-weight:600;font-size:2rem;color:hsl(222.2 84% 4.9%);font-family:'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', \n                 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;min-width:4ch;text-align:right;display:inline-block;font-variant-numeric:tabular-nums;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.hz-suffix.svelte-vc1bho{font-weight:600;font-size:2rem;color:hsl(222.2 84% 4.9%)}.divider.svelte-vc1bho{color:hsl(214.3 31.8% 70%);font-size:1.5rem;margin:0 0.25rem;font-weight:300}.detected-note.svelte-vc1bho{font-weight:600;font-size:2rem;color:hsl(215.4 16.3% 46.9%);font-family:'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', \n                 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;min-width:3ch;display:inline-block;text-align:center}.volume-bar{border-radius:4px !important}",
  map: `{"version":3,"file":"PitchDetector.svelte","sources":["PitchDetector.svelte"],"sourcesContent":["<script>\\n  import { onMount, onDestroy, createEventDispatcher } from 'svelte';\\n  import { PitchDetector } from 'pitchy';\\n  import VolumeBar from './VolumeBar.svelte';\\n  import { audioManager } from '$lib/audio/AudioManager.js';\\n\\n  const dispatch = createEventDispatcher();\\n\\n  // Props\\n  export let isActive = false;\\n  export let className = '';\\n  export let debugMode = false; // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰\\n\\n  // çŠ¶æ…‹ç®¡ç†ï¼ˆæ”¹è¨‚ç‰ˆï¼‰\\n  let componentState = 'uninitialized'; // 'uninitialized' | 'initializing' | 'ready' | 'detecting' | 'error'\\n  let lastError = null;\\n  let isInitialized = false;\\n\\n  // éŸ³ç¨‹æ¤œå‡ºçŠ¶æ…‹ï¼ˆå¤–éƒ¨AudioContextå¯¾å¿œï¼‰\\n  let audioContext = null;        // AudioManagerã‹ã‚‰å–å¾—\\n  let mediaStream = null;         // AudioManagerã‹ã‚‰å–å¾—\\n  let sourceNode = null;          // AudioManagerã‹ã‚‰å–å¾—\\n  let analyser = null;            // AudioManagerã‹ã‚‰å–å¾—\\n  let rawAnalyser = null;         // AudioManagerã‹ã‚‰å–å¾—\\n  let pitchDetector = null;\\n  let animationFrame = null;\\n  let isDetecting = false;\\n\\n  // AudioManageré–¢é€£\\n  let analyserIds = [];           // ä½œæˆã—ãŸAnalyserã®IDç®¡ç†\\n\\n  // æ¤œå‡ºãƒ‡ãƒ¼ã‚¿\\n  let currentVolume = 0;\\n  let rawVolume = 0;\\n  let currentFrequency = 0;\\n  let detectedNote = 'ãƒ¼ãƒ¼';\\n  let pitchClarity = 0;\\n  \\n  // å®‰å®šåŒ–ç”¨ãƒãƒƒãƒ•ã‚¡\\n  let frequencyHistory = [];\\n  let volumeHistory = [];\\n  let stableFrequency = 0;\\n  let stableVolume = 0;\\n  \\n  // å€éŸ³è£œæ­£ç”¨\\n  let previousFrequency = 0;\\n  let harmonicHistory = [];\\n  \\n  // ãƒ‡ãƒãƒƒã‚°ç”¨\\n  let debugInterval = null;\\n  \\n  // è¡¨ç¤ºçŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆé–¢æ•°ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½ï¼‰\\n  export function resetDisplayState() {\\n    currentVolume = 0;\\n    rawVolume = 0;\\n    currentFrequency = 0;\\n    detectedNote = 'ãƒ¼ãƒ¼';\\n    pitchClarity = 0;\\n    stableFrequency = 0;\\n    stableVolume = 0;\\n    previousFrequency = 0;\\n    \\n    // ãƒãƒƒãƒ•ã‚¡ã‚¯ãƒªã‚¢\\n    frequencyHistory = [];\\n    volumeHistory = [];\\n    harmonicHistory = [];\\n    \\n    if (debugMode) {\\n      console.log('ğŸ”„ [PitchDetector] Display state reset');\\n    }\\n  }\\n  \\n  // ãƒã‚¤ã‚¯çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯é–¢æ•°ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\\n  function checkMicrophoneStatus() {\\n    if (!debugMode) return;\\n    \\n    const timestamp = new Date().toLocaleTimeString();\\n    const status = {\\n      timestamp,\\n      componentState,\\n      isActive,\\n      isDetecting,\\n      isInitialized,\\n      mediaStreamActive: mediaStream ? mediaStream.active : null,\\n      mediaStreamTracks: mediaStream ? mediaStream.getTracks().length : 0,\\n      trackStates: mediaStream ? mediaStream.getTracks().map(track => ({\\n        kind: track.kind,\\n        enabled: track.enabled,\\n        readyState: track.readyState,\\n        muted: track.muted\\n      })) : [],\\n      audioContextState: audioContext ? audioContext.state : null,\\n      hasAnalyser: !!analyser,\\n      currentVolume,\\n      currentFrequency\\n    };\\n    \\n    console.log(\`ğŸ¤ [PitchDetector] \${timestamp}:\`, status);\\n    \\n    // ãƒã‚¤ã‚¯çŠ¶æ…‹ã®ç•°å¸¸ã‚’æ¤œçŸ¥ã—ã¦è¦ªã«é€šçŸ¥\\n    let microphoneHealthy = true;\\n    let errorDetails = [];\\n    \\n    // MediaStreamã®çŠ¶æ…‹ãŒç•°å¸¸ãªå ´åˆã¯è­¦å‘Š\\n    if (mediaStream && !mediaStream.active) {\\n      console.warn(\`âš ï¸ [PitchDetector] MediaStream is inactive!\`, mediaStream);\\n      microphoneHealthy = false;\\n      errorDetails.push('MediaStream inactive');\\n    }\\n    \\n    // AudioContextã®çŠ¶æ…‹ãŒç•°å¸¸ãªå ´åˆã¯è­¦å‘Š\\n    if (audioContext && audioContext.state === 'suspended') {\\n      console.warn(\`âš ï¸ [PitchDetector] AudioContext is suspended!\`, audioContext);\\n      microphoneHealthy = false;\\n      errorDetails.push('AudioContext suspended');\\n    }\\n    \\n    // ãƒˆãƒ©ãƒƒã‚¯ã®çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯\\n    if (mediaStream) {\\n      mediaStream.getTracks().forEach((track, index) => {\\n        if (track.readyState === 'ended') {\\n          console.error(\`âŒ [PitchDetector] Track \${index} has ended!\`, track);\\n          microphoneHealthy = false;\\n          errorDetails.push(\`Track \${index} ended\`);\\n        }\\n      });\\n    }\\n    \\n    // ãƒã‚¤ã‚¯çŠ¶æ…‹å¤‰åŒ–ã‚’è¦ªã«é€šçŸ¥\\n    dispatch('microphoneHealthChange', {\\n      healthy: microphoneHealthy,\\n      errors: errorDetails,\\n      details: status\\n    });\\n  }\\n  \\n  // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã®ç›£è¦–\\n  $: if (debugMode && !debugInterval) {\\n    console.log('ğŸ” [PitchDetector] Debug mode enabled - starting status monitoring');\\n    debugInterval = setInterval(checkMicrophoneStatus, 3000); // 3ç§’é–“éš”\\n    checkMicrophoneStatus(); // å³åº§ã«1å›å®Ÿè¡Œ\\n  } else if (!debugMode && debugInterval) {\\n    console.log('ğŸ” [PitchDetector] Debug mode disabled - stopping status monitoring');\\n    clearInterval(debugInterval);\\n    debugInterval = null;\\n  }\\n\\n  // åˆæœŸåŒ–ï¼ˆAudioManagerå¯¾å¿œç‰ˆï¼‰\\n  export async function initialize() {\\n    try {\\n      componentState = 'initializing';\\n      lastError = null;\\n      \\n      console.log('ğŸ™ï¸ [PitchDetector] AudioManagerçµŒç”±ã§åˆæœŸåŒ–é–‹å§‹');\\n      \\n      // AudioManagerã‹ã‚‰å…±æœ‰ãƒªã‚½ãƒ¼ã‚¹ã‚’å–å¾—\\n      const resources = await audioManager.initialize();\\n      audioContext = resources.audioContext;\\n      mediaStream = resources.mediaStream;\\n      sourceNode = resources.sourceNode;\\n      \\n      console.log('âœ… [PitchDetector] AudioManager ãƒªã‚½ãƒ¼ã‚¹å–å¾—å®Œäº†');\\n      \\n      // å°‚ç”¨ã®Analyserã‚’ä½œæˆï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ä»˜ãï¼‰\\n      const filteredAnalyserId = \`pitch-detector-filtered-\${Date.now()}\`;\\n      analyser = audioManager.createAnalyser(filteredAnalyserId, {\\n        fftSize: 2048,\\n        smoothingTimeConstant: 0.8,\\n        minDecibels: -90,\\n        maxDecibels: -10,\\n        useFilters: true\\n      });\\n      analyserIds.push(filteredAnalyserId);\\n      \\n      // ç”Ÿä¿¡å·ç”¨Analyserï¼ˆæ¯”è¼ƒç”¨ï¼‰\\n      const rawAnalyserId = \`pitch-detector-raw-\${Date.now()}\`;\\n      rawAnalyser = audioManager.createAnalyser(rawAnalyserId, {\\n        fftSize: 2048,\\n        smoothingTimeConstant: 0.8,\\n        minDecibels: -90,\\n        maxDecibels: -10,\\n        useFilters: false\\n      });\\n      analyserIds.push(rawAnalyserId);\\n      \\n      console.log('âœ… [PitchDetector] Analyserä½œæˆå®Œäº†:', analyserIds);\\n      \\n      // PitchDetectoråˆæœŸåŒ–\\n      pitchDetector = PitchDetector.forFloat32Array(analyser.fftSize);\\n      \\n      // åˆæœŸåŒ–å®Œäº†\\n      componentState = 'ready';\\n      isInitialized = true;\\n      \\n      // çŠ¶æ…‹å¤‰æ›´ã‚’é€šçŸ¥\\n      dispatch('stateChange', { state: componentState });\\n      \\n      console.log('âœ… [PitchDetector] åˆæœŸåŒ–å®Œäº†');\\n      \\n    } catch (error) {\\n      console.error('âŒ [PitchDetector] åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);\\n      componentState = 'error';\\n      lastError = error;\\n      isInitialized = false;\\n      \\n      // ã‚¨ãƒ©ãƒ¼ã‚’é€šçŸ¥\\n      dispatch('error', { error, context: 'initialization' });\\n      \\n      throw error;\\n    }\\n  }\\n\\n  // æ¤œå‡ºé–‹å§‹ï¼ˆæ”¹è¨‚ç‰ˆï¼‰\\n  export function startDetection() {\\n    if (componentState !== 'ready') {\\n      const error = new Error(\`Cannot start detection: component state is \${componentState}\`);\\n      dispatch('error', { error, context: 'start-detection' });\\n      return false;\\n    }\\n    \\n    if (!analyser || !pitchDetector || !audioContext) {\\n      const error = new Error('Required components not available');\\n      componentState = 'error';\\n      dispatch('error', { error, context: 'start-detection' });\\n      return false;\\n    }\\n    \\n    componentState = 'detecting';\\n    isDetecting = true;\\n    dispatch('stateChange', { state: componentState });\\n    detectPitch();\\n    return true;\\n  }\\n\\n  // æ¤œå‡ºåœæ­¢ï¼ˆæ”¹è¨‚ç‰ˆï¼‰\\n  export function stopDetection() {\\n    isDetecting = false;\\n    if (animationFrame) {\\n      cancelAnimationFrame(animationFrame);\\n      animationFrame = null;\\n    }\\n    \\n    // çŠ¶æ…‹ã‚’ ready ã«æˆ»ã™ï¼ˆåˆæœŸåŒ–æ¸ˆã¿ã®å ´åˆï¼‰\\n    if (componentState === 'detecting' && isInitialized) {\\n      componentState = 'ready';\\n      dispatch('stateChange', { state: componentState });\\n    }\\n    \\n  }\\n\\n  // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³ç¨‹æ¤œå‡º\\n  function detectPitch() {\\n    if (!isDetecting || !analyser || !rawAnalyser || !pitchDetector) return;\\n    \\n    const bufferLength = analyser.fftSize;\\n    const buffer = new Float32Array(bufferLength);\\n    const rawBuffer = new Float32Array(rawAnalyser.fftSize);\\n    \\n    analyser.getFloatTimeDomainData(buffer);\\n    rawAnalyser.getFloatTimeDomainData(rawBuffer);\\n    \\n    // éŸ³é‡è¨ˆç®—ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¾Œï¼‰\\n    let sum = 0;\\n    for (let i = 0; i < bufferLength; i++) {\\n      sum += Math.abs(buffer[i]);\\n    }\\n    const rms = Math.sqrt(sum / bufferLength);\\n    const logVolume = Math.log10(rms + 0.001) * 50 + 100;\\n    const rawCurrentVolume = Math.max(0, Math.min(100, logVolume));\\n    \\n    // ç”ŸéŸ³é‡è¨ˆç®—ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å‰ï¼‰\\n    let rawSum = 0;\\n    for (let i = 0; i < rawBuffer.length; i++) {\\n      rawSum += Math.abs(rawBuffer[i]);\\n    }\\n    const rawRms = Math.sqrt(rawSum / rawBuffer.length);\\n    const rawLogVolume = Math.log10(rawRms + 0.001) * 50 + 100;\\n    rawVolume = Math.max(0, Math.min(100, rawLogVolume));\\n    \\n    // éŸ³é‡ã®å®‰å®šåŒ–ï¼ˆ5ãƒ•ãƒ¬ãƒ¼ãƒ ç§»å‹•å¹³å‡ï¼‰\\n    volumeHistory.push(rawCurrentVolume);\\n    if (volumeHistory.length > 5) {\\n      volumeHistory.shift();\\n    }\\n    stableVolume = volumeHistory.reduce((sum, v) => sum + v, 0) / volumeHistory.length;\\n    currentVolume = stableVolume;\\n    \\n    // éŸ³ç¨‹æ¤œå‡ºï¼ˆPitchDetectorä½¿ç”¨ï¼‰\\n    const [pitch, clarity] = pitchDetector.findPitch(buffer, audioContext.sampleRate);\\n    \\n    // äººé–“éŸ³åŸŸãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆå®Ÿç”¨èª¿æ•´ï¼‰\\n    // å®Ÿéš›ã®äººé–“ã®å£°åŸŸã«æœ€é©åŒ–:\\n    // - ä½åŸŸ: 65Hzä»¥ä¸Šï¼ˆC2ä»¥ä¸Šã€ç”·æ€§æœ€ä½éŸ³åŸŸè€ƒæ…®ï¼‰  \\n    // - é«˜åŸŸ: 1200Hzä»¥ä¸‹ï¼ˆå®Ÿç”¨çš„ãªæ­Œå”±ç¯„å›²ï¼‰\\n    // - æ¥µä½éŸ³åŸŸãƒã‚¤ã‚ºï¼ˆG-1ç­‰ï¼‰ã¯ç¢ºå®Ÿã«é™¤å¤–\\n    const isValidVocalRange = pitch >= 65 && pitch <= 1200;\\n    \\n    if (pitch && clarity > 0.6 && currentVolume > 10 && isValidVocalRange) {\\n      // å€éŸ³è£œæ­£ã‚·ã‚¹ãƒ†ãƒ é©ç”¨\\n      const correctedFreq = correctHarmonicFrequency(pitch, previousFrequency);\\n      \\n      // åŸºéŸ³å®‰å®šåŒ–ã‚·ã‚¹ãƒ†ãƒ é©ç”¨\\n      const stabilizedFreq = stabilizeFrequency(correctedFreq);\\n      \\n      // å‘¨æ³¢æ•°è¡¨ç¤ºã‚’æ›´æ–°\\n      currentFrequency = Math.round(stabilizedFreq);\\n      detectedNote = frequencyToNote(currentFrequency);\\n      pitchClarity = clarity;\\n      \\n      // æ¬¡å›æ¯”è¼ƒç”¨ã«ä¿å­˜\\n      previousFrequency = currentFrequency;\\n      \\n    } else {\\n      // ä¿¡å·ãŒå¼±ã„å ´åˆã¯å€éŸ³å±¥æ­´ã‚’ã‚¯ãƒªã‚¢\\n      if (harmonicHistory.length > 0) {\\n        harmonicHistory = [];\\n      }\\n      \\n      // éŸ³ç¨‹ãŒãªã„å ´åˆã¯å‰å›å‘¨æ³¢æ•°ã‚’ãƒªã‚»ãƒƒãƒˆ\\n      if (currentFrequency === 0) {\\n        previousFrequency = 0;\\n      }\\n      \\n      // å‘¨æ³¢æ•°è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢\\n      currentFrequency = 0;\\n      detectedNote = 'ãƒ¼ãƒ¼';\\n      pitchClarity = 0;\\n    }\\n    \\n    // éŸ³ç¨‹ãŒæ¤œå‡ºã•ã‚Œãªã„å ´åˆã¯VolumeBarã‚‚0ã«ï¼ˆæ¥µä½éŸ³åŸŸãƒã‚¤ã‚ºå¯¾ç­–ï¼‰\\n    const displayVolume = currentFrequency > 0 ? rawVolume : 0;\\n    \\n    \\n    // è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡\\n    \\n    dispatch('pitchUpdate', {\\n      frequency: currentFrequency,\\n      note: detectedNote,\\n      volume: currentVolume,\\n      rawVolume: displayVolume,\\n      clarity: pitchClarity\\n    });\\n    \\n    animationFrame = requestAnimationFrame(detectPitch);\\n  }\\n\\n  // éŸ³æ¥½çš„å¦¥å½“æ€§è©•ä¾¡\\n  function calculateMusicalScore(frequency) {\\n    const C4 = 261.63; // Middle C\\n    \\n    // æœ€ã‚‚è¿‘ã„åŠéŸ³éšéŸ³åã¸ã®è·é›¢ã‚’è¨ˆç®—\\n    const semitonesFromC4 = Math.log2(frequency / C4) * 12;\\n    const nearestSemitone = Math.round(semitonesFromC4);\\n    const distanceFromSemitone = Math.abs(semitonesFromC4 - nearestSemitone);\\n    \\n    // åŠéŸ³éšã«è¿‘ã„ã»ã©é«˜ã‚¹ã‚³ã‚¢ï¼ˆÂ±50ã‚»ãƒ³ãƒˆä»¥å†…ã§æœ€é«˜ç‚¹ï¼‰\\n    return Math.max(0, 1.0 - (distanceFromSemitone / 0.5));\\n  }\\n\\n  // å€éŸ³è£œæ­£ã‚·ã‚¹ãƒ†ãƒ \\n  function correctHarmonicFrequency(detectedFreq, previousFreq) {\\n    // åŸºéŸ³å€™è£œç”Ÿæˆï¼ˆã‚ªã‚¯ã‚¿ãƒ¼ãƒ–é•ã„ã‚’è€ƒæ…®ï¼‰\\n    const fundamentalCandidates = [\\n      detectedFreq,          // ãã®ã¾ã¾ï¼ˆåŸºéŸ³ã®å¯èƒ½æ€§ï¼‰\\n      detectedFreq / 2.0,    // 1ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸‹ï¼ˆ2å€éŸ³ â†’ åŸºéŸ³ï¼‰\\n      detectedFreq / 3.0,    // 3å€éŸ³ â†’ åŸºéŸ³\\n      detectedFreq / 4.0,    // 4å€éŸ³ â†’ åŸºéŸ³\\n      detectedFreq * 2.0,    // 1ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸Šï¼ˆä½ãæ­Œã£ãŸå ´åˆï¼‰\\n    ];\\n    \\n    // äººé–“éŸ³åŸŸç¯„å›²ï¼ˆC3-C6ï¼‰\\n    const vocalRangeMin = 130.81;\\n    const vocalRangeMax = 1046.50;\\n    \\n    // å„å€™è£œã®å¦¥å½“æ€§è©•ä¾¡\\n    const evaluateFundamental = (freq) => {\\n      // äººé–“éŸ³åŸŸç¯„å›²å†…ãƒã‚§ãƒƒã‚¯ï¼ˆ40%é‡ã¿ï¼‰\\n      const inVocalRange = freq >= vocalRangeMin && freq <= vocalRangeMax;\\n      const vocalRangeScore = inVocalRange ? 1.0 : 0.0;\\n      \\n      // å‰å›æ¤œå‡ºã¨ã®é€£ç¶šæ€§è©•ä¾¡ï¼ˆ40%é‡ã¿ï¼‰\\n      const continuityScore = previousFreq > 0\\n        ? 1.0 - Math.min(Math.abs(freq - previousFreq) / previousFreq, 1.0)\\n        : 0.5;\\n      \\n      // éŸ³æ¥½çš„å¦¥å½“æ€§è©•ä¾¡ï¼ˆ20%é‡ã¿ï¼‰\\n      const musicalScore = calculateMusicalScore(freq);\\n      \\n      const totalScore = (vocalRangeScore * 0.4) + (continuityScore * 0.4) + (musicalScore * 0.2);\\n      return { freq, score: totalScore };\\n    };\\n    \\n    // æœ€é«˜ã‚¹ã‚³ã‚¢å€™è£œã‚’åŸºéŸ³ã¨ã—ã¦æ¡ç”¨\\n    const evaluatedCandidates = fundamentalCandidates.map(evaluateFundamental);\\n    const bestCandidate = evaluatedCandidates.reduce((best, current) => \\n      current.score > best.score ? current : best\\n    );\\n    \\n    return bestCandidate.freq;\\n  }\\n\\n  // åŸºéŸ³å®‰å®šåŒ–ã‚·ã‚¹ãƒ†ãƒ \\n  function stabilizeFrequency(currentFreq, stabilityThreshold = 0.1) {\\n    // å±¥æ­´ãƒãƒƒãƒ•ã‚¡ã«è¿½åŠ ï¼ˆæœ€å¤§5ãƒ•ãƒ¬ãƒ¼ãƒ ä¿æŒï¼‰\\n    harmonicHistory.push(currentFreq);\\n    if (harmonicHistory.length > 5) harmonicHistory.shift();\\n    \\n    // ä¸­å¤®å€¤ãƒ™ãƒ¼ã‚¹ã®å®‰å®šåŒ–ï¼ˆå¤–ã‚Œå€¤é™¤å»ï¼‰\\n    const sorted = [...harmonicHistory].sort((a, b) => a - b);\\n    const median = sorted[Math.floor(sorted.length / 2)];\\n    \\n    // æ€¥æ¿€ãªå¤‰åŒ–ã‚’æŠ‘åˆ¶ï¼ˆæ®µéšçš„å¤‰åŒ–ï¼‰\\n    const maxChange = median * stabilityThreshold;\\n    const stabilized = Math.abs(currentFreq - median) > maxChange \\n      ? median + Math.sign(currentFreq - median) * maxChange\\n      : currentFreq;\\n      \\n    return stabilized;\\n  }\\n\\n  // å‘¨æ³¢æ•°ã‹ã‚‰éŸ³ç¨‹åã«å¤‰æ›\\n  function frequencyToNote(frequency) {\\n    const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\\n    const A4 = 440;\\n    \\n    if (frequency <= 0) return 'ãƒ¼ãƒ¼';\\n    \\n    const semitonesFromA4 = Math.round(12 * Math.log2(frequency / A4));\\n    const noteIndex = (semitonesFromA4 + 9 + 120) % 12;\\n    const octave = Math.floor((semitonesFromA4 + 9) / 12) + 4;\\n    \\n    return noteNames[noteIndex] + octave;\\n  }\\n\\n  // çŠ¶æ…‹ç¢ºèªAPIï¼ˆæ–°è¦è¿½åŠ ï¼‰\\n  export function getIsInitialized() {\\n    return isInitialized && componentState === 'ready';\\n  }\\n  \\n  export function getState() {\\n    return {\\n      componentState,\\n      isInitialized,\\n      isDetecting,\\n      lastError,\\n      hasRequiredComponents: !!(analyser && pitchDetector && audioContext && mediaStream)\\n    };\\n  }\\n  \\n  // å†åˆæœŸåŒ–APIï¼ˆAudioManagerå¯¾å¿œç‰ˆï¼‰\\n  export async function reinitialize() {\\n    console.log('ğŸ”„ [PitchDetector] å†åˆæœŸåŒ–é–‹å§‹');\\n    \\n    // ç¾åœ¨ã®çŠ¶æ…‹ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\\n    cleanup();\\n    \\n    // çŸ­ã„å¾…æ©Ÿã§ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾ã‚’ç¢ºå®Ÿã«\\n    await new Promise(resolve => setTimeout(resolve, 100));\\n    \\n    // å†åˆæœŸåŒ–å®Ÿè¡Œ\\n    await initialize();\\n    \\n    console.log('âœ… [PitchDetector] å†åˆæœŸåŒ–å®Œäº†');\\n  }\\n\\n  // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆAudioManagerå¯¾å¿œç‰ˆï¼‰\\n  export function cleanup() {\\n    console.log('ğŸ§¹ [PitchDetector] ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–‹å§‹');\\n    \\n    stopDetection();\\n    \\n    // AudioManagerã«ä½œæˆã—ãŸAnalyserã‚’è§£æ”¾é€šçŸ¥\\n    if (analyserIds.length > 0) {\\n      audioManager.release(analyserIds);\\n      console.log('ğŸ“¤ [PitchDetector] AudioManagerã«Analyserè§£æ”¾é€šçŸ¥:', analyserIds);\\n      analyserIds = [];\\n    }\\n    \\n    // çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\\n    componentState = 'uninitialized';\\n    isInitialized = false;\\n    lastError = null;\\n    \\n    // å‚ç…§ã‚’ã‚¯ãƒªã‚¢ï¼ˆå®Ÿéš›ã®ãƒªã‚½ãƒ¼ã‚¹ã¯AudioManagerãŒç®¡ç†ï¼‰\\n    audioContext = null;\\n    mediaStream = null;\\n    sourceNode = null;\\n    analyser = null;\\n    rawAnalyser = null;\\n    pitchDetector = null;\\n    \\n    // å±¥æ­´ã‚¯ãƒªã‚¢\\n    frequencyHistory = [];\\n    volumeHistory = [];\\n    harmonicHistory = [];\\n    \\n    console.log('âœ… [PitchDetector] ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');\\n  }\\n\\n  // isActiveã®å¤‰æ›´ã‚’ç›£è¦–ï¼ˆæ”¹å–„ç‰ˆï¼‰\\n  $: if (isActive && componentState === 'ready' && analyser && !isDetecting) {\\n    startDetection();\\n  } else if (!isActive && isDetecting) {\\n    stopDetection();\\n  }\\n\\n  onDestroy(() => {\\n    // ãƒ‡ãƒãƒƒã‚°ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã®ã‚¯ãƒªã‚¢\\n    if (debugInterval) {\\n      clearInterval(debugInterval);\\n      debugInterval = null;\\n    }\\n    \\n    // AudioManagerä½¿ç”¨æ™‚ã¯è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ãªã„\\n    // ï¼ˆä»–ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒä½¿ç”¨ä¸­ã®å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ï¼‰\\n    // æ˜ç¤ºçš„ãªcleanup()å‘¼ã³å‡ºã—ãŒå¿…è¦\\n    console.log('ğŸ”„ [PitchDetector] onDestroy - AudioManagerãƒªã‚½ãƒ¼ã‚¹ã¯ä¿æŒ');\\n  });\\n<\/script>\\n\\n<div class=\\"pitch-detector {className}\\">\\n  <div class=\\"detection-display\\">\\n    <div class=\\"detection-card\\">\\n      <span class=\\"detected-frequency\\">{currentFrequency > 0 ? Math.round(currentFrequency) : '---'}</span>\\n      <span class=\\"hz-suffix\\">Hz</span>\\n      <span class=\\"divider\\">|</span>\\n      <span class=\\"detected-note\\">{detectedNote}</span>\\n    </div>\\n    \\n    <VolumeBar volume={currentFrequency > 0 ? rawVolume : 0} className=\\"volume-bar\\" />\\n  </div>\\n</div>\\n\\n<style>\\n  .pitch-detector {\\n    padding: 1rem;\\n  }\\n\\n  .detection-display {\\n    display: flex;\\n    flex-direction: column;\\n    gap: 1rem;\\n  }\\n  \\n  .detection-card {\\n    display: inline-flex;\\n    align-items: baseline;\\n    gap: 0.5rem;\\n    padding: 1rem 1.5rem;\\n    background: hsl(0 0% 100%);\\n    border: 1px solid hsl(214.3 31.8% 91.4%);\\n    border-radius: 8px;\\n    width: fit-content;\\n  }\\n\\n  .detected-frequency {\\n    font-weight: 600;\\n    font-size: 2rem;\\n    color: hsl(222.2 84% 4.9%);\\n    font-family: 'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', \\n                 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;\\n    min-width: 4ch;\\n    text-align: right;\\n    display: inline-block;\\n    font-variant-numeric: tabular-nums;\\n    -webkit-font-smoothing: antialiased;\\n    -moz-osx-font-smoothing: grayscale;\\n  }\\n\\n  .hz-suffix {\\n    font-weight: 600;\\n    font-size: 2rem;\\n    color: hsl(222.2 84% 4.9%);\\n  }\\n\\n  .divider {\\n    color: hsl(214.3 31.8% 70%);\\n    font-size: 1.5rem;\\n    margin: 0 0.25rem;\\n    font-weight: 300;\\n  }\\n  \\n  .detected-note {\\n    font-weight: 600;\\n    font-size: 2rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n    font-family: 'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', \\n                 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;\\n    min-width: 3ch;\\n    display: inline-block;\\n    text-align: center;\\n  }\\n\\n  :global(.volume-bar) {\\n    border-radius: 4px !important;\\n  }\\n</style>"],"names":[],"mappings":"AAshBE,6BAAgB,CACd,OAAO,CAAE,IACX,CAEA,gCAAmB,CACjB,OAAO,CAAE,IAAI,CACb,cAAc,CAAE,MAAM,CACtB,GAAG,CAAE,IACP,CAEA,6BAAgB,CACd,OAAO,CAAE,WAAW,CACpB,WAAW,CAAE,QAAQ,CACrB,GAAG,CAAE,MAAM,CACX,OAAO,CAAE,IAAI,CAAC,MAAM,CACpB,UAAU,CAAE,IAAI,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAC1B,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CACxC,aAAa,CAAE,GAAG,CAClB,KAAK,CAAE,WACT,CAEA,iCAAoB,CAClB,WAAW,CAAE,GAAG,CAChB,SAAS,CAAE,IAAI,CACf,KAAK,CAAE,IAAI,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAC1B,WAAW,CAAE,SAAS,CAAC,CAAC,QAAQ,CAAC,CAAC,eAAe,CAAC,CAAC,aAAa,CAAC;AACrE,iBAAiB,gBAAgB,CAAC,CAAC,WAAW,CAAC,CAAC,UAAU,CAAC,CAAC,SAAS,CACjE,SAAS,CAAE,GAAG,CACd,UAAU,CAAE,KAAK,CACjB,OAAO,CAAE,YAAY,CACrB,oBAAoB,CAAE,YAAY,CAClC,sBAAsB,CAAE,WAAW,CACnC,uBAAuB,CAAE,SAC3B,CAEA,wBAAW,CACT,WAAW,CAAE,GAAG,CAChB,SAAS,CAAE,IAAI,CACf,KAAK,CAAE,IAAI,KAAK,CAAC,GAAG,CAAC,IAAI,CAC3B,CAEA,sBAAS,CACP,KAAK,CAAE,IAAI,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAC3B,SAAS,CAAE,MAAM,CACjB,MAAM,CAAE,CAAC,CAAC,OAAO,CACjB,WAAW,CAAE,GACf,CAEA,4BAAe,CACb,WAAW,CAAE,GAAG,CAChB,SAAS,CAAE,IAAI,CACf,KAAK,CAAE,IAAI,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAC7B,WAAW,CAAE,SAAS,CAAC,CAAC,QAAQ,CAAC,CAAC,eAAe,CAAC,CAAC,aAAa,CAAC;AACrE,iBAAiB,gBAAgB,CAAC,CAAC,WAAW,CAAC,CAAC,UAAU,CAAC,CAAC,SAAS,CACjE,SAAS,CAAE,GAAG,CACd,OAAO,CAAE,YAAY,CACrB,UAAU,CAAE,MACd,CAEQ,WAAa,CACnB,aAAa,CAAE,GAAG,CAAC,UACrB"}`
};
function calculateMusicalScore(frequency) {
  const C4 = 261.63;
  const semitonesFromC4 = Math.log2(frequency / C4) * 12;
  const nearestSemitone = Math.round(semitonesFromC4);
  const distanceFromSemitone = Math.abs(semitonesFromC4 - nearestSemitone);
  return Math.max(0, 1 - distanceFromSemitone / 0.5);
}
function correctHarmonicFrequency(detectedFreq, previousFreq) {
  const fundamentalCandidates = [
    detectedFreq,
    detectedFreq / 2,
    detectedFreq / 3,
    detectedFreq / 4,
    detectedFreq * 2
  ];
  const vocalRangeMin = 130.81;
  const vocalRangeMax = 1046.5;
  const evaluateFundamental = (freq) => {
    const inVocalRange = freq >= vocalRangeMin && freq <= vocalRangeMax;
    const vocalRangeScore = inVocalRange ? 1 : 0;
    const continuityScore = previousFreq > 0 ? 1 - Math.min(Math.abs(freq - previousFreq) / previousFreq, 1) : 0.5;
    const musicalScore = calculateMusicalScore(freq);
    const totalScore = vocalRangeScore * 0.4 + continuityScore * 0.4 + musicalScore * 0.2;
    return { freq, score: totalScore };
  };
  const evaluatedCandidates = fundamentalCandidates.map(evaluateFundamental);
  const bestCandidate = evaluatedCandidates.reduce((best, current) => current.score > best.score ? current : best);
  return bestCandidate.freq;
}
function frequencyToNote(frequency) {
  const noteNames = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
  const A4 = 440;
  if (frequency <= 0) return "ãƒ¼ãƒ¼";
  const semitonesFromA4 = Math.round(12 * Math.log2(frequency / A4));
  const noteIndex = (semitonesFromA4 + 9 + 120) % 12;
  const octave = Math.floor((semitonesFromA4 + 9) / 12) + 4;
  return noteNames[noteIndex] + octave;
}
const PitchDetector_1 = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  const dispatch = createEventDispatcher();
  let { isActive = false } = $$props;
  let { className = "" } = $$props;
  let { debugMode = false } = $$props;
  let componentState = "uninitialized";
  let lastError = null;
  let isInitialized = false;
  let audioContext = null;
  let mediaStream = null;
  let sourceNode = null;
  let analyser = null;
  let rawAnalyser = null;
  let pitchDetector = null;
  let animationFrame = null;
  let isDetecting = false;
  let analyserIds = [];
  let currentVolume = 0;
  let rawVolume = 0;
  let currentFrequency = 0;
  let detectedNote = "ãƒ¼ãƒ¼";
  let pitchClarity = 0;
  let volumeHistory = [];
  let stableVolume = 0;
  let previousFrequency = 0;
  let harmonicHistory = [];
  let debugInterval = null;
  function resetDisplayState() {
    currentVolume = 0;
    rawVolume = 0;
    currentFrequency = 0;
    detectedNote = "ãƒ¼ãƒ¼";
    pitchClarity = 0;
    stableVolume = 0;
    previousFrequency = 0;
    volumeHistory = [];
    harmonicHistory = [];
    if (debugMode) {
      console.log("ğŸ”„ [PitchDetector] Display state reset");
    }
  }
  function checkMicrophoneStatus() {
    if (!debugMode) return;
    const timestamp = (/* @__PURE__ */ new Date()).toLocaleTimeString();
    const status = {
      timestamp,
      componentState,
      isActive,
      isDetecting,
      isInitialized,
      mediaStreamActive: mediaStream ? mediaStream.active : null,
      mediaStreamTracks: mediaStream ? mediaStream.getTracks().length : 0,
      trackStates: mediaStream ? mediaStream.getTracks().map((track) => ({
        kind: track.kind,
        enabled: track.enabled,
        readyState: track.readyState,
        muted: track.muted
      })) : [],
      audioContextState: audioContext ? audioContext.state : null,
      hasAnalyser: !!analyser,
      currentVolume,
      currentFrequency
    };
    console.log(`ğŸ¤ [PitchDetector] ${timestamp}:`, status);
    let microphoneHealthy = true;
    let errorDetails = [];
    if (mediaStream && !mediaStream.active) {
      console.warn(`âš ï¸ [PitchDetector] MediaStream is inactive!`, mediaStream);
      microphoneHealthy = false;
      errorDetails.push("MediaStream inactive");
    }
    if (audioContext && audioContext.state === "suspended") {
      console.warn(`âš ï¸ [PitchDetector] AudioContext is suspended!`, audioContext);
      microphoneHealthy = false;
      errorDetails.push("AudioContext suspended");
    }
    if (mediaStream) {
      mediaStream.getTracks().forEach((track, index) => {
        if (track.readyState === "ended") {
          console.error(`âŒ [PitchDetector] Track ${index} has ended!`, track);
          microphoneHealthy = false;
          errorDetails.push(`Track ${index} ended`);
        }
      });
    }
    dispatch("microphoneHealthChange", {
      healthy: microphoneHealthy,
      errors: errorDetails,
      details: status
    });
  }
  async function initialize() {
    try {
      componentState = "initializing";
      lastError = null;
      console.log("ğŸ™ï¸ [PitchDetector] AudioManagerçµŒç”±ã§åˆæœŸåŒ–é–‹å§‹");
      const resources = await audioManager.initialize();
      audioContext = resources.audioContext;
      mediaStream = resources.mediaStream;
      sourceNode = resources.sourceNode;
      console.log("âœ… [PitchDetector] AudioManager ãƒªã‚½ãƒ¼ã‚¹å–å¾—å®Œäº†");
      const filteredAnalyserId = `pitch-detector-filtered-${Date.now()}`;
      analyser = audioManager.createAnalyser(filteredAnalyserId, {
        fftSize: 2048,
        smoothingTimeConstant: 0.8,
        minDecibels: -90,
        maxDecibels: -10,
        useFilters: true
      });
      analyserIds.push(filteredAnalyserId);
      const rawAnalyserId = `pitch-detector-raw-${Date.now()}`;
      rawAnalyser = audioManager.createAnalyser(rawAnalyserId, {
        fftSize: 2048,
        smoothingTimeConstant: 0.8,
        minDecibels: -90,
        maxDecibels: -10,
        useFilters: false
      });
      analyserIds.push(rawAnalyserId);
      console.log("âœ… [PitchDetector] Analyserä½œæˆå®Œäº†:", analyserIds);
      pitchDetector = PitchDetector.forFloat32Array(analyser.fftSize);
      componentState = "ready";
      isInitialized = true;
      dispatch("stateChange", { state: componentState });
      console.log("âœ… [PitchDetector] åˆæœŸåŒ–å®Œäº†");
    } catch (error) {
      console.error("âŒ [PitchDetector] åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:", error);
      componentState = "error";
      lastError = error;
      isInitialized = false;
      dispatch("error", { error, context: "initialization" });
      throw error;
    }
  }
  function startDetection() {
    if (componentState !== "ready") {
      const error = new Error(`Cannot start detection: component state is ${componentState}`);
      dispatch("error", { error, context: "start-detection" });
      return false;
    }
    if (!analyser || !pitchDetector || !audioContext) {
      const error = new Error("Required components not available");
      componentState = "error";
      dispatch("error", { error, context: "start-detection" });
      return false;
    }
    componentState = "detecting";
    isDetecting = true;
    dispatch("stateChange", { state: componentState });
    detectPitch();
    return true;
  }
  function stopDetection() {
    isDetecting = false;
    if (animationFrame) {
      cancelAnimationFrame(animationFrame);
      animationFrame = null;
    }
    if (componentState === "detecting" && isInitialized) {
      componentState = "ready";
      dispatch("stateChange", { state: componentState });
    }
  }
  function detectPitch() {
    if (!isDetecting || !analyser || !rawAnalyser || !pitchDetector) return;
    const bufferLength = analyser.fftSize;
    const buffer = new Float32Array(bufferLength);
    const rawBuffer = new Float32Array(rawAnalyser.fftSize);
    analyser.getFloatTimeDomainData(buffer);
    rawAnalyser.getFloatTimeDomainData(rawBuffer);
    let sum = 0;
    for (let i = 0; i < bufferLength; i++) {
      sum += Math.abs(buffer[i]);
    }
    const rms = Math.sqrt(sum / bufferLength);
    const logVolume = Math.log10(rms + 1e-3) * 50 + 100;
    const rawCurrentVolume = Math.max(0, Math.min(100, logVolume));
    let rawSum = 0;
    for (let i = 0; i < rawBuffer.length; i++) {
      rawSum += Math.abs(rawBuffer[i]);
    }
    const rawRms = Math.sqrt(rawSum / rawBuffer.length);
    const rawLogVolume = Math.log10(rawRms + 1e-3) * 50 + 100;
    rawVolume = Math.max(0, Math.min(100, rawLogVolume));
    volumeHistory.push(rawCurrentVolume);
    if (volumeHistory.length > 5) {
      volumeHistory.shift();
    }
    stableVolume = volumeHistory.reduce((sum2, v) => sum2 + v, 0) / volumeHistory.length;
    currentVolume = stableVolume;
    const [pitch, clarity] = pitchDetector.findPitch(buffer, audioContext.sampleRate);
    const isValidVocalRange = pitch >= 65 && pitch <= 1200;
    if (pitch && clarity > 0.6 && currentVolume > 10 && isValidVocalRange) {
      const correctedFreq = correctHarmonicFrequency(pitch, previousFrequency);
      const stabilizedFreq = stabilizeFrequency(correctedFreq);
      currentFrequency = Math.round(stabilizedFreq);
      detectedNote = frequencyToNote(currentFrequency);
      pitchClarity = clarity;
      previousFrequency = currentFrequency;
    } else {
      if (harmonicHistory.length > 0) {
        harmonicHistory = [];
      }
      if (currentFrequency === 0) {
        previousFrequency = 0;
      }
      currentFrequency = 0;
      detectedNote = "ãƒ¼ãƒ¼";
      pitchClarity = 0;
    }
    const displayVolume = currentFrequency > 0 ? rawVolume : 0;
    dispatch("pitchUpdate", {
      frequency: currentFrequency,
      note: detectedNote,
      volume: currentVolume,
      rawVolume: displayVolume,
      clarity: pitchClarity
    });
    animationFrame = requestAnimationFrame(detectPitch);
  }
  function stabilizeFrequency(currentFreq, stabilityThreshold = 0.1) {
    harmonicHistory.push(currentFreq);
    if (harmonicHistory.length > 5) harmonicHistory.shift();
    const sorted = [...harmonicHistory].sort((a, b) => a - b);
    const median = sorted[Math.floor(sorted.length / 2)];
    const maxChange = median * stabilityThreshold;
    const stabilized = Math.abs(currentFreq - median) > maxChange ? median + Math.sign(currentFreq - median) * maxChange : currentFreq;
    return stabilized;
  }
  function getIsInitialized() {
    return isInitialized && componentState === "ready";
  }
  function getState() {
    return {
      componentState,
      isInitialized,
      isDetecting,
      lastError,
      hasRequiredComponents: !!(analyser && pitchDetector && audioContext && mediaStream)
    };
  }
  async function reinitialize() {
    console.log("ğŸ”„ [PitchDetector] å†åˆæœŸåŒ–é–‹å§‹");
    cleanup();
    await new Promise((resolve) => setTimeout(resolve, 100));
    await initialize();
    console.log("âœ… [PitchDetector] å†åˆæœŸåŒ–å®Œäº†");
  }
  function cleanup() {
    console.log("ğŸ§¹ [PitchDetector] ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–‹å§‹");
    stopDetection();
    if (analyserIds.length > 0) {
      audioManager.release(analyserIds);
      console.log("ğŸ“¤ [PitchDetector] AudioManagerã«Analyserè§£æ”¾é€šçŸ¥:", analyserIds);
      analyserIds = [];
    }
    componentState = "uninitialized";
    isInitialized = false;
    lastError = null;
    audioContext = null;
    mediaStream = null;
    sourceNode = null;
    analyser = null;
    rawAnalyser = null;
    pitchDetector = null;
    volumeHistory = [];
    harmonicHistory = [];
    console.log("âœ… [PitchDetector] ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†");
  }
  onDestroy(() => {
    if (debugInterval) {
      clearInterval(debugInterval);
      debugInterval = null;
    }
    console.log("ğŸ”„ [PitchDetector] onDestroy - AudioManagerãƒªã‚½ãƒ¼ã‚¹ã¯ä¿æŒ");
  });
  if ($$props.isActive === void 0 && $$bindings.isActive && isActive !== void 0) $$bindings.isActive(isActive);
  if ($$props.className === void 0 && $$bindings.className && className !== void 0) $$bindings.className(className);
  if ($$props.debugMode === void 0 && $$bindings.debugMode && debugMode !== void 0) $$bindings.debugMode(debugMode);
  if ($$props.resetDisplayState === void 0 && $$bindings.resetDisplayState && resetDisplayState !== void 0) $$bindings.resetDisplayState(resetDisplayState);
  if ($$props.initialize === void 0 && $$bindings.initialize && initialize !== void 0) $$bindings.initialize(initialize);
  if ($$props.startDetection === void 0 && $$bindings.startDetection && startDetection !== void 0) $$bindings.startDetection(startDetection);
  if ($$props.stopDetection === void 0 && $$bindings.stopDetection && stopDetection !== void 0) $$bindings.stopDetection(stopDetection);
  if ($$props.getIsInitialized === void 0 && $$bindings.getIsInitialized && getIsInitialized !== void 0) $$bindings.getIsInitialized(getIsInitialized);
  if ($$props.getState === void 0 && $$bindings.getState && getState !== void 0) $$bindings.getState(getState);
  if ($$props.reinitialize === void 0 && $$bindings.reinitialize && reinitialize !== void 0) $$bindings.reinitialize(reinitialize);
  if ($$props.cleanup === void 0 && $$bindings.cleanup && cleanup !== void 0) $$bindings.cleanup(cleanup);
  $$result.css.add(css$1);
  {
    if (debugMode && !debugInterval) {
      console.log("ğŸ” [PitchDetector] Debug mode enabled - starting status monitoring");
      debugInterval = setInterval(checkMicrophoneStatus, 3e3);
      checkMicrophoneStatus();
    } else if (!debugMode && debugInterval) {
      console.log("ğŸ” [PitchDetector] Debug mode disabled - stopping status monitoring");
      clearInterval(debugInterval);
      debugInterval = null;
    }
  }
  {
    if (isActive && componentState === "ready" && analyser && !isDetecting) {
      startDetection();
    } else if (!isActive && isDetecting) {
      stopDetection();
    }
  }
  return `<div class="${"pitch-detector " + escape(className, true) + " svelte-vc1bho"}"><div class="detection-display svelte-vc1bho"><div class="detection-card svelte-vc1bho"><span class="detected-frequency svelte-vc1bho">${escape(currentFrequency > 0 ? Math.round(currentFrequency) : "---")}</span> <span class="hz-suffix svelte-vc1bho" data-svelte-h="svelte-5uyilv">Hz</span> <span class="divider svelte-vc1bho" data-svelte-h="svelte-1dytxz4">|</span> <span class="detected-note svelte-vc1bho">${escape(detectedNote)}</span></div> ${validate_component(VolumeBar, "VolumeBar").$$render(
    $$result,
    {
      volume: currentFrequency > 0 ? rawVolume : 0,
      className: "volume-bar"
    },
    {},
    {}
  )}</div> </div>`;
});
const css = {
  code: ".header-section.svelte-ds9yw.svelte-ds9yw{text-align:center;margin-bottom:2rem}.page-title.svelte-ds9yw.svelte-ds9yw{font-size:2rem;font-weight:700;color:hsl(222.2 84% 4.9%);margin-bottom:0.5rem}.page-description.svelte-ds9yw.svelte-ds9yw{color:hsl(215.4 16.3% 46.9%);font-size:1rem;margin:0}.main-card{border:1px solid hsl(214.3 31.8% 91.4%) !important;background:hsl(0 0% 100%) !important;border-radius:8px !important;box-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px 0 rgb(0 0 0 / 0.06) !important;margin-bottom:1.5rem}.status-card{border-radius:8px !important;margin-bottom:1.5rem}.error-card{border:1px solid hsl(0 84.2% 60.2%) !important;background:hsl(0 84.2% 97%) !important;border-radius:8px !important;box-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1) !important}.results-card{border:1px solid hsl(142.1 76.2% 36.3%) !important;background:linear-gradient(135deg, hsl(142.1 76.2% 95%) 0%, hsl(0 0% 100%) 100%) !important}.card-header.svelte-ds9yw.svelte-ds9yw{padding-bottom:1rem;border-bottom:1px solid hsl(214.3 31.8% 91.4%);margin-bottom:1.5rem}.section-title.svelte-ds9yw.svelte-ds9yw{font-size:1.125rem;font-weight:600;color:hsl(222.2 84% 4.9%);margin:0}.card-content.svelte-ds9yw.svelte-ds9yw{display:flex;flex-direction:column;gap:1rem}.status-content.svelte-ds9yw.svelte-ds9yw{display:flex;justify-content:space-between;align-items:center;gap:1rem}.status-message.svelte-ds9yw.svelte-ds9yw{font-weight:500;color:hsl(222.2 84% 4.9%)}.progress-indicator.svelte-ds9yw.svelte-ds9yw{font-size:0.875rem;color:hsl(215.4 16.3% 46.9%)}.side-by-side-container.svelte-ds9yw.svelte-ds9yw{display:flex;gap:1.5rem;margin-bottom:1.5rem}.half-width{flex:1}@media(max-width: 768px){.side-by-side-container.svelte-ds9yw.svelte-ds9yw{flex-direction:column}.half-width{width:100%}}.debug-info.svelte-ds9yw.svelte-ds9yw{position:absolute;top:1rem;right:1rem;background:hsl(220 13% 91%);color:hsl(220 13% 46%);padding:0.25rem 0.5rem;border-radius:4px;font-size:0.75rem;font-family:'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;z-index:100}.base-note-info.svelte-ds9yw.svelte-ds9yw{text-align:center;padding:1rem;background:hsl(210 40% 98%);border-radius:6px;border:1px solid hsl(214.3 31.8% 91.4%);font-size:0.875rem;color:hsl(215.4 16.3% 46.9%)}.relative-pitch-info.svelte-ds9yw.svelte-ds9yw{text-align:center;padding:1rem;background:hsl(210 40% 98%);border-radius:6px;border:1px solid hsl(214.3 31.8% 91.4%);margin-top:1rem}.frequency-display-large.svelte-ds9yw.svelte-ds9yw{display:flex;flex-direction:column;align-items:center;gap:0.25rem}.large-hz.svelte-ds9yw.svelte-ds9yw{font-size:2rem;font-weight:700;color:hsl(222.2 84% 4.9%);line-height:1}.note-with-cents.svelte-ds9yw.svelte-ds9yw{font-size:0.875rem;color:hsl(215.4 16.3% 46.9%);font-weight:500}.no-signal.svelte-ds9yw.svelte-ds9yw{font-size:2rem;font-weight:700;color:hsl(215.4 16.3% 46.9%);line-height:1}.pitch-detector-placeholder.svelte-ds9yw.svelte-ds9yw{text-align:center;padding:2rem;color:hsl(215.4 16.3% 46.9%);font-style:italic}.scale-guide.svelte-ds9yw.svelte-ds9yw{display:grid;grid-template-columns:repeat(4, 1fr);gap:0.75rem;margin-bottom:1rem}.scale-item.svelte-ds9yw.svelte-ds9yw{display:flex;align-items:center;justify-content:center;height:3rem;border-radius:6px;font-weight:500;font-size:0.875rem;border:1px solid hsl(215.4 16.3% 46.9%);background:hsl(0 0% 100%);color:hsl(215.4 16.3% 46.9%);transition:all 0.3s ease}.scale-item.active.svelte-ds9yw.svelte-ds9yw{background:hsl(343.8 79.7% 53.7%) !important;color:white !important;border:2px solid hsla(343.8 79.7% 53.7% / 0.5) !important;transform:scale(1.2);font-size:1.125rem;font-weight:700;animation:svelte-ds9yw-pulse 2s infinite;box-shadow:0 0 0 2px hsla(343.8 79.7% 53.7% / 0.3) !important}.scale-item.correct.svelte-ds9yw.svelte-ds9yw{background:hsl(142.1 76.2% 36.3%);color:hsl(210 40% 98%);border-color:hsl(142.1 76.2% 36.3%);animation:svelte-ds9yw-correctFlash 0.5s ease-out}.scale-item.incorrect.svelte-ds9yw.svelte-ds9yw{background:hsl(0 84.2% 60.2%);color:hsl(210 40% 98%);border-color:hsl(0 84.2% 60.2%);animation:svelte-ds9yw-shake 0.5s ease-in-out}@keyframes svelte-ds9yw-pulse{0%,100%{opacity:1}50%{opacity:0.7}}@keyframes svelte-ds9yw-correctFlash{0%{transform:scale(1);background:hsl(47.9 95.8% 53.1%)}50%{transform:scale(1.1);background:hsl(142.1 76.2% 36.3%)}100%{transform:scale(1);background:hsl(142.1 76.2% 36.3%)}}@keyframes svelte-ds9yw-shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}.guide-instruction.svelte-ds9yw.svelte-ds9yw{text-align:center;font-size:0.875rem;color:hsl(215.4 16.3% 46.9%);padding:0.75rem;background:hsl(210 40% 98%);border-radius:6px}.guide-feedback.svelte-ds9yw.svelte-ds9yw{display:flex;align-items:center;justify-content:center;gap:0.5rem;margin-top:0.5rem;font-size:0.75rem}.feedback-label.svelte-ds9yw.svelte-ds9yw{color:hsl(215.4 16.3% 46.9%);font-weight:500}.feedback-value.svelte-ds9yw.svelte-ds9yw{font-weight:700;font-family:'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;padding:0.125rem 0.375rem;border-radius:4px;background:hsl(214.3 31.8% 91.4%);color:hsl(222.2 84% 4.9%);min-width:4ch;text-align:center}.feedback-value.accurate.svelte-ds9yw.svelte-ds9yw{background:hsl(142.1 76.2% 90%);color:hsl(142.1 76.2% 30%)}.feedback-value.close.svelte-ds9yw.svelte-ds9yw{background:hsl(47.9 95.8% 90%);color:hsl(47.9 95.8% 30%)}.feedback-status.svelte-ds9yw.svelte-ds9yw{font-weight:500;font-size:0.75rem}.feedback-status.success.svelte-ds9yw.svelte-ds9yw{color:hsl(142.1 76.2% 36.3%)}.feedback-status.close.svelte-ds9yw.svelte-ds9yw{color:hsl(47.9 95.8% 45%)}.detection-display.svelte-ds9yw.svelte-ds9yw{display:flex;flex-direction:column;gap:1rem}.detection-card.svelte-ds9yw.svelte-ds9yw{display:inline-flex;align-items:baseline;gap:0.5rem;padding:1rem 1.5rem;background:hsl(0 0% 100%);border:1px solid hsl(214.3 31.8% 91.4%);border-radius:8px;width:fit-content}.detected-frequency{font-weight:600 !important;font-size:2rem !important;color:hsl(222.2 84% 4.9%) !important;font-family:'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', \n                 'JetBrains Mono', 'Fira Code', 'Consolas', monospace !important;min-width:4ch !important;text-align:right !important;display:inline-block !important;font-variant-numeric:tabular-nums !important;-webkit-font-smoothing:antialiased !important;-moz-osx-font-smoothing:grayscale !important}.hz-suffix{font-weight:600 !important;font-size:2rem !important;color:hsl(222.2 84% 4.9%) !important}.divider{color:hsl(214.3 31.8% 70%) !important;font-size:1.5rem !important;margin:0 0.25rem !important;font-weight:300 !important}.detected-note{font-weight:600 !important;font-size:2rem !important;color:hsl(215.4 16.3% 46.9%) !important;font-family:'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', \n                 'JetBrains Mono', 'Fira Code', 'Consolas', monospace !important;min-width:3ch !important;display:inline-block !important;text-align:center !important}.volume-bar{border-radius:4px !important}.detected-info.svelte-ds9yw.svelte-ds9yw{display:flex;align-items:center;gap:0.5rem;font-size:0.875rem}.detected-label.svelte-ds9yw.svelte-ds9yw{color:hsl(215.4 16.3% 46.9%)}.detected-frequency.svelte-ds9yw.svelte-ds9yw{font-weight:700;font-size:1.25rem;color:hsl(222.2 84% 4.9%);margin-right:0.5rem}.detected-note.svelte-ds9yw.svelte-ds9yw{font-weight:500;font-size:0.875rem;color:hsl(215.4 16.3% 46.9%);margin-right:0.25rem}.pitch-diff.svelte-ds9yw.svelte-ds9yw{color:hsl(47.9 95.8% 40%);font-weight:500;margin-left:0.25rem}.volume-section.svelte-ds9yw.svelte-ds9yw{display:flex;flex-direction:column;gap:0.5rem}.volume-label.svelte-ds9yw.svelte-ds9yw{font-size:0.875rem;color:hsl(215.4 16.3% 46.9%)}.modern-volume-bar{border-radius:4px !important}.results-summary.svelte-ds9yw.svelte-ds9yw{display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:1rem;margin-bottom:2rem}.result-item.svelte-ds9yw.svelte-ds9yw{text-align:center;padding:1rem;border-radius:6px;background:hsl(0 0% 100%);border:1px solid hsl(214.3 31.8% 91.4%)}.result-label.svelte-ds9yw.svelte-ds9yw{display:block;font-size:0.875rem;color:hsl(215.4 16.3% 46.9%);margin-bottom:0.25rem}.result-value.svelte-ds9yw.svelte-ds9yw{display:block;font-size:1.5rem;font-weight:700;color:hsl(222.2 84% 4.9%)}.result-value.success.svelte-ds9yw.svelte-ds9yw{color:hsl(142.1 76.2% 36.3%)}.detailed-results.svelte-ds9yw.svelte-ds9yw{margin-top:2rem}.detailed-title.svelte-ds9yw.svelte-ds9yw{font-size:1rem;font-weight:600;color:hsl(222.2 84% 4.9%);margin-bottom:1rem;text-align:center}.scale-results.svelte-ds9yw.svelte-ds9yw{display:flex;flex-direction:column;gap:0.5rem}.scale-result-item.svelte-ds9yw.svelte-ds9yw{display:grid;grid-template-columns:1fr auto auto auto;gap:1rem;padding:0.75rem;border-radius:6px;border:1px solid hsl(214.3 31.8% 91.4%);background:hsl(0 0% 100%);align-items:center}.scale-result-item.correct.svelte-ds9yw.svelte-ds9yw{background:hsl(142.1 76.2% 95%);border-color:hsl(142.1 76.2% 80%)}.scale-result-item.incorrect.svelte-ds9yw.svelte-ds9yw{background:hsl(0 84.2% 95%);border-color:hsl(0 84.2% 80%)}.scale-name.svelte-ds9yw.svelte-ds9yw{font-weight:600;color:hsl(222.2 84% 4.9%)}.scale-accuracy.svelte-ds9yw.svelte-ds9yw{font-weight:500;font-family:'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;color:hsl(215.4 16.3% 46.9%)}.scale-cents.svelte-ds9yw.svelte-ds9yw{font-weight:500;font-family:'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;color:hsl(215.4 16.3% 46.9%);font-size:0.875rem}.scale-status.svelte-ds9yw.svelte-ds9yw{text-align:center;font-size:1.125rem}.action-buttons.svelte-ds9yw.svelte-ds9yw{display:flex;gap:0.75rem;justify-content:center;flex-wrap:wrap}.restart-button,.new-base-button{min-width:160px !important;font-weight:500 !important}.common-actions.svelte-ds9yw.svelte-ds9yw{display:flex;gap:0.75rem;justify-content:center;flex-wrap:wrap;margin-top:1.5rem}.error-content.svelte-ds9yw.svelte-ds9yw{text-align:center;padding:2rem 1rem}.error-icon.svelte-ds9yw.svelte-ds9yw,.loading-icon.svelte-ds9yw.svelte-ds9yw{font-size:3rem;margin-bottom:1rem}.error-content.svelte-ds9yw h3.svelte-ds9yw{font-size:1.25rem;font-weight:600;color:hsl(222.2 84% 4.9%);margin-bottom:0.5rem}.error-content.svelte-ds9yw p.svelte-ds9yw{color:hsl(215.4 16.3% 46.9%);margin-bottom:1rem}.recommendation.svelte-ds9yw.svelte-ds9yw{background:hsl(210 40% 98%);border:1px solid hsl(214.3 31.8% 91.4%);border-radius:6px;padding:1rem;margin:1rem 0}.recommendation.svelte-ds9yw p.svelte-ds9yw{margin:0;font-size:0.875rem}@media(min-width: 768px){.scale-guide.svelte-ds9yw.svelte-ds9yw{grid-template-columns:repeat(8, 1fr)}.page-title.svelte-ds9yw.svelte-ds9yw{font-size:2.5rem}.results-summary.svelte-ds9yw.svelte-ds9yw{grid-template-columns:repeat(3, 1fr)}}@media(max-width: 640px){.status-content.svelte-ds9yw.svelte-ds9yw{flex-direction:column;gap:0.5rem}.action-buttons.svelte-ds9yw.svelte-ds9yw{flex-direction:column}.primary-button,.secondary-button{min-width:100% !important}}.warning-card{border:2px solid #fbbf24 !important;background:#fef3c7 !important;margin-bottom:24px !important}.warning-message.svelte-ds9yw.svelte-ds9yw{color:#92400e;margin-bottom:12px}.error-list.svelte-ds9yw.svelte-ds9yw{color:#dc2626;margin:12px 0;padding-left:20px}.error-list.svelte-ds9yw li.svelte-ds9yw{margin-bottom:4px;font-family:monospace;font-size:14px}.fix-instruction.svelte-ds9yw.svelte-ds9yw{color:#059669;margin-top:12px;padding:8px;background:#d1fae5;border-radius:4px;border-left:4px solid #059669}",
  map: `{"version":3,"file":"+page.svelte","sources":["+page.svelte"],"sourcesContent":["<script>\\n  import { onMount, onDestroy } from 'svelte';\\n  import { goto } from '$app/navigation';\\n  import { base } from '$app/paths';\\n  import { page } from '$app/stores';\\n  import Card from '$lib/components/Card.svelte';\\n  import Button from '$lib/components/Button.svelte';\\n  import VolumeBar from '$lib/components/VolumeBar.svelte';\\n  import PitchDisplay from '$lib/components/PitchDisplay.svelte';\\n  import PitchDetector from '$lib/components/PitchDetector.svelte';\\n  import PageLayout from '$lib/components/PageLayout.svelte';\\n  import * as Tone from 'tone';\\n  import { audioManager } from '$lib/audio/AudioManager.js';\\n\\n  // åŸºæœ¬çŠ¶æ…‹ç®¡ç†\\n  let trainingPhase = 'setup'; // 'setup' | 'listening' | 'waiting' | 'guiding' | 'results'\\n  \\n  // ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‹ã‚‰ã®é·ç§»ã‚’æ—©æœŸæ¤œå‡º\\n  let microphoneState = (() => {\\n    if (typeof window !== 'undefined') {\\n      const urlParams = new URLSearchParams(window.location.search);\\n      if (urlParams.get('from') === 'microphone-test') {\\n        console.log('ğŸ¤ [RandomTraining] æ—©æœŸæ¤œå‡º: ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‹ã‚‰ã®é·ç§»');\\n        return 'granted';\\n      } else {\\n        console.log('ğŸ¤ [RandomTraining] ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚’æ¤œå‡º');\\n        return 'checking';\\n      }\\n    }\\n    return 'checking';\\n  })(); // 'checking' | 'granted' | 'denied' | 'error'\\n  \\n  // ã‚·ãƒ³ãƒ—ãƒ«ãªçŠ¶æ…‹ç®¡ç†\\n  let microphoneHealthy = true; // ãƒã‚¤ã‚¯å¥åº·çŠ¶æ…‹\\n  let microphoneErrors = []; // ãƒã‚¤ã‚¯ã‚¨ãƒ©ãƒ¼è©³ç´°\\n  \\n  // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ï¼ˆå¼·åˆ¶æ›´æ–°ï¼‰\\n  const buildVersion = \\"v1.3.2-FORCE\\";\\n  const buildTimestamp = \\"07/27 02:20\\";\\n  const updateStatus = \\"ğŸ”¥ ROSEè‰²ä¿®æ­£ãƒ»éŸ³æºå‰Šé™¤ãƒ»è©•ä¾¡æ”¹å–„\\";\\n  \\n  // åŸºéŸ³é–¢é€£\\n  let currentBaseNote = '';\\n  let currentBaseFrequency = 0;\\n  let isPlaying = false;\\n  \\n  // éŸ³ç¨‹ã‚¬ã‚¤ãƒ‰\\n  let currentScaleIndex = 0;\\n  let scaleSteps = [\\n    { name: 'ãƒ‰', state: 'inactive', completed: false },\\n    { name: 'ãƒ¬', state: 'inactive', completed: false },\\n    { name: 'ãƒŸ', state: 'inactive', completed: false },\\n    { name: 'ãƒ•ã‚¡', state: 'inactive', completed: false },\\n    { name: 'ã‚½', state: 'inactive', completed: false },\\n    { name: 'ãƒ©', state: 'inactive', completed: false },\\n    { name: 'ã‚·', state: 'inactive', completed: false },\\n    { name: 'ãƒ‰ï¼ˆé«˜ï¼‰', state: 'inactive', completed: false }\\n  ];\\n  \\n  // ã‚¬ã‚¤ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡\\n  let guideAnimationTimer = null;\\n  let isGuideAnimationActive = false;\\n  \\n  // è£ã§ã®è©•ä¾¡è“„ç©\\n  let scaleEvaluations = [];\\n  \\n  // å‰å›ã®çµæœä¿æŒï¼ˆå†æŒ‘æˆ¦æ™‚è¡¨ç¤ºç”¨ï¼‰\\n  let previousEvaluations = [];\\n  \\n  // éŸ³ç¨‹æ¤œå‡º\\n  let currentVolume = 0;\\n  let currentFrequency = 0;\\n  let detectedNote = 'ãƒ¼ãƒ¼';\\n  let pitchDifference = 0;\\n  \\n  // ã‚»ãƒƒã‚·ãƒ§ãƒ³çµæœ\\n  let sessionResults = {\\n    correctCount: 0,\\n    totalCount: 8,\\n    averageAccuracy: 0,\\n    averageTime: 0,\\n    isCompleted: false\\n  };\\n  \\n  // Tone.jsã‚µãƒ³ãƒ—ãƒ©ãƒ¼\\n  let sampler = null;\\n  let isLoading = true;\\n  \\n  // éŸ³ç¨‹æ¤œå‡ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\\n  let pitchDetectorComponent = null;\\n  \\n  // AudioManagerå¯¾å¿œå¤‰æ•°\\n  let mediaStream = null;   // AudioManagerã‹ã‚‰å–å¾—\\n  let audioContext = null;  // AudioManagerã‹ã‚‰å–å¾—\\n  let sourceNode = null;    // AudioManagerã‹ã‚‰å–å¾—\\n\\n  // åŸºéŸ³å€™è£œï¼ˆå­˜åœ¨ã™ã‚‹éŸ³æºãƒ•ã‚¡ã‚¤ãƒ«ã«åˆã‚ã›ãŸ10ç¨®é¡ï¼‰\\n  const baseNotes = [\\n    { note: 'C4', name: 'ãƒ‰ï¼ˆä¸­ï¼‰', frequency: 261.63 },\\n    { note: 'Db4', name: 'ãƒ‰#ï¼ˆä¸­ï¼‰', frequency: 277.18 },\\n    { note: 'D4', name: 'ãƒ¬ï¼ˆä¸­ï¼‰', frequency: 293.66 },\\n    { note: 'Eb4', name: 'ãƒ¬#ï¼ˆä¸­ï¼‰', frequency: 311.13 },\\n    { note: 'E4', name: 'ãƒŸï¼ˆä¸­ï¼‰', frequency: 329.63 },\\n    { note: 'F4', name: 'ãƒ•ã‚¡ï¼ˆä¸­ï¼‰', frequency: 349.23 },\\n    { note: 'Gb4', name: 'ãƒ•ã‚¡#ï¼ˆä¸­ï¼‰', frequency: 369.99 },\\n    { note: 'Ab4', name: 'ãƒ©bï¼ˆä¸­ï¼‰', frequency: 415.30 },\\n    { note: 'Bb3', name: 'ã‚·bï¼ˆä½ï¼‰', frequency: 233.08 },\\n    { note: 'B3', name: 'ã‚·ï¼ˆä½ï¼‰', frequency: 246.94 }\\n  ];\\n\\n  // ãƒã‚¤ã‚¯è¨±å¯ç¢ºèªï¼ˆAudioManagerå¯¾å¿œç‰ˆï¼‰\\n  async function checkMicrophonePermission() {\\n    microphoneState = 'checking';\\n    \\n    try {\\n      console.log('ğŸ¤ [RandomTraining] AudioManagerçµŒç”±ã§ãƒã‚¤ã‚¯è¨±å¯ç¢ºèªé–‹å§‹');\\n      \\n      if (!navigator.mediaDevices?.getUserMedia) {\\n        microphoneState = 'error';\\n        return;\\n      }\\n      \\n      // AudioManagerã‹ã‚‰å…±æœ‰ãƒªã‚½ãƒ¼ã‚¹ã‚’å–å¾—ï¼ˆé‡è¤‡å–å¾—ã¯å®‰å…¨ï¼‰\\n      const resources = await audioManager.initialize();\\n      audioContext = resources.audioContext;\\n      mediaStream = resources.mediaStream;\\n      sourceNode = resources.sourceNode;\\n      \\n      console.log('âœ… [RandomTraining] AudioManager ãƒªã‚½ãƒ¼ã‚¹å–å¾—å®Œäº†');\\n      \\n      microphoneState = 'granted';\\n      trainingPhase = 'setup';\\n      \\n      // PitchDetectoråˆæœŸåŒ–ï¼ˆå¤–éƒ¨AudioContextæ–¹å¼ï¼‰\\n      setTimeout(async () => {\\n        if (pitchDetectorComponent) {\\n          console.log('ğŸ™ï¸ [RandomTraining] PitchDetectoråˆæœŸåŒ–é–‹å§‹');\\n          await pitchDetectorComponent.initialize();\\n          console.log('âœ… [RandomTraining] PitchDetectoråˆæœŸåŒ–å®Œäº†');\\n        }\\n      }, 200);\\n      \\n    } catch (error) {\\n      console.error('âŒ [RandomTraining] ãƒã‚¤ã‚¯è¨±å¯ã‚¨ãƒ©ãƒ¼:', error);\\n      microphoneState = (error?.name === 'NotAllowedError') ? 'denied' : 'error';\\n    }\\n  }\\n\\n  // ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³é¸æŠ\\n  function selectRandomBaseNote() {\\n    const randomIndex = Math.floor(Math.random() * baseNotes.length);\\n    const selectedNote = baseNotes[randomIndex];\\n    currentBaseNote = selectedNote.name;\\n    currentBaseFrequency = selectedNote.frequency;\\n  }\\n\\n  // ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³å†ç”Ÿï¼ˆæ–°ã—ã„åŸºéŸ³ã‚’é¸æŠï¼‰\\n  async function playRandomBaseNote() {\\n    if (isPlaying || !sampler || isLoading) return;\\n    \\n    // ãƒã‚¤ã‚¯è¨±å¯ãŒæœªå–å¾—ã®å ´åˆã¯å…ˆã«è¨±å¯ã‚’å–å¾—\\n    if (microphoneState !== 'granted') {\\n      console.log('ğŸ¤ [RandomTraining] ãƒã‚¤ã‚¯è¨±å¯ãŒå¿…è¦ã§ã™ã€‚è¨±å¯å–å¾—ã‚’é–‹å§‹...');\\n      try {\\n        await checkMicrophonePermission();\\n        console.log('ğŸ¤ [RandomTraining] ãƒã‚¤ã‚¯è¨±å¯å–å¾—å®Œäº†');\\n      } catch (error) {\\n        console.error('âŒ ãƒã‚¤ã‚¯è¨±å¯ã‚¨ãƒ©ãƒ¼:', error);\\n        return;\\n      }\\n    }\\n    \\n    // AudioManagerãƒªã‚½ãƒ¼ã‚¹ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ãªã„å ´åˆã®ã¿åˆæœŸåŒ–\\n    if (!mediaStream && microphoneState === 'granted') {\\n      console.log('ğŸ¤ [RandomTraining] AudioManagerãƒªã‚½ãƒ¼ã‚¹æœªåˆæœŸåŒ–ã®ãŸã‚å–å¾—ã—ã¾ã™');\\n      try {\\n        await checkMicrophonePermission();\\n      } catch (error) {\\n        console.error('âŒ AudioManagerãƒªã‚½ãƒ¼ã‚¹åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);\\n        return;\\n      }\\n    } else if (mediaStream) {\\n      console.log('ğŸ¤ [RandomTraining] AudioManagerãƒªã‚½ãƒ¼ã‚¹æ—¢å­˜ã®ãŸã‚å†åˆ©ç”¨');\\n    }\\n    \\n    // å³åº§ã«çŠ¶æ…‹å¤‰æ›´\\n    isPlaying = true;\\n    trainingPhase = 'listening';\\n    selectRandomBaseNote(); // æ–°ã—ã„ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ã‚’é¸æŠ\\n    \\n    // éŸ³å£°å†ç”Ÿ\\n    const note = baseNotes.find(n => n.name === currentBaseNote).note;\\n    sampler.triggerAttackRelease(note, 2, Tone.now(), 0.7);\\n    \\n    // 2.5ç§’å¾Œã«ã‚¬ã‚¤ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹\\n    setTimeout(() => {\\n      isPlaying = false;\\n      trainingPhase = 'waiting';\\n      setTimeout(() => startGuideAnimation(), 500);\\n    }, 2000);\\n  }\\n\\n  // ç¾åœ¨ã®åŸºéŸ³å†ç”Ÿï¼ˆæ—¢å­˜ã®åŸºéŸ³ã‚’å†åˆ©ç”¨ï¼‰\\n  async function playCurrentBaseNote() {\\n    if (isPlaying || !sampler || isLoading || !currentBaseNote) return;\\n    \\n    // ãƒã‚¤ã‚¯è¨±å¯ãŒæœªå–å¾—ã®å ´åˆã¯å…ˆã«è¨±å¯ã‚’å–å¾—\\n    if (microphoneState !== 'granted') {\\n      console.log('ğŸ¤ [RandomTraining] ãƒã‚¤ã‚¯è¨±å¯ãŒå¿…è¦ã§ã™ã€‚è¨±å¯å–å¾—ã‚’é–‹å§‹...');\\n      try {\\n        await checkMicrophonePermission();\\n        console.log('ğŸ¤ [RandomTraining] ãƒã‚¤ã‚¯è¨±å¯å–å¾—å®Œäº†');\\n      } catch (error) {\\n        console.error('âŒ ãƒã‚¤ã‚¯è¨±å¯ã‚¨ãƒ©ãƒ¼:', error);\\n        return;\\n      }\\n    }\\n    \\n    // AudioManagerãƒªã‚½ãƒ¼ã‚¹ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ãªã„å ´åˆã®ã¿åˆæœŸåŒ–\\n    if (!mediaStream && microphoneState === 'granted') {\\n      console.log('ğŸ¤ [RandomTraining] AudioManagerãƒªã‚½ãƒ¼ã‚¹æœªåˆæœŸåŒ–ã®ãŸã‚å–å¾—ã—ã¾ã™');\\n      try {\\n        await checkMicrophonePermission();\\n      } catch (error) {\\n        console.error('âŒ AudioManagerãƒªã‚½ãƒ¼ã‚¹åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);\\n        return;\\n      }\\n    } else if (mediaStream) {\\n      console.log('ğŸ¤ [RandomTraining] AudioManagerãƒªã‚½ãƒ¼ã‚¹æ—¢å­˜ã®ãŸã‚å†åˆ©ç”¨');\\n    }\\n    \\n    // å³åº§ã«çŠ¶æ…‹å¤‰æ›´\\n    isPlaying = true;\\n    trainingPhase = 'listening';\\n    // selectRandomBaseNote() ã¯å‘¼ã°ãªã„ - æ—¢å­˜ã®åŸºéŸ³ã‚’ä¿æŒ\\n    \\n    // éŸ³å£°å†ç”Ÿ\\n    const note = baseNotes.find(n => n.name === currentBaseNote).note;\\n    sampler.triggerAttackRelease(note, 2, Tone.now(), 0.7);\\n    \\n    // 2.5ç§’å¾Œã«ã‚¬ã‚¤ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹\\n    setTimeout(() => {\\n      isPlaying = false;\\n      trainingPhase = 'waiting';\\n      setTimeout(() => startGuideAnimation(), 500);\\n    }, 2000);\\n  }\\n\\n  // åŸºéŸ³å†ç”Ÿï¼ˆçµ±åˆé–¢æ•° - çŠ¶æ³ã«å¿œã˜ã¦é©åˆ‡ãªé–¢æ•°ã‚’å‘¼ã³åˆ†ã‘ï¼‰\\n  function playBaseNote() {\\n    if (currentBaseNote && currentBaseFrequency > 0) {\\n      // æ—¢ã«åŸºéŸ³ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯æ—¢å­˜ã®åŸºéŸ³ã‚’å†ç”Ÿ\\n      playCurrentBaseNote();\\n    } else {\\n      // åŸºéŸ³ãŒæœªè¨­å®šã®å ´åˆã¯æ–°ã—ã„ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ã‚’é¸æŠ\\n      playRandomBaseNote();\\n    }\\n  }\\n\\n  // ã‚¬ã‚¤ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ï¼ˆç°¡ç´ ç‰ˆï¼‰\\n  function startGuideAnimation() {\\n    // ã‚·ãƒ³ãƒ—ãƒ«ãªçŠ¶æ…‹å¤‰æ›´ã®ã¿\\n    trainingPhase = 'guiding';\\n    currentScaleIndex = 0;\\n    isGuideAnimationActive = true;\\n    scaleEvaluations = [];\\n    \\n    // å„ã‚¹ãƒ†ãƒƒãƒ—ã‚’é †æ¬¡ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆ1ç§’é–“éš”ï¼‰\\n    function animateNextStep() {\\n      if (currentScaleIndex < scaleSteps.length) {\\n        // å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«\\n        if (currentScaleIndex > 0) {\\n          scaleSteps[currentScaleIndex - 1].state = 'inactive';\\n        }\\n        \\n        // ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«\\n        scaleSteps[currentScaleIndex].state = 'active';\\n        \\n        currentScaleIndex++;\\n        \\n        // 0.6ç§’å¾Œã«æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆãƒ†ãƒ³ãƒã‚¢ãƒƒãƒ—ï¼‰\\n        guideAnimationTimer = setTimeout(animateNextStep, 600);\\n      } else {\\n        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†\\n        finishGuideAnimation();\\n      }\\n    }\\n    \\n    animateNextStep();\\n  }\\n  \\n  // ã‚¬ã‚¤ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†\\n  function finishGuideAnimation() {\\n    isGuideAnimationActive = false;\\n    \\n    // æœ€å¾Œã®ã‚¹ãƒ†ãƒƒãƒ—ã‚‚éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«\\n    if (scaleSteps.length > 0) {\\n      scaleSteps[scaleSteps.length - 1].state = 'inactive';\\n    }\\n    \\n    // éŸ³ç¨‹æ¤œå‡ºåœæ­¢\\n    if (pitchDetectorComponent) {\\n      pitchDetectorComponent.stopDetection();\\n    }\\n    \\n    // æ¡ç‚¹çµæœã‚’è¨ˆç®—ã—ã¦è¡¨ç¤º\\n    calculateFinalResults();\\n    trainingPhase = 'results';\\n  }\\n  \\n  // æœ€çµ‚æ¡ç‚¹çµæœè¨ˆç®—\\n  function calculateFinalResults() {\\n    let correctCount = 0;\\n    let totalAccuracy = 0;\\n    \\n    scaleEvaluations.forEach(evaluation => {\\n      if (evaluation.isCorrect) {\\n        correctCount++;\\n      }\\n      totalAccuracy += evaluation.accuracy;\\n    });\\n    \\n    sessionResults = {\\n      correctCount: correctCount,\\n      totalCount: scaleSteps.length,\\n      averageAccuracy: scaleEvaluations.length > 0 ? Math.round(totalAccuracy / scaleEvaluations.length) : 0,\\n      averageTime: 0, // ä»Šå›ã¯æ™‚é–“æ¸¬å®šãªã—\\n      isCompleted: true\\n    };\\n    \\n    // å‰å›ã®çµæœã¨ã—ã¦ä¿å­˜ï¼ˆå†æŒ‘æˆ¦æ™‚è¡¨ç¤ºç”¨ï¼‰\\n    if (scaleEvaluations.length > 0) {\\n      previousEvaluations = [...scaleEvaluations];\\n    }\\n  }\\n\\n  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—\\n  function getStatusMessage() {\\n    switch (trainingPhase) {\\n      case 'setup':\\n        if (isLoading || !sampler) {\\n          return 'ğŸµ éŸ³æºèª­ã¿è¾¼ã¿ä¸­...';\\n        } else {\\n          return 'ğŸ¤ ãƒã‚¤ã‚¯æº–å‚™å®Œäº† - ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é–‹å§‹å¯èƒ½';\\n        }\\n      case 'listening':\\n        return 'ğŸµ åŸºéŸ³å†ç”Ÿä¸­...';\\n      case 'waiting':\\n        return 'â³ é–“ã‚‚ãªãé–‹å§‹...';\\n      case 'guiding':\\n        return 'ğŸ™ï¸ ã‚¬ã‚¤ãƒ‰ã«åˆã‚ã›ã¦ãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚·ãƒ‰ã‚’æ­Œã£ã¦ãã ã•ã„';\\n      case 'results':\\n        return 'ğŸ‰ æ¡ç‚¹çµæœ';\\n      default:\\n        return 'ğŸ”„ æº–å‚™ä¸­...';\\n    }\\n  }\\n\\n  // è¡¨ç¤ºç”¨ã®è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\\n  function getDisplayEvaluations() {\\n    // ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º\\n    if (scaleEvaluations.length > 0) {\\n      return scaleEvaluations;\\n    }\\n    // ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯å‰å›ã®çµæœã‚’è¡¨ç¤º\\n    if (previousEvaluations.length > 0) {\\n      return previousEvaluations;\\n    }\\n    return [];\\n  }\\n\\n  // ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã¸ã®èª˜å°ï¼ˆSvelteKit gotoä½¿ç”¨ï¼‰\\n  function goToMicrophoneTest() {\\n    goto(\`\${base}/microphone-test\`);\\n  }\\n\\n  // ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹ï¼ˆSvelteKit gotoä½¿ç”¨ï¼‰\\n  function goHome() {\\n    goto(\`\${base}/\`);\\n  }\\n\\n  // Tone.jsã‚µãƒ³ãƒ—ãƒ©ãƒ¼åˆæœŸåŒ–ï¼ˆSalamander Grand Piano - æœ€é©åŒ–ç‰ˆï¼‰\\n  async function initializeSampler() {\\n    try {\\n      isLoading = true;\\n      \\n      // AudioContextã¯åˆå›å†ç”Ÿæ™‚ã«èµ·å‹•ï¼ˆå®‰å…¨ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼‰\\n      \\n      // Salamander Grand Piano C4éŸ³æºã‹ã‚‰ãƒ”ãƒƒãƒã‚·ãƒ•ãƒˆï¼ˆæœ€é©åŒ–è¨­å®šï¼‰\\n      sampler = new Tone.Sampler({\\n        urls: {\\n          'C4': 'C4.mp3',\\n        },\\n        baseUrl: \`\${base}/audio/piano/\`,\\n        release: 1.5, // ãƒªãƒªãƒ¼ã‚¹æ™‚é–“æœ€é©åŒ–\\n        onload: () => {\\n          isLoading = false;\\n        },\\n        onerror: (error) => {\\n          console.error('âŒ Salamander PianoéŸ³æºèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);\\n          isLoading = false;\\n        }\\n      }).toDestination();\\n      \\n      // éŸ³é‡èª¿æ•´\\n      sampler.volume.value = -6; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ˆã‚Šå°‘ã—ä¸‹ã’ã‚‹\\n      \\n    } catch (error) {\\n      console.error('ã‚µãƒ³ãƒ—ãƒ©ãƒ¼åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);\\n      isLoading = false;\\n    }\\n  }\\n  \\n  // ãƒã‚¤ã‚¯è¨±å¯çŠ¶æ…‹ç¢ºèªï¼ˆå–å¾—ã¯ã—ãªã„ï¼‰\\n  async function checkExistingMicrophonePermission() {\\n    try {\\n      // Permissions API ã§ãƒã‚¤ã‚¯è¨±å¯çŠ¶æ…‹ã‚’ç¢ºèªï¼ˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¯å‡ºãªã„ï¼‰\\n      const permissionStatus = await navigator.permissions.query({ name: 'microphone' });\\n      \\n      if (permissionStatus.state === 'granted') {\\n        // æ—¢ã«è¨±å¯æ¸ˆã¿ã®å ´åˆã®ã¿ã‚¹ãƒˆãƒªãƒ¼ãƒ å–å¾—\\n        await checkMicrophonePermission();\\n      } else {\\n        // æœªè¨±å¯ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ç”»é¢è¡¨ç¤º\\n        microphoneState = 'denied';\\n      }\\n    } catch (error) {\\n      // Permissions API æœªå¯¾å¿œã®å ´åˆã¯å¾“æ¥ã®æ–¹æ³•\\n      microphoneState = 'denied';\\n    }\\n  }\\n\\n  // åˆæœŸåŒ–\\n  onMount(async () => {\\n    // éŸ³æºåˆæœŸåŒ–\\n    initializeSampler();\\n    \\n    // ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‹ã‚‰æ¥ãŸå ´åˆã¯è¨±å¯æ¸ˆã¿ã¨ã—ã¦æ‰±ã†\\n    if ($page.url.searchParams.get('from') === 'microphone-test') {\\n      console.log('ğŸ¤ [RandomTraining] ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‹ã‚‰ã®é·ç§»ã‚’æ¤œå‡º');\\n      \\n      // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰Šé™¤ï¼ˆãŠæ°—ã«å…¥ã‚Šç™»éŒ²æ™‚ã®å•é¡Œå›é¿ï¼‰\\n      const url = new URL(window.location);\\n      url.searchParams.delete('from');\\n      window.history.replaceState({}, '', url);\\n      \\n      // ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‹ã‚‰æ¥ãŸå ´åˆã¯è¨±å¯æ¸ˆã¿ã¨ã—ã¦æ‰±ã„ã€ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’æº–å‚™\\n      microphoneState = 'granted';\\n      trainingPhase = 'setup';\\n      console.log('ğŸ¤ [RandomTraining] microphoneState=\\"granted\\", trainingPhase=\\"setup\\" ã«è¨­å®š');\\n      \\n      // AudioManagerãƒªã‚½ãƒ¼ã‚¹ã®äº‹å‰å–å¾—ï¼ˆã‚¹ãƒ ãƒ¼ã‚ºãªå†ç”Ÿã®ãŸã‚ï¼‰\\n      setTimeout(async () => {\\n        if (!mediaStream) {\\n          console.log('ğŸ¤ [RandomTraining] äº‹å‰AudioManagerãƒªã‚½ãƒ¼ã‚¹å–å¾—é–‹å§‹');\\n          try {\\n            await checkMicrophonePermission();\\n            console.log('ğŸ¤ [RandomTraining] äº‹å‰AudioManagerãƒªã‚½ãƒ¼ã‚¹å–å¾—å®Œäº†');\\n          } catch (error) {\\n            console.warn('âš ï¸ äº‹å‰AudioManagerãƒªã‚½ãƒ¼ã‚¹å–å¾—å¤±æ•—ï¼ˆå¾Œã§å†è©¦è¡Œï¼‰:', error);\\n          }\\n        }\\n      }, 100);\\n      return;\\n    }\\n    \\n    // ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®ã¿ãƒã‚¤ã‚¯è¨±å¯çŠ¶æ…‹ç¢ºèª\\n    await new Promise(resolve => setTimeout(resolve, 100));\\n    checkExistingMicrophonePermission();\\n  });\\n  \\n  // PitchDetectorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼\\n  function handlePitchUpdate(event) {\\n    const { frequency, note, volume, rawVolume, clarity } = event.detail;\\n    \\n    currentFrequency = frequency;\\n    detectedNote = note;\\n    currentVolume = volume;\\n    \\n    // åŸºéŸ³ã¨ã®ç›¸å¯¾éŸ³ç¨‹ã‚’è¨ˆç®—\\n    if (currentBaseFrequency > 0 && frequency > 0) {\\n      pitchDifference = Math.round(1200 * Math.log2(frequency / currentBaseFrequency));\\n    } else {\\n      pitchDifference = 0;\\n    }\\n    \\n    // ã‚¬ã‚¤ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã®è©•ä¾¡è“„ç©\\n    evaluateScaleStep(frequency, note);\\n  }\\n  \\n  // è£ã§ã®è©•ä¾¡è“„ç©ï¼ˆã‚¬ã‚¤ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ï¼‰\\n  function evaluateScaleStep(frequency, note) {\\n    if (!frequency || frequency <= 0 || !currentBaseFrequency || !isGuideAnimationActive) {\\n      return;\\n    }\\n    \\n    // ç¾åœ¨ãƒã‚¤ãƒ©ã‚¤ãƒˆä¸­ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’å–å¾—ï¼ˆcurrentScaleIndex - 1ãŒå®Ÿéš›ã«ãƒã‚¤ãƒ©ã‚¤ãƒˆä¸­ï¼‰\\n    const activeStepIndex = currentScaleIndex - 1;\\n    if (activeStepIndex < 0 || activeStepIndex >= scaleSteps.length) {\\n      return;\\n    }\\n    \\n    // æœŸå¾…ã•ã‚Œã‚‹å‘¨æ³¢æ•°ã‚’è¨ˆç®—ï¼ˆåŸºéŸ³ã‹ã‚‰ã®ç›¸å¯¾éŸ³ç¨‹ï¼‰\\n    const scaleIntervals = [0, 2, 4, 5, 7, 9, 11, 12]; // ãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚·ãƒ‰ï¼ˆåŠéŸ³ï¼‰\\n    const expectedInterval = scaleIntervals[activeStepIndex] * 100; // ã‚»ãƒ³ãƒˆ\\n    const expectedFrequency = currentBaseFrequency * Math.pow(2, expectedInterval / 1200);\\n    \\n    // éŸ³ç¨‹å·®ã‚’è¨ˆç®—ï¼ˆã‚»ãƒ³ãƒˆï¼‰\\n    const centDifference = Math.round(1200 * Math.log2(frequency / expectedFrequency));\\n    \\n    // åˆ¤å®šåŸºæº–ï¼ˆÂ±50ã‚»ãƒ³ãƒˆä»¥å†…ã§æ­£è§£ï¼‰\\n    const tolerance = 50;\\n    const isCorrect = Math.abs(centDifference) <= tolerance;\\n    \\n    // æœ€ä½éŸ³é‡åŸºæº–ï¼ˆãƒã‚¤ã‚ºé™¤å¤–ï¼‰\\n    const minVolumeForDetection = 15;\\n    const hasEnoughVolume = currentVolume >= minVolumeForDetection;\\n    \\n    if (hasEnoughVolume) {\\n      // ç²¾åº¦è¨ˆç®—ï¼ˆ100 - |centDifference|ã®å‰²åˆï¼‰\\n      const accuracy = Math.max(0, Math.round(100 - Math.abs(centDifference)));\\n      \\n      // è©•ä¾¡ã‚’è“„ç©ï¼ˆä¸Šæ›¸ãã—ã¦æœ€æ–°ã®è©•ä¾¡ã‚’ä¿æŒï¼‰\\n      const existingIndex = scaleEvaluations.findIndex(evaluation => evaluation.stepIndex === activeStepIndex);\\n      const evaluation = {\\n        stepIndex: activeStepIndex,\\n        stepName: scaleSteps[activeStepIndex].name,\\n        expectedFrequency: Math.round(expectedFrequency),\\n        detectedFrequency: Math.round(frequency),\\n        centDifference: centDifference,\\n        accuracy: accuracy,\\n        isCorrect: isCorrect,\\n        timestamp: Date.now()\\n      };\\n      \\n      if (existingIndex >= 0) {\\n        scaleEvaluations[existingIndex] = evaluation;\\n      } else {\\n        scaleEvaluations.push(evaluation);\\n      }\\n      \\n      // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°å‰Šé™¤ï¼ˆã‚µã‚¤ãƒ¬ãƒ³ãƒˆè“„ç©ï¼‰\\n    }\\n  }\\n  \\n  // ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†å‡¦ç†\\n  function completeSession() {\\n    trainingPhase = 'completed';\\n    sessionResults.isCompleted = true;\\n    sessionResults.averageAccuracy = Math.round((sessionResults.correctCount / sessionResults.totalCount) * 100);\\n    \\n    // éŸ³ç¨‹æ¤œå‡ºåœæ­¢\\n    if (pitchDetectorComponent) {\\n      pitchDetectorComponent.stopDetection();\\n    }\\n  }\\n  \\n  // åŒã˜åŸºéŸ³ã§å†æŒ‘æˆ¦\\n  function restartSameBaseNote() {\\n    // 1. ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆå¼·åŒ–ç‰ˆï¼‰\\n    scrollToTop();\\n    \\n    // 2. UIçŠ¶æ…‹ã®ã¿å¤‰æ›´ï¼ˆå³åº§ç”»é¢é·ç§»ï¼‰\\n    trainingPhase = 'setup';\\n    \\n    // 3. æœ€å°é™ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\\n    if (guideAnimationTimer) {\\n      clearTimeout(guideAnimationTimer);\\n      guideAnimationTimer = null;\\n    }\\n    \\n    // 4. PitchDetectorã®è¡¨ç¤ºçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\\n    if (pitchDetectorComponent && pitchDetectorComponent.resetDisplayState) {\\n      pitchDetectorComponent.resetDisplayState();\\n    }\\n    \\n    // 5. ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆï¼ˆåŸºéŸ³ã¯ä¿æŒï¼‰\\n    resetSessionState();\\n    // æ³¨æ„: currentBaseNote ã¨ currentBaseFrequency ã¯ä¿æŒã•ã‚Œã‚‹\\n  }\\n  \\n  // é•ã†åŸºéŸ³ã§é–‹å§‹\\n  function restartDifferentBaseNote() {\\n    // 1. ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆå¼·åŒ–ç‰ˆï¼‰\\n    scrollToTop();\\n    \\n    // 2. UIçŠ¶æ…‹ã®ã¿å¤‰æ›´ï¼ˆå³åº§ç”»é¢é·ç§»ï¼‰\\n    trainingPhase = 'setup';\\n    \\n    // 3. æœ€å°é™ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\\n    if (guideAnimationTimer) {\\n      clearTimeout(guideAnimationTimer);\\n      guideAnimationTimer = null;\\n    }\\n    \\n    // 4. åŸºéŸ³æƒ…å ±ã‚‚ãƒªã‚»ãƒƒãƒˆ\\n    currentBaseNote = '';\\n    currentBaseFrequency = 0;\\n    \\n    // 5. PitchDetectorã®è¡¨ç¤ºçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\\n    if (pitchDetectorComponent && pitchDetectorComponent.resetDisplayState) {\\n      pitchDetectorComponent.resetDisplayState();\\n    }\\n    \\n    // 6. ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ\\n    resetSessionState();\\n  }\\n  \\n  // å¼·åŒ–ç‰ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é–¢æ•°ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§å¯¾å¿œï¼‰\\n  function scrollToTop() {\\n    try {\\n      // æ–¹æ³• 1: ãƒ¢ãƒ€ãƒ³ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¹ãƒ ãƒ¼ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«\\n      if ('scrollTo' in window && 'behavior' in document.documentElement.style) {\\n        window.scrollTo({ top: 0, behavior: 'smooth' });\\n      } else {\\n        // æ–¹æ³• 2: å¤ã„ãƒ–ãƒ©ã‚¦ã‚¶ã®å³åº§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«\\n        window.scrollTo(0, 0);\\n      }\\n      \\n      // æ–¹æ³• 3: document.body ã¨ documentElement ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\\n      if (document.body) {\\n        document.body.scrollTop = 0;\\n      }\\n      if (document.documentElement) {\\n        document.documentElement.scrollTop = 0;\\n      }\\n      \\n      // æ–¹æ³• 4: ãƒšãƒ¼ã‚¸å†…ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚³ãƒ³ãƒ†ãƒŠå¯¾å¿œ\\n      const scrollContainers = document.querySelectorAll('[data-scroll-container], .scroll-container, main');\\n      scrollContainers.forEach(container => {\\n        if (container.scrollTo) {\\n          container.scrollTo(0, 0);\\n        } else {\\n          container.scrollTop = 0;\\n        }\\n      });\\n      \\n    } catch (error) {\\n      console.warn('ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼:', error);\\n      // æœ€å¾Œã®æ‰‹æ®µ: å¼·åˆ¶çš„ãªãƒªãƒ­ãƒ¼ãƒ‰ã‚’é¿ã‘ã¦åŸºæœ¬çš„ãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«\\n      try {\\n        window.scroll(0, 0);\\n      } catch (fallbackError) {\\n        console.error('ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å®Œå…¨å¤±æ•—:', fallbackError);\\n      }\\n    }\\n  }\\n\\n  // ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ\\n  function resetSessionState() {\\n    currentScaleIndex = 0;\\n    isGuideAnimationActive = false;\\n    scaleEvaluations = []; // ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³è©•ä¾¡ã¯ã‚¯ãƒªã‚¢\\n    // previousEvaluations ã¯ä¿æŒï¼ˆå‰å›ã®çµæœã‚’æ®‹ã™ï¼‰\\n    \\n    // ã‚¹ã‚±ãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ãƒªã‚»ãƒƒãƒˆ\\n    scaleSteps = scaleSteps.map(step => ({\\n      ...step,\\n      state: 'inactive',\\n      completed: false\\n    }));\\n    \\n  }\\n  \\n  \\n\\n  \\n  // ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚·ã‚¹ãƒ†ãƒ \\n  $: canStartTraining = microphoneState === 'granted' && !isLoading && sampler && microphoneHealthy;\\n  $: canRestartSession = trainingPhase === 'results';\\n  \\n  // çŠ¶æ…‹å¤‰åŒ–æ™‚ã®è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚¢ã‚¯ã‚»ã‚¹ã€ãƒã‚¤ã‚¯è¨±å¯å¾Œã®ç”»é¢é·ç§»æ™‚ï¼‰\\n  $: if (trainingPhase === 'setup' && microphoneState === 'granted') {\\n    scrollToTop();\\n  }\\n\\n\\n  // PitchDetectorã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆç°¡ç´ ç‰ˆï¼‰\\n  function handlePitchDetectorStateChange(event) {\\n    // ãƒ­ã‚°å‰Šé™¤\\n  }\\n  \\n  function handlePitchDetectorError(event) {\\n    console.error('âŒ PitchDetectorã‚¨ãƒ©ãƒ¼:', event.detail);\\n  }\\n  \\n  // ãƒã‚¤ã‚¯å¥åº·çŠ¶æ…‹å¤‰åŒ–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼\\n  function handleMicrophoneHealthChange(event) {\\n    const { healthy, errors, details } = event.detail;\\n    microphoneHealthy = healthy;\\n    microphoneErrors = errors;\\n    \\n    if (!healthy) {\\n      console.warn('âš ï¸ ãƒã‚¤ã‚¯ã®å¥åº·çŠ¶æ…‹ãŒæ‚ªåŒ–:', errors);\\n      // æ·±åˆ»ãªå•é¡Œã®å ´åˆã¯ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’åœæ­¢\\n      if (trainingPhase === 'guiding') {\\n        trainingPhase = 'setup';\\n        console.warn('ğŸ›‘ ãƒã‚¤ã‚¯å•é¡Œã«ã‚ˆã‚Šãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’åœæ­¢');\\n      }\\n    }\\n  }\\n\\n  // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\\n  onDestroy(() => {\\n    console.log('ğŸ”„ [RandomTraining] onDestroy - AudioManagerãƒªã‚½ãƒ¼ã‚¹ã¯ä¿æŒ');\\n    \\n    // PitchDetectorã¯ä½¿ã„å›ã—ã®ãŸã‚cleanupã—ãªã„\\n    // AudioManagerãŒãƒªã‚½ãƒ¼ã‚¹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã€ã“ã“ã§ã¯è§£æ”¾ã—ãªã„\\n    \\n    if (sampler) {\\n      sampler.dispose();\\n      sampler = null;\\n    }\\n  });\\n<\/script>\\n\\n<PageLayout>\\n  <!-- Header -->\\n  <div class=\\"header-section\\">\\n    <h1 class=\\"page-title\\">ğŸµ ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>\\n    <p class=\\"page-description\\">10ç¨®é¡ã®åŸºéŸ³ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠã—ã¦ãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚·ãƒ‰ã‚’ç·´ç¿’</p>\\n    <div class=\\"debug-info\\">\\n      ğŸ“± {buildVersion} | {buildTimestamp}<br/>\\n      <small style=\\"font-size: 0.6rem;\\">{updateStatus}</small>\\n    </div>\\n  </div>\\n\\n\\n  {#if microphoneState === 'granted'}\\n    <!-- PitchDetector: å¸¸ã«å­˜åœ¨ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³é–“ã§ç ´æ£„ã•ã‚Œãªã„ï¼‰ -->\\n    <div style=\\"display: none;\\">\\n      <PitchDetector\\n        bind:this={pitchDetectorComponent}\\n        isActive={trainingPhase === 'guiding'}\\n        on:pitchUpdate={handlePitchUpdate}\\n        on:stateChange={handlePitchDetectorStateChange}\\n        on:error={handlePitchDetectorError}\\n        on:microphoneHealthChange={handleMicrophoneHealthChange}\\n        className=\\"pitch-detector-content\\"\\n        debugMode={true}\\n      />\\n    </div>\\n\\n    <!-- ãƒ¡ã‚¤ãƒ³ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ -->\\n    \\n    {#if trainingPhase !== 'results'}\\n      <!-- Base Tone and Detection Side by Side -->\\n      <!-- ãƒã‚¤ã‚¯å¥åº·çŠ¶æ…‹è­¦å‘Šï¼ˆå•é¡ŒãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤ºï¼‰ -->\\n      {#if !microphoneHealthy && microphoneErrors.length > 0}\\n        <Card class=\\"warning-card\\">\\n          <div class=\\"card-header\\">\\n            <h3 class=\\"section-title\\">âš ï¸ ãƒã‚¤ã‚¯æ¥ç¶šã«å•é¡ŒãŒã‚ã‚Šã¾ã™</h3>\\n          </div>\\n          <div class=\\"card-content\\">\\n            <p class=\\"warning-message\\">ãƒã‚¤ã‚¯ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã›ã‚“ã€‚ä»¥ä¸‹ã®å•é¡ŒãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸï¼š</p>\\n            <ul class=\\"error-list\\">\\n              {#each microphoneErrors as error}\\n                <li>{error}</li>\\n              {/each}\\n            </ul>\\n            <p class=\\"fix-instruction\\">\\n              <strong>è§£æ±ºæ–¹æ³•:</strong> ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãƒã‚¤ã‚¯è¨±å¯ã‚’å†åº¦å–å¾—ã—ã¦ãã ã•ã„ã€‚\\n            </p>\\n          </div>\\n        </Card>\\n      {/if}\\n\\n      <div class=\\"side-by-side-container\\">\\n        <!-- Base Tone Section -->\\n        <Card class=\\"main-card half-width\\">\\n          <div class=\\"card-header\\">\\n            <h3 class=\\"section-title\\">ğŸ¹ åŸºéŸ³å†ç”Ÿ</h3>\\n          </div>\\n          <div class=\\"card-content\\">\\n            <Button \\n              variant=\\"primary\\"\\n              disabled={isPlaying || trainingPhase === 'guiding' || trainingPhase === 'waiting'}\\n              on:click={playBaseNote}\\n            >\\n              {#if isPlaying}\\n                ğŸµ å†ç”Ÿä¸­...\\n              {:else if currentBaseNote && currentBaseFrequency > 0}\\n                ğŸ”„ {currentBaseNote} å†ç”Ÿ\\n              {:else}\\n                ğŸ¹ ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³å†ç”Ÿ\\n              {/if}\\n            </Button>\\n            \\n            {#if currentBaseNote}\\n              <div class=\\"base-note-info\\">\\n                ç¾åœ¨ã®åŸºéŸ³: <strong>{currentBaseNote}</strong> ({currentBaseFrequency.toFixed(1)}Hz)\\n              </div>\\n            {/if}\\n          </div>\\n        </Card>\\n\\n        <!-- Detection Section (Display Only) -->\\n        <Card class=\\"main-card half-width\\">\\n          <div class=\\"card-header\\">\\n            <h3 class=\\"section-title\\">ğŸ™ï¸ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³ç¨‹æ¤œå‡º</h3>\\n          </div>\\n          <div class=\\"card-content\\">\\n            <!-- ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã®ã¿ï¼ˆå®Ÿéš›ã®PitchDetectorã¯ä¸Šã«éš ã—ã¦é…ç½®ï¼‰ -->\\n            <div class=\\"pitch-detector\\">\\n              <div class=\\"detection-display\\">\\n                <div class=\\"detection-card\\">\\n                  <span class=\\"detected-frequency\\">{currentFrequency > 0 ? Math.round(currentFrequency) : '---'}</span>\\n                  <span class=\\"hz-suffix\\">Hz</span>\\n                  <span class=\\"divider\\">|</span>\\n                  <span class=\\"detected-note\\">{detectedNote}</span>\\n                </div>\\n                \\n                <VolumeBar volume={currentFrequency > 0 ? currentVolume : 0} className=\\"volume-bar\\" />\\n              </div>\\n            </div>\\n            \\n          </div>\\n        </Card>\\n      </div>\\n    {/if}\\n\\n    {#if trainingPhase !== 'results'}\\n      <!-- Scale Guide Section -->\\n      <Card class=\\"main-card\\">\\n        <div class=\\"card-header\\">\\n          <h3 class=\\"section-title\\">ğŸµ ãƒ‰ãƒ¬ãƒŸéŸ³éšã‚¬ã‚¤ãƒ‰</h3>\\n        </div>\\n        <div class=\\"card-content\\">\\n          <div class=\\"scale-guide\\">\\n            {#each scaleSteps as step, index}\\n              <div \\n                class=\\"scale-item {step.state}\\"\\n              >\\n                {step.name}\\n              </div>\\n            {/each}\\n          </div>\\n          {#if trainingPhase === 'guiding'}\\n            <div class=\\"guide-instruction\\">\\n              ã‚¬ã‚¤ãƒ‰ã«åˆã‚ã›ã¦ <strong>ãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚·ãƒ‰</strong> ã‚’æ­Œã£ã¦ãã ã•ã„\\n            </div>\\n          {/if}\\n        </div>\\n      </Card>\\n    {/if}\\n\\n\\n    <!-- Results Section -->\\n    {#if trainingPhase === 'results'}\\n      <Card class=\\"main-card results-card\\">\\n        <div class=\\"card-header\\">\\n          <h3 class=\\"section-title\\">ğŸ‰ æ¡ç‚¹çµæœ</h3>\\n        </div>\\n        <div class=\\"card-content\\">\\n          <div class=\\"results-summary\\">\\n            <div class=\\"result-item\\">\\n              <span class=\\"result-label\\">æ­£è§£æ•°</span>\\n              <span class=\\"result-value success\\">{sessionResults.correctCount}/{sessionResults.totalCount}</span>\\n            </div>\\n            <div class=\\"result-item\\">\\n              <span class=\\"result-label\\">å¹³å‡ç²¾åº¦</span>\\n              <span class=\\"result-value\\">{sessionResults.averageAccuracy}%</span>\\n            </div>\\n            <div class=\\"result-item\\">\\n              <span class=\\"result-label\\">æ­£è§£ç‡</span>\\n              <span class=\\"result-value\\">{Math.round(sessionResults.correctCount / sessionResults.totalCount * 100)}%</span>\\n            </div>\\n          </div>\\n          \\n          <!-- è©³ç´°çµæœ -->\\n          <div class=\\"detailed-results\\">\\n            <h4 class=\\"detailed-title\\">éŸ³éšåˆ¥çµæœ</h4>\\n            {#if getDisplayEvaluations().length > 0}\\n              <div class=\\"scale-results\\">\\n                {#each getDisplayEvaluations() as evaluation, index}\\n                  <div class=\\"scale-result-item\\" class:correct={evaluation.isCorrect} class:incorrect={!evaluation.isCorrect}>\\n                    <span class=\\"scale-name\\">{evaluation.stepName}</span>\\n                    <span class=\\"scale-accuracy\\">{evaluation.accuracy}%</span>\\n                    <span class=\\"scale-cents\\">{evaluation.centDifference >= 0 ? '+' : ''}{evaluation.centDifference}Â¢</span>\\n                    <span class=\\"scale-status\\">{evaluation.isCorrect ? 'âœ…' : 'âŒ'}</span>\\n                  </div>\\n                {/each}\\n              </div>\\n            {:else}\\n              <div class=\\"no-evaluation-data\\">\\n                <p>è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ä¸­ã«ãƒã‚¤ã‚¯ã‹ã‚‰ååˆ†ãªéŸ³å£°ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚</p>\\n              </div>\\n            {/if}\\n          </div>\\n          \\n          <div class=\\"action-buttons\\">\\n            <Button \\n              variant=\\"primary\\"\\n              class=\\"restart-button\\" \\n              disabled={!canRestartSession}\\n              on:click={restartSameBaseNote}\\n            >\\n              åŒã˜åŸºéŸ³ã§å†æŒ‘æˆ¦\\n            </Button>\\n            <Button \\n              variant=\\"primary\\"\\n              class=\\"new-base-button\\" \\n              disabled={!canRestartSession}\\n              on:click={restartDifferentBaseNote}\\n            >\\n              é•ã†åŸºéŸ³ã§é–‹å§‹\\n            </Button>\\n          </div>\\n        </div>\\n      </Card>\\n    {/if}\\n\\n    <!-- å…±é€šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆæ¡ç‚¹çµæœã‚¨ãƒªã‚¢å¤–ï¼‰ -->\\n    {#if trainingPhase === 'results'}\\n      <div class=\\"common-actions\\">\\n        <Button class=\\"secondary-button\\">\\n          ğŸŠ SNSå…±æœ‰\\n        </Button>\\n        <Button class=\\"secondary-button\\" on:click={goHome}>\\n          ğŸ  ãƒ›ãƒ¼ãƒ \\n        </Button>\\n      </div>\\n    {/if}\\n\\n  {:else}\\n    <!-- Direct Access Error State -->\\n    <Card class=\\"error-card\\">\\n      <div class=\\"error-content\\">\\n        <div class=\\"error-icon\\">ğŸ¤</div>\\n        <h3>ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãŒå¿…è¦ã§ã™</h3>\\n        <p>ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’é–‹å§‹ã™ã‚‹å‰ã«ã€ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã§éŸ³å£°å…¥åŠ›ã®ç¢ºèªã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚</p>\\n        \\n        <div class=\\"recommendation\\">\\n          <p>ã“ã®ãƒšãƒ¼ã‚¸ã¯<strong>ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œ</strong>ã«ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚</p>\\n          <p>ã¾ãšã¯ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã§éŸ³å£°ç¢ºèªã‚’è¡Œã£ã¦ãã ã•ã„ã€‚</p>\\n        </div>\\n        \\n        <div class=\\"action-buttons\\">\\n          <Button variant=\\"primary\\" on:click={goToMicrophoneTest}>\\n            ğŸ¤ ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã¸ç§»å‹•\\n          </Button>\\n          <Button variant=\\"secondary\\" on:click={checkMicrophonePermission}>\\n            ğŸ™ï¸ ç›´æ¥ãƒã‚¤ã‚¯è¨±å¯ã‚’å–å¾—\\n          </Button>\\n          <Button variant=\\"secondary\\" on:click={goHome}>\\n            ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹\\n          </Button>\\n        </div>\\n      </div>\\n    </Card>\\n  {/if}\\n</PageLayout>\\n\\n<style>\\n  /* === shadcn/uié¢¨ãƒ¢ãƒ€ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³ === */\\n  \\n  /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */\\n  .header-section {\\n    text-align: center;\\n    margin-bottom: 2rem;\\n  }\\n  \\n  .page-title {\\n    font-size: 2rem;\\n    font-weight: 700;\\n    color: hsl(222.2 84% 4.9%);\\n    margin-bottom: 0.5rem;\\n  }\\n  \\n  .page-description {\\n    color: hsl(215.4 16.3% 46.9%);\\n    font-size: 1rem;\\n    margin: 0;\\n  }\\n\\n  /* ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆshadcn/uié¢¨ï¼‰ */\\n  :global(.main-card) {\\n    border: 1px solid hsl(214.3 31.8% 91.4%) !important;\\n    background: hsl(0 0% 100%) !important;\\n    border-radius: 8px !important;\\n    box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px 0 rgb(0 0 0 / 0.06) !important;\\n    margin-bottom: 1.5rem;\\n  }\\n  \\n  :global(.status-card) {\\n    border-radius: 8px !important;\\n    margin-bottom: 1.5rem;\\n  }\\n  \\n  :global(.error-card) {\\n    border: 1px solid hsl(0 84.2% 60.2%) !important;\\n    background: hsl(0 84.2% 97%) !important;\\n    border-radius: 8px !important;\\n    box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1) !important;\\n  }\\n  \\n  :global(.results-card) {\\n    border: 1px solid hsl(142.1 76.2% 36.3%) !important;\\n    background: linear-gradient(135deg, hsl(142.1 76.2% 95%) 0%, hsl(0 0% 100%) 100%) !important;\\n  }\\n\\n  /* ã‚«ãƒ¼ãƒ‰ãƒ˜ãƒƒãƒ€ãƒ¼ */\\n  .card-header {\\n    padding-bottom: 1rem;\\n    border-bottom: 1px solid hsl(214.3 31.8% 91.4%);\\n    margin-bottom: 1.5rem;\\n  }\\n  \\n  .section-title {\\n    font-size: 1.125rem;\\n    font-weight: 600;\\n    color: hsl(222.2 84% 4.9%);\\n    margin: 0;\\n  }\\n\\n  /* ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */\\n  .card-content {\\n    display: flex;\\n    flex-direction: column;\\n    gap: 1rem;\\n  }\\n\\n  /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */\\n  .status-content {\\n    display: flex;\\n    justify-content: space-between;\\n    align-items: center;\\n    gap: 1rem;\\n  }\\n  \\n  .status-message {\\n    font-weight: 500;\\n    color: hsl(222.2 84% 4.9%);\\n  }\\n  \\n  .progress-indicator {\\n    font-size: 0.875rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n  }\\n\\n  /* ã‚µã‚¤ãƒ‰ãƒã‚¤ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */\\n  .side-by-side-container {\\n    display: flex;\\n    gap: 1.5rem;\\n    margin-bottom: 1.5rem;\\n  }\\n  \\n  :global(.half-width) {\\n    flex: 1;\\n  }\\n  \\n  @media (max-width: 768px) {\\n    .side-by-side-container {\\n      flex-direction: column;\\n    }\\n    \\n    :global(.half-width) {\\n      width: 100%;\\n    }\\n  }\\n\\n  /* ãƒ‡ãƒãƒƒã‚°æƒ…å ± */\\n  .debug-info {\\n    position: absolute;\\n    top: 1rem;\\n    right: 1rem;\\n    background: hsl(220 13% 91%);\\n    color: hsl(220 13% 46%);\\n    padding: 0.25rem 0.5rem;\\n    border-radius: 4px;\\n    font-size: 0.75rem;\\n    font-family: 'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;\\n    z-index: 100;\\n  }\\n\\n  /* åŸºéŸ³æƒ…å ± */\\n  .base-note-info {\\n    text-align: center;\\n    padding: 1rem;\\n    background: hsl(210 40% 98%);\\n    border-radius: 6px;\\n    border: 1px solid hsl(214.3 31.8% 91.4%);\\n    font-size: 0.875rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n  }\\n\\n  /* ç›¸å¯¾éŸ³ç¨‹æƒ…å ± */\\n  .relative-pitch-info {\\n    text-align: center;\\n    padding: 1rem;\\n    background: hsl(210 40% 98%);\\n    border-radius: 6px;\\n    border: 1px solid hsl(214.3 31.8% 91.4%);\\n    margin-top: 1rem;\\n  }\\n  \\n  .frequency-display-large {\\n    display: flex;\\n    flex-direction: column;\\n    align-items: center;\\n    gap: 0.25rem;\\n  }\\n  \\n  .large-hz {\\n    font-size: 2rem;\\n    font-weight: 700;\\n    color: hsl(222.2 84% 4.9%);\\n    line-height: 1;\\n  }\\n  \\n  .note-with-cents {\\n    font-size: 0.875rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n    font-weight: 500;\\n  }\\n  \\n  .no-signal {\\n    font-size: 2rem;\\n    font-weight: 700;\\n    color: hsl(215.4 16.3% 46.9%);\\n    line-height: 1;\\n  }\\n  \\n  .pitch-detector-placeholder {\\n    text-align: center;\\n    padding: 2rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n    font-style: italic;\\n  }\\n\\n  /* ã‚¹ã‚±ãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ */\\n  .scale-guide {\\n    display: grid;\\n    grid-template-columns: repeat(4, 1fr);\\n    gap: 0.75rem;\\n    margin-bottom: 1rem;\\n  }\\n  \\n  .scale-item {\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n    height: 3rem;\\n    border-radius: 6px;\\n    font-weight: 500;\\n    font-size: 0.875rem;\\n    border: 1px solid hsl(215.4 16.3% 46.9%);\\n    background: hsl(0 0% 100%);\\n    color: hsl(215.4 16.3% 46.9%);\\n    transition: all 0.3s ease;\\n  }\\n  \\n  .scale-item.active {\\n    background: hsl(343.8 79.7% 53.7%) !important;\\n    color: white !important;\\n    border: 2px solid hsla(343.8 79.7% 53.7% / 0.5) !important;\\n    transform: scale(1.2);\\n    font-size: 1.125rem;\\n    font-weight: 700;\\n    animation: pulse 2s infinite;\\n    box-shadow: 0 0 0 2px hsla(343.8 79.7% 53.7% / 0.3) !important;\\n  }\\n  \\n  .scale-item.correct {\\n    background: hsl(142.1 76.2% 36.3%);\\n    color: hsl(210 40% 98%);\\n    border-color: hsl(142.1 76.2% 36.3%);\\n    animation: correctFlash 0.5s ease-out;\\n  }\\n  \\n  .scale-item.incorrect {\\n    background: hsl(0 84.2% 60.2%);\\n    color: hsl(210 40% 98%);\\n    border-color: hsl(0 84.2% 60.2%);\\n    animation: shake 0.5s ease-in-out;\\n  }\\n  \\n  @keyframes pulse {\\n    0%, 100% { opacity: 1; }\\n    50% { opacity: 0.7; }\\n  }\\n  \\n  @keyframes correctFlash {\\n    0% { transform: scale(1); background: hsl(47.9 95.8% 53.1%); }\\n    50% { transform: scale(1.1); background: hsl(142.1 76.2% 36.3%); }\\n    100% { transform: scale(1); background: hsl(142.1 76.2% 36.3%); }\\n  }\\n  \\n  @keyframes shake {\\n    0%, 100% { transform: translateX(0); }\\n    25% { transform: translateX(-5px); }\\n    75% { transform: translateX(5px); }\\n  }\\n  \\n  /* currentã‚¯ãƒ©ã‚¹ã¯å‰Šé™¤ï¼ˆä½¿ç”¨ã—ã¦ã„ãªã„ï¼‰ */\\n  \\n  .guide-instruction {\\n    text-align: center;\\n    font-size: 0.875rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n    padding: 0.75rem;\\n    background: hsl(210 40% 98%);\\n    border-radius: 6px;\\n  }\\n  \\n  .guide-feedback {\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n    gap: 0.5rem;\\n    margin-top: 0.5rem;\\n    font-size: 0.75rem;\\n  }\\n  \\n  .feedback-label {\\n    color: hsl(215.4 16.3% 46.9%);\\n    font-weight: 500;\\n  }\\n  \\n  .feedback-value {\\n    font-weight: 700;\\n    font-family: 'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;\\n    padding: 0.125rem 0.375rem;\\n    border-radius: 4px;\\n    background: hsl(214.3 31.8% 91.4%);\\n    color: hsl(222.2 84% 4.9%);\\n    min-width: 4ch;\\n    text-align: center;\\n  }\\n  \\n  .feedback-value.accurate {\\n    background: hsl(142.1 76.2% 90%);\\n    color: hsl(142.1 76.2% 30%);\\n  }\\n  \\n  .feedback-value.close {\\n    background: hsl(47.9 95.8% 90%);\\n    color: hsl(47.9 95.8% 30%);\\n  }\\n  \\n  .feedback-status {\\n    font-weight: 500;\\n    font-size: 0.75rem;\\n  }\\n  \\n  .feedback-status.success {\\n    color: hsl(142.1 76.2% 36.3%);\\n  }\\n  \\n  .feedback-status.close {\\n    color: hsl(47.9 95.8% 45%);\\n  }\\n\\n  /* æ¤œå‡ºè¡¨ç¤º */\\n  .detection-display {\\n    display: flex;\\n    flex-direction: column;\\n    gap: 1rem;\\n  }\\n  \\n  .detection-card {\\n    display: inline-flex;\\n    align-items: baseline;\\n    gap: 0.5rem;\\n    padding: 1rem 1.5rem;\\n    background: hsl(0 0% 100%);\\n    border: 1px solid hsl(214.3 31.8% 91.4%);\\n    border-radius: 8px;\\n    width: fit-content;\\n  }\\n\\n  /* PitchDetectorè¡¨ç¤ºã®æœ€å¼·åˆ¶ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */\\n  :global(.detected-frequency) {\\n    font-weight: 600 !important;\\n    font-size: 2rem !important;\\n    color: hsl(222.2 84% 4.9%) !important;\\n    font-family: 'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', \\n                 'JetBrains Mono', 'Fira Code', 'Consolas', monospace !important;\\n    min-width: 4ch !important;\\n    text-align: right !important;\\n    display: inline-block !important;\\n    font-variant-numeric: tabular-nums !important;\\n    -webkit-font-smoothing: antialiased !important;\\n    -moz-osx-font-smoothing: grayscale !important;\\n  }\\n\\n  :global(.hz-suffix) {\\n    font-weight: 600 !important;\\n    font-size: 2rem !important;\\n    color: hsl(222.2 84% 4.9%) !important;\\n  }\\n\\n  :global(.divider) {\\n    color: hsl(214.3 31.8% 70%) !important;\\n    font-size: 1.5rem !important;\\n    margin: 0 0.25rem !important;\\n    font-weight: 300 !important;\\n  }\\n  \\n  :global(.detected-note) {\\n    font-weight: 600 !important;\\n    font-size: 2rem !important;\\n    color: hsl(215.4 16.3% 46.9%) !important;\\n    font-family: 'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', \\n                 'JetBrains Mono', 'Fira Code', 'Consolas', monospace !important;\\n    min-width: 3ch !important;\\n    display: inline-block !important;\\n    text-align: center !important;\\n  }\\n\\n  :global(.volume-bar) {\\n    border-radius: 4px !important;\\n  }\\n  \\n  .detected-info {\\n    display: flex;\\n    align-items: center;\\n    gap: 0.5rem;\\n    font-size: 0.875rem;\\n  }\\n  \\n  .detected-label {\\n    color: hsl(215.4 16.3% 46.9%);\\n  }\\n  \\n  .detected-frequency {\\n    font-weight: 700;\\n    font-size: 1.25rem;\\n    color: hsl(222.2 84% 4.9%);\\n    margin-right: 0.5rem;\\n  }\\n  \\n  .detected-note {\\n    font-weight: 500;\\n    font-size: 0.875rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n    margin-right: 0.25rem;\\n  }\\n  \\n  .pitch-diff {\\n    color: hsl(47.9 95.8% 40%);\\n    font-weight: 500;\\n    margin-left: 0.25rem;\\n  }\\n  \\n  .volume-section {\\n    display: flex;\\n    flex-direction: column;\\n    gap: 0.5rem;\\n  }\\n  \\n  .volume-label {\\n    font-size: 0.875rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n  }\\n  \\n  :global(.modern-volume-bar) {\\n    border-radius: 4px !important;\\n  }\\n\\n  /* çµæœè¡¨ç¤º */\\n  .results-summary {\\n    display: grid;\\n    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\\n    gap: 1rem;\\n    margin-bottom: 2rem;\\n  }\\n  \\n  .result-item {\\n    text-align: center;\\n    padding: 1rem;\\n    border-radius: 6px;\\n    background: hsl(0 0% 100%);\\n    border: 1px solid hsl(214.3 31.8% 91.4%);\\n  }\\n  \\n  .result-label {\\n    display: block;\\n    font-size: 0.875rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n    margin-bottom: 0.25rem;\\n  }\\n  \\n  .result-value {\\n    display: block;\\n    font-size: 1.5rem;\\n    font-weight: 700;\\n    color: hsl(222.2 84% 4.9%);\\n  }\\n  \\n  .result-value.success {\\n    color: hsl(142.1 76.2% 36.3%);\\n  }\\n  \\n  /* è©³ç´°çµæœ */\\n  .detailed-results {\\n    margin-top: 2rem;\\n  }\\n  \\n  .detailed-title {\\n    font-size: 1rem;\\n    font-weight: 600;\\n    color: hsl(222.2 84% 4.9%);\\n    margin-bottom: 1rem;\\n    text-align: center;\\n  }\\n  \\n  .scale-results {\\n    display: flex;\\n    flex-direction: column;\\n    gap: 0.5rem;\\n  }\\n  \\n  .scale-result-item {\\n    display: grid;\\n    grid-template-columns: 1fr auto auto auto;\\n    gap: 1rem;\\n    padding: 0.75rem;\\n    border-radius: 6px;\\n    border: 1px solid hsl(214.3 31.8% 91.4%);\\n    background: hsl(0 0% 100%);\\n    align-items: center;\\n  }\\n  \\n  .scale-result-item.correct {\\n    background: hsl(142.1 76.2% 95%);\\n    border-color: hsl(142.1 76.2% 80%);\\n  }\\n  \\n  .scale-result-item.incorrect {\\n    background: hsl(0 84.2% 95%);\\n    border-color: hsl(0 84.2% 80%);\\n  }\\n  \\n  .scale-name {\\n    font-weight: 600;\\n    color: hsl(222.2 84% 4.9%);\\n  }\\n  \\n  .scale-accuracy {\\n    font-weight: 500;\\n    font-family: 'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;\\n    color: hsl(215.4 16.3% 46.9%);\\n  }\\n  \\n  .scale-cents {\\n    font-weight: 500;\\n    font-family: 'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;\\n    color: hsl(215.4 16.3% 46.9%);\\n    font-size: 0.875rem;\\n  }\\n  \\n  .scale-status {\\n    text-align: center;\\n    font-size: 1.125rem;\\n  }\\n\\n  /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */\\n  .action-buttons {\\n    display: flex;\\n    gap: 0.75rem;\\n    justify-content: center;\\n    flex-wrap: wrap;\\n  }\\n  \\n  /* å†æŒ‘æˆ¦ç³»ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */\\n  :global(.restart-button), :global(.new-base-button) {\\n    min-width: 160px !important;\\n    font-weight: 500 !important;\\n  }\\n  \\n  /* å…±é€šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */\\n  .common-actions {\\n    display: flex;\\n    gap: 0.75rem;\\n    justify-content: center;\\n    flex-wrap: wrap;\\n    margin-top: 1.5rem;\\n  }\\n\\n  /* ã‚¨ãƒ©ãƒ¼è¡¨ç¤º */\\n  .error-content {\\n    text-align: center;\\n    padding: 2rem 1rem;\\n  }\\n  \\n  .error-icon, .loading-icon {\\n    font-size: 3rem;\\n    margin-bottom: 1rem;\\n  }\\n  \\n  .error-content h3 {\\n    font-size: 1.25rem;\\n    font-weight: 600;\\n    color: hsl(222.2 84% 4.9%);\\n    margin-bottom: 0.5rem;\\n  }\\n  \\n  .error-content p {\\n    color: hsl(215.4 16.3% 46.9%);\\n    margin-bottom: 1rem;\\n  }\\n  \\n  .recommendation {\\n    background: hsl(210 40% 98%);\\n    border: 1px solid hsl(214.3 31.8% 91.4%);\\n    border-radius: 6px;\\n    padding: 1rem;\\n    margin: 1rem 0;\\n  }\\n  \\n  .recommendation p {\\n    margin: 0;\\n    font-size: 0.875rem;\\n  }\\n\\n  /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */\\n  @media (min-width: 768px) {\\n    .scale-guide {\\n      grid-template-columns: repeat(8, 1fr);\\n    }\\n    \\n    .page-title {\\n      font-size: 2.5rem;\\n    }\\n    \\n    .results-summary {\\n      grid-template-columns: repeat(3, 1fr);\\n    }\\n  }\\n  \\n  @media (max-width: 640px) {\\n    .status-content {\\n      flex-direction: column;\\n      gap: 0.5rem;\\n    }\\n    \\n    .action-buttons {\\n      flex-direction: column;\\n    }\\n    \\n    :global(.primary-button), :global(.secondary-button) {\\n      min-width: 100% !important;\\n    }\\n  }\\n\\n  /* ãƒã‚¤ã‚¯è­¦å‘Šã‚«ãƒ¼ãƒ‰ */\\n  :global(.warning-card) {\\n    border: 2px solid #fbbf24 !important;\\n    background: #fef3c7 !important;\\n    margin-bottom: 24px !important;\\n  }\\n\\n  .warning-message {\\n    color: #92400e;\\n    margin-bottom: 12px;\\n  }\\n\\n  .error-list {\\n    color: #dc2626;\\n    margin: 12px 0;\\n    padding-left: 20px;\\n  }\\n\\n  .error-list li {\\n    margin-bottom: 4px;\\n    font-family: monospace;\\n    font-size: 14px;\\n  }\\n\\n  .fix-instruction {\\n    color: #059669;\\n    margin-top: 12px;\\n    padding: 8px;\\n    background: #d1fae5;\\n    border-radius: 4px;\\n    border-left: 4px solid #059669;\\n  }\\n</style>"],"names":[],"mappings":"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"}`
};
const buildVersion = "v1.3.2-FORCE";
const buildTimestamp = "07/27 02:20";
const updateStatus = "ğŸ”¥ ROSEè‰²ä¿®æ­£ãƒ»éŸ³æºå‰Šé™¤ãƒ»è©•ä¾¡æ”¹å–„";
function scrollToTop() {
  try {
    if ("scrollTo" in window && "behavior" in document.documentElement.style) {
      window.scrollTo({ top: 0, behavior: "smooth" });
    } else {
      window.scrollTo(0, 0);
    }
    if (document.body) {
      document.body.scrollTop = 0;
    }
    if (document.documentElement) {
      document.documentElement.scrollTop = 0;
    }
    const scrollContainers = document.querySelectorAll("[data-scroll-container], .scroll-container, main");
    scrollContainers.forEach((container) => {
      if (container.scrollTo) {
        container.scrollTo(0, 0);
      } else {
        container.scrollTop = 0;
      }
    });
  } catch (error) {
    console.warn("ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼:", error);
    try {
      window.scroll(0, 0);
    } catch (fallbackError) {
      console.error("ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å®Œå…¨å¤±æ•—:", fallbackError);
    }
  }
}
const Page = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let $$unsubscribe_page;
  validate_store(page, "page");
  $$unsubscribe_page = subscribe(page, (value) => value);
  let trainingPhase = "setup";
  let microphoneState = (() => {
    if (typeof window !== "undefined") {
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get("from") === "microphone-test") {
        console.log("ğŸ¤ [RandomTraining] æ—©æœŸæ¤œå‡º: ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‹ã‚‰ã®é·ç§»");
        return "granted";
      } else {
        console.log("ğŸ¤ [RandomTraining] ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚’æ¤œå‡º");
        return "checking";
      }
    }
    return "checking";
  })();
  let scaleSteps = [
    {
      name: "ãƒ‰",
      state: "inactive",
      completed: false
    },
    {
      name: "ãƒ¬",
      state: "inactive",
      completed: false
    },
    {
      name: "ãƒŸ",
      state: "inactive",
      completed: false
    },
    {
      name: "ãƒ•ã‚¡",
      state: "inactive",
      completed: false
    },
    {
      name: "ã‚½",
      state: "inactive",
      completed: false
    },
    {
      name: "ãƒ©",
      state: "inactive",
      completed: false
    },
    {
      name: "ã‚·",
      state: "inactive",
      completed: false
    },
    {
      name: "ãƒ‰ï¼ˆé«˜ï¼‰",
      state: "inactive",
      completed: false
    }
  ];
  let detectedNote = "ãƒ¼ãƒ¼";
  let pitchDetectorComponent = null;
  onDestroy(() => {
    console.log("ğŸ”„ [RandomTraining] onDestroy - AudioManagerãƒªã‚½ãƒ¼ã‚¹ã¯ä¿æŒ");
  });
  $$result.css.add(css);
  let $$settled;
  let $$rendered;
  let previous_head = $$result.head;
  do {
    $$settled = true;
    $$result.head = previous_head;
    {
      if (microphoneState === "granted") {
        scrollToTop();
      }
    }
    $$rendered = `${validate_component(PageLayout, "PageLayout").$$render($$result, {}, {}, {
      default: () => {
        return ` <div class="header-section svelte-ds9yw"><h1 class="page-title svelte-ds9yw" data-svelte-h="svelte-1ptm9zr">ğŸµ ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1> <p class="page-description svelte-ds9yw" data-svelte-h="svelte-19nes7">10ç¨®é¡ã®åŸºéŸ³ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠã—ã¦ãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚·ãƒ‰ã‚’ç·´ç¿’</p> <div class="debug-info svelte-ds9yw">ğŸ“± ${escape(buildVersion)} | ${escape(buildTimestamp)}<br> <small style="font-size: 0.6rem;">${escape(updateStatus)}</small></div></div> ${microphoneState === "granted" ? ` <div style="display: none;">${validate_component(PitchDetector_1, "PitchDetector").$$render(
          $$result,
          {
            isActive: trainingPhase === "guiding",
            className: "pitch-detector-content",
            debugMode: true,
            this: pitchDetectorComponent
          },
          {
            this: ($$value) => {
              pitchDetectorComponent = $$value;
              $$settled = false;
            }
          },
          {}
        )}</div>  ${`  ${``} <div class="side-by-side-container svelte-ds9yw"> ${validate_component(Card, "Card").$$render($$result, { class: "main-card half-width" }, {}, {
          default: () => {
            return `<div class="card-header svelte-ds9yw"><h3 class="section-title svelte-ds9yw" data-svelte-h="svelte-syc53b">ğŸ¹ åŸºéŸ³å†ç”Ÿ</h3></div> <div class="card-content svelte-ds9yw">${validate_component(Button, "Button").$$render(
              $$result,
              {
                variant: "primary",
                disabled: trainingPhase === "waiting"
              },
              {},
              {
                default: () => {
                  return `${`${`ğŸ¹ ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³å†ç”Ÿ`}`}`;
                }
              }
            )} ${``}</div>`;
          }
        })}  ${validate_component(Card, "Card").$$render($$result, { class: "main-card half-width" }, {}, {
          default: () => {
            return `<div class="card-header svelte-ds9yw"><h3 class="section-title svelte-ds9yw" data-svelte-h="svelte-1bj87i9">ğŸ™ï¸ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³ç¨‹æ¤œå‡º</h3></div> <div class="card-content svelte-ds9yw"> <div class="pitch-detector"><div class="detection-display svelte-ds9yw"><div class="detection-card svelte-ds9yw"><span class="detected-frequency svelte-ds9yw">${escape("---")}</span> <span class="hz-suffix" data-svelte-h="svelte-5uyilv">Hz</span> <span class="divider" data-svelte-h="svelte-1dytxz4">|</span> <span class="detected-note svelte-ds9yw">${escape(detectedNote)}</span></div> ${validate_component(VolumeBar, "VolumeBar").$$render(
              $$result,
              {
                volume: 0,
                className: "volume-bar"
              },
              {},
              {}
            )}</div></div></div>`;
          }
        })}</div>`} ${` ${validate_component(Card, "Card").$$render($$result, { class: "main-card" }, {}, {
          default: () => {
            return `<div class="card-header svelte-ds9yw"><h3 class="section-title svelte-ds9yw" data-svelte-h="svelte-1mor0as">ğŸµ ãƒ‰ãƒ¬ãƒŸéŸ³éšã‚¬ã‚¤ãƒ‰</h3></div> <div class="card-content svelte-ds9yw"><div class="scale-guide svelte-ds9yw">${each(scaleSteps, (step, index) => {
              return `<div class="${"scale-item " + escape(step.state, true) + " svelte-ds9yw"}">${escape(step.name)} </div>`;
            })}</div> ${``}</div>`;
          }
        })}`}  ${``}  ${``}` : ` ${validate_component(Card, "Card").$$render($$result, { class: "error-card" }, {}, {
          default: () => {
            return `<div class="error-content svelte-ds9yw"><div class="error-icon svelte-ds9yw" data-svelte-h="svelte-15rbx8n">ğŸ¤</div> <h3 class="svelte-ds9yw" data-svelte-h="svelte-17kvze2">ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãŒå¿…è¦ã§ã™</h3> <p class="svelte-ds9yw" data-svelte-h="svelte-12s9olt">ãƒ©ãƒ³ãƒ€ãƒ åŸºéŸ³ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’é–‹å§‹ã™ã‚‹å‰ã«ã€ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã§éŸ³å£°å…¥åŠ›ã®ç¢ºèªã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚</p> <div class="recommendation svelte-ds9yw"><p class="svelte-ds9yw">ã“ã®ãƒšãƒ¼ã‚¸ã¯<strong data-svelte-h="svelte-1n3qsr6">ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œ</strong>ã«ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚</p> <p class="svelte-ds9yw" data-svelte-h="svelte-v8nd09">ã¾ãšã¯ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã§éŸ³å£°ç¢ºèªã‚’è¡Œã£ã¦ãã ã•ã„ã€‚</p></div> <div class="action-buttons svelte-ds9yw">${validate_component(Button, "Button").$$render($$result, { variant: "primary" }, {}, {
              default: () => {
                return `ğŸ¤ ãƒã‚¤ã‚¯ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã¸ç§»å‹•`;
              }
            })} ${validate_component(Button, "Button").$$render($$result, { variant: "secondary" }, {}, {
              default: () => {
                return `ğŸ™ï¸ ç›´æ¥ãƒã‚¤ã‚¯è¨±å¯ã‚’å–å¾—`;
              }
            })} ${validate_component(Button, "Button").$$render($$result, { variant: "secondary" }, {}, {
              default: () => {
                return `ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹`;
              }
            })}</div></div>`;
          }
        })}`}`;
      }
    })}`;
  } while (!$$settled);
  $$unsubscribe_page();
  return $$rendered;
});
export {
  Page as default
};
