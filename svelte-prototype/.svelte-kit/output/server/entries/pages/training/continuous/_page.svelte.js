import { c as create_ssr_component, a as validate_store, b as subscribe, o as onDestroy, v as validate_component, e as escape, d as each } from "../../../../chunks/ssr.js";
import "../../../../chunks/client.js";
import { p as page } from "../../../../chunks/stores.js";
import { P as PageLayout, C as Card } from "../../../../chunks/PageLayout.js";
import { B as Button } from "../../../../chunks/Button.js";
import { l as logger, a as PitchDetector_1, P as PitchDetectionDisplay } from "../../../../chunks/PitchDetectionDisplay.js";
import { c as currentSessionId, u as unifiedScoreData, i as isCompleted, r as remainingSessions, n as nextBaseName, a as nextBaseNote, s as sessionHistory, t as trainingProgress, b as isLoading, M as Music } from "../../../../chunks/sessionStorage.js";
import "tone";
const css = {
  code: ".header-section.svelte-rt5px1.svelte-rt5px1{text-align:center;margin-bottom:2rem}.page-title.svelte-rt5px1.svelte-rt5px1{font-size:2rem;font-weight:700;color:hsl(222.2 84% 4.9%);margin-bottom:0.5rem}.page-description.svelte-rt5px1.svelte-rt5px1{color:hsl(215.4 16.3% 46.9%);font-size:1rem;margin:0}.main-card{border:1px solid hsl(214.3 31.8% 91.4%) !important;background:hsl(0 0% 100%) !important;border-radius:8px !important;box-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px 0 rgb(0 0 0 / 0.06) !important;margin-bottom:1.5rem}.status-card{border-radius:8px !important;margin-bottom:1.5rem}.error-card{border:1px solid hsl(0 84.2% 60.2%) !important;background:hsl(0 84.2% 97%) !important;border-radius:8px !important;box-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1) !important}.results-card{border:1px solid hsl(142.1 76.2% 36.3%) !important;background:linear-gradient(135deg, hsl(142.1 76.2% 95%) 0%, hsl(0 0% 100%) 100%) !important}.card-header.svelte-rt5px1.svelte-rt5px1{padding-bottom:1rem;border-bottom:1px solid hsl(214.3 31.8% 91.4%);margin-bottom:1.5rem}.section-title.svelte-rt5px1.svelte-rt5px1{font-size:1.125rem;font-weight:600;color:hsl(222.2 84% 4.9%);margin:0}.card-content.svelte-rt5px1.svelte-rt5px1{display:flex;flex-direction:column;gap:1rem}.status-content.svelte-rt5px1.svelte-rt5px1{display:flex;justify-content:space-between;align-items:center;gap:1rem}.status-message.svelte-rt5px1.svelte-rt5px1{font-weight:500;color:hsl(222.2 84% 4.9%)}.progress-indicator.svelte-rt5px1.svelte-rt5px1{font-size:0.875rem;color:hsl(215.4 16.3% 46.9%)}.side-by-side-container.svelte-rt5px1.svelte-rt5px1{display:flex;gap:1.5rem;margin-bottom:1.5rem}.half-width{flex:1}@media(max-width: 768px){.side-by-side-container.svelte-rt5px1.svelte-rt5px1{flex-direction:column}.half-width{width:100%}}.debug-info.svelte-rt5px1.svelte-rt5px1{position:absolute;top:1rem;right:1rem;background:hsl(220 13% 91%);color:hsl(220 13% 46%);padding:0.25rem 0.5rem;border-radius:4px;font-size:0.75rem;font-family:'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;z-index:100}.base-note-info.svelte-rt5px1.svelte-rt5px1{text-align:center;padding:1rem;background:hsl(210 40% 98%);border-radius:6px;border:1px solid hsl(214.3 31.8% 91.4%);font-size:0.875rem;color:hsl(215.4 16.3% 46.9%)}.relative-pitch-info.svelte-rt5px1.svelte-rt5px1{text-align:center;padding:1rem;background:hsl(210 40% 98%);border-radius:6px;border:1px solid hsl(214.3 31.8% 91.4%);margin-top:1rem}.frequency-display-large.svelte-rt5px1.svelte-rt5px1{display:flex;flex-direction:column;align-items:center;gap:0.25rem}.large-hz.svelte-rt5px1.svelte-rt5px1{font-size:2rem;font-weight:700;color:hsl(222.2 84% 4.9%);line-height:1}.note-with-cents.svelte-rt5px1.svelte-rt5px1{font-size:0.875rem;color:hsl(215.4 16.3% 46.9%);font-weight:500}.no-signal.svelte-rt5px1.svelte-rt5px1{font-size:2rem;font-weight:700;color:hsl(215.4 16.3% 46.9%);line-height:1}.pitch-detector-placeholder.svelte-rt5px1.svelte-rt5px1{text-align:center;padding:2rem;color:hsl(215.4 16.3% 46.9%);font-style:italic}.scale-guide.svelte-rt5px1.svelte-rt5px1{display:grid;grid-template-columns:repeat(4, 1fr);gap:0.75rem;margin-bottom:1rem}.scale-item.svelte-rt5px1.svelte-rt5px1{display:flex;align-items:center;justify-content:center;height:3rem;border-radius:6px;font-weight:500;font-size:0.875rem;border:1px solid hsl(215.4 16.3% 46.9%);background:hsl(0 0% 100%);color:hsl(215.4 16.3% 46.9%);transition:all 0.3s ease}.scale-item.active.svelte-rt5px1.svelte-rt5px1{background:hsl(343.8 79.7% 53.7%) !important;color:white !important;border:2px solid hsla(343.8 79.7% 53.7% / 0.5) !important;transform:scale(1.2);font-size:1.125rem;font-weight:700;animation:svelte-rt5px1-pulse 2s infinite;box-shadow:0 0 0 2px hsla(343.8 79.7% 53.7% / 0.3) !important}.scale-item.correct.svelte-rt5px1.svelte-rt5px1{background:hsl(142.1 76.2% 36.3%);color:hsl(210 40% 98%);border-color:hsl(142.1 76.2% 36.3%);animation:svelte-rt5px1-correctFlash 0.5s ease-out}.scale-item.incorrect.svelte-rt5px1.svelte-rt5px1{background:hsl(0 84.2% 60.2%);color:hsl(210 40% 98%);border-color:hsl(0 84.2% 60.2%);animation:svelte-rt5px1-shake 0.5s ease-in-out}@keyframes svelte-rt5px1-pulse{0%,100%{opacity:1}50%{opacity:0.7}}@keyframes svelte-rt5px1-correctFlash{0%{transform:scale(1);background:hsl(47.9 95.8% 53.1%)}50%{transform:scale(1.1);background:hsl(142.1 76.2% 36.3%)}100%{transform:scale(1);background:hsl(142.1 76.2% 36.3%)}}@keyframes svelte-rt5px1-shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}.guide-instruction.svelte-rt5px1.svelte-rt5px1{text-align:center;font-size:0.875rem;color:hsl(215.4 16.3% 46.9%);padding:0.75rem;background:hsl(210 40% 98%);border-radius:6px}.guide-feedback.svelte-rt5px1.svelte-rt5px1{display:flex;align-items:center;justify-content:center;gap:0.5rem;margin-top:0.5rem;font-size:0.75rem}.feedback-label.svelte-rt5px1.svelte-rt5px1{color:hsl(215.4 16.3% 46.9%);font-weight:500}.feedback-value.svelte-rt5px1.svelte-rt5px1{font-weight:700;font-family:'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;padding:0.125rem 0.375rem;border-radius:4px;background:hsl(214.3 31.8% 91.4%);color:hsl(222.2 84% 4.9%);min-width:4ch;text-align:center}.feedback-value.accurate.svelte-rt5px1.svelte-rt5px1{background:hsl(142.1 76.2% 90%);color:hsl(142.1 76.2% 30%)}.feedback-value.close.svelte-rt5px1.svelte-rt5px1{background:hsl(47.9 95.8% 90%);color:hsl(47.9 95.8% 30%)}.feedback-status.svelte-rt5px1.svelte-rt5px1{font-weight:500;font-size:0.75rem}.feedback-status.success.svelte-rt5px1.svelte-rt5px1{color:hsl(142.1 76.2% 36.3%)}.feedback-status.close.svelte-rt5px1.svelte-rt5px1{color:hsl(47.9 95.8% 45%)}.detection-display.svelte-rt5px1.svelte-rt5px1{display:flex;flex-direction:column;gap:1rem}.detection-card.svelte-rt5px1.svelte-rt5px1{display:inline-flex;align-items:baseline;gap:0.5rem;padding:1rem 1.5rem;background:hsl(0 0% 100%);border:1px solid hsl(214.3 31.8% 91.4%);border-radius:8px;width:fit-content}.detected-frequency{font-weight:600 !important;font-size:2rem !important;color:hsl(222.2 84% 4.9%) !important;font-family:'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', \n                 'JetBrains Mono', 'Fira Code', 'Consolas', monospace !important;min-width:4ch !important;text-align:right !important;display:inline-block !important;font-variant-numeric:tabular-nums !important;-webkit-font-smoothing:antialiased !important;-moz-osx-font-smoothing:grayscale !important}.hz-suffix{font-weight:600 !important;font-size:2rem !important;color:hsl(222.2 84% 4.9%) !important}.divider{color:hsl(214.3 31.8% 70%) !important;font-size:1.5rem !important;margin:0 0.25rem !important;font-weight:300 !important}.detected-note{font-weight:600 !important;font-size:2rem !important;color:hsl(215.4 16.3% 46.9%) !important;font-family:'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', \n                 'JetBrains Mono', 'Fira Code', 'Consolas', monospace !important;min-width:3ch !important;display:inline-block !important;text-align:center !important}.volume-bar{border-radius:4px !important}.detected-info.svelte-rt5px1.svelte-rt5px1{display:flex;align-items:center;gap:0.5rem;font-size:0.875rem}.detected-label.svelte-rt5px1.svelte-rt5px1{color:hsl(215.4 16.3% 46.9%)}.detected-frequency.svelte-rt5px1.svelte-rt5px1{font-weight:700;font-size:1.25rem;color:hsl(222.2 84% 4.9%);margin-right:0.5rem}.detected-note.svelte-rt5px1.svelte-rt5px1{font-weight:500;font-size:0.875rem;color:hsl(215.4 16.3% 46.9%);margin-right:0.25rem}.pitch-diff.svelte-rt5px1.svelte-rt5px1{color:hsl(47.9 95.8% 40%);font-weight:500;margin-left:0.25rem}.volume-section.svelte-rt5px1.svelte-rt5px1{display:flex;flex-direction:column;gap:0.5rem}.volume-label.svelte-rt5px1.svelte-rt5px1{font-size:0.875rem;color:hsl(215.4 16.3% 46.9%)}.modern-volume-bar{border-radius:4px !important}.results-summary.svelte-rt5px1.svelte-rt5px1{display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:1rem;margin-bottom:2rem}.result-item.svelte-rt5px1.svelte-rt5px1{text-align:center;padding:1rem;border-radius:6px;background:hsl(0 0% 100%);border:1px solid hsl(214.3 31.8% 91.4%)}.result-label.svelte-rt5px1.svelte-rt5px1{display:block;font-size:0.875rem;color:hsl(215.4 16.3% 46.9%);margin-bottom:0.25rem}.result-value.svelte-rt5px1.svelte-rt5px1{display:block;font-size:1.5rem;font-weight:700;color:hsl(222.2 84% 4.9%)}.result-value.success.svelte-rt5px1.svelte-rt5px1{color:hsl(142.1 76.2% 36.3%)}.detailed-results.svelte-rt5px1.svelte-rt5px1{margin-top:2rem}.detailed-title.svelte-rt5px1.svelte-rt5px1{font-size:1rem;font-weight:600;color:hsl(222.2 84% 4.9%);margin-bottom:1rem;text-align:center}.scale-results.svelte-rt5px1.svelte-rt5px1{display:flex;flex-direction:column;gap:0.5rem}.scale-result-item.svelte-rt5px1.svelte-rt5px1{display:grid;grid-template-columns:1fr auto auto auto;gap:1rem;padding:0.75rem;border-radius:6px;border:1px solid hsl(214.3 31.8% 91.4%);background:hsl(0 0% 100%);align-items:center}.scale-result-item.correct.svelte-rt5px1.svelte-rt5px1{background:hsl(142.1 76.2% 95%);border-color:hsl(142.1 76.2% 80%)}.scale-result-item.incorrect.svelte-rt5px1.svelte-rt5px1{background:hsl(0 84.2% 95%);border-color:hsl(0 84.2% 80%)}.scale-name.svelte-rt5px1.svelte-rt5px1{font-weight:600;color:hsl(222.2 84% 4.9%)}.scale-accuracy.svelte-rt5px1.svelte-rt5px1{font-weight:500;font-family:'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;color:hsl(215.4 16.3% 46.9%)}.scale-cents.svelte-rt5px1.svelte-rt5px1{font-weight:500;font-family:'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;color:hsl(215.4 16.3% 46.9%);font-size:0.875rem}.scale-status.svelte-rt5px1.svelte-rt5px1{text-align:center;font-size:1.125rem}.top-action-buttons.svelte-rt5px1.svelte-rt5px1{margin:0.125rem 0 0.125rem 0 !important;padding:0 !important}.bottom-action-card{margin-top:0.5rem !important;margin-bottom:0.5rem !important;padding:0.25rem !important}.bottom-action-card .card-content{padding:0.25rem !important;margin:0 !important}.action-buttons-container.top{margin:0 !important;padding:0.25rem 1rem !important}.action-buttons-container.bottom{margin:0 !important;padding:0.25rem 1rem !important}.unified-score-result{padding-top:0.25rem !important}@media(max-width: 640px){.iphone-no-margin{margin:0 !important;padding:0 !important}.mb-6{margin-bottom:0 !important}.page-container.svelte-rt5px1.svelte-rt5px1{margin:0 !important;padding:0 !important}}.error-content.svelte-rt5px1.svelte-rt5px1{text-align:center;padding:2rem 1rem}.error-icon.svelte-rt5px1.svelte-rt5px1,.loading-icon.svelte-rt5px1.svelte-rt5px1{font-size:3rem;margin-bottom:1rem}.error-content.svelte-rt5px1 h3.svelte-rt5px1{font-size:1.25rem;font-weight:600;color:hsl(222.2 84% 4.9%);margin-bottom:0.5rem}.error-content.svelte-rt5px1 p.svelte-rt5px1{color:hsl(215.4 16.3% 46.9%);margin-bottom:1rem}.recommendation.svelte-rt5px1.svelte-rt5px1{background:hsl(210 40% 98%);border:1px solid hsl(214.3 31.8% 91.4%);border-radius:6px;padding:1rem;margin:1rem 0}.recommendation.svelte-rt5px1 p.svelte-rt5px1{margin:0;font-size:0.875rem}@media(min-width: 768px){.scale-guide.svelte-rt5px1.svelte-rt5px1{grid-template-columns:repeat(8, 1fr)}.page-title.svelte-rt5px1.svelte-rt5px1{font-size:2.5rem}.results-summary.svelte-rt5px1.svelte-rt5px1{grid-template-columns:repeat(3, 1fr)}}@media(max-width: 640px){.status-content.svelte-rt5px1.svelte-rt5px1{flex-direction:column;gap:0.5rem}.primary-button,.secondary-button{min-width:100% !important}}.warning-card{border:2px solid #fbbf24 !important;background:#fef3c7 !important;margin-bottom:24px !important}.warning-message.svelte-rt5px1.svelte-rt5px1{color:#92400e;margin-bottom:12px}.error-list.svelte-rt5px1.svelte-rt5px1{color:#dc2626;margin:12px 0;padding-left:20px}.error-list.svelte-rt5px1 li.svelte-rt5px1{margin-bottom:4px;font-family:monospace;font-size:14px}.fix-instruction.svelte-rt5px1.svelte-rt5px1{color:#059669;margin-top:12px;padding:8px;background:#d1fae5;border-radius:4px;border-left:4px solid #059669}.scoring-tabs-container.svelte-rt5px1.svelte-rt5px1{display:flex;gap:0.5rem;margin-bottom:1.5rem;overflow-x:auto;border-bottom:1px solid hsl(214.3 31.8% 91.4%);padding-bottom:0.5rem}.scoring-tab.svelte-rt5px1.svelte-rt5px1{padding:0.75rem 1rem;border-radius:6px;border:1px solid hsl(214.3 31.8% 91.4%);background:hsl(0 0% 100%);color:hsl(215.4 16.3% 46.9%);font-size:0.875rem;font-weight:500;cursor:pointer;transition:all 0.2s ease;flex-shrink:0;white-space:nowrap}.scoring-tab.svelte-rt5px1.svelte-rt5px1:hover{background:hsl(210 40% 98%);border-color:hsl(217.2 32.6% 17.5%)}.scoring-tab.active.svelte-rt5px1.svelte-rt5px1{background:hsl(217.2 91.2% 59.8%);color:hsl(210 40% 98%);border-color:hsl(217.2 91.2% 59.8%);font-weight:600}.tab-content.svelte-rt5px1.svelte-rt5px1{margin-top:1rem;min-height:200px}.tab-panel.svelte-rt5px1.svelte-rt5px1{animation:svelte-rt5px1-fadeIn 0.3s ease-in-out}@keyframes svelte-rt5px1-fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@media(max-width: 768px){.scoring-tabs-container.svelte-rt5px1.svelte-rt5px1{flex-wrap:wrap}.scoring-tab.svelte-rt5px1.svelte-rt5px1{flex:1;min-width:120px}}.traditional-scoring-details.svelte-rt5px1.svelte-rt5px1,.detailed-random-scoring.svelte-rt5px1.svelte-rt5px1,.random-scoring-section.svelte-rt5px1.svelte-rt5px1{margin-top:2rem;padding:1rem;background:#f9fafb;border-radius:8px}.session-progress.svelte-rt5px1.svelte-rt5px1{background:hsl(0 0% 100%);border:1px solid hsl(214.3 31.8% 91.4%);border-radius:8px;padding:12px 16px;margin:16px 0;box-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1)}.session-status.svelte-rt5px1.svelte-rt5px1{display:flex;justify-content:space-between;align-items:center;gap:1rem}.session-info.svelte-rt5px1.svelte-rt5px1{display:flex;align-items:center;gap:1rem}.completed-count.svelte-rt5px1.svelte-rt5px1{font-weight:700;color:hsl(222.2 84% 4.9%);font-size:1.125rem}.remaining-text.svelte-rt5px1.svelte-rt5px1{color:hsl(215.4 16.3% 46.9%);font-size:0.875rem}.progress-section.svelte-rt5px1.svelte-rt5px1{display:flex;align-items:center;gap:12px}.progress-bar.svelte-rt5px1.svelte-rt5px1{width:120px;height:4px;background:hsl(214.3 31.8% 91.4%);border-radius:2px;overflow:hidden;position:relative}.progress-fill.svelte-rt5px1.svelte-rt5px1{height:100%;background:hsl(217.2 91.2% 59.8%);transition:width 0.3s ease}.progress-text.svelte-rt5px1.svelte-rt5px1{font-weight:500;color:hsl(217.2 91.2% 59.8%);font-size:0.875rem;min-width:35px;text-align:right}.guide-start-bar-container.svelte-rt5px1.svelte-rt5px1{margin-top:1rem;padding:0.75rem;background:#f8fafc;border-radius:8px;border:1px solid #e2e8f0}.guide-start-label.svelte-rt5px1.svelte-rt5px1{font-size:0.875rem;color:#64748b;margin-bottom:0.5rem;text-align:center;font-weight:500}.guide-start-bar.svelte-rt5px1.svelte-rt5px1{position:relative;height:8px;background:#e2e8f0;border-radius:4px;overflow:hidden;display:flex;align-items:center}.guide-progress-fill.svelte-rt5px1.svelte-rt5px1{height:100%;background:linear-gradient(90deg, #3b82f6, #1d4ed8);border-radius:4px;transition:width 0.1s ease-out}.guide-music-icon.svelte-rt5px1.svelte-rt5px1{position:absolute;right:8px;top:50%;transform:translateY(-50%);color:#64748b;transition:all 0.3s ease;display:flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:50%;background:white;box-shadow:0 2px 4px rgba(0, 0, 0, 0.1)}.guide-music-icon.glowing.svelte-rt5px1.svelte-rt5px1{color:#fbbf24;background:#fffbeb;box-shadow:0 0 12px rgba(251, 191, 36, 0.4);animation:svelte-rt5px1-pulse-glow 1s infinite}@keyframes svelte-rt5px1-pulse-glow{0%,100%{transform:translateY(-50%) scale(1);box-shadow:0 0 12px rgba(251, 191, 36, 0.4)}50%{transform:translateY(-50%) scale(1.1);box-shadow:0 0 20px rgba(251, 191, 36, 0.6)}}@media(max-width: 768px){.session-status.svelte-rt5px1.svelte-rt5px1{flex-direction:column;gap:8px;align-items:center}.session-info.svelte-rt5px1.svelte-rt5px1{width:100%;justify-content:center}.progress-section.svelte-rt5px1.svelte-rt5px1{width:100%;justify-content:center}}.continuous-status.svelte-rt5px1.svelte-rt5px1{display:flex;flex-direction:column;align-items:center;gap:12px}.status-text.svelte-rt5px1.svelte-rt5px1{display:flex;align-items:center;justify-content:center;padding:12px 24px;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:white;border-radius:8px;font-weight:600;font-size:1rem;box-shadow:0 4px 8px rgba(0, 0, 0, 0.1);animation:svelte-rt5px1-pulse-soft 2s infinite}@keyframes svelte-rt5px1-pulse-soft{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.02);opacity:0.9}}",
  map: `{"version":3,"file":"+page.svelte","sources":["+page.svelte"],"sourcesContent":["<script>\\n  import { onMount, onDestroy } from 'svelte';\\n  import { goto } from '$app/navigation';\\n  import { base } from '$app/paths';\\n  import { page } from '$app/stores';\\n  import { ChevronRight, Music } from 'lucide-svelte';\\n  import Card from '$lib/components/Card.svelte';\\n  import Button from '$lib/components/Button.svelte';\\n  import VolumeBar from '$lib/components/VolumeBar.svelte';\\n  import PitchDisplay from '$lib/components/PitchDisplay.svelte';\\n  import PitchDetector from '$lib/components/PitchDetector.svelte';\\n  import PitchDetectionDisplay from '$lib/components/PitchDetectionDisplay.svelte';\\n  import PageLayout from '$lib/components/PageLayout.svelte';\\n  import * as Tone from 'tone';\\n  import { audioManager } from '$lib/audio/AudioManager.js';\\n  import { harmonicCorrection } from '$lib/audio/HarmonicCorrection.js';\\n  import { logger } from '$lib/utils/debugUtils.js';\\n  \\n  // Êé°ÁÇπ„Ç∑„Çπ„ÉÜ„É†„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà\\n  import { \\n    ScoreResultPanel,\\n    IntervalProgressTracker,\\n    ConsistencyGraph,\\n    FeedbackDisplay,\\n    SessionStatistics\\n  } from '$lib/components/scoring';\\n  import UnifiedScoreResultFixed from '$lib/components/scoring/UnifiedScoreResultFixed.svelte';\\n  import ActionButtons from '$lib/components/ActionButtons.svelte';\\n  import { EvaluationEngine } from '$lib/evaluation/EvaluationEngine';\\n  \\n  // Êé°ÁÇπ„Ç®„É≥„Ç∏„É≥\\n  import { EnhancedScoringEngine } from '$lib/scoring/EnhancedScoringEngine.js';\\n  \\n  // localStorage „Çª„ÉÉ„Ç∑„Éß„É≥ÁÆ°ÁêÜ\\n  import {\\n    trainingProgress,\\n    currentSessionId,\\n    nextBaseNote,\\n    nextBaseName,\\n    isLoading,\\n    storageError,\\n    isCompleted,\\n    sessionHistory,\\n    overallGrade,\\n    overallAccuracy,\\n    progressPercentage,\\n    remainingSessions,\\n    latestSessionResult,\\n    unifiedScoreData,\\n    loadProgress,\\n    saveSessionResult,\\n    resetProgress,\\n    createNewProgress,\\n    startNewCycleIfCompleted\\n  } from '$lib/stores/sessionStorage';\\n  \\n  // Force GitHub Actions trigger: 2025-07-29 06:30\\n  \\n  // „Éá„Éê„Ç§„Çπ‰æùÂ≠òÈü≥ÈáèË®≠ÂÆö\\n  function getVolumeForDevice() {\\n    const isIPhone = /iPhone/.test(navigator.userAgent);\\n    const isIPad = /iPad/.test(navigator.userAgent);\\n    const isIPadOS = /Macintosh/.test(navigator.userAgent) && 'ontouchend' in document;\\n    const isIOS = isIPhone || isIPad || isIPadOS;\\n    \\n    if (isIOS) {\\n      console.log('üîä [RandomTraining] iOS/iPadOSÊ§úÂá∫ - Èü≥Èáè35dBË®≠ÂÆö');\\n      return 35; // iOS/iPadOS: È´òÈü≥ÈáèË®≠ÂÆö\\n    } else {\\n      console.log('üîä [RandomTraining] PCÊ§úÂá∫ - Èü≥Èáè-6dBË®≠ÂÆö');\\n      return -6; // PC: Ê®ôÊ∫ñÈü≥ÈáèË®≠ÂÆö\\n    }\\n  }\\n  \\n  // Áµ±Âêà„Ç∞„É¨„Éº„ÉâË®àÁÆóÈñ¢Êï∞ÔºàEvaluationEngine„Çí‰ΩøÁî®Ôºâ\\n  function calculateUnifiedGrade(sessionHistory) {\\n    return EvaluationEngine.evaluateOverall(sessionHistory);\\n  }\\n  \\n  // „ÉÜ„Çπ„ÉàÁî®„ÉÄ„Éü„Éº„Éá„Éº„ÇøÁîüÊàêÔºàÊ≠£„Åó„ÅÑ4ÊÆµÈöéË©ï‰æ°„Ç∑„Çπ„ÉÜ„É†Ôºâ\\n  function generateTestUnifiedScoreData() {\\n    return {\\n      mode: 'continuous',\\n      timestamp: new Date(),\\n      duration: 480, // 8„Çª„ÉÉ„Ç∑„Éß„É≥ √ó 60Áßí\\n      totalNotes: 64, // 8„Çª„ÉÉ„Ç∑„Éß„É≥ √ó 8Èü≥\\n      measuredNotes: 59, // 8„Çª„ÉÉ„Ç∑„Éß„É≥Á∑èË®à\\n      averageAccuracy: 79, // 8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÖ®‰ΩìÂπ≥Âùá\\n      baseNote: 'C5', // ÊúÄÁµÇ„Çª„ÉÉ„Ç∑„Éß„É≥„ÅÆÂü∫Èü≥\\n      baseFrequency: 523.25,\\n      sessionHistory: [\\n        { \\n          grade: 'excellent', \\n          accuracy: 92, \\n          baseNote: 'C4',\\n          baseFrequency: 261.63,\\n          timestamp: new Date(Date.now() - 7 * 60000),\\n          measuredNotes: 8,\\n          noteResults: [\\n            { name: '„Éâ', note: '„Éâ', frequency: 262, detectedFrequency: 264, cents: 13, grade: 'excellent' },\\n            { name: '„É¨', note: '„É¨', frequency: 294, detectedFrequency: 291, cents: -18, grade: 'good' },\\n            { name: '„Éü', note: '„Éü', frequency: 330, detectedFrequency: 335, cents: 26, grade: 'pass' },\\n            { name: '„Éï„Ç°', note: '„Éï„Ç°', frequency: 349, detectedFrequency: 346, cents: -15, grade: 'excellent' },\\n            { name: '„ÇΩ', note: '„ÇΩ', frequency: 392, detectedFrequency: 388, cents: -18, grade: 'good' },\\n            { name: '„É©', note: '„É©', frequency: 440, detectedFrequency: 444, cents: 16, grade: 'good' },\\n            { name: '„Ç∑', note: '„Ç∑', frequency: 494, detectedFrequency: 499, cents: 17, grade: 'good' },\\n            { name: '„ÉâÔºàÈ´òÔºâ', note: '„ÉâÔºàÈ´òÔºâ', frequency: 523, detectedFrequency: 520, cents: -10, grade: 'excellent' }\\n          ]\\n        },\\n        { \\n          grade: 'good', \\n          accuracy: 78, \\n          baseNote: 'D4',\\n          baseFrequency: 293.66,\\n          timestamp: new Date(Date.now() - 6 * 60000),\\n          measuredNotes: 7,\\n          noteResults: [\\n            { name: '„Éâ', note: '„Éâ', frequency: 294, detectedFrequency: 290, cents: -23, grade: 'good' },\\n            { name: '„É¨', note: '„É¨', frequency: 330, detectedFrequency: 340, cents: 53, grade: 'needWork' },\\n            { name: '„Éü', note: '„Éü', frequency: 370, detectedFrequency: 375, cents: 23, grade: 'good' },\\n            { name: '„Éï„Ç°', note: '„Éï„Ç°', frequency: 392, detectedFrequency: 385, cents: -31, grade: 'pass' },\\n            { name: '„ÇΩ', note: '„ÇΩ', frequency: 440, detectedFrequency: 432, cents: -31, grade: 'pass' },\\n            { name: '„É©', note: '„É©', frequency: 494, detectedFrequency: 510, cents: 56, grade: 'needWork' },\\n            { name: '„Ç∑', note: '„Ç∑', frequency: 554, detectedFrequency: null, cents: null, grade: 'notMeasured' },\\n            { name: '„ÉâÔºàÈ´òÔºâ', note: '„ÉâÔºàÈ´òÔºâ', frequency: 587, detectedFrequency: 580, cents: -21, grade: 'good' }\\n          ]\\n        },\\n        { \\n          grade: 'excellent', \\n          accuracy: 95, \\n          baseNote: 'E4',\\n          baseFrequency: 329.63,\\n          timestamp: new Date(Date.now() - 5 * 60000),\\n          measuredNotes: 8,\\n          noteResults: [\\n            { name: '„Éâ', note: '„Éâ', frequency: 330, detectedFrequency: 332, cents: 10, grade: 'excellent' },\\n            { name: '„É¨', note: '„É¨', frequency: 370, detectedFrequency: 368, cents: -9, grade: 'excellent' },\\n            { name: '„Éü', note: '„Éü', frequency: 415, detectedFrequency: 418, cents: 12, grade: 'excellent' },\\n            { name: '„Éï„Ç°', note: '„Éï„Ç°', frequency: 440, detectedFrequency: 436, cents: -16, grade: 'good' },\\n            { name: '„ÇΩ', note: '„ÇΩ', frequency: 494, detectedFrequency: 497, cents: 11, grade: 'excellent' },\\n            { name: '„É©', note: '„É©', frequency: 554, detectedFrequency: 551, cents: -9, grade: 'excellent' },\\n            { name: '„Ç∑', note: '„Ç∑', frequency: 622, detectedFrequency: 625, cents: 8, grade: 'excellent' },\\n            { name: '„ÉâÔºàÈ´òÔºâ', note: '„ÉâÔºàÈ´òÔºâ', frequency: 659, detectedFrequency: 655, cents: -10, grade: 'excellent' }\\n          ]\\n        },\\n        { \\n          grade: 'needWork', \\n          accuracy: 45, \\n          baseNote: 'F4',\\n          baseFrequency: 349.23,\\n          timestamp: new Date(Date.now() - 4 * 60000),\\n          measuredNotes: 6,\\n          noteResults: [\\n            { name: '„Éâ', note: '„Éâ', frequency: 349, detectedFrequency: 345, cents: -20, grade: 'good' },\\n            { name: '„É¨', note: '„É¨', frequency: 392, detectedFrequency: 420, cents: 124, grade: 'needWork' }, // Â§ñ„ÇåÂÄ§1\\n            { name: '„Éü', note: '„Éü', frequency: 440, detectedFrequency: 435, cents: -20, grade: 'good' },\\n            { name: '„Éï„Ç°', note: '„Éï„Ç°', frequency: 466, detectedFrequency: 520, cents: 195, grade: 'needWork' }, // Â§ñ„ÇåÂÄ§2\\n            { name: '„ÇΩ', note: '„ÇΩ', frequency: 523, detectedFrequency: 410, cents: -455, grade: 'needWork' }, // Â§ñ„ÇåÂÄ§3\\n            { name: '„É©', note: '„É©', frequency: 587, detectedFrequency: null, cents: null, grade: 'notMeasured' },\\n            { name: '„Ç∑', note: '„Ç∑', frequency: 659, detectedFrequency: 650, cents: -24, grade: 'good' },\\n            { name: '„ÉâÔºàÈ´òÔºâ', note: '„ÉâÔºàÈ´òÔºâ', frequency: 698, detectedFrequency: null, cents: null, grade: 'notMeasured' }\\n          ]\\n        },\\n        // === ËøΩÂä†„Çª„ÉÉ„Ç∑„Éß„É≥ 5-8 ===\\n        { \\n          grade: 'good', \\n          accuracy: 85, \\n          baseNote: 'G4',\\n          baseFrequency: 392.00,\\n          timestamp: new Date(Date.now() - 3 * 60000),\\n          measuredNotes: 8,\\n          noteResults: [\\n            { name: '„Éâ', note: '„Éâ', frequency: 392, detectedFrequency: 395, cents: 13, grade: 'excellent' },\\n            { name: '„É¨', note: '„É¨', frequency: 440, detectedFrequency: 438, cents: -8, grade: 'excellent' },\\n            { name: '„Éü', note: '„Éü', frequency: 494, detectedFrequency: 500, cents: 21, grade: 'good' },\\n            { name: '„Éï„Ç°', note: '„Éï„Ç°', frequency: 523, detectedFrequency: 520, cents: -10, grade: 'excellent' },\\n            { name: '„ÇΩ', note: '„ÇΩ', frequency: 587, detectedFrequency: 595, cents: 24, grade: 'good' },\\n            { name: '„É©', note: '„É©', frequency: 659, detectedFrequency: 665, cents: 16, grade: 'good' },\\n            { name: '„Ç∑', note: '„Ç∑', frequency: 740, detectedFrequency: 755, cents: 35, grade: 'pass' },\\n            { name: '„ÉâÔºàÈ´òÔºâ', note: '„ÉâÔºàÈ´òÔºâ', frequency: 784, detectedFrequency: 780, cents: -9, grade: 'excellent' }\\n          ]\\n        },\\n        { \\n          grade: 'excellent', \\n          accuracy: 94, \\n          baseNote: 'A4',\\n          baseFrequency: 440.00,\\n          timestamp: new Date(Date.now() - 2 * 60000),\\n          measuredNotes: 8,\\n          noteResults: [\\n            { name: '„Éâ', note: '„Éâ', frequency: 440, detectedFrequency: 442, cents: 8, grade: 'excellent' },\\n            { name: '„É¨', note: '„É¨', frequency: 494, detectedFrequency: 492, cents: -7, grade: 'excellent' },\\n            { name: '„Éü', note: '„Éü', frequency: 554, detectedFrequency: 558, cents: 12, grade: 'excellent' },\\n            { name: '„Éï„Ç°', note: '„Éï„Ç°', frequency: 587, detectedFrequency: 585, cents: -6, grade: 'excellent' },\\n            { name: '„ÇΩ', note: '„ÇΩ', frequency: 659, detectedFrequency: 665, cents: 16, grade: 'good' },\\n            { name: '„É©', note: '„É©', frequency: 740, detectedFrequency: 738, cents: -5, grade: 'excellent' },\\n            { name: '„Ç∑', note: '„Ç∑', frequency: 831, detectedFrequency: 840, cents: 19, grade: 'good' },\\n            { name: '„ÉâÔºàÈ´òÔºâ', note: '„ÉâÔºàÈ´òÔºâ', frequency: 880, detectedFrequency: 882, cents: 4, grade: 'excellent' }\\n          ]\\n        },\\n        { \\n          grade: 'pass', \\n          accuracy: 68, \\n          baseNote: 'Bb4',\\n          baseFrequency: 466.16,\\n          timestamp: new Date(Date.now() - 1 * 60000),\\n          measuredNotes: 7,\\n          noteResults: [\\n            { name: '„Éâ', note: '„Éâ', frequency: 466, detectedFrequency: 470, cents: 15, grade: 'excellent' },\\n            { name: '„É¨', note: '„É¨', frequency: 523, detectedFrequency: 535, cents: 39, grade: 'pass' },\\n            { name: '„Éü', note: '„Éü', frequency: 587, detectedFrequency: 600, cents: 38, grade: 'pass' },\\n            { name: '„Éï„Ç°', note: '„Éï„Ç°', frequency: 622, detectedFrequency: 615, cents: -19, grade: 'good' },\\n            { name: '„ÇΩ', note: '„ÇΩ', frequency: 698, detectedFrequency: 720, cents: 54, grade: 'needWork' },\\n            { name: '„É©', note: '„É©', frequency: 784, detectedFrequency: null, cents: null, grade: 'notMeasured' },\\n            { name: '„Ç∑', note: '„Ç∑', frequency: 880, detectedFrequency: 895, cents: 29, grade: 'pass' },\\n            { name: '„ÉâÔºàÈ´òÔºâ', note: '„ÉâÔºàÈ´òÔºâ', frequency: 932, detectedFrequency: 925, cents: -13, grade: 'excellent' }\\n          ]\\n        },\\n        { \\n          grade: 'good', \\n          accuracy: 82, \\n          baseNote: 'C5',\\n          baseFrequency: 523.25,\\n          timestamp: new Date(),\\n          measuredNotes: 8,\\n          noteResults: [\\n            { name: '„Éâ', note: '„Éâ', frequency: 523, detectedFrequency: 526, cents: 10, grade: 'excellent' },\\n            { name: '„É¨', note: '„É¨', frequency: 587, detectedFrequency: 584, cents: -9, grade: 'excellent' },\\n            { name: '„Éü', note: '„Éü', frequency: 659, detectedFrequency: 665, cents: 16, grade: 'good' },\\n            { name: '„Éï„Ç°', note: '„Éï„Ç°', frequency: 698, detectedFrequency: 692, cents: -15, grade: 'excellent' },\\n            { name: '„ÇΩ', note: '„ÇΩ', frequency: 784, detectedFrequency: 795, cents: 24, grade: 'good' },\\n            { name: '„É©', note: '„É©', frequency: 880, detectedFrequency: 890, cents: 19, grade: 'good' },\\n            { name: '„Ç∑', note: '„Ç∑', frequency: 988, detectedFrequency: 1010, cents: 38, grade: 'pass' },\\n            { name: '„ÉâÔºàÈ´òÔºâ', note: '„ÉâÔºàÈ´òÔºâ', frequency: 1047, detectedFrequency: 1042, cents: -8, grade: 'excellent' }\\n          ]\\n        }\\n      ]\\n    };\\n  }\\n\\n  // Âü∫Êú¨Áä∂ÊÖãÁÆ°ÁêÜ\\n  let trainingPhase = 'setup'; // 'setup' | 'listening' | 'waiting' | 'guiding' | 'results'\\n  \\n  \\n  // „Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„Åã„Çâ„ÅÆÈÅ∑Áßª„ÇíÊó©ÊúüÊ§úÂá∫\\n  let microphoneState = (() => {\\n    if (typeof window !== 'undefined') {\\n      const urlParams = new URLSearchParams(window.location.search);\\n      if (urlParams.get('from') === 'microphone-test') {\\n        logger.info('[RandomTraining] „Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„Åã„Çâ„ÅÆÈÅ∑Áßª„ÇíÊ§úÂá∫');\\n        return 'granted';\\n      } else {\\n        logger.info('[RandomTraining] „ÉÄ„Ç§„É¨„ÇØ„Éà„Ç¢„ÇØ„Çª„Çπ„ÇíÊ§úÂá∫');\\n        return 'checking';\\n      }\\n    }\\n    return 'checking';\\n  })(); // 'checking' | 'granted' | 'denied' | 'error'\\n  \\n  // „Ç∑„É≥„Éó„É´„Å™Áä∂ÊÖãÁÆ°ÁêÜ\\n  let microphoneHealthy = true; // „Éû„Ç§„ÇØÂÅ•Â∫∑Áä∂ÊÖã\\n  let microphoneErrors = []; // „Éû„Ç§„ÇØ„Ç®„É©„ÉºË©≥Á¥∞\\n  \\n  // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±ÔºàÂº∑Âà∂Êõ¥Êñ∞Ôºâ\\n  const buildVersion = \\"v2.3.1-ANIMATED\\";\\n  const buildTimestamp = \\"07/29 04:15\\";\\n  const updateStatus = \\"üé¨ Ë©ï‰æ°ÂàÜÂ∏É„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆüË£Ö„ÉªUXÂêë‰∏ä\\";\\n  \\n  // Áµ±‰∏ÄÈü≥ÈöéË°®Ë®òÔºàÁõ∏ÂØæÈü≥Á®ãË°®Ë®òÔºâ\\n  const SCALE_NAMES = ['„Éâ', '„É¨', '„Éü', '„Éï„Ç°', '„ÇΩ', '„É©', '„Ç∑', '„ÉâÔºàÈ´òÔºâ'];\\n  \\n  // Âü∫Èü≥Èñ¢ÈÄ£\\n  let currentBaseNote = '';\\n  let currentBaseFrequency = 0;\\n  let isPlaying = false;\\n  \\n  // Èü≥Á®ã„Ç¨„Ç§„Éâ\\n  let currentScaleIndex = 0;\\n  let scaleSteps = SCALE_NAMES.map(name => ({\\n    name,\\n    state: 'inactive',\\n    completed: false\\n  }));\\n  \\n  // „Ç¨„Ç§„Éâ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Âà∂Âæ°\\n  let guideAnimationTimer = null;\\n  let isGuideAnimationActive = false;\\n  \\n  // „Éâ„É¨„Éü„Ç¨„Ç§„Éâ„Çπ„Çø„Éº„Éà„Éê„ÉºÂà∂Âæ°\\n  let guideStartProgress = 0; // 0-100„ÅÆ„Éó„É≠„Ç∞„É¨„Çπ\\n  let isGuideStartBarActive = false;\\n  let guideStartTimer = null;\\n  let musicIconGlowing = false;\\n  \\n  // Ë£è„Åß„ÅÆË©ï‰æ°ËìÑÁ©ç\\n  let scaleEvaluations = [];\\n  \\n  // ÂâçÂõû„ÅÆÁµêÊûú‰øùÊåÅÔºàÂÜçÊåëÊà¶ÊôÇË°®Á§∫Áî®Ôºâ\\n  let previousEvaluations = [];\\n  \\n  // Èü≥Á®ãÊ§úÂá∫\\n  let currentVolume = 0;\\n  let currentFrequency = 0;\\n  let detectedNote = '„Éº„Éº';\\n  let pitchDifference = 0;\\n  \\n  // „Ç¨„Ç§„ÉÄ„É≥„ÇπË°®Á§∫Áî®Â§âÊï∞ÂâäÈô§ÔºàUIÁ∞°Á¥†ÂåñÔºâ\\n  \\n  // „Çª„ÉÉ„Ç∑„Éß„É≥ÁµêÊûú\\n  let sessionResults = {\\n    correctCount: 0,\\n    totalCount: 8,\\n    averageAccuracy: 0,\\n    averageTime: 0,\\n    isCompleted: false\\n  };\\n  \\n  // Êé°ÁÇπ„Ç∑„Çπ„ÉÜ„É†Èñ¢ÈÄ£\\n  let scoringEngine = null;\\n\\n  // Ë°®Á§∫„ÅØÂ∏∏„Å´Ë©ï‰æ°„Ç∑„Çπ„ÉÜ„É†„Å®Âêå„ÅòÂá¶ÁêÜ„Çí‰ΩøÁî®\\n  let currentScoreData = {\\n    totalScore: 0,\\n    grade: 'C',\\n    componentScores: {\\n      pitchAccuracy: 0,\\n      recognitionSpeed: 0,\\n      intervalMastery: 0,\\n      directionAccuracy: 0,\\n      consistency: 0\\n    }\\n  };\\n  let intervalData = [];\\n  let consistencyData = [];\\n  let feedbackData = {};\\n  let technicalFeedbackData = {};\\n  let sessionStatistics = {\\n    totalAttempts: 0,\\n    successRate: 0,\\n    averageScore: 0,\\n    bestScore: 0,\\n    sessionDuration: 0,\\n    streakCount: 0,\\n    fatigueLevel: 'fresh',\\n    mostDifficultInterval: '-',\\n    mostSuccessfulInterval: '-',\\n    averageResponseTime: 0,\\n    sessionStart: Date.now()\\n  };\\n  let activeTab = 'intervals'; // 'intervals' | 'consistency' | 'statistics'\\n  \\n  // „É©„É≥„ÉÄ„É†„É¢„Éº„ÉâÁî®„ÅÆ8Èü≥ÈöéË©ï‰æ°„Éá„Éº„Çø\\n  let noteResultsForDisplay = [];\\n  \\n  // Áµ±ÂêàÊé°ÁÇπ„Ç∑„Çπ„ÉÜ„É†Áî®„Éá„Éº„ÇøÔºàÂæìÊù•„ÅÆ1„Çª„ÉÉ„Ç∑„Éß„É≥Áî®Ôºâ\\n  let currentUnifiedScoreData = null;\\n  \\n  // Tone.js„Çµ„É≥„Éó„É©„Éº\\n  let sampler = null;\\n  let isSamplerLoading = true;\\n  \\n  // Èü≥Á®ãÊ§úÂá∫„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà\\n  let pitchDetectorComponent = null;\\n  \\n  // AudioManagerÂØæÂøúÂ§âÊï∞\\n  let mediaStream = null;   // AudioManager„Åã„ÇâÂèñÂæó\\n  let audioContext = null;  // AudioManager„Åã„ÇâÂèñÂæó\\n  let sourceNode = null;    // AudioManager„Åã„ÇâÂèñÂæó\\n  \\n  // „Çª„ÉÉ„Ç∑„Éß„É≥ÊôÇÂàªÁÆ°ÁêÜ\\n  let sessionStartTime = null;\\n\\n  // Âü∫Èü≥ÂÄôË£úÔºàÂ≠òÂú®„Åô„ÇãÈü≥Ê∫ê„Éï„Ç°„Ç§„É´„Å´Âêà„Çè„Åõ„Åü10Á®ÆÈ°ûÔºâ\\n  const baseNotes = [\\n    { note: 'C4', name: '„ÉâÔºà‰∏≠Ôºâ', frequency: 261.63, semitonesFromC: 0 },\\n    { note: 'Db4', name: '„Éâ#Ôºà‰∏≠Ôºâ', frequency: 277.18, semitonesFromC: 1 },\\n    { note: 'D4', name: '„É¨Ôºà‰∏≠Ôºâ', frequency: 293.66, semitonesFromC: 2 },\\n    { note: 'Eb4', name: '„É¨#Ôºà‰∏≠Ôºâ', frequency: 311.13, semitonesFromC: 3 },\\n    { note: 'E4', name: '„ÉüÔºà‰∏≠Ôºâ', frequency: 329.63, semitonesFromC: 4 },\\n    { note: 'F4', name: '„Éï„Ç°Ôºà‰∏≠Ôºâ', frequency: 349.23, semitonesFromC: 5 },\\n    { note: 'Gb4', name: '„Éï„Ç°#Ôºà‰∏≠Ôºâ', frequency: 369.99, semitonesFromC: 6 },\\n    { note: 'Ab4', name: '„É©bÔºà‰∏≠Ôºâ', frequency: 415.30, semitonesFromC: 8 },\\n    { note: 'Bb3', name: '„Ç∑bÔºà‰ΩéÔºâ', frequency: 233.08, semitonesFromC: -2 },\\n    { note: 'B3', name: '„Ç∑Ôºà‰ΩéÔºâ', frequency: 246.94, semitonesFromC: -1 }\\n  ];\\n\\n  // „Éû„Ç§„ÇØË®±ÂèØÁ¢∫Ë™çÔºàAudioManagerÂØæÂøúÁâàÔºâ\\n  async function checkMicrophonePermission() {\\n    microphoneState = 'checking';\\n    \\n    try {\\n      console.log('üé§ [RandomTraining] AudioManagerÁµåÁî±„Åß„Éû„Ç§„ÇØË®±ÂèØÁ¢∫Ë™çÈñãÂßã');\\n      \\n      if (!navigator.mediaDevices?.getUserMedia) {\\n        microphoneState = 'error';\\n        return;\\n      }\\n      \\n      // AudioManager„Åã„ÇâÂÖ±Êúâ„É™„ÇΩ„Éº„Çπ„ÇíÂèñÂæóÔºàÈáçË§áÂèñÂæó„ÅØÂÆâÂÖ®Ôºâ\\n      const resources = await audioManager.initialize();\\n      audioContext = resources.audioContext;\\n      mediaStream = resources.mediaStream;\\n      sourceNode = resources.sourceNode;\\n      \\n      console.log('‚úÖ [RandomTraining] AudioManager „É™„ÇΩ„Éº„ÇπÂèñÂæóÂÆå‰∫Ü');\\n      \\n      microphoneState = 'granted';\\n      trainingPhase = 'setup';\\n      \\n      // PitchDetectorÂàùÊúüÂåñÔºàÂ§ñÈÉ®AudioContextÊñπÂºèÔºâ\\n      setTimeout(async () => {\\n        if (pitchDetectorComponent) {\\n          logger.audio('[RandomTraining] PitchDetectorÂàùÊúüÂåñÈñãÂßã');\\n          \\n          // iPadÂØæÂøú: „Éû„Ç§„ÇØÊÑüÂ∫¶5.0xËá™ÂãïË®≠ÂÆö\\n          const isIPhone = /iPhone/.test(navigator.userAgent);\\n          const isIPad = /iPad/.test(navigator.userAgent);\\n          const isIPadOS = /Macintosh/.test(navigator.userAgent) && 'ontouchend' in document;\\n          \\n          if (isIPad || isIPadOS) {\\n            console.log('üîß [RandomTraining] iPadÊ§úÂá∫ - „Éû„Ç§„ÇØÊÑüÂ∫¶7.0xËá™ÂãïË®≠ÂÆöÈñãÂßã');\\n            audioManager.setSensitivity(7.0);\\n            console.log('‚úÖ [RandomTraining] iPad „Éû„Ç§„ÇØÊÑüÂ∫¶7.0xËá™ÂãïË®≠ÂÆöÂÆå‰∫Ü');\\n          }\\n          \\n          // iPadÂØæÂøú: AudioManagerÂº∑Âà∂ÂàùÊúüÂåñ\\n          try {\\n            console.log('üé§ [RandomTraining] AudioManagerÂÜçÂàùÊúüÂåñÈñãÂßãÔºàiPadÂØæÂøúÔºâ');\\n            await audioManager.initialize();\\n            console.log('‚úÖ [RandomTraining] AudioManagerÂÜçÂàùÊúüÂåñÂÆå‰∫Ü');\\n          } catch (error) {\\n            console.warn('‚ö†Ô∏è AudioManagerÂÜçÂàùÊúüÂåñ„Ç®„É©„Éº:', error);\\n          }\\n          \\n          await pitchDetectorComponent.initialize();\\n          logger.audio('[RandomTraining] PitchDetectorÂàùÊúüÂåñÂÆå‰∫Ü');\\n        }\\n      }, 200);\\n      \\n    } catch (error) {\\n      logger.error('[RandomTraining] „Éû„Ç§„ÇØË®±ÂèØ„Ç®„É©„Éº:', error);\\n      microphoneState = (error?.name === 'NotAllowedError') ? 'denied' : 'error';\\n    }\\n  }\\n\\n  // „É©„É≥„ÉÄ„É†Âü∫Èü≥ÈÅ∏Êäû\\n  function selectRandomBaseNote() {\\n    // localStorage„Åã„ÇâÊ¨°„ÅÆÂü∫Èü≥„ÇíÂèñÂæó\\n    const nextNote = $nextBaseNote;\\n    const nextName = $nextBaseName;\\n    \\n    // baseNotes„Åã„ÇâÂØæÂøú„Åô„ÇãÊÉÖÂ†±„ÇíÊ§úÁ¥¢\\n    const selectedNote = baseNotes.find(note => note.note === nextNote) || \\n                        baseNotes.find(note => note.name === nextName) ||\\n                        baseNotes[0]; // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ\\n    \\n    currentBaseNote = selectedNote.name;\\n    currentBaseFrequency = selectedNote.frequency;\\n    \\n    // Âü∫Èü≥Âë®Ê≥¢Êï∞Ë®≠ÂÆöÁ¢∫Ë™ç„É≠„Ç∞\\n    logger.info(\`[BaseNote] Âü∫Èü≥Ë®≠ÂÆöÔºàlocalStorageÈÄ£Êê∫Ôºâ: \${currentBaseNote} = \${currentBaseFrequency}Hz\`);\\n    logger.info(\`[BaseNote] localStorageÂü∫Èü≥ÊÉÖÂ†±: note=\${nextNote}, name=\${nextName}\`);\\n    \\n    // Âü∫Èü≥Âë®Ê≥¢Êï∞„ÅåÊ≠£Â∏∏„Å´Ë®≠ÂÆö„Åï„Çå„Åü„Åì„Å®„ÇíÁ¢∫Ë™ç\\n    if (!currentBaseFrequency || currentBaseFrequency <= 0) {\\n      logger.error('[BaseNote] Âü∫Èü≥Âë®Ê≥¢Êï∞Ë®≠ÂÆö„Ç®„É©„Éº:', selectedNote);\\n      throw new Error(\`Invalid base frequency: \${currentBaseFrequency}\`);\\n    }\\n  }\\n\\n  // „É©„É≥„ÉÄ„É†Âü∫Èü≥ÂÜçÁîüÔºàÊñ∞„Åó„ÅÑÂü∫Èü≥„ÇíÈÅ∏ÊäûÔºâ\\n  async function playRandomBaseNote() {\\n    if (isPlaying || !sampler || isSamplerLoading) return;\\n    \\n    // „Éû„Ç§„ÇØË®±ÂèØ„ÅåÊú™ÂèñÂæó„ÅÆÂ†¥Âêà„ÅØÂÖà„Å´Ë®±ÂèØ„ÇíÂèñÂæó\\n    if (microphoneState !== 'granted') {\\n      console.log('üé§ [RandomTraining] „Éû„Ç§„ÇØË®±ÂèØ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇË®±ÂèØÂèñÂæó„ÇíÈñãÂßã...');\\n      try {\\n        await checkMicrophonePermission();\\n        console.log('üé§ [RandomTraining] „Éû„Ç§„ÇØË®±ÂèØÂèñÂæóÂÆå‰∫Ü');\\n      } catch (error) {\\n        console.error('‚ùå „Éû„Ç§„ÇØË®±ÂèØ„Ç®„É©„Éº:', error);\\n        return;\\n      }\\n    }\\n    \\n    // AudioManager„É™„ÇΩ„Éº„Çπ„ÅåÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅÆ„ÅøÂàùÊúüÂåñ\\n    if (!mediaStream && microphoneState === 'granted') {\\n      console.log('üé§ [RandomTraining] AudioManager„É™„ÇΩ„Éº„ÇπÊú™ÂàùÊúüÂåñ„ÅÆ„Åü„ÇÅÂèñÂæó„Åó„Åæ„Åô');\\n      try {\\n        await checkMicrophonePermission();\\n      } catch (error) {\\n        console.error('‚ùå AudioManager„É™„ÇΩ„Éº„ÇπÂàùÊúüÂåñ„Ç®„É©„Éº:', error);\\n        return;\\n      }\\n    } else if (mediaStream) {\\n      console.log('üé§ [RandomTraining] AudioManager„É™„ÇΩ„Éº„ÇπÊó¢Â≠ò„ÅÆ„Åü„ÇÅÂÜçÂà©Áî®');\\n    }\\n    \\n    // Âç≥Â∫ß„Å´Áä∂ÊÖãÂ§âÊõ¥\\n    isPlaying = true;\\n    trainingPhase = 'listening';\\n    sessionStartTime = Date.now(); // „Çª„ÉÉ„Ç∑„Éß„É≥ÈñãÂßãÊôÇÂàª„ÇíË®òÈå≤\\n    selectRandomBaseNote(); // Êñ∞„Åó„ÅÑ„É©„É≥„ÉÄ„É†Âü∫Èü≥„ÇíÈÅ∏Êäû\\n    \\n    // Èü≥Â£∞ÂÜçÁîü\\n    const note = baseNotes.find(n => n.name === currentBaseNote).note;\\n    sampler.triggerAttackRelease(note, 2, Tone.now(), 0.7);\\n    \\n    // 2.5ÁßíÂæå„Å´„Ç¨„Ç§„Éâ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈñãÂßã\\n    setTimeout(() => {\\n      isPlaying = false;\\n      trainingPhase = 'waiting';\\n      setTimeout(() => startGuideAnimation(), 500);\\n    }, 2000);\\n  }\\n\\n  // ÁèæÂú®„ÅÆÂü∫Èü≥ÂÜçÁîüÔºàÊó¢Â≠ò„ÅÆÂü∫Èü≥„ÇíÂÜçÂà©Áî®Ôºâ\\n  async function playCurrentBaseNote() {\\n    if (isPlaying || !sampler || $isLoading || !currentBaseNote) return;\\n    \\n    // „Éû„Ç§„ÇØË®±ÂèØ„ÅåÊú™ÂèñÂæó„ÅÆÂ†¥Âêà„ÅØÂÖà„Å´Ë®±ÂèØ„ÇíÂèñÂæó\\n    if (microphoneState !== 'granted') {\\n      console.log('üé§ [RandomTraining] „Éû„Ç§„ÇØË®±ÂèØ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇË®±ÂèØÂèñÂæó„ÇíÈñãÂßã...');\\n      try {\\n        await checkMicrophonePermission();\\n        console.log('üé§ [RandomTraining] „Éû„Ç§„ÇØË®±ÂèØÂèñÂæóÂÆå‰∫Ü');\\n      } catch (error) {\\n        console.error('‚ùå „Éû„Ç§„ÇØË®±ÂèØ„Ç®„É©„Éº:', error);\\n        return;\\n      }\\n    }\\n    \\n    // AudioManager„É™„ÇΩ„Éº„Çπ„ÅåÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅÆ„ÅøÂàùÊúüÂåñ\\n    if (!mediaStream && microphoneState === 'granted') {\\n      console.log('üé§ [RandomTraining] AudioManager„É™„ÇΩ„Éº„ÇπÊú™ÂàùÊúüÂåñ„ÅÆ„Åü„ÇÅÂèñÂæó„Åó„Åæ„Åô');\\n      try {\\n        await checkMicrophonePermission();\\n      } catch (error) {\\n        console.error('‚ùå AudioManager„É™„ÇΩ„Éº„ÇπÂàùÊúüÂåñ„Ç®„É©„Éº:', error);\\n        return;\\n      }\\n    } else if (mediaStream) {\\n      console.log('üé§ [RandomTraining] AudioManager„É™„ÇΩ„Éº„ÇπÊó¢Â≠ò„ÅÆ„Åü„ÇÅÂÜçÂà©Áî®');\\n    }\\n    \\n    // Âç≥Â∫ß„Å´Áä∂ÊÖãÂ§âÊõ¥\\n    isPlaying = true;\\n    trainingPhase = 'listening';\\n    sessionStartTime = Date.now(); // „Çª„ÉÉ„Ç∑„Éß„É≥ÈñãÂßãÊôÇÂàª„ÇíË®òÈå≤\\n    // selectRandomBaseNote() „ÅØÂëº„Å∞„Å™„ÅÑ - Êó¢Â≠ò„ÅÆÂü∫Èü≥„Çí‰øùÊåÅ\\n    \\n    // AudioContextÁä∂ÊÖãÁ¢∫Ë™ç„ÉªÂÜçÈñã\\n    if (typeof window !== 'undefined' && window.Tone) {\\n      const context = window.Tone.context || window.Tone.getContext();\\n      if (context && context.state === 'suspended') {\\n        console.log('üîÑ [RandomTraining] AudioContext suspendedÊ§úÂá∫ - ÂÜçÈñã‰∏≠...');\\n        await context.resume();\\n        console.log('‚úÖ [RandomTraining] AudioContextÂÜçÈñãÂÆå‰∫Ü');\\n      }\\n    }\\n\\n    // Èü≥Â£∞ÂÜçÁîü\\n    const note = baseNotes.find(n => n.name === currentBaseNote).note;\\n    sampler.triggerAttackRelease(note, 2, Tone.now(), 0.7);\\n    \\n    // 2.5ÁßíÂæå„Å´„Ç¨„Ç§„Éâ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈñãÂßã\\n    setTimeout(() => {\\n      isPlaying = false;\\n      trainingPhase = 'waiting';\\n      setTimeout(() => startGuideAnimation(), 500);\\n    }, 2000);\\n  }\\n\\n  // Âü∫Èü≥„ÅÆ„ÅøÂÜçÁîüÔºàÂÜçÊåëÊà¶„Éú„Çø„É≥Â∞ÇÁî® - „Éà„É¨„Éº„Éã„É≥„Ç∞ÈñãÂßã„Å™„ÅóÔºâ\\n  async function playBaseNoteOnly() {\\n    if (isPlaying || !sampler || $isLoading || !currentBaseNote) {\\n      console.log('üîÑ [BaseNoteOnly] ÂÜçÁîüÊù°‰ª∂Êú™Ê∫Ä: isPlaying:', isPlaying, 'sampler:', !!sampler, 'isLoading:', $isLoading, 'currentBaseNote:', currentBaseNote);\\n      return;\\n    }\\n    \\n    console.log('üéµ [BaseNoteOnly] Âü∫Èü≥„ÅÆ„ÅøÂÜçÁîüÈñãÂßã:', currentBaseNote);\\n    \\n    // AudioContextÁä∂ÊÖãÁ¢∫Ë™ç„ÉªÂÜçÈñã\\n    if (typeof window !== 'undefined' && window.Tone) {\\n      const context = window.Tone.context || window.Tone.getContext();\\n      if (context && context.state === 'suspended') {\\n        console.log('üîÑ [BaseNoteOnly] AudioContext suspendedÊ§úÂá∫ - ÂÜçÈñã‰∏≠...');\\n        await context.resume();\\n        console.log('‚úÖ [BaseNoteOnly] AudioContextÂÜçÈñãÂÆå‰∫Ü');\\n      }\\n    }\\n\\n    // Âü∫Èü≥„ÅÆ„ÅøÂÜçÁîüÔºàÁä∂ÊÖãÂ§âÊõ¥„Å™„ÅóÔºâ\\n    const note = baseNotes.find(n => n.name === currentBaseNote).note;\\n    sampler.triggerAttackRelease(note, 1.5, Tone.now(), 0.7);\\n    \\n    console.log('üéµ [BaseNoteOnly] Âü∫Èü≥ÂÜçÁîüÂÆå‰∫Ü:', note);\\n  }\\n\\n  // Âü∫Èü≥ÂÜçÁîüÔºàÁµ±ÂêàÈñ¢Êï∞ - Áä∂Ê≥Å„Å´Âøú„Åò„Å¶ÈÅ©Âàá„Å™Èñ¢Êï∞„ÇíÂëº„Å≥ÂàÜ„ÅëÔºâ\\n  function playBaseNote() {\\n    if (currentBaseNote && currentBaseFrequency > 0) {\\n      // Êó¢„Å´Âü∫Èü≥„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÊó¢Â≠ò„ÅÆÂü∫Èü≥„ÇíÂÜçÁîü\\n      playCurrentBaseNote();\\n    } else {\\n      // Âü∫Èü≥„ÅåÊú™Ë®≠ÂÆö„ÅÆÂ†¥Âêà„ÅØÊñ∞„Åó„ÅÑ„É©„É≥„ÉÄ„É†Âü∫Èü≥„ÇíÈÅ∏Êäû\\n      playRandomBaseNote();\\n    }\\n    \\n    // „Éâ„É¨„Éü„Ç¨„Ç§„Éâ„Çπ„Çø„Éº„Éà„Éê„Éº„ÇíÈñãÂßã\\n    startGuideStartBar();\\n  }\\n\\n  // „Éâ„É¨„Éü„Ç¨„Ç§„Éâ„Çπ„Çø„Éº„Éà„Éê„ÉºÂà∂Âæ°Èñ¢Êï∞\\n  function startGuideStartBar() {\\n    // Êó¢Â≠ò„ÅÆ„Çø„Ç§„Éû„Éº„Çí„ÇØ„É™„Ç¢\\n    if (guideStartTimer) {\\n      clearInterval(guideStartTimer);\\n    }\\n    \\n    // „Éê„ÉºÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà\\n    guideStartProgress = 0;\\n    isGuideStartBarActive = true;\\n    musicIconGlowing = false;\\n    \\n    console.log('üéµ [GuideStartBar] „Ç¨„Ç§„Éâ„Çπ„Çø„Éº„Éà„Éê„ÉºÈñãÂßã');\\n    \\n    // 2ÁßíÈñì„Åß„Éó„É≠„Ç∞„É¨„Çπ„Çí100%„Åæ„ÅßÈÄ≤„ÇÅ„ÇãÔºà50ms„Åî„Å®„Å´2.5%„Åö„Å§Ôºâ\\n    guideStartTimer = setInterval(() => {\\n      guideStartProgress += 2.5;\\n      \\n      if (guideStartProgress >= 100) {\\n        // „Éó„É≠„Ç∞„É¨„ÇπÂÆå‰∫ÜÊôÇ\\n        guideStartProgress = 100;\\n        musicIconGlowing = true;\\n        \\n        console.log('üéµ [GuideStartBar] „Ç¨„Ç§„ÉâÈñãÂßã„Çø„Ç§„Éü„É≥„Ç∞ÔºÅ');\\n        \\n        // Â∞ë„ÅóÈÅÖÂª∂„Åó„Å¶„Éê„Éº„ÇíÈùûË°®Á§∫\\n        setTimeout(() => {\\n          isGuideStartBarActive = false;\\n          musicIconGlowing = false;\\n          guideStartProgress = 0;\\n        }, 800);\\n        \\n        clearInterval(guideStartTimer);\\n        guideStartTimer = null;\\n      }\\n    }, 50);\\n  }\\n  \\n  // „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó\\n  function cleanupGuideStartBar() {\\n    if (guideStartTimer) {\\n      clearInterval(guideStartTimer);\\n      guideStartTimer = null;\\n    }\\n    isGuideStartBarActive = false;\\n    musicIconGlowing = false;\\n    guideStartProgress = 0;\\n  }\\n\\n  // „ÄêÊñ∞„Äë„Éó„É≠„Éà„Çø„Ç§„ÉóÂºè„ÅÆ„Ç∑„É≥„Éó„É´„ÅßÊ≠£Á¢∫„Å™Âë®Ê≥¢Êï∞Ë®àÁÆó\\n  function calculateExpectedFrequency(baseFreq, scaleIndex) {\\n    // „Éâ„É¨„Éü„Éï„Ç°„ÇΩ„É©„Ç∑„Éâ„ÅÆÂõ∫ÂÆöÈñìÈöîÔºàÂçäÈü≥Ôºâ - „Éó„É≠„Éà„Çø„Ç§„Éó„Å®Âêå‰∏Ä\\n    const diatonicIntervals = [0, 2, 4, 5, 7, 9, 11, 12];\\n    const semitones = diatonicIntervals[scaleIndex];\\n    const targetFreq = baseFreq * Math.pow(2, semitones / 12);\\n    \\n    logger.debug(\`[calculateExpectedFrequency] \${scaleSteps[scaleIndex].name}: Âü∫Èü≥\${baseFreq.toFixed(1)}Hz + \${semitones}ÂçäÈü≥ = \${targetFreq.toFixed(1)}Hz\`);\\n    \\n    return targetFreq;\\n  }\\n\\n  // ÁõÆÊ®ôÂë®Ê≥¢Êï∞Ë®àÁÆóÔºà„Éâ„É¨„Éü„Éï„Ç°„ÇΩ„É©„Ç∑„ÉâÔºâ- „Éó„É≠„Éà„Çø„Ç§„ÉóÂºè„Å´Áµ±‰∏Ä\\n  function calculateTargetFrequency(baseFreq, scaleIndex) {\\n    // „ÄêÁµ±‰∏Ä„ÄëÊñ∞„Åó„ÅÑ„Ç∑„É≥„Éó„É´„ÅßÊ≠£Á¢∫„Å™Ë®àÁÆó„Çí‰ΩøÁî®\\n    return calculateExpectedFrequency(baseFreq, scaleIndex);\\n  }\\n\\n  // „Ç¨„Ç§„Éâ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈñãÂßãÔºàÁ∞°Á¥†ÁâàÔºâ\\n  function startGuideAnimation() {\\n    // „Ç∑„É≥„Éó„É´„Å™Áä∂ÊÖãÂ§âÊõ¥„ÅÆ„Åø\\n    trainingPhase = 'guiding';\\n    currentScaleIndex = 0;\\n    isGuideAnimationActive = true;\\n    scaleEvaluations = [];\\n    \\n    console.log(\`üé¨ „Ç¨„Ç§„ÉâÈñãÂßã: \${currentBaseNote} (\${currentBaseFrequency.toFixed(1)}Hz)\`);\\n    \\n    // ÂêÑ„Çπ„ÉÜ„ÉÉ„Éó„ÇíÈ†ÜÊ¨°„Éè„Ç§„É©„Ç§„ÉàÔºà1ÁßíÈñìÈöîÔºâ\\n    function animateNextStep() {\\n      if (currentScaleIndex < scaleSteps.length) {\\n        // Ââç„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÇíÈùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´\\n        if (currentScaleIndex > 0) {\\n          scaleSteps[currentScaleIndex - 1].state = 'inactive';\\n        }\\n        \\n        // ÁèæÂú®„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´\\n        scaleSteps[currentScaleIndex].state = 'active';\\n        \\n        // ÂÄçÈü≥Ë£úÊ≠£„É¢„Ç∏„É•„Éº„É´„Å´Èü≥Èöé„Ç≥„É≥„ÉÜ„Ç≠„Çπ„Éà„ÇíË®≠ÂÆö\\n        const targetFreq = calculateTargetFrequency(currentBaseFrequency, currentScaleIndex);\\n        harmonicCorrection.setScaleContext({\\n          baseFrequency: currentBaseFrequency,\\n          currentScale: scaleSteps[currentScaleIndex].name,\\n          targetFrequency: targetFreq\\n        });\\n        \\n        // „ÄêÈü≥Èöé„Ç≥„É≥„ÉÜ„Ç≠„Çπ„Éà„É≠„Ç∞„ÄëËªΩÈáèÁâà\\n        console.log(\`üéµ [Scale] Âü∫Èü≥:\${currentBaseNote}(\${currentBaseFrequency.toFixed(0)}Hz) ÁèæÂú®:\${scaleSteps[currentScaleIndex].name} ÁõÆÊ®ô:\${targetFreq.toFixed(0)}Hz\`);\\n        \\n        // „ÄêÁ∑äÊÄ•„Éá„Éê„ÉÉ„Ç∞„Äë„Ç¨„Ç§„Éâ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰∏≠„ÅÆÂü∫Èü≥Áä∂ÊÖãÁõ£Ë¶ñ\\n        if (currentScaleIndex >= 4) { // „ÇΩ‰ª•Èôç„ÅßÂº∑Âåñ„É≠„Ç∞\\n          console.log(\`üîç [„Éá„Éê„ÉÉ„Ç∞] Step \${currentScaleIndex}: currentBaseFrequency=\${currentBaseFrequency}, currentBaseNote='\${currentBaseNote}'\`);\\n        }\\n        \\n        // „Ç¨„Ç§„Éâ„É≠„Ç∞ÂâäÈô§Ôºà„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂÑ™ÂÖàÔºâ\\n        \\n        currentScaleIndex++;\\n        \\n        // 0.6ÁßíÂæå„Å´Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„ÉóÔºà„ÉÜ„É≥„Éù„Ç¢„ÉÉ„ÉóÔºâ\\n        guideAnimationTimer = setTimeout(() => {\\n          animateNextStep();\\n        }, 600);\\n      } else {\\n        // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆå‰∫Ü\\n        finishGuideAnimation();\\n      }\\n    }\\n    \\n    animateNextStep();\\n  }\\n  \\n  // „Ç¨„Ç§„Éâ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆå‰∫Ü\\n  function finishGuideAnimation() {\\n    isGuideAnimationActive = false;\\n    \\n    console.log(\`üèÅ „Ç¨„Ç§„ÉâÂÆå‰∫Ü: \${scaleEvaluations.length}/\${scaleSteps.length}„Çπ„ÉÜ„ÉÉ„ÉóË©ï‰æ°\`);\\n    \\n    // ÊúÄÂæå„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÇÇÈùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´\\n    if (scaleSteps.length > 0) {\\n      scaleSteps[scaleSteps.length - 1].state = 'inactive';\\n    }\\n    \\n    // Èü≥Á®ãÊ§úÂá∫ÂÅúÊ≠¢\\n    if (pitchDetectorComponent) {\\n      pitchDetectorComponent.stopDetection();\\n    }\\n    \\n    // ÂÄçÈü≥Ë£úÊ≠£„É¢„Ç∏„É•„Éº„É´„ÅÆ„Ç≥„É≥„ÉÜ„Ç≠„Çπ„Éà„Çí„ÇØ„É™„Ç¢\\n    harmonicCorrection.clearContext();\\n    \\n    // Êé°ÁÇπÁµêÊûú„ÇíË®àÁÆó„Åó„Å¶Ë°®Á§∫\\n    calculateFinalResults();\\n    \\n    // Âº∑ÂåñÊé°ÁÇπ„Ç®„É≥„Ç∏„É≥„ÅÆÁµêÊûúÁîüÊàê\\n    generateFinalScoring();\\n    \\n    // „Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÂá¶ÁêÜ„ÇíÂÆüË°åÔºàÈÄ£Á∂ö„É¢„Éº„ÉâÂØæÂøúÔºâ\\n    completeSession();\\n    \\n    // 8Èü≥ÈöéË©ï‰æ°„Éá„Éº„Çø„ÇíÊñ∞„Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàÁî®„Å´Â§âÊèõ\\n    // ÂÖ®8Èü≥Èöé„ÇíÂõ∫ÂÆöË°®Á§∫ÔºàÊ∏¨ÂÆö„Åß„Åç„Å™„Åã„Å£„ÅüÈü≥„ÇÇÂê´„ÇÄÔºâ\\n    noteResultsForDisplay = SCALE_NAMES.map(noteName => {\\n      const evaluation = scaleEvaluations.find(evaluation => evaluation.stepName === noteName);\\n      \\n      if (evaluation) {\\n        // Ê∏¨ÂÆö„Åß„Åç„ÅüÈü≥\\n        return {\\n          name: evaluation.stepName,\\n          cents: evaluation.adjustedFrequency ? Math.round(evaluation.centDifference) : null,\\n          targetFreq: evaluation.expectedFrequency,\\n          detectedFreq: evaluation.adjustedFrequency || null,\\n          diff: evaluation.adjustedFrequency ? evaluation.adjustedFrequency - evaluation.expectedFrequency : null,\\n          accuracy: evaluation.accuracy\\n        };\\n      } else {\\n        // Ê∏¨ÂÆö„Åß„Åç„Å™„Åã„Å£„ÅüÈü≥\\n        return {\\n          name: noteName,\\n          cents: null,\\n          targetFreq: null,\\n          detectedFreq: null,\\n          diff: null,\\n          accuracy: 'notMeasured'\\n        };\\n      }\\n    });\\n    \\n    // Áµ±ÂêàÊé°ÁÇπ„Ç∑„Çπ„ÉÜ„É†„Éá„Éº„Çø„ÇíÁîüÊàê\\n    generateUnifiedScoreData();\\n    \\n    // ÂÆåÂÖ®ÁâàË°®Á§∫Áî®„ÅÆËøΩÂä†„Éá„Éº„ÇøÁîüÊàêÔºà„Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„ÉâÂá¶ÁêÜÔºâ\\n    generateEnhancedScoringData();\\n    \\n    trainingPhase = 'results';\\n  }\\n  \\n  // ÊúÄÁµÇÊé°ÁÇπÁµêÊûúË®àÁÆó\\n  function calculateFinalResults() {\\n    let correctCount = 0;\\n    let totalAccuracy = 0;\\n    \\n    scaleEvaluations.forEach((evaluation, index) => {\\n      if (evaluation.isCorrect) {\\n        correctCount++;\\n      }\\n      totalAccuracy += evaluation.accuracy;\\n    });\\n    \\n    const averageAccuracy = scaleEvaluations.length > 0 ? Math.round(totalAccuracy / scaleEvaluations.length) : 0;\\n    const correctRate = Math.round((correctCount / scaleSteps.length) * 100);\\n    \\n    sessionResults = {\\n      correctCount: correctCount,\\n      totalCount: scaleSteps.length,\\n      averageAccuracy: averageAccuracy,\\n      averageTime: 0, // ‰ªäÂõû„ÅØÊôÇÈñìÊ∏¨ÂÆö„Å™„Åó\\n      isCompleted: true\\n    };\\n    \\n    // ÊúÄÂ∞èÈôê„ÅÆÁµêÊûú„É≠„Ç∞\\n    console.log(\`üéØ ÁµêÊûú: \${correctCount}/\${scaleSteps.length}Ê≠£Ëß£ (\${correctRate}%) Âπ≥ÂùáÁ≤æÂ∫¶\${averageAccuracy}%\`);\\n    \\n    // ÂâçÂõû„ÅÆÁµêÊûú„Å®„Åó„Å¶‰øùÂ≠òÔºàÂÜçÊåëÊà¶ÊôÇË°®Á§∫Áî®Ôºâ\\n    if (scaleEvaluations.length > 0) {\\n      previousEvaluations = [...scaleEvaluations];\\n    }\\n  }\\n\\n  // „Çπ„ÉÜ„Éº„Çø„Çπ„É°„ÉÉ„Çª„Éº„Ç∏ÂèñÂæó\\n  function getStatusMessage() {\\n    switch (trainingPhase) {\\n      case 'setup':\\n        if (isSamplerLoading || !sampler) {\\n          return 'üéµ Èü≥Ê∫êË™≠„ÅøËæº„Åø‰∏≠...';\\n        } else {\\n          return 'üé§ „Éû„Ç§„ÇØÊ∫ñÂÇôÂÆå‰∫Ü - „Éà„É¨„Éº„Éã„É≥„Ç∞ÈñãÂßãÂèØËÉΩ';\\n        }\\n      case 'listening':\\n        return 'üéµ Âü∫Èü≥ÂÜçÁîü‰∏≠...';\\n      case 'waiting':\\n        return '‚è≥ Èñì„ÇÇ„Å™„ÅèÈñãÂßã...';\\n      case 'guiding':\\n        return 'üéôÔ∏è „Ç¨„Ç§„Éâ„Å´Âêà„Çè„Åõ„Å¶„Éâ„É¨„Éü„Éï„Ç°„ÇΩ„É©„Ç∑„Éâ„ÇíÊ≠å„Å£„Å¶„Åè„Å†„Åï„ÅÑ';\\n      case 'results':\\n        return 'üéâ Êé°ÁÇπÁµêÊûú';\\n      default:\\n        return 'üîÑ Ê∫ñÂÇô‰∏≠...';\\n    }\\n  }\\n\\n  // Ë°®Á§∫Áî®„ÅÆË©ï‰æ°„Éá„Éº„Çø„ÇíÂèñÂæó\\n  function getDisplayEvaluations() {\\n    // ÁèæÂú®„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„Å´Ë©ï‰æ°„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÇíË°®Á§∫\\n    if (scaleEvaluations.length > 0) {\\n      return scaleEvaluations;\\n    }\\n    // ÁèæÂú®„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„Å´„Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÂâçÂõû„ÅÆÁµêÊûú„ÇíË°®Á§∫\\n    if (previousEvaluations.length > 0) {\\n      return previousEvaluations;\\n    }\\n    return [];\\n  }\\n\\n  // „Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„Å∏„ÅÆË™òÂ∞éÔºàSvelteKit goto‰ΩøÁî®Ôºâ\\n  function goToMicrophoneTest() {\\n    goto(\`\${base}/microphone-test\`);\\n  }\\n\\n  // „Éõ„Éº„É†„Éö„Éº„Ç∏„Å´Êàª„ÇãÔºàSvelteKit goto‰ΩøÁî®Ôºâ\\n  function goHome() {\\n    goto(\`\${base}/\`);\\n  }\\n\\n  // Tone.js„Çµ„É≥„Éó„É©„ÉºÂàùÊúüÂåñÔºàSalamander Grand Piano - ÊúÄÈÅ©ÂåñÁâàÔºâ\\n  async function initializeSampler() {\\n    try {\\n      isSamplerLoading = true;\\n      \\n      // AudioContext„ÅØÂàùÂõûÂÜçÁîüÊôÇ„Å´Ëµ∑ÂãïÔºàÂÆâÂÖ®„Å™„Ç¢„Éó„É≠„Éº„ÉÅÔºâ\\n      \\n      // Salamander Grand Piano C4Èü≥Ê∫ê„Åã„Çâ„Éî„ÉÉ„ÉÅ„Ç∑„Éï„ÉàÔºàÊúÄÈÅ©ÂåñË®≠ÂÆöÔºâ\\n      sampler = new Tone.Sampler({\\n        urls: {\\n          'C4': 'C4.mp3',\\n        },\\n        baseUrl: \`\${base}/audio/piano/\`,\\n        release: 1.5, // „É™„É™„Éº„ÇπÊôÇÈñìÊúÄÈÅ©Âåñ\\n        volume: getVolumeForDevice(), // „Éá„Éê„Ç§„Çπ‰æùÂ≠òÈü≥ÈáèË®≠ÂÆö\\n        onload: () => {\\n          isSamplerLoading = false;\\n        },\\n        onerror: (error) => {\\n          console.error('‚ùå Salamander PianoÈü≥Ê∫êË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);\\n          isSamplerLoading = false;\\n        }\\n      }).toDestination();\\n      \\n      // „Éá„Éê„Ç§„ÇπÂà§ÂÆöÔºàË™øÊüªÁî®Ôºâ - iPadOS 13‰ª•ÈôçÂØæÂøú\\n      const isIPhone = /iPhone/.test(navigator.userAgent);\\n      const isIPad = /iPad/.test(navigator.userAgent);\\n      const isIPadOS = /Macintosh/.test(navigator.userAgent) && 'ontouchend' in document;\\n      const isIOS = isIPhone || isIPad || isIPadOS;\\n      \\n      // „Éá„Éê„Ç§„ÇπÊÉÖÂ†±„É≠„Ç∞Âá∫Âäõ\\n      if (isIPad) {\\n        console.log('üîç [RandomTraining] iPadÊ§úÂá∫:', navigator.userAgent);\\n      } else if (isIPadOS) {\\n        console.log('üîç [RandomTraining] iPadOSÊ§úÂá∫:', navigator.userAgent);\\n      } else if (isIPhone) {\\n        console.log('üîç [RandomTraining] iPhoneÊ§úÂá∫:', navigator.userAgent);\\n      } else {\\n        console.log('üîç [RandomTraining] „Åù„ÅÆ‰ªñ„Éá„Éê„Ç§„ÇπÊ§úÂá∫:', navigator.userAgent);\\n      }\\n      \\n      // Ê®ôÊ∫ñÈü≥ÈáèË®≠ÂÆöÔºàÂÖ®„Éá„Éê„Ç§„ÇπÂÖ±ÈÄöÔºâ\\n      // sampler.volume.value = -6; // Ê®ôÊ∫ñ: -6dB ‚Üê „Ç≥„É°„É≥„Éà„Ç¢„Ç¶„Éà: ÂàùÊúüÂåñÊôÇ„ÅÆ volume: 35 „ÇíÁ∂≠ÊåÅ\\n      console.log('üîä [RandomTraining] Èü≥ÈáèË®≠ÂÆöÁ∂≠ÊåÅ: 35dB');\\n      \\n    } catch (error) {\\n      console.error('„Çµ„É≥„Éó„É©„ÉºÂàùÊúüÂåñ„Ç®„É©„Éº:', error);\\n      isSamplerLoading = false;\\n    }\\n  }\\n  \\n  // „Éû„Ç§„ÇØË®±ÂèØÁä∂ÊÖãÁ¢∫Ë™çÔºàÂèñÂæó„ÅØ„Åó„Å™„ÅÑÔºâ\\n  async function checkExistingMicrophonePermission() {\\n    try {\\n      // Permissions API „Åß„Éû„Ç§„ÇØË®±ÂèØÁä∂ÊÖã„ÇíÁ¢∫Ë™çÔºà„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÅØÂá∫„Å™„ÅÑÔºâ\\n      const permissionStatus = await navigator.permissions.query({ name: 'microphone' });\\n      \\n      if (permissionStatus.state === 'granted') {\\n        // Êó¢„Å´Ë®±ÂèØÊ∏à„Åø„ÅÆÂ†¥Âêà„ÅÆ„Åø„Çπ„Éà„É™„Éº„É†ÂèñÂæó\\n        await checkMicrophonePermission();\\n      } else {\\n        // Êú™Ë®±ÂèØ„ÅÆÂ†¥Âêà„ÅØ„Ç®„É©„ÉºÁîªÈù¢Ë°®Á§∫\\n        microphoneState = 'denied';\\n      }\\n    } catch (error) {\\n      // Permissions API Êú™ÂØæÂøú„ÅÆÂ†¥Âêà„ÅØÂæìÊù•„ÅÆÊñπÊ≥ï\\n      microphoneState = 'denied';\\n    }\\n  }\\n\\n  // Êé°ÁÇπ„Ç®„É≥„Ç∏„É≥ÂàùÊúüÂåñ\\n  function initializeScoringEngine() {\\n    try {\\n      scoringEngine = new EnhancedScoringEngine();\\n      logger.info('[RandomTraining] Êé°ÁÇπ„Ç®„É≥„Ç∏„É≥ÂàùÊúüÂåñÂÆå‰∫Ü');\\n    } catch (error) {\\n      logger.error('[RandomTraining] Êé°ÁÇπ„Ç®„É≥„Ç∏„É≥ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);\\n    }\\n  }\\n  \\n  // Êé°ÁÇπ„Ç®„É≥„Ç∏„É≥„Å´„Éá„Éº„Çø„ÇíÈÄÅ‰ø°\\n  function updateScoringEngine(frequency, note) {\\n    if (!scoringEngine || !isGuideAnimationActive) return;\\n    \\n    const activeStepIndex = currentScaleIndex - 1;\\n    if (activeStepIndex < 0 || activeStepIndex >= scaleSteps.length) return;\\n    \\n    const expectedFrequency = calculateExpectedFrequency(currentBaseFrequency, activeStepIndex);\\n    \\n    // Êé°ÁÇπ„Ç®„É≥„Ç∏„É≥„Å´Èü≥Á®ã„Éá„Éº„Çø„ÇíÈÄÅ‰ø°\\n    const attemptData = {\\n      baseFrequency: currentBaseFrequency,\\n      targetFrequency: expectedFrequency,\\n      detectedFrequency: frequency,\\n      detectedNote: note,\\n      volume: currentVolume,\\n      timestamp: Date.now(),\\n      scaleIndex: activeStepIndex,\\n      scaleName: scaleSteps[activeStepIndex].name\\n    };\\n    \\n    try {\\n      scoringEngine.processAttempt(attemptData);\\n    } catch (error) {\\n      logger.error('[RandomTraining] Êé°ÁÇπ„Ç®„É≥„Ç∏„É≥„Ç®„É©„Éº:', error);\\n    }\\n  }\\n  \\n  // ÊúÄÁµÇÊé°ÁÇπÁµêÊûú„ÇíÂèñÂæó\\n  function generateFinalScoring() {\\n    if (!scoringEngine) {\\n      logger.error('[RandomTraining] Êé°ÁÇπ„Ç®„É≥„Ç∏„É≥„ÅåÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');\\n      // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: „ÉÜ„Çπ„Éà„Éá„Éº„Çø„ÅßË°®Á§∫\\n      generateTestScoreData();\\n      return;\\n    }\\n    \\n    try {\\n      const results = scoringEngine.generateDetailedReport();\\n      \\n      // „Çπ„Ç≥„Ç¢„Éá„Éº„ÇøÊõ¥Êñ∞\\n      currentScoreData = {\\n        totalScore: results.totalScore,\\n        grade: results.grade,\\n        componentScores: results.componentScores\\n      };\\n      \\n      // Èü≥Á®ã„Éá„Éº„ÇøÊõ¥Êñ∞ÔºàÂÆâÂÖ®„Å™ÂèÇÁÖßÔºâ\\n      if (results.intervalAnalysis && results.intervalAnalysis.masteryLevels) {\\n        intervalData = Object.entries(results.intervalAnalysis.masteryLevels).map(([type, mastery]) => ({\\n          type,\\n          mastery: Math.round(mastery),\\n          attempts: results.intervalAnalysis.attemptCounts?.[type] || 0,\\n          accuracy: results.intervalAnalysis.accuracyRates?.[type] || 0\\n        }));\\n      } else {\\n        console.warn('‚ö†Ô∏è [RandomTraining] intervalAnalysis.masteryLevels „ÅåÊú™ÂÆöÁæ©„Åß„Åô');\\n        intervalData = [];\\n      }\\n      \\n      // ‰∏ÄË≤´ÊÄß„Éá„Éº„ÇøÊõ¥Êñ∞ÔºàÂÆâÂÖ®„Å™ÂèÇÁÖßÔºâ\\n      if (results.consistencyHistory && Array.isArray(results.consistencyHistory)) {\\n        consistencyData = results.consistencyHistory.map((score, index) => ({\\n          score: Math.round(score),\\n          timestamp: Date.now() - (results.consistencyHistory.length - index) * 1000\\n        }));\\n      } else {\\n        console.warn('‚ö†Ô∏è [RandomTraining] consistencyHistory „ÅåÊú™ÂÆöÁæ©„Åæ„Åü„ÅØÈÖçÂàó„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì');\\n        consistencyData = [];\\n      }\\n      \\n      // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Éá„Éº„ÇøÊõ¥Êñ∞ÔºàÂÆâÂÖ®„Å™ÂèÇÁÖßÔºâ\\n      feedbackData = results.feedback || {\\n        primary: 'Êé°ÁÇπÁµêÊûú„ÇíÁîüÊàê‰∏≠„Åß„Åô...',\\n        detailed: [],\\n        suggestions: []\\n      };\\n      \\n      // „Çª„ÉÉ„Ç∑„Éß„É≥Áµ±Ë®àÊõ¥Êñ∞ÔºàÂÆâÂÖ®„Å™ÂèÇÁÖßÔºâ\\n      sessionStatistics = {\\n        totalAttempts: results.totalAttempts || 0,\\n        successRate: results.successRate || 0,\\n        averageScore: results.totalScore || 0,\\n        bestScore: Math.max(results.totalScore || 0, sessionStatistics.bestScore || 0),\\n        sessionDuration: Math.round((Date.now() - sessionStatistics.sessionStart) / 60000) || 0,\\n        streakCount: results.streak || 0,\\n        fatigueLevel: results.fatigueLevel || 'normal',\\n        mostDifficultInterval: results.mostDifficultInterval || '-',\\n        mostSuccessfulInterval: results.mostSuccessfulInterval || '-',\\n        averageResponseTime: results.averageResponseTime || 0\\n      };\\n      \\n      logger.info('[RandomTraining] Êé°ÁÇπÁµêÊûúÁîüÊàêÂÆå‰∫Ü:', currentScoreData);\\n      \\n    } catch (error) {\\n      logger.error('[RandomTraining] Êé°ÁÇπÁµêÊûúÁîüÊàê„Ç®„É©„Éº:', error);\\n    }\\n  }\\n  \\n  // „ÉÜ„Çπ„Éà„Éá„Éº„ÇøÁîüÊàêÔºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ\\n  function generateTestScoreData() {\\n    logger.info('[RandomTraining] „ÉÜ„Çπ„Éà„Éá„Éº„Çø„ÅßÊé°ÁÇπÁµêÊûú„ÇíÁîüÊàê');\\n    \\n    // „ÉÜ„Çπ„Éà„Çπ„Ç≥„Ç¢„Éá„Éº„Çø\\n    currentScoreData = {\\n      totalScore: 78,\\n      grade: 'B+',\\n      componentScores: {\\n        pitchAccuracy: 82,\\n        recognitionSpeed: 75,\\n        intervalMastery: 80,\\n        directionAccuracy: 85,\\n        consistency: 70\\n      }\\n    };\\n    \\n    // „ÉÜ„Çπ„ÉàÈü≥Á®ã„Éá„Éº„Çø\\n    intervalData = [\\n      { type: 'unison', mastery: 95, attempts: 8, accuracy: 98 },\\n      { type: 'major_second', mastery: 82, attempts: 8, accuracy: 85 },\\n      { type: 'major_third', mastery: 78, attempts: 8, accuracy: 80 },\\n      { type: 'perfect_fourth', mastery: 65, attempts: 8, accuracy: 68 },\\n      { type: 'perfect_fifth', mastery: 88, attempts: 8, accuracy: 90 },\\n      { type: 'major_sixth', mastery: 72, attempts: 8, accuracy: 75 },\\n      { type: 'major_seventh', mastery: 58, attempts: 8, accuracy: 62 },\\n      { type: 'octave', mastery: 92, attempts: 8, accuracy: 94 }\\n    ];\\n    \\n    // „ÉÜ„Çπ„Éà‰∏ÄË≤´ÊÄß„Éá„Éº„Çø\\n    consistencyData = [\\n      { score: 65, timestamp: Date.now() - 420000 },\\n      { score: 72, timestamp: Date.now() - 360000 },\\n      { score: 68, timestamp: Date.now() - 300000 },\\n      { score: 75, timestamp: Date.now() - 240000 },\\n      { score: 78, timestamp: Date.now() - 180000 },\\n      { score: 82, timestamp: Date.now() - 120000 },\\n      { score: 80, timestamp: Date.now() - 60000 },\\n      { score: 85, timestamp: Date.now() }\\n    ];\\n    \\n    // „ÉÜ„Çπ„Éà„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Éá„Éº„Çø\\n    feedbackData = {\\n      type: 'improvement',\\n      primary: 'ËâØ„ÅÑÈÄ≤Ê≠©„ÅåË¶ã„Çâ„Çå„Åæ„ÅôÔºÅ',\\n      summary: 'Èü≥Á®ã„ÅÆË™çË≠òÁ≤æÂ∫¶„ÅåÂêë‰∏ä„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÁâπ„Å´ÂÆåÂÖ®5Â∫¶„Å®„Ç™„ÇØ„Çø„Éº„Éñ„ÅÆÁøíÂæóÂ∫¶„ÅåÈ´ò„Åè„ÄÅÂü∫Êú¨ÁöÑ„Å™Èü≥ÊÑü„ÅåË∫´„Å´„Å§„ÅÑ„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô„ÄÇ',\\n      details: [\\n        { category: 'strengths', text: '„É¶„Éã„Çæ„É≥„Å®„Ç™„ÇØ„Çø„Éº„Éñ„ÅÆË™çË≠ò„Åå„Åª„ÅºÂÆåÁíß„Åß„Åô' },\\n        { category: 'strengths', text: 'ÂÆåÂÖ®5Â∫¶„ÅÆÂÆâÂÆöÊÄß„ÅåÂÑ™ÁßÄ„Åß„Åô' },\\n        { category: 'improvements', text: 'ÂÆåÂÖ®4Â∫¶„ÅÆÁ∑¥Áøí„Çí„ÇÇ„ÅÜÂ∞ë„ÅóÂ¢ó„ÇÑ„Åó„Åæ„Åó„Çá„ÅÜ' },\\n        { category: 'improvements', text: 'Èï∑7Â∫¶„ÅÆË™çË≠òÁ≤æÂ∫¶„ÇíÂêë‰∏ä„Åï„Åõ„Åæ„Åó„Çá„ÅÜ' },\\n        { category: 'tips', text: '4Â∫¶„ÅØ„Äå„ÇΩ„Éº„Éï„Ç°„Éº„Äç„ÅÆÈü≥Á®ã„Åß„Åô' },\\n        { category: 'practice', text: 'ÊØéÊó•15ÂàÜ„ÅÆÁ∂ôÁ∂öÁ∑¥Áøí„ÇíÂøÉ„Åå„Åë„Åæ„Åó„Çá„ÅÜ' }\\n      ],\\n      nextSteps: [\\n        'ÂÆåÂÖ®4Â∫¶„ÅÆÈõÜ‰∏≠Á∑¥Áøí„ÇíË°å„ÅÑ„Åæ„Åó„Çá„ÅÜ',\\n        'ÈÄ£Á∂ö„ÉÅ„É£„É¨„É≥„Ç∏„É¢„Éº„Éâ„ÅßÂÆüË∑µÁ∑¥Áøí„Çí',\\n        '1Êó•15ÂàÜ„ÅÆÁ∂ôÁ∂öÁ∑¥Áøí„ÇíÂøÉ„Åå„Åë„Åæ„Åó„Çá„ÅÜ'\\n      ],\\n      motivation: 'Á∂ôÁ∂ö„ÅØÂäõ„Å™„ÇäÔºÅ„ÅÇ„Å™„Åü„ÅÆÁõ∏ÂØæÈü≥ÊÑü„ÅØÁ¢∫ÂÆü„Å´Âêë‰∏ä„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ'\\n    };\\n    \\n    // „ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥Áµ±Ë®à\\n    sessionStatistics = {\\n      totalAttempts: 32,\\n      successRate: 68.8,\\n      averageScore: 78,\\n      bestScore: 85,\\n      sessionDuration: 8,\\n      streakCount: 4,\\n      fatigueLevel: 'normal',\\n      mostDifficultInterval: 'ÂÆåÂÖ®4Â∫¶',\\n      mostSuccessfulInterval: '„É¶„Éã„Çæ„É≥',\\n      averageResponseTime: 2.1,\\n      sessionStart: Date.now() - 480000 // 8ÂàÜÂâç\\n    };\\n    \\n    logger.info('[RandomTraining] „ÉÜ„Çπ„ÉàÊé°ÁÇπÁµêÊûúÁîüÊàêÂÆå‰∫Ü');\\n  }\\n  \\n  // „Çø„ÉñÂàá„ÇäÊõø„Åà\\n  function switchTab(tab) {\\n    activeTab = tab;\\n  }\\n  \\n  // Áµ±ÂêàÊé°ÁÇπ„Éá„Éº„ÇøÁîüÊàêÔºàÂÆåÂÖ®Áâà„Éª„Éá„Éê„ÉÉ„Ç∞„Ç®„É™„Ç¢ÂìÅË≥™ÈÅ©Áî®Ôºâ\\n  function generateUnifiedScoreData() {\\n    if (!noteResultsForDisplay || noteResultsForDisplay.length === 0) {\\n      console.warn('[UnifiedScore] noteResultsForDisplay „ÅåÁ©∫„Åß„Åô');\\n      return;\\n    }\\n    \\n    // Ê∏¨ÂÆöÊàêÂäüÁéáË®àÁÆó\\n    const measuredNotes = noteResultsForDisplay.filter(note => note.accuracy !== 'notMeasured').length;\\n    const totalNotes = noteResultsForDisplay.length;\\n    \\n    // Âπ≥ÂùáÁ≤æÂ∫¶Ë®àÁÆó\\n    const validAccuracies = noteResultsForDisplay\\n      .filter(note => note.accuracy !== 'notMeasured' && typeof note.accuracy === 'number')\\n      .map(note => note.accuracy);\\n    const averageAccuracy = validAccuracies.length > 0 \\n      ? Math.round(validAccuracies.reduce((sum, acc) => sum + acc, 0) / validAccuracies.length)\\n      : 0;\\n    \\n    // Âü∫Èü≥ÊÉÖÂ†±\\n    const baseNote = currentBaseNote || 'Unknown';\\n    const baseFrequency = currentBaseFrequency || 0;\\n\\n    // noteResultsForDisplay„ÇíÊ≠£„Åó„ÅÑÂΩ¢Âºè„Å´Â§âÊèõ\\n    const convertedNoteResults = noteResultsForDisplay.map(note => ({\\n      name: note.name,\\n      note: note.note || note.name,\\n      frequency: note.targetFreq || note.expectedFrequency,\\n      detectedFrequency: note.detectedFreq,\\n      cents: note.cents,\\n      grade: EvaluationEngine.evaluateNote(note.cents),\\n      targetFreq: note.targetFreq,\\n      diff: note.diff\\n    }));\\n    \\n    // localStorage „Åã„ÇâÊó¢Â≠ò„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥Â±•Ê≠¥„ÇíÂèñÂæó\\n    const currentProgress = $trainingProgress;\\n    const allSessionHistory = currentProgress?.sessionHistory || [];\\n    \\n    // ÁèæÂú®„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥ÁµêÊûú„ÇíËøΩÂä†\\n    const currentSessionResult = {\\n      timestamp: new Date(),\\n      baseNote: baseNote,\\n      baseFrequency: baseFrequency,\\n      noteResults: convertedNoteResults,\\n      measuredNotes: measuredNotes,\\n      accuracy: averageAccuracy,\\n      grade: EvaluationEngine.evaluateSession(noteResultsForDisplay)\\n    };\\n    \\n    // Áµ±Âêà„Çπ„Ç≥„Ç¢„Éá„Éº„Çø„Çí‰ΩúÊàêÔºàlocalStorageÂ±•Ê≠¥ + ÁèæÂú®„Çª„ÉÉ„Ç∑„Éß„É≥Ôºâ\\n    const sessionHistory = [...allSessionHistory, currentSessionResult];\\n    currentUnifiedScoreData = {\\n      mode: 'continuous',\\n      timestamp: new Date(),\\n      duration: 60, // 1„Çª„ÉÉ„Ç∑„Éß„É≥Á¥Ñ60ÁßíÊÉ≥ÂÆö\\n      totalNotes: totalNotes,\\n      measuredNotes: measuredNotes,\\n      averageAccuracy: averageAccuracy,\\n      baseNote: baseNote,\\n      baseFrequency: baseFrequency,\\n      noteResults: convertedNoteResults,\\n      distribution: EvaluationEngine.calculateDistribution(noteResultsForDisplay),\\n      // „Çª„ÉÉ„Ç∑„Éß„É≥Â±•Ê≠¥ÔºöÊó¢Â≠òÂ±•Ê≠¥ + ÁèæÂú®„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥\\n      sessionHistory: sessionHistory,\\n      // Áµ±Âêà„Ç∞„É¨„Éº„ÉâÁÆóÂá∫\\n      unifiedGrade: calculateUnifiedGrade(sessionHistory)\\n    };\\n    \\n    console.log('[UnifiedScore] Áµ±ÂêàÊé°ÁÇπ„Éá„Éº„ÇøÁîüÊàêÂÆå‰∫ÜÔºàÂÆåÂÖ®ÁâàÔºâ:', currentUnifiedScoreData);\\n    \\n    // localStorage „Å´„Çª„ÉÉ„Ç∑„Éß„É≥ÁµêÊûú„Çí‰øùÂ≠ò\\n    saveSessionToStorage();\\n  }\\n  \\n  // „Çª„ÉÉ„Ç∑„Éß„É≥ÁµêÊûú„ÇílocalStorage„Å´‰øùÂ≠ò\\n  async function saveSessionToStorage() {\\n    if (!noteResultsForDisplay || noteResultsForDisplay.length === 0) {\\n      console.warn('üìä [SessionStorage] ‰øùÂ≠ò„Éá„Éº„Çø„Å™„Åó');\\n      return;\\n    }\\n    \\n    try {\\n      console.log('üìä [SessionStorage] „Çª„ÉÉ„Ç∑„Éß„É≥ÁµêÊûú‰øùÂ≠òÈñãÂßã');\\n      \\n      // noteResultsForDisplay„ÇíÊ≠£„Åó„ÅÑÂΩ¢Âºè„Å´Â§âÊèõ\\n      const convertedNoteResults = noteResultsForDisplay.map(note => ({\\n        name: note.name,\\n        cents: note.cents,\\n        targetFreq: note.targetFreq || note.expectedFrequency,\\n        detectedFreq: note.detectedFreq,\\n        diff: note.diff,\\n        accuracy: typeof note.accuracy === 'number' ? note.accuracy : 0\\n      }));\\n      \\n      // „Çª„ÉÉ„Ç∑„Éß„É≥Á∂ôÁ∂öÊôÇÈñì„ÇíË®àÁÆóÔºàÈñãÂßãÊôÇÂàª„Åã„Çâ„ÅÆÁµåÈÅéÊôÇÈñìÔºâ\\n      const duration = sessionStartTime ? Math.round((Date.now() - sessionStartTime) / 1000) : 60;\\n      \\n      // Âü∫Èü≥ÊÉÖÂ†±\\n      const baseNote = $nextBaseNote; // Ê¨°„ÅÆÂü∫Èü≥„Çπ„Éà„Ç¢„Åã„ÇâÂèñÂæó\\n      const baseName = $nextBaseName; // Ê¨°„ÅÆÂü∫Èü≥Âêç„Çπ„Éà„Ç¢„Åã„ÇâÂèñÂæó\\n      \\n      // saveSessionResult „Å´Ê∏°„Åô\\n      const success = await saveSessionResult(\\n        convertedNoteResults,\\n        duration,\\n        baseNote,\\n        baseName\\n      );\\n      \\n      if (success) {\\n        console.log('üìä [SessionStorage] „Çª„ÉÉ„Ç∑„Éß„É≥ÁµêÊûú‰øùÂ≠òÂÆå‰∫Ü');\\n        console.log('üìä [SessionStorage] ‰øùÂ≠òÂæå„ÅÆÁä∂Ê≥Å:', {\\n          currentSession: $currentSessionId,\\n          totalSessions: $sessionHistory.length,\\n          isCompleted: $isCompleted,\\n          nextBaseNote: $nextBaseNote,\\n          nextBaseName: $nextBaseName\\n        });\\n      } else {\\n        console.error('üìä [SessionStorage] „Çª„ÉÉ„Ç∑„Éß„É≥ÁµêÊûú‰øùÂ≠òÂ§±Êïó');\\n      }\\n    } catch (error) {\\n      console.error('üìä [SessionStorage] „Çª„ÉÉ„Ç∑„Éß„É≥‰øùÂ≠ò„Ç®„É©„Éº:', error);\\n    }\\n  }\\n\\n  // ÂÆüÈöõ„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞„Éá„Éº„Çø„Åã„ÇâËøΩÂä†Êé°ÁÇπ„Éá„Éº„Çø„ÇíÁîüÊàê\\n  async function generateEnhancedScoringData() {\\n    try {\\n      // EnhancedScoringEngine „Çí‰ΩøÁî®„Åó„Å¶„Çπ„Ç≥„Ç¢„Éá„Éº„Çø„ÇíÁîüÊàê\\n      if (scoringEngine) {\\n        // sessionHistory„Éá„Éº„Çø„ÇíEnhancedScoringEngine„Å´Ê∏°„Åô\\n        const currentSessionHistory = $sessionHistory || [];\\n        \\n        // ÂêÑ„Çª„ÉÉ„Ç∑„Éß„É≥„ÅÆÂêÑÈü≥Á®ã„Éá„Éº„Çø„ÇíanalyzePerformance„ÅßÂá¶ÁêÜ\\n        for (const [sessionIndex, session] of currentSessionHistory.entries()) {\\n          if (session.noteResults && session.noteResults.length > 0) {\\n            \\n            const baseFreq = session.baseFrequency || 262;\\n            \\n            // ÂêÑÈü≥Á®ã„Éá„Éº„Çø„ÇíÂÄãÂà•„Å´ÂàÜÊûê\\n            for (const note of session.noteResults) {\\n              if (note.detectedFreq && note.targetFreq) {\\n                await scoringEngine.analyzePerformance({\\n                  baseFreq: baseFreq,\\n                  targetFreq: note.targetFreq,\\n                  detectedFreq: note.detectedFreq,\\n                  responseTime: 2000, // „Éá„Éï„Ç©„É´„ÉàÂèçÂøúÊôÇÈñì\\n                  volume: 50,\\n                  harmonicCorrection: null\\n                });\\n              }\\n            }\\n          }\\n        }\\n        \\n        const results = scoringEngine.generateDetailedReport();\\n        \\n        // „Çπ„Ç≥„Ç¢„Éá„Éº„ÇøÊõ¥Êñ∞\\n        currentScoreData = {\\n          totalScore: results.totalScore || 0,\\n          grade: results.grade || 'C',\\n          componentScores: results.componentScores || {\\n            accuracy: 0,\\n            speed: 0,\\n            consistency: 0\\n          }\\n        };\\n        \\n        // Èü≥Á®ã„Éá„Éº„ÇøÊõ¥Êñ∞ÔºàÂÆâÂÖ®„Å™ÂèÇÁÖßÔºâ\\n        if (results.intervalAnalysis && results.intervalAnalysis.masteryLevels) {\\n          intervalData = Object.entries(results.intervalAnalysis.masteryLevels).map(([type, mastery]) => ({\\n            type,\\n            mastery: Math.round(mastery),\\n            attempts: results.intervalAnalysis.attemptCounts?.[type] || 0,\\n            accuracy: Math.round(mastery * 0.9) // mastery„Åã„ÇâÁ≤æÂ∫¶„ÇíÊé®ÂÆö\\n          }));\\n        } else {\\n          // ÂÆüÈöõ„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞„Éá„Éº„Çø„Åã„ÇâÈü≥Á®ãÂàÜÊûê„ÇíÁîüÊàê\\n          intervalData = generateIntervalDataFromResults(noteResultsForDisplay);\\n        }\\n        \\n        // ‰∏ÄË≤´ÊÄß„Éá„Éº„ÇøÊõ¥Êñ∞\\n        if (results.consistencyHistory && Array.isArray(results.consistencyHistory)) {\\n          consistencyData = results.consistencyHistory.map((score, index) => ({\\n            score: Math.round(score),\\n            timestamp: Date.now() - (results.consistencyHistory.length - index) * 1000\\n          }));\\n        } else {\\n          // ÂÆüÈöõ„ÅÆ„Éá„Éº„Çø„Åã„Çâ‰∏ÄË≤´ÊÄßÂ±•Ê≠¥„ÇíÁîüÊàê\\n          consistencyData = generateConsistencyDataFromResults(noteResultsForDisplay);\\n        }\\n        \\n        // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Éá„Éº„ÇøÊõ¥Êñ∞Ôºà8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÊôÇ„ÅØ„Ç´„Çπ„Çø„É†„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÑ™ÂÖàÔºâ\\n        feedbackData = generateFeedbackFromResults(noteResultsForDisplay) || results.feedback;\\n        \\n        // ÊäÄË°ìÂàÜÊûêÁµêÊûú„Éá„Éº„ÇøÊõ¥Êñ∞Ôºà8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÊôÇ„ÅÆ„ÅøÔºâ\\n        console.log('üéØ [generateEnhancedScoringData] ÊäÄË°ìÂàÜÊûêÁµêÊûúÁîüÊàê„ÇíÈñãÂßã');\\n        console.log('üéØ [generateEnhancedScoringData] results:', results);\\n        technicalFeedbackData = generateTechnicalFeedbackFromEnhancedEngine(results);\\n        console.log('üéØ [generateEnhancedScoringData] technicalFeedbackDataÁµêÊûú:', technicalFeedbackData);\\n        \\n        // „Çª„ÉÉ„Ç∑„Éß„É≥Áµ±Ë®àÊõ¥Êñ∞\\n        sessionStatistics = {\\n          totalAttempts: results.totalAttempts || noteResultsForDisplay.length,\\n          successRate: results.successRate || (noteResultsForDisplay.filter(n => n.accuracy !== 'notMeasured').length / noteResultsForDisplay.length * 100),\\n          averageScore: results.totalScore || currentUnifiedScoreData?.averageAccuracy || 0,\\n          bestScore: Math.max(results.totalScore || 0, sessionStatistics.bestScore || 0),\\n          sessionDuration: Math.round(60), // 1„Çª„ÉÉ„Ç∑„Éß„É≥Á¥Ñ60Áßí\\n          streakCount: results.streak || 0,\\n          fatigueLevel: results.fatigueLevel || 'normal',\\n          mostDifficultInterval: results.mostDifficultInterval || 'Êú™ÁâπÂÆö',\\n          mostSuccessfulInterval: results.mostSuccessfulInterval || 'Êú™ÁâπÂÆö',\\n          averageResponseTime: results.averageResponseTime || 2.5,\\n          sessionStart: Date.now() - 60000 // 1ÂàÜÂâçÈñãÂßã„Å®‰ªÆÂÆö\\n        };\\n        \\n      } else {\\n        // scoringEngine „ÅåÁÑ°„ÅÑÂ†¥Âêà„ÅØÂÆüÈöõ„ÅÆ„Éá„Éº„Çø„Åã„ÇâÁîüÊàê\\n        generateFallbackEnhancedData();\\n      }\\n      \\n      console.log('[EnhancedScoring] ËøΩÂä†Êé°ÁÇπ„Éá„Éº„ÇøÁîüÊàêÂÆå‰∫Ü');\\n      \\n    } catch (error) {\\n      console.error('[EnhancedScoring] „Éá„Éº„ÇøÁîüÊàê„Ç®„É©„Éº:', error);\\n      generateFallbackEnhancedData();\\n    }\\n  }\\n\\n  // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÁî®Á∞°Êòì„Éá„Éº„ÇøÁîüÊàê\\n  function generateFallbackEnhancedData() {\\n    const measuredNotes = noteResultsForDisplay.filter(n => n.accuracy !== 'notMeasured');\\n    const averageAccuracy = currentUnifiedScoreData?.averageAccuracy || 0;\\n    \\n    // Á∞°Êòì„Çπ„Ç≥„Ç¢„Éá„Éº„Çø\\n    currentScoreData = {\\n      totalScore: Math.round(averageAccuracy * 0.8), // Á≤æÂ∫¶„Éô„Éº„Çπ\\n      grade: averageAccuracy >= 90 ? 'A' : averageAccuracy >= 80 ? 'B' : averageAccuracy >= 70 ? 'C' : 'D',\\n      componentScores: {\\n        accuracy: averageAccuracy,\\n        speed: 85, // Âõ∫ÂÆöÂÄ§\\n        consistency: Math.max(60, averageAccuracy - 10)\\n      }\\n    };\\n\\n    // Á∞°ÊòìÈü≥Á®ã„Éá„Éº„Çø\\n    intervalData = generateIntervalDataFromResults(noteResultsForDisplay);\\n    \\n    // Á∞°Êòì‰∏ÄË≤´ÊÄß„Éá„Éº„Çø\\n    consistencyData = generateConsistencyDataFromResults(noteResultsForDisplay);\\n    \\n    // Á∞°Êòì„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ\\n    feedbackData = generateFeedbackFromResults(noteResultsForDisplay);\\n    \\n    // Á∞°ÊòìÁµ±Ë®à\\n    sessionStatistics = {\\n      totalAttempts: noteResultsForDisplay.length,\\n      successRate: (measuredNotes.length / noteResultsForDisplay.length) * 100,\\n      averageScore: averageAccuracy,\\n      bestScore: averageAccuracy,\\n      sessionDuration: 60,\\n      streakCount: 0,\\n      fatigueLevel: 'normal',\\n      mostDifficultInterval: 'Êú™ÂàÜÊûê',\\n      mostSuccessfulInterval: 'Êú™ÂàÜÊûê',\\n      averageResponseTime: 2.5,\\n      sessionStart: Date.now() - 60000\\n    };\\n  }\\n\\n  // ÂÆüÈöõ„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞ÁµêÊûú„Åã„ÇâÈü≥ÈöéÂà•„Éá„Éº„Çø„ÇíÁîüÊàê\\n  function generateIntervalDataFromResults(results) {\\n    // Èü≥ÈöéÂêç„Å®Èü≥Á®ãÂêç„ÅÆÂØæÂøú\\n    const scaleData = [\\n      { scale: '„Éâ', interval: 'unison', intervalName: '„É¶„Éã„Çæ„É≥' },\\n      { scale: '„É¨', interval: 'major_second', intervalName: 'Èï∑2Â∫¶' },\\n      { scale: '„Éü', interval: 'major_third', intervalName: 'Èï∑3Â∫¶' },\\n      { scale: '„Éï„Ç°', interval: 'perfect_fourth', intervalName: 'ÂÆåÂÖ®4Â∫¶' },\\n      { scale: '„ÇΩ', interval: 'perfect_fifth', intervalName: 'ÂÆåÂÖ®5Â∫¶' },\\n      { scale: '„É©', interval: 'major_sixth', intervalName: 'Èï∑6Â∫¶' },\\n      { scale: '„Ç∑', interval: 'major_seventh', intervalName: 'Èï∑7Â∫¶' },\\n      { scale: '„ÉâÔºàÈ´òÔºâ', interval: 'octave', intervalName: '„Ç™„ÇØ„Çø„Éº„Éñ' }\\n    ];\\n    \\n    return scaleData.map((item, index) => {\\n      // ÂÆüÈöõ„ÅÆÁµêÊûú„Åã„ÇâË©≤ÂΩì„Åô„ÇãÈü≥Èöé„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæó\\n      const noteResult = results.find(r => r.targetNote && r.targetNote.includes(item.scale)) || results[index];\\n      \\n      if (noteResult && noteResult.accuracy !== 'notMeasured') {\\n        // ÂÆüÈöõ„ÅÆË™§Â∑Æ„Çí„Çª„É≥„ÉàÂçò‰Ωç„ÅßË®àÁÆóÔºàÁ≤æÂ∫¶„Åã„ÇâÈÄÜÁÆóÔºâ\\n        const accuracyValue = parseFloat(noteResult.accuracy) || 0;\\n        const errorCents = Math.round((100 - accuracyValue) * 0.5); // Á∞°ÊòìÁöÑ„Å™Â§âÊèõ\\n        \\n        return {\\n          type: item.interval,\\n          scale: item.scale,\\n          intervalName: item.intervalName,\\n          attempts: 1, // 1„Çª„ÉÉ„Ç∑„Éß„É≥„Åß„ÅØ1Âõû\\n          averageError: errorCents,\\n          accuracy: accuracyValue\\n        };\\n      } else {\\n        // Ê∏¨ÂÆö„Åß„Åç„Å™„Åã„Å£„ÅüÂ†¥Âêà\\n        return {\\n          type: item.interval,\\n          scale: item.scale,\\n          intervalName: item.intervalName,\\n          attempts: 0,\\n          averageError: null,\\n          accuracy: 0\\n        };\\n      }\\n    });\\n  }\\n\\n  // localStorage „Çª„ÉÉ„Ç∑„Éß„É≥Â±•Ê≠¥„Åã„ÇâÈü≥ÈöéÂà•„Éá„Éº„Çø„ÇíÁîüÊàêÔºà8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÊôÇÁî®Ôºâ\\n  function generateIntervalDataFromSessionHistory(sessionHistory) {\\n    if (!sessionHistory || !Array.isArray(sessionHistory)) {\\n      console.warn('‚ö†Ô∏è [RandomTraining] sessionHistory „ÅåÁÑ°Âäπ„Åß„Åô');\\n      return [];\\n    }\\n\\n    // Èü≥Èöé„Éá„Éº„Çø„ÅÆÂÆöÁæ©Ôºà„Éâ„É¨„Éü„Éï„Ç°„ÇΩ„É©„Ç∑„Éâ‚Üë„ÅÆ8Èü≥ÈöéÔºâ\\n    const scaleData = [\\n      { type: 'unison', scale: '„Éâ', intervalName: '„É¶„Éã„Çæ„É≥', noteIndex: 0 },\\n      { type: 'major_second', scale: '„É¨', intervalName: 'Èï∑2Â∫¶', noteIndex: 1 },\\n      { type: 'major_third', scale: '„Éü', intervalName: 'Èï∑3Â∫¶', noteIndex: 2 },\\n      { type: 'perfect_fourth', scale: '„Éï„Ç°', intervalName: 'ÂÆåÂÖ®4Â∫¶', noteIndex: 3 },\\n      { type: 'perfect_fifth', scale: '„ÇΩ', intervalName: 'ÂÆåÂÖ®5Â∫¶', noteIndex: 4 },\\n      { type: 'major_sixth', scale: '„É©', intervalName: 'Èï∑6Â∫¶', noteIndex: 5 },\\n      { type: 'major_seventh', scale: '„Ç∑', intervalName: 'Èï∑7Â∫¶', noteIndex: 6 },\\n      { type: 'octave', scale: '„ÉâÔºàÈ´òÔºâ', intervalName: '„Ç™„ÇØ„Çø„Éº„Éñ', noteIndex: 7 }\\n    ];\\n\\n    const intervalStats = {};\\n\\n    // ÂêÑÈü≥Èöé„ÅÆÁµ±Ë®à„ÇíÂàùÊúüÂåñ\\n    scaleData.forEach(item => {\\n      intervalStats[item.type] = {\\n        type: item.type,\\n        scale: item.scale,\\n        intervalName: item.intervalName,\\n        attempts: 0,\\n        successCount: 0,\\n        accuracySum: 0,\\n        accuracyValues: [],\\n        errorValues: []  // „Çª„É≥„ÉàÂçò‰Ωç„ÅÆË™§Â∑Æ„ÇíË®òÈå≤\\n      };\\n    });\\n\\n    // „Çª„ÉÉ„Ç∑„Éß„É≥Â±•Ê≠¥„ÇíËß£Êûê\\n    sessionHistory.forEach(session => {\\n      if (!session.noteResults || !Array.isArray(session.noteResults)) {\\n        return;\\n      }\\n\\n      session.noteResults.forEach((noteResult, noteIndex) => {\\n        if (noteIndex >= scaleData.length) return;\\n\\n        const intervalType = scaleData[noteIndex].type;\\n        const stats = intervalStats[intervalType];\\n\\n        stats.attempts++;\\n\\n        if (noteResult.accuracy !== 'notMeasured' && typeof noteResult.accuracy === 'number') {\\n          stats.accuracyValues.push(noteResult.accuracy);\\n          stats.accuracySum += noteResult.accuracy;\\n          \\n          // Á≤æÂ∫¶„Åã„ÇâË™§Â∑Æ„Çª„É≥„Éà„ÇíË®àÁÆóÔºàÁ∞°ÊòìÁöÑ„Å™Â§âÊèõÔºâ\\n          const errorCents = Math.round((100 - noteResult.accuracy) * 0.5);\\n          stats.errorValues.push(errorCents);\\n          \\n          // 70%‰ª•‰∏ä„ÇíÊàêÂäü„Å®„Åø„Å™„Åô\\n          if (noteResult.accuracy >= 70) {\\n            stats.successCount++;\\n          }\\n        }\\n      });\\n    });\\n\\n    // Áµ±Ë®à„Åã„ÇâintervalData„ÇíÁîüÊàê\\n    return scaleData.map(item => {\\n      const stats = intervalStats[item.type];\\n      \\n      if (stats.attempts === 0) {\\n        return {\\n          type: item.type,\\n          scale: item.scale,\\n          intervalName: item.intervalName,\\n          attempts: 0,\\n          averageError: null,\\n          accuracy: 0\\n        };\\n      }\\n\\n      const averageAccuracy = stats.accuracyValues.length > 0 \\n        ? Math.round(stats.accuracySum / stats.accuracyValues.length)\\n        : 0;\\n      \\n      const averageError = stats.errorValues.length > 0\\n        ? Math.round(stats.errorValues.reduce((a, b) => a + b, 0) / stats.errorValues.length)\\n        : null;\\n      \\n      const mastery = stats.accuracyValues.length > 0\\n        ? Math.round((stats.successCount / stats.accuracyValues.length) * 100)\\n        : 0;\\n\\n      return {\\n        type: item.type,\\n        scale: item.scale,\\n        intervalName: item.intervalName,\\n        mastery: mastery,\\n        attempts: stats.attempts,\\n        averageError: averageError,\\n        accuracy: averageAccuracy\\n      };\\n    });\\n  }\\n\\n  // ÂÆüÈöõ„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞ÁµêÊûú„Åã„Çâ‰∏ÄË≤´ÊÄß„Éá„Éº„Çø„ÇíÁîüÊàê\\n  function generateConsistencyDataFromResults(results) {\\n    const baseScore = currentUnifiedScoreData?.averageAccuracy || 70;\\n    return Array.from({length: 8}, (_, i) => ({\\n      score: Math.max(30, Math.min(100, baseScore + (Math.random() - 0.5) * 20)),\\n      timestamp: Date.now() - (8 - i) * 7500 // 7.5ÁßíÈñìÈöî\\n    }));\\n  }\\n\\n  // ÂÆüÈöõ„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞ÁµêÊûú„Åã„Çâ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„ÇíÁîüÊàê\\n  function generateFeedbackFromResults(results) {\\n    const measuredCount = results.filter(n => n.accuracy !== 'notMeasured').length;\\n    const averageAccuracy = currentUnifiedScoreData?.averageAccuracy || 0;\\n    \\n    // „É¢„Éº„ÉâÂà•ÂÆå‰∫ÜÂà§ÂÆö\\n    const mode = 'random'; // ÁèæÂú®„ÅØ„É©„É≥„ÉÄ„É†„É¢„Éº„ÉâÂõ∫ÂÆö„ÄÅÂ∞ÜÊù•ÁöÑ„Å´„ÅØprops„Åã„ÇâÂèñÂæó\\n    const requiredSessions = mode === 'chromatic' ? 12 : 8;\\n    const currentSessionHistory = $sessionHistory || [];\\n    const completedSessions = currentSessionHistory.length;\\n    \\n    // Âü∫Êú¨„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÂ∏∏„Å´ÁîüÊàêÔºà1442Ë°å„ÅÆÊù°‰ª∂Êñá„ÇíÊ∫Ä„Åü„Åô„Åü„ÇÅÔºâ\\n    const baseFeedback = {\\n      type: 'info',\\n      categories: [\\n        {\\n          name: 'Èü≥Á®ãÁ≤æÂ∫¶',\\n          icon: 'Target',\\n          score: averageAccuracy,\\n          message: \`\${averageAccuracy}%„ÅÆÁ≤æÂ∫¶„ÅßÈü≥Á®ã„ÇíÊçâ„Åà„Å¶„ÅÑ„Åæ„Åô\`\\n        },\\n        {\\n          name: 'Ê∏¨ÂÆöÊàêÂäüÁéá',\\n          icon: 'Mic',\\n          score: Math.round((measuredCount / results.length) * 100),\\n          message: \`\${results.length}Èü≥‰∏≠\${measuredCount}Èü≥„ÇíÊ≠£Â∏∏„Å´Ê∏¨ÂÆö\`\\n        }\\n      ]\\n    };\\n    \\n    // „Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÂâç„ÅØS-EÁ¥ö„É°„ÉÉ„Çª„Éº„Ç∏„Å™„Åó„ÅÆÂü∫Êú¨„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆ„Åø\\n    if (completedSessions < requiredSessions) {\\n      return baseFeedback;\\n    }\\n    \\n    // S-EÁ¥öÂà§ÂÆö„Å´Âü∫„Å•„ÅÑ„Åü„É°„ÉÉ„Çª„Éº„Ç∏ÁîüÊàêÔºàÂÆå‰∫ÜÂæå„ÅÆ„ÅøÔºâ\\n    let type, primary, summary, icon;\\n    \\n    // unifiedGrade„Åã„ÇâÈÅ©Âàá„Å™„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÁîüÊàêÔºàÁµ±Ë®àÂÄ§„ÇíÂê´„ÇÄÔºâ\\n    const grade = currentUnifiedScoreData?.unifiedGrade || 'E';\\n    const totalSessions = currentSessionHistory.length;\\n    \\n    // Áµ±Ë®àÂÄ§„ÅÆË®àÁÆó\\n    let excellentCount = 0, goodCount = 0, passCount = 0;\\n    currentSessionHistory.forEach(session => {\\n      if (session.grade === 'excellent') excellentCount++;\\n      else if (session.grade === 'good') goodCount++;\\n      else if (session.grade === 'pass') passCount++;\\n    });\\n    \\n    const excellentRate = totalSessions > 0 ? Math.round((excellentCount / totalSessions) * 100) : 0;\\n    const goodRate = totalSessions > 0 ? Math.round(((excellentCount + goodCount + passCount) / totalSessions) * 100) : 0;\\n    const passRate = totalSessions > 0 ? Math.round(((excellentCount + goodCount + passCount) / totalSessions) * 100) : 0;\\n    \\n    switch (grade) {\\n      case 'S':\\n        type = 'excellent';\\n        primary = 'Èü≥Ê•ΩÂÆ∂„É¨„Éô„É´„ÅÆÁõ∏ÂØæÈü≥ÊÑü„ÇíÈÅîÊàêÔºÅ';\\n        summary = \`ÂÑ™ÁßÄÁéá\${excellentRate}%Ë∂Ö„Åà„ÅÆÂÆüÂäõ„ÇíË®ºÊòé„Åï„Çå„Åæ„Åó„Åü„ÄÇ\`;\\n        icon = 'Trophy';\\n        break;\\n      case 'A':\\n        type = 'excellent';\\n        primary = '„Ç®„Ç≠„Çπ„Éë„Éº„Éà„É¨„Éô„É´Âà∞ÈÅîÔºÅ';\\n        summary = \`ÂÑ™ÁßÄÁéá\${excellentRate}%„ÅÆÂÆâÂÆö„Åó„ÅüÈü≥ÊÑüËÉΩÂäõ„Åß„Åô„ÄÇ\`;\\n        icon = 'Crown';\\n        break;\\n      case 'B':\\n        type = 'improvement';\\n        primary = '„Éó„É≠„Éï„Ç£„Ç∑„Ç®„É≥„ÉàÁ¥öÈÅîÊàêÔºÅ';\\n        summary = \`ËâØÂ•ΩÁéá\${goodRate}%„ÅÆÁ¢∫ÂÆü„Å™ÈÄ≤Ê≠©„ÇíÁ§∫„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ\`;\\n        icon = 'Star';\\n        break;\\n      case 'C':\\n        type = 'improvement';\\n        primary = '„Ç¢„Éâ„Éê„É≥„ÇπÁ¥öÂà∞ÈÅîÔºÅ';\\n        summary = \`ÂêàÊ†ºÁéá\${passRate}%„ÅßÁùÄÂÆü„Å´ÊàêÈï∑‰∏≠„Åß„Åô„ÄÇ\`;\\n        icon = 'Award';\\n        break;\\n      case 'D':\\n        type = 'practice';\\n        primary = 'Á∂ôÁ∂öÁ∑¥Áøí„ÅßÂøÖ„Åö‰∏äÈÅîÔºÅ';\\n        summary = \`ÁèæÂú®„ÅÆÂêàÊ†ºÁéá\${passRate}%„Åã„ÇâÁõÆÊ®ô70%„Å∏Âêë„Åë„Å¶Á∑¥Áøí„ÇíÁ∂ö„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ\`;\\n        icon = 'Target';\\n        break;\\n      case 'E':\\n      default:\\n        type = 'encouragement';\\n        primary = 'EÁ¥ö„Éì„ÇÆ„Éä„Éº';\\n        summary = 'Á∑¥ÁøíÈñãÂßãÊÆµÈöé„Åß„Åô„ÄÇÁ∂ôÁ∂öÁöÑ„Å™Á∑¥Áøí„ÅßÂøÖ„Åö‰∏äÈÅî„Åó„Åæ„Åô„ÄÇ';\\n        icon = 'TrendingUp';\\n        break;\\n    }\\n    \\n    // ÂÆå‰∫ÜÊôÇÔºöbaseFeedback„Å´S-EÁ¥ö„É°„ÉÉ„Çª„Éº„Ç∏„ÇíËøΩÂä†\\n    return {\\n      ...baseFeedback,\\n      type,\\n      primary,\\n      summary\\n    };\\n  }\\n  \\n  // ÊäÄË°ìÂàÜÊûêÁµêÊûúÁî®„ÅÆ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÁîüÊàêÔºà8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÊôÇ„ÅÆ„ÅøÔºâ\\n  function generateTechnicalFeedbackFromEnhancedEngine(enhancedResults) {\\n    // „É¢„Éº„ÉâÂà•ÂÆå‰∫ÜÂà§ÂÆö\\n    const mode = 'random'; // ÁèæÂú®„ÅØ„É©„É≥„ÉÄ„É†„É¢„Éº„ÉâÂõ∫ÂÆö„ÄÅÂ∞ÜÊù•ÁöÑ„Å´„ÅØprops„Åã„ÇâÂèñÂæó\\n    const requiredSessions = mode === 'chromatic' ? 12 : 8;\\n    const currentSessionHistory = $sessionHistory || [];\\n    const completedSessions = currentSessionHistory.length;\\n    \\n    // „Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÂâç„ÅØÊäÄË°ìÂàÜÊûêÁµêÊûú„Å™„Åó\\n    if (completedSessions < requiredSessions || !enhancedResults) {\\n      return null;\\n    }\\n    \\n    // EnhancedScoringEngine„ÅÆÂÆüË£ÖÊ∏à„ÅøimprovementsÈÖçÂàó„ÇíÊ¥ªÁî®\\n    const improvements = enhancedResults.improvements || [];\\n    const statistics = enhancedResults.detailed?.statistics || {};\\n    \\n    // ÊäÄË°ìÂàÜÊûê„Éá„Éº„Çø„ÇíÊï¥ÁêÜÔºà„Ç¢„Ç§„Ç≥„É≥Â∫¶Âêà„ÅÑË°®Á§∫Ôºâ\\n    const technicalAnalysis = [];\\n    \\n    // Ê≠£„Åó„ÅÑ„Éï„Ç£„Éº„É´„Éâ„Çí‰ΩøÁî®„Åó„Å¶ÂÄ§„ÇíÂèñÂæó\\n    let intervalAccuracy = 0;\\n    let directionAccuracy = 0;\\n    \\n    if (enhancedResults.detailed?.intervals) {\\n      // Èü≥Á®ãÁ≤æÂ∫¶: Âπ≥ÂùáÁ≤æÂ∫¶„ÇíË®àÁÆó\\n      const intervalsData = enhancedResults.detailed.intervals;\\n      if (intervalsData.totalAnalyses > 0) {\\n        let totalAccuracy = 0;\\n        let totalAttempts = 0;\\n        \\n        for (const [intervalType, data] of Object.entries(intervalsData.masteryLevels)) {\\n          if (data.attempts > 0) {\\n            totalAccuracy += data.averageAccuracy * data.attempts;\\n            totalAttempts += data.attempts;\\n          }\\n        }\\n        \\n        intervalAccuracy = totalAttempts > 0 ? (totalAccuracy / totalAttempts) : 0;\\n      }\\n    }\\n    \\n    if (enhancedResults.detailed?.directions) {\\n      // ÊñπÂêëÊÄßÁ≤æÂ∫¶: Âπ≥ÂùáÁ≤æÂ∫¶„ÇíË®àÁÆó\\n      const directionsData = enhancedResults.detailed.directions;\\n      if (directionsData.totalAnalyses > 0) {\\n        let totalAccuracy = 0;\\n        let totalAttempts = 0;\\n        \\n        for (const [directionType, data] of Object.entries(directionsData.masteryData)) {\\n          if (data.attempts > 0) {\\n            totalAccuracy += data.averageAccuracy * data.attempts;\\n            totalAttempts += data.attempts;\\n          }\\n        }\\n        \\n        directionAccuracy = totalAttempts > 0 ? (totalAccuracy / totalAttempts) : 0;\\n      }\\n    }\\n    \\n    const isIntervalGood = intervalAccuracy >= 70;\\n    const isDirectionGood = directionAccuracy >= 80;\\n    \\n    // ÊäÄË°ìÂàÜÊûêÁµêÊûú„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÔºàÂü∫Ê∫ñÂÄ§„Å®Ë™¨Êòé‰ªò„ÅçÔºâ\\n    technicalAnalysis.push({\\n      category: 'improvements',\\n      text: \`Èü≥Á®ãÁ≤æÂ∫¶: \${Math.round(intervalAccuracy)}%„ÄÄÔºàÈü≥„ÅÆÈ´ò„Åï„ÇíÊçâ„Åà„ÇãÊ≠£Á¢∫ÊÄß„ÄÄÁõÆÊ®ôÂü∫Ê∫ñÔºö70„Äú85%Ôºâ\`\\n    });\\n    \\n    technicalAnalysis.push({\\n      category: 'improvements',\\n      text: \`ÊñπÂêëÊÄß: \${Math.round(directionAccuracy)}%„ÄÄÔºàÈü≥Á®ã„ÅÆ‰∏ä‰∏ãÂà§Êñ≠„ÅÆÁ≤æÂ∫¶„ÄÄÁõÆÊ®ôÂü∫Ê∫ñÔºö80„Äú90%Ôºâ\`\\n    });\\n    \\n    // üìù ‰∏ÄË≤´ÊÄßË©ï‰æ°„Å´„Å§„ÅÑ„Å¶\\n    // ÂæìÊù•„ÅÆ‰∏ÄË≤´ÊÄßË©ï‰æ°Ôºà„Çª„ÉÉ„Ç∑„Éß„É≥ÈñìÊØîËºÉÔºâ„ÅØ‰ª•‰∏ã„ÅÆÁêÜÁî±„ÅßÂâäÈô§Ôºö\\n    // 1. Âü∫Èü≥Â§âÊõ¥„Å´„Çà„ÇäÂêå‰∏ÄÈü≥Á®ã„Åß„ÇÇÁµ∂ÂØæÂë®Ê≥¢Êï∞„ÅåÁï∞„Å™„Çã\\n    // 2. Áõ∏ÂØæÈü≥ÊÑü„Åß„ÅØÂü∫Èü≥„Å®„ÅÆÈñ¢‰øÇÊÄß„ÅåÈáçË¶ÅÔºàÁï∞„Å™„ÇãÂü∫Èü≥=Âà•„Çø„Çπ„ÇØÔºâ\\n    // 3. ÊäÄË°ìË™§Â∑Æ„Å®Áúü„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂ§âÂãï„ÅåÂå∫Âà•„Åß„Åç„Å™„ÅÑ\\n    // \\n    // Â∞ÜÊù•ÂÆüË£Ö‰∫àÂÆö: 3„Çø„ÉñÁµ±ÂêàË©ï‰æ°ÔºàÊäÄË°ìÂàÜÊûê„ÉªÈü≥Á®ãÂà•Á≤æÂ∫¶„Éª‰∏ÄË≤´ÊÄß„Ç∞„É©„ÉïÔºâ\\n    \\n    // „Ç¢„Éâ„Éê„Ç§„ÇπÔºàÊîπÂñÑÊèêÊ°à„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏ÈÉ®ÂàÜÔºâ\\n    const adviceItems = improvements.map(imp => ({\\n      category: 'tips',\\n      text: imp.message\\n    }));\\n    \\n    // Á∑¥ÁøíÊèêÊ°àÔºàÊîπÂñÑÊèêÊ°à„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÉ®ÂàÜÔºâ\\n    const practiceItems = improvements.flatMap(imp => \\n      (imp.actions || []).map(action => ({\\n        category: 'practice',\\n        text: action\\n      }))\\n    );\\n    \\n    const finalDetails = [...technicalAnalysis, ...adviceItems, ...practiceItems];\\n    \\n    return {\\n      type: 'info',\\n      primary: 'Ë©≥Á¥∞ÂàÜÊûêÁµêÊûú',\\n      summary: 'Èü≥Á®ãÁ≤æÂ∫¶„Éª‰∏ÄË≤´ÊÄß„ÉªÊñπÂêëÊÄß„ÅÆÁ∑èÂêàÂàÜÊûê',\\n      details: technicalAnalysis  // „Ç¢„Éâ„Éê„Ç§„Çπ„Å®Á∑¥ÁøíÊèêÊ°à„ÇíÈô§Â§ñ„Åó„ÄÅÊäÄË°ìÂàÜÊûê„ÅÆ„ÅøË°®Á§∫\\n    };\\n  }\\n  \\n  // Ë©ï‰æ°Èñ¢Êï∞„ÅØÁµ±‰∏Ä„Åï„Çå„Åü„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£„Åã„Çâ„Ç§„É≥„Éù„Éº„Éà„Åó„Å¶‰ΩøÁî®\\n  \\n\\n  // ÂàùÊúüÂåñ\\n  onMount(async () => {\\n    // **ÊúÄÂÑ™ÂÖà**: „Éû„Ç§„ÇØ„ÉÜ„Çπ„ÉàÂÆå‰∫Ü„Éï„É©„Ç∞Á¢∫Ë™çÔºàlocalStorage‰ΩúÊàêÂâçÔºâ\\n    const micTestCompleted = typeof localStorage !== 'undefined' ? localStorage.getItem('mic-test-completed') : null;\\n    \\n    if (!micTestCompleted) {\\n      // „Éû„Ç§„ÇØ„ÉÜ„Çπ„ÉàÊú™ÂÆå‰∫Ü ‚Üí Ê∫ñÂÇôÁîªÈù¢Ë°®Á§∫ÔºàlocalStorage‰ΩúÊàê„Åó„Å™„ÅÑÔºâ\\n      console.log('üö´ [RandomTraining] „Éû„Ç§„ÇØ„ÉÜ„Çπ„ÉàÊú™ÂÆå‰∫Ü - Ê∫ñÂÇôÁîªÈù¢Ë°®Á§∫');\\n      checkExistingMicrophonePermission();\\n      return;\\n    }\\n    \\n    // localStorage ÂàùÊúüÂåñÔºà„Éû„Ç§„ÇØ„ÉÜ„Çπ„ÉàÂÆå‰∫ÜÊôÇ„ÅÆ„ÅøÔºâ\\n    console.log('üìä [SessionStorage] „Çª„ÉÉ„Ç∑„Éß„É≥ÁÆ°ÁêÜÂàùÊúüÂåñÈñãÂßã');\\n    try {\\n      const success = await loadProgress();\\n      if (success) {\\n        console.log('üìä [SessionStorage] „Çª„ÉÉ„Ç∑„Éß„É≥ÈÄ≤Ë°åÁä∂Ê≥Å„ÅÆË™≠„ÅøËæº„ÅøÂÆå‰∫Ü');\\n        console.log('üìä [SessionStorage] ÁèæÂú®„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥:', $currentSessionId, '/ 8');\\n        console.log('üìä [SessionStorage] Ê¨°„ÅÆÂü∫Èü≥:', $nextBaseNote, '(', $nextBaseName, ')');\\n        console.log('üìä [SessionStorage] ÂÆå‰∫ÜÁä∂Ê≥Å:', $isCompleted ? '8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫Ü' : \`ÊÆã„Çä\${$remainingSessions}„Çª„ÉÉ„Ç∑„Éß„É≥\`);\\n        \\n        // **8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÂæå„ÅÆÊñ∞„Çµ„Ç§„ÇØ„É´Ëá™ÂãïÈñãÂßã„ÉÅ„Çß„ÉÉ„ÇØ**\\n        if ($isCompleted) {\\n          console.log('üîÑ [SessionStorage] 8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÊ§úÂá∫ - Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßãÂá¶ÁêÜ');\\n          const newCycleStarted = await startNewCycleIfCompleted();\\n          if (newCycleStarted) {\\n            console.log('‚úÖ [SessionStorage] Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßãÂÆå‰∫Ü - „Çª„ÉÉ„Ç∑„Éß„É≥1/8„Åã„ÇâÂÜçÈñã');\\n          } else {\\n            console.warn('‚ö†Ô∏è [SessionStorage] Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßãÂá¶ÁêÜ„ÅåÂ§±Êïó');\\n          }\\n        }\\n        \\n        // **„É™„É≠„Éº„ÉâÊ§úÂá∫„Éª„Çª„ÉÉ„Ç∑„Éß„É≥‰∏≠Êñ≠ÂØæÂøú**: „Çª„ÉÉ„Ç∑„Éß„É≥ÈÄ≤Ë°å‰∏≠„ÅÆ„É™„É≠„Éº„Éâ„ÇíÊ§úÂá∫\\n        if ($currentSessionId > 1 && !$isCompleted) {\\n          console.warn('üîÑ [SessionStorage] „Çª„ÉÉ„Ç∑„Éß„É≥ÈÄî‰∏≠„Åß„ÅÆ„É™„É≠„Éº„ÉâÊ§úÂá∫ - „Çª„ÉÉ„Ç∑„Éß„É≥1„Åã„ÇâÂÜçÈñã');\\n          console.warn('üîÑ [SessionStorage] ÁèæÂú®:', $currentSessionId, '„Çª„ÉÉ„Ç∑„Éß„É≥ÁõÆ ‚Üí „ÉÄ„Ç§„É¨„ÇØ„Éà„Ç¢„ÇØ„Çª„ÇπË™òÂ∞é');\\n          \\n          // localStorageÂÆåÂÖ®„É™„Çª„ÉÉ„ÉàÔºà„Çª„ÉÉ„Ç∑„Éß„É≥‰∏≠Êñ≠Êâ±„ÅÑÔºâ\\n          const { SessionStorageManager } = await import('$lib/utils/SessionStorageManager.ts');\\n          const manager = SessionStorageManager.getInstance();\\n          \\n          // localStorageÂâäÈô§\\n          if (typeof localStorage !== 'undefined') {\\n            localStorage.removeItem('random-training-progress');\\n            localStorage.removeItem('random-training-progress-backup');\\n          }\\n          \\n          // „Çπ„Éà„Ç¢Áä∂ÊÖã„ÇÇ„É™„Çª„ÉÉ„Éà\\n          const { resetProgress } = await import('$lib/stores/sessionStorage.ts');\\n          await resetProgress();\\n          \\n          console.log('üîÑ [SessionStorage] localStorage + „Çπ„Éà„Ç¢Áä∂ÊÖãÂÆåÂÖ®„É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü');\\n          \\n          // „ÉÄ„Ç§„É¨„ÇØ„Éà„Ç¢„ÇØ„Çª„ÇπÁä∂ÊÖã„Å´Âº∑Âà∂Ë®≠ÂÆöÔºà„Éû„Ç§„ÇØ„ÉÜ„Çπ„ÉàË™òÂ∞éÔºâ\\n          checkExistingMicrophonePermission();\\n          return; // „Éû„Ç§„ÇØ„ÉÜ„Çπ„ÉàË™òÂ∞é„ÅÆ„Åü„ÇÅÂá¶ÁêÜÁµÇ‰∫Ü\\n        }\\n      } else {\\n        console.log('üìä [SessionStorage] Êñ∞Ë¶è„Çª„ÉÉ„Ç∑„Éß„É≥ÈñãÂßã');\\n      }\\n    } catch (error) {\\n      console.error('üìä [SessionStorage] ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);\\n    }\\n    \\n    // Èü≥Ê∫êÂàùÊúüÂåñ\\n    initializeSampler();\\n    \\n    // Êé°ÁÇπ„Ç®„É≥„Ç∏„É≥ÂàùÊúüÂåñ\\n    initializeScoringEngine();\\n    \\n    // „Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„Åã„ÇâÊù•„ÅüÂ†¥Âêà„ÅØË®±ÂèØÊ∏à„Åø„Å®„Åó„Å¶Êâ±„ÅÜ\\n    if ($page.url.searchParams.get('from') === 'microphone-test') {\\n      console.log('üé§ [RandomTraining] „Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„Åã„Çâ„ÅÆÈÅ∑Áßª„ÇíÊ§úÂá∫');\\n      \\n      // URL„Éë„É©„É°„Éº„Çø„ÇíÂâäÈô§Ôºà„ÅäÊ∞ó„Å´ÂÖ•„ÇäÁôªÈå≤ÊôÇ„ÅÆÂïèÈ°åÂõûÈÅøÔºâ\\n      const url = new URL(window.location);\\n      url.searchParams.delete('from');\\n      window.history.replaceState({}, '', url);\\n      \\n      // „Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„Åã„ÇâÊù•„ÅüÂ†¥Âêà„ÅØË®±ÂèØÊ∏à„Åø„Å®„Åó„Å¶Êâ±„ÅÑ„ÄÅ„Çπ„Éà„É™„Éº„É†„ÇíÊ∫ñÂÇô\\n      microphoneState = 'granted';\\n      trainingPhase = 'setup';\\n      console.log('üé§ [RandomTraining] microphoneState=\\"granted\\", trainingPhase=\\"setup\\" „Å´Ë®≠ÂÆö');\\n      \\n      // AudioManager„É™„ÇΩ„Éº„Çπ„ÅÆÂç≥Â∫ßÂèñÂæóÔºàÂü∫Èü≥ÂÜçÁîü„ÅÆ„Åü„ÇÅÔºâ\\n      if (!mediaStream) {\\n        console.log('üé§ [RandomTraining] AudioManager„É™„ÇΩ„Éº„ÇπÂèñÂæóÈñãÂßã');\\n        try {\\n          const resources = await audioManager.initialize();\\n          audioContext = resources.audioContext;\\n          mediaStream = resources.mediaStream;\\n          sourceNode = resources.sourceNode;\\n          console.log('üé§ [RandomTraining] AudioManager„É™„ÇΩ„Éº„ÇπÂèñÂæóÂÆå‰∫Ü');\\n        } catch (error) {\\n          console.warn('‚ö†Ô∏è AudioManager„É™„ÇΩ„Éº„ÇπÂèñÂæóÂ§±ÊïóÔºàÂæå„ÅßÂÜçË©¶Ë°åÔºâ:', error);\\n        }\\n      }\\n      \\n      // PitchDetector„ÅÆÊòéÁ§∫ÁöÑÂàùÊúüÂåñÔºà„Éû„Ç§„ÇØ„ÉÜ„Çπ„ÉàÁµåÁî±ÊôÇÔºâ\\n      await new Promise(resolve => setTimeout(resolve, 500)); // 300ms ‚Üí 500ms„Å´Â¢óÂä†\\n      \\n      // „Çà„ÇäÂ†ÖÁâ¢„Å™ÂàùÊúüÂåñ„ÉÅ„Çß„ÉÉ„ÇØ\\n      if (pitchDetectorComponent) {\\n        try {\\n          console.log('üéôÔ∏è [ContinuousMode] PitchDetectorÂàùÊúüÂåñÈñãÂßã');\\n          \\n          // „Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„ÅÆÂ≠òÂú®„Å®„É°„ÇΩ„ÉÉ„Éâ„ÅÆÂà©Áî®ÂèØËÉΩÊÄß„ÇíÁ¢∫Ë™ç\\n          if (typeof pitchDetectorComponent.getIsInitialized === 'function') {\\n            const isInitialized = pitchDetectorComponent.getIsInitialized();\\n            console.log('üîç [ContinuousMode] PitchDetectorÂàùÊúüÂåñÁä∂ÊÖã:', isInitialized);\\n            \\n            if (!isInitialized) {\\n              // AudioManagerÁä∂ÊÖãÁ¢∫Ë™ç\\n              const status = audioManager.getStatus();\\n              console.log('üîç [ContinuousMode] AudioManagerÁä∂ÊÖã:', status);\\n              \\n              if (!status.isInitialized || !status.mediaStreamActive) {\\n                console.log('üîÑ [ContinuousMode] AudioManagerÂÜçÂàùÊúüÂåñÂÆüË°å');\\n                await audioManager.initialize();\\n              }\\n              \\n              await pitchDetectorComponent.initialize();\\n              console.log('‚úÖ [ContinuousMode] PitchDetectorÂàùÊúüÂåñÂÆå‰∫Ü');\\n            } else {\\n              console.log('‚úÖ [ContinuousMode] PitchDetector„ÅØÊó¢„Å´ÂàùÊúüÂåñÊ∏à„Åø');\\n            }\\n          } else {\\n            console.error('‚ùå [ContinuousMode] getIsInitialized„É°„ÇΩ„ÉÉ„Éâ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');\\n            // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: Áõ¥Êé•ÂàùÊúüÂåñ„ÇíË©¶„Åø„Çã\\n            await pitchDetectorComponent.initialize();\\n          }\\n        } catch (error) {\\n          console.error('‚ùå [ContinuousMode] PitchDetectorÂàùÊúüÂåñ„Ç®„É©„Éº:', error);\\n          // Âæ©ÊóßÂá¶ÁêÜ: Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„ÇâÂÜçË©¶Ë°å\\n          await new Promise(resolve => setTimeout(resolve, 1000));\\n          try {\\n            await pitchDetectorComponent.initialize();\\n            console.log('‚úÖ [ContinuousMode] PitchDetectorÂàùÊúüÂåñÂÜçË©¶Ë°åÊàêÂäü');\\n          } catch (retryError) {\\n            console.error('‚ùå [ContinuousMode] PitchDetectorÂàùÊúüÂåñÂÜçË©¶Ë°å„ÇÇÂ§±Êïó:', retryError);\\n          }\\n        }\\n      } else {\\n        console.warn('‚ö†Ô∏è [ContinuousMode] PitchDetector„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„ÅåÂ≠òÂú®„Åó„Åæ„Åõ„Çì');\\n      }\\n      \\n      // return„ÇíÂâäÈô§ - PitchDetector„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞„ÇíË®±ÂèØ\\n    } else {\\n      // „ÉÄ„Ç§„É¨„ÇØ„Éà„Ç¢„ÇØ„Çª„ÇπÊôÇ„ÅÆ„Åø„Éû„Ç§„ÇØË®±ÂèØÁä∂ÊÖãÁ¢∫Ë™ç\\n      await new Promise(resolve => setTimeout(resolve, 100));\\n      checkExistingMicrophonePermission();\\n    }\\n  });\\n  \\n  // PitchDetector„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„Åã„Çâ„ÅÆ„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Éº\\n  function handlePitchUpdate(event) {\\n    try {\\n      // event.detail „ÅÆÂ≠òÂú®Á¢∫Ë™ç\\n      if (!event || !event.detail) {\\n        console.warn('‚ö†Ô∏è [ContinuousMode] handlePitchUpdate: event.detail „Åå undefined');\\n        return;\\n      }\\n      \\n      const { frequency, note, volume, rawVolume, clarity } = event.detail;\\n      \\n      // ÂàùÊúüÂÄ§Ë®≠ÂÆöÔºàÁîü„ÅÆÂÄ§Ôºâ\\n      let displayFrequency = frequency;\\n      let displayNote = note;\\n      \\n      // Ë°®Á§∫„ÅØÂ∏∏„Å´Ë©ï‰æ°„Ç∑„Çπ„ÉÜ„É†„Å®Âêå„ÅòË£úÊ≠£„ÇíÈÅ©Áî®\\n      if (trainingPhase === 'guiding' && isGuideAnimationActive && currentBaseFrequency > 0 && frequency > 0) {\\n        const correctedResult = getEvaluationCorrectedFrequency(frequency);\\n        if (correctedResult) {\\n          displayFrequency = correctedResult.frequency;\\n          displayNote = correctedResult.note;\\n        }\\n      }\\n      \\n      currentFrequency = displayFrequency;\\n      detectedNote = displayNote;\\n      currentVolume = volume;\\n      \\n      // „Ç¨„Ç§„ÉÄ„É≥„ÇπÊ©üËÉΩÂâäÈô§Ê∏à„ÅøÔºàUIÁ∞°Á¥†ÂåñÔºâ\\n      \\n      // Âü∫Èü≥„Å®„ÅÆÁõ∏ÂØæÈü≥Á®ã„ÇíË®àÁÆóÔºàË£úÊ≠£Âæå„ÅÆÂÄ§„ÅßÔºâ\\n      if (currentBaseFrequency > 0 && displayFrequency > 0) {\\n        pitchDifference = Math.round(1200 * Math.log2(displayFrequency / currentBaseFrequency));\\n      } else {\\n        pitchDifference = 0;\\n      }\\n      \\n      // „Ç¨„Ç§„Éâ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰∏≠„ÅÆË©ï‰æ°ËìÑÁ©çÔºàÂÖÉ„ÅÆÂë®Ê≥¢Êï∞„ÅßÂÆüË°åÔºâ\\n      try {\\n        evaluateScaleStep(frequency, note);\\n      } catch (evalError) {\\n        console.error('‚ùå [ContinuousMode] evaluateScaleStep „Ç®„É©„Éº:', evalError);\\n      }\\n      \\n      // Êé°ÁÇπ„Ç®„É≥„Ç∏„É≥„Å∏„ÅÆ„Éá„Éº„ÇøÈÄÅ‰ø°\\n      try {\\n        if (scoringEngine && frequency > 0 && currentBaseFrequency > 0) {\\n          updateScoringEngine(frequency, note);\\n        }\\n      } catch (scoringError) {\\n        console.error('‚ùå [ContinuousMode] updateScoringEngine „Ç®„É©„Éº:', scoringError);\\n      }\\n    } catch (error) {\\n      console.error('‚ùå [ContinuousMode] handlePitchUpdate „Ç®„É©„Éº:', {\\n        error: error.message,\\n        stack: error.stack,\\n        eventDetail: event?.detail,\\n        trainingPhase,\\n        currentSessionId: $currentSessionId\\n      });\\n    }\\n  }\\n\\n  // Ë©ï‰æ°„Ç∑„Çπ„ÉÜ„É†„Å®Âêå„ÅòË£úÊ≠£„ÇíÂë®Ê≥¢Êï∞Ë°®Á§∫„Å´ÈÅ©Áî®„Åô„ÇãÈñ¢Êï∞\\n  function getEvaluationCorrectedFrequency(frequency) {\\n    if (!frequency || frequency <= 0 || !isGuideAnimationActive || !currentBaseFrequency) {\\n      return null;\\n    }\\n    \\n    // „ÄêÁµ±‰∏Ä„ÄëÈü≥Èáè„ÉÅ„Çß„ÉÉ„ÇØÔºàË©ï‰æ°„Ç∑„Çπ„ÉÜ„É†„Å®Âêå„ÅòÔºâ\\n    const minVolumeForDisplay = 25;\\n    if (currentVolume < minVolumeForDisplay) {\\n      return null; // „Éé„Ç§„Ç∫Èô§Â§ñ\\n    }\\n    \\n    // ÁèæÂú®„Éè„Ç§„É©„Ç§„Éà‰∏≠„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÇíÂèñÂæó\\n    const activeStepIndex = currentScaleIndex - 1;\\n    if (activeStepIndex < 0 || activeStepIndex >= scaleSteps.length) {\\n      return null;\\n    }\\n    \\n    // ÊúüÂæÖÂë®Ê≥¢Êï∞„ÇíË®àÁÆó\\n    const expectedFrequency = calculateExpectedFrequency(currentBaseFrequency, activeStepIndex);\\n    if (!expectedFrequency || expectedFrequency <= 0) {\\n      return null;\\n    }\\n    \\n    // Â§öÊÆµÈöé„Ç™„ÇØ„Çø„Éº„ÉñË£úÊ≠£„ÇíÈÅ©Áî®\\n    const correctionResult = multiStageOctaveCorrection(frequency, expectedFrequency);\\n    const adjustedFrequency = correctionResult.correctedFrequency;\\n    \\n    // Âë®Ê≥¢Êï∞„Åã„ÇâÈü≥Á®ãÂêç„Å´Â§âÊèõ\\n    const adjustedNote = frequencyToNote(adjustedFrequency);\\n    \\n    return {\\n      frequency: Math.round(adjustedFrequency),\\n      note: adjustedNote\\n    };\\n  }\\n\\n  // Âë®Ê≥¢Êï∞„Åã„ÇâÈü≥Á®ãÂêç„Å´Â§âÊèõÔºàPitchDetector„Å®Âêå„Åò„É≠„Ç∏„ÉÉ„ÇØÔºâ\\n  function frequencyToNote(frequency) {\\n    const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\\n    const A4 = 440;\\n    \\n    if (frequency <= 0) return '„Éº„Éº';\\n    \\n    const semitonesFromA4 = Math.round(12 * Math.log2(frequency / A4));\\n    const noteIndex = (semitonesFromA4 + 9 + 120) % 12;\\n    const octave = Math.floor((semitonesFromA4 + 9) / 12) + 4;\\n    \\n    return noteNames[noteIndex] + octave;\\n  }\\n  \\n  // „Äê„Éó„É≠„Éà„Çø„Ç§„ÉóÂºè„ÄëÂ§öÊÆµÈöé„Ç™„ÇØ„Çø„Éº„ÉñË£úÊ≠£Èñ¢Êï∞\\n  function multiStageOctaveCorrection(detectedFreq, targetFreq) {\\n    // Êã°ÂºµË£úÊ≠£ÂÄôË£ú„ÇíÁîüÊàêÔºà„Çà„ÇäÊüîËªü„Å™ÂÄçÈü≥Ë£úÊ≠£Ôºâ\\n    const candidates = [\\n      { factor: 4, freq: detectedFreq * 4, description: \\"2„Ç™„ÇØ„Çø„Éº„Éñ‰∏ä\\" },      // 2„Ç™„ÇØ„Çø„Éº„Éñ‰∏ä\\n      { factor: 3, freq: detectedFreq * 3, description: \\"1.5„Ç™„ÇØ„Çø„Éº„Éñ‰∏ä\\" },   // 1.5„Ç™„ÇØ„Çø„Éº„Éñ‰∏ä\\n      { factor: 2.5, freq: detectedFreq * 2.5, description: \\"1.3„Ç™„ÇØ„Çø„Éº„Éñ‰∏ä\\" }, // 1.3„Ç™„ÇØ„Çø„Éº„Éñ‰∏ä\\n      { factor: 2, freq: detectedFreq * 2, description: \\"1„Ç™„ÇØ„Çø„Éº„Éñ‰∏ä\\" },      // 1„Ç™„ÇØ„Çø„Éº„Éñ‰∏ä\\n      { factor: 1.5, freq: detectedFreq * 1.5, description: \\"0.5„Ç™„ÇØ„Çø„Éº„Éñ‰∏ä\\" }, // 0.5„Ç™„ÇØ„Çø„Éº„Éñ‰∏ä\\n      { factor: 1, freq: detectedFreq, description: \\"Ë£úÊ≠£„Å™„Åó\\" },              // Ë£úÊ≠£„Å™„Åó\\n      { factor: 0.75, freq: detectedFreq * 0.75, description: \\"0.33„Ç™„ÇØ„Çø„Éº„Éñ‰∏ã\\" }, // 0.33„Ç™„ÇØ„Çø„Éº„Éñ‰∏ã\\n      { factor: 0.67, freq: detectedFreq * 0.67, description: \\"0.5„Ç™„ÇØ„Çø„Éº„Éñ‰∏ã\\" }, // 0.5„Ç™„ÇØ„Çø„Éº„Éñ‰∏ã\\n      { factor: 0.5, freq: detectedFreq * 0.5, description: \\"1„Ç™„ÇØ„Çø„Éº„Éñ‰∏ã\\" },  // 1„Ç™„ÇØ„Çø„Éº„Éñ‰∏ã\\n      { factor: 0.4, freq: detectedFreq * 0.4, description: \\"1.3„Ç™„ÇØ„Çø„Éº„Éñ‰∏ã\\" }, // 1.3„Ç™„ÇØ„Çø„Éº„Éñ‰∏ã\\n      { factor: 0.33, freq: detectedFreq * 0.33, description: \\"1.5„Ç™„ÇØ„Çø„Éº„Éñ‰∏ã\\" }, // 1.5„Ç™„ÇØ„Çø„Éº„Éñ‰∏ã\\n      { factor: 0.25, freq: detectedFreq * 0.25, description: \\"2„Ç™„ÇØ„Çø„Éº„Éñ‰∏ã\\" }  // 2„Ç™„ÇØ„Çø„Éº„Éñ‰∏ã\\n    ];\\n    \\n    // 2ÊÆµÈöéË©ï‰æ°Ôºö„Åæ„ÅöÁ∑©„ÅÑÁØÑÂõ≤„ÄÅÊ¨°„Å´Âé≥„Åó„ÅÑÁØÑÂõ≤\\n    let bestCandidate = null;\\n    let minError = Infinity;\\n    \\n    // Step 1: ¬±50%„ÅÆÁØÑÂõ≤„ÅßÊúÄÈÅ©ÂÄôË£ú„ÇíÊé¢Á¥¢ÔºàÁ∑©ÂíåÁâàÔºâ\\n    const relaxedMin = targetFreq * 0.5;\\n    const relaxedMax = targetFreq * 1.5;\\n    \\n    const relaxedCandidates = candidates.filter(candidate => \\n      candidate.freq >= relaxedMin && candidate.freq <= relaxedMax\\n    );\\n    \\n    // Step 2: Á∑©„ÅÑÁØÑÂõ≤ÂÜÖ„ÅßÊúÄÂ∞èË™§Â∑Æ„ÇíË¶ã„Å§„Åë„Çã\\n    for (const candidate of relaxedCandidates) {\\n      const error = Math.abs(candidate.freq - targetFreq);\\n      if (error < minError) {\\n        minError = error;\\n        bestCandidate = candidate;\\n      }\\n    }\\n    \\n    // Step 3: Á∑©„ÅÑÁØÑÂõ≤„Åß„ÇÇÂÄôË£ú„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÂÖ®ÂÄôË£ú„Åã„ÇâÊúÄÈÅ©Ëß£„ÇíÈÅ∏Êäû\\n    if (!bestCandidate) {\\n      for (const candidate of candidates) {\\n        const error = Math.abs(candidate.freq - targetFreq);\\n        if (error < minError) {\\n          minError = error;\\n          bestCandidate = candidate;\\n        }\\n      }\\n    }\\n    \\n    // Step 4: „Åù„Çå„Åß„ÇÇË¶ã„Å§„Åã„Çâ„Å™„ÅÑÂ†¥Âêà„ÅØË£úÊ≠£„Å™„ÅóÔºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ\\n    if (!bestCandidate) {\\n      return {\\n        correctedFrequency: detectedFreq,\\n        factor: 1,\\n        description: \\"Ë£úÊ≠£„Å™„ÅóÔºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ\\",\\n        error: Math.abs(detectedFreq - targetFreq)\\n      };\\n    }\\n    \\n    return {\\n      correctedFrequency: bestCandidate.freq,\\n      factor: bestCandidate.factor,\\n      description: bestCandidate.description,\\n      error: minError\\n    };\\n  }\\n\\n  // Ë£è„Åß„ÅÆË©ï‰æ°ËìÑÁ©çÔºà„Ç¨„Ç§„Éâ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰∏≠Ôºâ- „Éó„É≠„Éà„Çø„Ç§„ÉóÂºèÂ§öÊÆµÈöéË£úÊ≠£Áâà\\n  function evaluateScaleStep(frequency, note) {\\n    if (!frequency || frequency <= 0 || !isGuideAnimationActive) {\\n      return;\\n    }\\n    \\n    // „ÄêÁ∑äÊÄ•‰øÆÊ≠£„ÄëÂü∫Èü≥Âë®Ê≥¢Êï∞„ÅÆÊúâÂäπÊÄß„ÉÅ„Çß„ÉÉ„ÇØ\\n    if (!currentBaseFrequency || currentBaseFrequency <= 0) {\\n      console.error(\`‚ùå [Êé°ÁÇπ„Ç®„É©„Éº] Âü∫Èü≥Âë®Ê≥¢Êï∞„ÅåÁÑ°Âäπ: \${currentBaseFrequency}Hz\`);\\n      console.error(\`‚ùå [Êé°ÁÇπ„Ç®„É©„Éº] Âü∫Èü≥Âêç: \${currentBaseNote}\`);\\n      console.error(\`‚ùå [Êé°ÁÇπ„Ç®„É©„Éº] activeStepIndex: \${currentScaleIndex - 1}\`);\\n      console.error(\`‚ùå [Êé°ÁÇπ„Ç®„É©„Éº] trainingPhase: \${trainingPhase}\`);\\n      console.error(\`‚ùå [Êé°ÁÇπ„Ç®„É©„Éº] isGuideAnimationActive: \${isGuideAnimationActive}\`);\\n      return;\\n    }\\n    \\n    // „ÄêÈü≥Èáè„ÉÅ„Çß„ÉÉ„ÇØ„ÄëÁí∞Â¢ÉÈü≥„ÇíÈô§Â§ñ\\n    const minVolumeForScoring = 25; // Êé°ÁÇπÁî®„ÅÆÊúÄ‰ΩéÈü≥Èáè„Åó„Åç„ÅÑÂÄ§Ôºà20‚Üí25„Å´Âºï„Åç‰∏ä„ÅíÔºâ\\n    if (currentVolume < minVolumeForScoring) {\\n      // Èü≥Èáè‰∏çË∂≥„ÅÆÂ†¥Âêà„ÅØÊé°ÁÇπ„Çí„Çπ„Ç≠„ÉÉ„ÉóÔºàÁí∞Â¢ÉÈü≥„ÅÆÂèØËÉΩÊÄßÔºâ\\n      return;\\n    }\\n    \\n    // ÁèæÂú®„Éè„Ç§„É©„Ç§„Éà‰∏≠„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÇíÂèñÂæóÔºàcurrentScaleIndex - 1„ÅåÂÆüÈöõ„Å´„Éè„Ç§„É©„Ç§„Éà‰∏≠Ôºâ\\n    const activeStepIndex = currentScaleIndex - 1;\\n    if (activeStepIndex < 0 || activeStepIndex >= scaleSteps.length) {\\n      return;\\n    }\\n    \\n    // „ÄêÁ∑äÊÄ•„Éá„Éê„ÉÉ„Ç∞„ÄëÈü≥Èöé„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„Å®Âü∫Èü≥Áä∂ÊÖãÁõ£Ë¶ñ\\n    if (activeStepIndex >= 4) { // „ÇΩ‰ª•Èôç„ÅßÂº∑Âåñ„É≠„Ç∞\\n      logger.debug(\`[Êé°ÁÇπ„Éá„Éê„ÉÉ„Ç∞] activeStepIndex=\${activeStepIndex} (\${scaleSteps[activeStepIndex].name}), currentBaseFrequency=\${currentBaseFrequency}Hz\`);\\n    }\\n    \\n    // „Äê‰øÆÊ≠£„Äë„Éó„É≠„Éà„Çø„Ç§„ÉóÂºè„ÅÆ„Ç∑„É≥„Éó„É´„ÅßÊ≠£Á¢∫„Å™Âë®Ê≥¢Êï∞Ë®àÁÆó„Çí‰ΩøÁî®\\n    const expectedFrequency = calculateExpectedFrequency(currentBaseFrequency, activeStepIndex);\\n    \\n    // „Äê„Éá„Éê„ÉÉ„Ç∞„ÄëÈü≥Á®ãË®àÁÆó„ÅÆË©≥Á¥∞„É≠„Ç∞Ôºà‰øÆÊ≠£ÁâàÔºâ\\n    if (activeStepIndex >= 0) { // ÂÖ®Èü≥Á®ã„Åß„É≠„Ç∞Âá∫Âäõ„Åó„Å¶‰øÆÊ≠£Á¢∫Ë™ç\\n      logger.debug(\`[Èü≥Á®ãË®àÁÆó‰øÆÊ≠£Áâà] \${scaleSteps[activeStepIndex].name}: ÊúüÂæÖÂë®Ê≥¢Êï∞ \${expectedFrequency.toFixed(1)}Hz\`);\\n    }\\n    \\n    // „ÄêÁ∑äÊÄ•‰øÆÊ≠£„ÄëÊúüÂæÖÂë®Ê≥¢Êï∞„ÅÆÊúâÂäπÊÄß„ÉÅ„Çß„ÉÉ„ÇØ\\n    if (!expectedFrequency || expectedFrequency <= 0 || !isFinite(expectedFrequency)) {\\n      console.error(\`‚ùå [Êé°ÁÇπ„Ç®„É©„Éº] ÊúüÂæÖÂë®Ê≥¢Êï∞Ë®àÁÆó„Ç®„É©„Éº:\`);\\n      console.error(\`   Âü∫Èü≥Âë®Ê≥¢Êï∞: \${currentBaseFrequency}Hz\`);\\n      console.error(\`   Èü≥Èöé„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ: \${activeStepIndex}\`);\\n      console.error(\`   ÊúüÂæÖÂë®Ê≥¢Êï∞: \${expectedFrequency}Hz\`);\\n      return;\\n    }\\n    \\n    // „Äê„Éó„É≠„Éà„Çø„Ç§„ÉóÂºè„ÄëÂ§öÊÆµÈöé„Ç™„ÇØ„Çø„Éº„ÉñË£úÊ≠£„ÇíÈÅ©Áî®\\n    const correctionResult = multiStageOctaveCorrection(frequency, expectedFrequency);\\n    const adjustedFrequency = correctionResult.correctedFrequency;\\n    const correctionFactor = correctionResult.factor;\\n    \\n    // Èü≥Á®ãÂ∑Æ„ÇíË®àÁÆóÔºà„Çª„É≥„ÉàÔºâ\\n    const centDifference = Math.round(1200 * Math.log2(adjustedFrequency / expectedFrequency));\\n    \\n    // „Äê„Éá„Éê„ÉÉ„Ç∞„Äë„Éó„É≠„Éà„Çø„Ç§„ÉóÂºèË£úÊ≠£ÁµêÊûú„ÅÆË©≥Á¥∞„É≠„Ç∞\\n    if (Math.abs(centDifference) > 200 || correctionFactor !== 1) {\\n      logger.debug(\`[„Éó„É≠„Éà„Çø„Ç§„ÉóÂºèË£úÊ≠£] \${scaleSteps[activeStepIndex].name}:\`);\\n      console.warn(\`   Ê§úÂá∫Âë®Ê≥¢Êï∞: \${frequency.toFixed(1)}Hz\`);\\n      console.warn(\`   Ë£úÊ≠£ÂæåÂë®Ê≥¢Êï∞: \${adjustedFrequency.toFixed(1)}Hz\`);\\n      console.warn(\`   ÊúüÂæÖÂë®Ê≥¢Êï∞: \${expectedFrequency.toFixed(1)}Hz\`);\\n      console.warn(\`   „Çª„É≥„ÉàÂ∑Æ: \${centDifference}¬¢\`);\\n      console.warn(\`   Ë£úÊ≠£‰øÇÊï∞: \${correctionFactor} (\${correctionResult.description})\`);\\n      console.warn(\`   Âü∫Èü≥: \${currentBaseNote} (\${currentBaseFrequency.toFixed(1)}Hz)\`);\\n    }\\n    \\n    // „ÄêÁ∑äÊÄ•‰øÆÊ≠£„Äë„Çª„É≥„ÉàË®àÁÆó„ÅÆÊúâÂäπÊÄß„ÉÅ„Çß„ÉÉ„ÇØ\\n    if (!isFinite(centDifference)) {\\n      console.error(\`‚ùå [Êé°ÁÇπ„Ç®„É©„Éº] „Çª„É≥„ÉàË®àÁÆó„Ç®„É©„Éº:\`);\\n      console.error(\`   Ê§úÂá∫Âë®Ê≥¢Êï∞: \${frequency}Hz\`);\\n      console.error(\`   ÊúüÂæÖÂë®Ê≥¢Êï∞: \${expectedFrequency}Hz\`);\\n      console.error(\`   „Çª„É≥„ÉàÂ∑Æ: \${centDifference}\`);\\n      return;\\n    }\\n    \\n    // Âà§ÂÆöÂü∫Ê∫ñÔºà¬±50„Çª„É≥„Éà‰ª•ÂÜÖ„ÅßÊ≠£Ëß£Ôºâ\\n    const tolerance = 50;\\n    const isCorrect = Math.abs(centDifference) <= tolerance;\\n    \\n    // ÊúÄ‰ΩéÈü≥ÈáèÂü∫Ê∫ñÔºà„Éé„Ç§„Ç∫Èô§Â§ñÔºâ\\n    const minVolumeForDetection = 15;\\n    const hasEnoughVolume = currentVolume >= minVolumeForDetection;\\n    \\n    if (hasEnoughVolume) {\\n      // Á≤æÂ∫¶Ë®àÁÆóÔºà100 - |centDifference|„ÅÆÂâ≤ÂêàÔºâ\\n      const accuracy = Math.max(0, Math.round(100 - Math.abs(centDifference)));\\n      \\n      // Ë©ï‰æ°„ÇíËìÑÁ©çÔºà‰∏äÊõ∏„Åç„Åó„Å¶ÊúÄÊñ∞„ÅÆË©ï‰æ°„Çí‰øùÊåÅÔºâ\\n      const existingIndex = scaleEvaluations.findIndex(evaluation => evaluation.stepIndex === activeStepIndex);\\n      const evaluation = {\\n        stepIndex: activeStepIndex,\\n        stepName: scaleSteps[activeStepIndex].name,\\n        expectedFrequency: Math.round(expectedFrequency),\\n        detectedFrequency: Math.round(frequency),\\n        adjustedFrequency: Math.round(adjustedFrequency),\\n        centDifference: centDifference,\\n        accuracy: accuracy,\\n        isCorrect: isCorrect,\\n        correctionFactor: correctionFactor,\\n        correctionDescription: correctionResult.description,\\n        timestamp: Date.now()\\n      };\\n      \\n      if (existingIndex >= 0) {\\n        scaleEvaluations[existingIndex] = evaluation;\\n      } else {\\n        scaleEvaluations.push(evaluation);\\n      }\\n      \\n      // Á∞°Á¥†Âåñ„Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞ÔºàÈáçË¶Å„Å™ÊÉÖÂ†±„ÅÆ„ÅøÔºâ\\n      if (scaleEvaluations.length % 4 === 0) { // 4„Çπ„ÉÜ„ÉÉ„Éó„Åî„Å®„Å´ÈÄ≤ÊçóË°®Á§∫\\n        logger.realtime(\`Êé°ÁÇπÈÄ≤Êçó: \${scaleEvaluations.length}/\${scaleSteps.length}„Çπ„ÉÜ„ÉÉ„ÉóÂÆå‰∫Ü\`);\\n      }\\n    }\\n  }\\n  \\n  \\n  // „Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÂá¶ÁêÜÔºàÈÄ£Á∂ö„É¢„Éº„ÉâÂØæÂøúÔºâ\\n  function completeSession() {\\n    trainingPhase = 'results';\\n    sessionResults.isCompleted = true;\\n    sessionResults.averageAccuracy = Math.round((sessionResults.correctCount / sessionResults.totalCount) * 100);\\n    \\n    // Èü≥Á®ãÊ§úÂá∫ÂÅúÊ≠¢\\n    if (pitchDetectorComponent) {\\n      pitchDetectorComponent.stopDetection();\\n    }\\n\\n    // ÈÄ£Á∂ö„É¢„Éº„Éâ„Åß„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÂá¶ÁêÜ\\n    handleSessionComplete();\\n  }\\n  \\n  // Âêå„ÅòÂü∫Èü≥„ÅßÂÜçÊåëÊà¶\\n  async function restartSameBaseNote() {\\n    // **8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÁä∂ÊÖã„ÉÅ„Çß„ÉÉ„ÇØÔºàÈáçË¶ÅÔºâ**\\n    if ($isCompleted) {\\n      console.warn('üö´ [RestartSame] 8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÁä∂ÊÖã„Åß„ÅØÂÜçÊåëÊà¶‰∏çÂèØ - Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßã„ÅåÂøÖË¶Å');\\n      \\n      // Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßã„ÇíÂÆüË°å\\n      const newCycleStarted = await startNewCycleIfCompleted();\\n      if (newCycleStarted) {\\n        console.log('‚úÖ [RestartSame] Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßãÂÆå‰∫Ü - „Çª„ÉÉ„Ç∑„Éß„É≥1/8„Åã„ÇâÂÜçÈñã');\\n        // „Éö„Éº„Ç∏„É™„É≠„Éº„Éâ„Åó„Å¶Êñ∞„Çµ„Ç§„ÇØ„É´Áä∂ÊÖã„ÇíÂèçÊò†\\n        window.location.reload();\\n      } else {\\n        console.error('‚ùå [RestartSame] Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßãÂ§±Êïó');\\n      }\\n      return;\\n    }\\n    \\n    // 1. „Éö„Éº„Ç∏„Éà„ÉÉ„Éó„Å´„Çπ„ÇØ„É≠„Éº„É´ÔºàÂº∑ÂåñÁâàÔºâ\\n    scrollToTop();\\n    \\n    // 2. UIÁä∂ÊÖã„ÅÆ„ÅøÂ§âÊõ¥ÔºàÂç≥Â∫ßÁîªÈù¢ÈÅ∑ÁßªÔºâ\\n    trainingPhase = 'setup';\\n    \\n    // 3. ÊúÄÂ∞èÈôê„ÅÆ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó\\n    if (guideAnimationTimer) {\\n      clearTimeout(guideAnimationTimer);\\n      guideAnimationTimer = null;\\n    }\\n    \\n    // 4. PitchDetector„ÅÆË°®Á§∫Áä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà\\n    if (pitchDetectorComponent && pitchDetectorComponent.resetDisplayState) {\\n      pitchDetectorComponent.resetDisplayState();\\n    }\\n    \\n    // 5. „Çª„ÉÉ„Ç∑„Éß„É≥Áä∂ÊÖã„É™„Çª„ÉÉ„ÉàÔºàÂü∫Èü≥„ÅØ‰øùÊåÅÔºâ\\n    resetSessionState();\\n    // Ê≥®ÊÑè: currentBaseNote „Å® currentBaseFrequency „ÅØ‰øùÊåÅ„Åï„Çå„Çã\\n    \\n    // 6. Âü∫Èü≥ÊÉÖÂ†±‰øùÊåÅÔºàÂÜçÁîü„ÅØ„É¶„Éº„Ç∂„ÉºÊìç‰Ωú„Åæ„ÅßÂæÖÊ©üÔºâ\\n    console.log('üîÑ [RestartSame] Âêå„ÅòÂü∫Èü≥„ÅßÂÜçÊåëÊà¶:', currentBaseNote, currentBaseFrequency + 'Hz');\\n    console.log('üîÑ [RestartSame] Âü∫Èü≥ÊÉÖÂ†±‰øùÊåÅÂÆå‰∫Ü - „É¶„Éº„Ç∂„ÉºÊìç‰ΩúÂæÖÊ©ü');\\n    // Ê≥®ÊÑè: Âü∫Èü≥„ÅØËá™ÂãïÂÜçÁîü„Åõ„Åö„ÄÅ„É¶„Éº„Ç∂„Éº„Åå„ÄåÂü∫Èü≥„ÇíËÅû„Åè„Äç„Éú„Çø„É≥„ÇíÊäº„Åô„Åæ„ÅßÂæÖÊ©ü\\n  }\\n  \\n  // ÈÅï„ÅÜÂü∫Èü≥„ÅßÈñãÂßã\\n  async function restartDifferentBaseNote() {\\n    // **8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÁä∂ÊÖã„ÉÅ„Çß„ÉÉ„ÇØÔºàÈáçË¶ÅÔºâ**\\n    if ($isCompleted) {\\n      console.warn('üö´ [RestartDifferent] 8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÁä∂ÊÖã„Åß„ÅØÂÜçÊåëÊà¶‰∏çÂèØ - Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßã„ÅåÂøÖË¶Å');\\n      \\n      // Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßã„ÇíÂÆüË°å\\n      const newCycleStarted = await startNewCycleIfCompleted();\\n      if (newCycleStarted) {\\n        console.log('‚úÖ [RestartDifferent] Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßãÂÆå‰∫Ü - „Çª„ÉÉ„Ç∑„Éß„É≥1/8„Åã„ÇâÂÜçÈñã');\\n        // „Éö„Éº„Ç∏„É™„É≠„Éº„Éâ„Åó„Å¶Êñ∞„Çµ„Ç§„ÇØ„É´Áä∂ÊÖã„ÇíÂèçÊò†\\n        window.location.reload();\\n      } else {\\n        console.error('‚ùå [RestartDifferent] Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßãÂ§±Êïó');\\n      }\\n      return;\\n    }\\n    \\n    // 1. „Éö„Éº„Ç∏„Éà„ÉÉ„Éó„Å´„Çπ„ÇØ„É≠„Éº„É´ÔºàÂº∑ÂåñÁâàÔºâ\\n    scrollToTop();\\n    \\n    // 2. UIÁä∂ÊÖã„ÅÆ„ÅøÂ§âÊõ¥ÔºàÂç≥Â∫ßÁîªÈù¢ÈÅ∑ÁßªÔºâ\\n    trainingPhase = 'setup';\\n    \\n    // 3. ÊúÄÂ∞èÈôê„ÅÆ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó\\n    if (guideAnimationTimer) {\\n      clearTimeout(guideAnimationTimer);\\n      guideAnimationTimer = null;\\n    }\\n    \\n    // 4. Âü∫Èü≥ÊÉÖÂ†±„ÇÇ„É™„Çª„ÉÉ„Éà\\n    currentBaseNote = '';\\n    currentBaseFrequency = 0;\\n    \\n    // „ÄêÁ∑äÊÄ•„Éá„Éê„ÉÉ„Ç∞„ÄëÂü∫Èü≥„É™„Çª„ÉÉ„Éà„É≠„Ç∞\\n    console.log('üîÑ [restartDifferentBaseNote] Âü∫Èü≥ÊÉÖÂ†±„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü');\\n    \\n    // 5. PitchDetector„ÅÆË°®Á§∫Áä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà\\n    if (pitchDetectorComponent && pitchDetectorComponent.resetDisplayState) {\\n      pitchDetectorComponent.resetDisplayState();\\n    }\\n    \\n    // 6. „Çª„ÉÉ„Ç∑„Éß„É≥Áä∂ÊÖã„É™„Çª„ÉÉ„Éà\\n    resetSessionState();\\n  }\\n  \\n  // Âº∑ÂåñÁâà„Çπ„ÇØ„É≠„Éº„É´Èñ¢Êï∞Ôºà„Éñ„É©„Ç¶„Ç∂‰∫íÊèõÊÄßÂØæÂøúÔºâ\\n  function scrollToTop() {\\n    try {\\n      // ÊñπÊ≥ï 1: „É¢„ÉÄ„É≥„Éñ„É©„Ç¶„Ç∂„ÅÆ„Çπ„É†„Éº„Çπ„Çπ„ÇØ„É≠„Éº„É´\\n      if ('scrollTo' in window && 'behavior' in document.documentElement.style) {\\n        window.scrollTo({ top: 0, behavior: 'smooth' });\\n      } else {\\n        // ÊñπÊ≥ï 2: Âè§„ÅÑ„Éñ„É©„Ç¶„Ç∂„ÅÆÂç≥Â∫ß„Çπ„ÇØ„É≠„Éº„É´\\n        window.scrollTo(0, 0);\\n      }\\n      \\n      // ÊñπÊ≥ï 3: document.body „Å® documentElement „ÅÆ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ\\n      if (document.body) {\\n        document.body.scrollTop = 0;\\n      }\\n      if (document.documentElement) {\\n        document.documentElement.scrollTop = 0;\\n      }\\n      \\n      // ÊñπÊ≥ï 4: „Éö„Éº„Ç∏ÂÜÖ„ÅÆ„Çπ„ÇØ„É≠„Éº„É´„Ç≥„É≥„ÉÜ„ÉäÂØæÂøú\\n      const scrollContainers = document.querySelectorAll('[data-scroll-container], .scroll-container, main');\\n      scrollContainers.forEach(container => {\\n        if (container.scrollTo) {\\n          container.scrollTo(0, 0);\\n        } else {\\n          container.scrollTop = 0;\\n        }\\n      });\\n      \\n    } catch (error) {\\n      console.warn('„Çπ„ÇØ„É≠„Éº„É´„Ç®„É©„Éº:', error);\\n      // ÊúÄÂæå„ÅÆÊâãÊÆµ: Âº∑Âà∂ÁöÑ„Å™„É™„É≠„Éº„Éâ„ÇíÈÅø„Åë„Å¶Âü∫Êú¨ÁöÑ„Å™„Çπ„ÇØ„É≠„Éº„É´\\n      try {\\n        window.scroll(0, 0);\\n      } catch (fallbackError) {\\n        console.error('„Çπ„ÇØ„É≠„Éº„É´ÂÆåÂÖ®Â§±Êïó:', fallbackError);\\n      }\\n    }\\n  }\\n\\n  // „Çª„ÉÉ„Ç∑„Éß„É≥Áä∂ÊÖã„É™„Çª„ÉÉ„Éà\\n  function resetSessionState() {\\n    currentScaleIndex = 0;\\n    isGuideAnimationActive = false;\\n    scaleEvaluations = []; // ÁèæÂú®„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥Ë©ï‰æ°„ÅØ„ÇØ„É™„Ç¢\\n    // previousEvaluations „ÅØ‰øùÊåÅÔºàÂâçÂõû„ÅÆÁµêÊûú„ÇíÊÆã„ÅôÔºâ\\n    \\n    // „Çπ„Ç±„Éº„É´„Ç¨„Ç§„Éâ„É™„Çª„ÉÉ„Éà\\n    scaleSteps = scaleSteps.map(step => ({\\n      ...step,\\n      state: 'inactive',\\n      completed: false\\n    }));\\n    \\n  }\\n  \\n  // Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßãÔºà8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÂæå„ÅÆ„ÄåÊúÄÂàù„Åã„ÇâÊåëÊà¶„Äç„Éú„Çø„É≥Áî®Ôºâ\\n  async function startNewCycle() {\\n    console.log('üöÄ [StartNewCycle] 8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÂæå„ÅÆÊúÄÂàù„Åã„ÇâÊåëÊà¶ÈñãÂßã');\\n    \\n    try {\\n      // Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßãÂá¶ÁêÜ\\n      const newCycleStarted = await startNewCycleIfCompleted();\\n      \\n      if (newCycleStarted) {\\n        console.log('‚úÖ [StartNewCycle] Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßãÂÆå‰∫Ü');\\n        \\n        // „Éû„Ç§„ÇØ„ÉÜ„Çπ„ÉàÂÆå‰∫Ü„Éï„É©„Ç∞„ÅåÂ≠òÂú®„Åô„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç\\n        const micTestCompleted = localStorage.getItem('mic-test-completed');\\n        if (micTestCompleted) {\\n          console.log('‚úÖ [StartNewCycle] „Éû„Ç§„ÇØ„ÉÜ„Çπ„ÉàÂÆå‰∫Ü„Éï„É©„Ç∞Á¢∫Ë™ç - „É™„É≠„Éº„Éâ„Å™„Åó„ÅßÁä∂ÊÖã„É™„Çª„ÉÉ„Éà');\\n          \\n          // „É™„É≠„Éº„Éâ„Åõ„Åö„Å´Áä∂ÊÖã„Çí„É™„Çª„ÉÉ„ÉàÔºà„Éû„Ç§„ÇØ„ÉÜ„Çπ„ÉàÁµåÁî±„Å®Âêå„ÅòÁä∂ÊÖã„Å´Ôºâ\\n          // 1. „Éö„Éº„Ç∏„Éà„ÉÉ„Éó„Å´„Çπ„ÇØ„É≠„Éº„É´\\n          scrollToTop();\\n          \\n          // 2. sessionStorage„Çπ„Éà„Ç¢„ÇíÊõ¥Êñ∞Ôºà„É™„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´ÂèçÊò†Ôºâ\\n          await loadProgress(); // Êñ∞„Åó„ÅÑ„Çª„ÉÉ„Ç∑„Éß„É≥Áä∂ÊÖã„ÇíË™≠„ÅøËæº„Åø\\n          \\n          // 3. UIÁä∂ÊÖã„Çísetup„Å´Êàª„Åô\\n          trainingPhase = 'setup';\\n          \\n          // 4. „Çª„ÉÉ„Ç∑„Éß„É≥Áä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà\\n          resetSessionState();\\n          \\n          // 5. Êñ∞„Åó„ÅÑÂü∫Èü≥„ÇíÈÅ∏Êäû\\n          selectRandomBaseNote();\\n          \\n          console.log('‚úÖ [StartNewCycle] Áä∂ÊÖã„É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü - „Çª„ÉÉ„Ç∑„Éß„É≥1/8„Åã„ÇâÂÜçÈñã');\\n        } else {\\n          // „Éï„É©„Ç∞„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÈÄöÂ∏∏„ÅÆ„É™„É≠„Éº„ÉâÔºà„ÉÄ„Ç§„É¨„ÇØ„Éà„Ç¢„ÇØ„Çª„ÇπÊâ±„ÅÑÔºâ\\n          window.location.reload();\\n        }\\n      } else {\\n        console.error('‚ùå [StartNewCycle] Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßãÂ§±Êïó');\\n        // Â§±ÊïóÊôÇ„ÅØ„Éõ„Éº„É†„Å´Êàª„Çã\\n        goHome();\\n      }\\n    } catch (error) {\\n      console.error('‚ùå [StartNewCycle] Êñ∞„Çµ„Ç§„ÇØ„É´ÈñãÂßã„Ç®„É©„Éº:', error);\\n      // „Ç®„É©„ÉºÊôÇ„ÇÇ„Éõ„Éº„É†„Å´Êàª„Çã\\n      goHome();\\n    }\\n  }\\n\\n  // ActionButtonsÁµ±‰∏Ä„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©\\n  function handleActionButtonClick(event) {\\n    const { type } = event.detail;\\n    \\n    switch (type) {\\n      case 'same':\\n        restartSameBaseNote();\\n        break;\\n      case 'different':\\n        restartDifferentBaseNote();\\n        break;\\n      case 'restart':\\n        startNewCycle();\\n        break;\\n      case 'home':\\n        goHome();\\n        break;\\n      default:\\n        console.warn('üö´ [ActionButtons] Êú™Áü•„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥„Çø„Ç§„Éó:', type);\\n    }\\n  }\\n\\n  \\n  // „É™„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Ç∑„Çπ„ÉÜ„É†\\n  $: canStartTraining = microphoneState === 'granted' && !isSamplerLoading && sampler && microphoneHealthy;\\n  $: canRestartSession = trainingPhase === 'results';\\n\\n  // 8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÊôÇÔºölocalStorage„Éá„Éº„Çø„Åã„ÇâÈü≥Á®ãÂà•„Éá„Éº„Çø„ÇíÁîüÊàê\\n  $: if ($unifiedScoreData && $isCompleted && $unifiedScoreData.sessionHistory) {\\n    intervalData = generateIntervalDataFromSessionHistory($unifiedScoreData.sessionHistory);\\n    console.log('üéµ [RandomTraining] intervalDataÁîüÊàêÂÆå‰∫Ü:', intervalData.length, '‰ª∂');\\n  }\\n  \\n  // Áä∂ÊÖãÂ§âÂåñÊôÇ„ÅÆËá™Âãï„Çπ„ÇØ„É≠„Éº„É´Ôºà„ÉÄ„Ç§„É¨„ÇØ„Éà„Ç¢„ÇØ„Çª„Çπ„ÄÅ„Éû„Ç§„ÇØË®±ÂèØÂæå„ÅÆÁîªÈù¢ÈÅ∑ÁßªÊôÇÔºâ\\n  $: if (trainingPhase === 'setup' && microphoneState === 'granted') {\\n    scrollToTop();\\n  }\\n\\n  // ÈÄ£Á∂ö„ÉÅ„É£„É¨„É≥„Ç∏„É¢„Éº„ÉâÔºö8„Çª„ÉÉ„Ç∑„Éß„É≥ÈÄ£Á∂öÂÆüË°åÂà∂Âæ°\\n  function startContinuousMode() {\\n    console.log('‚ö° [ContinuousMode] 8„Çª„ÉÉ„Ç∑„Éß„É≥ÈÄ£Á∂öÈñãÂßã');\\n    \\n    // ÊúÄÂàù„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÇíÈñãÂßã\\n    playBaseNote();\\n  }\\n\\n  // „Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÊôÇ„ÅÆËá™ÂãïÊ¨°„Çª„ÉÉ„Ç∑„Éß„É≥ÈñãÂßã\\n  function handleSessionComplete() {\\n    console.log('‚úÖ [ContinuousMode] „Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫Ü:', $currentSessionId);\\n    \\n    // 8„Çª„ÉÉ„Ç∑„Éß„É≥Êú™Ê∫Ä„ÅÆÂ†¥Âêà„ÅØÊ¨°„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÇíËá™ÂãïÈñãÂßã\\n    if ($currentSessionId < 8) {\\n      // „Çª„ÉÉ„Ç∑„Éß„É≥ÁµêÊûú„Çí5ÁßíÈñìË°®Á§∫„Åó„Å¶„Åã„ÇâÊ¨°„Çª„ÉÉ„Ç∑„Éß„É≥ÈñãÂßã\\n      setTimeout(() => {\\n        console.log('üîÑ [ContinuousMode] Ê¨°„Çª„ÉÉ„Ç∑„Éß„É≥Ëá™ÂãïÈñãÂßãÊ∫ñÂÇô:', $currentSessionId + 1);\\n        \\n        // Ê¨°„Çª„ÉÉ„Ç∑„Éß„É≥Áî®„ÅÆÁä∂ÊÖã„É™„Çª„ÉÉ„Éà\\n        trainingPhase = 'setup';\\n        sessionResults = {\\n          isCompleted: false,\\n          correctCount: 0,\\n          totalCount: 0,\\n          averageAccuracy: 0\\n        };\\n        \\n        // UIÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà\\n        isPlaying = false;\\n        \\n        // Èü≥Á®ãÊ§úÂá∫„ÇíÂÜçÈñãÔºàÈÄ£Á∂ö„É¢„Éº„ÉâÁî®„ÉªgetState()‰ΩøÁî®Ôºâ\\n        if (pitchDetectorComponent) {\\n          try {\\n            // getState()„É°„ÇΩ„ÉÉ„Éâ„ÅßÊ≠£Á¢∫„Å™Áä∂ÊÖã„ÇíÂèñÂæó\\n            if (pitchDetectorComponent.getState) {\\n              const state = pitchDetectorComponent.getState();\\n              console.log('üîç [ContinuousMode] PitchDetectorÁä∂ÊÖã:', state);\\n              \\n              if (state.isInitialized && state.componentState === 'ready') {\\n                console.log('üé§ [ContinuousMode] Èü≥Á®ãÊ§úÂá∫ÂÜçÈñã');\\n                pitchDetectorComponent.startDetection();\\n              } else if (state.componentState === 'detecting') {\\n                console.log('üîÑ [ContinuousMode] Èü≥Á®ãÊ§úÂá∫„ÅØÊó¢„Å´„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã - „Çπ„Ç≠„ÉÉ„Éó');\\n              } else {\\n                console.log('‚ö†Ô∏è [ContinuousMode] PitchDetectorÁä∂ÊÖã‰∏çÊ≠£ - Èü≥Á®ãÊ§úÂá∫ÂÜçÈñã„Çí„Çπ„Ç≠„ÉÉ„Éó:', state.componentState);\\n              }\\n            } else {\\n              console.log('‚ö†Ô∏è [ContinuousMode] getState()„É°„ÇΩ„ÉÉ„ÉâÊú™ÂØæÂøú - „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÂá¶ÁêÜ');\\n              // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: ÂæìÊù•„ÅÆÊñπÊ≥ï\\n              if (pitchDetectorComponent.getIsInitialized && pitchDetectorComponent.getIsInitialized()) {\\n                pitchDetectorComponent.startDetection();\\n              }\\n            }\\n          } catch (detectionError) {\\n            console.warn('‚ö†Ô∏è [ContinuousMode] Èü≥Á®ãÊ§úÂá∫ÂÜçÈñãÂ§±Êïó:', detectionError.message);\\n          }\\n        }\\n        \\n        console.log('üéµ [ContinuousMode] Ê¨°„ÅÆÂü∫Èü≥Ëá™ÂãïÂÜçÁîüÈñãÂßã');\\n        playBaseNote();\\n      }, 5000); // 5ÁßíÂæå„Å´Ê¨°„Çª„ÉÉ„Ç∑„Éß„É≥ÈñãÂßãÔºàÁµêÊûúË°®Á§∫ÊôÇÈñì„ÇíÁ¢∫‰øùÔºâ\\n    } else {\\n      console.log('üéâ [ContinuousMode] 8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÔºÅ');\\n      // Á∑èÂêàË©ï‰æ°ÁîªÈù¢„ÇíË°®Á§∫ÔºàtrainingPhase „ÅØ 'results' „ÅÆ„Åæ„ÅæÁ∂≠ÊåÅÔºâ\\n      // $isCompleted „Åå true „Å´„Å™„Çã„Åì„Å®„Åß UnifiedScoreResultFixed „Å´Á∑èÂêà„Éá„Éº„Çø„ÅåË°®Á§∫„Åï„Çå„Çã\\n      setTimeout(() => {\\n        console.log('üèÜ [ContinuousMode] Á∑èÂêàË©ï‰æ°ÁîªÈù¢Ë°®Á§∫ÂÆå‰∫Ü');\\n      }, 1000);\\n    }\\n  }\\n\\n\\n  // PitchDetector„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„ÉºÔºàÁ∞°Á¥†ÁâàÔºâ\\n  function handlePitchDetectorStateChange(event) {\\n    // „É≠„Ç∞ÂâäÈô§\\n  }\\n  \\n  function handlePitchDetectorError(event) {\\n    const { error, context, reason, recovery } = event.detail;\\n    \\n    // ÂàùÊúüÂåñÈñ¢ÈÄ£„ÅÆ„Ç®„É©„Éº„ÅØË©≥Á¥∞„É≠„Ç∞„ÇíÂá∫Âäõ\\n    if (context === 'initialization' || (error?.message && error.message.includes('getIsInitialized'))) {\\n      console.error('‚ùå [ContinuousMode] PitchDetectorÂàùÊúüÂåñ„Ç®„É©„ÉºË©≥Á¥∞:', {\\n        error: error?.message || error,\\n        stack: error?.stack,\\n        context,\\n        componentExists: !!pitchDetectorComponent,\\n        hasGetIsInitialized: typeof pitchDetectorComponent?.getIsInitialized === 'function',\\n        trainingPhase,\\n        currentSessionId: $currentSessionId\\n      });\\n      return;\\n    }\\n    \\n    console.error('‚ùå [ContinuousMode] PitchDetector„Ç®„É©„ÉºË©≥Á¥∞:', {\\n      error: error?.message || error,\\n      stack: error?.stack,\\n      context,\\n      reason,\\n      recovery,\\n      trainingPhase,\\n      currentSessionId: $currentSessionId\\n    });\\n    \\n    // ÈáçÂ§ß„Å™„Ç®„É©„Éº„ÅÆÂ†¥Âêà„ÅØËá™ÂãïÂæ©Êóß„ÇíË©¶Ë°å\\n    if (reason === 'mediastream_ended' && recovery === 'restart_required') {\\n      console.log('‚ö° [ContinuousMode] MediaStreamÁµÇ‰∫ÜÊ§úÂá∫ - Ëá™ÂãïÂæ©Êóß„ÇíË©¶Ë°å');\\n      setTimeout(async () => {\\n        try {\\n          await checkMicrophonePermission(); // „Éû„Ç§„ÇØÂÜçÂàùÊúüÂåñ\\n        } catch (recoveryError) {\\n          console.error('‚ùå [ContinuousMode] Ëá™ÂãïÂæ©ÊóßÂ§±Êïó:', recoveryError);\\n        }\\n      }, 1000);\\n    }\\n    \\n    // ÈáçË§áÊ§úÂá∫ÈñãÂßã„Ç®„É©„Éº„ÅÆÂ†¥Âêà„ÅØË≠¶Âëä„ÅÆ„ÅøÔºàÂæ©Êóß‰∏çË¶ÅÔºâ\\n    if (context === 'start-detection' && error?.message?.includes('component state is detecting')) {\\n      console.log('üîÑ [ContinuousMode] Èü≥Á®ãÊ§úÂá∫„ÅØÊó¢„Å´„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„Åß„ÅôÔºàÊ≠£Â∏∏Ôºâ');\\n      return; // Âæ©ÊóßÂá¶ÁêÜ‰∏çË¶Å\\n    }\\n  }\\n  \\n  // „Éû„Ç§„ÇØÂÅ•Â∫∑Áä∂ÊÖãÂ§âÂåñ„Éè„É≥„Éâ„É©„Éº\\n  function handleMicrophoneHealthChange(event) {\\n    const { healthy, errors, details } = event.detail;\\n    microphoneHealthy = healthy;\\n    microphoneErrors = errors;\\n    \\n    if (!healthy) {\\n      console.warn('‚ö†Ô∏è „Éû„Ç§„ÇØ„ÅÆÂÅ•Â∫∑Áä∂ÊÖã„ÅåÊÇ™Âåñ:', errors);\\n      // Ê∑±Âàª„Å™ÂïèÈ°å„ÅÆÂ†¥Âêà„ÅØ„Éà„É¨„Éº„Éã„É≥„Ç∞„ÇíÂÅúÊ≠¢\\n      if (trainingPhase === 'guiding') {\\n        trainingPhase = 'setup';\\n        console.warn('üõë „Éû„Ç§„ÇØÂïèÈ°å„Å´„Çà„Çä„Éà„É¨„Éº„Éã„É≥„Ç∞„ÇíÂÅúÊ≠¢');\\n      }\\n    }\\n  }\\n\\n  // „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó\\n  onDestroy(() => {\\n    console.log('üîÑ [RandomTraining] onDestroy - AudioManager„É™„ÇΩ„Éº„Çπ„ÅØ‰øùÊåÅ');\\n    \\n    // PitchDetector„ÅØ‰Ωø„ÅÑÂõû„Åó„ÅÆ„Åü„ÇÅcleanup„Åó„Å™„ÅÑ\\n    // AudioManager„Åå„É™„ÇΩ„Éº„Çπ„ÇíÁÆ°ÁêÜ„Åô„Çã„Åü„ÇÅ„ÄÅ„Åì„Åì„Åß„ÅØËß£Êîæ„Åó„Å™„ÅÑ\\n    \\n    if (sampler) {\\n      sampler.dispose();\\n      sampler = null;\\n    }\\n  });\\n<\/script>\\n\\n<svelte:head>\\n  <title>ÈÄ£Á∂ö„ÉÅ„É£„É¨„É≥„Ç∏„É¢„Éº„Éâ - Áõ∏ÂØæÈü≥ÊÑü„Éà„É¨„Éº„Éã„É≥„Ç∞</title>\\n</svelte:head>\\n\\n<PageLayout>\\n  <!-- Header -->\\n  <div class=\\"header-section\\">\\n    <h1 class=\\"page-title\\">‚ö° ÈÄ£Á∂ö„ÉÅ„É£„É¨„É≥„Ç∏„É¢„Éº„Éâ</h1>\\n    <p class=\\"page-description\\">‰∏≠Á¥öËÄÖÂêë„ÅëÔºö8„Çª„ÉÉ„Ç∑„Éß„É≥ÈÄ£Á∂ö„ÅßÂü∫Èü≥„ÅåËá™ÂãïÂÜçÁîü„Åï„Çå„ÇãÈõÜ‰∏≠„Éà„É¨„Éº„Éã„É≥„Ç∞</p>\\n    \\n    \\n    <!-- „Çª„ÉÉ„Ç∑„Éß„É≥ÈÄ≤ÊçóË°®Á§∫ -->\\n    {#if microphoneState === 'granted' && !$isLoading}\\n      <div class=\\"session-progress\\">\\n        <div class=\\"session-status\\">\\n          <div class=\\"session-info\\">\\n            <span class=\\"completed-count\\">„Çª„ÉÉ„Ç∑„Éß„É≥ {$currentSessionId}/8</span>\\n            <span class=\\"remaining-text\\">ÂÆå‰∫ÜÊ∏à„Åø {$sessionHistory?.length || 0}„Çª„ÉÉ„Ç∑„Éß„É≥</span>\\n          </div>\\n          <div class=\\"progress-section\\">\\n            <div class=\\"progress-bar\\">\\n              <div class=\\"progress-fill\\" style=\\"width: {(($sessionHistory?.length || 0) / 8 * 100)}%\\"></div>\\n            </div>\\n            <span class=\\"progress-text\\">{Math.round(($sessionHistory?.length || 0) / 8 * 100)}%</span>\\n          </div>\\n        </div>\\n        \\n      </div>\\n      \\n      <!-- ‰∏äÈÉ®„Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥Ôºà8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÊôÇ„ÅÆ„ÅøË°®Á§∫Ôºâ -->\\n      {#if trainingPhase === 'results' && $isCompleted}\\n        <div class=\\"top-action-buttons\\">\\n          <ActionButtons \\n            isCompleted={$isCompleted}\\n            position=\\"top\\"\\n            on:action={handleActionButtonClick}\\n          />\\n        </div>\\n      {/if}\\n    {/if}\\n    \\n    <div class=\\"debug-info\\">\\n      üì± {buildVersion} | {buildTimestamp}<br/>\\n      <small style=\\"font-size: 0.6rem;\\">{updateStatus}</small>\\n    </div>\\n  </div>\\n\\n\\n  {#if microphoneState === 'granted'}\\n    <!-- PitchDetector: Â∏∏„Å´Â≠òÂú®Ôºà„Çª„ÉÉ„Ç∑„Éß„É≥Èñì„ÅßÁ†¥Ê£Ñ„Åï„Çå„Å™„ÅÑÔºâ -->\\n    <div style=\\"display: none;\\">\\n      <PitchDetector\\n        bind:this={pitchDetectorComponent}\\n        isActive={microphoneState === 'granted'}\\n        trainingPhase={trainingPhase}\\n        on:pitchUpdate={handlePitchUpdate}\\n        on:stateChange={handlePitchDetectorStateChange}\\n        on:error={handlePitchDetectorError}\\n        on:microphoneHealthChange={handleMicrophoneHealthChange}\\n        className=\\"pitch-detector-content\\"\\n        debugMode={true}\\n        disableHarmonicCorrection={false}\\n      />\\n    </div>\\n\\n    <!-- „É°„Ç§„É≥„Éà„É¨„Éº„Éã„É≥„Ç∞„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ -->\\n    \\n    {#if trainingPhase !== 'results'}\\n      <!-- Base Tone and Detection Side by Side -->\\n      <!-- „Éû„Ç§„ÇØÂÅ•Â∫∑Áä∂ÊÖãË≠¶ÂëäÔºàÂïèÈ°å„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫Ôºâ -->\\n      {#if !microphoneHealthy && microphoneErrors.length > 0}\\n        <Card class=\\"warning-card\\">\\n          <div class=\\"card-header\\">\\n            <h3 class=\\"section-title\\">‚ö†Ô∏è „Éû„Ç§„ÇØÊé•Á∂ö„Å´ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åô</h3>\\n          </div>\\n          <div class=\\"card-content\\">\\n            <p class=\\"warning-message\\">„Éû„Ç§„ÇØ„ÅåÊ≠£Â∏∏„Å´Âãï‰Ωú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ‰ª•‰∏ã„ÅÆÂïèÈ°å„ÅåÊ§úÂá∫„Åï„Çå„Åæ„Åó„ÅüÔºö</p>\\n            <ul class=\\"error-list\\">\\n              {#each microphoneErrors as error}\\n                <li>{error}</li>\\n              {/each}\\n            </ul>\\n            <p class=\\"fix-instruction\\">\\n              <strong>Ëß£Ê±∫ÊñπÊ≥ï:</strong> „Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Éû„Ç§„ÇØË®±ÂèØ„ÇíÂÜçÂ∫¶ÂèñÂæó„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\\n            </p>\\n          </div>\\n        </Card>\\n      {/if}\\n\\n      <div class=\\"side-by-side-container\\">\\n        <!-- Base Tone Section -->\\n        <Card class=\\"main-card half-width\\">\\n          <div class=\\"card-header\\">\\n            <h3 class=\\"section-title\\">üéπ Âü∫Èü≥ÂÜçÁîü</h3>\\n          </div>\\n          <div class=\\"card-content\\">\\n            <!-- ÈÄ£Á∂ö„ÉÅ„É£„É¨„É≥„Ç∏„É¢„Éº„ÉâÔºöÂü∫Èü≥ÂÜçÁîü„Éú„Çø„É≥Ôºà8„Çª„ÉÉ„Ç∑„Éß„É≥ÈñãÂßãÂæå„ÅØÈùûË°®Á§∫Ôºâ -->\\n            {#if trainingPhase === 'setup' && !isPlaying && !($currentSessionId > 1)}\\n              <Button \\n                variant=\\"primary\\"\\n                on:click={startContinuousMode}\\n              >\\n                ‚ö° ÈÄ£Á∂ö„ÉÅ„É£„É¨„É≥„Ç∏ÈñãÂßãÔºà8„Çª„ÉÉ„Ç∑„Éß„É≥Ôºâ\\n              </Button>\\n            {:else}\\n              <!-- ÈÄ£Á∂ö„É¢„Éº„ÉâÂÆüË°å‰∏≠„ÅÆÁä∂ÊÖãË°®Á§∫ -->\\n              <div class=\\"continuous-status\\">\\n                {#if isPlaying}\\n                  <div class=\\"status-text\\">\\n                    üéµ Âü∫Èü≥ {$currentSessionId}/8 ÂÜçÁîü‰∏≠...\\n                  </div>\\n                {:else if trainingPhase === 'guiding'}\\n                  <div class=\\"status-text\\">\\n                    üé§ „Çª„ÉÉ„Ç∑„Éß„É≥ {$currentSessionId}/8: „Éâ„É¨„ÉüÁô∫Â£∞‰∏≠\\n                  </div>\\n                {:else if trainingPhase === 'results'}\\n                  <div class=\\"status-text\\">\\n                    ‚úÖ „Çª„ÉÉ„Ç∑„Éß„É≥ {$currentSessionId}/8 ÂÆå‰∫Ü\\n                  </div>\\n                {:else}\\n                  <div class=\\"status-text\\">\\n                    ‚ö° ÈÄ£Á∂ö„É¢„Éº„ÉâÈÄ≤Ë°å‰∏≠ ({$currentSessionId}/8)\\n                  </div>\\n                {/if}\\n              </div>\\n            {/if}\\n            \\n            {#if currentBaseNote}\\n              <div class=\\"base-note-info\\">\\n                ÁèæÂú®„ÅÆÂü∫Èü≥: <strong>{currentBaseNote}</strong> ({currentBaseFrequency.toFixed(1)}Hz)\\n              </div>\\n            {/if}\\n            \\n            <!-- „Éâ„É¨„Éü„Ç¨„Ç§„Éâ„Çπ„Çø„Éº„Éà„Éê„Éº -->\\n            <div class=\\"guide-start-bar-container\\">\\n              <div class=\\"guide-start-label\\">„Ç¨„Ç§„ÉâÈñãÂßã„Åæ„Åß</div>\\n              <div class=\\"guide-start-bar\\">\\n                <div \\n                  class=\\"guide-progress-fill\\" \\n                  style=\\"width: {guideStartProgress}%\\"\\n                ></div>\\n                <div class=\\"guide-music-icon {musicIconGlowing ? 'glowing' : ''}\\">\\n                  <Music size=\\"20\\" />\\n                </div>\\n              </div>\\n            </div>\\n          </div>\\n        </Card>\\n\\n        <!-- Detection Section (Display Only) -->\\n        <PitchDetectionDisplay\\n          frequency={currentFrequency}\\n          note={detectedNote}\\n          volume={currentVolume}\\n          isMuted={trainingPhase !== 'guiding'}\\n          muteMessage=\\"Âü∫Èü≥ÂÜçÁîüÂæå„Å´ÈñãÂßã\\"\\n          className=\\"half-width\\"\\n          showGuidance={false}\\n        />\\n      </div>\\n    {/if}\\n\\n    {#if trainingPhase !== 'results'}\\n      <!-- Scale Guide Section -->\\n      <Card class=\\"main-card\\">\\n        <div class=\\"card-header\\">\\n          <h3 class=\\"section-title\\">üéµ „Éâ„É¨„ÉüÈü≥Èöé„Ç¨„Ç§„Éâ</h3>\\n        </div>\\n        <div class=\\"card-content\\">\\n          <div class=\\"scale-guide\\">\\n            {#each scaleSteps as step, index}\\n              <div \\n                class=\\"scale-item {step.state}\\"\\n              >\\n                {step.name}\\n              </div>\\n            {/each}\\n          </div>\\n          {#if trainingPhase === 'guiding'}\\n            <div class=\\"guide-instruction\\">\\n              „Ç¨„Ç§„Éâ„Å´Âêà„Çè„Åõ„Å¶ <strong>„Éâ„É¨„Éü„Éï„Ç°„ÇΩ„É©„Ç∑„Éâ</strong> „ÇíÊ≠å„Å£„Å¶„Åè„Å†„Åï„ÅÑ\\n            </div>\\n          {/if}\\n        </div>\\n      </Card>\\n    {/if}\\n\\n\\n    <!-- Results Section - Enhanced Scoring System -->\\n    {#if trainingPhase === 'results'}\\n      <!-- Áµ±ÂêàÊé°ÁÇπ„Ç∑„Çπ„ÉÜ„É†ÁµêÊûúÔºàlocalStorageÁµ±ÂêàÁâàÔºâ -->\\n      {#if $unifiedScoreData && $isCompleted}\\n        <!-- 8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÊôÇÔºölocalStorage„Éá„Éº„Çø„Çí‰ΩøÁî® -->\\n        {#if $unifiedScoreData}\\n          {console.log('üîç [ContinuousMode] UnifiedScoreData structure:', {\\n            sessionHistoryLength: $unifiedScoreData.sessionHistory?.length || 0,\\n            sessionHistory: $unifiedScoreData.sessionHistory?.map((s, i) => ({\\n              index: i,\\n              sessionId: s.sessionId,\\n              baseNote: s.baseNote,\\n              hasNoteResults: !!s.noteResults,\\n              noteResultsLength: s.noteResults?.length || 0,\\n              accuracy: s.accuracy\\n            })) || []\\n          })}\\n        {/if}\\n        <UnifiedScoreResultFixed \\n          scoreData={$unifiedScoreData}\\n          showDetails={false}\\n          className=\\"mb-6 iphone-no-margin\\"\\n          currentScoreData={currentScoreData}\\n          intervalData={intervalData}\\n          consistencyData={consistencyData}\\n          feedbackData={feedbackData}\\n          technicalFeedbackData={technicalFeedbackData}\\n          sessionStatistics={sessionStatistics}\\n        />\\n      {:else if currentUnifiedScoreData}\\n        <!-- 1„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÊôÇÔºöÂæìÊù•„ÅÆ„Éá„Éº„Çø„Çí‰ΩøÁî® -->\\n        {console.log('üîç [ContinuousMode] CurrentUnifiedScoreData structure:', {\\n          sessionHistoryLength: currentUnifiedScoreData.sessionHistory?.length || 0,\\n          sessionHistory: currentUnifiedScoreData.sessionHistory?.map((s, i) => ({\\n            index: i,\\n            sessionId: s.sessionId,\\n            baseNote: s.baseNote,\\n            hasNoteResults: !!s.noteResults,\\n            noteResultsLength: s.noteResults?.length || 0,\\n            accuracy: s.accuracy\\n          })) || []\\n        })}\\n        <UnifiedScoreResultFixed \\n          scoreData={currentUnifiedScoreData}\\n          showDetails={false}\\n          className=\\"mb-6 iphone-no-margin\\"\\n          currentScoreData={currentScoreData}\\n          intervalData={intervalData}\\n          consistencyData={consistencyData}\\n          feedbackData={feedbackData}\\n          technicalFeedbackData={technicalFeedbackData}\\n          sessionStatistics={sessionStatistics}\\n        />\\n      {/if}\\n      \\n      \\n      \\n      <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥Ôºà8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÊôÇ„ÅÆ„ÅøË°®Á§∫Ôºâ -->\\n      {#if trainingPhase === 'results' && $isCompleted}\\n        <Card class=\\"main-card bottom-action-card\\">\\n          <div class=\\"card-content\\">\\n            <!-- ‰∏ãÈÉ®„Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥Ôºà8„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÊôÇ„ÅÆ„ÅøÔºâ -->\\n            <ActionButtons \\n              isCompleted={$isCompleted}\\n              position=\\"bottom\\"\\n              on:action={handleActionButtonClick}\\n            />\\n          </div>\\n        </Card>\\n      {:else if trainingPhase === 'results' && !$isCompleted}\\n        <!-- ÈÄ£Á∂ö„É¢„Éº„ÉâÔºö„Çª„ÉÉ„Ç∑„Éß„É≥ÁµêÊûúË°®Á§∫‰∏≠ÔºàËá™Âãï„ÅßÊ¨°„Çª„ÉÉ„Ç∑„Éß„É≥ÈñãÂßãÔºâ -->\\n        <Card class=\\"main-card bottom-action-card\\">\\n          <div class=\\"card-content\\">\\n            <div class=\\"continuous-mode-message\\">\\n              <div class=\\"auto-progress-indicator\\">\\n                <div class=\\"spinner\\"></div>\\n                <span>Ê¨°„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÇíÊ∫ñÂÇô‰∏≠...</span>\\n              </div>\\n            </div>\\n          </div>\\n        </Card>\\n      {/if}\\n    {/if}\\n\\n    <!-- Âè§„ÅÑÂÖ±ÈÄö„Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥„ÅØÂâäÈô§ÔºàActionButtons„Å´Áµ±‰∏ÄÔºâ -->\\n\\n  {:else}\\n    <!-- Direct Access Error State -->\\n    <Card class=\\"error-card\\">\\n      <div class=\\"error-content\\">\\n        <div class=\\"error-icon\\">üé§</div>\\n        <h3>„Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„ÅåÂøÖË¶Å„Åß„Åô</h3>\\n        <p>ÈÄ£Á∂ö„ÉÅ„É£„É¨„É≥„Ç∏„É¢„Éº„Éâ„ÇíÈñãÂßã„Åô„ÇãÂâç„Å´„ÄÅ„Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„ÅßÈü≥Â£∞ÂÖ•Âäõ„ÅÆÁ¢∫Ë™ç„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ</p>\\n        \\n        <div class=\\"recommendation\\">\\n          <p>„Åì„ÅÆ„Éö„Éº„Ç∏„ÅØ<strong>„Éû„Ç§„ÇØ„ÉÜ„Çπ„ÉàÂÆå‰∫ÜÂæå</strong>„Å´„ÅîÂà©Áî®„ÅÑ„Åü„Å†„Åë„Åæ„Åô„ÄÇ</p>\\n          <p>„Åæ„Åö„ÅØ„Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„ÅßÈü≥Â£∞Á¢∫Ë™ç„ÇíË°å„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>\\n        </div>\\n        \\n        <div class=\\"action-buttons\\">\\n          <Button variant=\\"primary\\" on:click={goToMicrophoneTest}>\\n            üé§ „Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„Å∏ÁßªÂãï\\n          </Button>\\n          <Button variant=\\"secondary\\" on:click={goHome}>\\n            üè† „Éõ„Éº„É†„Å´Êàª„Çã\\n          </Button>\\n        </div>\\n      </div>\\n    </Card>\\n  {/if}\\n</PageLayout>\\n\\n<style>\\n  /* === shadcn/uiÈ¢®„É¢„ÉÄ„É≥„Éá„Ç∂„Ç§„É≥ === */\\n  \\n  /* „Éò„ÉÉ„ÉÄ„Éº„Çª„ÇØ„Ç∑„Éß„É≥ */\\n  .header-section {\\n    text-align: center;\\n    margin-bottom: 2rem;\\n  }\\n  \\n  .page-title {\\n    font-size: 2rem;\\n    font-weight: 700;\\n    color: hsl(222.2 84% 4.9%);\\n    margin-bottom: 0.5rem;\\n  }\\n  \\n  .page-description {\\n    color: hsl(215.4 16.3% 46.9%);\\n    font-size: 1rem;\\n    margin: 0;\\n  }\\n\\n\\n  /* „Ç´„Éº„Éâ„Çπ„Çø„Ç§„É´Ôºàshadcn/uiÈ¢®Ôºâ */\\n  :global(.main-card) {\\n    border: 1px solid hsl(214.3 31.8% 91.4%) !important;\\n    background: hsl(0 0% 100%) !important;\\n    border-radius: 8px !important;\\n    box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px 0 rgb(0 0 0 / 0.06) !important;\\n    margin-bottom: 1.5rem;\\n  }\\n  \\n  :global(.status-card) {\\n    border-radius: 8px !important;\\n    margin-bottom: 1.5rem;\\n  }\\n  \\n  :global(.error-card) {\\n    border: 1px solid hsl(0 84.2% 60.2%) !important;\\n    background: hsl(0 84.2% 97%) !important;\\n    border-radius: 8px !important;\\n    box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1) !important;\\n  }\\n  \\n  :global(.results-card) {\\n    border: 1px solid hsl(142.1 76.2% 36.3%) !important;\\n    background: linear-gradient(135deg, hsl(142.1 76.2% 95%) 0%, hsl(0 0% 100%) 100%) !important;\\n  }\\n\\n  /* „Ç´„Éº„Éâ„Éò„ÉÉ„ÉÄ„Éº */\\n  .card-header {\\n    padding-bottom: 1rem;\\n    border-bottom: 1px solid hsl(214.3 31.8% 91.4%);\\n    margin-bottom: 1.5rem;\\n  }\\n  \\n  .section-title {\\n    font-size: 1.125rem;\\n    font-weight: 600;\\n    color: hsl(222.2 84% 4.9%);\\n    margin: 0;\\n  }\\n\\n  /* „Ç´„Éº„Éâ„Ç≥„É≥„ÉÜ„É≥„ÉÑ */\\n  .card-content {\\n    display: flex;\\n    flex-direction: column;\\n    gap: 1rem;\\n  }\\n\\n  /* „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫ */\\n  .status-content {\\n    display: flex;\\n    justify-content: space-between;\\n    align-items: center;\\n    gap: 1rem;\\n  }\\n  \\n  .status-message {\\n    font-weight: 500;\\n    color: hsl(222.2 84% 4.9%);\\n  }\\n  \\n  .progress-indicator {\\n    font-size: 0.875rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n  }\\n\\n  /* „Çµ„Ç§„Éâ„Éê„Ç§„Çµ„Ç§„Éâ„É¨„Ç§„Ç¢„Ç¶„Éà */\\n  .side-by-side-container {\\n    display: flex;\\n    gap: 1.5rem;\\n    margin-bottom: 1.5rem;\\n  }\\n  \\n  :global(.half-width) {\\n    flex: 1;\\n  }\\n  \\n  @media (max-width: 768px) {\\n    .side-by-side-container {\\n      flex-direction: column;\\n    }\\n    \\n    :global(.half-width) {\\n      width: 100%;\\n    }\\n  }\\n\\n  /* „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†± */\\n  .debug-info {\\n    position: absolute;\\n    top: 1rem;\\n    right: 1rem;\\n    background: hsl(220 13% 91%);\\n    color: hsl(220 13% 46%);\\n    padding: 0.25rem 0.5rem;\\n    border-radius: 4px;\\n    font-size: 0.75rem;\\n    font-family: 'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;\\n    z-index: 100;\\n  }\\n\\n  /* Âü∫Èü≥ÊÉÖÂ†± */\\n  .base-note-info {\\n    text-align: center;\\n    padding: 1rem;\\n    background: hsl(210 40% 98%);\\n    border-radius: 6px;\\n    border: 1px solid hsl(214.3 31.8% 91.4%);\\n    font-size: 0.875rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n  }\\n\\n  /* Áõ∏ÂØæÈü≥Á®ãÊÉÖÂ†± */\\n  .relative-pitch-info {\\n    text-align: center;\\n    padding: 1rem;\\n    background: hsl(210 40% 98%);\\n    border-radius: 6px;\\n    border: 1px solid hsl(214.3 31.8% 91.4%);\\n    margin-top: 1rem;\\n  }\\n  \\n  .frequency-display-large {\\n    display: flex;\\n    flex-direction: column;\\n    align-items: center;\\n    gap: 0.25rem;\\n  }\\n  \\n  .large-hz {\\n    font-size: 2rem;\\n    font-weight: 700;\\n    color: hsl(222.2 84% 4.9%);\\n    line-height: 1;\\n  }\\n  \\n  .note-with-cents {\\n    font-size: 0.875rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n    font-weight: 500;\\n  }\\n  \\n  .no-signal {\\n    font-size: 2rem;\\n    font-weight: 700;\\n    color: hsl(215.4 16.3% 46.9%);\\n    line-height: 1;\\n  }\\n  \\n  .pitch-detector-placeholder {\\n    text-align: center;\\n    padding: 2rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n    font-style: italic;\\n  }\\n\\n  /* „Çπ„Ç±„Éº„É´„Ç¨„Ç§„Éâ */\\n  .scale-guide {\\n    display: grid;\\n    grid-template-columns: repeat(4, 1fr);\\n    gap: 0.75rem;\\n    margin-bottom: 1rem;\\n  }\\n  \\n  .scale-item {\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n    height: 3rem;\\n    border-radius: 6px;\\n    font-weight: 500;\\n    font-size: 0.875rem;\\n    border: 1px solid hsl(215.4 16.3% 46.9%);\\n    background: hsl(0 0% 100%);\\n    color: hsl(215.4 16.3% 46.9%);\\n    transition: all 0.3s ease;\\n  }\\n  \\n  .scale-item.active {\\n    background: hsl(343.8 79.7% 53.7%) !important;\\n    color: white !important;\\n    border: 2px solid hsla(343.8 79.7% 53.7% / 0.5) !important;\\n    transform: scale(1.2);\\n    font-size: 1.125rem;\\n    font-weight: 700;\\n    animation: pulse 2s infinite;\\n    box-shadow: 0 0 0 2px hsla(343.8 79.7% 53.7% / 0.3) !important;\\n  }\\n  \\n  .scale-item.correct {\\n    background: hsl(142.1 76.2% 36.3%);\\n    color: hsl(210 40% 98%);\\n    border-color: hsl(142.1 76.2% 36.3%);\\n    animation: correctFlash 0.5s ease-out;\\n  }\\n  \\n  .scale-item.incorrect {\\n    background: hsl(0 84.2% 60.2%);\\n    color: hsl(210 40% 98%);\\n    border-color: hsl(0 84.2% 60.2%);\\n    animation: shake 0.5s ease-in-out;\\n  }\\n  \\n  @keyframes pulse {\\n    0%, 100% { opacity: 1; }\\n    50% { opacity: 0.7; }\\n  }\\n  \\n  @keyframes correctFlash {\\n    0% { transform: scale(1); background: hsl(47.9 95.8% 53.1%); }\\n    50% { transform: scale(1.1); background: hsl(142.1 76.2% 36.3%); }\\n    100% { transform: scale(1); background: hsl(142.1 76.2% 36.3%); }\\n  }\\n  \\n  @keyframes shake {\\n    0%, 100% { transform: translateX(0); }\\n    25% { transform: translateX(-5px); }\\n    75% { transform: translateX(5px); }\\n  }\\n  \\n  /* current„ÇØ„É©„Çπ„ÅØÂâäÈô§Ôºà‰ΩøÁî®„Åó„Å¶„ÅÑ„Å™„ÅÑÔºâ */\\n  \\n  .guide-instruction {\\n    text-align: center;\\n    font-size: 0.875rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n    padding: 0.75rem;\\n    background: hsl(210 40% 98%);\\n    border-radius: 6px;\\n  }\\n  \\n  .guide-feedback {\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n    gap: 0.5rem;\\n    margin-top: 0.5rem;\\n    font-size: 0.75rem;\\n  }\\n  \\n  .feedback-label {\\n    color: hsl(215.4 16.3% 46.9%);\\n    font-weight: 500;\\n  }\\n  \\n  .feedback-value {\\n    font-weight: 700;\\n    font-family: 'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;\\n    padding: 0.125rem 0.375rem;\\n    border-radius: 4px;\\n    background: hsl(214.3 31.8% 91.4%);\\n    color: hsl(222.2 84% 4.9%);\\n    min-width: 4ch;\\n    text-align: center;\\n  }\\n  \\n  .feedback-value.accurate {\\n    background: hsl(142.1 76.2% 90%);\\n    color: hsl(142.1 76.2% 30%);\\n  }\\n  \\n  .feedback-value.close {\\n    background: hsl(47.9 95.8% 90%);\\n    color: hsl(47.9 95.8% 30%);\\n  }\\n  \\n  .feedback-status {\\n    font-weight: 500;\\n    font-size: 0.75rem;\\n  }\\n  \\n  .feedback-status.success {\\n    color: hsl(142.1 76.2% 36.3%);\\n  }\\n  \\n  .feedback-status.close {\\n    color: hsl(47.9 95.8% 45%);\\n  }\\n\\n  /* Ê§úÂá∫Ë°®Á§∫ */\\n  .detection-display {\\n    display: flex;\\n    flex-direction: column;\\n    gap: 1rem;\\n  }\\n  \\n  .detection-card {\\n    display: inline-flex;\\n    align-items: baseline;\\n    gap: 0.5rem;\\n    padding: 1rem 1.5rem;\\n    background: hsl(0 0% 100%);\\n    border: 1px solid hsl(214.3 31.8% 91.4%);\\n    border-radius: 8px;\\n    width: fit-content;\\n  }\\n\\n  /* PitchDetectorË°®Á§∫„ÅÆÊúÄÂº∑Âà∂„Çπ„Çø„Ç§„É™„É≥„Ç∞ */\\n  :global(.detected-frequency) {\\n    font-weight: 600 !important;\\n    font-size: 2rem !important;\\n    color: hsl(222.2 84% 4.9%) !important;\\n    font-family: 'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', \\n                 'JetBrains Mono', 'Fira Code', 'Consolas', monospace !important;\\n    min-width: 4ch !important;\\n    text-align: right !important;\\n    display: inline-block !important;\\n    font-variant-numeric: tabular-nums !important;\\n    -webkit-font-smoothing: antialiased !important;\\n    -moz-osx-font-smoothing: grayscale !important;\\n  }\\n\\n  :global(.hz-suffix) {\\n    font-weight: 600 !important;\\n    font-size: 2rem !important;\\n    color: hsl(222.2 84% 4.9%) !important;\\n  }\\n\\n  :global(.divider) {\\n    color: hsl(214.3 31.8% 70%) !important;\\n    font-size: 1.5rem !important;\\n    margin: 0 0.25rem !important;\\n    font-weight: 300 !important;\\n  }\\n  \\n  :global(.detected-note) {\\n    font-weight: 600 !important;\\n    font-size: 2rem !important;\\n    color: hsl(215.4 16.3% 46.9%) !important;\\n    font-family: 'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', \\n                 'JetBrains Mono', 'Fira Code', 'Consolas', monospace !important;\\n    min-width: 3ch !important;\\n    display: inline-block !important;\\n    text-align: center !important;\\n  }\\n\\n  :global(.volume-bar) {\\n    border-radius: 4px !important;\\n  }\\n  \\n  .detected-info {\\n    display: flex;\\n    align-items: center;\\n    gap: 0.5rem;\\n    font-size: 0.875rem;\\n  }\\n  \\n  .detected-label {\\n    color: hsl(215.4 16.3% 46.9%);\\n  }\\n  \\n  .detected-frequency {\\n    font-weight: 700;\\n    font-size: 1.25rem;\\n    color: hsl(222.2 84% 4.9%);\\n    margin-right: 0.5rem;\\n  }\\n  \\n  .detected-note {\\n    font-weight: 500;\\n    font-size: 0.875rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n    margin-right: 0.25rem;\\n  }\\n  \\n  .pitch-diff {\\n    color: hsl(47.9 95.8% 40%);\\n    font-weight: 500;\\n    margin-left: 0.25rem;\\n  }\\n  \\n  .volume-section {\\n    display: flex;\\n    flex-direction: column;\\n    gap: 0.5rem;\\n  }\\n  \\n  .volume-label {\\n    font-size: 0.875rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n  }\\n  \\n  :global(.modern-volume-bar) {\\n    border-radius: 4px !important;\\n  }\\n\\n  /* ÁµêÊûúË°®Á§∫ */\\n  .results-summary {\\n    display: grid;\\n    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\\n    gap: 1rem;\\n    margin-bottom: 2rem;\\n  }\\n  \\n  .result-item {\\n    text-align: center;\\n    padding: 1rem;\\n    border-radius: 6px;\\n    background: hsl(0 0% 100%);\\n    border: 1px solid hsl(214.3 31.8% 91.4%);\\n  }\\n  \\n  .result-label {\\n    display: block;\\n    font-size: 0.875rem;\\n    color: hsl(215.4 16.3% 46.9%);\\n    margin-bottom: 0.25rem;\\n  }\\n  \\n  .result-value {\\n    display: block;\\n    font-size: 1.5rem;\\n    font-weight: 700;\\n    color: hsl(222.2 84% 4.9%);\\n  }\\n  \\n  .result-value.success {\\n    color: hsl(142.1 76.2% 36.3%);\\n  }\\n  \\n  /* Ë©≥Á¥∞ÁµêÊûú */\\n  .detailed-results {\\n    margin-top: 2rem;\\n  }\\n  \\n  .detailed-title {\\n    font-size: 1rem;\\n    font-weight: 600;\\n    color: hsl(222.2 84% 4.9%);\\n    margin-bottom: 1rem;\\n    text-align: center;\\n  }\\n  \\n  .scale-results {\\n    display: flex;\\n    flex-direction: column;\\n    gap: 0.5rem;\\n  }\\n  \\n  .scale-result-item {\\n    display: grid;\\n    grid-template-columns: 1fr auto auto auto;\\n    gap: 1rem;\\n    padding: 0.75rem;\\n    border-radius: 6px;\\n    border: 1px solid hsl(214.3 31.8% 91.4%);\\n    background: hsl(0 0% 100%);\\n    align-items: center;\\n  }\\n  \\n  .scale-result-item.correct {\\n    background: hsl(142.1 76.2% 95%);\\n    border-color: hsl(142.1 76.2% 80%);\\n  }\\n  \\n  .scale-result-item.incorrect {\\n    background: hsl(0 84.2% 95%);\\n    border-color: hsl(0 84.2% 80%);\\n  }\\n  \\n  .scale-name {\\n    font-weight: 600;\\n    color: hsl(222.2 84% 4.9%);\\n  }\\n  \\n  .scale-accuracy {\\n    font-weight: 500;\\n    font-family: 'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;\\n    color: hsl(215.4 16.3% 46.9%);\\n  }\\n  \\n  .scale-cents {\\n    font-weight: 500;\\n    font-family: 'SF Mono', 'Monaco', 'Cascadia Mono', 'Roboto Mono', monospace;\\n    color: hsl(215.4 16.3% 46.9%);\\n    font-size: 0.875rem;\\n  }\\n  \\n  .scale-status {\\n    text-align: center;\\n    font-size: 1.125rem;\\n  }\\n\\n  /* „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ - Êñ∞„Åó„ÅÑActionButtons„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„ÅßÁÆ°ÁêÜ */\\n  \\n  /* ‰∏äÈÉ®„Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥„ÅÆ„Éû„Éº„Ç∏„É≥Ë™øÊï¥ - ÊúÄÂÑ™ÂÖàÈÅ©Áî® */\\n  .top-action-buttons {\\n    margin: 0.125rem 0 0.125rem 0 !important; /* ‰∏ã„Éû„Éº„Ç∏„É≥„Çí„Åï„Çâ„Å´Á∏ÆÂ∞è: 0.25rem ‚Üí 0.125rem */\\n    padding: 0 !important;\\n  }\\n  \\n  /* ‰∏ãÈÉ®„Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥„Ç´„Éº„Éâ„ÅÆ„Éû„Éº„Ç∏„É≥Ë™øÊï¥ - ÊúÄÂÑ™ÂÖàÈÅ©Áî® */\\n  :global(.bottom-action-card) {\\n    margin-top: 0.5rem !important;  /* „Åï„Çâ„Å´Á∏ÆÂ∞è */\\n    margin-bottom: 0.5rem !important; /* „Åï„Çâ„Å´Á∏ÆÂ∞è */\\n    padding: 0.25rem !important; /* „Ç´„Éº„ÉâËá™‰Ωì„ÅÆpaddingÁ∏ÆÂ∞è */\\n  }\\n  \\n  /* ‰∏ãÈÉ®„Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥„Ç´„Éº„ÉâÂÜÖ„ÅÆpaddingË™øÊï¥ - ÊúÄÂÑ™ÂÖàÈÅ©Áî® */\\n  :global(.bottom-action-card .card-content) {\\n    padding: 0.25rem !important; /* „Åï„Çâ„Å´Á∏ÆÂ∞è */\\n    margin: 0 !important;\\n  }\\n  \\n  /* ActionButtons„Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàÂÜÖ„ÅÆ„Éû„Éº„Ç∏„É≥„ÇíÂº∑Âà∂‰∏äÊõ∏„Åç */\\n  :global(.action-buttons-container.top) {\\n    margin: 0 !important;\\n    padding: 0.25rem 1rem !important;\\n  }\\n  \\n  :global(.action-buttons-container.bottom) {\\n    margin: 0 !important; \\n    padding: 0.25rem 1rem !important;\\n  }\\n  \\n  /* UnifiedScoreResultFixed‰∏äÈÉ®paddingÂº∑Âà∂ÂâäÊ∏õ */\\n  :global(.unified-score-result) {\\n    padding-top: 0.25rem !important; /* „Åï„Çâ„Å´Á∏ÆÂ∞è: 0.5rem ‚Üí 0.25rem */\\n  }\\n  \\n  /* iPhone: ÂÆåÂÖ®‰ΩôÁôΩÂâäÈô§ */\\n  @media (max-width: 640px) {\\n    /* „É°„Ç§„É≥„Éö„Éº„Ç∏ÂÖ®‰Ωì„ÅÆ‰ΩôÁôΩÂâäÈô§ */\\n    main {\\n      margin: 0 !important;\\n      padding: 0 !important;\\n    }\\n    \\n    /* UnifiedScoreResultFixedÂÆåÂÖ®‰ΩôÁôΩÂâäÈô§ */\\n    :global(.iphone-no-margin) {\\n      margin: 0 !important;\\n      padding: 0 !important;\\n    }\\n    \\n    /* mb-6„ÇØ„É©„ÇπÁÑ°ÂäπÂåñ */\\n    :global(.mb-6) {\\n      margin-bottom: 0 !important;\\n    }\\n    \\n    /* „Éö„Éº„Ç∏„Ç≥„É≥„ÉÜ„Éä‰ΩôÁôΩÂâäÈô§ */\\n    .page-container {\\n      margin: 0 !important;\\n      padding: 0 !important;\\n    }\\n  }\\n  \\n  /* Âè§„ÅÑÂÖ±ÈÄö„Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥„Çπ„Çø„Ç§„É´„ÅØÂâäÈô§ÔºàActionButtons„Å´Áµ±‰∏ÄÔºâ */\\n\\n  /* „Ç®„É©„ÉºË°®Á§∫ */\\n  .error-content {\\n    text-align: center;\\n    padding: 2rem 1rem;\\n  }\\n  \\n  .error-icon, .loading-icon {\\n    font-size: 3rem;\\n    margin-bottom: 1rem;\\n  }\\n  \\n  .error-content h3 {\\n    font-size: 1.25rem;\\n    font-weight: 600;\\n    color: hsl(222.2 84% 4.9%);\\n    margin-bottom: 0.5rem;\\n  }\\n  \\n  .error-content p {\\n    color: hsl(215.4 16.3% 46.9%);\\n    margin-bottom: 1rem;\\n  }\\n  \\n  .recommendation {\\n    background: hsl(210 40% 98%);\\n    border: 1px solid hsl(214.3 31.8% 91.4%);\\n    border-radius: 6px;\\n    padding: 1rem;\\n    margin: 1rem 0;\\n  }\\n  \\n  .recommendation p {\\n    margin: 0;\\n    font-size: 0.875rem;\\n  }\\n\\n  /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */\\n  @media (min-width: 768px) {\\n    .scale-guide {\\n      grid-template-columns: repeat(8, 1fr);\\n    }\\n    \\n    .page-title {\\n      font-size: 2.5rem;\\n    }\\n    \\n    .results-summary {\\n      grid-template-columns: repeat(3, 1fr);\\n    }\\n  }\\n  \\n  @media (max-width: 640px) {\\n    .status-content {\\n      flex-direction: column;\\n      gap: 0.5rem;\\n    }\\n    \\n    /* „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ - ActionButtons„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„ÅßÁÆ°ÁêÜ */\\n    \\n    :global(.primary-button), :global(.secondary-button) {\\n      min-width: 100% !important;\\n    }\\n  }\\n\\n  /* „Éû„Ç§„ÇØË≠¶Âëä„Ç´„Éº„Éâ */\\n  :global(.warning-card) {\\n    border: 2px solid #fbbf24 !important;\\n    background: #fef3c7 !important;\\n    margin-bottom: 24px !important;\\n  }\\n\\n  .warning-message {\\n    color: #92400e;\\n    margin-bottom: 12px;\\n  }\\n\\n  .error-list {\\n    color: #dc2626;\\n    margin: 12px 0;\\n    padding-left: 20px;\\n  }\\n\\n  .error-list li {\\n    margin-bottom: 4px;\\n    font-family: monospace;\\n    font-size: 14px;\\n  }\\n\\n  .fix-instruction {\\n    color: #059669;\\n    margin-top: 12px;\\n    padding: 8px;\\n    background: #d1fae5;\\n    border-radius: 4px;\\n    border-left: 4px solid #059669;\\n  }\\n\\n  /* === Êé°ÁÇπË°®Á§∫Â∞ÇÁî®„Çπ„Çø„Ç§„É´ === */\\n  \\n  /* „Çø„Éñ„Ç≥„É≥„ÉÜ„Éä */\\n  .scoring-tabs-container {\\n    display: flex;\\n    gap: 0.5rem;\\n    margin-bottom: 1.5rem;\\n    overflow-x: auto;\\n    border-bottom: 1px solid hsl(214.3 31.8% 91.4%);\\n    padding-bottom: 0.5rem;\\n  }\\n  \\n  /* „Çø„Éñ„Éú„Çø„É≥ */\\n  .scoring-tab {\\n    padding: 0.75rem 1rem;\\n    border-radius: 6px;\\n    border: 1px solid hsl(214.3 31.8% 91.4%);\\n    background: hsl(0 0% 100%);\\n    color: hsl(215.4 16.3% 46.9%);\\n    font-size: 0.875rem;\\n    font-weight: 500;\\n    cursor: pointer;\\n    transition: all 0.2s ease;\\n    flex-shrink: 0;\\n    white-space: nowrap;\\n  }\\n  \\n  .scoring-tab:hover {\\n    background: hsl(210 40% 98%);\\n    border-color: hsl(217.2 32.6% 17.5%);\\n  }\\n  \\n  .scoring-tab.active {\\n    background: hsl(217.2 91.2% 59.8%);\\n    color: hsl(210 40% 98%);\\n    border-color: hsl(217.2 91.2% 59.8%);\\n    font-weight: 600;\\n  }\\n  \\n  /* „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ */\\n  .tab-content {\\n    margin-top: 1rem;\\n    min-height: 200px;\\n  }\\n  \\n  .tab-panel {\\n    animation: fadeIn 0.3s ease-in-out;\\n  }\\n  \\n  @keyframes fadeIn {\\n    from { opacity: 0; transform: translateY(10px); }\\n    to { opacity: 1; transform: translateY(0); }\\n  }\\n  \\n  /* „É¢„Éê„Ç§„É´ÂØæÂøú */\\n  @media (max-width: 768px) {\\n    .scoring-tabs-container {\\n      flex-wrap: wrap;\\n    }\\n    \\n    .scoring-tab {\\n      flex: 1;\\n      min-width: 120px;\\n    }\\n  }\\n  \\n  /* Êäò„Çä„Åü„Åü„ÅøË©≥Á¥∞„Çª„ÇØ„Ç∑„Éß„É≥ */\\n  .traditional-scoring-details,\\n  .detailed-random-scoring,\\n  .random-scoring-section {\\n    margin-top: 2rem;\\n    padding: 1rem;\\n    background: #f9fafb;\\n    border-radius: 8px;\\n  }\\n  \\n  .traditional-scoring-details summary {\\n    font-weight: 600;\\n    transition: color 0.2s;\\n  }\\n  \\n  .traditional-scoring-details summary:hover {\\n    color: #374151;\\n  }\\n  \\n  .traditional-scoring-details[open] summary span {\\n    transform: rotate(90deg);\\n  }\\n  \\n  .traditional-scoring-details summary span {\\n    transition: transform 0.2s;\\n  }\\n  \\n  /* „Çª„ÉÉ„Ç∑„Éß„É≥ÈÄ≤ÊçóË°®Á§∫ */\\n  .session-progress {\\n    background: hsl(0 0% 100%);\\n    border: 1px solid hsl(214.3 31.8% 91.4%);\\n    border-radius: 8px;\\n    padding: 12px 16px;\\n    margin: 16px 0;\\n    box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);\\n  }\\n  \\n  .session-status {\\n    display: flex;\\n    justify-content: space-between;\\n    align-items: center;\\n    gap: 1rem;\\n  }\\n  \\n  .session-info {\\n    display: flex;\\n    align-items: center;\\n    gap: 1rem;\\n  }\\n  \\n  .completed-count {\\n    font-weight: 700;\\n    color: hsl(222.2 84% 4.9%);\\n    font-size: 1.125rem;\\n  }\\n  \\n  .remaining-text {\\n    color: hsl(215.4 16.3% 46.9%);\\n    font-size: 0.875rem;\\n  }\\n  \\n  .progress-section {\\n    display: flex;\\n    align-items: center;\\n    gap: 12px;\\n  }\\n  \\n  .progress-bar {\\n    width: 120px;\\n    height: 4px;\\n    background: hsl(214.3 31.8% 91.4%);\\n    border-radius: 2px;\\n    overflow: hidden;\\n    position: relative;\\n  }\\n  \\n  .progress-fill {\\n    height: 100%;\\n    background: hsl(217.2 91.2% 59.8%);\\n    transition: width 0.3s ease;\\n  }\\n  \\n  .progress-text {\\n    font-weight: 500;\\n    color: hsl(217.2 91.2% 59.8%);\\n    font-size: 0.875rem;\\n    min-width: 35px;\\n    text-align: right;\\n  }\\n  \\n  /* „Éâ„É¨„Éü„Ç¨„Ç§„Éâ„Çπ„Çø„Éº„Éà„Éê„Éº */\\n  .guide-start-bar-container {\\n    margin-top: 1rem;\\n    padding: 0.75rem;\\n    background: #f8fafc;\\n    border-radius: 8px;\\n    border: 1px solid #e2e8f0;\\n  }\\n  \\n  .guide-start-label {\\n    font-size: 0.875rem;\\n    color: #64748b;\\n    margin-bottom: 0.5rem;\\n    text-align: center;\\n    font-weight: 500;\\n  }\\n  \\n  .guide-start-bar {\\n    position: relative;\\n    height: 8px;\\n    background: #e2e8f0;\\n    border-radius: 4px;\\n    overflow: hidden;\\n    display: flex;\\n    align-items: center;\\n  }\\n  \\n  .guide-progress-fill {\\n    height: 100%;\\n    background: linear-gradient(90deg, #3b82f6, #1d4ed8);\\n    border-radius: 4px;\\n    transition: width 0.1s ease-out;\\n  }\\n  \\n  .guide-music-icon {\\n    position: absolute;\\n    right: 8px;\\n    top: 50%;\\n    transform: translateY(-50%);\\n    color: #64748b;\\n    transition: all 0.3s ease;\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n    width: 32px;\\n    height: 32px;\\n    border-radius: 50%;\\n    background: white;\\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\\n  }\\n  \\n  .guide-music-icon.glowing {\\n    color: #fbbf24;\\n    background: #fffbeb;\\n    box-shadow: 0 0 12px rgba(251, 191, 36, 0.4);\\n    animation: pulse-glow 1s infinite;\\n  }\\n  \\n  @keyframes pulse-glow {\\n    0%, 100% {\\n      transform: translateY(-50%) scale(1);\\n      box-shadow: 0 0 12px rgba(251, 191, 36, 0.4);\\n    }\\n    50% {\\n      transform: translateY(-50%) scale(1.1);\\n      box-shadow: 0 0 20px rgba(251, 191, 36, 0.6);\\n    }\\n  }\\n  \\n  @media (max-width: 768px) {\\n    .session-status {\\n      flex-direction: column;\\n      gap: 8px;\\n      align-items: center;\\n    }\\n    \\n    .session-info {\\n      width: 100%;\\n      justify-content: center;\\n    }\\n    \\n    .progress-section {\\n      width: 100%;\\n      justify-content: center;\\n    }\\n  }\\n\\n  /* ÈÄ£Á∂ö„ÉÅ„É£„É¨„É≥„Ç∏„É¢„Éº„ÉâÔºöÂÆüË°åÁä∂ÊÖãË°®Á§∫ */\\n  .continuous-status {\\n    display: flex;\\n    flex-direction: column;\\n    align-items: center;\\n    gap: 12px;\\n  }\\n\\n  .status-text {\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n    padding: 12px 24px;\\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\\n    color: white;\\n    border-radius: 8px;\\n    font-weight: 600;\\n    font-size: 1rem;\\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\\n    animation: pulse-soft 2s infinite;\\n  }\\n\\n  @keyframes pulse-soft {\\n    0%, 100% {\\n      transform: scale(1);\\n      opacity: 1;\\n    }\\n    50% {\\n      transform: scale(1.02);\\n      opacity: 0.9;\\n    }\\n  }\\n</style>"],"names":[],"mappings":"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"}`
};
const buildVersion = "v2.3.1-ANIMATED";
const buildTimestamp = "07/29 04:15";
const updateStatus = "üé¨ Ë©ï‰æ°ÂàÜÂ∏É„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆüË£Ö„ÉªUXÂêë‰∏ä";
function generateIntervalDataFromSessionHistory(sessionHistory2) {
  if (!sessionHistory2 || !Array.isArray(sessionHistory2)) {
    console.warn("‚ö†Ô∏è [RandomTraining] sessionHistory „ÅåÁÑ°Âäπ„Åß„Åô");
    return [];
  }
  const scaleData = [
    {
      type: "unison",
      scale: "„Éâ",
      intervalName: "„É¶„Éã„Çæ„É≥",
      noteIndex: 0
    },
    {
      type: "major_second",
      scale: "„É¨",
      intervalName: "Èï∑2Â∫¶",
      noteIndex: 1
    },
    {
      type: "major_third",
      scale: "„Éü",
      intervalName: "Èï∑3Â∫¶",
      noteIndex: 2
    },
    {
      type: "perfect_fourth",
      scale: "„Éï„Ç°",
      intervalName: "ÂÆåÂÖ®4Â∫¶",
      noteIndex: 3
    },
    {
      type: "perfect_fifth",
      scale: "„ÇΩ",
      intervalName: "ÂÆåÂÖ®5Â∫¶",
      noteIndex: 4
    },
    {
      type: "major_sixth",
      scale: "„É©",
      intervalName: "Èï∑6Â∫¶",
      noteIndex: 5
    },
    {
      type: "major_seventh",
      scale: "„Ç∑",
      intervalName: "Èï∑7Â∫¶",
      noteIndex: 6
    },
    {
      type: "octave",
      scale: "„ÉâÔºàÈ´òÔºâ",
      intervalName: "„Ç™„ÇØ„Çø„Éº„Éñ",
      noteIndex: 7
    }
  ];
  const intervalStats = {};
  scaleData.forEach((item) => {
    intervalStats[item.type] = {
      type: item.type,
      scale: item.scale,
      intervalName: item.intervalName,
      attempts: 0,
      successCount: 0,
      accuracySum: 0,
      accuracyValues: [],
      errorValues: []
      // „Çª„É≥„ÉàÂçò‰Ωç„ÅÆË™§Â∑Æ„ÇíË®òÈå≤
    };
  });
  sessionHistory2.forEach((session) => {
    if (!session.noteResults || !Array.isArray(session.noteResults)) {
      return;
    }
    session.noteResults.forEach((noteResult, noteIndex) => {
      if (noteIndex >= scaleData.length) return;
      const intervalType = scaleData[noteIndex].type;
      const stats = intervalStats[intervalType];
      stats.attempts++;
      if (noteResult.accuracy !== "notMeasured" && typeof noteResult.accuracy === "number") {
        stats.accuracyValues.push(noteResult.accuracy);
        stats.accuracySum += noteResult.accuracy;
        const errorCents = Math.round((100 - noteResult.accuracy) * 0.5);
        stats.errorValues.push(errorCents);
        if (noteResult.accuracy >= 70) {
          stats.successCount++;
        }
      }
    });
  });
  return scaleData.map((item) => {
    const stats = intervalStats[item.type];
    if (stats.attempts === 0) {
      return {
        type: item.type,
        scale: item.scale,
        intervalName: item.intervalName,
        attempts: 0,
        averageError: null,
        accuracy: 0
      };
    }
    const averageAccuracy = stats.accuracyValues.length > 0 ? Math.round(stats.accuracySum / stats.accuracyValues.length) : 0;
    const averageError = stats.errorValues.length > 0 ? Math.round(stats.errorValues.reduce((a, b) => a + b, 0) / stats.errorValues.length) : null;
    const mastery = stats.accuracyValues.length > 0 ? Math.round(stats.successCount / stats.accuracyValues.length * 100) : 0;
    return {
      type: item.type,
      scale: item.scale,
      intervalName: item.intervalName,
      mastery,
      attempts: stats.attempts,
      averageError,
      accuracy: averageAccuracy
    };
  });
}
function scrollToTop() {
  try {
    if ("scrollTo" in window && "behavior" in document.documentElement.style) {
      window.scrollTo({ top: 0, behavior: "smooth" });
    } else {
      window.scrollTo(0, 0);
    }
    if (document.body) {
      document.body.scrollTop = 0;
    }
    if (document.documentElement) {
      document.documentElement.scrollTop = 0;
    }
    const scrollContainers = document.querySelectorAll("[data-scroll-container], .scroll-container, main");
    scrollContainers.forEach((container) => {
      if (container.scrollTo) {
        container.scrollTo(0, 0);
      } else {
        container.scrollTop = 0;
      }
    });
  } catch (error) {
    console.warn("„Çπ„ÇØ„É≠„Éº„É´„Ç®„É©„Éº:", error);
    try {
      window.scroll(0, 0);
    } catch (fallbackError) {
      console.error("„Çπ„ÇØ„É≠„Éº„É´ÂÆåÂÖ®Â§±Êïó:", fallbackError);
    }
  }
}
const Page = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let $currentSessionId, $$unsubscribe_currentSessionId;
  let $unifiedScoreData, $$unsubscribe_unifiedScoreData;
  let $isCompleted, $$unsubscribe_isCompleted;
  let $$unsubscribe_page;
  let $$unsubscribe_remainingSessions;
  let $$unsubscribe_nextBaseName;
  let $$unsubscribe_nextBaseNote;
  let $sessionHistory, $$unsubscribe_sessionHistory;
  let $$unsubscribe_trainingProgress;
  let $isLoading, $$unsubscribe_isLoading;
  validate_store(currentSessionId, "currentSessionId");
  $$unsubscribe_currentSessionId = subscribe(currentSessionId, (value) => $currentSessionId = value);
  validate_store(unifiedScoreData, "unifiedScoreData");
  $$unsubscribe_unifiedScoreData = subscribe(unifiedScoreData, (value) => $unifiedScoreData = value);
  validate_store(isCompleted, "isCompleted");
  $$unsubscribe_isCompleted = subscribe(isCompleted, (value) => $isCompleted = value);
  validate_store(page, "page");
  $$unsubscribe_page = subscribe(page, (value) => value);
  validate_store(remainingSessions, "remainingSessions");
  $$unsubscribe_remainingSessions = subscribe(remainingSessions, (value) => value);
  validate_store(nextBaseName, "nextBaseName");
  $$unsubscribe_nextBaseName = subscribe(nextBaseName, (value) => value);
  validate_store(nextBaseNote, "nextBaseNote");
  $$unsubscribe_nextBaseNote = subscribe(nextBaseNote, (value) => value);
  validate_store(sessionHistory, "sessionHistory");
  $$unsubscribe_sessionHistory = subscribe(sessionHistory, (value) => $sessionHistory = value);
  validate_store(trainingProgress, "trainingProgress");
  $$unsubscribe_trainingProgress = subscribe(trainingProgress, (value) => value);
  validate_store(isLoading, "isLoading");
  $$unsubscribe_isLoading = subscribe(isLoading, (value) => $isLoading = value);
  let trainingPhase = "setup";
  let microphoneState = (() => {
    if (typeof window !== "undefined") {
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get("from") === "microphone-test") {
        logger.info("[RandomTraining] „Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„Åã„Çâ„ÅÆÈÅ∑Áßª„ÇíÊ§úÂá∫");
        return "granted";
      } else {
        logger.info("[RandomTraining] „ÉÄ„Ç§„É¨„ÇØ„Éà„Ç¢„ÇØ„Çª„Çπ„ÇíÊ§úÂá∫");
        return "checking";
      }
    }
    return "checking";
  })();
  const SCALE_NAMES = ["„Éâ", "„É¨", "„Éü", "„Éï„Ç°", "„ÇΩ", "„É©", "„Ç∑", "„ÉâÔºàÈ´òÔºâ"];
  let scaleSteps = SCALE_NAMES.map((name) => ({
    name,
    state: "inactive",
    completed: false
  }));
  let guideStartProgress = 0;
  let currentVolume = 0;
  let currentFrequency = 0;
  let detectedNote = "„Éº„Éº";
  let intervalData = [];
  let pitchDetectorComponent = null;
  onDestroy(() => {
    console.log("üîÑ [RandomTraining] onDestroy - AudioManager„É™„ÇΩ„Éº„Çπ„ÅØ‰øùÊåÅ");
  });
  $$result.css.add(css);
  let $$settled;
  let $$rendered;
  let previous_head = $$result.head;
  do {
    $$settled = true;
    $$result.head = previous_head;
    {
      if ($unifiedScoreData && $isCompleted && $unifiedScoreData.sessionHistory) {
        intervalData = generateIntervalDataFromSessionHistory($unifiedScoreData.sessionHistory);
        console.log("üéµ [RandomTraining] intervalDataÁîüÊàêÂÆå‰∫Ü:", intervalData.length, "‰ª∂");
      }
    }
    {
      if (microphoneState === "granted") {
        scrollToTop();
      }
    }
    $$rendered = `${$$result.head += `<!-- HEAD_svelte-13kpo59_START -->${$$result.title = `<title>ÈÄ£Á∂ö„ÉÅ„É£„É¨„É≥„Ç∏„É¢„Éº„Éâ - Áõ∏ÂØæÈü≥ÊÑü„Éà„É¨„Éº„Éã„É≥„Ç∞</title>`, ""}<!-- HEAD_svelte-13kpo59_END -->`, ""} ${validate_component(PageLayout, "PageLayout").$$render($$result, {}, {}, {
      default: () => {
        return ` <div class="header-section svelte-rt5px1"><h1 class="page-title svelte-rt5px1" data-svelte-h="svelte-1nub9gt">‚ö° ÈÄ£Á∂ö„ÉÅ„É£„É¨„É≥„Ç∏„É¢„Éº„Éâ</h1> <p class="page-description svelte-rt5px1" data-svelte-h="svelte-gneggn">‰∏≠Á¥öËÄÖÂêë„ÅëÔºö8„Çª„ÉÉ„Ç∑„Éß„É≥ÈÄ£Á∂ö„ÅßÂü∫Èü≥„ÅåËá™ÂãïÂÜçÁîü„Åï„Çå„ÇãÈõÜ‰∏≠„Éà„É¨„Éº„Éã„É≥„Ç∞</p>  ${microphoneState === "granted" && !$isLoading ? `<div class="session-progress svelte-rt5px1"><div class="session-status svelte-rt5px1"><div class="session-info svelte-rt5px1"><span class="completed-count svelte-rt5px1">„Çª„ÉÉ„Ç∑„Éß„É≥ ${escape($currentSessionId)}/8</span> <span class="remaining-text svelte-rt5px1">ÂÆå‰∫ÜÊ∏à„Åø ${escape($sessionHistory?.length || 0)}„Çª„ÉÉ„Ç∑„Éß„É≥</span></div> <div class="progress-section svelte-rt5px1"><div class="progress-bar svelte-rt5px1"><div class="progress-fill svelte-rt5px1" style="${"width: " + escape(($sessionHistory?.length || 0) / 8 * 100, true) + "%"}"></div></div> <span class="progress-text svelte-rt5px1">${escape(Math.round(($sessionHistory?.length || 0) / 8 * 100))}%</span></div></div></div>  ${``}` : ``} <div class="debug-info svelte-rt5px1">üì± ${escape(buildVersion)} | ${escape(buildTimestamp)}<br> <small style="font-size: 0.6rem;">${escape(updateStatus)}</small></div></div> ${microphoneState === "granted" ? ` <div style="display: none;">${validate_component(PitchDetector_1, "PitchDetector").$$render(
          $$result,
          {
            isActive: microphoneState === "granted",
            trainingPhase,
            className: "pitch-detector-content",
            debugMode: true,
            disableHarmonicCorrection: false,
            this: pitchDetectorComponent
          },
          {
            this: ($$value) => {
              pitchDetectorComponent = $$value;
              $$settled = false;
            }
          },
          {}
        )}</div>  ${`  ${``} <div class="side-by-side-container svelte-rt5px1"> ${validate_component(Card, "Card").$$render($$result, { class: "main-card half-width" }, {}, {
          default: () => {
            return `<div class="card-header svelte-rt5px1"><h3 class="section-title svelte-rt5px1" data-svelte-h="svelte-syc53b">üéπ Âü∫Èü≥ÂÜçÁîü</h3></div> <div class="card-content svelte-rt5px1"> ${!($currentSessionId > 1) ? `${validate_component(Button, "Button").$$render($$result, { variant: "primary" }, {}, {
              default: () => {
                return `‚ö° ÈÄ£Á∂ö„ÉÅ„É£„É¨„É≥„Ç∏ÈñãÂßãÔºà8„Çª„ÉÉ„Ç∑„Éß„É≥Ôºâ`;
              }
            })}` : ` <div class="continuous-status svelte-rt5px1">${`${`${`<div class="status-text svelte-rt5px1">‚ö° ÈÄ£Á∂ö„É¢„Éº„ÉâÈÄ≤Ë°å‰∏≠ (${escape($currentSessionId)}/8)</div>`}`}`}</div>`} ${``}  <div class="guide-start-bar-container svelte-rt5px1"><div class="guide-start-label svelte-rt5px1" data-svelte-h="svelte-1dufnpv">„Ç¨„Ç§„ÉâÈñãÂßã„Åæ„Åß</div> <div class="guide-start-bar svelte-rt5px1"><div class="guide-progress-fill svelte-rt5px1" style="${"width: " + escape(guideStartProgress, true) + "%"}"></div> <div class="${"guide-music-icon " + escape("", true) + " svelte-rt5px1"}">${validate_component(Music, "Music").$$render($$result, { size: "20" }, {}, {})}</div></div></div></div>`;
          }
        })}  ${validate_component(PitchDetectionDisplay, "PitchDetectionDisplay").$$render(
          $$result,
          {
            frequency: currentFrequency,
            note: detectedNote,
            volume: currentVolume,
            isMuted: trainingPhase !== "guiding",
            muteMessage: "Âü∫Èü≥ÂÜçÁîüÂæå„Å´ÈñãÂßã",
            className: "half-width",
            showGuidance: false
          },
          {},
          {}
        )}</div>`} ${` ${validate_component(Card, "Card").$$render($$result, { class: "main-card" }, {}, {
          default: () => {
            return `<div class="card-header svelte-rt5px1"><h3 class="section-title svelte-rt5px1" data-svelte-h="svelte-1mor0as">üéµ „Éâ„É¨„ÉüÈü≥Èöé„Ç¨„Ç§„Éâ</h3></div> <div class="card-content svelte-rt5px1"><div class="scale-guide svelte-rt5px1">${each(scaleSteps, (step, index) => {
              return `<div class="${"scale-item " + escape(step.state, true) + " svelte-rt5px1"}">${escape(step.name)} </div>`;
            })}</div> ${``}</div>`;
          }
        })}`}  ${``} ` : ` ${validate_component(Card, "Card").$$render($$result, { class: "error-card" }, {}, {
          default: () => {
            return `<div class="error-content svelte-rt5px1"><div class="error-icon svelte-rt5px1" data-svelte-h="svelte-15rbx8n">üé§</div> <h3 class="svelte-rt5px1" data-svelte-h="svelte-17kvze2">„Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„ÅåÂøÖË¶Å„Åß„Åô</h3> <p class="svelte-rt5px1" data-svelte-h="svelte-1t09god">ÈÄ£Á∂ö„ÉÅ„É£„É¨„É≥„Ç∏„É¢„Éº„Éâ„ÇíÈñãÂßã„Åô„ÇãÂâç„Å´„ÄÅ„Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„ÅßÈü≥Â£∞ÂÖ•Âäõ„ÅÆÁ¢∫Ë™ç„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ</p> <div class="recommendation svelte-rt5px1"><p class="svelte-rt5px1">„Åì„ÅÆ„Éö„Éº„Ç∏„ÅØ<strong data-svelte-h="svelte-1n3qsr6">„Éû„Ç§„ÇØ„ÉÜ„Çπ„ÉàÂÆå‰∫ÜÂæå</strong>„Å´„ÅîÂà©Áî®„ÅÑ„Åü„Å†„Åë„Åæ„Åô„ÄÇ</p> <p class="svelte-rt5px1" data-svelte-h="svelte-v8nd09">„Åæ„Åö„ÅØ„Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„ÅßÈü≥Â£∞Á¢∫Ë™ç„ÇíË°å„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p></div> <div class="action-buttons">${validate_component(Button, "Button").$$render($$result, { variant: "primary" }, {}, {
              default: () => {
                return `üé§ „Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„Å∏ÁßªÂãï`;
              }
            })} ${validate_component(Button, "Button").$$render($$result, { variant: "secondary" }, {}, {
              default: () => {
                return `üè† „Éõ„Éº„É†„Å´Êàª„Çã`;
              }
            })}</div></div>`;
          }
        })}`}`;
      }
    })}`;
  } while (!$$settled);
  $$unsubscribe_currentSessionId();
  $$unsubscribe_unifiedScoreData();
  $$unsubscribe_isCompleted();
  $$unsubscribe_page();
  $$unsubscribe_remainingSessions();
  $$unsubscribe_nextBaseName();
  $$unsubscribe_nextBaseNote();
  $$unsubscribe_sessionHistory();
  $$unsubscribe_trainingProgress();
  $$unsubscribe_isLoading();
  return $$rendered;
});
export {
  Page as default
};
