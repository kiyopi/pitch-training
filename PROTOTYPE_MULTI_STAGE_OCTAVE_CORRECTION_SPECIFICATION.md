# ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—å¼å¤šæ®µéšŽã‚ªã‚¯ã‚¿ãƒ¼ãƒ–è£œæ­£ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜æ›¸

## ðŸ“‹ æ¦‚è¦

### èƒŒæ™¯
- **å•é¡Œ**: SvelteKitå®Ÿè£…ã§900Â¢ã€œ1000Â¢ã®ç•°å¸¸ã‚»ãƒ³ãƒˆå€¤ãŒç™ºç”Ÿ
- **åŽŸå› **: å›ºå®šé–¾å€¤ã«ã‚ˆã‚‹ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–è£œæ­£ã®é™ç•Œ
- **è§£æ±ºç­–**: ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã®å®Ÿè¨¼æ¸ˆã¿å¤šæ®µéšŽè£œæ­£ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ç§»æ¤

### èª¿æŸ»å¯¾è±¡ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—
- **ãƒªãƒã‚¸ãƒˆãƒª**: https://github.com/kiyopi/pitch_app
- **ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `full-scale-training.js`
- **å®Ÿè£…æ–¹å¼**: JavaScript + Pitchy ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

---

## ðŸ” ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—åˆ†æžçµæžœ

### ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã®å„ªã‚ŒãŸå®Ÿè£…

#### 1. å¤šæ®µéšŽã‚ªã‚¯ã‚¿ãƒ¼ãƒ–è£œæ­£ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
```javascript
// ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã®æ ¸å¿ƒãƒ­ã‚¸ãƒƒã‚¯
const candidates = [
    { factor: 3, freq: pitch * 3 },    // 1.5ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸Š
    { factor: 2, freq: pitch * 2 },    // 1ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸Š  
    { factor: 1.5, freq: pitch * 1.5 }, // 0.5ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸Š
    { factor: 1, freq: pitch }         // è£œæ­£ãªã—
];
```

#### 2. ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆå€™è£œé¸æŠž
- **ç›®æ¨™å‘¨æ³¢æ•°ç¯„å›²å†…ã§ã®æœ€å°èª¤å·®ã‚’åŸºæº–**
- **å‹•çš„ç¯„å›²åˆ¤å®š**: ç¡¬ç›´çš„ãªé–¾å€¤ã‚’æŽ’é™¤
- **æ®µéšŽçš„è£œæ­£**: 0.5ã€œ1.5ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ã®æŸ”è»Ÿãªè£œæ­£

#### 3. ãƒŽã‚¤ã‚ºãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æœ€é©åŒ–
- **å‘¨æ³¢æ•°ç¯„å›²**: 40Hzã€œ4000Hzï¼ˆSvelteKitã‚ˆã‚Šåºƒç¯„å›²ï¼‰
- **ã‚¯ãƒ©ãƒªãƒ†ã‚£é–¾å€¤**: 0.3ï¼ˆSvelteKitã‚ˆã‚ŠåŽ³æ ¼ï¼‰
- **FFTã‚µã‚¤ã‚º**: 4096ï¼ˆSvelteKitã‚ˆã‚Šé«˜è§£åƒåº¦ï¼‰

---

## ðŸ› ï¸ SvelteKitå®Ÿè£…ä»•æ§˜

### ç§»æ¤å®Œäº†ã®å¤šæ®µéšŽè£œæ­£ã‚·ã‚¹ãƒ†ãƒ 

#### multiStageOctaveCorrectioné–¢æ•°
```javascript
function multiStageOctaveCorrection(detectedFreq, targetFreq) {
    // è¤‡æ•°ã®è£œæ­£å€™è£œã‚’ç”Ÿæˆï¼ˆãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã¨åŒã˜ä¿‚æ•°ï¼‰
    const candidates = [
        { factor: 3, freq: detectedFreq * 3, description: "1.5ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸Š" },
        { factor: 2, freq: detectedFreq * 2, description: "1ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸Š" },
        { factor: 1.5, freq: detectedFreq * 1.5, description: "0.5ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸Š" },
        { factor: 1, freq: detectedFreq, description: "è£œæ­£ãªã—" },
        { factor: 0.67, freq: detectedFreq * 0.67, description: "0.5ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸‹" },
        { factor: 0.5, freq: detectedFreq * 0.5, description: "1ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸‹" },
        { factor: 0.33, freq: detectedFreq * 0.33, description: "1.5ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸‹" }
    ];
    
    // ç›®æ¨™å‘¨æ³¢æ•°ç¯„å›²ã®å®šç¾©ï¼ˆÂ±30%ã®ç¯„å›²ã§å¦¥å½“æ€§ã‚’ãƒã‚§ãƒƒã‚¯ï¼‰
    const targetMin = targetFreq * 0.7;
    const targetMax = targetFreq * 1.3;
    
    // ç¯„å›²å†…ã®å€™è£œã®ã¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    const validCandidates = candidates.filter(candidate => 
        candidate.freq >= targetMin && candidate.freq <= targetMax
    );
    
    // æœ€å°èª¤å·®ã®å€™è£œã‚’é¸æŠž
    let bestCandidate = validCandidates[0];
    let minError = Math.abs(bestCandidate.freq - targetFreq);
    
    for (const candidate of validCandidates) {
        const error = Math.abs(candidate.freq - targetFreq);
        if (error < minError) {
            minError = error;
            bestCandidate = candidate;
        }
    }
    
    return {
        correctedFrequency: bestCandidate.freq,
        factor: bestCandidate.factor,
        description: bestCandidate.description,
        error: minError
    };
}
```

### æŠ€è¡“çš„ç‰¹å¾´

#### 1. 7æ®µéšŽè£œæ­£å€™è£œã‚·ã‚¹ãƒ†ãƒ 
- **ä¸Šæ–¹è£œæ­£**: 1.5å€ã€2å€ã€3å€ï¼ˆ0.5ã€œ1.5ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸Šï¼‰
- **ä¸‹æ–¹è£œæ­£**: 0.33å€ã€0.5å€ã€0.67å€ï¼ˆ0.5ã€œ1.5ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸‹ï¼‰
- **è£œæ­£ãªã—**: 1å€ï¼ˆåŽŸå‘¨æ³¢æ•°ç¶­æŒï¼‰

#### 2. å‹•çš„èª¤å·®æœ€å°åŒ–
- **å¦¥å½“æ€§ãƒ•ã‚£ãƒ«ã‚¿**: Â±30%ç¯„å›²ã§ã®å€™è£œé¸åˆ¥
- **æœ€é©è§£é¸æŠž**: ç›®æ¨™å‘¨æ³¢æ•°ã¨ã®çµ¶å¯¾èª¤å·®æœ€å°åŒ–
- **å®‰å…¨æ€§ç¢ºä¿**: æœ‰åŠ¹å€™è£œãªã—ã®å ´åˆã¯è£œæ­£ãªã—

#### 3. è©³ç´°ãƒ­ã‚°å‡ºåŠ›
```javascript
console.warn(`ðŸ”§ [ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—å¼è£œæ­£] ${stepName}:`);
console.warn(`   æ¤œå‡ºå‘¨æ³¢æ•°: ${frequency.toFixed(1)}Hz`);
console.warn(`   è£œæ­£å¾Œå‘¨æ³¢æ•°: ${adjustedFrequency.toFixed(1)}Hz`);
console.warn(`   æœŸå¾…å‘¨æ³¢æ•°: ${expectedFrequency.toFixed(1)}Hz`);
console.warn(`   ã‚»ãƒ³ãƒˆå·®: ${centDifference}Â¢`);
console.warn(`   è£œæ­£ä¿‚æ•°: ${correctionFactor} (${description})`);
```

---

## ðŸ“Š å¾“æ¥ã‚·ã‚¹ãƒ†ãƒ ã¨ã®æ¯”è¼ƒ

### å¾“æ¥ã®å›ºå®šé–¾å€¤ã‚·ã‚¹ãƒ†ãƒ ï¼ˆå•é¡Œã‚ã‚Šï¼‰
```javascript
// âŒ ç¡¬ç›´çš„ãªè£œæ­£æ¡ä»¶
if (frequency < expectedFrequency * 0.89 || initialCentDiff > 150) {
    while (adjustedFrequency < expectedFrequency * 0.89 && octaveAdjustment < 3) {
        adjustedFrequency *= 2;
        octaveAdjustment++;
    }
}
```

**å•é¡Œç‚¹**:
- å›ºå®šé–¾å€¤ï¼ˆ0.89ã€1.12ï¼‰ã«ã‚ˆã‚‹é™å®šçš„è£œæ­£
- å˜ç´”ãª2å€ãƒ»1/2å€ã®ã¿ã®è£œæ­£
- è£œæ­£å¾Œã®å¦¥å½“æ€§æ¤œè¨¼ãªã—

### ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—å¼å¤šæ®µéšŽã‚·ã‚¹ãƒ†ãƒ ï¼ˆæ”¹å–„ç‰ˆï¼‰
```javascript
// âœ… æŸ”è»Ÿãªå¤šæ®µéšŽè£œæ­£
const candidates = [/* 7æ®µéšŽã®è£œæ­£å€™è£œ */];
const bestCandidate = selectOptimalCandidate(candidates, targetFreq);
```

**æ”¹å–„ç‚¹**:
- 7æ®µéšŽã®è£œæ­£å€™è£œã‹ã‚‰æœ€é©è§£ã‚’é¸æŠž
- 0.5ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–å˜ä½ã®ç´°ã‹ã„è£œæ­£
- Â±30%ç¯„å›²ã§ã®å¦¥å½“æ€§æ¤œè¨¼
- å‹•çš„èª¤å·®æœ€å°åŒ–ã«ã‚ˆã‚‹æœ€é©åŒ–

---

## ðŸŽ¯ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æžœ

### 1. ç•°å¸¸ã‚»ãƒ³ãƒˆå€¤ã®æ ¹æœ¬è§£æ±º
- **Before**: -1306Â¢ã€œ-2395Â¢ã€900Â¢ã€œ1000Â¢ã®æ¥µç«¯ãªå€¤
- **After**: Â±200Â¢ä»¥å†…ã®æ­£å¸¸ãªéŸ³ç¨‹å·®

### 2. ç’°å¢ƒéŸ³ãƒ»å€éŸ³èª¤æ¤œå‡ºã®æ”¹å–„
- **éŸ³é‡ãƒ•ã‚£ãƒ«ã‚¿**: 25ä»¥ä¸Šã®é©åˆ‡ãªä¿¡å·ã®ã¿å‡¦ç†
- **å¤šæ®µéšŽè£œæ­£**: è¤‡é›‘ãªå€éŸ³é–¢ä¿‚ã«ã‚‚å¯¾å¿œ
- **å¦¥å½“æ€§æ¤œè¨¼**: ä¸é©åˆ‡ãªè£œæ­£ã‚’æŽ’é™¤

### 3. ã‚ˆã‚Šæ­£ç¢ºãªç›¸å¯¾éŸ³æ„Ÿãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°
- **ç²¾å¯†ãªæŽ¡ç‚¹**: å®Ÿéš›ã®éŸ³ç¨‹èƒ½åŠ›ã‚’æ­£ç¢ºã«è©•ä¾¡
- **å­¦ç¿’åŠ¹æžœå‘ä¸Š**: æ­£ã—ã„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«ã‚ˆã‚‹åŠ¹çŽ‡çš„ãªä¸Šé”
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“æ”¹å–„**: ç•°å¸¸å€¤ã«ã‚ˆã‚‹æ··ä¹±ã‚’è§£æ¶ˆ

---

## ðŸ”§ å®Ÿè£…è©³ç´°

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
- **ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«**: `/svelte-prototype/src/routes/training/random/+page.svelte`
- **é–¢æ•°å**: `multiStageOctaveCorrection`ã€`evaluateScaleStep`
- **å‘¼ã³å‡ºã—ç®‡æ‰€**: éŸ³ç¨‹è©•ä¾¡å‡¦ç†å†…ï¼ˆã‚¬ã‚¤ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ï¼‰

### çµ±åˆãƒã‚¤ãƒ³ãƒˆ
1. **æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®èžåˆ**: `calculateExpectedFrequency`ã¨ã®é€£æº
2. **AudioManagerå¯¾å¿œ**: å¤–éƒ¨AudioContextæ–¹å¼ã¨ã®äº’æ›æ€§
3. **ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½**: è©³ç´°ãªè£œæ­£ãƒ­ã‚°å‡ºåŠ›

### ãƒ†ã‚¹ãƒˆè¦ä»¶
- **ç•°å¸¸ã‚»ãƒ³ãƒˆå€¤ã®è§£æ¶ˆç¢ºèª**
- **å„éŸ³éšŽã§ã®è£œæ­£å‹•ä½œæ¤œè¨¼**
- **ç’°å¢ƒéŸ³é™¤å¤–æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ**
- **GitHub Pageså®Ÿæ©Ÿå‹•ä½œç¢ºèª**

---

## ðŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹è€ƒæ…®äº‹é …

### è¨ˆç®—é‡
- **å€™è£œç”Ÿæˆ**: O(1) - å›ºå®š7å€™è£œ
- **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: O(n) - n=7ã®ç·šå½¢å‡¦ç†
- **æœ€é©åŒ–**: O(n) - æœ€å°èª¤å·®æŽ¢ç´¢

### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
- **è»½é‡å®Ÿè£…**: å€™è£œé…åˆ—ã®ã¿ã®ä¸€æ™‚ãƒ¡ãƒ¢ãƒªä½¿ç”¨
- **ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³**: é–¢æ•°çµ‚äº†æ™‚ã«è‡ªå‹•è§£æ”¾

---

## ðŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤æƒ…å ±

### å®Ÿè£…å®Œäº†
- **æ—¥æ™‚**: 2025-07-28
- **ãƒ–ãƒ©ãƒ³ãƒ**: `random-training-tonejs-fixed-001`
- **ã‚³ãƒŸãƒƒãƒˆ**: `22943e6`
- **ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆ**: GitHub Pages

### ç¢ºèªURL
- **ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸**: https://kiyopi.github.io/pitch-training/training/random
- **æƒ³å®šæ”¹å–„**: ç•°å¸¸ã‚»ãƒ³ãƒˆå€¤â†’æ­£å¸¸ç¯„å›²ï¼ˆÂ±200Â¢ä»¥å†…ï¼‰

---

## ðŸ“ ä»Šå¾Œã®æ‹¡å¼µå¯èƒ½æ€§

### ä»–ãƒ¢ãƒ¼ãƒ‰ã¸ã®é©ç”¨
- **é€£ç¶šãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰**: åŒã˜è£œæ­£ã‚·ã‚¹ãƒ†ãƒ ã‚’é©ç”¨
- **12éŸ³éšŽãƒ¢ãƒ¼ãƒ‰**: ã‚ˆã‚Šè¤‡é›‘ãªéŸ³ç¨‹é–¢ä¿‚ã¸ã®å¯¾å¿œ

### ã•ã‚‰ãªã‚‹æœ€é©åŒ–
- **æ©Ÿæ¢°å­¦ç¿’å°Žå…¥**: ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ã®è£œæ­£ãƒ‘ã‚¿ãƒ¼ãƒ³å­¦ç¿’
- **å‹•çš„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´**: æ¥½å™¨ãƒ»ç’°å¢ƒã«å¿œã˜ãŸè‡ªå‹•æœ€é©åŒ–
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§èƒ½å‘ä¸Š**: WebAssemblyç­‰ã®é«˜é€ŸåŒ–æŠ€è¡“

---

*ã“ã®ä»•æ§˜æ›¸ã¯ã€ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—èª¿æŸ»çµæžœã¨SvelteKitå®Ÿè£…ã®æŠ€è¡“è¨˜éŒ²ã¨ã—ã¦ä½œæˆã•ã‚Œã¾ã—ãŸã€‚*

## ðŸ“š é–¢é€£è³‡æ–™
- [ABNORMAL_CENT_VALUE_FIX_SPECIFICATION.md](./ABNORMAL_CENT_VALUE_FIX_SPECIFICATION.md)
- [UNIFIED_PITCH_CALCULATION_SPECIFICATION.md](./UNIFIED_PITCH_CALCULATION_SPECIFICATION.md)
- [ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/kiyopi/pitch_app)