# 技術的ブレ調査プロトコル

**作成日**: 2025-08-02  
**目的**: Web Audio API音程検出の技術的ブレを定量化し、外れ値検出システム再構築の基礎データを収集  
**関連**: `OUTLIER_DETECTION_POLICY.md`の技術的要件実現

## 🎯 **調査の目的と背景**

### **問題の定義**
- **技術的ブレ**: Web Audio APIの音程検出における、実際の発声音程と検出結果の誤差
- **影響範囲**: ±15¢（通常）〜 ±50¢（最悪時）の測定誤差
- **問題**: 真の音程能力と技術的制約による誤差の区別が困難

### **調査の重要性**
1. **公正な評価**: 技術的制約による不当な減点を排除
2. **外れ値検出精度**: 真の外れ値と技術的誤差の適切な分離
3. **学習効果最大化**: 正確な評価による継続的モチベーション維持

## 🔬 **調査プロトコル**

### **Phase 1: 基礎測定精度調査（1週間）**

#### **1-1: 環境別精度測定**
```
測定項目:
- デバイス: iPhone Safari, Android Chrome, PC Chrome/Firefox/Safari
- マイク種別: 内蔵マイク、外付けマイク、ヘッドセット
- 環境条件: 静音室、通常室内、背景雑音あり

実施方法:
1. 基準音程(C4=261.63Hz)を楽器で正確に発声
2. 各環境で30回連続測定
3. 平均値、標準偏差、最大誤差を記録
4. 統計的分析による環境係数算出
```

#### **1-2: 音程別誤差傾向分析**
```
対象音程: C4, D4, E4, F4, G4, A4, B4, C5 (ドレミファソラシド)
各音程での測定:
- 楽器基準音での30回測定
- 人声発声での30回測定
- 周波数別の誤差傾向分析

期待結果:
- 高音域での誤差増大傾向の定量化
- 人声特有の倍音影響度測定
- 音程別補正係数の算出
```

#### **1-3: 時間的変動の測定**
```
測定期間: 1日6回 × 7日間
測定時間: 朝6時、9時、12時、15時、18時、21時
測定内容: C4音程での5回連続測定

分析項目:
- 時間帯による精度変動
- CPU負荷・メモリ使用量との相関
- ブラウザセッション持続時間の影響
```

### **Phase 2: 技術的ブレ要因分析（1週間）**

#### **2-1: システム負荷影響測定**
```
負荷条件:
- CPU使用率: 20%、50%、80%での測定比較
- メモリ使用量: 空き容量別での精度変化
- 同時実行タスク: 音楽再生、動画視聴時の影響

測定方法:
- 各負荷条件下でC4音程を20回測定
- 負荷なし時との誤差比較
- 負荷閾値と精度劣化の関係性分析
```

#### **2-2: ネットワーク環境影響測定**
```
接続条件:
- WiFi: 高速回線、中速回線、低速回線
- LTE: 4G、5G環境での比較
- オフライン: ローカル実行時の精度

測定内容:
- 音程検出遅延時間の測定
- 遅延と検出精度の相関分析
- リアルタイム性要件の定義
```

#### **2-3: 音響環境影響測定**
```
環境条件:
- 背景雑音レベル: 30dB、40dB、50dB、60dB
- 反響条件: 吸音室、通常室、反響室
- 周波数干渉: 他楽器音、電子機器ノイズ

分析項目:
- SNR(Signal-to-Noise Ratio)と検出精度の関係
- 雑音除去フィルタの効果測定
- 実用環境での最低音質要件定義
```

### **Phase 3: 統計的モデル構築（1週間）**

#### **3-1: 技術的ブレモデル構築**
```
データ収集: Phase 1-2の全測定データ
統計手法:
- 正規分布適合度検定
- 外れ値検出（Grubbs検定、四分位法）
- 信頼区間算出（95%、99%）

モデル出力:
- 環境別補正係数
- 音程別誤差予測式
- 信頼区間による異常値検出閾値
```

#### **3-2: 外れ値検出アルゴリズム設計**
```
アルゴリズム要件:
- 技術的ブレ範囲内の変動を正常値として扱う
- 真の音程外れ（±75¢以上）を確実に検出
- False Positive率 < 5%を達成

実装方式:
1. 移動平均による基準値算出
2. 技術的ブレを考慮した動的閾値設定
3. 連続外れ値検出による確度向上
```

#### **3-3: 精度検証実験**
```
検証データ:
- 意図的外れ値: ±50¢、±75¢、±100¢のテストケース
- 技術的誤差: Phase 1-2で収集した実測データ
- 混合データ: 外れ値と技術的誤差を含む複合データセット

評価指標:
- 感度(Sensitivity): 真の外れ値検出率
- 特異度(Specificity): 正常値の正しい判定率
- 精度(Accuracy): 全体的な判定正確度
- F1スコア: 総合的な性能指標
```

## 📊 **データ収集・分析ツール**

### **測定データ記録フォーマット**
```json
{
  "sessionId": "unique_id",
  "timestamp": "2025-08-02T10:30:00Z",
  "environment": {
    "device": "iPhone 12",
    "browser": "Safari 17.1",
    "microphone": "built-in",
    "location": "quiet_room"
  },
  "measurement": {
    "targetFrequency": 261.63,
    "detectedFrequency": 265.2,
    "error_cents": +52.1,
    "confidence": 0.89,
    "snr": 18.5
  },
  "systemStatus": {
    "cpuUsage": "25%",
    "memoryAvailable": "2.1GB",
    "networkLatency": "15ms"
  }
}
```

### **統計分析ツール**
- **記述統計**: 平均、標準偏差、四分位数、外れ値
- **分布分析**: 正規性検定、歪度、尖度
- **相関分析**: 環境要因と誤差の相関係数
- **回帰分析**: 誤差予測モデルの構築

## 🎯 **期待される成果**

### **定量的成果**
1. **技術的ブレ範囲**: 環境別の±X¢範囲の確定
2. **補正係数**: 環境・音程別の誤差補正式
3. **閾値設定**: 統計的根拠のある外れ値判定基準
4. **精度指標**: 95%以上の正確度を持つ検出システム

### **実装への反映**
1. **適応的閾値システム**: 環境に応じた動的閾値調整
2. **信頼度表示**: 測定結果の信頼性をユーザーに提示
3. **自動補正機能**: 技術的ブレを考慮した自動誤差補正
4. **透明性向上**: 技術的制約の明示による評価の透明化

## 📅 **実施スケジュール**

```
Week 1: Phase 1 基礎測定精度調査
- Day 1-2: 環境別精度測定セットアップ
- Day 3-4: 音程別誤差傾向分析
- Day 5-7: 時間的変動の連続測定

Week 2: Phase 2 技術的ブレ要因分析  
- Day 1-3: システム負荷影響測定
- Day 4-5: ネットワーク環境影響測定
- Day 6-7: 音響環境影響測定

Week 3: Phase 3 統計的モデル構築
- Day 1-3: 技術的ブレモデル構築
- Day 4-5: 外れ値検出アルゴリズム設計
- Day 6-7: 精度検証実験

Week 4: 実装・検証
- Day 1-3: 新システムの実装
- Day 4-5: 総合テスト・調整
- Day 6-7: ドキュメント化・運用開始
```

## 🔗 **関連ドキュメント連携**

- **OUTLIER_DETECTION_POLICY.md**: 本調査結果の活用方針
- **PITCHY_SPECS.md**: 音程検出技術仕様への反映
- **WORK_LOG_UPDATE.md**: 実施進捗の継続記録

---

**この調査プロトコルにより、科学的根拠に基づく外れ値検出システムの再構築を実現します。**